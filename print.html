<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Rust语言参考手册</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/reference-ce12791d.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-4a49bb37.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-99e7fd87.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust语言参考手册</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/zhiming-wu/rust-reference-zh_cn/" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <!-- https://github.com/rust-lang/reference/blob/master/src/introduction.md -->
<!-- commit 68bdfd15fa9feebfbf94a06cf574de598e239198 -->
<h1 id="引言"><a class="header" href="#引言">引言</a></h1>
<p>本书是 Rust 编程语言的主要参考资料。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>有关本书中已知错误和遗漏，请参阅我们的 <a href="https://github.com/rust-lang/reference/issues">问题单</a>。如果您发现编译器行为与本文描述不符的情况，请提交问题，以便我们讨论哪个是正确的。</p>
</blockquote>
</div>

<h2 id="rust-发布版本"><a class="header" href="#rust-发布版本">Rust 发布版本</a></h2>
<p>Rust 每六周发布一个新的语言版本。
该语言的第一个稳定版本是 Rust 1.0.0，随后是 Rust 1.1.0 等。
工具（<code>rustc</code>、<code>cargo</code> 等）和文档（<a href="https://doc.rust-lang.org/std/index.html">标准库</a>、本书等）随语言版本一起发布。</p>
<p>本书的最新版本，与最新的 Rust 版本相匹配，始终可在 <a href="https://doc.rust-lang.org/reference/">https://doc.rust-lang.org/reference/</a> 找到。
可以通过在 “reference” 目录前添加 Rust 版本号来查找以前的版本。
例如，Rust 1.49.0 的参考资料位于 <a href="https://doc.rust-lang.org/1.49.0/reference/">https://doc.rust-lang.org/1.49.0/reference/</a>。</p>
<h2 id="参考手册不是什么"><a class="header" href="#参考手册不是什么">《参考手册》不是什么</a></h2>
<p>本书并非语言入门指南。
阅读本书需假定您已具备语言基础知识。
另有一本 <a href="https://doc.rust-lang.org/book/index.html">书籍</a> 可帮助您获取此类基础知识。</p>
<p>本书也不是语言发行版中包含的 <a href="https://doc.rust-lang.org/std/index.html">标准库</a> 的参考资料。
这些库通过从其源代码中提取文档属性来单独记录。
许多您可能期望是语言特性的功能在 Rust 中是库特性，因此您要查找的内容可能在那里，而不是在这里。</p>
<p>同样，本书通常不记录 <code>rustc</code> 作为工具或 Cargo 的具体细节。
<code>rustc</code> 有自己的 <a href="https://doc.rust-lang.org/rustc/index.html">书籍</a>。
Cargo 有一本 <a href="https://doc.rust-lang.org/cargo/index.html">书籍</a>，其中包含一份 <a href="https://doc.rust-lang.org/cargo/reference/index.html">参考资料</a>。
还有一些页面，例如 <a href="#链接">链接</a>，也是描述 <code>rustc</code> 的工作方式。</p>
<p>本书也仅作为稳定版 Rust 中可用功能的参考。
对于正在开发的不稳定功能，请参阅 <a href="https://doc.rust-lang.org/nightly/unstable-book/">不稳定手册</a>。</p>
<p>Rust 编译器，包括 <code>rustc</code>，会执行优化。
本参考手册没有指定允许或不允许哪些优化。
相反，请将编译后的程序视为一个黑盒子。
您只能通过运行它，提供输入并观察其输出来进行探测。
所有以这种方式发生的事情都必须符合参考手册的规定。</p>
<h2 id="如何使用本书"><a class="header" href="#如何使用本书">如何使用本书</a></h2>
<p>本书不假设您是按顺序阅读本书的。
每个章节通常可以独立阅读，但会交叉链接到其他章节，以提及它们所涉及但不讨论的语言方面。</p>
<p>阅读本文档主要有两种方式。</p>
<p>第一种是回答一个具体问题。
如果您知道哪个章节回答了该问题，您可以直接跳转到目录中的该章节。
否则，您可以按 <code>s</code> 键或点击顶部栏的放大镜图标来搜索与您问题相关的关键词。
例如，假设您想知道在 let 语句中创建的临时值何时被丢弃。
如果您不知道 <a href="#temporaries">临时值的生命周期</a> 定义在 <a href="#表达式">表达式章节</a> 中，您可以搜索“临时 let”，第一个搜索结果将带您到该部分。</p>
<p>第二种是普遍提高您对语言某方面的知识。
在这种情况下，只需浏览目录，直到看到您想了解更多内容的部分，然后开始阅读即可。
如果某个链接看起来很有趣，请点击它，然后阅读该部分。</p>
<p>话虽如此，阅读本书没有错误的方式。请以您认为最有帮助的方式阅读。</p>
<h3 id="约定"><a class="header" href="#约定">约定</a></h3>
<p>像所有技术书籍一样，本书在信息展示方面也有某些约定。
这些约定在此处记录。</p>
<ul>
<li>
<p>定义术语的语句包含 <em>斜体</em> 的该术语。
每当该术语在该章节之外使用时，它通常是链接到包含此定义的章节。</p>
<p><em>示例术语</em> 是一个正在定义的术语的示例。</p>
</li>
<li>
<p>主要文本描述最新的稳定版本。与以前版本的差异在版本块中分离：</p>
<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p>在 2018 版次之前，行为是这样的。从 2018 版次开始，行为是那样的。</p>
</blockquote>
</div>

</li>
<li>
<p>包含有关本书状态的有用信息或指出有用但大多超出范围的信息的注释位于注释块中。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>这是一个示例注释。</p>
</blockquote>
</div>

</li>
<li>
<p>示例块显示一个示例，演示某个规则或指出某个有趣的方面。一些示例可能有隐藏行，可以通过将鼠标悬停或点击示例时出现的眼睛图标来查看。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>这是一个代码示例。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>println!("hello world");
<span class="boring">}</span></code></pre>
</blockquote>
</div>

</li>
<li>
<p>显示语言中不健全行为或语言功能之间可能令人困惑的交互的警告位于特殊的警告框中。</p>
<div class="alert alert-warning">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>警告</p>

<p>这是一个示例警告。</p>
</blockquote>
</div>

</li>
<li>
<p>文本中的内联代码片段位于 <code>&lt;code&gt;</code> 标签内。</p>
<p>较长的代码示例位于一个带有语法高亮显示的框中，其右上角有复制、执行和显示隐藏行的控件。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">// 这是一行隐藏行。
</span>fn main() {
    println!("这是一个代码示例");
}</code></pre>
<p>除非另有说明，所有示例均针对最新版本编写。</p>
</li>
<li>
<p>语法和词法产生式在 <a href="#记法">符号</a> 章节中描述。</p>
</li>
</ul>
<div class="rule" id="r-example.rule.label"><a class="rule-link" href="#r-example.rule.label" title="example.rule.label"><span>[example<wbr>.rule<wbr>.label]</span></a>
</div>

<ul>
<li>
<p>规则标识符出现在每个语言规则之前，用方括号括起来。这些标识符提供了一种引用和链接到语言中特定规则的方法（例如，<a href="#r-example.rule.label">示例规则</a>）。规则标识符使用句点将部分从最一般到最具体地分开（例如，<a href="#r-destructors.scope.nesting.function-body">解构器.作用域.嵌套.函数体</a>）。在窄屏幕上，规则名称将折叠显示 <code>[*]</code>。</p>
<p>可以点击规则名称以链接到该规则。</p>
<div class="alert alert-warning">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>警告</p>

<p>规则的组织目前处于变动中。暂时而言，这些标识符名称在不同版本之间不稳定，如果它们发生更改，指向这些规则的链接可能会失效。我们打算在组织稳定后将其稳定化，以便指向规则名称的链接在不同版本之间不会中断。</p>
</blockquote>
</div>

</li>
<li>
<p>具有相关测试的规则将在其下方包含一个“测试”链接（在窄屏幕上，该链接为 <code>[T]</code>）。单击该链接将弹出一个测试列表，可以单击以查看测试。例如，请参见 <a href="#r-input.encoding.utf8">输入.编码.utf8</a>。</p>
<p>将规则链接到测试是一项持续进行的工作。有关概述，请参阅 <a href="#测试总结">测试摘要</a> 章节。</p>
</li>
</ul>
<h2 id="贡献"><a class="header" href="#贡献">贡献</a></h2>
<p>我们欢迎各种形式的贡献。</p>
<p>您可以通过在 <a href="https://github.com/rust-lang/reference/">Rust语言参考仓库</a> 中提出问题或发送拉取请求来为本书做出贡献。
如果本书没有回答您的问题，并且您认为它的答案属于其范围，请不要犹豫 <a href="https://github.com/rust-lang/reference/issues">提交问题</a> 或在 <a href="https://rust-lang.zulipchat.com/#narrow/stream/237824-t-lang.2Fdoc">Zulip</a> 上的 <code>t-lang/doc</code> 流中提问。
了解人们最常使用本书做什么有助于我们将注意力集中在使这些部分尽善尽美上。
当然，如果您发现任何错误或非规范性但未明确指出的内容，也请 <a href="https://github.com/rust-lang/reference/issues">提交问题</a>。</p>
<div style="break-before: page; page-break-before: always;"></div><!-- https://github.com/rust-lang/reference/blob/master/src/notation.md -->
<!-- commit 68bdfd15fa9feebfbf94a06cf574de598e239198 -->
<div class="rule" id="r-notation"><a class="rule-link" href="#r-notation" title="notation"><span>[notation]</span></a>
</div>

<h1 id="记法"><a class="header" href="#记法">记法</a></h1>
<div class="rule" id="r-notation.grammar"><a class="rule-link" href="#r-notation.grammar" title="notation.grammar"><span>[notation<wbr>.grammar]</span></a>
</div>

<h2 id="语法"><a class="header" href="#语法">语法</a></h2>
<div class="rule" id="r-notation.grammar.syntax"><a class="rule-link" href="#r-notation.grammar.syntax" title="notation.grammar.syntax"><span>[notation<wbr>.grammar<wbr>.syntax]</span></a>
</div>

<p>以下记法用于<em>词法分析器</em>和<em>语法格式</em>文法片段：</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>记法</th><th>示例</th><th>含义</th><th>译者注</th></tr>
</thead>
<tbody>
<tr><td>CAPITAL</td><td>KW_IF, INTEGER_LITERAL</td><td>词法分析器生成的词法单元</td><td>大写</td></tr>
<tr><td><em>ItalicCamelCase</em></td><td><em>LetStatement</em>, <em>Item</em></td><td>一个语法产生式</td><td>斜体、驼峰方式大小写(单词首字母大写)</td></tr>
<tr><td><code>string</code></td><td><code>x</code>, <code>while</code>, <code>*</code></td><td>确切的字符(或字符串)</td><td></td></tr>
<tr><td>x<sup>?</sup></td><td><code>pub</code><sup>?</sup></td><td>一个可选的项</td><td></td></tr>
<tr><td>x<sup>*</sup></td><td><em>OuterAttribute</em><sup>*</sup></td><td>0个或多个x</td><td></td></tr>
<tr><td>x<sup>+</sup></td><td><em>MacroMatch</em><sup>+</sup></td><td>1个或多个x</td><td></td></tr>
<tr><td>x<sup>a..b</sup></td><td>HEX_DIGIT<sup>1..6</sup></td><td>a到b次重复x</td><td></td></tr>
<tr><td>Rule1 Rule2</td><td><code>fn</code> <em>Name</em> <em>Parameters</em></td><td>规则的顺序序列</td><td></td></tr>
<tr><td>|</td><td><code>u8</code> | <code>u16</code>, Block | Item</td><td>二者之一</td><td></td></tr>
<tr><td>[ ]</td><td>[<code>b</code> <code>B</code>]</td><td>列出的任意字符</td><td></td></tr>
<tr><td>[ - ]</td><td>[<code>a</code>-<code>z</code>]</td><td>范围内的任意字符</td><td></td></tr>
<tr><td>~[ ]</td><td>~[<code>b</code> <code>B</code>]</td><td>任意字符，除了列出的</td><td></td></tr>
<tr><td>~<code>string</code></td><td>~<code>\n</code>, ~<code>*/</code></td><td>任意字符，除了此序列</td><td></td></tr>
<tr><td>( )</td><td>(<code>,</code> <em>Parameter</em>)<sup>?</sup></td><td>分组项</td><td></td></tr>
<tr><td>U+xxxx</td><td>U+0060</td><td>一个Unicode字符</td><td></td></tr>
<tr><td>&lt;text&gt;</td><td>&lt;any ASCII char except CR&gt;</td><td>一个匹配内容的英文描述</td><td></td></tr>
<tr><td>Rule <sub>suffix</sub></td><td>IDENTIFIER_OR_KEYWORD <sub><em>except <code>crate</code></em></sub></td><td>对前一个规则的修改</td><td></td></tr>
<tr><td>// Comment.</td><td>// Single line comment.</td><td>延伸到行尾的注释。</td><td></td></tr>
</tbody>
</table>
</div>
<p>序列的优先级高于<code>|</code>选项。</p>
<div class="rule" id="r-notation.grammar.string-tables"><a class="rule-link" href="#r-notation.grammar.string-tables" title="notation.grammar.string-tables"><span>[notation<wbr>.grammar<wbr>.string-tables]</span></a>
</div>

<h3 id="字符串表产生式"><a class="header" href="#字符串表产生式">字符串表产生式</a></h3>
<p>语法中的某些规则 —— 特别是<a href="#borrow-operators">一元运算符</a>、<a href="#arithmetic-and-logical-binary-operators">二元运算符</a>和<a href="#关键字">关键字</a> —— 以简化形式给出：作为可打印字符串的列表。这些情况构成了关于<a href="#词法单元">词法单元</a>规则的一个子集，并被认为是词法分析阶段的结果，该阶段由一个<abbr title="确定性有限自动机">DFA</abbr>驱动，作用于所有此类字符串表条目的析取，从而为解析器提供输入。</p>
<p>当语法中出现<code>等宽字体</code>的字符串时，它隐式引用了此类字符串表产生式的一个成员。有关更多信息，请参阅<a href="#词法单元">词法单元</a>。</p>
<div class="rule" id="r-notation.grammar.visualizations"><a class="rule-link" href="#r-notation.grammar.visualizations" title="notation.grammar.visualizations"><span>[notation<wbr>.grammar<wbr>.visualizations]</span></a>
</div>

<h3 id="语法可视化"><a class="header" href="#语法可视化">语法可视化</a></h3>
<p>在每个语法块下方都有一个按钮，用于切换<a href="https://en.wikipedia.org/wiki/Syntax_diagram">语法格式图</a>的显示。一个方形元素是一个非终结规则，一个圆角矩形是一个终结符。</p>
<div style="break-before: page; page-break-before: always;"></div><!-- https://github.com/rust-lang/reference/blob/master/src/lexical-structure.md -->
<!-- commit 68bdfd15fa9feebfbf94a06cf574de598e239198 -->
<h1 id="词法结构"><a class="header" href="#词法结构">词法结构</a></h1>
<!-- Editor Note: Oh, there's nothing here -->
<div style="break-before: page; page-break-before: always;"></div><!-- https://github.com/rust-lang/reference/blob/master/src/input-format.md -->
<!-- commit 68bdfd15fa9feebfbf94a06cf574de598e239198 -->
<div class="rule" id="r-input"><a class="rule-link" href="#r-input" title="input"><span>[input]</span></a>
</div>

<h1 id="输入格式"><a class="header" href="#输入格式">输入格式</a></h1>
<div class="rule" id="r-input.syntax"><a class="rule-link" href="#r-input.syntax" title="input.syntax"><span>[input<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-CHAR" onclick="show_railroad()"><a href="#railroad-CHAR">CHAR</a></span> → <span class="grammar-text">&lt;a Unicode scalar value&gt;</span></p>
<p><span class="grammar-text grammar-production" id="grammar-NUL" onclick="show_railroad()"><a href="#railroad-NUL">NUL</a></span> → U+0000</p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 274px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-CHAR"><svg class="railroad" viewbox="0 0 274 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-CHAR">
<text class="comment" x="29" y="25">
CHAR</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="204" x="35" y="42" />
<text x="137" y="58">
a Unicode scalar value</text>
</g>
<path d=" M 249 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 239 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 138px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-NUL"><svg class="railroad" viewbox="0 0 138 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-NUL">
<text class="comment" x="25" y="25">
NUL</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="35" y="42" />
<text x="69" y="58">
U+0000</text>
</g>
<path d=" M 113 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 103 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-input.intro"><a class="rule-link" href="#r-input.intro" title="input.intro"><span>[input<wbr>.intro]</span></a>
</div>

<p>本章描述了源文件如何被解释为词法单元序列。</p>
<p>有关程序如何组织成文件的描述，请参阅<a href="#crate与源文件">crate和源文件</a>。</p>
<div class="rule" id="r-input.encoding"><a class="rule-link" href="#r-input.encoding" title="input.encoding"><span>[input<wbr>.encoding]</span></a>
</div>

<h2 id="源文件编码"><a class="header" href="#源文件编码">源文件编码</a></h2>
<div class="rule" id="r-input.encoding.utf8"><a class="rule-link" href="#r-input.encoding.utf8" title="input.encoding.utf8"><span>[input<wbr>.encoding<wbr>.utf8]</span></a>
</div>

<p>每个源文件都被解释为以UTF-8编码的Unicode字符序列。</p>
<div class="rule" id="r-input.encoding.invalid"><a class="rule-link" href="#r-input.encoding.invalid" title="input.encoding.invalid"><span>[input<wbr>.encoding<wbr>.invalid]</span></a>
</div>

<p>如果文件不是有效的UTF-8，则会报错。</p>
<div class="rule" id="r-input.byte-order-mark"><a class="rule-link" href="#r-input.byte-order-mark" title="input.byte-order-mark"><span>[input<wbr>.byte-order-mark]</span></a>
</div>

<h2 id="字节序标记移除"><a class="header" href="#字节序标记移除">字节序标记移除</a></h2>
<p>如果序列中的第一个字符是<code>U+FEFF</code>（<a href="https://en.wikipedia.org/wiki/Byte_order_mark#UTF-8">字节序标记</a>），则将其移除。</p>
<div class="rule" id="r-input.crlf"><a class="rule-link" href="#r-input.crlf" title="input.crlf"><span>[input<wbr>.crlf]</span></a>
</div>

<h2 id="crlf规范化"><a class="header" href="#crlf规范化">CRLF规范化</a></h2>
<p>每对紧跟着<code>U+000A</code> (LF) 的<code>U+000D</code> (CR) 字符会被单个<code>U+000A</code> (LF) 替换。此操作只执行一次，不会重复，因此在规范化之后，输入中仍然可能存在紧跟着<code>U+000A</code> (LF) 的<code>U+000D</code> (CR)（例如，如果原始输入包含 “CR CR LF LF”）。</p>
<p>字符<code>U+000D</code> (CR) 的其他出现位置则保留不变（它们被视为<a href="#空白字符">空白符</a>）。</p>
<div class="rule" id="r-input.shebang"><a class="rule-link" href="#r-input.shebang" title="input.shebang"><span>[input<wbr>.shebang]</span></a>
</div>

<h2 id="shebang移除"><a class="header" href="#shebang移除">Shebang移除</a></h2>
<div class="rule" id="r-input.shebang.intro"><a class="rule-link" href="#r-input.shebang.intro" title="input.shebang.intro"><span>[input<wbr>.shebang<wbr>.intro]</span></a>
</div>

<p>如果剩余序列以字符<code>#!</code>开头，则从序列中移除直到（并包括）第一个<code>U+000A</code> (LF) 的所有字符。</p>
<p>例如，以下文件的第一行将被忽略：</p>
<!-- ignore: tests don't like shebang -->
<pre><code class="language-rust ignore">#!/usr/bin/env rustx

fn main() {
    println!("Hello!");
}</code></pre>
<div class="rule" id="r-input.shebang.inner-attribute"><a class="rule-link" href="#r-input.shebang.inner-attribute" title="input.shebang.inner-attribute"><span>[input<wbr>.shebang<wbr>.inner-attribute]</span></a>
</div>

<p>作为例外，如果<code>#!</code>字符后面紧跟着（忽略中间的<a href="#注释">注释</a>或<a href="#空白字符">空白符</a>）一个<code>[</code>词法单元，则不进行任何移除。这可以防止源文件开头的<a href="#属性-1">内部属性</a>被移除。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>标准库的<a href="../core/macro.include.html"><code>include!</code></a>宏会对其读取的文件进行字节序标记移除、CRLF规范化和Shebang移除。<a href="../core/macro.include_str.html"><code>include_str!</code></a>和<a href="../core/macro.include_bytes.html"><code>include_bytes!</code></a>宏则不会。</p>
</blockquote>
</div>

<div class="rule" id="r-input.tokenization"><a class="rule-link" href="#r-input.tokenization" title="input.tokenization"><span>[input<wbr>.tokenization]</span></a>
</div>

<h2 id="词法单元化"><a class="header" href="#词法单元化">词法单元化</a></h2>
<p>然后，所得的字符序列将转换为词法单元，具体描述见本章的其余部分。</p>
<div style="break-before: page; page-break-before: always;"></div><!-- https://github.com/rust-lang/reference/blob/master/src/keywords.md -->
<!-- commit 68bdfd15fa9feebfbf94a06cf574de598e239198 -->
<div class="rule" id="r-lex.keywords"><a class="rule-link" href="#r-lex.keywords" title="lex.keywords"><span>[lex<wbr>.keywords]</span></a>
</div>

<h1 id="关键字"><a class="header" href="#关键字">关键字</a></h1>
<p>Rust 将关键字分为三类：</p>
<ul>
<li><a href="#严格关键字">严格关键字</a></li>
<li><a href="#保留关键字">保留关键字</a></li>
<li><a href="#弱关键字">弱关键字</a></li>
</ul>
<div class="rule" id="r-lex.keywords.strict"><a class="rule-link" href="#r-lex.keywords.strict" title="lex.keywords.strict"><span>[lex<wbr>.keywords<wbr>.strict]</span></a>
</div>

<h2 id="严格关键字"><a class="header" href="#严格关键字">严格关键字</a></h2>
<div class="rule" id="r-lex.keywords.strict.intro"><a class="rule-link" href="#r-lex.keywords.strict.intro" title="lex.keywords.strict.intro"><span>[lex<wbr>.keywords<wbr>.strict<wbr>.intro]</span></a>
</div>

<p>这些关键字只能在其正确的上下文中使用。它们不能用作以下内容的名称：</p>
<ul>
<li><a href="#项">项</a></li>
<li><a href="#变量">变量</a>和函数参数</li>
<li>字段和<a href="#枚举">变体</a></li>
<li><a href="#类型参数">类型参数</a></li>
<li>生命周期参数或<a href="#loop-labels">循环标签</a></li>
<li><a href="#宏">宏</a>或<a href="#属性-1">属性</a></li>
<li><a href="#声明宏">宏占位符</a></li>
<li><a href="#crate与源文件">crate</a></li>
</ul>
<div class="rule" id="r-lex.keywords.strict.list"><a class="rule-link" href="#r-lex.keywords.strict.list" title="lex.keywords.strict.list"><span>[lex<wbr>.keywords<wbr>.strict<wbr>.list]</span></a>
</div>

<p>以下关键字在所有版次中都存在：</p>
<ul>
<li><code>_</code></li>
<li><code>as</code></li>
<li><code>async</code></li>
<li><code>await</code></li>
<li><code>break</code></li>
<li><code>const</code></li>
<li><code>continue</code></li>
<li><code>crate</code></li>
<li><code>dyn</code></li>
<li><code>else</code></li>
<li><code>enum</code></li>
<li><code>extern</code></li>
<li><code>false</code></li>
<li><code>fn</code></li>
<li><code>for</code></li>
<li><code>if</code></li>
<li><code>impl</code></li>
<li><code>in</code></li>
<li><code>let</code></li>
<li><code>loop</code></li>
<li><code>match</code></li>
<li><code>mod</code></li>
<li><code>move</code></li>
<li><code>mut</code></li>
<li><code>pub</code></li>
<li><code>ref</code></li>
<li><code>return</code></li>
<li><code>self</code></li>
<li><code>Self</code></li>
<li><code>static</code></li>
<li><code>struct</code></li>
<li><code>super</code></li>
<li><code>trait</code></li>
<li><code>true</code></li>
<li><code>type</code></li>
<li><code>unsafe</code></li>
<li><code>use</code></li>
<li><code>where</code></li>
<li><code>while</code></li>
</ul>
<div class="rule" id="r-lex.keywords.strict.edition2018"><a class="rule-link" href="#r-lex.keywords.strict.edition2018" title="lex.keywords.strict.edition2018"><span>[lex<wbr>.keywords<wbr>.strict<wbr>.edition2018]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p>以下关键字在 2018 版次中添加：</p>
<ul>
<li><code>async</code></li>
<li><code>await</code></li>
<li><code>dyn</code></li>
</ul>
</blockquote>
</div>

<div class="rule" id="r-lex.keywords.reserved"><a class="rule-link" href="#r-lex.keywords.reserved" title="lex.keywords.reserved"><span>[lex<wbr>.keywords<wbr>.reserved]</span></a>
</div>

<h2 id="保留关键字"><a class="header" href="#保留关键字">保留关键字</a></h2>
<div class="rule" id="r-lex.keywords.reserved.intro"><a class="rule-link" href="#r-lex.keywords.reserved.intro" title="lex.keywords.reserved.intro"><span>[lex<wbr>.keywords<wbr>.reserved<wbr>.intro]</span></a>
</div>

<p>这些关键字尚未投入使用，但已为将来保留。它们与严格关键字具有相同的限制。这样做的理由是通过禁止当前程序使用这些关键字，使其与 Rust 的未来版本向前兼容。</p>
<div class="rule" id="r-lex.keywords.reserved.list"><a class="rule-link" href="#r-lex.keywords.reserved.list" title="lex.keywords.reserved.list"><span>[lex<wbr>.keywords<wbr>.reserved<wbr>.list]</span></a>
</div>

<ul>
<li><code>abstract</code></li>
<li><code>become</code></li>
<li><code>box</code></li>
<li><code>do</code></li>
<li><code>final</code></li>
<li><code>gen</code></li>
<li><code>macro</code></li>
<li><code>override</code></li>
<li><code>priv</code></li>
<li><code>try</code></li>
<li><code>typeof</code></li>
<li><code>unsized</code></li>
<li><code>virtual</code></li>
<li><code>yield</code></li>
</ul>
<div class="rule" id="r-lex.keywords.reserved.edition2018"><a class="rule-link" href="#r-lex.keywords.reserved.edition2018" title="lex.keywords.reserved.edition2018"><span>[lex<wbr>.keywords<wbr>.reserved<wbr>.edition2018]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p><code>try</code>关键字在 2018 版次中作为保留关键字添加。</p>
</blockquote>
</div>

<div class="rule" id="r-lex.keywords.reserved.edition2024"><a class="rule-link" href="#r-lex.keywords.reserved.edition2024" title="lex.keywords.reserved.edition2024"><span>[lex<wbr>.keywords<wbr>.reserved<wbr>.edition2024]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2024</span> 版次差异</p>

<p><code>gen</code>关键字在 2024 版次中作为保留关键字添加。</p>
</blockquote>
</div>

<div class="rule" id="r-lex.keywords.weak"><a class="rule-link" href="#r-lex.keywords.weak" title="lex.keywords.weak"><span>[lex<wbr>.keywords<wbr>.weak]</span></a>
</div>

<h2 id="弱关键字"><a class="header" href="#弱关键字">弱关键字</a></h2>
<div class="rule" id="r-lex.keywords.weak.intro"><a class="rule-link" href="#r-lex.keywords.weak.intro" title="lex.keywords.weak.intro"><span>[lex<wbr>.keywords<wbr>.weak<wbr>.intro]</span></a>
</div>

<p>这些关键字仅在特定上下文中有特殊含义。例如，可以使用<code>union</code>这个名字声明一个变量或方法。</p>
<ul>
<li><code>'static</code></li>
<li><code>macro_rules</code></li>
<li><code>raw</code></li>
<li><code>safe</code></li>
<li><code>union</code></li>
</ul>
<div class="rule" id="r-lex.keywords.weak.macro_rules"><a class="rule-link" href="#r-lex.keywords.weak.macro_rules" title="lex.keywords.weak.macro_rules"><span>[lex<wbr>.keywords<wbr>.weak<wbr>.macro_rules]</span></a>
</div>

<ul>
<li><code>macro_rules</code>用于创建自定义<a href="#宏">宏</a>。</li>
</ul>
<div class="rule" id="r-lex.keywords.weak.union"><a class="rule-link" href="#r-lex.keywords.weak.union" title="lex.keywords.weak.union"><span>[lex<wbr>.keywords<wbr>.weak<wbr>.union]</span></a>
</div>

<ul>
<li><code>union</code>用于声明一个<a href="#联合体">联合体</a>，并且仅在联合体声明中使用时才作为关键字。</li>
</ul>
<div class="rule" id="r-lex.keywords.weak.lifetime-static"><a class="rule-link" href="#r-lex.keywords.weak.lifetime-static" title="lex.keywords.weak.lifetime-static"><span>[lex<wbr>.keywords<wbr>.weak<wbr>.lifetime-static]</span></a>
</div>

<ul>
<li>
<p><code>'static</code>用于静态生命周期，不能用作<a href="#泛型参数">泛型生命周期参数</a>或<a href="#loop-labels">循环标签</a></p>
<pre><code class="language-compile_fail">// error[E0262]: invalid lifetime parameter name: `'static`
fn invalid_lifetime_parameter&lt;'static&gt;(s: &amp;'static str) -&gt; &amp;'static str { s }
</code></pre>
</li>
</ul>
<div class="rule" id="r-lex.keywords.weak.safe"><a class="rule-link" href="#r-lex.keywords.weak.safe" title="lex.keywords.weak.safe"><span>[lex<wbr>.keywords<wbr>.weak<wbr>.safe]</span></a>
</div>

<ul>
<li><code>safe</code>用于函数和静态量，在<a href="#外部块">外部块</a>中有特殊含义。</li>
</ul>
<div class="rule" id="r-lex.keywords.weak.raw"><a class="rule-link" href="#r-lex.keywords.weak.raw" title="lex.keywords.weak.raw"><span>[lex<wbr>.keywords<wbr>.weak<wbr>.raw]</span></a>
</div>

<ul>
<li><code>raw</code>用于<a href="#raw-borrow-operators">原始借用运算符</a>，并且仅在匹配原始借用运算符形式（例如<code>&amp;raw const expr</code>或<code>&amp;raw mut expr</code>）时才作为关键字。</li>
</ul>
<div class="rule" id="r-lex.keywords.weak.dyn.edition2018"><a class="rule-link" href="#r-lex.keywords.weak.dyn.edition2018" title="lex.keywords.weak.dyn.edition2018"><span>[lex<wbr>.keywords<wbr>.weak<wbr>.dyn<wbr>.edition2018]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p>在 2015 版次中，<a href="#特型对象"><code>dyn</code></a>在类型位置后跟不以<code>::</code>或<code>&lt;</code>开头的路径、生命周期、问号、<code>for</code>关键字或左括号时是一个关键字。</p>
<p>从 2018 版次开始，<code>dyn</code>已被提升为严格关键字。</p>
</blockquote>
</div>

<div style="break-before: page; page-break-before: always;"></div><!-- https://github.com/rust-lang/reference/blob/master/src/identifiers.md -->
<!-- commit 68bdfd15fa9feebfbf94a06cf574de598e239198 -->
<div class="rule" id="r-ident"><a class="rule-link" href="#r-ident" title="ident"><span>[ident]</span></a>
</div>

<h1 id="标识符"><a class="header" href="#标识符">标识符</a></h1>
<div class="rule" id="r-ident.syntax"><a class="rule-link" href="#r-ident.syntax" title="ident.syntax"><span>[ident<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-IDENTIFIER_OR_KEYWORD" onclick="show_railroad()"><a href="#railroad-IDENTIFIER_OR_KEYWORD">IDENTIFIER_OR_KEYWORD</a></span> → ( <span class="grammar-text"><a href="#grammar-XID_Start">XID_Start</a></span> | <span class="grammar-literal">_</span> ) <span class="grammar-text"><a href="#grammar-XID_Continue">XID_Continue</a></span><sup>*</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-XID_Start" onclick="show_railroad()"><a href="#railroad-XID_Start">XID_Start</a></span> → <span class="grammar-text">&lt;<code>XID_Start</code> defined by Unicode&gt;</span></p>
<p><span class="grammar-text grammar-production" id="grammar-XID_Continue" onclick="show_railroad()"><a href="#railroad-XID_Continue">XID_Continue</a></span> → <span class="grammar-text">&lt;<code>XID_Continue</code> defined by Unicode&gt;</span></p>
<p><span class="grammar-text grammar-production" id="grammar-RAW_IDENTIFIER" onclick="show_railroad()"><a href="#railroad-RAW_IDENTIFIER">RAW_IDENTIFIER</a></span> → <span class="grammar-literal">r#</span> <span class="grammar-text"><a href="#grammar-IDENTIFIER_OR_KEYWORD">IDENTIFIER_OR_KEYWORD</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-NON_KEYWORD_IDENTIFIER" onclick="show_railroad()"><a href="#railroad-NON_KEYWORD_IDENTIFIER">NON_KEYWORD_IDENTIFIER</a></span> → <span class="grammar-text"><a href="#grammar-IDENTIFIER_OR_KEYWORD">IDENTIFIER_OR_KEYWORD</a></span><sub class="grammar-text">except a <a href="#r-lex.keywords.strict">strict</a> or <a href="#r-lex.keywords.reserved">reserved</a> keyword</sub></p>
<p><span class="grammar-text grammar-production" id="grammar-IDENTIFIER" onclick="show_railroad()"><a href="#railroad-IDENTIFIER">IDENTIFIER</a></span> → <span class="grammar-text"><a href="#grammar-NON_KEYWORD_IDENTIFIER">NON_KEYWORD_IDENTIFIER</a></span> | <span class="grammar-text"><a href="#grammar-RAW_IDENTIFIER">RAW_IDENTIFIER</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-RESERVED_RAW_IDENTIFIER" onclick="show_railroad()"><a href="#railroad-RESERVED_RAW_IDENTIFIER">RESERVED_RAW_IDENTIFIER</a></span> → <br>    <span class="grammar-literal">r#</span> ( <span class="grammar-literal">_</span> | <span class="grammar-literal">crate</span> | <span class="grammar-literal">self</span> | <span class="grammar-literal">Self</span> | <span class="grammar-literal">super</span> )<sub class="grammar-text">not immediately followed by XID_Continue</sub></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 408px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-IDENTIFIER_OR_KEYWORD"><svg class="railroad" viewbox="0 0 408 120" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-IDENTIFIER_OR_KEYWORD">
<text class="comment" x="92" y="25">
IDENTIFIER_OR_KEYWORD</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="choice">
<path d=" M 35 66 h 24 m 92 0 h 24" />
<a class="link" xlink:href="#railroad-XID_Start">
<g class="nonterminal">
<rect height="22" width="92" x="59" y="55" />
<text x="105" y="71">
XID_Start</text>
</g>
</a>
<path d=" M 35 66 a 12 12 0 0 1 12 12 v 9 m 116 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 87 v 0 a 12 12 0 0 0 12 12 m 28 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="88" />
<text x="73" y="104">
_</text>
</g>
</g>
<g class="optional">
<path d=" M 185 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 140 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 209 66 h 12 m 116 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -116 m 61 0 l 5 -5 m 0 10 l -5 -5 m -61 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-XID_Continue">
<g class="nonterminal">
<rect height="22" width="116" x="221" y="55" />
<text x="279" y="71">
XID_Continue</text>
</g>
</a>
</g>
</g>
<path d=" M 175 66 h 10" />
</g>
<path d=" M 383 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 373 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 338px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-XID_Start"><svg class="railroad" viewbox="0 0 338 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-XID_Start">
<text class="comment" x="46" y="25">
XID_Start</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="268" x="35" y="42" />
<text x="169" y="58">
`XID_Start` defined by Unicode</text>
</g>
<path d=" M 313 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 303 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 362px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-XID_Continue"><svg class="railroad" viewbox="0 0 362 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-XID_Continue">
<text class="comment" x="57" y="25">
XID_Continue</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="292" x="35" y="42" />
<text x="181" y="58">
`XID_Continue` defined by Unicode</text>
</g>
<path d=" M 337 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 327 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 312px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RAW_IDENTIFIER"><svg class="railroad" viewbox="0 0 312 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RAW_IDENTIFIER">
<text class="comment" x="64" y="25">
RAW_IDENTIFIER</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="42" />
<text x="53" y="58">
r#</text>
</g>
<a class="link" xlink:href="#railroad-IDENTIFIER_OR_KEYWORD">
<g class="nonterminal">
<rect height="22" width="196" x="81" y="42" />
<text x="179" y="58">
IDENTIFIER_OR_KEYWORD</text>
</g>
</a>
<path d=" M 71 53 h 10" />
</g>
<path d=" M 287 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 277 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 348px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-NON_KEYWORD_IDENTIFIER"><svg class="railroad" viewbox="0 0 348 118" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-NON_KEYWORD_IDENTIFIER">
<text class="comment" x="95" y="25">
NON_KEYWORD_IDENTIFIER</text>
</a>
<g class="sequence">
<path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="labeledbox">
<rect height="66" width="278" x="35" y="42" />
<path d=" M 35 89 h 8 m 196 0 h 74 m -34 0 l -5 -5 m 0 10 l 5 -5 m 34 0" />
<text class="comment" x="174" y="65">
except a strict or reserved keyword</text>
<a class="link" xlink:href="#railroad-IDENTIFIER_OR_KEYWORD">
<g class="nonterminal">
<rect height="22" width="196" x="43" y="78" />
<text x="141" y="94">
IDENTIFIER_OR_KEYWORD</text>
</g>
</a>
</g>
<path d=" M 323 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 89 h 10" />
<path d=" M 313 89 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 322px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-IDENTIFIER"><svg class="railroad" viewbox="0 0 322 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-IDENTIFIER">
<text class="comment" x="50" y="25">
IDENTIFIER</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 204 0 h 24" />
<a class="link" xlink:href="#railroad-NON_KEYWORD_IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="204" x="59" y="42" />
<text x="161" y="58">
NON_KEYWORD_IDENTIFIER</text>
</g>
</a>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 228 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 132 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-RAW_IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="132" x="59" y="75" />
<text x="125" y="91">
RAW_IDENTIFIER</text>
</g>
</a>
</g>
<path d=" M 297 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 287 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 436px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RESERVED_RAW_IDENTIFIER"><svg class="railroad" viewbox="0 0 436 250" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RESERVED_RAW_IDENTIFIER">
<text class="comment" x="99" y="25">
RESERVED_RAW_IDENTIFIER</text>
</a>
<g class="sequence">
<path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="78" />
<text x="53" y="94">
r#</text>
</g>
<g class="labeledbox">
<rect height="198" width="320" x="81" y="42" />
<path d=" M 81 89 h 8 m 108 0 h 204 m -99 0 l -5 -5 m 0 10 l 5 -5 m 99 0" />
<text class="comment" x="241" y="65">
not immediately followed by XID_Continue</text>
<g class="choice">
<path d=" M 89 89 h 24 m 28 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="113" y="78" />
<text x="127" y="94">
_</text>
</g>
<path d=" M 89 89 a 12 12 0 0 1 12 12 v 9 m 84 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 101 110 v 33 m 84 0 v -33" />
<path d=" M 101 143 v 33 m 84 0 v -33" />
<path d=" M 101 176 v 33 m 84 0 v -33" />
<path d=" M 101 110 v 0 a 12 12 0 0 0 12 12 m 60 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="113" y="111" />
<text x="143" y="127">
crate</text>
</g>
<path d=" M 101 143 v 0 a 12 12 0 0 0 12 12 m 52 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="113" y="144" />
<text x="139" y="160">
self</text>
</g>
<path d=" M 101 176 v 0 a 12 12 0 0 0 12 12 m 52 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="113" y="177" />
<text x="139" y="193">
Self</text>
</g>
<path d=" M 101 209 v 0 a 12 12 0 0 0 12 12 m 60 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="113" y="210" />
<text x="143" y="226">
super</text>
</g>
</g>
</g>
<path d=" M 71 89 h 10" />
</g>
<path d=" M 411 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 89 h 10" />
<path d=" M 401 89 h 10" />
</g>
</g>
</svg>
</div>

</div>

<!-- When updating the version, update the UAX links, too. -->
<div class="rule" id="r-ident.unicode"><a class="rule-link" href="#r-ident.unicode" title="ident.unicode"><span>[ident<wbr>.unicode]</span></a>
</div>

<p>标识符遵循<a href="https://www.unicode.org/reports/tr31/tr31-41.html">Unicode标准附件#31</a>中针对Unicode 16.0版的规范，并增加了下述内容。一些标识符的例子：</p>
<ul>
<li><code>foo</code></li>
<li><code>_identifier</code></li>
<li><code>r#true</code></li>
<li><code>Москва</code></li>
<li><code>東京</code></li>
</ul>
<div class="rule" id="r-ident.profile"><a class="rule-link" href="#r-ident.profile" title="ident.profile"><span>[ident<wbr>.profile]</span></a>
</div>

<p>UAX #31中使用的概要是：</p>
<ul>
<li>Start := <a href="http://unicode.org/cldr/utility/list-unicodeset.jsp?a=%5B%3AXID_Start%3A%5D&amp;abb=on&amp;g=&amp;i="><code>XID_Start</code></a>，加上下划线字符(U+005F)</li>
<li>Continue := <a href="http://unicode.org/cldr/utility/list-unicodeset.jsp?a=%5B%3AXID_Continue%3A%5D&amp;abb=on&amp;g=&amp;i="><code>XID_Continue</code></a></li>
<li>Medial := 空</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>以<code>_</code>开头的标识符通常用于表明一个有意不使用的标识符，并且会消除<code>rustc</code>中的未使用警告。</p>
</blockquote>
</div>

<div class="rule" id="r-ident.keyword"><a class="rule-link" href="#r-ident.keyword" title="ident.keyword"><span>[ident<wbr>.keyword]</span></a>
</div>

<p>标识符不能是<a href="#严格关键字">严格</a>或<a href="#保留关键字">保留</a>关键字，除非带上下述<a href="#raw-identifiers">原始标识符</a>中描述的<code>r#</code>前缀。</p>
<div class="rule" id="r-ident.zero-width-chars"><a class="rule-link" href="#r-ident.zero-width-chars" title="ident.zero-width-chars"><span>[ident<wbr>.zero-width-chars]</span></a>
</div>

<p>零宽不连接符(ZWNJ U+200C)和零宽连接符(ZWJ U+200D)字符不允许出现在标识符中。</p>
<div class="rule" id="r-ident.ascii-limitations"><a class="rule-link" href="#r-ident.ascii-limitations" title="ident.ascii-limitations"><span>[ident<wbr>.ascii-limitations]</span></a>
</div>

<p>在以下情况，标识符被限制为<a href="http://unicode.org/cldr/utility/list-unicodeset.jsp?a=%5B%3AXID_Start%3A%5D&amp;abb=on&amp;g=&amp;i="><code>XID_Start</code></a>和<a href="http://unicode.org/cldr/utility/list-unicodeset.jsp?a=%5B%3AXID_Continue%3A%5D&amp;abb=on&amp;g=&amp;i="><code>XID_Continue</code></a>的ASCII子集：</p>
<ul>
<li><a href="#extern-crate-声明"><code>extern crate</code></a>声明（除了<a href="#grammar-AsClause">AsClause</a>标识符）</li>
<li>在<a href="#路径">路径</a>中引用的外部crate名</li>
<li>从文件系统加载而不带<a href="#the-path-attribute"><code>path</code>属性</a>的<a href="#模块">模块</a>名</li>
<li>带有<a href="#the-no_mangle-attribute"><code>no_mangle</code></a>属性的项</li>
<li><a href="#外部块">外部块</a>中的项名</li>
</ul>
<div class="rule" id="r-ident.normalization"><a class="rule-link" href="#r-ident.normalization" title="ident.normalization"><span>[ident<wbr>.normalization]</span></a>
</div>

<h2 id="规范化"><a class="header" href="#规范化">规范化</a></h2>
<p>标识符使用规范化形式 C (NFC) 进行规范化，如<a href="https://www.unicode.org/reports/tr15/tr15-56.html">Unicode标准附件#15</a>中所定义。两个标识符在它们的 NFC 形式相等时才相等。</p>
<p><a href="#过程宏">过程</a>宏和<a href="#声明宏">声明式</a>宏在它们的输入中接收规范化的标识符。</p>
<div class="rule" id="r-ident.raw"><a class="rule-link" href="#r-ident.raw" title="ident.raw"><span>[ident<wbr>.raw]</span></a>
</div>

<h2 id="原始标识符"><a class="header" href="#原始标识符">原始标识符</a></h2>
<div class="rule" id="r-ident.raw.intro"><a class="rule-link" href="#r-ident.raw.intro" title="ident.raw.intro"><span>[ident<wbr>.raw<wbr>.intro]</span></a>
</div>

<p>原始标识符类似于普通标识符，但带有<code>r#</code>前缀。（请注意，<code>r#</code>前缀不作为实际标识符的一部分。）</p>
<div class="rule" id="r-ident.raw.allowed"><a class="rule-link" href="#r-ident.raw.allowed" title="ident.raw.allowed"><span>[ident<wbr>.raw<wbr>.allowed]</span></a>
</div>

<p>与普通标识符不同，原始标识符可以是任何<a href="#严格关键字">严格</a>或<a href="#保留关键字">保留</a>关键字，除了上面为<code>RAW_IDENTIFIER</code>列出的那些。</p>
<div class="rule" id="r-ident.raw.reserved"><a class="rule-link" href="#r-ident.raw.reserved" title="ident.raw.reserved"><span>[ident<wbr>.raw<wbr>.reserved]</span></a>
</div>

<p>使用<a href="#grammar-RESERVED_RAW_IDENTIFIER">RESERVED_RAW_IDENTIFIER</a>词法单元是错误的。</p>
<div style="break-before: page; page-break-before: always;"></div><!-- https://github.com/rust-lang/reference/blob/master/src/comments.md -->
<!-- commit 68bdfd15fa9feebfbf94a06cf574de598e239198 -->
<div class="rule" id="r-comments"><a class="rule-link" href="#r-comments" title="comments"><span>[comments]</span></a>
</div>

<h1 id="注释"><a class="header" href="#注释">注释</a></h1>
<div class="rule" id="r-comments.syntax"><a class="rule-link" href="#r-comments.syntax" title="comments.syntax"><span>[comments<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-LINE_COMMENT" onclick="show_railroad()"><a href="#railroad-LINE_COMMENT">LINE_COMMENT</a></span> → <br>      <span class="grammar-literal">//</span> ( ~[<span class="grammar-literal">/</span> <span class="grammar-literal">!</span> <a href="#grammar-LF">LF</a>] | <span class="grammar-literal">//</span> ) ~<span class="grammar-text"><a href="#grammar-LF">LF</a></span><sup>*</sup> <br>    | <span class="grammar-literal">//</span></p>
<p><span class="grammar-text grammar-production" id="grammar-BLOCK_COMMENT" onclick="show_railroad()"><a href="#railroad-BLOCK_COMMENT">BLOCK_COMMENT</a></span> → <br>      <span class="grammar-literal">/*</span> <br>        ( ~[<span class="grammar-literal">*</span> <span class="grammar-literal">!</span>] | <span class="grammar-literal">**</span> | <span class="grammar-text"><a href="#grammar-BLOCK_COMMENT_OR_DOC">BLOCK_COMMENT_OR_DOC</a></span> ) <br>        ( <span class="grammar-text"><a href="#grammar-BLOCK_COMMENT_OR_DOC">BLOCK_COMMENT_OR_DOC</a></span> | ~<span class="grammar-literal">*/</span> )<sup>*</sup> <br>      <span class="grammar-literal">*/</span> <br>    | <span class="grammar-literal">/**/</span> <br>    | <span class="grammar-literal">/***/</span></p>
<p><span class="grammar-text grammar-production" id="grammar-INNER_LINE_DOC" onclick="show_railroad()"><a href="#railroad-INNER_LINE_DOC">INNER_LINE_DOC</a></span> → <br>    <span class="grammar-literal">//!</span> ~[<a href="#grammar-LF">LF</a> <a href="#grammar-CR">CR</a>]<sup>*</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-INNER_BLOCK_DOC" onclick="show_railroad()"><a href="#railroad-INNER_BLOCK_DOC">INNER_BLOCK_DOC</a></span> → <br>    <span class="grammar-literal">/*!</span> ( <span class="grammar-text"><a href="#grammar-BLOCK_COMMENT_OR_DOC">BLOCK_COMMENT_OR_DOC</a></span> | ~[<span class="grammar-literal">*/</span> <a href="#grammar-CR">CR</a>] )<sup>*</sup> <span class="grammar-literal">*/</span></p>
<p><span class="grammar-text grammar-production" id="grammar-OUTER_LINE_DOC" onclick="show_railroad()"><a href="#railroad-OUTER_LINE_DOC">OUTER_LINE_DOC</a></span> → <br>    <span class="grammar-literal">///</span> ( ~<span class="grammar-literal">/</span> ~[<a href="#grammar-LF">LF</a> <a href="#grammar-CR">CR</a>]<sup>*</sup> )<sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-OUTER_BLOCK_DOC" onclick="show_railroad()"><a href="#railroad-OUTER_BLOCK_DOC">OUTER_BLOCK_DOC</a></span> → <br>    <span class="grammar-literal">/**</span> <br>      ( ~<span class="grammar-literal">*</span> | <span class="grammar-text"><a href="#grammar-BLOCK_COMMENT_OR_DOC">BLOCK_COMMENT_OR_DOC</a></span> ) <br>      ( <span class="grammar-text"><a href="#grammar-BLOCK_COMMENT_OR_DOC">BLOCK_COMMENT_OR_DOC</a></span> | ~[<span class="grammar-literal">*/</span> <a href="#grammar-CR">CR</a>] )<sup>*</sup> <br>    <span class="grammar-literal">*/</span></p>
<p><span class="grammar-text grammar-production" id="grammar-BLOCK_COMMENT_OR_DOC" onclick="show_railroad()"><a href="#railroad-BLOCK_COMMENT_OR_DOC">BLOCK_COMMENT_OR_DOC</a></span> → <br>      <span class="grammar-text"><a href="#grammar-BLOCK_COMMENT">BLOCK_COMMENT</a></span> <br>    | <span class="grammar-text"><a href="#grammar-OUTER_BLOCK_DOC">OUTER_BLOCK_DOC</a></span> <br>    | <span class="grammar-text"><a href="#grammar-INNER_BLOCK_DOC">INNER_BLOCK_DOC</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 696px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-LINE_COMMENT"><svg class="railroad" viewbox="0 0 696 284" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-LINE_COMMENT">
<text class="comment" x="57" y="25">
LINE_COMMENT</text>
</a>
<g class="sequence">
<path d=" M 10 189 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 189 h 24 m 578 0 h 24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="178" />
<text x="77" y="194">
//</text>
</g>
<g class="choice">
<path d=" M 105 189 h 24 m 201 0 h 24" />
<g class="labeledbox exceptbox">
<rect height="166" width="201" x="129" y="42" />
<path d=" M 129 189 h 8 m 52 0 h 141 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0" />
<g class="verticalgrid">
<text class="comment" x="229" y="65">
⚠️ with the exception of</text>
<g class="choice">
<path d=" M 137 93 h 24 m 28 0 h 32" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="161" y="82" />
<text x="175" y="98">
/</text>
</g>
<path d=" M 137 93 a 12 12 0 0 1 12 12 v 9 m 60 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 149 114 v 33 m 60 0 v -33" />
<path d=" M 149 114 v 0 a 12 12 0 0 0 12 12 m 28 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="161" y="115" />
<text x="175" y="131">
!</text>
</g>
<path d=" M 149 147 v 0 a 12 12 0 0 0 12 12 m 36 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-LF">
<g class="nonterminal">
<rect height="22" width="36" x="161" y="148" />
<text x="179" y="164">
LF</text>
</g>
</a>
</g>
</g>
<a class="link" xlink:href="#railroad-CHAR">
<g class="nonterminal">
<rect height="22" width="52" x="137" y="178" />
<text x="163" y="194">
CHAR</text>
</g>
</a>
</g>
<path d=" M 105 189 a 12 12 0 0 1 12 12 v 17 m 225 0 v -17 a 12 12 0 0 1 12 -12" />
<path d=" M 117 218 v 0 a 12 12 0 0 0 12 12 m 36 0 h 165 m -79 0 l -5 -5 m 0 10 l 5 -5 m 79 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="129" y="219" />
<text x="147" y="235">
//</text>
</g>
</g>
<g class="optional">
<path d=" M 364 189 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -69 m 0 37 l -5 5 m 10 0 l -5 -5 m 0 -37 a 12 12 0 0 1 12 -12 h 225 m -109 0 l -5 -5 m 0 10 l 5 -5 m 109 0 a 12 12 0 0 1 12 12 v 69 m 0 -31 l -5 -5 m 10 0 l -5 5 m 0 31 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 388 189 h 12 m 201 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 5 a 12 12 0 0 1 -12 12 m 0 0 h -201 m 103 0 l 5 -5 m 0 10 l -5 -5 m -103 0 a 12 12 0 0 1 -12 -12 v -5 a 12 12 0 0 1 12 -12" />
<g />
<g class="labeledbox exceptbox">
<rect height="100" width="201" x="400" y="108" />
<path d=" M 400 189 h 8 m 52 0 h 141 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0" />
<g class="verticalgrid">
<text class="comment" x="500" y="131">
⚠️ with the exception of</text>
<a class="link" xlink:href="#railroad-LF">
<g class="nonterminal">
<rect height="22" width="36" x="408" y="148" />
<text x="426" y="164">
LF</text>
</g>
</a>
</g>
<a class="link" xlink:href="#railroad-CHAR">
<g class="nonterminal">
<rect height="22" width="52" x="408" y="178" />
<text x="434" y="194">
CHAR</text>
</g>
</a>
</g>
</g>
</g>
<path d=" M 95 189 h 10" />
<path d=" M 354 189 h 10" />
</g>
<path d=" M 35 189 a 12 12 0 0 1 12 12 v 50 m 602 0 v -50 a 12 12 0 0 1 12 -12" />
<path d=" M 47 251 v 0 a 12 12 0 0 0 12 12 m 36 0 h 542 m -268 0 l -5 -5 m 0 10 l 5 -5 m 268 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="252" />
<text x="77" y="268">
//</text>
</g>
</g>
<path d=" M 671 189 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 189 h 10" />
<path d=" M 661 189 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 790px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-BLOCK_COMMENT"><svg class="railroad" viewbox="0 0 790 363" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-BLOCK_COMMENT">
<text class="comment" x="60" y="25">
BLOCK_COMMENT</text>
</a>
<g class="sequence">
<path d=" M 10 156 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 156 h 24 m 672 0 h 24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="145" />
<text x="77" y="161">
/*</text>
</g>
<g class="choice">
<path d=" M 105 156 h 24 m 201 0 h 24" />
<g class="labeledbox exceptbox">
<rect height="133" width="201" x="129" y="42" />
<path d=" M 129 156 h 8 m 52 0 h 141 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0" />
<g class="verticalgrid">
<text class="comment" x="229" y="65">
⚠️ with the exception of</text>
<g class="choice">
<path d=" M 137 93 h 24 m 28 0 h 24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="161" y="82" />
<text x="175" y="98">
*</text>
</g>
<path d=" M 137 93 a 12 12 0 0 1 12 12 v 9 m 52 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 149 114 v 0 a 12 12 0 0 0 12 12 m 28 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="161" y="115" />
<text x="175" y="131">
!</text>
</g>
</g>
</g>
<a class="link" xlink:href="#railroad-CHAR">
<g class="nonterminal">
<rect height="22" width="52" x="137" y="145" />
<text x="163" y="161">
CHAR</text>
</g>
</a>
</g>
<path d=" M 105 156 a 12 12 0 0 1 12 12 v 17 m 225 0 v -17 a 12 12 0 0 1 12 -12" />
<path d=" M 117 185 v 33 m 225 0 v -33" />
<path d=" M 117 185 v 0 a 12 12 0 0 0 12 12 m 36 0 h 165 m -79 0 l -5 -5 m 0 10 l 5 -5 m 79 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="129" y="186" />
<text x="147" y="202">
**</text>
</g>
<path d=" M 117 218 v 0 a 12 12 0 0 0 12 12 m 188 0 h 13 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-BLOCK_COMMENT_OR_DOC">
<g class="nonterminal">
<rect height="22" width="188" x="129" y="219" />
<text x="223" y="235">
BLOCK_COMMENT_OR_DOC</text>
</g>
</a>
</g>
<g class="optional">
<path d=" M 364 156 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 273 m -133 0 l -5 -5 m 0 10 l 5 -5 m 133 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 388 156 h 12 m 249 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 107 m 0 -50 l -5 -5 m 10 0 l -5 5 m 0 50 a 12 12 0 0 1 -12 12 m 0 0 h -249 m 127 0 l 5 -5 m 0 10 l -5 -5 m -127 0 a 12 12 0 0 1 -12 -12 v -107 m 0 56 l -5 5 m 10 0 l -5 -5 m 0 -56 a 12 12 0 0 1 12 -12" />
<g />
<g class="choice">
<path d=" M 400 156 h 24 m 188 0 h 37" />
<a class="link" xlink:href="#railroad-BLOCK_COMMENT_OR_DOC">
<g class="nonterminal">
<rect height="22" width="188" x="424" y="145" />
<text x="518" y="161">
BLOCK_COMMENT_OR_DOC</text>
</g>
</a>
<path d=" M 400 156 a 12 12 0 0 1 12 12 v 9 m 225 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 412 177 v 69 m 0 -31 l -5 -5 m 10 0 l -5 5 m 0 31 a 12 12 0 0 0 12 12 m 201 0 h 0 a 12 12 0 0 0 12 -12 v -69 m 0 37 l -5 5 m 10 0 l -5 -5 m 0 -37" />
<g class="labeledbox exceptbox">
<rect height="100" width="201" x="424" y="177" />
<path d=" M 424 258 h 8 m 52 0 h 141 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0" />
<g class="verticalgrid">
<text class="comment" x="524" y="200">
⚠️ with the exception of</text>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="432" y="217" />
<text x="450" y="233">
*/</text>
</g>
</g>
<a class="link" xlink:href="#railroad-CHAR">
<g class="nonterminal">
<rect height="22" width="52" x="432" y="247" />
<text x="458" y="263">
CHAR</text>
</g>
</a>
</g>
</g>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="695" y="145" />
<text x="713" y="161">
*/</text>
</g>
<path d=" M 95 156 h 10" />
<path d=" M 354 156 h 10" />
<path d=" M 685 156 h 10" />
</g>
<path d=" M 35 156 a 12 12 0 0 1 12 12 v 129 m 0 -61 l -5 -5 m 10 0 l -5 5 m 0 61 m 696 0 v -129 m 0 67 l -5 5 m 10 0 l -5 -5 m 0 -67 a 12 12 0 0 1 12 -12" />
<path d=" M 47 297 v 33 m 696 0 v -33" />
<path d=" M 47 297 v 0 a 12 12 0 0 0 12 12 m 52 0 h 620 m -307 0 l -5 -5 m 0 10 l 5 -5 m 307 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="298" />
<text x="85" y="314">
/**/</text>
</g>
</g>
<path d=" M 47 330 v 0 a 12 12 0 0 0 12 12 m 60 0 h 612 m -303 0 l -5 -5 m 0 10 l 5 -5 m 303 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="59" y="331" />
<text x="89" y="347">
/***/</text>
</g>
</g>
<path d=" M 765 156 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 156 h 10" />
<path d=" M 755 156 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 397px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-INNER_LINE_DOC"><svg class="railroad" viewbox="0 0 397 207" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-INNER_LINE_DOC">
<text class="comment" x="64" y="25">
INNER_LINE_DOC</text>
</a>
<g class="sequence">
<path d=" M 10 168 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="157" />
<text x="57" y="173">
//!</text>
</g>
<g class="optional">
<path d=" M 89 168 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -102 m 0 54 l -5 5 m 10 0 l -5 -5 m 0 -54 a 12 12 0 0 1 12 -12 h 225 m -109 0 l -5 -5 m 0 10 l 5 -5 m 109 0 a 12 12 0 0 1 12 12 v 102 m 0 -48 l -5 -5 m 10 0 l -5 5 m 0 48 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 113 168 h 12 m 201 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 5 a 12 12 0 0 1 -12 12 m 0 0 h -201 m 103 0 l 5 -5 m 0 10 l -5 -5 m -103 0 a 12 12 0 0 1 -12 -12 v -5 a 12 12 0 0 1 12 -12" />
<g />
<g class="labeledbox exceptbox">
<rect height="133" width="201" x="125" y="54" />
<path d=" M 125 168 h 8 m 52 0 h 141 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0" />
<g class="verticalgrid">
<text class="comment" x="225" y="77">
⚠️ with the exception of</text>
<g class="choice">
<path d=" M 133 105 h 24 m 36 0 h 24" />
<a class="link" xlink:href="#railroad-LF">
<g class="nonterminal">
<rect height="22" width="36" x="157" y="94" />
<text x="175" y="110">
LF</text>
</g>
</a>
<path d=" M 133 105 a 12 12 0 0 1 12 12 v 9 m 60 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 145 126 v 0 a 12 12 0 0 0 12 12 m 36 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-CR">
<g class="nonterminal">
<rect height="22" width="36" x="157" y="127" />
<text x="175" y="143">
CR</text>
</g>
</a>
</g>
</g>
<a class="link" xlink:href="#railroad-CHAR">
<g class="nonterminal">
<rect height="22" width="52" x="133" y="157" />
<text x="159" y="173">
CHAR</text>
</g>
</a>
</g>
</g>
</g>
<path d=" M 79 168 h 10" />
</g>
<path d=" M 372 168 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 168 h 10" />
<path d=" M 362 168 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 491px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-INNER_BLOCK_DOC"><svg class="railroad" viewbox="0 0 491 240" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-INNER_BLOCK_DOC">
<text class="comment" x="67" y="25">
INNER_BLOCK_DOC</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="55" />
<text x="57" y="71">
/*!</text>
</g>
<g class="optional">
<path d=" M 89 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 273 m -133 0 l -5 -5 m 0 10 l 5 -5 m 133 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 113 66 h 12 m 249 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 140 m 0 -67 l -5 -5 m 10 0 l -5 5 m 0 67 a 12 12 0 0 1 -12 12 m 0 0 h -249 m 127 0 l 5 -5 m 0 10 l -5 -5 m -127 0 a 12 12 0 0 1 -12 -12 v -140 m 0 73 l -5 5 m 10 0 l -5 -5 m 0 -73 a 12 12 0 0 1 12 -12" />
<g />
<g class="choice">
<path d=" M 125 66 h 24 m 188 0 h 37" />
<a class="link" xlink:href="#railroad-BLOCK_COMMENT_OR_DOC">
<g class="nonterminal">
<rect height="22" width="188" x="149" y="55" />
<text x="243" y="71">
BLOCK_COMMENT_OR_DOC</text>
</g>
</a>
<path d=" M 125 66 a 12 12 0 0 1 12 12 v 9 m 225 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 137 87 v 102 m 0 -48 l -5 -5 m 10 0 l -5 5 m 0 48 a 12 12 0 0 0 12 12 m 201 0 h 0 a 12 12 0 0 0 12 -12 v -102 m 0 54 l -5 5 m 10 0 l -5 -5 m 0 -54" />
<g class="labeledbox exceptbox">
<rect height="133" width="201" x="149" y="87" />
<path d=" M 149 201 h 8 m 52 0 h 141 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0" />
<g class="verticalgrid">
<text class="comment" x="249" y="110">
⚠️ with the exception of</text>
<g class="choice">
<path d=" M 157 138 h 24 m 36 0 h 24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="181" y="127" />
<text x="199" y="143">
*/</text>
</g>
<path d=" M 157 138 a 12 12 0 0 1 12 12 v 9 m 60 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 169 159 v 0 a 12 12 0 0 0 12 12 m 36 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-CR">
<g class="nonterminal">
<rect height="22" width="36" x="181" y="160" />
<text x="199" y="176">
CR</text>
</g>
</a>
</g>
</g>
<a class="link" xlink:href="#railroad-CHAR">
<g class="nonterminal">
<rect height="22" width="52" x="157" y="190" />
<text x="183" y="206">
CHAR</text>
</g>
</a>
</g>
</g>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="420" y="55" />
<text x="438" y="71">
*/</text>
</g>
<path d=" M 79 66 h 10" />
<path d=" M 410 66 h 10" />
</g>
<path d=" M 466 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 456 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 656px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-OUTER_LINE_DOC"><svg class="railroad" viewbox="0 0 656 219" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-OUTER_LINE_DOC">
<text class="comment" x="64" y="25">
OUTER_LINE_DOC</text>
</a>
<g class="sequence">
<path d=" M 10 180 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="169" />
<text x="57" y="185">
///</text>
</g>
<g class="optional">
<path d=" M 89 180 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -114 m 0 60 l -5 5 m 10 0 l -5 -5 m 0 -60 a 12 12 0 0 1 12 -12 h 484 m -239 0 l -5 -5 m 0 10 l 5 -5 m 239 0 a 12 12 0 0 1 12 12 v 114 m 0 -54 l -5 -5 m 10 0 l -5 5 m 0 54 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="labeledbox exceptbox">
<rect height="100" width="201" x="113" y="99" />
<path d=" M 113 180 h 8 m 52 0 h 141 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0" />
<g class="verticalgrid">
<text class="comment" x="213" y="122">
⚠️ with the exception of</text>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="121" y="139" />
<text x="135" y="155">
/</text>
</g>
</g>
<a class="link" xlink:href="#railroad-CHAR">
<g class="nonterminal">
<rect height="22" width="52" x="121" y="169" />
<text x="147" y="185">
CHAR</text>
</g>
</a>
</g>
<g class="optional">
<path d=" M 324 180 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -102 m 0 54 l -5 5 m 10 0 l -5 -5 m 0 -54 a 12 12 0 0 1 12 -12 h 225 m -109 0 l -5 -5 m 0 10 l 5 -5 m 109 0 a 12 12 0 0 1 12 12 v 102 m 0 -48 l -5 -5 m 10 0 l -5 5 m 0 48 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 348 180 h 12 m 201 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 5 a 12 12 0 0 1 -12 12 m 0 0 h -201 m 103 0 l 5 -5 m 0 10 l -5 -5 m -103 0 a 12 12 0 0 1 -12 -12 v -5 a 12 12 0 0 1 12 -12" />
<g />
<g class="labeledbox exceptbox">
<rect height="133" width="201" x="360" y="66" />
<path d=" M 360 180 h 8 m 52 0 h 141 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0" />
<g class="verticalgrid">
<text class="comment" x="460" y="89">
⚠️ with the exception of</text>
<g class="choice">
<path d=" M 368 117 h 24 m 36 0 h 24" />
<a class="link" xlink:href="#railroad-LF">
<g class="nonterminal">
<rect height="22" width="36" x="392" y="106" />
<text x="410" y="122">
LF</text>
</g>
</a>
<path d=" M 368 117 a 12 12 0 0 1 12 12 v 9 m 60 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 380 138 v 0 a 12 12 0 0 0 12 12 m 36 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-CR">
<g class="nonterminal">
<rect height="22" width="36" x="392" y="139" />
<text x="410" y="155">
CR</text>
</g>
</a>
</g>
</g>
<a class="link" xlink:href="#railroad-CHAR">
<g class="nonterminal">
<rect height="22" width="52" x="368" y="169" />
<text x="394" y="185">
CHAR</text>
</g>
</a>
</g>
</g>
</g>
<path d=" M 314 180 h 10" />
</g>
</g>
<path d=" M 79 180 h 10" />
</g>
<path d=" M 631 180 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 180 h 10" />
<path d=" M 621 180 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 750px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-OUTER_BLOCK_DOC"><svg class="railroad" viewbox="0 0 750 297" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-OUTER_BLOCK_DOC">
<text class="comment" x="67" y="25">
OUTER_BLOCK_DOC</text>
</a>
<g class="sequence">
<path d=" M 10 123 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="112" />
<text x="57" y="128">
/**</text>
</g>
<g class="choice">
<path d=" M 89 123 h 24 m 201 0 h 24" />
<g class="labeledbox exceptbox">
<rect height="100" width="201" x="113" y="42" />
<path d=" M 113 123 h 8 m 52 0 h 141 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0" />
<g class="verticalgrid">
<text class="comment" x="213" y="65">
⚠️ with the exception of</text>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="121" y="82" />
<text x="135" y="98">
*</text>
</g>
</g>
<a class="link" xlink:href="#railroad-CHAR">
<g class="nonterminal">
<rect height="22" width="52" x="121" y="112" />
<text x="147" y="128">
CHAR</text>
</g>
</a>
</g>
<path d=" M 89 123 a 12 12 0 0 1 12 12 v 17 m 225 0 v -17 a 12 12 0 0 1 12 -12" />
<path d=" M 101 152 v 0 a 12 12 0 0 0 12 12 m 188 0 h 13 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-BLOCK_COMMENT_OR_DOC">
<g class="nonterminal">
<rect height="22" width="188" x="113" y="153" />
<text x="207" y="169">
BLOCK_COMMENT_OR_DOC</text>
</g>
</a>
</g>
<g class="optional">
<path d=" M 348 123 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 273 m -133 0 l -5 -5 m 0 10 l 5 -5 m 133 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 372 123 h 12 m 249 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 140 m 0 -67 l -5 -5 m 10 0 l -5 5 m 0 67 a 12 12 0 0 1 -12 12 m 0 0 h -249 m 127 0 l 5 -5 m 0 10 l -5 -5 m -127 0 a 12 12 0 0 1 -12 -12 v -140 m 0 73 l -5 5 m 10 0 l -5 -5 m 0 -73 a 12 12 0 0 1 12 -12" />
<g />
<g class="choice">
<path d=" M 384 123 h 24 m 188 0 h 37" />
<a class="link" xlink:href="#railroad-BLOCK_COMMENT_OR_DOC">
<g class="nonterminal">
<rect height="22" width="188" x="408" y="112" />
<text x="502" y="128">
BLOCK_COMMENT_OR_DOC</text>
</g>
</a>
<path d=" M 384 123 a 12 12 0 0 1 12 12 v 9 m 225 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 396 144 v 102 m 0 -48 l -5 -5 m 10 0 l -5 5 m 0 48 a 12 12 0 0 0 12 12 m 201 0 h 0 a 12 12 0 0 0 12 -12 v -102 m 0 54 l -5 5 m 10 0 l -5 -5 m 0 -54" />
<g class="labeledbox exceptbox">
<rect height="133" width="201" x="408" y="144" />
<path d=" M 408 258 h 8 m 52 0 h 141 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0" />
<g class="verticalgrid">
<text class="comment" x="508" y="167">
⚠️ with the exception of</text>
<g class="choice">
<path d=" M 416 195 h 24 m 36 0 h 24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="440" y="184" />
<text x="458" y="200">
*/</text>
</g>
<path d=" M 416 195 a 12 12 0 0 1 12 12 v 9 m 60 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 428 216 v 0 a 12 12 0 0 0 12 12 m 36 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-CR">
<g class="nonterminal">
<rect height="22" width="36" x="440" y="217" />
<text x="458" y="233">
CR</text>
</g>
</a>
</g>
</g>
<a class="link" xlink:href="#railroad-CHAR">
<g class="nonterminal">
<rect height="22" width="52" x="416" y="247" />
<text x="442" y="263">
CHAR</text>
</g>
</a>
</g>
</g>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="679" y="112" />
<text x="697" y="128">
*/</text>
</g>
<path d=" M 79 123 h 10" />
<path d=" M 338 123 h 10" />
<path d=" M 669 123 h 10" />
</g>
<path d=" M 725 123 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 123 h 10" />
<path d=" M 715 123 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 258px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-BLOCK_COMMENT_OR_DOC"><svg class="railroad" viewbox="0 0 258 140" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-BLOCK_COMMENT_OR_DOC">
<text class="comment" x="88" y="25">
BLOCK_COMMENT_OR_DOC</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 124 0 h 40" />
<g class="sequence">
<a class="link" xlink:href="#railroad-BLOCK_COMMENT">
<g class="nonterminal">
<rect height="22" width="124" x="59" y="42" />
<text x="121" y="58">
BLOCK_COMMENT</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 164 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 164 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 140 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-OUTER_BLOCK_DOC">
<g class="nonterminal">
<rect height="22" width="140" x="59" y="75" />
<text x="129" y="91">
OUTER_BLOCK_DOC</text>
</g>
</a>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 140 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-INNER_BLOCK_DOC">
<g class="nonterminal">
<rect height="22" width="140" x="59" y="108" />
<text x="129" y="124">
INNER_BLOCK_DOC</text>
</g>
</a>
</g>
<path d=" M 233 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 223 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-comments.normal"><a class="rule-link" href="#r-comments.normal" title="comments.normal"><span>[comments<wbr>.normal]</span></a>
</div>

<h2 id="非文档注释"><a class="header" href="#非文档注释">非文档注释</a></h2>
<p>注释遵循C++风格的单行注释（<code>//</code>）和块注释（<code>/* ... */</code>）形式。支持嵌套的块注释。</p>
<div class="rule" id="r-comments.normal.tokenization"><a class="rule-link" href="#r-comments.normal.tokenization" title="comments.normal.tokenization"><span>[comments<wbr>.normal<wbr>.tokenization]</span></a>
</div>

<p>非文档注释被解释为一种空白字符。</p>
<div class="rule" id="r-comments.doc"><a class="rule-link" href="#r-comments.doc" title="comments.doc"><span>[comments<wbr>.doc]</span></a>
</div>

<h2 id="文档注释"><a class="header" href="#文档注释">文档注释</a></h2>
<div class="rule" id="r-comments.doc.syntax"><a class="rule-link" href="#r-comments.doc.syntax" title="comments.doc.syntax"><span>[comments<wbr>.doc<wbr>.syntax]</span></a>
</div>

<p>以恰好_三_个斜杠（<code>///</code>）开头的行文档注释，以及块文档注释（<code>/** ... */</code>），这两种都是外部文档注释，被解释为<a href="https://doc.rust-lang.org/rustdoc/the-doc-attribute.html"><code>doc</code>属性</a>的一种特殊语法格式。</p>
<div class="rule" id="r-comments.doc.attributes"><a class="rule-link" href="#r-comments.doc.attributes" title="comments.doc.attributes"><span>[comments<wbr>.doc<wbr>.attributes]</span></a>
</div>

<p>也就是说，它们等价于在注释主体周围编写<code>#[doc="..."]</code>，例如，<code>/// Foo</code> 变为<code>#[doc="Foo"]</code>，<code>/** Bar */</code> 变为<code>#[doc="Bar"]</code>。因此，它们必须出现在接受外部属性的项之前。</p>
<div class="rule" id="r-comments.doc.inner-syntax"><a class="rule-link" href="#r-comments.doc.inner-syntax" title="comments.doc.inner-syntax"><span>[comments<wbr>.doc<wbr>.inner-syntax]</span></a>
</div>

<p>以<code>//!</code>开头的行注释和<code>/*! ... */</code>块注释是文档注释，它们应用于注释的父级，而不是紧随其后的项。</p>
<div class="rule" id="r-comments.doc.inner-attributes"><a class="rule-link" href="#r-comments.doc.inner-attributes" title="comments.doc.inner-attributes"><span>[comments<wbr>.doc<wbr>.inner-attributes]</span></a>
</div>

<p>也就是说，它们等价于在注释主体周围编写<code>#![doc="..."]</code>。<code>//!</code>注释通常用于文档化占据一个源文件的模块。</p>
<div class="rule" id="r-comments.doc.bare-crs"><a class="rule-link" href="#r-comments.doc.bare-crs" title="comments.doc.bare-crs"><span>[comments<wbr>.doc<wbr>.bare-crs]</span></a>
</div>

<p>字符<code>U+000D</code>(CR)不允许出现在文档注释中。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>按照惯例，文档注释包含Markdown，这是<code>rustdoc</code>所期望的。然而，注释语法格式不识别任何内部Markdown。<code>/** \</code>glob = “<em>/</em>.rs”;` <em>/<code> 会在第一个</code></em>/`处终止注释，其余代码将导致语法格式错误。与行文档注释相比，这稍微限制了块文档注释的内容。</p>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>序列<code>U+000D</code>(CR)紧跟<code>U+000A</code>(LF)在之前会被转换为单个<code>U+000A</code>(LF)。</p>
</blockquote>
</div>

<h2 id="示例"><a class="header" href="#示例">示例</a></h2>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>//! 适用于此crate的隐式匿名模块的文档注释

pub mod outer_module {

    //!  - 内部行级文档注释
    //!! - 仍然是内部行级文档注释（但开头带感叹号）

    /*!  - 内部块级文档注释 */
    /*!! - 仍然是内部块级文档注释（但开头带感叹号） */

    //   - 仅是普通注释
    ///  - 外部行级文档注释（恰好三个斜杠）
    //// - 仅是普通注释

    /*   - 仅是普通注释 */
    /**  - 外部块级文档注释（恰好两个星号） */
    /*** - 仅是普通注释 */

    pub mod inner_module {}

    pub mod nested_comments {
        /* 在 Rust 中 /* 我们可以 /* 嵌套注释 */ */ */

        // 所有三种块级注释都可以包含或嵌套在
        // 任何其他类型的注释中：

        /*   /* */  /** */  /*! */  */
        /*!  /* */  /** */  /*! */  */
        /**  /* */  /** */  /*! */  */
        pub mod dummy_item {}
    }

    pub mod degenerate_cases {
        // 空的内部行级文档注释
        //!

        // 空的内部块级文档注释
        /*!*/

        // 空的行级注释
        //

        // 空的外部行级文档注释
        ///

        // 空的块级注释
        /**/

        pub mod dummy_item {}

        // 空的两个星号的块注释不是文档块，它是普通的块注释
        /***/

    }

    /* 下一个是不允许的，因为外部文档注释
       需要一个接收文档的条目 */

    /// 我的条目在哪里？
<span class="boring">  mod boo {}
</span>}
<span class="boring">}</span></code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- https://github.com/rust-lang/reference/blob/master/src/whitespace.md -->
<!-- commit 68bdfd15fa9feebfbf94a06cf574de598e239198 -->
<div class="rule" id="r-lex.whitespace"><a class="rule-link" href="#r-lex.whitespace" title="lex.whitespace"><span>[lex<wbr>.whitespace]</span></a>
</div>

<h1 id="空白字符"><a class="header" href="#空白字符">空白字符</a></h1>
<div class="rule" id="r-whitespace.syntax"><a class="rule-link" href="#r-whitespace.syntax" title="whitespace.syntax"><span>[whitespace<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-WHITESPACE" onclick="show_railroad()"><a href="#railroad-WHITESPACE">WHITESPACE</a></span> → <br>      U+0009 <span class="grammar-comment">//  水平制表符，<code>'\t'</code></span> <br>    | U+000A <span class="grammar-comment">//  换行符，<code>'\n'</code></span> <br>    | U+000B <span class="grammar-comment">//  垂直制表符</span> <br>    | U+000C <span class="grammar-comment">//  换页符</span> <br>    | U+000D <span class="grammar-comment">//  回车符，<code>'\r'</code></span> <br>    | U+0020 <span class="grammar-comment">//  空格，<code>' '</code></span> <br>    | U+0085 <span class="grammar-comment">//  下一行</span> <br>    | U+200E <span class="grammar-comment">//  从左到右标记</span> <br>    | U+200F <span class="grammar-comment">//  从右到左标记</span> <br>    | U+2028 <span class="grammar-comment">//  行分隔符</span> <br>    | U+2029 <span class="grammar-comment">//  段落分隔符</span></p>
<p><span class="grammar-text grammar-production" id="grammar-TAB" onclick="show_railroad()"><a href="#railroad-TAB">TAB</a></span> → U+0009 <span class="grammar-comment">//  水平制表符，<code>'\t'</code></span></p>
<p><span class="grammar-text grammar-production" id="grammar-LF" onclick="show_railroad()"><a href="#railroad-LF">LF</a></span> → U+000A <span class="grammar-comment">//  换行符，<code>'\n'</code></span></p>
<p><span class="grammar-text grammar-production" id="grammar-CR" onclick="show_railroad()"><a href="#railroad-CR">CR</a></span> → U+000D <span class="grammar-comment">//  回车符，<code>'\r'</code></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 186px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-WHITESPACE"><svg class="railroad" viewbox="0 0 186 404" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-WHITESPACE">
<text class="comment" x="50" y="25">
WHITESPACE</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 68 0 h 24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="42" />
<text x="93" y="58">
U+0009</text>
</g>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 92 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 92 0 v -33" />
<path d=" M 47 107 v 33 m 92 0 v -33" />
<path d=" M 47 140 v 33 m 92 0 v -33" />
<path d=" M 47 173 v 33 m 92 0 v -33" />
<path d=" M 47 206 v 33 m 92 0 v -33" />
<path d=" M 47 239 v 33 m 92 0 v -33" />
<path d=" M 47 272 v 33 m 92 0 v -33" />
<path d=" M 47 305 v 33 m 92 0 v -33" />
<path d=" M 47 338 v 33 m 92 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 68 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="75" />
<text x="93" y="91">
U+000A</text>
</g>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 68 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="108" />
<text x="93" y="124">
U+000B</text>
</g>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 68 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="141" />
<text x="93" y="157">
U+000C</text>
</g>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 68 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="174" />
<text x="93" y="190">
U+000D</text>
</g>
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 68 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="207" />
<text x="93" y="223">
U+0020</text>
</g>
</g>
<path d=" M 47 239 v 0 a 12 12 0 0 0 12 12 m 68 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="240" />
<text x="93" y="256">
U+0085</text>
</g>
</g>
<path d=" M 47 272 v 0 a 12 12 0 0 0 12 12 m 68 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="273" />
<text x="93" y="289">
U+200E</text>
</g>
</g>
<path d=" M 47 305 v 0 a 12 12 0 0 0 12 12 m 68 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="306" />
<text x="93" y="322">
U+200F</text>
</g>
</g>
<path d=" M 47 338 v 0 a 12 12 0 0 0 12 12 m 68 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="339" />
<text x="93" y="355">
U+2028</text>
</g>
</g>
<path d=" M 47 371 v 0 a 12 12 0 0 0 12 12 m 68 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="372" />
<text x="93" y="388">
U+2029</text>
</g>
</g>
</g>
<path d=" M 161 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 151 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 138px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TAB"><svg class="railroad" viewbox="0 0 138 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TAB">
<text class="comment" x="25" y="25">
TAB</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="35" y="42" />
<text x="69" y="58">
U+0009</text>
</g>
</g>
<path d=" M 113 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 103 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 138px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-LF"><svg class="railroad" viewbox="0 0 138 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-LF">
<text class="comment" x="22" y="25">
LF</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="35" y="42" />
<text x="69" y="58">
U+000A</text>
</g>
</g>
<path d=" M 113 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 103 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 138px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-CR"><svg class="railroad" viewbox="0 0 138 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-CR">
<text class="comment" x="22" y="25">
CR</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="35" y="42" />
<text x="69" y="58">
U+000D</text>
</g>
</g>
<path d=" M 113 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 103 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-lex.whitespace.intro"><a class="rule-link" href="#r-lex.whitespace.intro" title="lex.whitespace.intro"><span>[lex<wbr>.whitespace<wbr>.intro]</span></a>
</div>

<p>空白字符是指任何非空字符串，它只包含具有<a href="https://www.unicode.org/reports/tr31/"><code>Pattern_White_Space</code></a> Unicode属性的字符。</p>
<div class="rule" id="r-lex.whitespace.token-sep"><a class="rule-link" href="#r-lex.whitespace.token-sep" title="lex.whitespace.token-sep"><span>[lex<wbr>.whitespace<wbr>.token-sep]</span></a>
</div>

<p>Rust是一种自由格式语言，这意味着所有形式的空白字符仅用于在语法格式中分隔_词法单元_，并且没有语义上的意义。</p>
<div class="rule" id="r-lex.whitespace.replacement"><a class="rule-link" href="#r-lex.whitespace.replacement" title="lex.whitespace.replacement"><span>[lex<wbr>.whitespace<wbr>.replacement]</span></a>
</div>

<p>如果Rust程序中的每个空白字符元素被任何其他合法的空白字符元素（例如一个空格字符）替换，其含义保持不变。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-lex.token"><a class="rule-link" href="#r-lex.token" title="lex.token"><span>[lex<wbr>.token]</span></a>
</div>

<h1 id="词法单元"><a class="header" href="#词法单元">词法单元</a></h1>
<div class="rule" id="r-lex.token.syntax"><a class="rule-link" href="#r-lex.token.syntax" title="lex.token.syntax"><span>[lex<wbr>.token<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-Token" onclick="show_railroad()"><a href="#railroad-Token">Token</a></span> → <br>      <span class="grammar-text"><a href="#grammar-RESERVED_TOKEN">RESERVED_TOKEN</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RAW_IDENTIFIER">RAW_IDENTIFIER</a></span> <br>    | <span class="grammar-text"><a href="#grammar-CHAR_LITERAL">CHAR_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-STRING_LITERAL">STRING_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RAW_STRING_LITERAL">RAW_STRING_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-BYTE_LITERAL">BYTE_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-BYTE_STRING_LITERAL">BYTE_STRING_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RAW_BYTE_STRING_LITERAL">RAW_BYTE_STRING_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-C_STRING_LITERAL">C_STRING_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RAW_C_STRING_LITERAL">RAW_C_STRING_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-FLOAT_LITERAL">FLOAT_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-INTEGER_LITERAL">INTEGER_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-LIFETIME_TOKEN">LIFETIME_TOKEN</a></span> <br>    | <span class="grammar-text"><a href="#grammar-PUNCTUATION">PUNCTUATION</a></span> <br>    | <span class="grammar-text"><a href="#grammar-IDENTIFIER_OR_KEYWORD">IDENTIFIER_OR_KEYWORD</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 330px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Token"><svg class="railroad" viewbox="0 0 330 536" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Token">
<text class="comment" x="32" y="25">
Token</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 132 0 h 104 m -49 0 l -5 -5 m 0 10 l 5 -5 m 49 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RESERVED_TOKEN">
<g class="nonterminal">
<rect height="22" width="132" x="59" y="42" />
<text x="125" y="58">
RESERVED_TOKEN</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 236 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 236 0 v -33" />
<path d=" M 47 107 v 33 m 236 0 v -33" />
<path d=" M 47 140 v 33 m 236 0 v -33" />
<path d=" M 47 173 v 33 m 236 0 v -33" />
<path d=" M 47 206 v 33 m 236 0 v -33" />
<path d=" M 47 239 v 33 m 236 0 v -33" />
<path d=" M 47 272 v 33 m 236 0 v -33" />
<path d=" M 47 305 v 33 m 236 0 v -33" />
<path d=" M 47 338 v 33 m 236 0 v -33" />
<path d=" M 47 371 v 33 m 236 0 v -33" />
<path d=" M 47 404 v 33 m 236 0 v -33" />
<path d=" M 47 437 v 33 m 236 0 v -33" />
<path d=" M 47 470 v 33 m 236 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 132 0 h 80 m -37 0 l -5 -5 m 0 10 l 5 -5 m 37 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RAW_IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="132" x="59" y="75" />
<text x="125" y="91">
RAW_IDENTIFIER</text>
</g>
</a>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 116 0 h 96 m -45 0 l -5 -5 m 0 10 l 5 -5 m 45 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-CHAR_LITERAL">
<g class="nonterminal">
<rect height="22" width="116" x="59" y="108" />
<text x="117" y="124">
CHAR_LITERAL</text>
</g>
</a>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 132 0 h 80 m -37 0 l -5 -5 m 0 10 l 5 -5 m 37 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="132" x="59" y="141" />
<text x="125" y="157">
STRING_LITERAL</text>
</g>
</a>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 164 0 h 48 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RAW_STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="164" x="59" y="174" />
<text x="141" y="190">
RAW_STRING_LITERAL</text>
</g>
</a>
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 116 0 h 96 m -45 0 l -5 -5 m 0 10 l 5 -5 m 45 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-BYTE_LITERAL">
<g class="nonterminal">
<rect height="22" width="116" x="59" y="207" />
<text x="117" y="223">
BYTE_LITERAL</text>
</g>
</a>
</g>
<path d=" M 47 239 v 0 a 12 12 0 0 0 12 12 m 172 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-BYTE_STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="172" x="59" y="240" />
<text x="145" y="256">
BYTE_STRING_LITERAL</text>
</g>
</a>
</g>
<path d=" M 47 272 v 0 a 12 12 0 0 0 12 12 m 212 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RAW_BYTE_STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="212" x="59" y="273" />
<text x="165" y="289">
RAW_BYTE_STRING_LITERAL</text>
</g>
</a>
</g>
<path d=" M 47 305 v 0 a 12 12 0 0 0 12 12 m 148 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-C_STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="148" x="59" y="306" />
<text x="133" y="322">
C_STRING_LITERAL</text>
</g>
</a>
</g>
<path d=" M 47 338 v 0 a 12 12 0 0 0 12 12 m 188 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RAW_C_STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="188" x="59" y="339" />
<text x="153" y="355">
RAW_C_STRING_LITERAL</text>
</g>
</a>
</g>
<path d=" M 47 371 v 0 a 12 12 0 0 0 12 12 m 124 0 h 88 m -41 0 l -5 -5 m 0 10 l 5 -5 m 41 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-FLOAT_LITERAL">
<g class="nonterminal">
<rect height="22" width="124" x="59" y="372" />
<text x="121" y="388">
FLOAT_LITERAL</text>
</g>
</a>
</g>
<path d=" M 47 404 v 0 a 12 12 0 0 0 12 12 m 140 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-INTEGER_LITERAL">
<g class="nonterminal">
<rect height="22" width="140" x="59" y="405" />
<text x="129" y="421">
INTEGER_LITERAL</text>
</g>
</a>
</g>
<path d=" M 47 437 v 0 a 12 12 0 0 0 12 12 m 132 0 h 80 m -37 0 l -5 -5 m 0 10 l 5 -5 m 37 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-LIFETIME_TOKEN">
<g class="nonterminal">
<rect height="22" width="132" x="59" y="438" />
<text x="125" y="454">
LIFETIME_TOKEN</text>
</g>
</a>
</g>
<path d=" M 47 470 v 0 a 12 12 0 0 0 12 12 m 108 0 h 104 m -49 0 l -5 -5 m 0 10 l 5 -5 m 49 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-PUNCTUATION">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="471" />
<text x="113" y="487">
PUNCTUATION</text>
</g>
</a>
</g>
<path d=" M 47 503 v 0 a 12 12 0 0 0 12 12 m 196 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-IDENTIFIER_OR_KEYWORD">
<g class="nonterminal">
<rect height="22" width="196" x="59" y="504" />
<text x="157" y="520">
IDENTIFIER_OR_KEYWORD</text>
</g>
</a>
</g>
<path d=" M 305 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 295 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-lex.token.intro"><a class="rule-link" href="#r-lex.token.intro" title="lex.token.intro"><span>[lex<wbr>.token<wbr>.intro]</span></a>
</div>

<p>词法单元是语法格式中由正则（非递归）语言定义的原始生成式。Rust源输入可以分解为以下几种词法单元：</p>
<ul>
<li><a href="#关键字">关键字</a></li>
<li><a href="#标识符">标识符</a></li>
<li><a href="#字面量">字面量</a></li>
<li><a href="#生命周期和循环标签">生命周期和循环标签</a></li>
<li><a href="#标点符号">标点符号</a></li>
<li><a href="#分隔符">分隔符</a></li>
</ul>
<p>在此文档的语法中，“简单”词法单元以<a href="#字符串表产生式">字符串表生成式</a>形式给出，并以<code>等宽字体</code>显示。</p>
<div class="rule" id="r-lex.token.literal"><a class="rule-link" href="#r-lex.token.literal" title="lex.token.literal"><span>[lex<wbr>.token<wbr>.literal]</span></a>
</div>

<h2 id="字面量"><a class="header" href="#字面量">字面量</a></h2>
<p>字面量是<a href="#字面量表达式">字面量表达式</a>中使用的词法单元。</p>
<h3 id="示例-1"><a class="header" href="#示例-1">示例</a></h3>
<h4 id="字符和字符串"><a class="header" href="#字符和字符串">字符和字符串</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th></th><th>示例</th><th><code>#</code> 数量<sup class="footnote-reference" id="fr-nsets-1"><a href="#footnote-nsets">1</a></sup></th><th>字符</th><th>转义</th></tr>
</thead>
<tbody>
<tr><td><a href="#字符字面量">字符字面量</a></td><td><code>'H'</code></td><td>0</td><td>所有 Unicode</td><td><a href="#引号转义">引号</a> &amp; <a href="#ascii转义">ASCII</a> &amp; <a href="#unicode转义">Unicode</a></td></tr>
<tr><td><a href="#字符串字面量">字符串字面量</a></td><td><code>"hello"</code></td><td>0</td><td>所有 Unicode</td><td><a href="#引号转义">引号</a> &amp; <a href="#ascii转义">ASCII</a> &amp; <a href="#unicode转义">Unicode</a></td></tr>
<tr><td><a href="#原始字符串字面量">原始字符串字面量</a></td><td><code>r#"hello"#</code></td><td>&lt;256</td><td>所有Unicode</td><td><code>N/A</code></td></tr>
<tr><td><a href="#字节字面量">字节字面量</a></td><td><code>b'H'</code></td><td>0</td><td>所有 ASCII</td><td><a href="#引号转义">引号</a> &amp; <a href="#字节转义">字节</a></td></tr>
<tr><td><a href="#字节字符串字面量">字节字符串字面量</a></td><td><code>b"hello"</code></td><td>0</td><td>所有 ASCII</td><td><a href="#引号转义">引号</a> &amp; <a href="#字节转义">字节</a></td></tr>
<tr><td><a href="#原始字节字符串字面量">原始字节字符串字面量</a></td><td><code>br#"hello"#</code></td><td>&lt;256</td><td>所有 ASCII</td><td><code>N/A</code></td></tr>
<tr><td><a href="#c字符串字面量">C字符串字面量</a></td><td><code>c"hello"</code></td><td>0</td><td>所有 Unicode</td><td><a href="#引号转义">引号</a> &amp; <a href="#字节转义">字节</a> &amp; <a href="#unicode转义">Unicode</a></td></tr>
<tr><td><a href="#原始c字符串字面量">原始C字符串字面量</a></td><td><code>cr#"hello"#</code></td><td>&lt;256</td><td>所有 Unicode</td><td><code>N/A</code></td></tr>
</tbody>
</table>
</div>
<h4 id="ascii转义"><a class="header" href="#ascii转义">ASCII转义</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th></th><th>名称</th></tr>
</thead>
<tbody>
<tr><td><code>\x41</code></td><td>7位字符码（恰好2个十六进制数字，最大0x7F）</td></tr>
<tr><td><code>\n</code></td><td>换行</td></tr>
<tr><td><code>\r</code></td><td>回车</td></tr>
<tr><td><code>\t</code></td><td>Tab键</td></tr>
<tr><td><code>\\</code></td><td>反斜杠</td></tr>
<tr><td><code>\0</code></td><td>空字符</td></tr>
</tbody>
</table>
</div>
<h4 id="字节转义"><a class="header" href="#字节转义">字节转义</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th></th><th>名称</th></tr>
</thead>
<tbody>
<tr><td><code>\x7F</code></td><td>8位字符码（恰好2个十六进制数字）</td></tr>
<tr><td><code>\n</code></td><td>换行</td></tr>
<tr><td><code>\r</code></td><td>回车</td></tr>
<tr><td><code>\t</code></td><td>Tab键</td></tr>
<tr><td><code>\\</code></td><td>反斜杠</td></tr>
<tr><td><code>\0</code></td><td>空字符</td></tr>
</tbody>
</table>
</div>
<h4 id="unicode转义"><a class="header" href="#unicode转义">Unicode转义</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th></th><th>名称</th></tr>
</thead>
<tbody>
<tr><td><code>\u{7FFF}</code></td><td>24位Unicode字符码（最多6个十六进制数字）</td></tr>
</tbody>
</table>
</div>
<h4 id="引号转义"><a class="header" href="#引号转义">引号转义</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th></th><th>名称</th></tr>
</thead>
<tbody>
<tr><td><code>\'</code></td><td>单引号</td></tr>
<tr><td><code>\"</code></td><td>双引号</td></tr>
</tbody>
</table>
</div>
<h4 id="数字"><a class="header" href="#数字">数字</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th><a href="#数字字面量">数字字面量</a><sup class="footnote-reference" id="fr-nl-1"><a href="#footnote-nl">2</a></sup></th><th>示例</th><th>幂运算</th></tr>
</thead>
<tbody>
<tr><td>十进制整数</td><td><code>98_222</code></td><td><code>N/A</code></td></tr>
<tr><td>十六进制整数</td><td><code>0xff</code></td><td><code>N/A</code></td></tr>
<tr><td>八进制整数</td><td><code>0o77</code></td><td><code>N/A</code></td></tr>
<tr><td>二进制整数</td><td><code>0b1111_0000</code></td><td><code>N/A</code></td></tr>
<tr><td>浮点数</td><td><code>123.0E+77</code></td><td><code>可选</code></td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-lex.token.literal.suffix"><a class="rule-link" href="#r-lex.token.literal.suffix" title="lex.token.literal.suffix"><span>[lex<wbr>.token<wbr>.literal<wbr>.suffix]</span></a>
</div>

<h4 id="后缀"><a class="header" href="#后缀">后缀</a></h4>
<div class="rule" id="r-lex.token.literal.literal.suffix.intro"><a class="rule-link" href="#r-lex.token.literal.literal.suffix.intro" title="lex.token.literal.literal.suffix.intro"><span>[lex<wbr>.token<wbr>.literal<wbr>.literal<wbr>.suffix<wbr>.intro]</span></a>
</div>

<p>后缀是紧跟在字面量主要部分（无中间空白）后面的一串字符，其形式与非原始<a href="#标识符">标识符</a>或<a href="#关键字">关键字</a>相同。</p>
<div class="rule" id="r-lex.token.literal.suffix.syntax"><a class="rule-link" href="#r-lex.token.literal.suffix.syntax" title="lex.token.literal.suffix.syntax"><span>[lex<wbr>.token<wbr>.literal<wbr>.suffix<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-SUFFIX" onclick="show_railroad()"><a href="#railroad-SUFFIX">SUFFIX</a></span> → <span class="grammar-text"><a href="#grammar-IDENTIFIER_OR_KEYWORD">IDENTIFIER_OR_KEYWORD</a></span><sub class="grammar-text">except <code>_</code></sub></p>
<p><span class="grammar-text grammar-production" id="grammar-SUFFIX_NO_E" onclick="show_railroad()"><a href="#railroad-SUFFIX_NO_E">SUFFIX_NO_E</a></span> → <span class="grammar-text"><a href="#grammar-SUFFIX">SUFFIX</a></span><sub class="grammar-text">not beginning with <code>e</code> or <code>E</code></sub></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 282px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-SUFFIX"><svg class="railroad" viewbox="0 0 282 118" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-SUFFIX">
<text class="comment" x="36" y="25">
SUFFIX</text>
</a>
<g class="sequence">
<path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="labeledbox">
<rect height="66" width="212" x="35" y="42" />
<path d=" M 35 89 h 8 m 196 0 h 8" />
<text class="comment" x="83" y="65">
except `_`</text>
<a class="link" xlink:href="#railroad-IDENTIFIER_OR_KEYWORD">
<g class="nonterminal">
<rect height="22" width="196" x="43" y="78" />
<text x="141" y="94">
IDENTIFIER_OR_KEYWORD</text>
</g>
</a>
</g>
<path d=" M 257 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 89 h 10" />
<path d=" M 247 89 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 306px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-SUFFIX_NO_E"><svg class="railroad" viewbox="0 0 306 118" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-SUFFIX_NO_E">
<text class="comment" x="53" y="25">
SUFFIX_NO_E</text>
</a>
<g class="sequence">
<path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="labeledbox">
<rect height="66" width="236" x="35" y="42" />
<path d=" M 35 89 h 8 m 68 0 h 160 m -77 0 l -5 -5 m 0 10 l 5 -5 m 77 0" />
<text class="comment" x="153" y="65">
not beginning with `e` or `E`</text>
<a class="link" xlink:href="#railroad-SUFFIX">
<g class="nonterminal">
<rect height="22" width="68" x="43" y="78" />
<text x="77" y="94">
SUFFIX</text>
</g>
</a>
</g>
<path d=" M 281 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 89 h 10" />
<path d=" M 271 89 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-lex.token.literal.suffix.validity"><a class="rule-link" href="#r-lex.token.literal.suffix.validity" title="lex.token.literal.suffix.validity"><span>[lex<wbr>.token<wbr>.literal<wbr>.suffix<wbr>.validity]</span></a>
</div>

<p>任何类型的字面量（字符串、整数等）与任何后缀组合，都可作为有效的词法单元。</p>
<p>带有任何后缀的字面量词法单元可以传递给宏而不会产生错误。宏本身将决定如何解释此类词法单元以及是否产生错误。特别是，声明宏的<code>literal</code> fragment specifier匹配带有任意后缀的字面量词法单元。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! blackhole { ($tt:tt) =&gt; () }
macro_rules! blackhole_lit { ($l:literal) =&gt; () }

blackhole!("string"suffix); // OK
blackhole_lit!(1suffix); // OK
<span class="boring">}</span></code></pre>
<div class="rule" id="r-lex.token.literal.suffix.parse"><a class="rule-link" href="#r-lex.token.literal.suffix.parse" title="lex.token.literal.suffix.parse"><span>[lex<wbr>.token<wbr>.literal<wbr>.suffix<wbr>.parse]</span></a>
</div>

<p>然而，在被解释为字面量表达式或模式的字面量词法单元上，后缀是受限制的。非数字字面量词法单元的任何后缀都会被拒绝，而数字字面量词法单元只接受以下列表中的后缀。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>整数</th><th>浮点数</th></tr>
</thead>
<tbody>
<tr><td><code>u8</code>, <code>i8</code>, <code>u16</code>, <code>i16</code>, <code>u32</code>, <code>i32</code>, <code>u64</code>, <code>i64</code>, <code>u128</code>, <code>i128</code>, <code>usize</code>, <code>isize</code></td><td><code>f32</code>, <code>f64</code></td></tr>
</tbody>
</table>
</div>
<h3 id="字符和字符串字面量"><a class="header" href="#字符和字符串字面量">字符和字符串字面量</a></h3>
<div class="rule" id="r-lex.token.literal.char"><a class="rule-link" href="#r-lex.token.literal.char" title="lex.token.literal.char"><span>[lex<wbr>.token<wbr>.literal<wbr>.char]</span></a>
</div>

<h4 id="字符字面量"><a class="header" href="#字符字面量">字符字面量</a></h4>
<div class="rule" id="r-lex.token.literal.char.syntax"><a class="rule-link" href="#r-lex.token.literal.char.syntax" title="lex.token.literal.char.syntax"><span>[lex<wbr>.token<wbr>.literal<wbr>.char<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-CHAR_LITERAL" onclick="show_railroad()"><a href="#railroad-CHAR_LITERAL">CHAR_LITERAL</a></span> → <br>    <span class="grammar-literal">'</span> <br>        ( ~[<span class="grammar-literal">'</span> <span class="grammar-literal">\</span> <a href="#grammar-LF">LF</a> <a href="#grammar-CR">CR</a> <a href="#grammar-TAB">TAB</a>] | <span class="grammar-text"><a href="#grammar-QUOTE_ESCAPE">QUOTE_ESCAPE</a></span> | <span class="grammar-text"><a href="#grammar-ASCII_ESCAPE">ASCII_ESCAPE</a></span> | <span class="grammar-text"><a href="#grammar-UNICODE_ESCAPE">UNICODE_ESCAPE</a></span> ) <br>    <span class="grammar-literal">'</span> <span class="grammar-text"><a href="#grammar-SUFFIX">SUFFIX</a></span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-QUOTE_ESCAPE" onclick="show_railroad()"><a href="#railroad-QUOTE_ESCAPE">QUOTE_ESCAPE</a></span> → <span class="grammar-literal">\'</span> | <span class="grammar-literal">\"</span></p>
<p><span class="grammar-text grammar-production" id="grammar-ASCII_ESCAPE" onclick="show_railroad()"><a href="#railroad-ASCII_ESCAPE">ASCII_ESCAPE</a></span> → <br>      <span class="grammar-literal">\x</span> <span class="grammar-text"><a href="#grammar-OCT_DIGIT">OCT_DIGIT</a></span> <span class="grammar-text"><a href="#grammar-HEX_DIGIT">HEX_DIGIT</a></span> <br>    | <span class="grammar-literal">\n</span> | <span class="grammar-literal">\r</span> | <span class="grammar-literal">\t</span> | <span class="grammar-literal">\\</span> | <span class="grammar-literal">\0</span></p>
<p><span class="grammar-text grammar-production" id="grammar-UNICODE_ESCAPE" onclick="show_railroad()"><a href="#railroad-UNICODE_ESCAPE">UNICODE_ESCAPE</a></span> → <br>    <span class="grammar-literal">\u{</span> ( <span class="grammar-text"><a href="#grammar-HEX_DIGIT">HEX_DIGIT</a></span> <span class="grammar-literal">_</span><sup>*</sup> )<sup>1..6</sup><sub class="grammar-text">valid hex char value</sub> <span class="grammar-literal">}</span>​<sup class="footnote-reference" id="fr-valid-hex-char-1"><a href="#footnote-valid-hex-char">3</a></sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 521px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-CHAR_LITERAL"><svg class="railroad" viewbox="0 0 521 383" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-CHAR_LITERAL">
<text class="comment" x="57" y="25">
CHAR_LITERAL</text>
</a>
<g class="sequence">
<path d=" M 10 255 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="244" />
<text x="49" y="260">
'</text>
</g>
<g class="choice">
<path d=" M 73 255 h 24 m 201 0 h 24" />
<g class="labeledbox exceptbox">
<rect height="232" width="201" x="97" y="42" />
<path d=" M 97 255 h 8 m 52 0 h 141 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0" />
<g class="verticalgrid">
<text class="comment" x="197" y="65">
⚠️ with the exception of</text>
<g class="choice">
<path d=" M 105 93 h 24 m 28 0 h 40" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="129" y="82" />
<text x="143" y="98">
'</text>
</g>
<path d=" M 105 93 a 12 12 0 0 1 12 12 v 9 m 68 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 117 114 v 33 m 68 0 v -33" />
<path d=" M 117 147 v 33 m 68 0 v -33" />
<path d=" M 117 180 v 33 m 68 0 v -33" />
<path d=" M 117 114 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="129" y="115" />
<text x="143" y="131">
\</text>
</g>
<path d=" M 117 147 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-LF">
<g class="nonterminal">
<rect height="22" width="36" x="129" y="148" />
<text x="147" y="164">
LF</text>
</g>
</a>
<path d=" M 117 180 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-CR">
<g class="nonterminal">
<rect height="22" width="36" x="129" y="181" />
<text x="147" y="197">
CR</text>
</g>
</a>
<path d=" M 117 213 v 0 a 12 12 0 0 0 12 12 m 44 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-TAB">
<g class="nonterminal">
<rect height="22" width="44" x="129" y="214" />
<text x="151" y="230">
TAB</text>
</g>
</a>
</g>
</g>
<a class="link" xlink:href="#railroad-CHAR">
<g class="nonterminal">
<rect height="22" width="52" x="105" y="244" />
<text x="131" y="260">
CHAR</text>
</g>
</a>
</g>
<path d=" M 73 255 a 12 12 0 0 1 12 12 v 17 m 225 0 v -17 a 12 12 0 0 1 12 -12" />
<path d=" M 85 284 v 33 m 225 0 v -33" />
<path d=" M 85 317 v 33 m 225 0 v -33" />
<path d=" M 85 284 v 0 a 12 12 0 0 0 12 12 m 116 0 h 85 m -39 0 l -5 -5 m 0 10 l 5 -5 m 39 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-QUOTE_ESCAPE">
<g class="nonterminal">
<rect height="22" width="116" x="97" y="285" />
<text x="155" y="301">
QUOTE_ESCAPE</text>
</g>
</a>
<path d=" M 85 317 v 0 a 12 12 0 0 0 12 12 m 116 0 h 85 m -39 0 l -5 -5 m 0 10 l 5 -5 m 39 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-ASCII_ESCAPE">
<g class="nonterminal">
<rect height="22" width="116" x="97" y="318" />
<text x="155" y="334">
ASCII_ESCAPE</text>
</g>
</a>
<path d=" M 85 350 v 0 a 12 12 0 0 0 12 12 m 132 0 h 69 m -31 0 l -5 -5 m 0 10 l 5 -5 m 31 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-UNICODE_ESCAPE">
<g class="nonterminal">
<rect height="22" width="132" x="97" y="351" />
<text x="163" y="367">
UNICODE_ESCAPE</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="332" y="244" />
<text x="346" y="260">
'</text>
</g>
<g class="optional">
<path d=" M 370 255 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 68 m -31 0 l -5 -5 m 0 10 l 5 -5 m 31 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-SUFFIX">
<g class="nonterminal">
<rect height="22" width="68" x="394" y="244" />
<text x="428" y="260">
SUFFIX</text>
</g>
</a>
</g>
<path d=" M 63 255 h 10" />
<path d=" M 322 255 h 10" />
<path d=" M 360 255 h 10" />
</g>
<path d=" M 496 255 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 255 h 10" />
<path d=" M 486 255 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 154px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-QUOTE_ESCAPE"><svg class="railroad" viewbox="0 0 154 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-QUOTE_ESCAPE">
<text class="comment" x="57" y="25">
QUOTE_ESCAPE</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 36 0 h 24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="42" />
<text x="77" y="58">
\'</text>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 60 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 36 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="75" />
<text x="77" y="91">
\"</text>
</g>
</g>
<path d=" M 129 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 119 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 358px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ASCII_ESCAPE"><svg class="railroad" viewbox="0 0 358 239" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ASCII_ESCAPE">
<text class="comment" x="57" y="25">
ASCII_ESCAPE</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 240 0 h 24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="42" />
<text x="77" y="58">
\x</text>
</g>
<a class="link" xlink:href="#railroad-OCT_DIGIT">
<g class="nonterminal">
<rect height="22" width="92" x="105" y="42" />
<text x="151" y="58">
OCT_DIGIT</text>
</g>
</a>
<a class="link" xlink:href="#railroad-HEX_DIGIT">
<g class="nonterminal">
<rect height="22" width="92" x="207" y="42" />
<text x="253" y="58">
HEX_DIGIT</text>
</g>
</a>
<path d=" M 95 53 h 10" />
<path d=" M 197 53 h 10" />
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 264 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 264 0 v -33" />
<path d=" M 47 107 v 33 m 264 0 v -33" />
<path d=" M 47 140 v 33 m 264 0 v -33" />
<path d=" M 47 173 v 33 m 264 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 36 0 h 204 m -99 0 l -5 -5 m 0 10 l 5 -5 m 99 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="75" />
<text x="77" y="91">
\n</text>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 36 0 h 204 m -99 0 l -5 -5 m 0 10 l 5 -5 m 99 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="108" />
<text x="77" y="124">
\r</text>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 36 0 h 204 m -99 0 l -5 -5 m 0 10 l 5 -5 m 99 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="141" />
<text x="77" y="157">
\t</text>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 36 0 h 204 m -99 0 l -5 -5 m 0 10 l 5 -5 m 99 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="174" />
<text x="77" y="190">
\\</text>
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 36 0 h 204 m -99 0 l -5 -5 m 0 10 l 5 -5 m 99 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="207" />
<text x="77" y="223">
\0</text>
</g>
</g>
<path d=" M 333 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 323 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 404px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-UNICODE_ESCAPE"><svg class="railroad" viewbox="0 0 404 174" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-UNICODE_ESCAPE">
<text class="comment" x="64" y="25">
UNICODE_ESCAPE</text>
</a>
<g class="sequence">
<path d=" M 10 102 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="91" />
<text x="57" y="107">
\u{</text>
</g>
<g class="labeledbox">
<rect height="122" width="242" x="89" y="42" />
<path d=" M 89 102 h 8 m 226 0 h 8" />
<text class="comment" x="175" y="65">
valid hex char value</text>
<g class="repeat">
<path d=" M 97 102 h 12 m 202 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 20 a 12 12 0 0 1 -12 12 m -157 0 h -45 a 12 12 0 0 1 -12 -12 v -20 a 12 12 0 0 1 12 -12" />
<text class="comment" x="232" y="151">
at most 5 more times</text>
<g class="sequence">
<a class="link" xlink:href="#railroad-HEX_DIGIT">
<g class="nonterminal">
<rect height="22" width="92" x="109" y="91" />
<text x="155" y="107">
HEX_DIGIT</text>
</g>
</a>
<g class="optional">
<path d=" M 211 102 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 52 m -23 0 l -5 -5 m 0 10 l 5 -5 m 23 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 235 102 h 12 m 28 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -28 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="247" y="91" />
<text x="261" y="107">
_</text>
</g>
</g>
</g>
<path d=" M 201 102 h 10" />
</g>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="341" y="91" />
<text x="355" y="107">
}</text>
</g>
<path d=" M 79 102 h 10" />
<path d=" M 331 102 h 10" />
</g>
<path d=" M 379 102 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 102 h 10" />
<path d=" M 369 102 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-lex.token.literal.char.intro"><a class="rule-link" href="#r-lex.token.literal.char.intro" title="lex.token.literal.char.intro"><span>[lex<wbr>.token<wbr>.literal<wbr>.char<wbr>.intro]</span></a>
</div>

<p>字符字面量是单个Unicode字符，用两个<code>U+0027</code>（单引号）字符括起来，但<code>U+0027</code>本身除外，它必须通过前面加一个<code>U+005C</code>字符（<code>\</code>）进行转义。</p>
<div class="rule" id="r-lex.token.literal.str"><a class="rule-link" href="#r-lex.token.literal.str" title="lex.token.literal.str"><span>[lex<wbr>.token<wbr>.literal<wbr>.str]</span></a>
</div>

<h4 id="字符串字面量"><a class="header" href="#字符串字面量">字符串字面量</a></h4>
<div class="rule" id="r-lex.token.literal.str.syntax"><a class="rule-link" href="#r-lex.token.literal.str.syntax" title="lex.token.literal.str.syntax"><span>[lex<wbr>.token<wbr>.literal<wbr>.str<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-STRING_LITERAL" onclick="show_railroad()"><a href="#railroad-STRING_LITERAL">STRING_LITERAL</a></span> → <br>    <span class="grammar-literal">"</span> ( <br>        ~[<span class="grammar-literal">"</span> <span class="grammar-literal">\</span> <a href="#grammar-CR">CR</a>] <br>      | <span class="grammar-text"><a href="#grammar-QUOTE_ESCAPE">QUOTE_ESCAPE</a></span> <br>      | <span class="grammar-text"><a href="#grammar-ASCII_ESCAPE">ASCII_ESCAPE</a></span> <br>      | <span class="grammar-text"><a href="#grammar-UNICODE_ESCAPE">UNICODE_ESCAPE</a></span> <br>      | <span class="grammar-text"><a href="#grammar-STRING_CONTINUE">STRING_CONTINUE</a></span> <br>    )<sup>*</sup> <span class="grammar-literal">"</span> <span class="grammar-text"><a href="#grammar-SUFFIX">SUFFIX</a></span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-STRING_CONTINUE" onclick="show_railroad()"><a href="#railroad-STRING_CONTINUE">STRING_CONTINUE</a></span> → <span class="grammar-literal">\</span> <span class="grammar-text"><a href="#grammar-LF">LF</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 593px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-STRING_LITERAL"><svg class="railroad" viewbox="0 0 593 372" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-STRING_LITERAL">
<text class="comment" x="64" y="25">
STRING_LITERAL</text>
</a>
<g class="sequence">
<path d=" M 10 201 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="190" />
<text x="49" y="206">
"</text>
</g>
<g class="optional">
<path d=" M 73 201 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -135 m 0 70 l -5 5 m 10 0 l -5 -5 m 0 -70 a 12 12 0 0 1 12 -12 h 273 m -133 0 l -5 -5 m 0 10 l 5 -5 m 133 0 a 12 12 0 0 1 12 12 v 135 m 0 -64 l -5 -5 m 10 0 l -5 5 m 0 64 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 97 201 h 12 m 249 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 137 m 0 -65 l -5 -5 m 10 0 l -5 5 m 0 65 a 12 12 0 0 1 -12 12 m 0 0 h -249 m 127 0 l 5 -5 m 0 10 l -5 -5 m -127 0 a 12 12 0 0 1 -12 -12 v -137 m 0 71 l -5 5 m 10 0 l -5 -5 m 0 -71 a 12 12 0 0 1 12 -12" />
<g />
<g class="choice">
<path d=" M 109 201 h 24 m 201 0 h 24" />
<g class="sequence">
<g class="labeledbox exceptbox">
<rect height="166" width="201" x="133" y="54" />
<path d=" M 133 201 h 8 m 52 0 h 141 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0" />
<g class="verticalgrid">
<text class="comment" x="233" y="77">
⚠️ with the exception of</text>
<g class="choice">
<path d=" M 141 105 h 24 m 28 0 h 32" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="165" y="94" />
<text x="179" y="110">
"</text>
</g>
<path d=" M 141 105 a 12 12 0 0 1 12 12 v 9 m 60 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 153 126 v 33 m 60 0 v -33" />
<path d=" M 153 126 v 0 a 12 12 0 0 0 12 12 m 28 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="165" y="127" />
<text x="179" y="143">
\</text>
</g>
<path d=" M 153 159 v 0 a 12 12 0 0 0 12 12 m 36 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-CR">
<g class="nonterminal">
<rect height="22" width="36" x="165" y="160" />
<text x="183" y="176">
CR</text>
</g>
</a>
</g>
</g>
<a class="link" xlink:href="#railroad-CHAR">
<g class="nonterminal">
<rect height="22" width="52" x="141" y="190" />
<text x="167" y="206">
CHAR</text>
</g>
</a>
</g>
</g>
<path d=" M 109 201 a 12 12 0 0 1 12 12 v 17 m 225 0 v -17 a 12 12 0 0 1 12 -12" />
<path d=" M 121 230 v 33 m 225 0 v -33" />
<path d=" M 121 263 v 33 m 225 0 v -33" />
<path d=" M 121 296 v 33 m 225 0 v -33" />
<path d=" M 121 230 v 0 a 12 12 0 0 0 12 12 m 116 0 h 85 m -39 0 l -5 -5 m 0 10 l 5 -5 m 39 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-QUOTE_ESCAPE">
<g class="nonterminal">
<rect height="22" width="116" x="133" y="231" />
<text x="191" y="247">
QUOTE_ESCAPE</text>
</g>
</a>
</g>
<path d=" M 121 263 v 0 a 12 12 0 0 0 12 12 m 116 0 h 85 m -39 0 l -5 -5 m 0 10 l 5 -5 m 39 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ASCII_ESCAPE">
<g class="nonterminal">
<rect height="22" width="116" x="133" y="264" />
<text x="191" y="280">
ASCII_ESCAPE</text>
</g>
</a>
</g>
<path d=" M 121 296 v 0 a 12 12 0 0 0 12 12 m 132 0 h 69 m -31 0 l -5 -5 m 0 10 l 5 -5 m 31 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-UNICODE_ESCAPE">
<g class="nonterminal">
<rect height="22" width="132" x="133" y="297" />
<text x="199" y="313">
UNICODE_ESCAPE</text>
</g>
</a>
</g>
<path d=" M 121 329 v 0 a 12 12 0 0 0 12 12 m 140 0 h 61 m -27 0 l -5 -5 m 0 10 l 5 -5 m 27 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-STRING_CONTINUE">
<g class="nonterminal">
<rect height="22" width="140" x="133" y="330" />
<text x="203" y="346">
STRING_CONTINUE</text>
</g>
</a>
</g>
</g>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="404" y="190" />
<text x="418" y="206">
"</text>
</g>
<g class="optional">
<path d=" M 442 201 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 68 m -31 0 l -5 -5 m 0 10 l 5 -5 m 31 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-SUFFIX">
<g class="nonterminal">
<rect height="22" width="68" x="466" y="190" />
<text x="500" y="206">
SUFFIX</text>
</g>
</a>
</g>
<path d=" M 63 201 h 10" />
<path d=" M 394 201 h 10" />
<path d=" M 432 201 h 10" />
</g>
<path d=" M 568 201 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 201 h 10" />
<path d=" M 558 201 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 144px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-STRING_CONTINUE"><svg class="railroad" viewbox="0 0 144 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-STRING_CONTINUE">
<text class="comment" x="67" y="25">
STRING_CONTINUE</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="42" />
<text x="49" y="58">
\</text>
</g>
<a class="link" xlink:href="#railroad-LF">
<g class="nonterminal">
<rect height="22" width="36" x="73" y="42" />
<text x="91" y="58">
LF</text>
</g>
</a>
<path d=" M 63 53 h 10" />
</g>
<path d=" M 119 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 109 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-lex.token.literal.str.intro"><a class="rule-link" href="#r-lex.token.literal.str.intro" title="lex.token.literal.str.intro"><span>[lex<wbr>.token<wbr>.literal<wbr>.str<wbr>.intro]</span></a>
</div>

<p>字符串字面量是任何Unicode字符序列，用两个<code>U+0022</code>（双引号）字符括起来，但<code>U+0022</code>本身除外，它必须通过前面加一个<code>U+005C</code>字符（<code>\</code>）进行转义。</p>
<div class="rule" id="r-lex.token.literal.str.linefeed"><a class="rule-link" href="#r-lex.token.literal.str.linefeed" title="lex.token.literal.str.linefeed"><span>[lex<wbr>.token<wbr>.literal<wbr>.str<wbr>.linefeed]</span></a>
</div>

<p>换行符（由字符<code>U+000A</code> (LF)表示）在字符串字面量中是允许的。字符<code>U+000D</code> (CR)不得出现在字符串字面量中。当未转义的<code>U+005C</code>字符（<code>\</code>）紧接在换行符之前时，换行符不会出现在词法单元所表示的字符串中。有关详细信息，请参阅<a href="#string-continuation-escapes">字符串续行转义</a>。</p>
<div class="rule" id="r-lex.token.literal.char-escape"><a class="rule-link" href="#r-lex.token.literal.char-escape" title="lex.token.literal.char-escape"><span>[lex<wbr>.token<wbr>.literal<wbr>.char-escape]</span></a>
</div>

<h4 id="字符转义"><a class="header" href="#字符转义">字符转义</a></h4>
<div class="rule" id="r-lex.token.literal.char-escape.intro"><a class="rule-link" href="#r-lex.token.literal.char-escape.intro" title="lex.token.literal.char-escape.intro"><span>[lex<wbr>.token<wbr>.literal<wbr>.char-escape<wbr>.intro]</span></a>
</div>

<p>在字符或非原始字符串字面量中，还有一些额外的_转义_可用。转义以<code>U+005C</code>（<code>\</code>）开头，并接以下形式之一：</p>
<div class="rule" id="r-lex.token.literal.char-escape.ascii"><a class="rule-link" href="#r-lex.token.literal.char-escape.ascii" title="lex.token.literal.char-escape.ascii"><span>[lex<wbr>.token<wbr>.literal<wbr>.char-escape<wbr>.ascii]</span></a>
</div>

<ul>
<li>7位码点转义以<code>U+0078</code>（<code>x</code>）开头，后跟恰好两个十六进制数字，值最大为<code>0x7F</code>。它表示ASCII字符，其值等于提供的十六进制值。不允许更高的值，因为它们是Unicode码点还是字节值存在歧义。</li>
</ul>
<div class="rule" id="r-lex.token.literal.char-escape.unicode"><a class="rule-link" href="#r-lex.token.literal.char-escape.unicode" title="lex.token.literal.char-escape.unicode"><span>[lex<wbr>.token<wbr>.literal<wbr>.char-escape<wbr>.unicode]</span></a>
</div>

<ul>
<li>24位码点转义以<code>U+0075</code>（<code>u</code>）开头，后跟最多六个十六进制数字，并用花括号<code>U+007B</code>（<code>{</code>）和<code>U+007D</code>（<code>}</code>）括起来。它表示等于所提供十六进制值的Unicode码点。该值必须是有效的Unicode标量值。</li>
</ul>
<div class="rule" id="r-lex.token.literal.char-escape.whitespace"><a class="rule-link" href="#r-lex.token.literal.char-escape.whitespace" title="lex.token.literal.char-escape.whitespace"><span>[lex<wbr>.token<wbr>.literal<wbr>.char-escape<wbr>.whitespace]</span></a>
</div>

<ul>
<li>空白转义是字符<code>U+006E</code>（<code>n</code>）、<code>U+0072</code>（<code>r</code>）或<code>U+0074</code>（<code>t</code>）之一，分别表示Unicode值<code>U+000A</code> (LF)、<code>U+000D</code> (CR)或<code>U+0009</code> (HT)。</li>
</ul>
<div class="rule" id="r-lex.token.literal.char-escape.null"><a class="rule-link" href="#r-lex.token.literal.char-escape.null" title="lex.token.literal.char-escape.null"><span>[lex<wbr>.token<wbr>.literal<wbr>.char-escape<wbr>.null]</span></a>
</div>

<ul>
<li>空转义是字符<code>U+0030</code>（<code>0</code>），表示Unicode值<code>U+0000</code> (NUL)。</li>
</ul>
<div class="rule" id="r-lex.token.literal.char-escape.slash"><a class="rule-link" href="#r-lex.token.literal.char-escape.slash" title="lex.token.literal.char-escape.slash"><span>[lex<wbr>.token<wbr>.literal<wbr>.char-escape<wbr>.slash]</span></a>
</div>

<ul>
<li>反斜杠转义是字符<code>U+005C</code>（<code>\</code>），它必须被转义才能表示自身。</li>
</ul>
<div class="rule" id="r-lex.token.literal.str-raw"><a class="rule-link" href="#r-lex.token.literal.str-raw" title="lex.token.literal.str-raw"><span>[lex<wbr>.token<wbr>.literal<wbr>.str-raw]</span></a>
</div>

<h4 id="原始字符串字面量"><a class="header" href="#原始字符串字面量">原始字符串字面量</a></h4>
<div class="rule" id="r-lex.token.literal.str-raw.syntax"><a class="rule-link" href="#r-lex.token.literal.str-raw.syntax" title="lex.token.literal.str-raw.syntax"><span>[lex<wbr>.token<wbr>.literal<wbr>.str-raw<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-RAW_STRING_LITERAL" onclick="show_railroad()"><a href="#railroad-RAW_STRING_LITERAL">RAW_STRING_LITERAL</a></span> → <span class="grammar-literal">r</span> <span class="grammar-text"><a href="#grammar-RAW_STRING_CONTENT">RAW_STRING_CONTENT</a></span> <span class="grammar-text"><a href="#grammar-SUFFIX">SUFFIX</a></span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-RAW_STRING_CONTENT" onclick="show_railroad()"><a href="#railroad-RAW_STRING_CONTENT">RAW_STRING_CONTENT</a></span> → <br>      <span class="grammar-literal">"</span> ( ~<span class="grammar-text"><a href="#grammar-CR">CR</a></span> )<sup>* (non-greedy)</sup> <span class="grammar-literal">"</span> <br>    | <span class="grammar-literal">#</span> <span class="grammar-text"><a href="#grammar-RAW_STRING_CONTENT">RAW_STRING_CONTENT</a></span> <span class="grammar-literal">#</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 398px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RAW_STRING_LITERAL"><svg class="railroad" viewbox="0 0 398 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RAW_STRING_LITERAL">
<text class="comment" x="78" y="25">
RAW_STRING_LITERAL</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="55" />
<text x="49" y="71">
r</text>
</g>
<a class="link" xlink:href="#railroad-RAW_STRING_CONTENT">
<g class="nonterminal">
<rect height="22" width="164" x="73" y="55" />
<text x="155" y="71">
RAW_STRING_CONTENT</text>
</g>
</a>
<g class="optional">
<path d=" M 247 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 68 m -31 0 l -5 -5 m 0 10 l 5 -5 m 31 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-SUFFIX">
<g class="nonterminal">
<rect height="22" width="68" x="271" y="55" />
<text x="305" y="71">
SUFFIX</text>
</g>
</a>
</g>
<path d=" M 63 66 h 10" />
<path d=" M 237 66 h 10" />
</g>
<path d=" M 373 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 363 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 483px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RAW_STRING_CONTENT"><svg class="railroad" viewbox="0 0 483 251" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RAW_STRING_CONTENT">
<text class="comment" x="78" y="25">
RAW_STRING_CONTENT</text>
</a>
<g class="sequence">
<path d=" M 10 171 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 171 h 24 m 365 0 h 24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="160" />
<text x="73" y="176">
"</text>
</g>
<g class="labeledbox">
<rect height="166" width="289" x="97" y="42" />
<path d=" M 97 171 h 8 m 273 0 h 8" />
<text class="comment" x="145" y="65">
non-greedy</text>
<g class="optional">
<path d=" M 105 171 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -69 m 0 37 l -5 5 m 10 0 l -5 -5 m 0 -37 a 12 12 0 0 1 12 -12 h 225 m -109 0 l -5 -5 m 0 10 l 5 -5 m 109 0 a 12 12 0 0 1 12 12 v 69 m 0 -31 l -5 -5 m 10 0 l -5 5 m 0 31 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 129 171 h 12 m 201 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 5 a 12 12 0 0 1 -12 12 m 0 0 h -201 m 103 0 l 5 -5 m 0 10 l -5 -5 m -103 0 a 12 12 0 0 1 -12 -12 v -5 a 12 12 0 0 1 12 -12" />
<g />
<g class="labeledbox exceptbox">
<rect height="100" width="201" x="141" y="90" />
<path d=" M 141 171 h 8 m 52 0 h 141 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0" />
<g class="verticalgrid">
<text class="comment" x="241" y="113">
⚠️ with the exception of</text>
<a class="link" xlink:href="#railroad-CR">
<g class="nonterminal">
<rect height="22" width="36" x="149" y="130" />
<text x="167" y="146">
CR</text>
</g>
</a>
</g>
<a class="link" xlink:href="#railroad-CHAR">
<g class="nonterminal">
<rect height="22" width="52" x="149" y="160" />
<text x="175" y="176">
CHAR</text>
</g>
</a>
</g>
</g>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="396" y="160" />
<text x="410" y="176">
"</text>
</g>
<path d=" M 87 171 h 10" />
<path d=" M 386 171 h 10" />
</g>
<path d=" M 35 171 a 12 12 0 0 1 12 12 v 35 m 389 0 v -35 a 12 12 0 0 1 12 -12" />
<path d=" M 47 218 v 0 a 12 12 0 0 0 12 12 m 240 0 h 125 m -59 0 l -5 -5 m 0 10 l 5 -5 m 59 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="219" />
<text x="73" y="235">
#</text>
</g>
<a class="link" xlink:href="#railroad-RAW_STRING_CONTENT">
<g class="nonterminal">
<rect height="22" width="164" x="97" y="219" />
<text x="179" y="235">
RAW_STRING_CONTENT</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="271" y="219" />
<text x="285" y="235">
#</text>
</g>
<path d=" M 87 230 h 10" />
<path d=" M 261 230 h 10" />
</g>
</g>
<path d=" M 458 171 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 171 h 10" />
<path d=" M 448 171 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-lex.token.literal.str-raw.intro"><a class="rule-link" href="#r-lex.token.literal.str-raw.intro" title="lex.token.literal.str-raw.intro"><span>[lex<wbr>.token<wbr>.literal<wbr>.str-raw<wbr>.intro]</span></a>
</div>

<p>原始字符串字面量不处理任何转义。它们以字符<code>U+0072</code>（<code>r</code>）开头，后跟少于256个<code>U+0023</code>（<code>#</code>）字符和一个<code>U+0022</code>（双引号）字符。</p>
<div class="rule" id="r-lex.token.literal.str-raw.body"><a class="rule-link" href="#r-lex.token.literal.str-raw.body" title="lex.token.literal.str-raw.body"><span>[lex<wbr>.token<wbr>.literal<wbr>.str-raw<wbr>.body]</span></a>
</div>

<p>原始字符串体可以包含除<code>U+000D</code> (CR)以外的任何Unicode字符序列。它只由另一个<code>U+0022</code>（双引号）字符终止，后跟与起始<code>U+0022</code>（双引号）字符前相同数量的<code>U+0023</code>（<code>#</code>）字符。</p>
<div class="rule" id="r-lex.token.literal.str-raw.content"><a class="rule-link" href="#r-lex.token.literal.str-raw.content" title="lex.token.literal.str-raw.content"><span>[lex<wbr>.token<wbr>.literal<wbr>.str-raw<wbr>.content]</span></a>
</div>

<p>原始字符串体中包含的所有Unicode字符都表示其本身，字符<code>U+0022</code>（双引号）（除非后面紧跟的<code>U+0023</code>（<code>#</code>）字符数量与用于开始原始字符串字面量的字符数量相同或更多）或<code>U+005C</code>（<code>\</code>）不具有任何特殊含义。</p>
<p>字符串字面量示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>"foo"; r"foo";                     // foo
"\"foo\""; r#""foo""#;             // "foo"

"foo #\"# bar";
r##"foo #"# bar"##;                // foo #"# bar

"\x52"; "R"; r"R";                 // R
"\\x52"; r"\x52";                  // \x52
<span class="boring">}</span></code></pre>
<h3 id="字节和字节字符串字面量"><a class="header" href="#字节和字节字符串字面量">字节和字节字符串字面量</a></h3>
<div class="rule" id="r-lex.token.byte"><a class="rule-link" href="#r-lex.token.byte" title="lex.token.byte"><span>[lex<wbr>.token<wbr>.byte]</span></a>
</div>

<h4 id="字节字面量"><a class="header" href="#字节字面量">字节字面量</a></h4>
<div class="rule" id="r-lex.token.byte.syntax"><a class="rule-link" href="#r-lex.token.byte.syntax" title="lex.token.byte.syntax"><span>[lex<wbr>.token<wbr>.byte<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-BYTE_LITERAL" onclick="show_railroad()"><a href="#railroad-BYTE_LITERAL">BYTE_LITERAL</a></span> → <br>    <span class="grammar-literal">b'</span> ( <span class="grammar-text"><a href="#grammar-ASCII_FOR_CHAR">ASCII_FOR_CHAR</a></span> | <span class="grammar-text"><a href="#grammar-BYTE_ESCAPE">BYTE_ESCAPE</a></span> ) <span class="grammar-literal">'</span> <span class="grammar-text"><a href="#grammar-SUFFIX">SUFFIX</a></span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-ASCII_FOR_CHAR" onclick="show_railroad()"><a href="#railroad-ASCII_FOR_CHAR">ASCII_FOR_CHAR</a></span> → <br>    <span class="grammar-text">&lt;any ASCII (i.e. 0x00 to 0x7F) except <code>'</code>, <code>\</code>, LF, CR, or TAB&gt;</span></p>
<p><span class="grammar-text grammar-production" id="grammar-BYTE_ESCAPE" onclick="show_railroad()"><a href="#railroad-BYTE_ESCAPE">BYTE_ESCAPE</a></span> → <br>      <span class="grammar-literal">\x</span> <span class="grammar-text"><a href="#grammar-HEX_DIGIT">HEX_DIGIT</a></span> <span class="grammar-text"><a href="#grammar-HEX_DIGIT">HEX_DIGIT</a></span> <br>    | <span class="grammar-literal">\n</span> | <span class="grammar-literal">\r</span> | <span class="grammar-literal">\t</span> | <span class="grammar-literal">\\</span> | <span class="grammar-literal">\0</span> | <span class="grammar-literal">\'</span> | <span class="grammar-literal">\"</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 460px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-BYTE_LITERAL"><svg class="railroad" viewbox="0 0 460 120" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-BYTE_LITERAL">
<text class="comment" x="57" y="25">
BYTE_LITERAL</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="55" />
<text x="53" y="71">
b'</text>
</g>
<g class="choice">
<path d=" M 81 66 h 24 m 132 0 h 24" />
<a class="link" xlink:href="#railroad-ASCII_FOR_CHAR">
<g class="nonterminal">
<rect height="22" width="132" x="105" y="55" />
<text x="171" y="71">
ASCII_FOR_CHAR</text>
</g>
</a>
<path d=" M 81 66 a 12 12 0 0 1 12 12 v 9 m 156 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 93 87 v 0 a 12 12 0 0 0 12 12 m 108 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-BYTE_ESCAPE">
<g class="nonterminal">
<rect height="22" width="108" x="105" y="88" />
<text x="159" y="104">
BYTE_ESCAPE</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="271" y="55" />
<text x="285" y="71">
'</text>
</g>
<g class="optional">
<path d=" M 309 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 68 m -31 0 l -5 -5 m 0 10 l 5 -5 m 31 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-SUFFIX">
<g class="nonterminal">
<rect height="22" width="68" x="333" y="55" />
<text x="367" y="71">
SUFFIX</text>
</g>
</a>
</g>
<path d=" M 71 66 h 10" />
<path d=" M 261 66 h 10" />
<path d=" M 299 66 h 10" />
</g>
<path d=" M 435 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 425 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 602px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ASCII_FOR_CHAR"><svg class="railroad" viewbox="0 0 602 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ASCII_FOR_CHAR">
<text class="comment" x="64" y="25">
ASCII_FOR_CHAR</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="532" x="35" y="42" />
<text x="301" y="58">
any ASCII (i.e. 0x00 to 0x7F) except `'`, `\`, LF, CR, or TAB</text>
</g>
</g>
<path d=" M 577 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 567 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 358px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-BYTE_ESCAPE"><svg class="railroad" viewbox="0 0 358 305" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-BYTE_ESCAPE">
<text class="comment" x="53" y="25">
BYTE_ESCAPE</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 240 0 h 24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="42" />
<text x="77" y="58">
\x</text>
</g>
<a class="link" xlink:href="#railroad-HEX_DIGIT">
<g class="nonterminal">
<rect height="22" width="92" x="105" y="42" />
<text x="151" y="58">
HEX_DIGIT</text>
</g>
</a>
<a class="link" xlink:href="#railroad-HEX_DIGIT">
<g class="nonterminal">
<rect height="22" width="92" x="207" y="42" />
<text x="253" y="58">
HEX_DIGIT</text>
</g>
</a>
<path d=" M 95 53 h 10" />
<path d=" M 197 53 h 10" />
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 264 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 264 0 v -33" />
<path d=" M 47 107 v 33 m 264 0 v -33" />
<path d=" M 47 140 v 33 m 264 0 v -33" />
<path d=" M 47 173 v 33 m 264 0 v -33" />
<path d=" M 47 206 v 33 m 264 0 v -33" />
<path d=" M 47 239 v 33 m 264 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 36 0 h 204 m -99 0 l -5 -5 m 0 10 l 5 -5 m 99 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="75" />
<text x="77" y="91">
\n</text>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 36 0 h 204 m -99 0 l -5 -5 m 0 10 l 5 -5 m 99 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="108" />
<text x="77" y="124">
\r</text>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 36 0 h 204 m -99 0 l -5 -5 m 0 10 l 5 -5 m 99 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="141" />
<text x="77" y="157">
\t</text>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 36 0 h 204 m -99 0 l -5 -5 m 0 10 l 5 -5 m 99 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="174" />
<text x="77" y="190">
\\</text>
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 36 0 h 204 m -99 0 l -5 -5 m 0 10 l 5 -5 m 99 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="207" />
<text x="77" y="223">
\0</text>
</g>
<path d=" M 47 239 v 0 a 12 12 0 0 0 12 12 m 36 0 h 204 m -99 0 l -5 -5 m 0 10 l 5 -5 m 99 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="240" />
<text x="77" y="256">
\'</text>
</g>
<path d=" M 47 272 v 0 a 12 12 0 0 0 12 12 m 36 0 h 204 m -99 0 l -5 -5 m 0 10 l 5 -5 m 99 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="273" />
<text x="77" y="289">
\"</text>
</g>
</g>
<path d=" M 333 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 323 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-lex.token.byte.intro"><a class="rule-link" href="#r-lex.token.byte.intro" title="lex.token.byte.intro"><span>[lex<wbr>.token<wbr>.byte<wbr>.intro]</span></a>
</div>

<p>字节字面量是一个单个ASCII字符（在<code>U+0000</code>到<code>U+007F</code>范围内）或一个单个_转义_字符，前面带有字符<code>U+0062</code>（<code>b</code>）和<code>U+0027</code>（单引号），后面带有字符<code>U+0027</code>。如果<code>U+0027</code>字符出现在字面量中，它必须通过前面加一个<code>U+005C</code>（<code>\</code>）字符进行转义。它等同于一个<code>u8</code>无符号8位整数数字字面量。</p>
<div class="rule" id="r-lex.token.str-byte"><a class="rule-link" href="#r-lex.token.str-byte" title="lex.token.str-byte"><span>[lex<wbr>.token<wbr>.str-byte]</span></a>
</div>

<h4 id="字节字符串字面量"><a class="header" href="#字节字符串字面量">字节字符串字面量</a></h4>
<div class="rule" id="r-lex.token.str-byte.syntax"><a class="rule-link" href="#r-lex.token.str-byte.syntax" title="lex.token.str-byte.syntax"><span>[lex<wbr>.token<wbr>.str-byte<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-BYTE_STRING_LITERAL" onclick="show_railroad()"><a href="#railroad-BYTE_STRING_LITERAL">BYTE_STRING_LITERAL</a></span> → <br>    <span class="grammar-literal">b"</span> ( <span class="grammar-text"><a href="#grammar-ASCII_FOR_STRING">ASCII_FOR_STRING</a></span> | <span class="grammar-text"><a href="#grammar-BYTE_ESCAPE">BYTE_ESCAPE</a></span> | <span class="grammar-text"><a href="#grammar-STRING_CONTINUE">STRING_CONTINUE</a></span> )<sup>*</sup> <span class="grammar-literal">"</span> <span class="grammar-text"><a href="#grammar-SUFFIX">SUFFIX</a></span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-ASCII_FOR_STRING" onclick="show_railroad()"><a href="#railroad-ASCII_FOR_STRING">ASCII_FOR_STRING</a></span> → <br>    <span class="grammar-text">&lt;any ASCII (i.e 0x00 to 0x7F) except <code>"</code>, <code>\</code>, or CR&gt;</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 548px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-BYTE_STRING_LITERAL"><svg class="railroad" viewbox="0 0 548 163" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-BYTE_STRING_LITERAL">
<text class="comment" x="81" y="25">
BYTE_STRING_LITERAL</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="55" />
<text x="53" y="71">
b"</text>
</g>
<g class="optional">
<path d=" M 81 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 220 m -107 0 l -5 -5 m 0 10 l 5 -5 m 107 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 105 66 h 12 m 196 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 63 m 0 -28 l -5 -5 m 10 0 l -5 5 m 0 28 a 12 12 0 0 1 -12 12 m 0 0 h -196 m 101 0 l 5 -5 m 0 10 l -5 -5 m -101 0 a 12 12 0 0 1 -12 -12 v -63 m 0 34 l -5 5 m 10 0 l -5 -5 m 0 -34 a 12 12 0 0 1 12 -12" />
<g />
<g class="choice">
<path d=" M 117 66 h 24 m 148 0 h 24" />
<a class="link" xlink:href="#railroad-ASCII_FOR_STRING">
<g class="nonterminal">
<rect height="22" width="148" x="141" y="55" />
<text x="215" y="71">
ASCII_FOR_STRING</text>
</g>
</a>
<path d=" M 117 66 a 12 12 0 0 1 12 12 v 9 m 172 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 129 87 v 33 m 172 0 v -33" />
<path d=" M 129 87 v 0 a 12 12 0 0 0 12 12 m 108 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-BYTE_ESCAPE">
<g class="nonterminal">
<rect height="22" width="108" x="141" y="88" />
<text x="195" y="104">
BYTE_ESCAPE</text>
</g>
</a>
<path d=" M 129 120 v 0 a 12 12 0 0 0 12 12 m 140 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-STRING_CONTINUE">
<g class="nonterminal">
<rect height="22" width="140" x="141" y="121" />
<text x="211" y="137">
STRING_CONTINUE</text>
</g>
</a>
</g>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="359" y="55" />
<text x="373" y="71">
"</text>
</g>
<g class="optional">
<path d=" M 397 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 68 m -31 0 l -5 -5 m 0 10 l 5 -5 m 31 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-SUFFIX">
<g class="nonterminal">
<rect height="22" width="68" x="421" y="55" />
<text x="455" y="71">
SUFFIX</text>
</g>
</a>
</g>
<path d=" M 71 66 h 10" />
<path d=" M 349 66 h 10" />
<path d=" M 387 66 h 10" />
</g>
<path d=" M 523 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 513 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 514px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ASCII_FOR_STRING"><svg class="railroad" viewbox="0 0 514 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ASCII_FOR_STRING">
<text class="comment" x="71" y="25">
ASCII_FOR_STRING</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="444" x="35" y="42" />
<text x="257" y="58">
any ASCII (i.e 0x00 to 0x7F) except `"`, `\`, or CR</text>
</g>
</g>
<path d=" M 489 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 479 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-lex.token.str-byte.intro"><a class="rule-link" href="#r-lex.token.str-byte.intro" title="lex.token.str-byte.intro"><span>[lex<wbr>.token<wbr>.str-byte<wbr>.intro]</span></a>
</div>

<p>非原始字节字符串字面量是一个ASCII字符和_转义_序列，前面带有字符<code>U+0062</code>（<code>b</code>）和<code>U+0022</code>（双引号），后面带有字符<code>U+0022</code>。如果<code>U+0022</code>字符出现在字面量中，它必须通过前面加一个<code>U+005C</code>（<code>\</code>）字符进行转义。另外，字节字符串字面量可以是下面定义的原始字节字符串字面量。</p>
<div class="rule" id="r-lex.token.str-byte.linefeed"><a class="rule-link" href="#r-lex.token.str-byte.linefeed" title="lex.token.str-byte.linefeed"><span>[lex<wbr>.token<wbr>.str-byte<wbr>.linefeed]</span></a>
</div>

<p>换行符（由字符<code>U+000A</code> (LF)表示）在字节字符串字面量中是允许的。字符<code>U+000D</code> (CR)不得出现在字节字符串字面量中。当未转义的<code>U+005C</code>字符（<code>\</code>）紧接在换行符之前时，换行符不会出现在词法单元所表示的字符串中。有关详细信息，请参阅<a href="#string-continuation-escapes">字符串续行转义</a>。</p>
<div class="rule" id="r-lex.token.str-byte.escape"><a class="rule-link" href="#r-lex.token.str-byte.escape" title="lex.token.str-byte.escape"><span>[lex<wbr>.token<wbr>.str-byte<wbr>.escape]</span></a>
</div>

<p>在字节或非原始字节字符串字面量中，还有一些额外的_转义_可用。转义以<code>U+005C</code>（<code>\</code>）开头，并接以下形式之一：</p>
<div class="rule" id="r-lex.token.str-byte.escape-byte"><a class="rule-link" href="#r-lex.token.str-byte.escape-byte" title="lex.token.str-byte.escape-byte"><span>[lex<wbr>.token<wbr>.str-byte<wbr>.escape-byte]</span></a>
</div>

<ul>
<li>字节转义以<code>U+0078</code>（<code>x</code>）开头，后跟恰好两个十六进制数字。它表示等于所提供十六进制值的字节。</li>
</ul>
<div class="rule" id="r-lex.token.str-byte.escape-whitespace"><a class="rule-link" href="#r-lex.token.str-byte.escape-whitespace" title="lex.token.str-byte.escape-whitespace"><span>[lex<wbr>.token<wbr>.str-byte<wbr>.escape-whitespace]</span></a>
</div>

<ul>
<li>空白转义是字符<code>U+006E</code>（<code>n</code>）、<code>U+0072</code>（<code>r</code>）或<code>U+0074</code>（<code>t</code>）之一，分别表示字节值<code>0x0A</code> (ASCII LF)、<code>0x0D</code> (ASCII CR)或<code>0x09</code> (ASCII HT)。</li>
</ul>
<div class="rule" id="r-lex.token.str-byte.escape-null"><a class="rule-link" href="#r-lex.token.str-byte.escape-null" title="lex.token.str-byte.escape-null"><span>[lex<wbr>.token<wbr>.str-byte<wbr>.escape-null]</span></a>
</div>

<ul>
<li>空转义是字符<code>U+0030</code>（<code>0</code>），表示字节值<code>0x00</code> (ASCII NUL)。</li>
</ul>
<div class="rule" id="r-lex.token.str-byte.escape-slash"><a class="rule-link" href="#r-lex.token.str-byte.escape-slash" title="lex.token.str-byte.escape-slash"><span>[lex<wbr>.token<wbr>.str-byte<wbr>.escape-slash]</span></a>
</div>

<ul>
<li>反斜杠转义是字符<code>U+005C</code>（<code>\</code>），它必须被转义才能表示其ASCII编码<code>0x5C</code>。</li>
</ul>
<div class="rule" id="r-lex.token.str-byte-raw"><a class="rule-link" href="#r-lex.token.str-byte-raw" title="lex.token.str-byte-raw"><span>[lex<wbr>.token<wbr>.str-byte-raw]</span></a>
</div>

<h4 id="原始字节字符串字面量"><a class="header" href="#原始字节字符串字面量">原始字节字符串字面量</a></h4>
<div class="rule" id="r-lex.token.str-byte-raw.syntax"><a class="rule-link" href="#r-lex.token.str-byte-raw.syntax" title="lex.token.str-byte-raw.syntax"><span>[lex<wbr>.token<wbr>.str-byte-raw<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-RAW_BYTE_STRING_LITERAL" onclick="show_railroad()"><a href="#railroad-RAW_BYTE_STRING_LITERAL">RAW_BYTE_STRING_LITERAL</a></span> → <br>    <span class="grammar-literal">br</span> <span class="grammar-text"><a href="#grammar-RAW_BYTE_STRING_CONTENT">RAW_BYTE_STRING_CONTENT</a></span> <span class="grammar-text"><a href="#grammar-SUFFIX">SUFFIX</a></span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-RAW_BYTE_STRING_CONTENT" onclick="show_railroad()"><a href="#railroad-RAW_BYTE_STRING_CONTENT">RAW_BYTE_STRING_CONTENT</a></span> → <br>      <span class="grammar-literal">"</span> <span class="grammar-text"><a href="#grammar-ASCII_FOR_RAW">ASCII_FOR_RAW</a></span><sup>* (non-greedy)</sup> <span class="grammar-literal">"</span> <br>    | <span class="grammar-literal">#</span> <span class="grammar-text"><a href="#grammar-RAW_BYTE_STRING_CONTENT">RAW_BYTE_STRING_CONTENT</a></span> <span class="grammar-literal">#</span></p>
<p><span class="grammar-text grammar-production" id="grammar-ASCII_FOR_RAW" onclick="show_railroad()"><a href="#railroad-ASCII_FOR_RAW">ASCII_FOR_RAW</a></span> → <br>    <span class="grammar-text">&lt;any ASCII (i.e. 0x00 to 0x7F) except CR&gt;</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 454px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RAW_BYTE_STRING_LITERAL"><svg class="railroad" viewbox="0 0 454 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RAW_BYTE_STRING_LITERAL">
<text class="comment" x="99" y="25">
RAW_BYTE_STRING_LITERAL</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="55" />
<text x="53" y="71">
br</text>
</g>
<a class="link" xlink:href="#railroad-RAW_BYTE_STRING_CONTENT">
<g class="nonterminal">
<rect height="22" width="212" x="81" y="55" />
<text x="187" y="71">
RAW_BYTE_STRING_CONTENT</text>
</g>
</a>
<g class="optional">
<path d=" M 303 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 68 m -31 0 l -5 -5 m 0 10 l 5 -5 m 31 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-SUFFIX">
<g class="nonterminal">
<rect height="22" width="68" x="327" y="55" />
<text x="361" y="71">
SUFFIX</text>
</g>
</a>
</g>
<path d=" M 71 66 h 10" />
<path d=" M 293 66 h 10" />
</g>
<path d=" M 429 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 419 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 406px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RAW_BYTE_STRING_CONTENT"><svg class="railroad" viewbox="0 0 406 177" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RAW_BYTE_STRING_CONTENT">
<text class="comment" x="99" y="25">
RAW_BYTE_STRING_CONTENT</text>
</a>
<g class="sequence">
<path d=" M 10 102 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 102 h 24 m 288 0 h 24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="91" />
<text x="73" y="107">
"</text>
</g>
<g class="labeledbox">
<rect height="92" width="212" x="97" y="42" />
<path d=" M 97 102 h 8 m 196 0 h 8" />
<text class="comment" x="145" y="65">
non-greedy</text>
<g class="optional">
<path d=" M 105 102 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 148 m -71 0 l -5 -5 m 0 10 l 5 -5 m 71 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 129 102 h 12 m 124 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -124 m 65 0 l 5 -5 m 0 10 l -5 -5 m -65 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-ASCII_FOR_RAW">
<g class="nonterminal">
<rect height="22" width="124" x="141" y="91" />
<text x="203" y="107">
ASCII_FOR_RAW</text>
</g>
</a>
</g>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="319" y="91" />
<text x="333" y="107">
"</text>
</g>
<path d=" M 87 102 h 10" />
<path d=" M 309 102 h 10" />
</g>
<path d=" M 35 102 a 12 12 0 0 1 12 12 v 30 m 312 0 v -30 a 12 12 0 0 1 12 -12" />
<path d=" M 47 144 v 0 a 12 12 0 0 0 12 12 m 288 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="145" />
<text x="73" y="161">
#</text>
</g>
<a class="link" xlink:href="#railroad-RAW_BYTE_STRING_CONTENT">
<g class="nonterminal">
<rect height="22" width="212" x="97" y="145" />
<text x="203" y="161">
RAW_BYTE_STRING_CONTENT</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="319" y="145" />
<text x="333" y="161">
#</text>
</g>
<path d=" M 87 156 h 10" />
<path d=" M 309 156 h 10" />
</g>
</g>
<path d=" M 381 102 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 102 h 10" />
<path d=" M 371 102 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 410px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ASCII_FOR_RAW"><svg class="railroad" viewbox="0 0 410 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ASCII_FOR_RAW">
<text class="comment" x="60" y="25">
ASCII_FOR_RAW</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="340" x="35" y="42" />
<text x="205" y="58">
any ASCII (i.e. 0x00 to 0x7F) except CR</text>
</g>
</g>
<path d=" M 385 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 375 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-lex.token.str-byte-raw.intro"><a class="rule-link" href="#r-lex.token.str-byte-raw.intro" title="lex.token.str-byte-raw.intro"><span>[lex<wbr>.token<wbr>.str-byte-raw<wbr>.intro]</span></a>
</div>

<p>原始字节字符串字面量不处理任何转义。它们以字符<code>U+0062</code>（<code>b</code>）开头，后跟<code>U+0072</code>（<code>r</code>），再后跟少于256个<code>U+0023</code>（<code>#</code>）字符和一个<code>U+0022</code>（双引号）字符。</p>
<div class="rule" id="r-lex.token.str-byte-raw.body"><a class="rule-link" href="#r-lex.token.str-byte-raw.body" title="lex.token.str-byte-raw.body"><span>[lex<wbr>.token<wbr>.str-byte-raw<wbr>.body]</span></a>
</div>

<p>原始字符串体可以包含除<code>U+000D</code> (CR)以外的任何ASCII字符序列。它只由另一个<code>U+0022</code>（双引号）字符终止，后跟与起始<code>U+0022</code>（双引号）字符前相同数量的<code>U+0023</code>（<code>#</code>）字符。原始字节字符串字面量不能包含任何非ASCII字节。</p>
<div class="rule" id="r-lex.token.literal.str-byte-raw.content"><a class="rule-link" href="#r-lex.token.literal.str-byte-raw.content" title="lex.token.literal.str-byte-raw.content"><span>[lex<wbr>.token<wbr>.literal<wbr>.str-byte-raw<wbr>.content]</span></a>
</div>

<p>原始字符串体中包含的所有字符都表示其ASCII编码，字符<code>U+0022</code>（双引号）（除非后面紧跟的<code>U+0023</code>（<code>#</code>）字符数量与用于开始原始字符串字面量的字符数量相同或更多）或<code>U+005C</code>（<code>\</code>）不具有任何特殊含义。</p>
<p>字节字符串字面量示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>b"foo"; br"foo";                     // foo
b"\"foo\""; br#""foo""#;             // "foo"

b"foo #\"# bar";
br##"foo #"# bar"##;                 // foo #"# bar

b"\x52"; b"R"; br"R";                // R
b"\\x52"; br"\x52";                  // \x52
<span class="boring">}</span></code></pre>
<h3 id="c字符串和原始c字符串字面量"><a class="header" href="#c字符串和原始c字符串字面量">C字符串和原始C字符串字面量</a></h3>
<div class="rule" id="r-lex.token.str-c"><a class="rule-link" href="#r-lex.token.str-c" title="lex.token.str-c"><span>[lex<wbr>.token<wbr>.str-c]</span></a>
</div>

<h4 id="c字符串字面量"><a class="header" href="#c字符串字面量">C字符串字面量</a></h4>
<div class="rule" id="r-lex.token.str-c.syntax"><a class="rule-link" href="#r-lex.token.str-c.syntax" title="lex.token.str-c.syntax"><span>[lex<wbr>.token<wbr>.str-c<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-C_STRING_LITERAL" onclick="show_railroad()"><a href="#railroad-C_STRING_LITERAL">C_STRING_LITERAL</a></span> → <br>    <span class="grammar-literal">c"</span> ( <br>        ~[<span class="grammar-literal">"</span> <span class="grammar-literal">\</span> <a href="#grammar-CR">CR</a> <a href="#grammar-NUL">NUL</a>] <br>      | <span class="grammar-text"><a href="#grammar-BYTE_ESCAPE">BYTE_ESCAPE</a></span><sub class="grammar-text">except <code>\0</code> or <code>\x00</code></sub> <br>      | <span class="grammar-text"><a href="#grammar-UNICODE_ESCAPE">UNICODE_ESCAPE</a></span><sub class="grammar-text">except <code>\u{0}</code>, <code>\u{00}</code>, …, <code>\u{000000}</code></sub> <br>      | <span class="grammar-text"><a href="#grammar-STRING_CONTINUE">STRING_CONTINUE</a></span> <br>    )<sup>*</sup> <span class="grammar-literal">"</span> <span class="grammar-text"><a href="#grammar-SUFFIX">SUFFIX</a></span><sup>?</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 727px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-C_STRING_LITERAL"><svg class="railroad" viewbox="0 0 727 458" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-C_STRING_LITERAL">
<text class="comment" x="71" y="25">
C_STRING_LITERAL</text>
</a>
<g class="sequence">
<path d=" M 10 234 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="223" />
<text x="53" y="239">
c"</text>
</g>
<g class="optional">
<path d=" M 81 234 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -168 m 0 87 l -5 5 m 10 0 l -5 -5 m 0 -87 a 12 12 0 0 1 12 -12 h 399 m -196 0 l -5 -5 m 0 10 l 5 -5 m 196 0 a 12 12 0 0 1 12 12 v 168 m 0 -81 l -5 -5 m 10 0 l -5 5 m 0 81 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 105 234 h 12 m 375 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 190 m 0 -92 l -5 -5 m 10 0 l -5 5 m 0 92 a 12 12 0 0 1 -12 12 m 0 0 h -375 m 190 0 l 5 -5 m 0 10 l -5 -5 m -190 0 a 12 12 0 0 1 -12 -12 v -190 m 0 98 l -5 5 m 10 0 l -5 -5 m 0 -98 a 12 12 0 0 1 12 -12" />
<g />
<g class="choice">
<path d=" M 117 234 h 24 m 201 0 h 150 m -72 0 l -5 -5 m 0 10 l 5 -5 m 72 0" />
<g class="sequence">
<g class="labeledbox exceptbox">
<rect height="199" width="201" x="141" y="54" />
<path d=" M 141 234 h 8 m 52 0 h 141 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0" />
<g class="verticalgrid">
<text class="comment" x="241" y="77">
⚠️ with the exception of</text>
<g class="choice">
<path d=" M 149 105 h 24 m 28 0 h 40" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="173" y="94" />
<text x="187" y="110">
"</text>
</g>
<path d=" M 149 105 a 12 12 0 0 1 12 12 v 9 m 68 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 161 126 v 33 m 68 0 v -33" />
<path d=" M 161 159 v 33 m 68 0 v -33" />
<path d=" M 161 126 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="173" y="127" />
<text x="187" y="143">
\</text>
</g>
<path d=" M 161 159 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-CR">
<g class="nonterminal">
<rect height="22" width="36" x="173" y="160" />
<text x="191" y="176">
CR</text>
</g>
</a>
<path d=" M 161 192 v 0 a 12 12 0 0 0 12 12 m 44 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-NUL">
<g class="nonterminal">
<rect height="22" width="44" x="173" y="193" />
<text x="195" y="209">
NUL</text>
</g>
</a>
</g>
</g>
<a class="link" xlink:href="#railroad-CHAR">
<g class="nonterminal">
<rect height="22" width="52" x="149" y="223" />
<text x="175" y="239">
CHAR</text>
</g>
</a>
</g>
</g>
<path d=" M 117 234 a 12 12 0 0 1 12 12 v 17 m 351 0 v -17 a 12 12 0 0 1 12 -12" />
<path d=" M 129 298 v 41 m 351 0 v -41" />
<path d=" M 129 374 v 41 m 351 0 v -41" />
<path d=" M 129 263 v 35 a 12 12 0 0 0 12 12 m 180 0 h 147 m -70 0 l -5 -5 m 0 10 l 5 -5 m 70 0 a 12 12 0 0 0 12 -12 v -35" />
<g class="sequence">
<g class="labeledbox">
<rect height="66" width="180" x="141" y="263" />
<path d=" M 141 310 h 8 m 108 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0" />
<text class="comment" x="231" y="286">
except `\0` or `\x00`</text>
<a class="link" xlink:href="#railroad-BYTE_ESCAPE">
<g class="nonterminal">
<rect height="22" width="108" x="149" y="299" />
<text x="203" y="315">
BYTE_ESCAPE</text>
</g>
</a>
</g>
</g>
<path d=" M 129 339 v 35 a 12 12 0 0 0 12 12 m 327 0 h 0 a 12 12 0 0 0 12 -12 v -35" />
<g class="sequence">
<g class="labeledbox">
<rect height="66" width="327" x="141" y="339" />
<path d=" M 141 386 h 8 m 132 0 h 187 m -90 0 l -5 -5 m 0 10 l 5 -5 m 90 0" />
<text class="comment" x="304" y="362">
except `\u{0}`, `\u{00}`, …, `\u{000000}`</text>
<a class="link" xlink:href="#railroad-UNICODE_ESCAPE">
<g class="nonterminal">
<rect height="22" width="132" x="149" y="375" />
<text x="215" y="391">
UNICODE_ESCAPE</text>
</g>
</a>
</g>
</g>
<path d=" M 129 415 v 0 a 12 12 0 0 0 12 12 m 140 0 h 187 m -90 0 l -5 -5 m 0 10 l 5 -5 m 90 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-STRING_CONTINUE">
<g class="nonterminal">
<rect height="22" width="140" x="141" y="416" />
<text x="211" y="432">
STRING_CONTINUE</text>
</g>
</a>
</g>
</g>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="538" y="223" />
<text x="552" y="239">
"</text>
</g>
<g class="optional">
<path d=" M 576 234 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 68 m -31 0 l -5 -5 m 0 10 l 5 -5 m 31 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-SUFFIX">
<g class="nonterminal">
<rect height="22" width="68" x="600" y="223" />
<text x="634" y="239">
SUFFIX</text>
</g>
</a>
</g>
<path d=" M 71 234 h 10" />
<path d=" M 528 234 h 10" />
<path d=" M 566 234 h 10" />
</g>
<path d=" M 702 234 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 234 h 10" />
<path d=" M 692 234 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-lex.token.str-c.intro"><a class="rule-link" href="#r-lex.token.str-c.intro" title="lex.token.str-c.intro"><span>[lex<wbr>.token<wbr>.str-c<wbr>.intro]</span></a>
</div>

<p>C字符串字面量是一个Unicode字符和_转义_序列，前面带有字符<code>U+0063</code>（<code>c</code>）和<code>U+0022</code>（双引号），后面带有字符<code>U+0022</code>。如果<code>U+0022</code>字符出现在字面量中，它必须通过前面加一个<code>U+005C</code>（<code>\</code>）字符进行转义。另外，C字符串字面量可以是下面定义的原始C字符串字面量。</p>
<div class="rule" id="r-lex.token.str-c.null"><a class="rule-link" href="#r-lex.token.str-c.null" title="lex.token.str-c.null"><span>[lex<wbr>.token<wbr>.str-c<wbr>.null]</span></a>
</div>

<p>C字符串隐式以字节<code>0x00</code>终止，因此C字符串字面量<code>c""</code>等同于手动从字节字符串字面量<code>b"\x00"</code>构造一个<code>&amp;CStr</code>。除了隐式终止符，字节<code>0x00</code>不允许出现在C字符串中。</p>
<div class="rule" id="r-lex.token.str-c.linefeed"><a class="rule-link" href="#r-lex.token.str-c.linefeed" title="lex.token.str-c.linefeed"><span>[lex<wbr>.token<wbr>.str-c<wbr>.linefeed]</span></a>
</div>

<p>换行符（由字符<code>U+000A</code> (LF)表示）在C字符串字面量中是允许的。字符<code>U+000D</code> (CR)不得出现在C字符串字面量中。当未转义的<code>U+005C</code>字符（<code>\</code>）紧接在换行符之前时，换行符不会出现在词法单元所表示的字符串中。有关详细信息，请参阅<a href="#string-continuation-escapes">字符串续行转义</a>。</p>
<div class="rule" id="r-lex.token.str-c.escape"><a class="rule-link" href="#r-lex.token.str-c.escape" title="lex.token.str-c.escape"><span>[lex<wbr>.token<wbr>.str-c<wbr>.escape]</span></a>
</div>

<p>在非原始C字符串字面量中，还有一些额外的_转义_可用。转义以<code>U+005C</code>（<code>\</code>）开头，并接以下形式之一：</p>
<div class="rule" id="r-lex.token.str-c.escape-byte"><a class="rule-link" href="#r-lex.token.str-c.escape-byte" title="lex.token.str-c.escape-byte"><span>[lex<wbr>.token<wbr>.str-c<wbr>.escape-byte]</span></a>
</div>

<ul>
<li>字节转义以<code>U+0078</code>（<code>x</code>）开头，后跟恰好两个十六进制数字。它表示等于所提供十六进制值的字节。</li>
</ul>
<div class="rule" id="r-lex.token.str-c.escape-unicode"><a class="rule-link" href="#r-lex.token.str-c.escape-unicode" title="lex.token.str-c.escape-unicode"><span>[lex<wbr>.token<wbr>.str-c<wbr>.escape-unicode]</span></a>
</div>

<ul>
<li>24位码点转义以<code>U+0075</code>（<code>u</code>）开头，后跟最多六个十六进制数字，并用花括号<code>U+007B</code>（<code>{</code>）和<code>U+007D</code>（<code>}</code>）括起来。它表示等于所提供十六进制值的Unicode码点，以UTF-8编码。</li>
</ul>
<div class="rule" id="r-lex.token.str-c.escape-whitespace"><a class="rule-link" href="#r-lex.token.str-c.escape-whitespace" title="lex.token.str-c.escape-whitespace"><span>[lex<wbr>.token<wbr>.str-c<wbr>.escape-whitespace]</span></a>
</div>

<ul>
<li>空白转义是字符<code>U+006E</code>（<code>n</code>）、<code>U+0072</code>（<code>r</code>）或<code>U+0074</code>（<code>t</code>）之一，分别表示字节值<code>0x0A</code> (ASCII LF)、<code>0x0D</code> (ASCII CR)或<code>0x09</code> (ASCII HT)。</li>
</ul>
<div class="rule" id="r-lex.token.str-c.escape-slash"><a class="rule-link" href="#r-lex.token.str-c.escape-slash" title="lex.token.str-c.escape-slash"><span>[lex<wbr>.token<wbr>.str-c<wbr>.escape-slash]</span></a>
</div>

<ul>
<li>反斜杠转义是字符<code>U+005C</code>（<code>\</code>），它必须被转义才能表示其ASCII编码<code>0x5C</code>。</li>
</ul>
<div class="rule" id="r-lex.token.str-c.char-unicode"><a class="rule-link" href="#r-lex.token.str-c.char-unicode" title="lex.token.str-c.char-unicode"><span>[lex<wbr>.token<wbr>.str-c<wbr>.char-unicode]</span></a>
</div>

<p>C字符串表示没有定义编码的字节，但C字符串字面量可以包含高于<code>U+007F</code>的Unicode字符。这些字符将被替换为该字符的UTF-8表示字节。</p>
<p>以下C字符串字面量是等效的：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>c"æ";        // LATIN SMALL LETTER AE (U+00E6)
c"\u{00E6}";
c"\xC3\xA6";
<span class="boring">}</span></code></pre>
<div class="rule" id="r-lex.token.str-c.edition2021"><a class="rule-link" href="#r-lex.token.str-c.edition2021" title="lex.token.str-c.edition2021"><span>[lex<wbr>.token<wbr>.str-c<wbr>.edition2021]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2021</span> 版次差异</p>

<p>C字符串字面量在2021或更高版次中被接受。在更早的版次中，词法单元<code>c""</code>被解析为<code>c ""</code>。</p>
</blockquote>
</div>

<div class="rule" id="r-lex.token.str-c-raw"><a class="rule-link" href="#r-lex.token.str-c-raw" title="lex.token.str-c-raw"><span>[lex<wbr>.token<wbr>.str-c-raw]</span></a>
</div>

<h4 id="原始c字符串字面量"><a class="header" href="#原始c字符串字面量">原始C字符串字面量</a></h4>
<div class="rule" id="r-lex.token.str-c-raw.syntax"><a class="rule-link" href="#r-lex.token.str-c-raw.syntax" title="lex.token.str-c-raw.syntax"><span>[lex<wbr>.token<wbr>.str-c-raw<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-RAW_C_STRING_LITERAL" onclick="show_railroad()"><a href="#railroad-RAW_C_STRING_LITERAL">RAW_C_STRING_LITERAL</a></span> → <br>    <span class="grammar-literal">cr</span> <span class="grammar-text"><a href="#grammar-RAW_C_STRING_CONTENT">RAW_C_STRING_CONTENT</a></span> <span class="grammar-text"><a href="#grammar-SUFFIX">SUFFIX</a></span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-RAW_C_STRING_CONTENT" onclick="show_railroad()"><a href="#railroad-RAW_C_STRING_CONTENT">RAW_C_STRING_CONTENT</a></span> → <br>      <span class="grammar-literal">"</span> ( ~[<a href="#grammar-CR">CR</a> <a href="#grammar-NUL">NUL</a>] )<sup>* (non-greedy)</sup> <span class="grammar-literal">"</span> <br>    | <span class="grammar-literal">#</span> <span class="grammar-text"><a href="#grammar-RAW_C_STRING_CONTENT">RAW_C_STRING_CONTENT</a></span> <span class="grammar-literal">#</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 430px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RAW_C_STRING_LITERAL"><svg class="railroad" viewbox="0 0 430 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RAW_C_STRING_LITERAL">
<text class="comment" x="88" y="25">
RAW_C_STRING_LITERAL</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="55" />
<text x="53" y="71">
cr</text>
</g>
<a class="link" xlink:href="#railroad-RAW_C_STRING_CONTENT">
<g class="nonterminal">
<rect height="22" width="188" x="81" y="55" />
<text x="175" y="71">
RAW_C_STRING_CONTENT</text>
</g>
</a>
<g class="optional">
<path d=" M 279 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 68 m -31 0 l -5 -5 m 0 10 l 5 -5 m 31 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-SUFFIX">
<g class="nonterminal">
<rect height="22" width="68" x="303" y="55" />
<text x="337" y="71">
SUFFIX</text>
</g>
</a>
</g>
<path d=" M 71 66 h 10" />
<path d=" M 269 66 h 10" />
</g>
<path d=" M 405 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 395 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 483px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RAW_C_STRING_CONTENT"><svg class="railroad" viewbox="0 0 483 284" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RAW_C_STRING_CONTENT">
<text class="comment" x="88" y="25">
RAW_C_STRING_CONTENT</text>
</a>
<g class="sequence">
<path d=" M 10 204 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 204 h 24 m 365 0 h 24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="193" />
<text x="73" y="209">
"</text>
</g>
<g class="labeledbox">
<rect height="199" width="289" x="97" y="42" />
<path d=" M 97 204 h 8 m 273 0 h 8" />
<text class="comment" x="145" y="65">
non-greedy</text>
<g class="optional">
<path d=" M 105 204 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -102 m 0 54 l -5 5 m 10 0 l -5 -5 m 0 -54 a 12 12 0 0 1 12 -12 h 225 m -109 0 l -5 -5 m 0 10 l 5 -5 m 109 0 a 12 12 0 0 1 12 12 v 102 m 0 -48 l -5 -5 m 10 0 l -5 5 m 0 48 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 129 204 h 12 m 201 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 5 a 12 12 0 0 1 -12 12 m 0 0 h -201 m 103 0 l 5 -5 m 0 10 l -5 -5 m -103 0 a 12 12 0 0 1 -12 -12 v -5 a 12 12 0 0 1 12 -12" />
<g />
<g class="labeledbox exceptbox">
<rect height="133" width="201" x="141" y="90" />
<path d=" M 141 204 h 8 m 52 0 h 141 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0" />
<g class="verticalgrid">
<text class="comment" x="241" y="113">
⚠️ with the exception of</text>
<g class="choice">
<path d=" M 149 141 h 24 m 36 0 h 32" />
<a class="link" xlink:href="#railroad-CR">
<g class="nonterminal">
<rect height="22" width="36" x="173" y="130" />
<text x="191" y="146">
CR</text>
</g>
</a>
<path d=" M 149 141 a 12 12 0 0 1 12 12 v 9 m 68 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 161 162 v 0 a 12 12 0 0 0 12 12 m 44 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-NUL">
<g class="nonterminal">
<rect height="22" width="44" x="173" y="163" />
<text x="195" y="179">
NUL</text>
</g>
</a>
</g>
</g>
<a class="link" xlink:href="#railroad-CHAR">
<g class="nonterminal">
<rect height="22" width="52" x="149" y="193" />
<text x="175" y="209">
CHAR</text>
</g>
</a>
</g>
</g>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="396" y="193" />
<text x="410" y="209">
"</text>
</g>
<path d=" M 87 204 h 10" />
<path d=" M 386 204 h 10" />
</g>
<path d=" M 35 204 a 12 12 0 0 1 12 12 v 35 m 389 0 v -35 a 12 12 0 0 1 12 -12" />
<path d=" M 47 251 v 0 a 12 12 0 0 0 12 12 m 264 0 h 101 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="252" />
<text x="73" y="268">
#</text>
</g>
<a class="link" xlink:href="#railroad-RAW_C_STRING_CONTENT">
<g class="nonterminal">
<rect height="22" width="188" x="97" y="252" />
<text x="191" y="268">
RAW_C_STRING_CONTENT</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="295" y="252" />
<text x="309" y="268">
#</text>
</g>
<path d=" M 87 263 h 10" />
<path d=" M 285 263 h 10" />
</g>
</g>
<path d=" M 458 204 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 204 h 10" />
<path d=" M 448 204 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-lex.token.str-c-raw.intro"><a class="rule-link" href="#r-lex.token.str-c-raw.intro" title="lex.token.str-c-raw.intro"><span>[lex<wbr>.token<wbr>.str-c-raw<wbr>.intro]</span></a>
</div>

<p>原始C字符串字面量不处理任何转义。它们以字符<code>U+0063</code>（<code>c</code>）开头，后跟<code>U+0072</code>（<code>r</code>），再后跟少于256个<code>U+0023</code>（<code>#</code>）字符和一个<code>U+0022</code>（双引号）字符。</p>
<div class="rule" id="r-lex.token.str-c-raw.body"><a class="rule-link" href="#r-lex.token.str-c-raw.body" title="lex.token.str-c-raw.body"><span>[lex<wbr>.token<wbr>.str-c-raw<wbr>.body]</span></a>
</div>

<p>原始C字符串体可以包含除<code>U+0000</code> (NUL)和<code>U+000D</code> (CR)以外的任何Unicode字符序列。它只由另一个<code>U+0022</code>（双引号）字符终止，后跟与起始<code>U+0022</code>（双引号）字符前相同数量的<code>U+0023</code>（<code>#</code>）字符。</p>
<div class="rule" id="r-lex.token.str-c-raw.content"><a class="rule-link" href="#r-lex.token.str-c-raw.content" title="lex.token.str-c-raw.content"><span>[lex<wbr>.token<wbr>.str-c-raw<wbr>.content]</span></a>
</div>

<p>原始C字符串体中包含的所有字符都以UTF-8编码表示其本身。字符<code>U+0022</code>（双引号）（除非后面紧跟的<code>U+0023</code>（<code>#</code>）字符数量与用于开始原始C字符串字面量的字符数量相同或更多）或<code>U+005C</code>（<code>\</code>）不具有任何特殊含义。</p>
<div class="rule" id="r-lex.token.str-c-raw.edition2021"><a class="rule-link" href="#r-lex.token.str-c-raw.edition2021" title="lex.token.str-c-raw.edition2021"><span>[lex<wbr>.token<wbr>.str-c-raw<wbr>.edition2021]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2021</span> 版次差异</p>

<p>原始C字符串字面量在2021或更高版次中被接受。在更早的版次中，词法单元<code>cr""</code>被解析为<code>cr ""</code>，而<code>cr#""#</code>被解析为<code>cr #""#</code>（这不符合语法格式）。</p>
</blockquote>
</div>

<h4 id="c字符串和原始c字符串字面量示例"><a class="header" href="#c字符串和原始c字符串字面量示例">C字符串和原始C字符串字面量示例</a></h4>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>c"foo"; cr"foo";                     // foo
c"\"foo\""; cr#""foo""#;             // "foo"

c"foo #\"# bar";
cr##"foo #"# bar"##;                 // foo #"# bar

c"\x52"; c"R"; cr"R";                // R
c"\\x52"; cr"\x52";                  // \x52
<span class="boring">}</span></code></pre>
<div class="rule" id="r-lex.token.literal.num"><a class="rule-link" href="#r-lex.token.literal.num" title="lex.token.literal.num"><span>[lex<wbr>.token<wbr>.literal<wbr>.num]</span></a>
</div>

<h3 id="数字字面量"><a class="header" href="#数字字面量">数字字面量</a></h3>
<p>数字字面量可以是整数字面量，也可以是浮点数字面量。识别这两种字面量的语法格式是混合的。</p>
<div class="rule" id="r-lex.token.literal.int"><a class="rule-link" href="#r-lex.token.literal.int" title="lex.token.literal.int"><span>[lex<wbr>.token<wbr>.literal<wbr>.int]</span></a>
</div>

<h4 id="整数字面量"><a class="header" href="#整数字面量">整数字面量</a></h4>
<div class="rule" id="r-lex.token.literal.int.syntax"><a class="rule-link" href="#r-lex.token.literal.int.syntax" title="lex.token.literal.int.syntax"><span>[lex<wbr>.token<wbr>.literal<wbr>.int<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-INTEGER_LITERAL" onclick="show_railroad()"><a href="#railroad-INTEGER_LITERAL">INTEGER_LITERAL</a></span> → <br>    ( <span class="grammar-text"><a href="#grammar-BIN_LITERAL">BIN_LITERAL</a></span> | <span class="grammar-text"><a href="#grammar-OCT_LITERAL">OCT_LITERAL</a></span> | <span class="grammar-text"><a href="#grammar-HEX_LITERAL">HEX_LITERAL</a></span> | <span class="grammar-text"><a href="#grammar-DEC_LITERAL">DEC_LITERAL</a></span> ) <span class="grammar-text"><a href="#grammar-SUFFIX_NO_E">SUFFIX_NO_E</a></span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-DEC_LITERAL" onclick="show_railroad()"><a href="#railroad-DEC_LITERAL">DEC_LITERAL</a></span> → <span class="grammar-text"><a href="#grammar-DEC_DIGIT">DEC_DIGIT</a></span> ( <span class="grammar-text"><a href="#grammar-DEC_DIGIT">DEC_DIGIT</a></span> | <span class="grammar-literal">_</span> )<sup>*</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-BIN_LITERAL" onclick="show_railroad()"><a href="#railroad-BIN_LITERAL">BIN_LITERAL</a></span> → <span class="grammar-literal">0b</span> <span class="grammar-literal">_</span><sup>*</sup> <span class="grammar-text"><a href="#grammar-BIN_DIGIT">BIN_DIGIT</a></span> ( <span class="grammar-text"><a href="#grammar-BIN_DIGIT">BIN_DIGIT</a></span> | <span class="grammar-literal">_</span> )<sup>*</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-OCT_LITERAL" onclick="show_railroad()"><a href="#railroad-OCT_LITERAL">OCT_LITERAL</a></span> → <span class="grammar-literal">0o</span> <span class="grammar-literal">_</span><sup>*</sup> <span class="grammar-text"><a href="#grammar-OCT_DIGIT">OCT_DIGIT</a></span> ( <span class="grammar-text"><a href="#grammar-OCT_DIGIT">OCT_DIGIT</a></span> | <span class="grammar-literal">_</span> )<sup>*</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-HEX_LITERAL" onclick="show_railroad()"><a href="#railroad-HEX_LITERAL">HEX_LITERAL</a></span> → <span class="grammar-literal">0x</span> <span class="grammar-literal">_</span><sup>*</sup> <span class="grammar-text"><a href="#grammar-HEX_DIGIT">HEX_DIGIT</a></span> ( <span class="grammar-text"><a href="#grammar-HEX_DIGIT">HEX_DIGIT</a></span> | <span class="grammar-literal">_</span> )<sup>*</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-BIN_DIGIT" onclick="show_railroad()"><a href="#railroad-BIN_DIGIT">BIN_DIGIT</a></span> → [<span class="grammar-literal">0</span>-<span class="grammar-literal">1</span>]</p>
<p><span class="grammar-text grammar-production" id="grammar-OCT_DIGIT" onclick="show_railroad()"><a href="#railroad-OCT_DIGIT">OCT_DIGIT</a></span> → [<span class="grammar-literal">0</span>-<span class="grammar-literal">7</span>]</p>
<p><span class="grammar-text grammar-production" id="grammar-DEC_DIGIT" onclick="show_railroad()"><a href="#railroad-DEC_DIGIT">DEC_DIGIT</a></span> → [<span class="grammar-literal">0</span>-<span class="grammar-literal">9</span>]</p>
<p><span class="grammar-text grammar-production" id="grammar-HEX_DIGIT" onclick="show_railroad()"><a href="#railroad-HEX_DIGIT">HEX_DIGIT</a></span> → [<span class="grammar-literal">0</span>-<span class="grammar-literal">9</span> <span class="grammar-literal">a</span>-<span class="grammar-literal">f</span> <span class="grammar-literal">A</span>-<span class="grammar-literal">F</span>]</p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 392px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-INTEGER_LITERAL"><svg class="railroad" viewbox="0 0 392 186" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-INTEGER_LITERAL">
<text class="comment" x="67" y="25">
INTEGER_LITERAL</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="choice">
<path d=" M 35 66 h 24 m 108 0 h 24" />
<a class="link" xlink:href="#railroad-BIN_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="55" />
<text x="113" y="71">
BIN_LITERAL</text>
</g>
</a>
<path d=" M 35 66 a 12 12 0 0 1 12 12 v 9 m 132 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 87 v 33 m 132 0 v -33" />
<path d=" M 47 120 v 33 m 132 0 v -33" />
<path d=" M 47 87 v 0 a 12 12 0 0 0 12 12 m 108 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-OCT_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="88" />
<text x="113" y="104">
OCT_LITERAL</text>
</g>
</a>
<path d=" M 47 120 v 0 a 12 12 0 0 0 12 12 m 108 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-HEX_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="121" />
<text x="113" y="137">
HEX_LITERAL</text>
</g>
</a>
<path d=" M 47 153 v 0 a 12 12 0 0 0 12 12 m 108 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-DEC_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="154" />
<text x="113" y="170">
DEC_LITERAL</text>
</g>
</a>
</g>
<g class="optional">
<path d=" M 201 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 108 m -51 0 l -5 -5 m 0 10 l 5 -5 m 51 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-SUFFIX_NO_E">
<g class="nonterminal">
<rect height="22" width="108" x="225" y="55" />
<text x="279" y="71">
SUFFIX_NO_E</text>
</g>
</a>
</g>
<path d=" M 191 66 h 10" />
</g>
<path d=" M 367 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 357 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 384px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-DEC_LITERAL"><svg class="railroad" viewbox="0 0 384 130" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-DEC_LITERAL">
<text class="comment" x="53" y="25">
DEC_LITERAL</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-DEC_DIGIT">
<g class="nonterminal">
<rect height="22" width="92" x="35" y="55" />
<text x="81" y="71">
DEC_DIGIT</text>
</g>
</a>
<g class="optional">
<path d=" M 137 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 164 m -79 0 l -5 -5 m 0 10 l 5 -5 m 79 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 161 66 h 12 m 140 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 30 a 12 12 0 0 1 -12 12 m 0 0 h -140 m 73 0 l 5 -5 m 0 10 l -5 -5 m -73 0 a 12 12 0 0 1 -12 -12 v -30 a 12 12 0 0 1 12 -12" />
<g />
<g class="choice">
<path d=" M 173 66 h 24 m 92 0 h 24" />
<a class="link" xlink:href="#railroad-DEC_DIGIT">
<g class="nonterminal">
<rect height="22" width="92" x="197" y="55" />
<text x="243" y="71">
DEC_DIGIT</text>
</g>
</a>
<path d=" M 173 66 a 12 12 0 0 1 12 12 v 9 m 116 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 185 87 v 0 a 12 12 0 0 0 12 12 m 28 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="197" y="88" />
<text x="211" y="104">
_</text>
</g>
</g>
</g>
</g>
<path d=" M 127 66 h 10" />
</g>
<path d=" M 359 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 349 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 540px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-BIN_LITERAL"><svg class="railroad" viewbox="0 0 540 130" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-BIN_LITERAL">
<text class="comment" x="53" y="25">
BIN_LITERAL</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="55" />
<text x="53" y="71">
0b</text>
</g>
<g class="optional">
<path d=" M 81 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 52 m -23 0 l -5 -5 m 0 10 l 5 -5 m 23 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 105 66 h 12 m 28 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -28 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="117" y="55" />
<text x="131" y="71">
_</text>
</g>
</g>
</g>
<a class="link" xlink:href="#railroad-BIN_DIGIT">
<g class="nonterminal">
<rect height="22" width="92" x="191" y="55" />
<text x="237" y="71">
BIN_DIGIT</text>
</g>
</a>
<g class="optional">
<path d=" M 293 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 164 m -79 0 l -5 -5 m 0 10 l 5 -5 m 79 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 317 66 h 12 m 140 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 30 a 12 12 0 0 1 -12 12 m 0 0 h -140 m 73 0 l 5 -5 m 0 10 l -5 -5 m -73 0 a 12 12 0 0 1 -12 -12 v -30 a 12 12 0 0 1 12 -12" />
<g />
<g class="choice">
<path d=" M 329 66 h 24 m 92 0 h 24" />
<a class="link" xlink:href="#railroad-BIN_DIGIT">
<g class="nonterminal">
<rect height="22" width="92" x="353" y="55" />
<text x="399" y="71">
BIN_DIGIT</text>
</g>
</a>
<path d=" M 329 66 a 12 12 0 0 1 12 12 v 9 m 116 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 341 87 v 0 a 12 12 0 0 0 12 12 m 28 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="353" y="88" />
<text x="367" y="104">
_</text>
</g>
</g>
</g>
</g>
<path d=" M 71 66 h 10" />
<path d=" M 181 66 h 10" />
<path d=" M 283 66 h 10" />
</g>
<path d=" M 515 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 505 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 540px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-OCT_LITERAL"><svg class="railroad" viewbox="0 0 540 130" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-OCT_LITERAL">
<text class="comment" x="53" y="25">
OCT_LITERAL</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="55" />
<text x="53" y="71">
0o</text>
</g>
<g class="optional">
<path d=" M 81 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 52 m -23 0 l -5 -5 m 0 10 l 5 -5 m 23 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 105 66 h 12 m 28 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -28 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="117" y="55" />
<text x="131" y="71">
_</text>
</g>
</g>
</g>
<a class="link" xlink:href="#railroad-OCT_DIGIT">
<g class="nonterminal">
<rect height="22" width="92" x="191" y="55" />
<text x="237" y="71">
OCT_DIGIT</text>
</g>
</a>
<g class="optional">
<path d=" M 293 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 164 m -79 0 l -5 -5 m 0 10 l 5 -5 m 79 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 317 66 h 12 m 140 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 30 a 12 12 0 0 1 -12 12 m 0 0 h -140 m 73 0 l 5 -5 m 0 10 l -5 -5 m -73 0 a 12 12 0 0 1 -12 -12 v -30 a 12 12 0 0 1 12 -12" />
<g />
<g class="choice">
<path d=" M 329 66 h 24 m 92 0 h 24" />
<a class="link" xlink:href="#railroad-OCT_DIGIT">
<g class="nonterminal">
<rect height="22" width="92" x="353" y="55" />
<text x="399" y="71">
OCT_DIGIT</text>
</g>
</a>
<path d=" M 329 66 a 12 12 0 0 1 12 12 v 9 m 116 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 341 87 v 0 a 12 12 0 0 0 12 12 m 28 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="353" y="88" />
<text x="367" y="104">
_</text>
</g>
</g>
</g>
</g>
<path d=" M 71 66 h 10" />
<path d=" M 181 66 h 10" />
<path d=" M 283 66 h 10" />
</g>
<path d=" M 515 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 505 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 540px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-HEX_LITERAL"><svg class="railroad" viewbox="0 0 540 130" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-HEX_LITERAL">
<text class="comment" x="53" y="25">
HEX_LITERAL</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="55" />
<text x="53" y="71">
0x</text>
</g>
<g class="optional">
<path d=" M 81 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 52 m -23 0 l -5 -5 m 0 10 l 5 -5 m 23 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 105 66 h 12 m 28 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -28 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="117" y="55" />
<text x="131" y="71">
_</text>
</g>
</g>
</g>
<a class="link" xlink:href="#railroad-HEX_DIGIT">
<g class="nonterminal">
<rect height="22" width="92" x="191" y="55" />
<text x="237" y="71">
HEX_DIGIT</text>
</g>
</a>
<g class="optional">
<path d=" M 293 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 164 m -79 0 l -5 -5 m 0 10 l 5 -5 m 79 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 317 66 h 12 m 140 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 30 a 12 12 0 0 1 -12 12 m 0 0 h -140 m 73 0 l 5 -5 m 0 10 l -5 -5 m -73 0 a 12 12 0 0 1 -12 -12 v -30 a 12 12 0 0 1 12 -12" />
<g />
<g class="choice">
<path d=" M 329 66 h 24 m 92 0 h 24" />
<a class="link" xlink:href="#railroad-HEX_DIGIT">
<g class="nonterminal">
<rect height="22" width="92" x="353" y="55" />
<text x="399" y="71">
HEX_DIGIT</text>
</g>
</a>
<path d=" M 329 66 a 12 12 0 0 1 12 12 v 9 m 116 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 341 87 v 0 a 12 12 0 0 0 12 12 m 28 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="353" y="88" />
<text x="367" y="104">
_</text>
</g>
</g>
</g>
</g>
<path d=" M 71 66 h 10" />
<path d=" M 181 66 h 10" />
<path d=" M 283 66 h 10" />
</g>
<path d=" M 515 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 505 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 114px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-BIN_DIGIT"><svg class="railroad" viewbox="0 0 114 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-BIN_DIGIT">
<text class="comment" x="46" y="25">
BIN_DIGIT</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 0 m 44 0 h 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="42" />
<text x="57" y="58">
0-1</text>
</g>
</g>
<path d=" M 89 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 79 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 114px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-OCT_DIGIT"><svg class="railroad" viewbox="0 0 114 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-OCT_DIGIT">
<text class="comment" x="46" y="25">
OCT_DIGIT</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 0 m 44 0 h 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="42" />
<text x="57" y="58">
0-7</text>
</g>
</g>
<path d=" M 89 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 79 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 114px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-DEC_DIGIT"><svg class="railroad" viewbox="0 0 114 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-DEC_DIGIT">
<text class="comment" x="46" y="25">
DEC_DIGIT</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 0 m 44 0 h 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="42" />
<text x="57" y="58">
0-9</text>
</g>
</g>
<path d=" M 89 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 79 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 162px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-HEX_DIGIT"><svg class="railroad" viewbox="0 0 162 140" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-HEX_DIGIT">
<text class="comment" x="46" y="25">
HEX_DIGIT</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 44 0 h 24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="42" />
<text x="81" y="58">
0-9</text>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 68 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 68 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 44 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="75" />
<text x="81" y="91">
a-f</text>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 44 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="108" />
<text x="81" y="124">
A-F</text>
</g>
</g>
<path d=" M 137 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 127 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-lex.token.literal.int.kind"><a class="rule-link" href="#r-lex.token.literal.int.kind" title="lex.token.literal.int.kind"><span>[lex<wbr>.token<wbr>.literal<wbr>.int<wbr>.kind]</span></a>
</div>

<p>整数字面量有以下四种形式：</p>
<div class="rule" id="r-lex.token.literal.int.kind-dec"><a class="rule-link" href="#r-lex.token.literal.int.kind-dec" title="lex.token.literal.int.kind-dec"><span>[lex<wbr>.token<wbr>.literal<wbr>.int<wbr>.kind-dec]</span></a>
</div>

<ul>
<li>十进制字面量以十进制数字开头，并可包含十进制数字和下划线的任意组合。</li>
</ul>
<div class="rule" id="r-lex.token.literal.int.kind-hex"><a class="rule-link" href="#r-lex.token.literal.int.kind-hex" title="lex.token.literal.int.kind-hex"><span>[lex<wbr>.token<wbr>.literal<wbr>.int<wbr>.kind-hex]</span></a>
</div>

<ul>
<li>十六进制字面量以字符序列<code>U+0030</code> <code>U+0078</code>（<code>0x</code>）开头，并可包含十六进制数字和下划线的任意组合（至少包含一个数字）。</li>
</ul>
<div class="rule" id="r-lex.token.literal.int.kind-oct"><a class="rule-link" href="#r-lex.token.literal.int.kind-oct" title="lex.token.literal.int.kind-oct"><span>[lex<wbr>.token<wbr>.literal<wbr>.int<wbr>.kind-oct]</span></a>
</div>

<ul>
<li>八进制字面量以字符序列<code>U+0030</code> <code>U+006F</code>（<code>0o</code>）开头，并可包含八进制数字和下划线的任意组合（至少包含一个数字）。</li>
</ul>
<div class="rule" id="r-lex.token.literal.int.kind-bin"><a class="rule-link" href="#r-lex.token.literal.int.kind-bin" title="lex.token.literal.int.kind-bin"><span>[lex<wbr>.token<wbr>.literal<wbr>.int<wbr>.kind-bin]</span></a>
</div>

<ul>
<li>二进制字面量以字符序列<code>U+0030</code> <code>U+0062</code>（<code>0b</code>）开头，并可包含二进制数字和下划线的任意组合（至少包含一个数字）。</li>
</ul>
<div class="rule" id="r-lex.token.literal.int.restriction"><a class="rule-link" href="#r-lex.token.literal.int.restriction" title="lex.token.literal.int.restriction"><span>[lex<wbr>.token<wbr>.literal<wbr>.int<wbr>.restriction]</span></a>
</div>

<p>像任何字面量一样，整数字面量可以紧跟（不带任何空格）一个如上所述的后缀。后缀不能以<code>e</code>或<code>E</code>开头，因为这将被解释为浮点字面量的指数。有关这些后缀的效果，请参阅<a href="#integer-literal-expressions">整数字面量表达式</a>。</p>
<p>被接受为字面量表达式的整数字面量示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#![allow(overflowing_literals)]
</span>123;
123i32;
123u32;
123_u32;

0xff;
0xff_u8;
0x01_f32; // integer 7986, not floating-point 1.0
0x01_e3;  // integer 483, not floating-point 1000.0

0o70;
0o70_i16;

0b1111_1111_1001_0000;
0b1111_1111_1001_0000i64;
0b________1;

0usize;

// These are too big for their type, but are accepted as literal expressions.
128_i8;
256_u8;

// This is an integer literal, accepted as a floating-point literal expression.
5f32;
<span class="boring">}</span></code></pre>
<p>请注意，例如<code>-1i8</code>被解析为两个词法单元：<code>-</code>后跟<code>1i8</code>。</p>
<p>不被接受为字面量表达式的整数字面量示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(false)] {
</span>0invalidSuffix;
123AFB43;
0b010a;
0xAB_CD_EF_GH;
0b1111_f32;
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-lex.token.literal.int.tuple-field"><a class="rule-link" href="#r-lex.token.literal.int.tuple-field" title="lex.token.literal.int.tuple-field"><span>[lex<wbr>.token<wbr>.literal<wbr>.int<wbr>.tuple-field]</span></a>
</div>

<h4 id="元组项索引"><a class="header" href="#元组项索引">元组<a href="#grammar-Item">项</a>索引</a></h4>
<div class="rule" id="r-lex.token.literal.int.tuple-field.syntax"><a class="rule-link" href="#r-lex.token.literal.int.tuple-field.syntax" title="lex.token.literal.int.tuple-field.syntax"><span>[lex<wbr>.token<wbr>.literal<wbr>.int<wbr>.tuple-field<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-TUPLE_INDEX" onclick="show_railroad()"><a href="#railroad-TUPLE_INDEX">TUPLE_INDEX</a></span> → <span class="grammar-text"><a href="#grammar-DEC_LITERAL">DEC_LITERAL</a></span> | <span class="grammar-text"><a href="#grammar-BIN_LITERAL">BIN_LITERAL</a></span> | <span class="grammar-text"><a href="#grammar-OCT_LITERAL">OCT_LITERAL</a></span> | <span class="grammar-text"><a href="#grammar-HEX_LITERAL">HEX_LITERAL</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 226px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TUPLE_INDEX"><svg class="railroad" viewbox="0 0 226 173" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TUPLE_INDEX">
<text class="comment" x="53" y="25">
TUPLE_INDEX</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 108 0 h 24" />
<a class="link" xlink:href="#railroad-DEC_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="42" />
<text x="113" y="58">
DEC_LITERAL</text>
</g>
</a>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 132 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 132 0 v -33" />
<path d=" M 47 107 v 33 m 132 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 108 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-BIN_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="75" />
<text x="113" y="91">
BIN_LITERAL</text>
</g>
</a>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 108 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-OCT_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="108" />
<text x="113" y="124">
OCT_LITERAL</text>
</g>
</a>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 108 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-HEX_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="141" />
<text x="113" y="157">
HEX_LITERAL</text>
</g>
</a>
</g>
<path d=" M 201 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 191 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-lex.token.literal.int.tuple-field.intro"><a class="rule-link" href="#r-lex.token.literal.int.tuple-field.intro" title="lex.token.literal.int.tuple-field.intro"><span>[lex<wbr>.token<wbr>.literal<wbr>.int<wbr>.tuple-field<wbr>.intro]</span></a>
</div>

<p>元组<a href="#grammar-Item">项</a>索引用于引用<a href="#元组类型">元组</a>、<a href="#结构体">元组结构体</a>和<a href="#枚举">元组枚举变体</a>的字段。</p>
<div class="rule" id="r-lex.token.literal.int.tuple-field.eq"><a class="rule-link" href="#r-lex.token.literal.int.tuple-field.eq" title="lex.token.literal.int.tuple-field.eq"><span>[lex<wbr>.token<wbr>.literal<wbr>.int<wbr>.tuple-field<wbr>.eq]</span></a>
</div>

<p>元组<a href="#grammar-Item">项</a>索引与字面量词法单元直接比较。元组<a href="#grammar-Item">项</a>索引从<code>0</code>开始，每个后续索引的十进制值递增<code>1</code>。因此，只有十进制值会匹配，并且该值不能有任何额外的<code>0</code>前缀字符。</p>
<p>元组<a href="#grammar-Item">项</a>索引不能包含任何后缀（例如<code>usize</code>）。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let example = ("dog", "cat", "horse");
let dog = example.0;
let cat = example.1;
// The following examples are invalid.
let cat = example.01;  // ERROR no field named `01`
let horse = example.0b10;  // ERROR no field named `0b10`
let unicorn = example.0usize; // ERROR suffixes on a tuple index are invalid
let underscore = example.0_0; // ERROR no field `0_0` on type `(&amp;str, &amp;str, &amp;str)`
<span class="boring">}</span></code></pre>
<div class="rule" id="r-lex.token.literal.float"><a class="rule-link" href="#r-lex.token.literal.float" title="lex.token.literal.float"><span>[lex<wbr>.token<wbr>.literal<wbr>.float]</span></a>
</div>

<h4 id="浮点数字面量"><a class="header" href="#浮点数字面量">浮点数字面量</a></h4>
<div class="rule" id="r-lex.token.literal.float.syntax"><a class="rule-link" href="#r-lex.token.literal.float.syntax" title="lex.token.literal.float.syntax"><span>[lex<wbr>.token<wbr>.literal<wbr>.float<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-FLOAT_LITERAL" onclick="show_railroad()"><a href="#railroad-FLOAT_LITERAL">FLOAT_LITERAL</a></span> → <br>      <span class="grammar-text"><a href="#grammar-DEC_LITERAL">DEC_LITERAL</a></span> ( <span class="grammar-literal">.</span> <span class="grammar-text"><a href="#grammar-DEC_LITERAL">DEC_LITERAL</a></span> )<sup>?</sup> <span class="grammar-text"><a href="#grammar-FLOAT_EXPONENT">FLOAT_EXPONENT</a></span> <span class="grammar-text"><a href="#grammar-SUFFIX">SUFFIX</a></span><sup>?</sup> <br>    | <span class="grammar-text"><a href="#grammar-DEC_LITERAL">DEC_LITERAL</a></span> <span class="grammar-literal">.</span> <span class="grammar-text"><a href="#grammar-DEC_LITERAL">DEC_LITERAL</a></span> <span class="grammar-text"><a href="#grammar-SUFFIX_NO_E">SUFFIX_NO_E</a></span><sup>?</sup> <br>    | <span class="grammar-text"><a href="#grammar-DEC_LITERAL">DEC_LITERAL</a></span> <span class="grammar-literal">.</span><sub class="grammar-text">not immediately followed by <code>.</code>, <code>_</code> or an XID_Start character</sub></p>
<p><span class="grammar-text grammar-production" id="grammar-FLOAT_EXPONENT" onclick="show_railroad()"><a href="#railroad-FLOAT_EXPONENT">FLOAT_EXPONENT</a></span> → <br>    ( <span class="grammar-literal">e</span> | <span class="grammar-literal">E</span> ) ( <span class="grammar-literal">+</span> | <span class="grammar-literal">-</span> )<sup>?</sup> <span class="grammar-literal">_</span><sup>*</sup> <span class="grammar-text"><a href="#grammar-DEC_DIGIT">DEC_DIGIT</a></span> ( <span class="grammar-text"><a href="#grammar-DEC_DIGIT">DEC_DIGIT</a></span> | <span class="grammar-literal">_</span> )<sup>*</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 717px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-FLOAT_LITERAL"><svg class="railroad" viewbox="0 0 717 208" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-FLOAT_LITERAL">
<text class="comment" x="60" y="25">
FLOAT_LITERAL</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 66 h 24 m 580 0 h 43" />
<g class="sequence">
<a class="link" xlink:href="#railroad-DEC_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="55" />
<text x="113" y="71">
DEC_LITERAL</text>
</g>
</a>
<g class="optional">
<path d=" M 177 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 146 m -70 0 l -5 -5 m 0 10 l 5 -5 m 70 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="201" y="55" />
<text x="215" y="71">
.</text>
</g>
<a class="link" xlink:href="#railroad-DEC_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="239" y="55" />
<text x="293" y="71">
DEC_LITERAL</text>
</g>
</a>
<path d=" M 229 66 h 10" />
</g>
</g>
<a class="link" xlink:href="#railroad-FLOAT_EXPONENT">
<g class="nonterminal">
<rect height="22" width="132" x="381" y="55" />
<text x="447" y="71">
FLOAT_EXPONENT</text>
</g>
</a>
<g class="optional">
<path d=" M 523 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 68 m -31 0 l -5 -5 m 0 10 l 5 -5 m 31 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-SUFFIX">
<g class="nonterminal">
<rect height="22" width="68" x="547" y="55" />
<text x="581" y="71">
SUFFIX</text>
</g>
</a>
</g>
<path d=" M 167 66 h 10" />
<path d=" M 371 66 h 10" />
<path d=" M 513 66 h 10" />
</g>
<path d=" M 35 66 a 12 12 0 0 1 12 12 v 9 m 623 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 99 v 33 m 623 0 v -33" />
<path d=" M 47 87 v 12 a 12 12 0 0 0 12 12 m 430 0 h 169 m -81 0 l -5 -5 m 0 10 l 5 -5 m 81 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<a class="link" xlink:href="#railroad-DEC_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="100" />
<text x="113" y="116">
DEC_LITERAL</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="177" y="100" />
<text x="191" y="116">
.</text>
</g>
<a class="link" xlink:href="#railroad-DEC_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="215" y="100" />
<text x="269" y="116">
DEC_LITERAL</text>
</g>
</a>
<g class="optional">
<path d=" M 333 111 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 108 m -51 0 l -5 -5 m 0 10 l 5 -5 m 51 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-SUFFIX_NO_E">
<g class="nonterminal">
<rect height="22" width="108" x="357" y="100" />
<text x="411" y="116">
SUFFIX_NO_E</text>
</g>
</a>
</g>
<path d=" M 167 111 h 10" />
<path d=" M 205 111 h 10" />
<path d=" M 323 111 h 10" />
</g>
<path d=" M 47 132 v 35 a 12 12 0 0 0 12 12 m 599 0 h 0 a 12 12 0 0 0 12 -12 v -35" />
<g class="sequence">
<a class="link" xlink:href="#railroad-DEC_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="168" />
<text x="113" y="184">
DEC_LITERAL</text>
</g>
</a>
<g class="labeledbox">
<rect height="66" width="481" x="177" y="132" />
<path d=" M 177 179 h 8 m 28 0 h 445 m -219 0 l -5 -5 m 0 10 l 5 -5 m 219 0" />
<text class="comment" x="417" y="155">
not immediately followed by `.`, `_` or an XID_Start character</text>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="185" y="168" />
<text x="199" y="184">
.</text>
</g>
</g>
<path d=" M 167 179 h 10" />
</g>
</g>
<path d=" M 692 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 682 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 714px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-FLOAT_EXPONENT"><svg class="railroad" viewbox="0 0 714 130" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-FLOAT_EXPONENT">
<text class="comment" x="64" y="25">
FLOAT_EXPONENT</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="choice">
<path d=" M 35 66 h 24 m 28 0 h 24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="55" />
<text x="73" y="71">
e</text>
</g>
<path d=" M 35 66 a 12 12 0 0 1 12 12 v 9 m 52 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 87 v 0 a 12 12 0 0 0 12 12 m 28 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="88" />
<text x="73" y="104">
E</text>
</g>
</g>
<g class="optional">
<path d=" M 121 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 76 m -35 0 l -5 -5 m 0 10 l 5 -5 m 35 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="choice">
<path d=" M 145 66 h 24 m 28 0 h 24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="55" />
<text x="183" y="71">
+</text>
</g>
<path d=" M 145 66 a 12 12 0 0 1 12 12 v 9 m 52 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 157 87 v 0 a 12 12 0 0 0 12 12 m 28 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="88" />
<text x="183" y="104">
-</text>
</g>
</g>
</g>
<g class="optional">
<path d=" M 255 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 52 m -23 0 l -5 -5 m 0 10 l 5 -5 m 23 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 279 66 h 12 m 28 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -28 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="291" y="55" />
<text x="305" y="71">
_</text>
</g>
</g>
</g>
<a class="link" xlink:href="#railroad-DEC_DIGIT">
<g class="nonterminal">
<rect height="22" width="92" x="365" y="55" />
<text x="411" y="71">
DEC_DIGIT</text>
</g>
</a>
<g class="optional">
<path d=" M 467 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 164 m -79 0 l -5 -5 m 0 10 l 5 -5 m 79 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 491 66 h 12 m 140 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 30 a 12 12 0 0 1 -12 12 m 0 0 h -140 m 73 0 l 5 -5 m 0 10 l -5 -5 m -73 0 a 12 12 0 0 1 -12 -12 v -30 a 12 12 0 0 1 12 -12" />
<g />
<g class="choice">
<path d=" M 503 66 h 24 m 92 0 h 24" />
<a class="link" xlink:href="#railroad-DEC_DIGIT">
<g class="nonterminal">
<rect height="22" width="92" x="527" y="55" />
<text x="573" y="71">
DEC_DIGIT</text>
</g>
</a>
<path d=" M 503 66 a 12 12 0 0 1 12 12 v 9 m 116 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 515 87 v 0 a 12 12 0 0 0 12 12 m 28 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="527" y="88" />
<text x="541" y="104">
_</text>
</g>
</g>
</g>
</g>
<path d=" M 111 66 h 10" />
<path d=" M 245 66 h 10" />
<path d=" M 355 66 h 10" />
<path d=" M 457 66 h 10" />
</g>
<path d=" M 689 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 679 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-lex.token.literal.float.form"><a class="rule-link" href="#r-lex.token.literal.float.form" title="lex.token.literal.float.form"><span>[lex<wbr>.token<wbr>.literal<wbr>.float<wbr>.form]</span></a>
</div>

<p>浮点数字面量有两种形式：</p>
<ul>
<li>十进制字面量，后跟句点字符<code>U+002E</code>（<code>.</code>）。这后面可选地跟另一个十进制字面量，带有可选的指数。</li>
<li>单个十进制字面量，后跟指数。</li>
</ul>
<div class="rule" id="r-lex.token.literal.float.suffix"><a class="rule-link" href="#r-lex.token.literal.float.suffix" title="lex.token.literal.float.suffix"><span>[lex<wbr>.token<wbr>.literal<wbr>.float<wbr>.suffix]</span></a>
</div>

<p>像整数字面量一样，浮点数字面量可以后跟一个后缀，只要后缀前的部分不以<code>U+002E</code>（<code>.</code>）结尾。如果字面量不包含指数，则后缀不能以<code>e</code>或<code>E</code>开头。有关这些后缀的效果，请参阅<a href="#floating-point-literal-expressions">浮点数字面量表达式</a>。</p>
<p>被接受为字面量表达式的浮点数字面量示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>123.0f64;
0.1f64;
0.1f32;
12E+99_f64;
let x: f64 = 2.;
<span class="boring">}</span></code></pre>
<p>最后一个示例有所不同，因为浮点数字面量以句点结尾时，无法使用后缀语法格式。<code>2.f64</code>会尝试在<code>2</code>上调用名为<code>f64</code>的方法。</p>
<p>请注意，例如<code>-1.0</code>被解析为两个词法单元：<code>-</code>后跟<code>1.0</code>。</p>
<p>不被接受为字面量表达式的浮点数字面量示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(false)] {
</span>2.0f80;
2e5f80;
2e5e6;
2.0e5e6;
1.3e10u64;
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-lex.token.literal.reserved"><a class="rule-link" href="#r-lex.token.literal.reserved" title="lex.token.literal.reserved"><span>[lex<wbr>.token<wbr>.literal<wbr>.reserved]</span></a>
</div>

<h4 id="类似于数字字面量的保留形式"><a class="header" href="#类似于数字字面量的保留形式">类似于数字字面量的保留形式</a></h4>
<div class="rule" id="r-lex.token.literal.reserved.syntax"><a class="rule-link" href="#r-lex.token.literal.reserved.syntax" title="lex.token.literal.reserved.syntax"><span>[lex<wbr>.token<wbr>.literal<wbr>.reserved<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-RESERVED_NUMBER" onclick="show_railroad()"><a href="#railroad-RESERVED_NUMBER">RESERVED_NUMBER</a></span> → <br>      <span class="grammar-text"><a href="#grammar-BIN_LITERAL">BIN_LITERAL</a></span> [<span class="grammar-literal">2</span>-<span class="grammar-literal">9</span>] <br>    | <span class="grammar-text"><a href="#grammar-OCT_LITERAL">OCT_LITERAL</a></span> [<span class="grammar-literal">8</span>-<span class="grammar-literal">9</span>] <br>    | ( <span class="grammar-text"><a href="#grammar-BIN_LITERAL">BIN_LITERAL</a></span> | <span class="grammar-text"><a href="#grammar-OCT_LITERAL">OCT_LITERAL</a></span> | <span class="grammar-text"><a href="#grammar-HEX_LITERAL">HEX_LITERAL</a></span> ) <span class="grammar-literal">.</span><sub class="grammar-text">not immediately followed by <code>.</code>, <code>_</code> or an XID_Start character</sub> <br>    | ( <span class="grammar-text"><a href="#grammar-BIN_LITERAL">BIN_LITERAL</a></span> | <span class="grammar-text"><a href="#grammar-OCT_LITERAL">OCT_LITERAL</a></span> ) ( <span class="grammar-literal">e</span> | <span class="grammar-literal">E</span> ) <br>    | <span class="grammar-literal">0b</span> <span class="grammar-literal">_</span><sup>*</sup> <span class="grammar-text">&lt;end of input or not BIN_DIGIT&gt;</span> <br>    | <span class="grammar-literal">0o</span> <span class="grammar-literal">_</span><sup>*</sup> <span class="grammar-text">&lt;end of input or not OCT_DIGIT&gt;</span> <br>    | <span class="grammar-literal">0x</span> <span class="grammar-literal">_</span><sup>*</sup> <span class="grammar-text">&lt;end of input or not HEX_DIGIT&gt;</span> <br>    | <span class="grammar-text"><a href="#grammar-DEC_LITERAL">DEC_LITERAL</a></span> ( <span class="grammar-literal">.</span> <span class="grammar-text"><a href="#grammar-DEC_LITERAL">DEC_LITERAL</a></span> )<sup>?</sup> ( <span class="grammar-literal">e</span> | <span class="grammar-literal">E</span> ) ( <span class="grammar-literal">+</span> | <span class="grammar-literal">-</span> )<sup>?</sup> <span class="grammar-text">&lt;end of input or not DEC_DIGIT&gt;</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 920px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RESERVED_NUMBER"><svg class="railroad" viewbox="0 0 920 559" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RESERVED_NUMBER">
<text class="comment" x="67" y="25">
RESERVED_NUMBER</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 162 0 h 664 m -329 0 l -5 -5 m 0 10 l 5 -5 m 329 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-BIN_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="42" />
<text x="113" y="58">
BIN_LITERAL</text>
</g>
</a>
<g class="choice">
<path d=" M 177 53 h 0 m 44 0 h 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="177" y="42" />
<text x="199" y="58">
2-9</text>
</g>
</g>
<path d=" M 167 53 h 10" />
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 826 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 826 0 v -33" />
<path d=" M 47 142 v 99 m 0 -46 l -5 -5 m 10 0 l -5 5 m 0 46 m 826 0 v -99 m 0 52 l -5 5 m 10 0 l -5 -5 m 0 -52" />
<path d=" M 47 241 v 66 m 0 -30 l -5 -5 m 10 0 l -5 5 m 0 30 m 826 0 v -66 m 0 36 l -5 5 m 10 0 l -5 -5 m 0 -36" />
<path d=" M 47 319 v 46 m 826 0 v -46" />
<path d=" M 47 377 v 46 m 826 0 v -46" />
<path d=" M 47 435 v 46 m 826 0 v -46" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 162 0 h 640 m -317 0 l -5 -5 m 0 10 l 5 -5 m 317 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-OCT_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="75" />
<text x="113" y="91">
OCT_LITERAL</text>
</g>
</a>
<g class="choice">
<path d=" M 177 86 h 0 m 44 0 h 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="177" y="75" />
<text x="199" y="91">
8-9</text>
</g>
</g>
<path d=" M 167 86 h 10" />
</g>
<path d=" M 47 107 v 35 a 12 12 0 0 0 12 12 m 647 0 h 155 m -74 0 l -5 -5 m 0 10 l 5 -5 m 74 0 a 12 12 0 0 0 12 -12 v -35" />
<g class="sequence">
<g class="choice">
<path d=" M 59 154 h 24 m 108 0 h 24" />
<a class="link" xlink:href="#railroad-BIN_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="83" y="143" />
<text x="137" y="159">
BIN_LITERAL</text>
</g>
</a>
<path d=" M 59 154 a 12 12 0 0 1 12 12 v 9 m 132 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 71 175 v 33 m 132 0 v -33" />
<path d=" M 71 175 v 0 a 12 12 0 0 0 12 12 m 108 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-OCT_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="83" y="176" />
<text x="137" y="192">
OCT_LITERAL</text>
</g>
</a>
<path d=" M 71 208 v 0 a 12 12 0 0 0 12 12 m 108 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-HEX_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="83" y="209" />
<text x="137" y="225">
HEX_LITERAL</text>
</g>
</a>
</g>
<g class="labeledbox">
<rect height="66" width="481" x="225" y="107" />
<path d=" M 225 154 h 8 m 28 0 h 445 m -219 0 l -5 -5 m 0 10 l 5 -5 m 219 0" />
<text class="comment" x="465" y="130">
not immediately followed by `.`, `_` or an XID_Start character</text>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="233" y="143" />
<text x="247" y="159">
.</text>
</g>
</g>
<path d=" M 215 154 h 10" />
</g>
<path d=" M 47 241 v 0 a 12 12 0 0 0 12 12 m 242 0 h 560 m -277 0 l -5 -5 m 0 10 l 5 -5 m 277 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="choice">
<path d=" M 59 253 h 24 m 108 0 h 24" />
<a class="link" xlink:href="#railroad-BIN_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="83" y="242" />
<text x="137" y="258">
BIN_LITERAL</text>
</g>
</a>
<path d=" M 59 253 a 12 12 0 0 1 12 12 v 9 m 132 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 71 274 v 0 a 12 12 0 0 0 12 12 m 108 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-OCT_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="83" y="275" />
<text x="137" y="291">
OCT_LITERAL</text>
</g>
</a>
</g>
<g class="choice">
<path d=" M 225 253 h 24 m 28 0 h 24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="249" y="242" />
<text x="263" y="258">
e</text>
</g>
<path d=" M 225 253 a 12 12 0 0 1 12 12 v 9 m 52 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 237 274 v 0 a 12 12 0 0 0 12 12 m 28 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="249" y="275" />
<text x="263" y="291">
E</text>
</g>
</g>
<path d=" M 215 253 h 10" />
</g>
<path d=" M 47 307 v 12 a 12 12 0 0 0 12 12 m 416 0 h 386 m -190 0 l -5 -5 m 0 10 l 5 -5 m 190 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="320" />
<text x="77" y="336">
0b</text>
</g>
<g class="optional">
<path d=" M 105 331 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 52 m -23 0 l -5 -5 m 0 10 l 5 -5 m 23 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 129 331 h 12 m 28 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -28 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="141" y="320" />
<text x="155" y="336">
_</text>
</g>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="260" x="215" y="320" />
<text x="345" y="336">
end of input or not BIN_DIGIT</text>
</g>
<path d=" M 95 331 h 10" />
<path d=" M 205 331 h 10" />
</g>
<path d=" M 47 365 v 12 a 12 12 0 0 0 12 12 m 416 0 h 386 m -190 0 l -5 -5 m 0 10 l 5 -5 m 190 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="378" />
<text x="77" y="394">
0o</text>
</g>
<g class="optional">
<path d=" M 105 389 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 52 m -23 0 l -5 -5 m 0 10 l 5 -5 m 23 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 129 389 h 12 m 28 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -28 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="141" y="378" />
<text x="155" y="394">
_</text>
</g>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="260" x="215" y="378" />
<text x="345" y="394">
end of input or not OCT_DIGIT</text>
</g>
<path d=" M 95 389 h 10" />
<path d=" M 205 389 h 10" />
</g>
<path d=" M 47 423 v 12 a 12 12 0 0 0 12 12 m 416 0 h 386 m -190 0 l -5 -5 m 0 10 l 5 -5 m 190 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="436" />
<text x="77" y="452">
0x</text>
</g>
<g class="optional">
<path d=" M 105 447 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 52 m -23 0 l -5 -5 m 0 10 l 5 -5 m 23 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 129 447 h 12 m 28 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -28 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="141" y="436" />
<text x="155" y="452">
_</text>
</g>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="260" x="215" y="436" />
<text x="345" y="452">
end of input or not HEX_DIGIT</text>
</g>
<path d=" M 95 447 h 10" />
<path d=" M 205 447 h 10" />
</g>
<path d=" M 47 481 v 12 a 12 12 0 0 0 12 12 m 802 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<a class="link" xlink:href="#railroad-DEC_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="494" />
<text x="113" y="510">
DEC_LITERAL</text>
</g>
</a>
<g class="optional">
<path d=" M 177 505 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 146 m -70 0 l -5 -5 m 0 10 l 5 -5 m 70 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="201" y="494" />
<text x="215" y="510">
.</text>
</g>
<a class="link" xlink:href="#railroad-DEC_LITERAL">
<g class="nonterminal">
<rect height="22" width="108" x="239" y="494" />
<text x="293" y="510">
DEC_LITERAL</text>
</g>
</a>
<path d=" M 229 505 h 10" />
</g>
</g>
<g class="choice">
<path d=" M 381 505 h 24 m 28 0 h 24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="405" y="494" />
<text x="419" y="510">
e</text>
</g>
<path d=" M 381 505 a 12 12 0 0 1 12 12 v 9 m 52 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 393 526 v 0 a 12 12 0 0 0 12 12 m 28 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="405" y="527" />
<text x="419" y="543">
E</text>
</g>
</g>
<g class="optional">
<path d=" M 467 505 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 76 m -35 0 l -5 -5 m 0 10 l 5 -5 m 35 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="choice">
<path d=" M 491 505 h 24 m 28 0 h 24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="515" y="494" />
<text x="529" y="510">
+</text>
</g>
<path d=" M 491 505 a 12 12 0 0 1 12 12 v 9 m 52 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 503 526 v 0 a 12 12 0 0 0 12 12 m 28 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="515" y="527" />
<text x="529" y="543">
-</text>
</g>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="260" x="601" y="494" />
<text x="731" y="510">
end of input or not DEC_DIGIT</text>
</g>
<path d=" M 167 505 h 10" />
<path d=" M 371 505 h 10" />
<path d=" M 457 505 h 10" />
<path d=" M 591 505 h 10" />
</g>
</g>
<path d=" M 895 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 885 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-lex.token.literal.reserved.intro"><a class="rule-link" href="#r-lex.token.literal.reserved.intro" title="lex.token.literal.reserved.intro"><span>[lex<wbr>.token<wbr>.literal<wbr>.reserved<wbr>.intro]</span></a>
</div>

<p>以下类似于数字字面量的词法形式是_保留形式_。由于可能存在的歧义，词法分析器会拒绝这些形式，而不是将其解释为单独的词法单元。</p>
<div class="rule" id="r-lex.token.literal.reserved.out-of-range"><a class="rule-link" href="#r-lex.token.literal.reserved.out-of-range" title="lex.token.literal.reserved.out-of-range"><span>[lex<wbr>.token<wbr>.literal<wbr>.reserved<wbr>.out-of-range]</span></a>
</div>

<ul>
<li>未加后缀的二进制或八进制字面量，紧接着（无中间空白）一个超出其基数范围的十进制数字。</li>
</ul>
<div class="rule" id="r-lex.token.literal.reserved.period"><a class="rule-link" href="#r-lex.token.literal.reserved.period" title="lex.token.literal.reserved.period"><span>[lex<wbr>.token<wbr>.literal<wbr>.reserved<wbr>.period]</span></a>
</div>

<ul>
<li>未加后缀的二进制、八进制或十六进制字面量，紧接着（无中间空白）一个句点字符（对句点后面的内容有与浮点数字面量相同的限制）。</li>
</ul>
<div class="rule" id="r-lex.token.literal.reserved.exp"><a class="rule-link" href="#r-lex.token.literal.reserved.exp" title="lex.token.literal.reserved.exp"><span>[lex<wbr>.token<wbr>.literal<wbr>.reserved<wbr>.exp]</span></a>
</div>

<ul>
<li>未加后缀的二进制或八进制字面量，紧接着（无中间空白）字符<code>e</code>或<code>E</code>。</li>
</ul>
<div class="rule" id="r-lex.token.literal.reserved.empty-with-radix"><a class="rule-link" href="#r-lex.token.literal.reserved.empty-with-radix" title="lex.token.literal.reserved.empty-with-radix"><span>[lex<wbr>.token<wbr>.literal<wbr>.reserved<wbr>.empty-with-radix]</span></a>
</div>

<ul>
<li>以基数前缀之一开头但不是有效的二进制、八进制或十六进制字面量（因为它不包含任何数字）的输入。</li>
</ul>
<div class="rule" id="r-lex.token.literal.reserved.empty-exp"><a class="rule-link" href="#r-lex.token.literal.reserved.empty-exp" title="lex.token.literal.reserved.empty-exp"><span>[lex<wbr>.token<wbr>.literal<wbr>.reserved<wbr>.empty-exp]</span></a>
</div>

<ul>
<li>具有浮点数字面量形式，但指数中没有数字的输入。</li>
</ul>
<p>保留形式的示例：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>0b0102;  // 这不是`0b010`后跟`2`
0o1279;  // 这不是`0o127`后跟`9`
0x80.0;  // 这不是`0x80`后跟`.`和`0`
0b101e;  // 这不是一个带后缀的字面量，也不是`0b101`后跟`e`
0b;      // 这不是一个整数字面量，也不是`0`后跟`b`
0b_;     // 这不是一个整数字面量，也不是`0`后跟`b_`
2e;      // 这不是一个浮点数字面量，也不是`2`后跟`e`
2.0e;    // 这不是一个浮点数字面量，也不是`2.0`后跟`e`
2em;     // 这不是一个带后缀的字面量，也不是`2`后跟`em`
2.0em;   // 这不是一个带后缀的字面量，也不是`2.0`后跟`em`
<span class="boring">}</span></code></pre>
<div class="rule" id="r-lex.token.life"><a class="rule-link" href="#r-lex.token.life" title="lex.token.life"><span>[lex<wbr>.token<wbr>.life]</span></a>
</div>

<h2 id="生命周期和循环标签"><a class="header" href="#生命周期和循环标签">生命周期和循环标签</a></h2>
<div class="rule" id="r-lex.token.life.syntax"><a class="rule-link" href="#r-lex.token.life.syntax" title="lex.token.life.syntax"><span>[lex<wbr>.token<wbr>.life<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-LIFETIME_TOKEN" onclick="show_railroad()"><a href="#railroad-LIFETIME_TOKEN">LIFETIME_TOKEN</a></span> → <br>      <span class="grammar-text"><a href="#grammar-RAW_LIFETIME">RAW_LIFETIME</a></span> <br>    | <span class="grammar-literal">'</span> <span class="grammar-text"><a href="#grammar-IDENTIFIER_OR_KEYWORD">IDENTIFIER_OR_KEYWORD</a></span><sub class="grammar-text">not immediately followed by <code>'</code></sub></p>
<p><span class="grammar-text grammar-production" id="grammar-LIFETIME_OR_LABEL" onclick="show_railroad()"><a href="#railroad-LIFETIME_OR_LABEL">LIFETIME_OR_LABEL</a></span> → <br>      <span class="grammar-text"><a href="#grammar-RAW_LIFETIME">RAW_LIFETIME</a></span> <br>    | <span class="grammar-literal">'</span> <span class="grammar-text"><a href="#grammar-NON_KEYWORD_IDENTIFIER">NON_KEYWORD_IDENTIFIER</a></span><sub class="grammar-text">not immediately followed by <code>'</code></sub></p>
<p><span class="grammar-text grammar-production" id="grammar-RAW_LIFETIME" onclick="show_railroad()"><a href="#railroad-RAW_LIFETIME">RAW_LIFETIME</a></span> → <br>    <span class="grammar-literal">'r#</span> <span class="grammar-text"><a href="#grammar-IDENTIFIER_OR_KEYWORD">IDENTIFIER_OR_KEYWORD</a></span><sub class="grammar-text">not immediately followed by <code>'</code></sub></p>
<p><span class="grammar-text grammar-production" id="grammar-RESERVED_RAW_LIFETIME" onclick="show_railroad()"><a href="#railroad-RESERVED_RAW_LIFETIME">RESERVED_RAW_LIFETIME</a></span> → <span class="grammar-literal">'r#</span> ( <span class="grammar-literal">_</span> | <span class="grammar-literal">crate</span> | <span class="grammar-literal">self</span> | <span class="grammar-literal">Self</span> | <span class="grammar-literal">super</span> )<sub class="grammar-text">not immediately followed by <code>'</code></sub></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 406px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-LIFETIME_TOKEN"><svg class="railroad" viewbox="0 0 406 150" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-LIFETIME_TOKEN">
<text class="comment" x="64" y="25">
LIFETIME_TOKEN</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 116 0 h 196 m -95 0 l -5 -5 m 0 10 l 5 -5 m 95 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RAW_LIFETIME">
<g class="nonterminal">
<rect height="22" width="116" x="59" y="42" />
<text x="117" y="58">
RAW_LIFETIME</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 312 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 35 a 12 12 0 0 0 12 12 m 288 0 h 0 a 12 12 0 0 0 12 -12 v -35" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="110" />
<text x="73" y="126">
'</text>
</g>
<g class="labeledbox">
<rect height="66" width="250" x="97" y="74" />
<path d=" M 97 121 h 8 m 196 0 h 46" />
<text class="comment" x="222" y="97">
not immediately followed by `'`</text>
<a class="link" xlink:href="#railroad-IDENTIFIER_OR_KEYWORD">
<g class="nonterminal">
<rect height="22" width="196" x="105" y="110" />
<text x="203" y="126">
IDENTIFIER_OR_KEYWORD</text>
</g>
</a>
</g>
<path d=" M 87 121 h 10" />
</g>
</g>
<path d=" M 381 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 371 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 406px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-LIFETIME_OR_LABEL"><svg class="railroad" viewbox="0 0 406 150" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-LIFETIME_OR_LABEL">
<text class="comment" x="74" y="25">
LIFETIME_OR_LABEL</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 116 0 h 196 m -95 0 l -5 -5 m 0 10 l 5 -5 m 95 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RAW_LIFETIME">
<g class="nonterminal">
<rect height="22" width="116" x="59" y="42" />
<text x="117" y="58">
RAW_LIFETIME</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 312 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 35 a 12 12 0 0 0 12 12 m 288 0 h 0 a 12 12 0 0 0 12 -12 v -35" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="110" />
<text x="73" y="126">
'</text>
</g>
<g class="labeledbox">
<rect height="66" width="250" x="97" y="74" />
<path d=" M 97 121 h 8 m 204 0 h 38" />
<text class="comment" x="222" y="97">
not immediately followed by `'`</text>
<a class="link" xlink:href="#railroad-NON_KEYWORD_IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="204" x="105" y="110" />
<text x="207" y="126">
NON_KEYWORD_IDENTIFIER</text>
</g>
</a>
</g>
<path d=" M 87 121 h 10" />
</g>
</g>
<path d=" M 381 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 371 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 374px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RAW_LIFETIME"><svg class="railroad" viewbox="0 0 374 118" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RAW_LIFETIME">
<text class="comment" x="57" y="25">
RAW_LIFETIME</text>
</a>
<g class="sequence">
<path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="78" />
<text x="57" y="94">
'r#</text>
</g>
<g class="labeledbox">
<rect height="66" width="250" x="89" y="42" />
<path d=" M 89 89 h 8 m 196 0 h 46" />
<text class="comment" x="214" y="65">
not immediately followed by `'`</text>
<a class="link" xlink:href="#railroad-IDENTIFIER_OR_KEYWORD">
<g class="nonterminal">
<rect height="22" width="196" x="97" y="78" />
<text x="195" y="94">
IDENTIFIER_OR_KEYWORD</text>
</g>
</a>
</g>
<path d=" M 79 89 h 10" />
</g>
<path d=" M 349 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 89 h 10" />
<path d=" M 339 89 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 374px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RESERVED_RAW_LIFETIME"><svg class="railroad" viewbox="0 0 374 250" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RESERVED_RAW_LIFETIME">
<text class="comment" x="92" y="25">
RESERVED_RAW_LIFETIME</text>
</a>
<g class="sequence">
<path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="78" />
<text x="57" y="94">
'r#</text>
</g>
<g class="labeledbox">
<rect height="198" width="250" x="89" y="42" />
<path d=" M 89 89 h 8 m 108 0 h 134 m -64 0 l -5 -5 m 0 10 l 5 -5 m 64 0" />
<text class="comment" x="214" y="65">
not immediately followed by `'`</text>
<g class="choice">
<path d=" M 97 89 h 24 m 28 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="121" y="78" />
<text x="135" y="94">
_</text>
</g>
<path d=" M 97 89 a 12 12 0 0 1 12 12 v 9 m 84 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 109 110 v 33 m 84 0 v -33" />
<path d=" M 109 143 v 33 m 84 0 v -33" />
<path d=" M 109 176 v 33 m 84 0 v -33" />
<path d=" M 109 110 v 0 a 12 12 0 0 0 12 12 m 60 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="121" y="111" />
<text x="151" y="127">
crate</text>
</g>
<path d=" M 109 143 v 0 a 12 12 0 0 0 12 12 m 52 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="121" y="144" />
<text x="147" y="160">
self</text>
</g>
<path d=" M 109 176 v 0 a 12 12 0 0 0 12 12 m 52 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="121" y="177" />
<text x="147" y="193">
Self</text>
</g>
<path d=" M 109 209 v 0 a 12 12 0 0 0 12 12 m 60 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="121" y="210" />
<text x="151" y="226">
super</text>
</g>
</g>
</g>
<path d=" M 79 89 h 10" />
</g>
<path d=" M 349 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 89 h 10" />
<path d=" M 339 89 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-lex.token.life.intro"><a class="rule-link" href="#r-lex.token.life.intro" title="lex.token.life.intro"><span>[lex<wbr>.token<wbr>.life<wbr>.intro]</span></a>
</div>

<p>生命周期参数和<a href="#循环及其他可中断表达式">循环标签</a>使用LIFETIME_OR_LABEL词法单元。任何LIFETIME_TOKEN都会被词法分析器接受，例如，可以在宏中使用。</p>
<div class="rule" id="r-lex.token.life.raw.intro"><a class="rule-link" href="#r-lex.token.life.raw.intro" title="lex.token.life.raw.intro"><span>[lex<wbr>.token<wbr>.life<wbr>.raw<wbr>.intro]</span></a>
</div>

<p>原始生命周期类似于普通生命周期，但其<a href="#标识符">标识符</a>带有<code>r#</code>前缀。（请注意，<code>r#</code>前缀不作为实际生命周期的一部分。）</p>
<div class="rule" id="r-lex.token.life.raw.allowed"><a class="rule-link" href="#r-lex.token.life.raw.allowed" title="lex.token.life.raw.allowed"><span>[lex<wbr>.token<wbr>.life<wbr>.raw<wbr>.allowed]</span></a>
</div>

<p>与普通生命周期不同，原始生命周期可以是除上述<code>RAW_LIFETIME</code>列出的<a href="#关键字">关键字</a>之外的任何严格或保留<a href="#关键字">关键字</a>。</p>
<div class="rule" id="r-lex.token.life.raw.reserved"><a class="rule-link" href="#r-lex.token.life.raw.reserved" title="lex.token.life.raw.reserved"><span>[lex<wbr>.token<wbr>.life<wbr>.raw<wbr>.reserved]</span></a>
</div>

<p>使用<a href="#grammar-RESERVED_RAW_LIFETIME">RESERVED_RAW_LIFETIME</a>词法单元是错误的。</p>
<div class="rule" id="r-lex.token.life.raw.edition2021"><a class="rule-link" href="#r-lex.token.life.raw.edition2021" title="lex.token.life.raw.edition2021"><span>[lex<wbr>.token<wbr>.life<wbr>.raw<wbr>.edition2021]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2021</span> 版次差异</p>

<p>原始生命周期在2021或更高版次中被接受。在更早的版次中，词法单元<code>'r#lt</code>被解析为<code>'r # lt</code>。</p>
</blockquote>
</div>

<div class="rule" id="r-lex.token.punct"><a class="rule-link" href="#r-lex.token.punct" title="lex.token.punct"><span>[lex<wbr>.token<wbr>.punct]</span></a>
</div>

<h2 id="标点符号"><a class="header" href="#标点符号">标点符号</a></h2>
<div class="rule" id="r-lex.token.punct.intro"><a class="rule-link" href="#r-lex.token.punct.intro" title="lex.token.punct.intro"><span>[lex<wbr>.token<wbr>.punct<wbr>.intro]</span></a>
</div>

<p>标点符号词法单元用作运算符、分隔符和语法格式的其他部分。</p>
<div class="rule" id="r-lex.token.punct.syntax"><a class="rule-link" href="#r-lex.token.punct.syntax" title="lex.token.punct.syntax"><span>[lex<wbr>.token<wbr>.punct<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-PUNCTUATION" onclick="show_railroad()"><a href="#railroad-PUNCTUATION">PUNCTUATION</a></span> → <br>      <span class="grammar-literal">...</span> <br>    | <span class="grammar-literal">..=</span> <br>    | <span class="grammar-literal">&lt;&lt;=</span> <br>    | <span class="grammar-literal">&gt;&gt;=</span> <br>    | <span class="grammar-literal">!=</span> <br>    | <span class="grammar-literal">%=</span> <br>    | <span class="grammar-literal">&amp;&amp;</span> <br>    | <span class="grammar-literal">&amp;=</span> <br>    | <span class="grammar-literal">*=</span> <br>    | <span class="grammar-literal">+=</span> <br>    | <span class="grammar-literal">-=</span> <br>    | <span class="grammar-literal">-&gt;</span> <br>    | <span class="grammar-literal">..</span> <br>    | <span class="grammar-literal">/=</span> <br>    | <span class="grammar-literal">::</span> <br>    | <span class="grammar-literal">&lt;-</span> <br>    | <span class="grammar-literal">&lt;&lt;</span> <br>    | <span class="grammar-literal">&lt;=</span> <br>    | <span class="grammar-literal">==</span> <br>    | <span class="grammar-literal">=&gt;</span> <br>    | <span class="grammar-literal">&gt;=</span> <br>    | <span class="grammar-literal">&gt;&gt;</span> <br>    | <span class="grammar-literal">&gt;</span> <br>    | <span class="grammar-literal">^=</span> <br>    | <span class="grammar-literal">|=</span> <br>    | <span class="grammar-literal">||</span> <br>    | <span class="grammar-literal">!</span> <br>    | <span class="grammar-literal">#</span> <br>    | <span class="grammar-literal">$</span> <br>    | <span class="grammar-literal">%</span> <br>    | <span class="grammar-literal">&amp;</span> <br>    | <span class="grammar-literal">(</span> <br>    | <span class="grammar-literal">)</span> <br>    | <span class="grammar-literal">*</span> <br>    | <span class="grammar-literal">+</span> <br>    | <span class="grammar-literal">,</span> <br>    | <span class="grammar-literal">-</span> <br>    | <span class="grammar-literal">.</span> <br>    | <span class="grammar-literal">/</span> <br>    | <span class="grammar-literal">:</span> <br>    | <span class="grammar-literal">;</span> <br>    | <span class="grammar-literal">&lt;</span> <br>    | <span class="grammar-literal">=</span> <br>    | <span class="grammar-literal">?</span> <br>    | <span class="grammar-literal">@</span> <br>    | <span class="grammar-literal">[</span> <br>    | <span class="grammar-literal">]</span> <br>    | <span class="grammar-literal">^</span> <br>    | <span class="grammar-literal">{</span> <br>    | <span class="grammar-literal">|</span> <br>    | <span class="grammar-literal">}</span> <br>    | <span class="grammar-literal">~</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 162px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-PUNCTUATION"><svg class="railroad" viewbox="0 0 162 1757" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-PUNCTUATION">
<text class="comment" x="53" y="25">
PUNCTUATION</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 44 0 h 24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="42" />
<text x="81" y="58">
...</text>
</g>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 68 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 68 0 v -33" />
<path d=" M 47 107 v 33 m 68 0 v -33" />
<path d=" M 47 140 v 33 m 68 0 v -33" />
<path d=" M 47 173 v 33 m 68 0 v -33" />
<path d=" M 47 206 v 33 m 68 0 v -33" />
<path d=" M 47 239 v 33 m 68 0 v -33" />
<path d=" M 47 272 v 33 m 68 0 v -33" />
<path d=" M 47 305 v 33 m 68 0 v -33" />
<path d=" M 47 338 v 33 m 68 0 v -33" />
<path d=" M 47 371 v 33 m 68 0 v -33" />
<path d=" M 47 404 v 33 m 68 0 v -33" />
<path d=" M 47 437 v 33 m 68 0 v -33" />
<path d=" M 47 470 v 33 m 68 0 v -33" />
<path d=" M 47 503 v 33 m 68 0 v -33" />
<path d=" M 47 536 v 33 m 68 0 v -33" />
<path d=" M 47 569 v 33 m 68 0 v -33" />
<path d=" M 47 602 v 33 m 68 0 v -33" />
<path d=" M 47 635 v 33 m 68 0 v -33" />
<path d=" M 47 668 v 33 m 68 0 v -33" />
<path d=" M 47 701 v 33 m 68 0 v -33" />
<path d=" M 47 734 v 33 m 68 0 v -33" />
<path d=" M 47 767 v 33 m 68 0 v -33" />
<path d=" M 47 800 v 33 m 68 0 v -33" />
<path d=" M 47 833 v 33 m 68 0 v -33" />
<path d=" M 47 866 v 33 m 68 0 v -33" />
<path d=" M 47 899 v 33 m 68 0 v -33" />
<path d=" M 47 932 v 33 m 68 0 v -33" />
<path d=" M 47 965 v 33 m 68 0 v -33" />
<path d=" M 47 998 v 33 m 68 0 v -33" />
<path d=" M 47 1031 v 33 m 68 0 v -33" />
<path d=" M 47 1064 v 33 m 68 0 v -33" />
<path d=" M 47 1097 v 33 m 68 0 v -33" />
<path d=" M 47 1130 v 33 m 68 0 v -33" />
<path d=" M 47 1163 v 33 m 68 0 v -33" />
<path d=" M 47 1196 v 33 m 68 0 v -33" />
<path d=" M 47 1229 v 33 m 68 0 v -33" />
<path d=" M 47 1262 v 33 m 68 0 v -33" />
<path d=" M 47 1295 v 33 m 68 0 v -33" />
<path d=" M 47 1328 v 33 m 68 0 v -33" />
<path d=" M 47 1361 v 33 m 68 0 v -33" />
<path d=" M 47 1394 v 33 m 68 0 v -33" />
<path d=" M 47 1427 v 33 m 68 0 v -33" />
<path d=" M 47 1460 v 33 m 68 0 v -33" />
<path d=" M 47 1493 v 33 m 68 0 v -33" />
<path d=" M 47 1526 v 33 m 68 0 v -33" />
<path d=" M 47 1559 v 33 m 68 0 v -33" />
<path d=" M 47 1592 v 33 m 68 0 v -33" />
<path d=" M 47 1625 v 33 m 68 0 v -33" />
<path d=" M 47 1658 v 33 m 68 0 v -33" />
<path d=" M 47 1691 v 33 m 68 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 44 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="75" />
<text x="81" y="91">
..=</text>
</g>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 44 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="108" />
<text x="81" y="124">
&lt;&lt;=</text>
</g>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 44 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="141" />
<text x="81" y="157">
&gt;&gt;=</text>
</g>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="174" />
<text x="77" y="190">
!=</text>
</g>
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="207" />
<text x="77" y="223">
%=</text>
</g>
</g>
<path d=" M 47 239 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="240" />
<text x="77" y="256">
&amp;&amp;</text>
</g>
</g>
<path d=" M 47 272 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="273" />
<text x="77" y="289">
&amp;=</text>
</g>
</g>
<path d=" M 47 305 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="306" />
<text x="77" y="322">
*=</text>
</g>
</g>
<path d=" M 47 338 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="339" />
<text x="77" y="355">
+=</text>
</g>
</g>
<path d=" M 47 371 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="372" />
<text x="77" y="388">
-=</text>
</g>
</g>
<path d=" M 47 404 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="405" />
<text x="77" y="421">
-&gt;</text>
</g>
</g>
<path d=" M 47 437 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="438" />
<text x="77" y="454">
..</text>
</g>
</g>
<path d=" M 47 470 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="471" />
<text x="77" y="487">
/=</text>
</g>
</g>
<path d=" M 47 503 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="504" />
<text x="77" y="520">
::</text>
</g>
</g>
<path d=" M 47 536 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="537" />
<text x="77" y="553">
&lt;-</text>
</g>
</g>
<path d=" M 47 569 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="570" />
<text x="77" y="586">
&lt;&lt;</text>
</g>
</g>
<path d=" M 47 602 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="603" />
<text x="77" y="619">
&lt;=</text>
</g>
</g>
<path d=" M 47 635 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="636" />
<text x="77" y="652">
==</text>
</g>
</g>
<path d=" M 47 668 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="669" />
<text x="77" y="685">
=&gt;</text>
</g>
</g>
<path d=" M 47 701 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="702" />
<text x="77" y="718">
&gt;=</text>
</g>
</g>
<path d=" M 47 734 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="735" />
<text x="77" y="751">
&gt;&gt;</text>
</g>
</g>
<path d=" M 47 767 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="768" />
<text x="73" y="784">
&gt;</text>
</g>
</g>
<path d=" M 47 800 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="801" />
<text x="77" y="817">
^=</text>
</g>
</g>
<path d=" M 47 833 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="834" />
<text x="77" y="850">
|=</text>
</g>
</g>
<path d=" M 47 866 v 0 a 12 12 0 0 0 12 12 m 36 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="867" />
<text x="77" y="883">
||</text>
</g>
</g>
<path d=" M 47 899 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="900" />
<text x="73" y="916">
!</text>
</g>
</g>
<path d=" M 47 932 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="933" />
<text x="73" y="949">
#</text>
</g>
</g>
<path d=" M 47 965 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="966" />
<text x="73" y="982">
$</text>
</g>
</g>
<path d=" M 47 998 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="999" />
<text x="73" y="1015">
%</text>
</g>
</g>
<path d=" M 47 1031 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1032" />
<text x="73" y="1048">
&amp;</text>
</g>
</g>
<path d=" M 47 1064 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1065" />
<text x="73" y="1081">
(</text>
</g>
</g>
<path d=" M 47 1097 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1098" />
<text x="73" y="1114">
)</text>
</g>
</g>
<path d=" M 47 1130 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1131" />
<text x="73" y="1147">
*</text>
</g>
</g>
<path d=" M 47 1163 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1164" />
<text x="73" y="1180">
+</text>
</g>
</g>
<path d=" M 47 1196 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1197" />
<text x="73" y="1213">
,</text>
</g>
</g>
<path d=" M 47 1229 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1230" />
<text x="73" y="1246">
-</text>
</g>
</g>
<path d=" M 47 1262 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1263" />
<text x="73" y="1279">
.</text>
</g>
</g>
<path d=" M 47 1295 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1296" />
<text x="73" y="1312">
/</text>
</g>
</g>
<path d=" M 47 1328 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1329" />
<text x="73" y="1345">
:</text>
</g>
</g>
<path d=" M 47 1361 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1362" />
<text x="73" y="1378">
;</text>
</g>
</g>
<path d=" M 47 1394 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1395" />
<text x="73" y="1411">
&lt;</text>
</g>
</g>
<path d=" M 47 1427 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1428" />
<text x="73" y="1444">
=</text>
</g>
</g>
<path d=" M 47 1460 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1461" />
<text x="73" y="1477">
?</text>
</g>
</g>
<path d=" M 47 1493 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1494" />
<text x="73" y="1510">
@</text>
</g>
</g>
<path d=" M 47 1526 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1527" />
<text x="73" y="1543">
[</text>
</g>
</g>
<path d=" M 47 1559 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1560" />
<text x="73" y="1576">
]</text>
</g>
</g>
<path d=" M 47 1592 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1593" />
<text x="73" y="1609">
^</text>
</g>
</g>
<path d=" M 47 1625 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1626" />
<text x="73" y="1642">
{</text>
</g>
</g>
<path d=" M 47 1658 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1659" />
<text x="73" y="1675">
|</text>
</g>
</g>
<path d=" M 47 1691 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1692" />
<text x="73" y="1708">
}</text>
</g>
</g>
<path d=" M 47 1724 v 0 a 12 12 0 0 0 12 12 m 28 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="1725" />
<text x="73" y="1741">
~</text>
</g>
</g>
<path d=" M 137 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 127 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>有关标点符号字符如何使用的链接，请参阅<a href="#operators-and-punctuation">语法格式索引</a>。</p>
</blockquote>
</div>

<div class="rule" id="r-lex.token.delim"><a class="rule-link" href="#r-lex.token.delim" title="lex.token.delim"><span>[lex<wbr>.token<wbr>.delim]</span></a>
</div>

<h2 id="分隔符"><a class="header" href="#分隔符">分隔符</a></h2>
<p>括号标点符号用于语法格式的各个部分。开括号必须始终与闭括号配对。括号及其内部的词法单元在<a href="#声明宏">宏</a>中被称为“词法单元树”。括号有三种类型：</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>括号</th><th>类型</th></tr>
</thead>
<tbody>
<tr><td><code>{</code> <code>}</code></td><td>花括号</td></tr>
<tr><td><code>[</code> <code>]</code></td><td>方括号</td></tr>
<tr><td><code>(</code> <code>)</code></td><td>小括号</td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-lex.token.reserved"><a class="rule-link" href="#r-lex.token.reserved" title="lex.token.reserved"><span>[lex<wbr>.token<wbr>.reserved]</span></a>
</div>

<h2 id="保留词法单元"><a class="header" href="#保留词法单元">保留词法单元</a></h2>
<div class="rule" id="r-lex.token.reserved.intro"><a class="rule-link" href="#r-lex.token.reserved.intro" title="lex.token.reserved.intro"><span>[lex<wbr>.token<wbr>.reserved<wbr>.intro]</span></a>
</div>

<p>几种词法单元形式被保留以备将来使用或避免混淆。源输入匹配其中一种形式是错误的。</p>
<div class="rule" id="r-lex.token.reserved.syntax"><a class="rule-link" href="#r-lex.token.reserved.syntax" title="lex.token.reserved.syntax"><span>[lex<wbr>.token<wbr>.reserved<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-RESERVED_TOKEN" onclick="show_railroad()"><a href="#railroad-RESERVED_TOKEN">RESERVED_TOKEN</a></span> → <br>      <span class="grammar-text"><a href="#grammar-RESERVED_GUARDED_STRING_LITERAL">RESERVED_GUARDED_STRING_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RESERVED_NUMBER">RESERVED_NUMBER</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RESERVED_POUNDS">RESERVED_POUNDS</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RESERVED_RAW_IDENTIFIER">RESERVED_RAW_IDENTIFIER</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RESERVED_RAW_LIFETIME">RESERVED_RAW_LIFETIME</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RESERVED_TOKEN_DOUBLE_QUOTE">RESERVED_TOKEN_DOUBLE_QUOTE</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RESERVED_TOKEN_LIFETIME">RESERVED_TOKEN_LIFETIME</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RESERVED_TOKEN_POUND">RESERVED_TOKEN_POUND</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RESERVED_TOKEN_SINGLE_QUOTE">RESERVED_TOKEN_SINGLE_QUOTE</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 394px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RESERVED_TOKEN"><svg class="railroad" viewbox="0 0 394 338" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RESERVED_TOKEN">
<text class="comment" x="64" y="25">
RESERVED_TOKEN</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 276 0 h 24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RESERVED_GUARDED_STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="276" x="59" y="42" />
<text x="197" y="58">
RESERVED_GUARDED_STRING_LITERAL</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 300 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 300 0 v -33" />
<path d=" M 47 107 v 33 m 300 0 v -33" />
<path d=" M 47 140 v 33 m 300 0 v -33" />
<path d=" M 47 173 v 33 m 300 0 v -33" />
<path d=" M 47 206 v 33 m 300 0 v -33" />
<path d=" M 47 239 v 33 m 300 0 v -33" />
<path d=" M 47 272 v 33 m 300 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 140 0 h 136 m -65 0 l -5 -5 m 0 10 l 5 -5 m 65 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RESERVED_NUMBER">
<g class="nonterminal">
<rect height="22" width="140" x="59" y="75" />
<text x="129" y="91">
RESERVED_NUMBER</text>
</g>
</a>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 140 0 h 136 m -65 0 l -5 -5 m 0 10 l 5 -5 m 65 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RESERVED_POUNDS">
<g class="nonterminal">
<rect height="22" width="140" x="59" y="108" />
<text x="129" y="124">
RESERVED_POUNDS</text>
</g>
</a>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 212 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RESERVED_RAW_IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="212" x="59" y="141" />
<text x="165" y="157">
RESERVED_RAW_IDENTIFIER</text>
</g>
</a>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 196 0 h 80 m -37 0 l -5 -5 m 0 10 l 5 -5 m 37 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RESERVED_RAW_LIFETIME">
<g class="nonterminal">
<rect height="22" width="196" x="59" y="174" />
<text x="157" y="190">
RESERVED_RAW_LIFETIME</text>
</g>
</a>
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 244 0 h 32 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RESERVED_TOKEN_DOUBLE_QUOTE">
<g class="nonterminal">
<rect height="22" width="244" x="59" y="207" />
<text x="181" y="223">
RESERVED_TOKEN_DOUBLE_QUOTE</text>
</g>
</a>
</g>
<path d=" M 47 239 v 0 a 12 12 0 0 0 12 12 m 212 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RESERVED_TOKEN_LIFETIME">
<g class="nonterminal">
<rect height="22" width="212" x="59" y="240" />
<text x="165" y="256">
RESERVED_TOKEN_LIFETIME</text>
</g>
</a>
</g>
<path d=" M 47 272 v 0 a 12 12 0 0 0 12 12 m 188 0 h 88 m -41 0 l -5 -5 m 0 10 l 5 -5 m 41 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RESERVED_TOKEN_POUND">
<g class="nonterminal">
<rect height="22" width="188" x="59" y="273" />
<text x="153" y="289">
RESERVED_TOKEN_POUND</text>
</g>
</a>
</g>
<path d=" M 47 305 v 0 a 12 12 0 0 0 12 12 m 244 0 h 32 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-RESERVED_TOKEN_SINGLE_QUOTE">
<g class="nonterminal">
<rect height="22" width="244" x="59" y="306" />
<text x="181" y="322">
RESERVED_TOKEN_SINGLE_QUOTE</text>
</g>
</a>
</g>
<path d=" M 369 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 359 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-lex.token.reserved-prefix"><a class="rule-link" href="#r-lex.token.reserved-prefix" title="lex.token.reserved-prefix"><span>[lex<wbr>.token<wbr>.reserved-prefix]</span></a>
</div>

<h2 id="保留前缀"><a class="header" href="#保留前缀">保留前缀</a></h2>
<div class="rule" id="r-lex.token.reserved-prefix.syntax"><a class="rule-link" href="#r-lex.token.reserved-prefix.syntax" title="lex.token.reserved-prefix.syntax"><span>[lex<wbr>.token<wbr>.reserved-prefix<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-RESERVED_TOKEN_DOUBLE_QUOTE" onclick="show_railroad()"><a href="#railroad-RESERVED_TOKEN_DOUBLE_QUOTE">RESERVED_TOKEN_DOUBLE_QUOTE</a></span> → <br>    <span class="grammar-text"><a href="#grammar-IDENTIFIER_OR_KEYWORD">IDENTIFIER_OR_KEYWORD</a></span><sub class="grammar-text">except <code>b</code> or <code>c</code> or <code>r</code> or <code>br</code> or <code>cr</code></sub> <span class="grammar-literal">"</span></p>
<p><span class="grammar-text grammar-production" id="grammar-RESERVED_TOKEN_SINGLE_QUOTE" onclick="show_railroad()"><a href="#railroad-RESERVED_TOKEN_SINGLE_QUOTE">RESERVED_TOKEN_SINGLE_QUOTE</a></span> → <br>    <span class="grammar-text"><a href="#grammar-IDENTIFIER_OR_KEYWORD">IDENTIFIER_OR_KEYWORD</a></span><sub class="grammar-text">except <code>b</code></sub> <span class="grammar-literal">'</span></p>
<p><span class="grammar-text grammar-production" id="grammar-RESERVED_TOKEN_POUND" onclick="show_railroad()"><a href="#railroad-RESERVED_TOKEN_POUND">RESERVED_TOKEN_POUND</a></span> → <br>    <span class="grammar-text"><a href="#grammar-IDENTIFIER_OR_KEYWORD">IDENTIFIER_OR_KEYWORD</a></span><sub class="grammar-text">except <code>r</code> or <code>br</code> or <code>cr</code></sub> <span class="grammar-literal">#</span></p>
<p><span class="grammar-text grammar-production" id="grammar-RESERVED_TOKEN_LIFETIME" onclick="show_railroad()"><a href="#railroad-RESERVED_TOKEN_LIFETIME">RESERVED_TOKEN_LIFETIME</a></span> → <br>    <span class="grammar-literal">'</span> <span class="grammar-text"><a href="#grammar-IDENTIFIER_OR_KEYWORD">IDENTIFIER_OR_KEYWORD</a></span><sub class="grammar-text">except <code>r</code></sub> <span class="grammar-literal">#</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 428px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RESERVED_TOKEN_DOUBLE_QUOTE"><svg class="railroad" viewbox="0 0 428 118" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RESERVED_TOKEN_DOUBLE_QUOTE">
<text class="comment" x="113" y="25">
RESERVED_TOKEN_DOUBLE_QUOTE</text>
</a>
<g class="sequence">
<path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="labeledbox">
<rect height="66" width="320" x="35" y="42" />
<path d=" M 35 89 h 8 m 196 0 h 116 m -55 0 l -5 -5 m 0 10 l 5 -5 m 55 0" />
<text class="comment" x="195" y="65">
except `b` or `c` or `r` or `br` or `cr`</text>
<a class="link" xlink:href="#railroad-IDENTIFIER_OR_KEYWORD">
<g class="nonterminal">
<rect height="22" width="196" x="43" y="78" />
<text x="141" y="94">
IDENTIFIER_OR_KEYWORD</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="365" y="78" />
<text x="379" y="94">
"</text>
</g>
<path d=" M 355 89 h 10" />
</g>
<path d=" M 403 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 89 h 10" />
<path d=" M 393 89 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 320px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RESERVED_TOKEN_SINGLE_QUOTE"><svg class="railroad" viewbox="0 0 320 118" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RESERVED_TOKEN_SINGLE_QUOTE">
<text class="comment" x="113" y="25">
RESERVED_TOKEN_SINGLE_QUOTE</text>
</a>
<g class="sequence">
<path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="labeledbox">
<rect height="66" width="212" x="35" y="42" />
<path d=" M 35 89 h 8 m 196 0 h 8" />
<text class="comment" x="83" y="65">
except `b`</text>
<a class="link" xlink:href="#railroad-IDENTIFIER_OR_KEYWORD">
<g class="nonterminal">
<rect height="22" width="196" x="43" y="78" />
<text x="141" y="94">
IDENTIFIER_OR_KEYWORD</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="257" y="78" />
<text x="271" y="94">
'</text>
</g>
<path d=" M 247 89 h 10" />
</g>
<path d=" M 295 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 89 h 10" />
<path d=" M 285 89 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 323px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RESERVED_TOKEN_POUND"><svg class="railroad" viewbox="0 0 323 118" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RESERVED_TOKEN_POUND">
<text class="comment" x="88" y="25">
RESERVED_TOKEN_POUND</text>
</a>
<g class="sequence">
<path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="labeledbox">
<rect height="66" width="215" x="35" y="42" />
<path d=" M 35 89 h 8 m 196 0 h 11" />
<text class="comment" x="142" y="65">
except `r` or `br` or `cr`</text>
<a class="link" xlink:href="#railroad-IDENTIFIER_OR_KEYWORD">
<g class="nonterminal">
<rect height="22" width="196" x="43" y="78" />
<text x="141" y="94">
IDENTIFIER_OR_KEYWORD</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="260" y="78" />
<text x="274" y="94">
#</text>
</g>
<path d=" M 250 89 h 10" />
</g>
<path d=" M 298 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 89 h 10" />
<path d=" M 288 89 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 358px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RESERVED_TOKEN_LIFETIME"><svg class="railroad" viewbox="0 0 358 118" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RESERVED_TOKEN_LIFETIME">
<text class="comment" x="99" y="25">
RESERVED_TOKEN_LIFETIME</text>
</a>
<g class="sequence">
<path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="78" />
<text x="49" y="94">
'</text>
</g>
<g class="labeledbox">
<rect height="66" width="212" x="73" y="42" />
<path d=" M 73 89 h 8 m 196 0 h 8" />
<text class="comment" x="121" y="65">
except `r`</text>
<a class="link" xlink:href="#railroad-IDENTIFIER_OR_KEYWORD">
<g class="nonterminal">
<rect height="22" width="196" x="81" y="78" />
<text x="179" y="94">
IDENTIFIER_OR_KEYWORD</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="295" y="78" />
<text x="309" y="94">
#</text>
</g>
<path d=" M 63 89 h 10" />
<path d=" M 285 89 h 10" />
</g>
<path d=" M 333 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 89 h 10" />
<path d=" M 323 89 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-lex.token.reserved-prefix.intro"><a class="rule-link" href="#r-lex.token.reserved-prefix.intro" title="lex.token.reserved-prefix.intro"><span>[lex<wbr>.token<wbr>.reserved-prefix<wbr>.intro]</span></a>
</div>

<p>一些被称为_保留前缀_的词法形式被保留以备将来使用。</p>
<div class="rule" id="r-lex.token.reserved-prefix.id"><a class="rule-link" href="#r-lex.token.reserved-prefix.id" title="lex.token.reserved-prefix.id"><span>[lex<wbr>.token<wbr>.reserved-prefix<wbr>.id]</span></a>
</div>

<p>源输入如果被词法解释为非原始<a href="#标识符">标识符</a>（或<a href="#关键字">关键字</a>），且紧跟<code>#</code>、<code>'</code>或<code>"</code>字符（无中间空白），则被识别为保留前缀。</p>
<div class="rule" id="r-lex.token.reserved-prefix.raw-token"><a class="rule-link" href="#r-lex.token.reserved-prefix.raw-token" title="lex.token.reserved-prefix.raw-token"><span>[lex<wbr>.token<wbr>.reserved-prefix<wbr>.raw-token]</span></a>
</div>

<p>请注意，原始<a href="#标识符">标识符</a>、原始字符串字面量和原始字节字符串字面量可能包含<code>#</code>字符，但不会被解释为包含保留前缀。</p>
<div class="rule" id="r-lex.token.reserved-prefix.strings"><a class="rule-link" href="#r-lex.token.reserved-prefix.strings" title="lex.token.reserved-prefix.strings"><span>[lex<wbr>.token<wbr>.reserved-prefix<wbr>.strings]</span></a>
</div>

<p>同样，用于原始字符串字面量、字节字面量、字节字符串字面量、原始字节字符串字面量、C字符串字面量和原始C字符串字面量的<code>r</code>、<code>b</code>、<code>br</code>、<code>c</code>和<code>cr</code>前缀不被解释为保留前缀。</p>
<div class="rule" id="r-lex.token.reserved-prefix.life"><a class="rule-link" href="#r-lex.token.reserved-prefix.life" title="lex.token.reserved-prefix.life"><span>[lex<wbr>.token<wbr>.reserved-prefix<wbr>.life]</span></a>
</div>

<p>源输入如果被词法解释为非原始生命周期（或<a href="#关键字">关键字</a>），且紧跟<code>#</code>字符（无中间空白），则被识别为保留生命周期前缀。</p>
<div class="rule" id="r-lex.token.reserved-prefix.edition2021"><a class="rule-link" href="#r-lex.token.reserved-prefix.edition2021" title="lex.token.reserved-prefix.edition2021"><span>[lex<wbr>.token<wbr>.reserved-prefix<wbr>.edition2021]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2021</span> 版次差异</p>

<p>从2021版次开始，词法分析器会将保留前缀报告为错误（特别是，它们不能传递给宏）。</p>
<p>在2021版次之前，词法分析器会接受保留前缀，并将其解释为多个词法单元（例如，<a href="#标识符">标识符</a>或<a href="#关键字">关键字</a>的一个词法单元，后跟一个<code>#</code>词法单元）。</p>
<p>所有版次都接受的示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! lexes {($($_:tt)*) =&gt; {}}
lexes!{a #foo}
lexes!{continue 'foo}
lexes!{match "..." {}}
lexes!{r#let#foo}         // 三个词法单元: r#let # foo
lexes!{'prefix #lt}
<span class="boring">}</span></code></pre>
<p>在2021版次之前接受但之后被拒绝的示例：</p>
<pre class="playground"><code class="language-rust edition2018"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! lexes {($($_:tt)*) =&gt; {}}
lexes!{a#foo}
lexes!{continue'foo}
lexes!{match"..." {}}
lexes!{'prefix#lt}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-lex.token.reserved-guards"><a class="rule-link" href="#r-lex.token.reserved-guards" title="lex.token.reserved-guards"><span>[lex<wbr>.token<wbr>.reserved-guards]</span></a>
</div>

<h2 id="保留的守卫"><a class="header" href="#保留的守卫">保留的守卫</a></h2>
<div class="rule" id="r-lex.token.reserved-guards.syntax"><a class="rule-link" href="#r-lex.token.reserved-guards.syntax" title="lex.token.reserved-guards.syntax"><span>[lex<wbr>.token<wbr>.reserved-guards<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Lexer</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-RESERVED_GUARDED_STRING_LITERAL" onclick="show_railroad()"><a href="#railroad-RESERVED_GUARDED_STRING_LITERAL">RESERVED_GUARDED_STRING_LITERAL</a></span> → <span class="grammar-literal">#</span><sup>+</sup> <span class="grammar-text"><a href="#grammar-STRING_LITERAL">STRING_LITERAL</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-RESERVED_POUNDS" onclick="show_railroad()"><a href="#railroad-RESERVED_POUNDS">RESERVED_POUNDS</a></span> → <span class="grammar-literal">#</span><sup>2..</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 264px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RESERVED_GUARDED_STRING_LITERAL"><svg class="railroad" viewbox="0 0 264 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RESERVED_GUARDED_STRING_LITERAL">
<text class="comment" x="127" y="25">
RESERVED_GUARDED_STRING_LITERAL</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="repeat">
<path d=" M 35 53 h 12 m 28 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -28 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="47" y="42" />
<text x="61" y="58">
#</text>
</g>
</g>
<a class="link" xlink:href="#railroad-STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="132" x="97" y="42" />
<text x="163" y="58">
STRING_LITERAL</text>
</g>
</a>
<path d=" M 87 53 h 10" />
</g>
<path d=" M 239 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 229 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 160px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RESERVED_POUNDS"><svg class="railroad" viewbox="0 0 160 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RESERVED_POUNDS">
<text class="comment" x="67" y="25">
RESERVED_POUNDS</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="42" />
<text x="49" y="58">
#</text>
</g>
<g class="repeat">
<path d=" M 73 53 h 12 m 28 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -28 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="85" y="42" />
<text x="99" y="58">
#</text>
</g>
</g>
<path d=" M 63 53 h 10" />
</g>
<path d=" M 135 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 125 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-lex.token.reserved-guards.intro"><a class="rule-link" href="#r-lex.token.reserved-guards.intro" title="lex.token.reserved-guards.intro"><span>[lex<wbr>.token<wbr>.reserved-guards<wbr>.intro]</span></a>
</div>

<p>保留的守卫是为将来使用而保留的语法格式，如果使用，将生成编译错误。</p>
<div class="rule" id="r-lex.token.reserved-guards.string-literal"><a class="rule-link" href="#r-lex.token.reserved-guards.string-literal" title="lex.token.reserved-guards.string-literal"><span>[lex<wbr>.token<wbr>.reserved-guards<wbr>.string-literal]</span></a>
</div>

<p><em>保留的带守卫字符串字面量</em>是一个词法单元，由一个或多个<code>U+0023</code>（<code>#</code>）紧接着一个<a href="#grammar-STRING_LITERAL">STRING_LITERAL</a>组成。</p>
<div class="rule" id="r-lex.token.reserved-guards.pounds"><a class="rule-link" href="#r-lex.token.reserved-guards.pounds" title="lex.token.reserved-guards.pounds"><span>[lex<wbr>.token<wbr>.reserved-guards<wbr>.pounds]</span></a>
</div>

<p><em>保留的井号</em>是一个由两个或更多<code>U+0023</code>（<code>#</code>）组成的词法单元。</p>
<div class="rule" id="r-lex.token.reserved-guards.edition2024"><a class="rule-link" href="#r-lex.token.reserved-guards.edition2024" title="lex.token.reserved-guards.edition2024"><span>[lex<wbr>.token<wbr>.reserved-guards<wbr>.edition2024]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2024</span> 版次差异</p>

<p>在2024版次之前，词法分析器会接受保留的守卫，并将其解释为多个词法单元。例如，<code>#"foo"#</code>形式被解释为三个词法单元。<code>##</code>被解释为两个词法单元。</p>
</blockquote>
</div>

<hr>
<ol class="footnote-definition">
<li id="footnote-nsets">
<p>相同字面量两侧<code>#</code>的数量必须相等。 <a href="#fr-nsets-1">↩</a></p>
</li>
<li id="footnote-nl">
<p>所有数字字面量都允许使用<code>_</code>作为视觉分隔符：<code>1_234.0E+18f64</code> <a href="#fr-nl-1">↩</a></p>
</li>
<li id="footnote-valid-hex-char">
<p>参阅<a href="#r-lex.token.literal.char-escape.unicode">lex.token.literal.char-escape.unicode</a>。 <a href="#fr-valid-hex-char-1">↩</a></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- https://github.com/rust-lang/reference/blob/master/src/macros.md -->
<!-- commit 68bdfd15fa9feebfbf94a06cf574de598e239198 -->
<div class="rule" id="r-macro"><a class="rule-link" href="#r-macro" title="macro"><span>[macro]</span></a>
</div>

<h1 id="宏"><a class="header" href="#宏">宏</a></h1>
<div class="rule" id="r-macro.intro"><a class="rule-link" href="#r-macro.intro" title="macro.intro"><span>[macro<wbr>.intro]</span></a>
</div>

<p>Rust的功能和语法可以通过称为宏的自定义定义进行扩展。它们被赋予名称，并通过一致的语法<code>some_extension!(...)</code>来调用。</p>
<p>有两种方法可以定义新宏：</p>
<ul>
<li><a href="#声明宏">声明宏</a> 以更高级的声明性方式定义新语法。</li>
<li><a href="#过程宏">过程宏</a> 使用操作输入词法单元的函数来定义函数式宏、自定义派生和自定义属性。</li>
</ul>
<div class="rule" id="r-macro.invocation"><a class="rule-link" href="#r-macro.invocation" title="macro.invocation"><span>[macro<wbr>.invocation]</span></a>
</div>

<h2 id="宏调用"><a class="header" href="#宏调用">宏调用</a></h2>
<div class="rule" id="r-macro.invocation.syntax"><a class="rule-link" href="#r-macro.invocation.syntax" title="macro.invocation.syntax"><span>[macro<wbr>.invocation<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-MacroInvocation" onclick="show_railroad()"><a href="#railroad-MacroInvocation">MacroInvocation</a></span> → <br>    <span class="grammar-text"><a href="#grammar-SimplePath">SimplePath</a></span> <span class="grammar-literal">!</span> <span class="grammar-text"><a href="#grammar-DelimTokenTree">DelimTokenTree</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-DelimTokenTree" onclick="show_railroad()"><a href="#railroad-DelimTokenTree">DelimTokenTree</a></span> → <br>      <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-TokenTree">TokenTree</a></span><sup>*</sup> <span class="grammar-literal">)</span> <br>    | <span class="grammar-literal">[</span> <span class="grammar-text"><a href="#grammar-TokenTree">TokenTree</a></span><sup>*</sup> <span class="grammar-literal">]</span> <br>    | <span class="grammar-literal">{</span> <span class="grammar-text"><a href="#grammar-TokenTree">TokenTree</a></span><sup>*</sup> <span class="grammar-literal">}</span></p>
<p><span class="grammar-text grammar-production" id="grammar-TokenTree" onclick="show_railroad()"><a href="#railroad-TokenTree">TokenTree</a></span> → <br>    <span class="grammar-text"><a href="#grammar-Token">Token</a></span><sub class="grammar-text">except <a href="#r-lex.token.delim">delimiters</a></sub> | <span class="grammar-text"><a href="#grammar-DelimTokenTree">DelimTokenTree</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroInvocationSemi" onclick="show_railroad()"><a href="#railroad-MacroInvocationSemi">MacroInvocationSemi</a></span> → <br>      <span class="grammar-text"><a href="#grammar-SimplePath">SimplePath</a></span> <span class="grammar-literal">!</span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-TokenTree">TokenTree</a></span><sup>*</sup> <span class="grammar-literal">)</span> <span class="grammar-literal">;</span> <br>    | <span class="grammar-text"><a href="#grammar-SimplePath">SimplePath</a></span> <span class="grammar-literal">!</span> <span class="grammar-literal">[</span> <span class="grammar-text"><a href="#grammar-TokenTree">TokenTree</a></span><sup>*</sup> <span class="grammar-literal">]</span> <span class="grammar-literal">;</span> <br>    | <span class="grammar-text"><a href="#grammar-SimplePath">SimplePath</a></span> <span class="grammar-literal">!</span> <span class="grammar-literal">{</span> <span class="grammar-text"><a href="#grammar-TokenTree">TokenTree</a></span><sup>*</sup> <span class="grammar-literal">}</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 350px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroInvocation"><svg class="railroad" viewbox="0 0 350 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MacroInvocation">
<text class="comment" x="67" y="25">
MacroInvocation</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-SimplePath">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="42" />
<text x="85" y="58">
SimplePath</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="145" y="42" />
<text x="159" y="58">
!</text>
</g>
<a class="link" xlink:href="#railroad-DelimTokenTree">
<g class="nonterminal">
<rect height="22" width="132" x="183" y="42" />
<text x="249" y="58">
DelimTokenTree</text>
</g>
</a>
<path d=" M 135 53 h 10" />
<path d=" M 173 53 h 10" />
</g>
<path d=" M 325 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 315 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 358px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-DelimTokenTree"><svg class="railroad" viewbox="0 0 358 216" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-DelimTokenTree">
<text class="comment" x="64" y="25">
DelimTokenTree</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 66 h 24 m 240 0 h 24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="55" />
<text x="73" y="71">
(</text>
</g>
<g class="optional">
<path d=" M 97 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 116 m -55 0 l -5 -5 m 0 10 l 5 -5 m 55 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 121 66 h 12 m 92 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -92 m 49 0 l 5 -5 m 0 10 l -5 -5 m -49 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-TokenTree">
<g class="nonterminal">
<rect height="22" width="92" x="133" y="55" />
<text x="179" y="71">
TokenTree</text>
</g>
</a>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="271" y="55" />
<text x="285" y="71">
)</text>
</g>
<path d=" M 87 66 h 10" />
<path d=" M 261 66 h 10" />
</g>
<path d=" M 35 66 a 12 12 0 0 1 12 12 v 22 m 264 0 v -22 a 12 12 0 0 1 12 -12" />
<path d=" M 47 112 v 46 m 264 0 v -46" />
<path d=" M 47 100 v 12 a 12 12 0 0 0 12 12 m 240 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="113" />
<text x="73" y="129">
[</text>
</g>
<g class="optional">
<path d=" M 97 124 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 116 m -55 0 l -5 -5 m 0 10 l 5 -5 m 55 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 121 124 h 12 m 92 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -92 m 49 0 l 5 -5 m 0 10 l -5 -5 m -49 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-TokenTree">
<g class="nonterminal">
<rect height="22" width="92" x="133" y="113" />
<text x="179" y="129">
TokenTree</text>
</g>
</a>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="271" y="113" />
<text x="285" y="129">
]</text>
</g>
<path d=" M 87 124 h 10" />
<path d=" M 261 124 h 10" />
</g>
<path d=" M 47 158 v 12 a 12 12 0 0 0 12 12 m 240 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="171" />
<text x="73" y="187">
{</text>
</g>
<g class="optional">
<path d=" M 97 182 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 116 m -55 0 l -5 -5 m 0 10 l 5 -5 m 55 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 121 182 h 12 m 92 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -92 m 49 0 l 5 -5 m 0 10 l -5 -5 m -49 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-TokenTree">
<g class="nonterminal">
<rect height="22" width="92" x="133" y="171" />
<text x="179" y="187">
TokenTree</text>
</g>
</a>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="271" y="171" />
<text x="285" y="187">
}</text>
</g>
<path d=" M 87 182 h 10" />
<path d=" M 261 182 h 10" />
</g>
</g>
<path d=" M 333 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 323 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 263px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TokenTree"><svg class="railroad" viewbox="0 0 263 151" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TokenTree">
<text class="comment" x="46" y="25">
TokenTree</text>
</a>
<g class="sequence">
<path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 89 h 24 m 145 0 h 24" />
<g class="sequence">
<g class="labeledbox">
<rect height="66" width="145" x="59" y="42" />
<path d=" M 59 89 h 8 m 60 0 h 77 m -35 0 l -5 -5 m 0 10 l 5 -5 m 35 0" />
<text class="comment" x="131" y="65">
except delimiters</text>
<a class="link" xlink:href="#railroad-Token">
<g class="nonterminal">
<rect height="22" width="60" x="67" y="78" />
<text x="97" y="94">
Token</text>
</g>
</a>
</g>
</g>
<path d=" M 35 89 a 12 12 0 0 1 12 12 v 17 m 169 0 v -17 a 12 12 0 0 1 12 -12" />
<path d=" M 47 118 v 0 a 12 12 0 0 0 12 12 m 132 0 h 13 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-DelimTokenTree">
<g class="nonterminal">
<rect height="22" width="132" x="59" y="119" />
<text x="125" y="135">
DelimTokenTree</text>
</g>
</a>
</g>
<path d=" M 238 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 89 h 10" />
<path d=" M 228 89 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 544px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroInvocationSemi"><svg class="railroad" viewbox="0 0 544 216" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MacroInvocationSemi">
<text class="comment" x="81" y="25">
MacroInvocationSemi</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 66 h 24 m 426 0 h 24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-SimplePath">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="55" />
<text x="109" y="71">
SimplePath</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="55" />
<text x="183" y="71">
!</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="207" y="55" />
<text x="221" y="71">
(</text>
</g>
<g class="optional">
<path d=" M 245 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 116 m -55 0 l -5 -5 m 0 10 l 5 -5 m 55 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 269 66 h 12 m 92 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -92 m 49 0 l 5 -5 m 0 10 l -5 -5 m -49 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-TokenTree">
<g class="nonterminal">
<rect height="22" width="92" x="281" y="55" />
<text x="327" y="71">
TokenTree</text>
</g>
</a>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="419" y="55" />
<text x="433" y="71">
)</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="457" y="55" />
<text x="471" y="71">
;</text>
</g>
<path d=" M 159 66 h 10" />
<path d=" M 197 66 h 10" />
<path d=" M 235 66 h 10" />
<path d=" M 409 66 h 10" />
<path d=" M 447 66 h 10" />
</g>
<path d=" M 35 66 a 12 12 0 0 1 12 12 v 22 m 450 0 v -22 a 12 12 0 0 1 12 -12" />
<path d=" M 47 112 v 46 m 450 0 v -46" />
<path d=" M 47 100 v 12 a 12 12 0 0 0 12 12 m 426 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<a class="link" xlink:href="#railroad-SimplePath">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="113" />
<text x="109" y="129">
SimplePath</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="113" />
<text x="183" y="129">
!</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="207" y="113" />
<text x="221" y="129">
[</text>
</g>
<g class="optional">
<path d=" M 245 124 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 116 m -55 0 l -5 -5 m 0 10 l 5 -5 m 55 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 269 124 h 12 m 92 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -92 m 49 0 l 5 -5 m 0 10 l -5 -5 m -49 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-TokenTree">
<g class="nonterminal">
<rect height="22" width="92" x="281" y="113" />
<text x="327" y="129">
TokenTree</text>
</g>
</a>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="419" y="113" />
<text x="433" y="129">
]</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="457" y="113" />
<text x="471" y="129">
;</text>
</g>
<path d=" M 159 124 h 10" />
<path d=" M 197 124 h 10" />
<path d=" M 235 124 h 10" />
<path d=" M 409 124 h 10" />
<path d=" M 447 124 h 10" />
</g>
<path d=" M 47 158 v 12 a 12 12 0 0 0 12 12 m 388 0 h 38 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<a class="link" xlink:href="#railroad-SimplePath">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="171" />
<text x="109" y="187">
SimplePath</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="171" />
<text x="183" y="187">
!</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="207" y="171" />
<text x="221" y="187">
{</text>
</g>
<g class="optional">
<path d=" M 245 182 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 116 m -55 0 l -5 -5 m 0 10 l 5 -5 m 55 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 269 182 h 12 m 92 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -92 m 49 0 l 5 -5 m 0 10 l -5 -5 m -49 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-TokenTree">
<g class="nonterminal">
<rect height="22" width="92" x="281" y="171" />
<text x="327" y="187">
TokenTree</text>
</g>
</a>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="419" y="171" />
<text x="433" y="187">
}</text>
</g>
<path d=" M 159 182 h 10" />
<path d=" M 197 182 h 10" />
<path d=" M 235 182 h 10" />
<path d=" M 409 182 h 10" />
</g>
</g>
<path d=" M 519 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 509 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-macro.invocation.intro"><a class="rule-link" href="#r-macro.invocation.intro" title="macro.invocation.intro"><span>[macro<wbr>.invocation<wbr>.intro]</span></a>
</div>

<p>宏调用在编译时展开宏，并用宏的结果替换该调用。宏可以在以下情况中调用：</p>
<div class="rule" id="r-macro.invocation.expr"><a class="rule-link" href="#r-macro.invocation.expr" title="macro.invocation.expr"><span>[macro<wbr>.invocation<wbr>.expr]</span></a>
</div>

<ul>
<li><a href="#表达式">表达式</a>和<a href="#语句">语句</a></li>
</ul>
<div class="rule" id="r-macro.invocation.pattern"><a class="rule-link" href="#r-macro.invocation.pattern" title="macro.invocation.pattern"><span>[macro<wbr>.invocation<wbr>.pattern]</span></a>
</div>

<ul>
<li><a href="#模式">模式</a></li>
</ul>
<div class="rule" id="r-macro.invocation.type"><a class="rule-link" href="#r-macro.invocation.type" title="macro.invocation.type"><span>[macro<wbr>.invocation<wbr>.type]</span></a>
</div>

<ul>
<li><a href="#类型">类型</a></li>
</ul>
<div class="rule" id="r-macro.invocation.item"><a class="rule-link" href="#r-macro.invocation.item" title="macro.invocation.item"><span>[macro<wbr>.invocation<wbr>.item]</span></a>
</div>

<ul>
<li><a href="#项">项</a>包括<a href="#关联项">关联项</a></li>
</ul>
<div class="rule" id="r-macro.invocation.nested"><a class="rule-link" href="#r-macro.invocation.nested" title="macro.invocation.nested"><span>[macro<wbr>.invocation<wbr>.nested]</span></a>
</div>

<ul>
<li><a href="#声明宏"><code>macro_rules</code></a>转录器</li>
</ul>
<div class="rule" id="r-macro.invocation.extern"><a class="rule-link" href="#r-macro.invocation.extern" title="macro.invocation.extern"><span>[macro<wbr>.invocation<wbr>.extern]</span></a>
</div>

<ul>
<li><a href="#外部块">外部块</a></li>
</ul>
<div class="rule" id="r-macro.invocation.item-statement"><a class="rule-link" href="#r-macro.invocation.item-statement" title="macro.invocation.item-statement"><span>[macro<wbr>.invocation<wbr>.item-statement]</span></a>
</div>

<p>当用作项或语句时，使用<a href="#grammar-MacroInvocationSemi">MacroInvocationSemi</a>形式，如果未使用大括号，则末尾需要分号。<a href="#可见性和私有性">可见性限定符</a>绝不允许出现在宏调用或<a href="#声明宏"><code>macro_rules</code></a>定义之前。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 用作表达式。
let x = vec![1,2,3];

// 用作语句。
println!("Hello!");

// 用在模式中。
macro_rules! pat {
    ($i:ident) =&gt; (Some($i))
}

if let pat!(x) = Some(1) {
    assert_eq!(x, 1);
}

// 用在类型中。
macro_rules! Tuple {
    { $A:ty, $B:ty } =&gt; { ($A, $B) };
}

type N2 = Tuple!(i32, i32);

// 用作项。
<span class="boring">use std::cell::RefCell;
</span>thread_local!(static FOO: RefCell&lt;u32&gt; = RefCell::new(1));

// 用作关联项。
macro_rules! const_maker {
    ($t:ty, $v:tt) =&gt; { const CONST: $t = $v; };
}
trait T {
    const_maker!{i32, 7}
}

// 宏内的宏调用。
macro_rules! example {
    () =&gt; { println!("Macro call in a macro!") };
}
// 外部宏`example`展开后，内部宏`println`也会展开。
example!();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-macro.invocation.name-resolution"><a class="rule-link" href="#r-macro.invocation.name-resolution" title="macro.invocation.name-resolution"><span>[macro<wbr>.invocation<wbr>.name-resolution]</span></a>
</div>

<p>宏调用可以通过两种作用域进行解析：</p>
<ul>
<li>文本作用域
<ul>
<li><a href="#r-macro.decl.scope.textual">文本作用域<code>macro_rules</code></a></li>
</ul>
</li>
<li>基于路径的作用域
<ul>
<li><a href="#r-macro.decl.scope.path-based">基于路径的作用域<code>macro_rules</code></a></li>
<li><a href="#过程宏">过程宏</a></li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><!-- https://github.com/rust-lang/reference/blob/master/src/macros-by-example.md -->
<!-- commit 68bdfd15fa9feebfbf94a06cf574de598e239198 -->
<div class="rule" id="r-macro.decl"><a class="rule-link" href="#r-macro.decl" title="macro.decl"><span>[macro<wbr>.decl]</span></a>
</div>

<h1 id="声明宏"><a class="header" href="#声明宏">声明宏</a></h1>
<div class="rule" id="r-macro.decl.syntax"><a class="rule-link" href="#r-macro.decl.syntax" title="macro.decl.syntax"><span>[macro<wbr>.decl<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-MacroRulesDefinition" onclick="show_railroad()"><a href="#railroad-MacroRulesDefinition">MacroRulesDefinition</a></span> → <br>    <span class="grammar-literal">macro_rules</span> <span class="grammar-literal">!</span> <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-text"><a href="#grammar-MacroRulesDef">MacroRulesDef</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroRulesDef" onclick="show_railroad()"><a href="#railroad-MacroRulesDef">MacroRulesDef</a></span> → <br>      <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-MacroRules">MacroRules</a></span> <span class="grammar-literal">)</span> <span class="grammar-literal">;</span> <br>    | <span class="grammar-literal">[</span> <span class="grammar-text"><a href="#grammar-MacroRules">MacroRules</a></span> <span class="grammar-literal">]</span> <span class="grammar-literal">;</span> <br>    | <span class="grammar-literal">{</span> <span class="grammar-text"><a href="#grammar-MacroRules">MacroRules</a></span> <span class="grammar-literal">}</span></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroRules" onclick="show_railroad()"><a href="#railroad-MacroRules">MacroRules</a></span> → <br>    <span class="grammar-text"><a href="#grammar-MacroRule">MacroRule</a></span> ( <span class="grammar-literal">;</span> <span class="grammar-text"><a href="#grammar-MacroRule">MacroRule</a></span> )<sup>*</sup> <span class="grammar-literal">;</span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroRule" onclick="show_railroad()"><a href="#railroad-MacroRule">MacroRule</a></span> → <br>    <span class="grammar-text"><a href="#grammar-MacroMatcher">MacroMatcher</a></span> <span class="grammar-literal">=&gt;</span> <span class="grammar-text"><a href="#grammar-MacroTranscriber">MacroTranscriber</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroMatcher" onclick="show_railroad()"><a href="#railroad-MacroMatcher">MacroMatcher</a></span> → <br>      <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-MacroMatch">MacroMatch</a></span><sup>*</sup> <span class="grammar-literal">)</span> <br>    | <span class="grammar-literal">[</span> <span class="grammar-text"><a href="#grammar-MacroMatch">MacroMatch</a></span><sup>*</sup> <span class="grammar-literal">]</span> <br>    | <span class="grammar-literal">{</span> <span class="grammar-text"><a href="#grammar-MacroMatch">MacroMatch</a></span><sup>*</sup> <span class="grammar-literal">}</span></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroMatch" onclick="show_railroad()"><a href="#railroad-MacroMatch">MacroMatch</a></span> → <br>      <span class="grammar-text"><a href="#grammar-Token">Token</a></span><sub class="grammar-text">except <code>$</code> and <a href="#r-lex.token.delim">delimiters</a></sub> <br>    | <span class="grammar-text"><a href="#grammar-MacroMatcher">MacroMatcher</a></span> <br>    | <span class="grammar-literal">$</span> ( <span class="grammar-text"><a href="#grammar-IDENTIFIER_OR_KEYWORD">IDENTIFIER_OR_KEYWORD</a></span><sub class="grammar-text">except <code>crate</code></sub> | <span class="grammar-text"><a href="#grammar-RAW_IDENTIFIER">RAW_IDENTIFIER</a></span> ) <span class="grammar-literal">:</span> <span class="grammar-text"><a href="#grammar-MacroFragSpec">MacroFragSpec</a></span> <br>    | <span class="grammar-literal">$</span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-MacroMatch">MacroMatch</a></span><sup>+</sup> <span class="grammar-literal">)</span> <span class="grammar-text"><a href="#grammar-MacroRepSep">MacroRepSep</a></span><sup>?</sup> <span class="grammar-text"><a href="#grammar-MacroRepOp">MacroRepOp</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroFragSpec" onclick="show_railroad()"><a href="#railroad-MacroFragSpec">MacroFragSpec</a></span> → <br>      <span class="grammar-literal">block</span> | <span class="grammar-literal">expr</span> | <span class="grammar-literal">expr_2021</span> | <span class="grammar-literal">ident</span> | <span class="grammar-literal">item</span> | <span class="grammar-literal">lifetime</span> | <span class="grammar-literal">literal</span> <br>    | <span class="grammar-literal">meta</span> | <span class="grammar-literal">pat</span> | <span class="grammar-literal">pat_param</span> | <span class="grammar-literal">path</span> | <span class="grammar-literal">stmt</span> | <span class="grammar-literal">tt</span> | <span class="grammar-literal">ty</span> | <span class="grammar-literal">vis</span></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroRepSep" onclick="show_railroad()"><a href="#railroad-MacroRepSep">MacroRepSep</a></span> → <span class="grammar-text"><a href="#grammar-Token">Token</a></span><sub class="grammar-text">except <a href="#r-lex.token.delim">delimiters</a> and <a href="#grammar-MacroRepOp">MacroRepOp</a></sub></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroRepOp" onclick="show_railroad()"><a href="#railroad-MacroRepOp">MacroRepOp</a></span> → <span class="grammar-literal">*</span> | <span class="grammar-literal">+</span> | <span class="grammar-literal">?</span></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroTranscriber" onclick="show_railroad()"><a href="#railroad-MacroTranscriber">MacroTranscriber</a></span> → <span class="grammar-text"><a href="#grammar-DelimTokenTree">DelimTokenTree</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 460px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroRulesDefinition"><svg class="railroad" viewbox="0 0 460 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MacroRulesDefinition">
<text class="comment" x="88" y="25">
MacroRulesDefinition</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="108" x="35" y="42" />
<text x="89" y="58">
macro_rules</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="153" y="42" />
<text x="167" y="58">
!</text>
</g>
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="191" y="42" />
<text x="241" y="58">
IDENTIFIER</text>
</g>
</a>
<a class="link" xlink:href="#railroad-MacroRulesDef">
<g class="nonterminal">
<rect height="22" width="124" x="301" y="42" />
<text x="363" y="58">
MacroRulesDef</text>
</g>
</a>
<path d=" M 143 53 h 10" />
<path d=" M 181 53 h 10" />
<path d=" M 291 53 h 10" />
</g>
<path d=" M 435 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 425 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 332px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroRulesDef"><svg class="railroad" viewbox="0 0 332 140" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MacroRulesDef">
<text class="comment" x="60" y="25">
MacroRulesDef</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 214 0 h 24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="42" />
<text x="73" y="58">
(</text>
</g>
<a class="link" xlink:href="#railroad-MacroRules">
<g class="nonterminal">
<rect height="22" width="100" x="97" y="42" />
<text x="147" y="58">
MacroRules</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="207" y="42" />
<text x="221" y="58">
)</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="245" y="42" />
<text x="259" y="58">
;</text>
</g>
<path d=" M 87 53 h 10" />
<path d=" M 197 53 h 10" />
<path d=" M 235 53 h 10" />
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 238 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 238 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 214 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="75" />
<text x="73" y="91">
[</text>
</g>
<a class="link" xlink:href="#railroad-MacroRules">
<g class="nonterminal">
<rect height="22" width="100" x="97" y="75" />
<text x="147" y="91">
MacroRules</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="207" y="75" />
<text x="221" y="91">
]</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="245" y="75" />
<text x="259" y="91">
;</text>
</g>
<path d=" M 87 86 h 10" />
<path d=" M 197 86 h 10" />
<path d=" M 235 86 h 10" />
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 176 0 h 38 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="108" />
<text x="73" y="124">
{</text>
</g>
<a class="link" xlink:href="#railroad-MacroRules">
<g class="nonterminal">
<rect height="22" width="100" x="97" y="108" />
<text x="147" y="124">
MacroRules</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="207" y="108" />
<text x="221" y="124">
}</text>
</g>
<path d=" M 87 119 h 10" />
<path d=" M 197 119 h 10" />
</g>
</g>
<path d=" M 307 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 297 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 460px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroRules"><svg class="railroad" viewbox="0 0 460 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MacroRules">
<text class="comment" x="50" y="25">
MacroRules</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-MacroRule">
<g class="nonterminal">
<rect height="22" width="92" x="35" y="55" />
<text x="81" y="71">
MacroRule</text>
</g>
</a>
<g class="optional">
<path d=" M 137 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 154 m -74 0 l -5 -5 m 0 10 l 5 -5 m 74 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 161 66 h 12 m 130 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -130 m 68 0 l 5 -5 m 0 10 l -5 -5 m -68 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="173" y="55" />
<text x="187" y="71">
;</text>
</g>
<a class="link" xlink:href="#railroad-MacroRule">
<g class="nonterminal">
<rect height="22" width="92" x="211" y="55" />
<text x="257" y="71">
MacroRule</text>
</g>
</a>
<path d=" M 201 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 349 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="373" y="55" />
<text x="387" y="71">
;</text>
</g>
</g>
<path d=" M 127 66 h 10" />
<path d=" M 339 66 h 10" />
</g>
<path d=" M 435 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 425 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 390px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroRule"><svg class="railroad" viewbox="0 0 390 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MacroRule">
<text class="comment" x="46" y="25">
MacroRule</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-MacroMatcher">
<g class="nonterminal">
<rect height="22" width="116" x="35" y="42" />
<text x="93" y="58">
MacroMatcher</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="161" y="42" />
<text x="179" y="58">
=&gt;</text>
</g>
<a class="link" xlink:href="#railroad-MacroTranscriber">
<g class="nonterminal">
<rect height="22" width="148" x="207" y="42" />
<text x="281" y="58">
MacroTranscriber</text>
</g>
</a>
<path d=" M 151 53 h 10" />
<path d=" M 197 53 h 10" />
</g>
<path d=" M 365 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 355 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 366px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroMatcher"><svg class="railroad" viewbox="0 0 366 216" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MacroMatcher">
<text class="comment" x="57" y="25">
MacroMatcher</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 66 h 24 m 248 0 h 24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="55" />
<text x="73" y="71">
(</text>
</g>
<g class="optional">
<path d=" M 97 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 124 m -59 0 l -5 -5 m 0 10 l 5 -5 m 59 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 121 66 h 12 m 100 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -100 m 53 0 l 5 -5 m 0 10 l -5 -5 m -53 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-MacroMatch">
<g class="nonterminal">
<rect height="22" width="100" x="133" y="55" />
<text x="183" y="71">
MacroMatch</text>
</g>
</a>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="279" y="55" />
<text x="293" y="71">
)</text>
</g>
<path d=" M 87 66 h 10" />
<path d=" M 269 66 h 10" />
</g>
<path d=" M 35 66 a 12 12 0 0 1 12 12 v 22 m 272 0 v -22 a 12 12 0 0 1 12 -12" />
<path d=" M 47 112 v 46 m 272 0 v -46" />
<path d=" M 47 100 v 12 a 12 12 0 0 0 12 12 m 248 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="113" />
<text x="73" y="129">
[</text>
</g>
<g class="optional">
<path d=" M 97 124 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 124 m -59 0 l -5 -5 m 0 10 l 5 -5 m 59 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 121 124 h 12 m 100 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -100 m 53 0 l 5 -5 m 0 10 l -5 -5 m -53 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-MacroMatch">
<g class="nonterminal">
<rect height="22" width="100" x="133" y="113" />
<text x="183" y="129">
MacroMatch</text>
</g>
</a>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="279" y="113" />
<text x="293" y="129">
]</text>
</g>
<path d=" M 87 124 h 10" />
<path d=" M 269 124 h 10" />
</g>
<path d=" M 47 158 v 12 a 12 12 0 0 0 12 12 m 248 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="171" />
<text x="73" y="187">
{</text>
</g>
<g class="optional">
<path d=" M 97 182 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 124 m -59 0 l -5 -5 m 0 10 l 5 -5 m 59 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 121 182 h 12 m 100 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -100 m 53 0 l 5 -5 m 0 10 l -5 -5 m -53 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-MacroMatch">
<g class="nonterminal">
<rect height="22" width="100" x="133" y="171" />
<text x="183" y="187">
MacroMatch</text>
</g>
</a>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="279" y="171" />
<text x="293" y="187">
}</text>
</g>
<path d=" M 87 182 h 10" />
<path d=" M 269 182 h 10" />
</g>
</g>
<path d=" M 341 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 331 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 632px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroMatch"><svg class="railroad" viewbox="0 0 632 318" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MacroMatch">
<text class="comment" x="50" y="25">
MacroMatch</text>
</a>
<g class="sequence">
<path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 89 h 24 m 208 0 h 330 m -162 0 l -5 -5 m 0 10 l 5 -5 m 162 0" />
<g class="sequence">
<g class="labeledbox">
<rect height="66" width="208" x="59" y="42" />
<path d=" M 59 89 h 8 m 60 0 h 140 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0" />
<text class="comment" x="163" y="65">
except `$` and delimiters</text>
<a class="link" xlink:href="#railroad-Token">
<g class="nonterminal">
<rect height="22" width="60" x="67" y="78" />
<text x="97" y="94">
Token</text>
</g>
</a>
</g>
</g>
<path d=" M 35 89 a 12 12 0 0 1 12 12 v 17 m 538 0 v -17 a 12 12 0 0 1 12 -12" />
<path d=" M 47 118 v 33 m 538 0 v -33" />
<path d=" M 47 186 v 74 m 0 -34 l -5 -5 m 10 0 l -5 5 m 0 34 m 538 0 v -74 m 0 40 l -5 5 m 10 0 l -5 -5 m 0 -40" />
<path d=" M 47 118 v 0 a 12 12 0 0 0 12 12 m 116 0 h 398 m -196 0 l -5 -5 m 0 10 l 5 -5 m 196 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-MacroMatcher">
<g class="nonterminal">
<rect height="22" width="116" x="59" y="119" />
<text x="117" y="135">
MacroMatcher</text>
</g>
</a>
</g>
<path d=" M 47 151 v 35 a 12 12 0 0 0 12 12 m 470 0 h 44 a 12 12 0 0 0 12 -12 v -35" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="187" />
<text x="73" y="203">
$</text>
</g>
<g class="choice">
<path d=" M 97 198 h 24 m 212 0 h 24" />
<g class="labeledbox">
<rect height="66" width="212" x="121" y="151" />
<path d=" M 121 198 h 8 m 196 0 h 8" />
<text class="comment" x="183" y="174">
except `crate`</text>
<a class="link" xlink:href="#railroad-IDENTIFIER_OR_KEYWORD">
<g class="nonterminal">
<rect height="22" width="196" x="129" y="187" />
<text x="227" y="203">
IDENTIFIER_OR_KEYWORD</text>
</g>
</a>
</g>
<path d=" M 97 198 a 12 12 0 0 1 12 12 v 17 m 236 0 v -17 a 12 12 0 0 1 12 -12" />
<path d=" M 109 227 v 0 a 12 12 0 0 0 12 12 m 132 0 h 80 m -37 0 l -5 -5 m 0 10 l 5 -5 m 37 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-RAW_IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="132" x="121" y="228" />
<text x="187" y="244">
RAW_IDENTIFIER</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="367" y="187" />
<text x="381" y="203">
:</text>
</g>
<a class="link" xlink:href="#railroad-MacroFragSpec">
<g class="nonterminal">
<rect height="22" width="124" x="405" y="187" />
<text x="467" y="203">
MacroFragSpec</text>
</g>
</a>
<path d=" M 87 198 h 10" />
<path d=" M 357 198 h 10" />
<path d=" M 395 198 h 10" />
</g>
<path d=" M 47 260 v 12 a 12 12 0 0 0 12 12 m 514 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="273" />
<text x="73" y="289">
$</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="97" y="273" />
<text x="111" y="289">
(</text>
</g>
<g class="repeat">
<path d=" M 135 284 h 12 m 100 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -100 m 53 0 l 5 -5 m 0 10 l -5 -5 m -53 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-MacroMatch">
<g class="nonterminal">
<rect height="22" width="100" x="147" y="273" />
<text x="197" y="289">
MacroMatch</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="269" y="273" />
<text x="283" y="289">
)</text>
</g>
<g class="optional">
<path d=" M 307 284 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 108 m -51 0 l -5 -5 m 0 10 l 5 -5 m 51 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-MacroRepSep">
<g class="nonterminal">
<rect height="22" width="108" x="331" y="273" />
<text x="385" y="289">
MacroRepSep</text>
</g>
</a>
</g>
<a class="link" xlink:href="#railroad-MacroRepOp">
<g class="nonterminal">
<rect height="22" width="100" x="473" y="273" />
<text x="523" y="289">
MacroRepOp</text>
</g>
</a>
<path d=" M 87 284 h 10" />
<path d=" M 125 284 h 10" />
<path d=" M 259 284 h 10" />
<path d=" M 297 284 h 10" />
<path d=" M 463 284 h 10" />
</g>
</g>
<path d=" M 607 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 89 h 10" />
<path d=" M 597 89 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 210px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroFragSpec"><svg class="railroad" viewbox="0 0 210 536" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MacroFragSpec">
<text class="comment" x="60" y="25">
MacroFragSpec</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 60 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="59" y="42" />
<text x="89" y="58">
block</text>
</g>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 116 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 116 0 v -33" />
<path d=" M 47 107 v 33 m 116 0 v -33" />
<path d=" M 47 140 v 33 m 116 0 v -33" />
<path d=" M 47 173 v 33 m 116 0 v -33" />
<path d=" M 47 206 v 33 m 116 0 v -33" />
<path d=" M 47 239 v 33 m 116 0 v -33" />
<path d=" M 47 272 v 33 m 116 0 v -33" />
<path d=" M 47 305 v 33 m 116 0 v -33" />
<path d=" M 47 338 v 33 m 116 0 v -33" />
<path d=" M 47 371 v 33 m 116 0 v -33" />
<path d=" M 47 404 v 33 m 116 0 v -33" />
<path d=" M 47 437 v 33 m 116 0 v -33" />
<path d=" M 47 470 v 33 m 116 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 52 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="75" />
<text x="85" y="91">
expr</text>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 92 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="92" x="59" y="108" />
<text x="105" y="124">
expr_2021</text>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 60 0 h 32 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="59" y="141" />
<text x="89" y="157">
ident</text>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 52 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="174" />
<text x="85" y="190">
item</text>
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 84 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="84" x="59" y="207" />
<text x="101" y="223">
lifetime</text>
</g>
<path d=" M 47 239 v 0 a 12 12 0 0 0 12 12 m 76 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="76" x="59" y="240" />
<text x="97" y="256">
literal</text>
</g>
</g>
<path d=" M 47 272 v 0 a 12 12 0 0 0 12 12 m 52 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="273" />
<text x="85" y="289">
meta</text>
</g>
<path d=" M 47 305 v 0 a 12 12 0 0 0 12 12 m 44 0 h 48 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="306" />
<text x="81" y="322">
pat</text>
</g>
<path d=" M 47 338 v 0 a 12 12 0 0 0 12 12 m 92 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="92" x="59" y="339" />
<text x="105" y="355">
pat_param</text>
</g>
<path d=" M 47 371 v 0 a 12 12 0 0 0 12 12 m 52 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="372" />
<text x="85" y="388">
path</text>
</g>
<path d=" M 47 404 v 0 a 12 12 0 0 0 12 12 m 52 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="405" />
<text x="85" y="421">
stmt</text>
</g>
<path d=" M 47 437 v 0 a 12 12 0 0 0 12 12 m 36 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="438" />
<text x="77" y="454">
tt</text>
</g>
<path d=" M 47 470 v 0 a 12 12 0 0 0 12 12 m 36 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="471" />
<text x="77" y="487">
ty</text>
</g>
<path d=" M 47 503 v 0 a 12 12 0 0 0 12 12 m 44 0 h 48 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="504" />
<text x="81" y="520">
vis</text>
</g>
</g>
<path d=" M 185 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 175 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 327px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroRepSep"><svg class="railroad" viewbox="0 0 327 118" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MacroRepSep">
<text class="comment" x="53" y="25">
MacroRepSep</text>
</a>
<g class="sequence">
<path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="labeledbox">
<rect height="66" width="257" x="35" y="42" />
<path d=" M 35 89 h 8 m 60 0 h 189 m -91 0 l -5 -5 m 0 10 l 5 -5 m 91 0" />
<text class="comment" x="163" y="65">
except delimiters and MacroRepOp</text>
<a class="link" xlink:href="#railroad-Token">
<g class="nonterminal">
<rect height="22" width="60" x="43" y="78" />
<text x="73" y="94">
Token</text>
</g>
</a>
</g>
<path d=" M 302 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 89 h 10" />
<path d=" M 292 89 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 146px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroRepOp"><svg class="railroad" viewbox="0 0 146 140" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MacroRepOp">
<text class="comment" x="50" y="25">
MacroRepOp</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 28 0 h 24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="42" />
<text x="73" y="58">
*</text>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 52 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 52 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 28 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="75" />
<text x="73" y="91">
+</text>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 28 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="108" />
<text x="73" y="124">
?</text>
</g>
</g>
<path d=" M 121 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 111 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 202px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroTranscriber"><svg class="railroad" viewbox="0 0 202 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MacroTranscriber">
<text class="comment" x="71" y="25">
MacroTranscriber</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<a class="link" xlink:href="#railroad-DelimTokenTree">
<g class="nonterminal">
<rect height="22" width="132" x="35" y="42" />
<text x="101" y="58">
DelimTokenTree</text>
</g>
</a>
<path d=" M 177 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 167 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-macro.decl.intro"><a class="rule-link" href="#r-macro.decl.intro" title="macro.decl.intro"><span>[macro<wbr>.decl<wbr>.intro]</span></a>
</div>

<p><code>macro_rules</code> 允许用户以声明式的方式定义语法扩展。我们称这种扩展为“声明宏”或简称“宏”。</p>
<p>每个声明宏都有一个名称和一条或多条 <em>规则</em> 。每条规则包含两部分：一个 <em>匹配器</em> ，描述它匹配的语法；一个 <em>转录器</em> ，描述成功匹配的调用将替换成的语法。匹配器和转录器都必须由分隔符包围。宏可以展开为表达式、语句、项（包括特型、impl 和外部项）、类型或模式。</p>
<div class="rule" id="r-macro.decl.transcription"><a class="rule-link" href="#r-macro.decl.transcription" title="macro.decl.transcription"><span>[macro<wbr>.decl<wbr>.transcription]</span></a>
</div>

<h2 id="转录"><a class="header" href="#转录">转录</a></h2>
<div class="rule" id="r-macro.decl.transcription.intro"><a class="rule-link" href="#r-macro.decl.transcription.intro" title="macro.decl.transcription.intro"><span>[macro<wbr>.decl<wbr>.transcription<wbr>.intro]</span></a>
</div>

<p>当宏被调用时，宏扩展器会按名称查找宏调用，并依次尝试每条宏规则。它转录第一个成功匹配的规则；如果此操作导致错误，则不会尝试后续匹配。</p>
<div class="rule" id="r-macro.decl.transcription.lookahead"><a class="rule-link" href="#r-macro.decl.transcription.lookahead" title="macro.decl.transcription.lookahead"><span>[macro<wbr>.decl<wbr>.transcription<wbr>.lookahead]</span></a>
</div>

<p>匹配时，不执行前瞻(lookahead)；如果编译器无法逐个词法单元明确地确定如何解析宏调用，则会报错。在下面的示例中，编译器不会在前瞻到标识符之后，去检查后面的词法单元是否是 <code>)</code>，即使那样可以使其明确地解析调用：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! ambiguity {
    ($($i:ident)* $j:ident) =&gt; { };
}

ambiguity!(error); // 错误：局部歧义
<span class="boring">}</span></code></pre>
<div class="rule" id="r-macro.decl.transcription.syntax"><a class="rule-link" href="#r-macro.decl.transcription.syntax" title="macro.decl.transcription.syntax"><span>[macro<wbr>.decl<wbr>.transcription<wbr>.syntax]</span></a>
</div>

<p>在匹配器和转录器中，<code>$</code> 词法单元用于调用宏引擎的特殊行为（在下面的<a href="#元变量">元变量</a>和<a href="#重复">重复</a>中描述）。不属于此类调用的词法单元会被字面匹配和转录，但有一个例外。这个例外是，匹配器的外部分隔符将匹配任意一对分隔符。因此，例如，匹配器 <code>(())</code> 将匹配 <code>{()}</code> 但不匹配 <code>{{}}</code>。字符 <code>$</code> 不能被字面匹配或转录。</p>
<div class="rule" id="r-macro.decl.transcription.fragment"><a class="rule-link" href="#r-macro.decl.transcription.fragment" title="macro.decl.transcription.fragment"><span>[macro<wbr>.decl<wbr>.transcription<wbr>.fragment]</span></a>
</div>

<h3 id="转发匹配到的片段"><a class="header" href="#转发匹配到的片段">转发匹配到的片段</a></h3>
<p>当将一个匹配到的片段转发给另一个声明宏时，第二个宏中的匹配器将看到该片段类型的不透明 AST。第二个宏不能使用字面词法单元来匹配匹配器中的片段，只能使用相同类型的片段说明符。<code>ident</code>、<code>lifetime</code> 和 <code>tt</code> 片段类型是一个例外，它们<em>可以</em>通过字面词法单元进行匹配。下面示例说明了此限制：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! foo {
    ($l:expr) =&gt; { bar!($l); }
// 错误：               ^^ 宏调用中不期望此词法单元
}

macro_rules! bar {
    (3) =&gt; {}
}

foo!(3);
<span class="boring">}</span></code></pre>
<p>下面示例说明了在匹配 <code>tt</code> 片段后如何直接匹配词法单元：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 编译通过
macro_rules! foo {
    ($l:tt) =&gt; { bar!($l); }
}

macro_rules! bar {
    (3) =&gt; {}
}

foo!(3);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-macro.decl.meta"><a class="rule-link" href="#r-macro.decl.meta" title="macro.decl.meta"><span>[macro<wbr>.decl<wbr>.meta]</span></a>
</div>

<h2 id="元变量"><a class="header" href="#元变量">元变量</a></h2>
<div class="rule" id="r-macro.decl.meta.intro"><a class="rule-link" href="#r-macro.decl.meta.intro" title="macro.decl.meta.intro"><span>[macro<wbr>.decl<wbr>.meta<wbr>.intro]</span></a>
</div>

<p>在匹配器中，<code>$</code> <em>名称</em> <code>:</code> <em>片段说明符</em> 匹配指定种类的Rust语法片段，并将其绑定到元变量 <code>$</code><em>名称</em>。</p>
<div class="rule" id="r-macro.decl.meta.specifier"><a class="rule-link" href="#r-macro.decl.meta.specifier" title="macro.decl.meta.specifier"><span>[macro<wbr>.decl<wbr>.meta<wbr>.specifier]</span></a>
</div>

<p>有效的片段说明符有：</p>
<ul>
<li><code>block</code>：一个<a href="#grammar-BlockExpression">块表达式</a></li>
<li><code>expr</code>：一个<a href="#grammar-Expression">表达式</a></li>
<li><code>expr_2021</code>：一个<a href="#grammar-Expression">表达式</a>，除了<a href="#grammar-UnderscoreExpression">下划线表达式</a>和<a href="#grammar-ConstBlockExpression">常量块表达式</a>（参见<a href="#r-macro.decl.meta.edition2024">macro.decl.meta.edition2024</a>）</li>
<li><code>ident</code>：一个<a href="#grammar-IDENTIFIER_OR_KEYWORD">IDENTIFIER_OR_KEYWORD</a>，除了 <code>_</code>、<a href="#grammar-RAW_IDENTIFIER">RAW_IDENTIFIER</a>或<a href="#r-macro.decl.hygiene.crate"><code>$crate</code></a></li>
<li><code>item</code>：一个<a href="#grammar-Item">项</a></li>
<li><code>lifetime</code>：一个<a href="#grammar-LIFETIME_TOKEN">LIFETIME_TOKEN</a></li>
<li><code>literal</code>：匹配 <code>-</code><sup>?</sup><a href="#grammar-LiteralExpression">字面量表达式</a></li>
<li><code>meta</code>：一个<a href="#grammar-Attr">Attr</a>，一个属性的内容</li>
<li><code>pat</code>：一个<a href="#grammar-Pattern">模式</a>（参见<a href="#r-macro.decl.meta.edition2021">macro.decl.meta.edition2021</a>）</li>
<li><code>pat_param</code>：一个<a href="#grammar-PatternNoTopAlt">PatternNoTopAlt</a></li>
<li><code>path</code>：一个<a href="#grammar-TypePath">TypePath</a>样式的路径</li>
<li><code>stmt</code>：一个<a href="#grammar-Statement">语句</a>，不带末尾分号（需要分号的项语句除外）</li>
<li><code>tt</code>：一个<a href="#grammar-TokenTree">TokenTree</a> （一个单独的<a href="#词法单元">词法单元</a>或匹配分隔符 <code>()</code>、<code>[]</code> 或 <code>{}</code> 中的词法单元）</li>
<li><code>ty</code>：一个<a href="#grammar-Type">类型</a></li>
<li><code>vis</code>：一个可能为空的<a href="#grammar-Visibility">可见性</a>限定符</li>
</ul>
<div class="rule" id="r-macro.decl.meta.transcription"><a class="rule-link" href="#r-macro.decl.meta.transcription" title="macro.decl.meta.transcription"><span>[macro<wbr>.decl<wbr>.meta<wbr>.transcription]</span></a>
</div>

<p>在转录器中，元变量仅通过 <code>$</code><em>名称</em> 引用，因为片段种类已在匹配器中指定。元变量会被替换为匹配它们的语法元素。元变量可以被转录多次或根本不转录。</p>
<div class="rule" id="r-macro.decl.meta.dollar-crate"><a class="rule-link" href="#r-macro.decl.meta.dollar-crate" title="macro.decl.meta.dollar-crate"><span>[macro<wbr>.decl<wbr>.meta<wbr>.dollar-crate]</span></a>
</div>

<p>关键字元变量 <a href="#r-macro.decl.hygiene.crate"><code>$crate</code></a> 可用于指代当前 crate。</p>
<div class="rule" id="r-macro.decl.meta.edition2021"><a class="rule-link" href="#r-macro.decl.meta.edition2021" title="macro.decl.meta.edition2021"><span>[macro<wbr>.decl<wbr>.meta<wbr>.edition2021]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2021</span> 版次差异</p>

<p>从2021版次开始，<code>pat</code> 片段说明符匹配顶层或模式（即，它们接受<a href="#grammar-Pattern">模式</a>）。</p>
<p>在2021版次之前，它们匹配的片段与 <code>pat_param</code> 完全相同（即，它们接受<a href="#grammar-PatternNoTopAlt">PatternNoTopAlt</a>）。</p>
<p>相关的版次是 <code>macro_rules!</code> 定义生效的版次。</p>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.meta.edition2024"><a class="rule-link" href="#r-macro.decl.meta.edition2024" title="macro.decl.meta.edition2024"><span>[macro<wbr>.decl<wbr>.meta<wbr>.edition2024]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2024</span> 版次差异</p>

<p>在2024版次之前，<code>expr</code>片段说明符不匹配顶层的<a href="#grammar-UnderscoreExpression">下划线表达式</a>或<a href="#grammar-ConstBlockExpression">常量块表达式</a>。它们在子表达式中是允许的。</p>
<p>存在<code>expr_2021</code>片段说明符是为了保持与2024之前的版次的向后兼容性。</p>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.repetition"><a class="rule-link" href="#r-macro.decl.repetition" title="macro.decl.repetition"><span>[macro<wbr>.decl<wbr>.repetition]</span></a>
</div>

<h2 id="重复"><a class="header" href="#重复">重复</a></h2>
<div class="rule" id="r-macro.decl.repetition.intro"><a class="rule-link" href="#r-macro.decl.repetition.intro" title="macro.decl.repetition.intro"><span>[macro<wbr>.decl<wbr>.repetition<wbr>.intro]</span></a>
</div>

<p>在匹配器和转录器中，重复是通过将要重复的词法单元放在 <code>$(</code>…<code>)</code> 内部，然后跟随一个重复操作符来表示的，可选地在两者之间放置一个分隔词法单元。</p>
<div class="rule" id="r-macro.decl.repetition.separator"><a class="rule-link" href="#r-macro.decl.repetition.separator" title="macro.decl.repetition.separator"><span>[macro<wbr>.decl<wbr>.repetition<wbr>.separator]</span></a>
</div>

<p>分隔词法单元可以是除分隔符或重复操作符之外的任何词法单元，但 <code>;</code> 和 <code>,</code> 最为常见。例如，<code>$( $i:ident ),*</code> 表示任意数量的用逗号分隔的标识符。允许嵌套重复。</p>
<div class="rule" id="r-macro.decl.repetition.operators"><a class="rule-link" href="#r-macro.decl.repetition.operators" title="macro.decl.repetition.operators"><span>[macro<wbr>.decl<wbr>.repetition<wbr>.operators]</span></a>
</div>

<p>重复操作符有：</p>
<ul>
<li><code>*</code> — 表示任意数量的重复。</li>
<li><code>+</code> — 表示任意数量，但至少一个。</li>
<li><code>?</code> — 表示一个可选片段，出现零次或一次。</li>
</ul>
<div class="rule" id="r-macro.decl.repetition.optional-restriction"><a class="rule-link" href="#r-macro.decl.repetition.optional-restriction" title="macro.decl.repetition.optional-restriction"><span>[macro<wbr>.decl<wbr>.repetition<wbr>.optional-restriction]</span></a>
</div>

<p>由于 <code>?</code> 最多表示一次出现，它不能与分隔符一起使用。</p>
<div class="rule" id="r-macro.decl.repetition.fragment"><a class="rule-link" href="#r-macro.decl.repetition.fragment" title="macro.decl.repetition.fragment"><span>[macro<wbr>.decl<wbr>.repetition<wbr>.fragment]</span></a>
</div>

<p>重复片段既匹配又转录为指定数量的片段，并由分隔词法单元分隔。元变量匹配其相应片段的每次重复。例如，上面 <code>$( $i:ident ),*</code> 示例将 <code>$i</code> 匹配到列表中的所有标识符。</p>
<p>在转录期间，对重复施加了额外的限制，以便编译器知道如何正确地展开它们：</p>
<ol>
<li>元变量在转录器中出现的重复次数、种类和嵌套顺序必须与在匹配器中完全相同。因此，对于匹配器 <code>$( $i:ident ),*</code>，转录器 <code>=&gt; { $i }</code>、<code>=&gt; { $( $( $i )* )* }</code> 和 <code>=&gt; { $( $i )+ }</code> 都是非法的，但 <code>=&gt; { $( $i );* }</code> 是正确的，它将逗号分隔的标识符列表替换为分号分隔的列表。</li>
<li>转录器中的每个重复必须至少包含一个元变量，以决定要展开多少次。如果在同一个重复中出现多个元变量，它们必须绑定到相同数量的片段。例如，<code>( $( $i:ident ),* ; $( $j:ident ),* ) =&gt; (( $( ($i,$j) ),* ))</code> 必须绑定与 <code>$j</code> 片段相同数量的 <code>$i</code> 片段。这意味着用 <code>(a, b, c; d, e, f)</code> 调用宏是合法的，并展开为 <code>((a,d), (b,e), (c,f))</code>，但 <code>(a, b, c; d, e)</code> 是非法的，因为它没有相同数量的片段。此要求适用于每个嵌套重复层。</li>
</ol>
<div class="rule" id="r-macro.decl.scope"><a class="rule-link" href="#r-macro.decl.scope" title="macro.decl.scope"><span>[macro<wbr>.decl<wbr>.scope]</span></a>
</div>

<h2 id="作用域导出和导入"><a class="header" href="#作用域导出和导入">作用域、导出和导入</a></h2>
<div class="rule" id="r-macro.decl.scope.intro"><a class="rule-link" href="#r-macro.decl.scope.intro" title="macro.decl.scope.intro"><span>[macro<wbr>.decl<wbr>.scope<wbr>.intro]</span></a>
</div>

<p>由于历史原因，声明宏的作用域不完全像项那样工作。宏有两种形式的作用域：文本作用域和基于路径的作用域。文本作用域基于事物在源文件中出现的顺序，甚至可以跨多个文件，它是默认的作用域。这将在下面进一步解释。基于路径的作用域与项作用域的工作方式完全相同。宏的作用域、导出和导入主要由属性控制。</p>
<div class="rule" id="r-macro.decl.scope.unqualified"><a class="rule-link" href="#r-macro.decl.scope.unqualified" title="macro.decl.scope.unqualified"><span>[macro<wbr>.decl<wbr>.scope<wbr>.unqualified]</span></a>
</div>

<p>当宏通过非限定标识符（不属于多部分路径）调用时，它首先在文本作用域中查找。如果没有结果，则在基于路径的作用域中查找。如果宏的名称使用路径进行限定，则它只在基于路径的作用域中查找。</p>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">use lazy_static::lazy_static; // 基于路径的导入。

macro_rules! lazy_static { // 文本定义。
    (lazy) =&gt; {};
}

lazy_static!{lazy} // 文本查找首先找到我们的宏。
self::lazy_static!{} // 基于路径的查找忽略我们的宏，找到导入的宏。</code></pre>
<div class="rule" id="r-macro.decl.scope.textual"><a class="rule-link" href="#r-macro.decl.scope.textual" title="macro.decl.scope.textual"><span>[macro<wbr>.decl<wbr>.scope<wbr>.textual]</span></a>
</div>

<h3 id="文本作用域"><a class="header" href="#文本作用域">文本作用域</a></h3>
<div class="rule" id="r-macro.decl.scope.textual.intro"><a class="rule-link" href="#r-macro.decl.scope.textual.intro" title="macro.decl.scope.textual.intro"><span>[macro<wbr>.decl<wbr>.scope<wbr>.textual<wbr>.intro]</span></a>
</div>

<p>文本作用域主要基于事物在源文件中出现的顺序，其工作方式类似于用 <code>let</code> 声明的局部变量的作用域，只不过它也适用于模块级别。当使用 <code>macro_rules!</code> 定义宏时，宏在定义之后（请注意，它仍然可以递归使用，因为名称是从调用站点查找的）进入作用域，直到其周围的作用域（通常是模块）关闭。这可以进入子模块，甚至跨越多个文件：</p>
<!-- ignore: requires external modules -->
<pre><code class="language-rust ignore">//// src/lib.rs
mod has_macro {
    // m!{} // 错误：m 不在作用域中。

    macro_rules! m {
        () =&gt; {};
    }
    m!{} // 正常：出现在 m 的声明之后。

    mod uses_macro;
}

// m!{} // 错误：m 不在作用域中。

//// src/has_macro/uses_macro.rs

m!{} // 正常：出现在 src/lib.rs 中 m 的声明之后。</code></pre>
<div class="rule" id="r-macro.decl.scope.textual.shadow"><a class="rule-link" href="#r-macro.decl.scope.textual.shadow" title="macro.decl.scope.textual.shadow"><span>[macro<wbr>.decl<wbr>.scope<wbr>.textual<wbr>.shadow]</span></a>
</div>

<p>多次定义宏不是错误；除非前一个声明已超出作用域，否则最近的声明将遮蔽前一个。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! m {
    (1) =&gt; {};
}

m!(1);

mod inner {
    m!(1);

    macro_rules! m {
        (2) =&gt; {};
    }
    // m!(1); // 错误：没有规则匹配 '1'
    m!(2);

    macro_rules! m {
        (3) =&gt; {};
    }
    m!(3);
}

m!(1);
<span class="boring">}</span></code></pre>
<p>宏也可以在函数内部局部声明和使用，工作方式类似：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo() {
    // m!(); // 错误：m 不在作用域中。
    macro_rules! m {
        () =&gt; {};
    }
    m!();
}

// m!(); // 错误：m 不在作用域中。
<span class="boring">}</span></code></pre>
<div class="rule" id="r-macro.decl.scope.textual.shadow.path-based"><a class="rule-link" href="#r-macro.decl.scope.textual.shadow.path-based" title="macro.decl.scope.textual.shadow.path-based"><span>[macro<wbr>.decl<wbr>.scope<wbr>.textual<wbr>.shadow<wbr>.path-based]</span></a>
</div>

<p>宏的文本作用域名称绑定会遮蔽宏的基于路径的作用域绑定。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! m2 {
    () =&gt; {
        println!("m2");
    };
}

// 解析为下方 use 声明中的基于路径的候选。
m!(); // 打印 "m2\n"

// 引入第二个具有文本作用域的 `m` 候选。
//
// 这将遮蔽本示例其余部分中来自下方的基于路径的候选。
macro_rules! m {
    () =&gt; {
        println!("m");
    };
}

// 引入 `m2` 宏作为基于路径的候选。
//
// 此项在此整个示例中均在作用域内，而不仅仅在 use 声明下方。
use m2 as m;

// 解析为 use 声明上方具有文本作用域的宏候选。
m!(); // 打印 "m\n"
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>有关不允许遮蔽的区域，请参见<a href="#r-names.resolution.expansion.imports.ambiguity">名称解析歧义</a>。</p>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.path-based"><a class="rule-link" href="#r-macro.decl.scope.path-based" title="macro.decl.scope.path-based"><span>[macro<wbr>.decl<wbr>.scope<wbr>.path-based]</span></a>
</div>

<h3 id="基于路径的作用域"><a class="header" href="#基于路径的作用域">基于路径的作用域</a></h3>
<div class="rule" id="r-macro.decl.scope.path-based.intro"><a class="rule-link" href="#r-macro.decl.scope.path-based.intro" title="macro.decl.scope.path-based.intro"><span>[macro<wbr>.decl<wbr>.scope<wbr>.path-based<wbr>.intro]</span></a>
</div>

<p>默认情况下，宏没有基于路径的作用域。宏可以通过两种方式获得基于路径的作用域：</p>
<ul>
<li><a href="#use可见性">use声明重导出</a></li>
<li><a href="#r-macro.decl.scope.macro_export"><code>macro_export</code></a></li>
</ul>
<div class="rule" id="r-macro.decl.scope.path.reexport"><a class="rule-link" href="#r-macro.decl.scope.path.reexport" title="macro.decl.scope.path.reexport"><span>[macro<wbr>.decl<wbr>.scope<wbr>.path<wbr>.reexport]</span></a>
</div>

<p>宏可以被重导出，以使其获得来自除 crate 根模块之外的模块的基于路径的作用域。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>mac::m!(); // 正常：基于路径的查找在 mac 模块中找到 `m`。

mod mac {
    // 引入具有文本作用域的宏 `m`。
    macro_rules! m {
        () =&gt; {};
    }

    // 从 `m` 的文本作用域内重导出具有基于路径的作用域。
    pub(crate) use m;
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-macro.decl.scope.path-based.visibility"><a class="rule-link" href="#r-macro.decl.scope.path-based.visibility" title="macro.decl.scope.path-based.visibility"><span>[macro<wbr>.decl<wbr>.scope<wbr>.path-based<wbr>.visibility]</span></a>
</div>

<p>宏具有隐式的 <code>pub(crate)</code> 可见性。<code>#[macro_export]</code> 将隐式可见性更改为 <code>pub</code>。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 隐式可见性为 `pub(crate)`。
macro_rules! private_m {
    () =&gt; {};
}

// 隐式可见性为 `pub`。
#[macro_export]
macro_rules! pub_m {
    () =&gt; {};
}

pub(crate) use private_m as private_macro; // 正常。
pub use pub_m as pub_macro; // 正常。
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0364 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">// 隐式可见性为 `pub(crate)`。
</span><span class="boring">macro_rules! private_m {
</span><span class="boring">    () =&gt; {};
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">// 隐式可见性为 `pub`。
</span><span class="boring">#[macro_export]
</span><span class="boring">macro_rules! pub_m {
</span><span class="boring">    () =&gt; {};
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub(crate) use private_m as private_macro; // 正常。
</span><span class="boring">pub use pub_m as pub_macro; // 正常。
</span><span class="boring">
</span>pub use private_m; // 错误：`private_m` 仅在该 crate 内可见
                   // 且不能在外部重导出。
<span class="boring">}</span></code></pre>
<!-- template:attributes -->
<div class="rule" id="r-macro.decl.scope.macro_use"><a class="rule-link" href="#r-macro.decl.scope.macro_use" title="macro.decl.scope.macro_use"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_use]</span></a>
</div>

<h3 id="macro_use属性"><a class="header" href="#macro_use属性"><code>macro_use</code>属性</a></h3>
<div class="rule" id="r-macro.decl.scope.macro_use.intro"><a class="rule-link" href="#r-macro.decl.scope.macro_use.intro" title="macro.decl.scope.macro_use.intro"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_use<wbr>.intro]</span></a>
</div>

<p><em><code>macro_use</code> <a href="#r-attributes">属性</a></em> 有两个目的：它可以用于模块，以扩展其中定义的宏的作用域；它也可以用于 <a href="#r-items.extern-crate"><code>extern crate</code></a>，将其他 crate 中的宏导入到<a href="#macro_use-prelude"><code>macro_use</code>预导入</a>中。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[macro_use]
mod inner {
    macro_rules! m {
        () =&gt; {};
    }
}
m!(); // 正常
<span class="boring">}</span></code></pre>
<pre><code class="language-rust ignore">#[macro_use]
extern crate log;</code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_use.syntax"><a class="rule-link" href="#r-macro.decl.scope.macro_use.syntax" title="macro.decl.scope.macro_use.syntax"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_use<wbr>.syntax]</span></a>
</div>

<p>当用于模块时，<code>macro_use</code> 属性使用 <a href="#grammar-MetaWord">MetaWord</a> 语法。</p>
<p>当用于 <code>extern crate</code> 时，它使用 <a href="#grammar-MetaWord">MetaWord</a> 和 <a href="#grammar-MetaListIdents">MetaListIdents</a> 语法。有关这些语法如何使用的更多信息，请参见<a href="#r-macro.decl.scope.macro_use.prelude">macro.decl.scope.macro_use.prelude</a>。</p>
<div class="rule" id="r-macro.decl.scope.macro_use.allowed-positions"><a class="rule-link" href="#r-macro.decl.scope.macro_use.allowed-positions" title="macro.decl.scope.macro_use.allowed-positions"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_use<wbr>.allowed-positions]</span></a>
</div>

<p><code>macro_use</code> 属性可以应用于模块或 <code>extern crate</code>。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 会忽略在其他位置的使用，但会对其进行 lint。这在将来可能会成为错误。</p>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_use.extern-crate-self"><a class="rule-link" href="#r-macro.decl.scope.macro_use.extern-crate-self" title="macro.decl.scope.macro_use.extern-crate-self"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_use<wbr>.extern-crate-self]</span></a>
</div>

<p><code>macro_use</code> 属性不能用于<a href="#r-items.extern-crate.self"><code>extern crate self</code></a>。</p>
<div class="rule" id="r-macro.decl.scope.macro_use.duplicates"><a class="rule-link" href="#r-macro.decl.scope.macro_use.duplicates" title="macro.decl.scope.macro_use.duplicates"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_use<wbr>.duplicates]</span></a>
</div>

<p><code>macro_use</code> 属性可以在一个形式上使用任意次数。</p>
<p>可以指定 <a href="#grammar-MetaListIdents">MetaListIdents</a> 语法中的 <code>macro_use</code> 多个实例。所有指定的宏的并集将被导入。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>在模块上，<code>rustc</code> 会对第一个 <a href="#grammar-MetaWord">MetaWord</a> <code>macro_use</code> 属性之后的任何 <code>macro_use</code> 属性进行 lint。</p>
<p>在 <code>extern crate</code> 上，<code>rustc</code> 会对任何由于未导入已被另一个 <code>macro_use</code> 属性导入的宏而没有效果的 <code>macro_use</code> 属性进行 lint。如果两个或更多 <a href="#grammar-MetaListIdents">MetaListIdents</a> <code>macro_use</code> 属性导入相同的宏，则会对第一个进行 lint。如果存在任何 <a href="#grammar-MetaWord">MetaWord</a> <code>macro_use</code> 属性，则会对所有 <a href="#grammar-MetaListIdents">MetaListIdents</a> <code>macro_use</code> 属性进行 lint。如果存在两个或更多 <a href="#grammar-MetaWord">MetaWord</a> <code>macro_use</code> 属性，则会对第一个之后的属性进行 lint。</p>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_use.mod-decl"><a class="rule-link" href="#r-macro.decl.scope.macro_use.mod-decl" title="macro.decl.scope.macro_use.mod-decl"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_use<wbr>.mod-decl]</span></a>
</div>

<p>当 <code>macro_use</code> 用于模块时，模块的宏作用域会超出模块的词法作用域。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[macro_use]
mod inner {
    macro_rules! m {
        () =&gt; {};
    }
}
m!(); // 正常
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_use.prelude"><a class="rule-link" href="#r-macro.decl.scope.macro_use.prelude" title="macro.decl.scope.macro_use.prelude"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_use<wbr>.prelude]</span></a>
</div>

<p>在 crate 根目录中的 <code>extern crate</code> 声明上指定 <code>macro_use</code> 会从该 crate 导入导出的宏。</p>
<p>以这种方式导入的宏被导入到<a href="#macro_use-prelude"><code>macro_use</code>预导入</a>中，而不是文本式地，这意味着它们可以被任何其他名称遮蔽。<code>macro_use</code> 导入的宏可以在 import 语句之前使用。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 目前在冲突时会优先选择最后导入的宏。请不要依赖此行为。这种行为很不寻常，因为 Rust 中的导入通常与顺序无关。<code>macro_use</code> 的这种行为在将来可能会改变。</p>
<p>有关详细信息，请参见 <a href="https://github.com/rust-lang/rust/issues/148025">Rust问题单#148025</a>。</p>
</blockquote>
</div>

<p>当使用 <a href="#grammar-MetaWord">MetaWord</a> 语法时，所有导出的宏都会被导入。当使用 <a href="#grammar-MetaListIdents">MetaListIdents</a> 语法时，只有指定的宏会被导入。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">#[macro_use(lazy_static)] // 或者 `#[macro_use]` 导入所有宏。
extern crate lazy_static;

lazy_static!{}
// self::lazy_static!{} // 错误：`lazy_static` 未在 `self` 中定义。</code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_use.export"><a class="rule-link" href="#r-macro.decl.scope.macro_use.export" title="macro.decl.scope.macro_use.export"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_use<wbr>.export]</span></a>
</div>

<p>要使用 <code>macro_use</code> 导入的宏必须使用 <a href="#r-macro.decl.scope.macro_export"><code>macro_export</code></a> 导出。</p>
<!-- template:attributes -->
<div class="rule" id="r-macro.decl.scope.macro_export"><a class="rule-link" href="#r-macro.decl.scope.macro_export" title="macro.decl.scope.macro_export"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_export]</span></a>
</div>

<h3 id="macro_export属性"><a class="header" href="#macro_export属性"><code>macro_export</code>属性</a></h3>
<div class="rule" id="r-macro.decl.scope.macro_export.intro"><a class="rule-link" href="#r-macro.decl.scope.macro_export.intro" title="macro.decl.scope.macro_export.intro"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_export<wbr>.intro]</span></a>
</div>

<p><em><code>macro_export</code> <a href="#r-attributes">属性</a></em> 将宏从 crate 导出，并使其在 crate 根目录中可用，以进行基于路径的解析。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>self::m!();
//  ^^^^ 正常：基于路径的查找在当前模块中找到 `m`。
m!(); // 同上。

mod inner {
    super::m!();
    crate::m!();
}

mod mac {
    #[macro_export]
    macro_rules! m {
        () =&gt; {};
    }
}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_export.syntax"><a class="rule-link" href="#r-macro.decl.scope.macro_export.syntax" title="macro.decl.scope.macro_export.syntax"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_export<wbr>.syntax]</span></a>
</div>

<p><code>macro_export</code> 属性使用 <a href="#grammar-MetaWord">MetaWord</a> 和 <a href="#grammar-MetaListIdents">MetaListIdents</a> 语法。使用 <a href="#grammar-MetaListIdents">MetaListIdents</a> 语法时，它接受单个 <a href="#r-macro.decl.scope.macro_export.local_inner_macros"><code>local_inner_macros</code></a> 值。</p>
<div class="rule" id="r-macro.decl.scope.macro_export.allowed-positions"><a class="rule-link" href="#r-macro.decl.scope.macro_export.allowed-positions" title="macro.decl.scope.macro_export.allowed-positions"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_export<wbr>.allowed-positions]</span></a>
</div>

<p><code>macro_export</code> 属性可以应用于 <code>macro_rules</code> 定义。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 会忽略在其他位置的使用，但会对其进行 lint。这在将来可能会成为错误。</p>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_export.duplicates"><a class="rule-link" href="#r-macro.decl.scope.macro_export.duplicates" title="macro.decl.scope.macro_export.duplicates"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_export<wbr>.duplicates]</span></a>
</div>

<p>宏上只有第一次使用 <code>macro_export</code> 有效。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 会对第一次使用之后的任何使用进行 lint。</p>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_export.path-based"><a class="rule-link" href="#r-macro.decl.scope.macro_export.path-based" title="macro.decl.scope.macro_export.path-based"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_export<wbr>.path-based]</span></a>
</div>

<p>默认情况下，宏只有<a href="#r-macro.decl.scope.textual">文本作用域</a>，不能通过路径解析。当使用 <code>macro_export</code> 属性时，该宏会在 crate 根目录中可用，并可以通过其路径引用。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>没有 <code>macro_export</code> 时，宏只有文本作用域，因此宏的基于路径的解析会失败。</p>
<pre class="playground"><code class="language-rust compile_fail E0433 edition2024">macro_rules! m {
    () =&gt; {};
}
self::m!(); // 错误
crate::m!(); // 错误
<span class="boring">fn main() {}</span></code></pre>
<p>有了 <code>macro_export</code>，基于路径的解析就有效了。</p>
<pre class="playground"><code class="language-rust edition2024">#[macro_export]
macro_rules! m {
    () =&gt; {};
}
self::m!(); // 正常
crate::m!(); // 正常
<span class="boring">fn main() {}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_export.export"><a class="rule-link" href="#r-macro.decl.scope.macro_export.export" title="macro.decl.scope.macro_export.export"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_export<wbr>.export]</span></a>
</div>

<p><code>macro_export</code> 属性导致宏从 crate 根目录导出，以便其他 crate 可以通过路径引用它。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>给定 <code>log</code> crate 中的以下内容：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[macro_export]
macro_rules! warn {
    ($message:expr) =&gt; { eprintln!("WARN: {}", $message) };
}
<span class="boring">}</span></code></pre>
<p>从另一个crate中，你可以通过路径引用宏：</p>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">fn main() {
    log::warn!("example warning");
}</code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_export.macro_use"><a class="rule-link" href="#r-macro.decl.scope.macro_export.macro_use" title="macro.decl.scope.macro_export.macro_use"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_export<wbr>.macro_use]</span></a>
</div>

<p><code>macro_export</code> 允许在 <code>extern crate</code> 上使用 <a href="#r-macro.decl.scope.macro_use"><code>macro_use</code></a>，将宏导入到 <a href="#macro_use-prelude"><code>macro_use</code>预导入</a>中。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>给定 <code>log</code> crate 中的以下内容：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[macro_export]
macro_rules! warn {
    ($message:expr) =&gt; { eprintln!("WARN: {}", $message) };
}
<span class="boring">}</span></code></pre>
<p>在依赖 crate 中使用 <code>macro_use</code> 允许你从预导入中使用宏：</p>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">#[macro_use]
extern crate log;

pub mod util {
    pub fn do_thing() {
        // 通过宏预导入解析。
        warn!("example warning");
    }
}</code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_export.local_inner_macros"><a class="rule-link" href="#r-macro.decl.scope.macro_export.local_inner_macros" title="macro.decl.scope.macro_export.local_inner_macros"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_export<wbr>.local_inner_macros]</span></a>
</div>

<p>将 <code>local_inner_macros</code> 添加到 <code>macro_export</code> 属性会使宏定义中的所有单段宏调用具有隐式的 <code>$crate::</code> 前缀。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>这主要旨在作为一种工具，用于迁移在语言中添加 <a href="#r-macro.decl.hygiene.crate"><code>$crate</code></a> 之前编写的代码，以使其与 Rust 2018 基于路径的宏导入协同工作。不建议在新代码中使用它。</p>
</blockquote>
</div>

<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[macro_export(local_inner_macros)]
macro_rules! helped {
    () =&gt; { helper!() } // 自动转换为 $crate::helper!()。
}

#[macro_export]
macro_rules! helper {
    () =&gt; { () }
}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.hygiene"><a class="rule-link" href="#r-macro.decl.hygiene" title="macro.decl.hygiene"><span>[macro<wbr>.decl<wbr>.hygiene]</span></a>
</div>

<h2 id="卫生"><a class="header" href="#卫生">卫生</a></h2>
<div class="rule" id="r-macro.decl.hygiene.intro"><a class="rule-link" href="#r-macro.decl.hygiene.intro" title="macro.decl.hygiene.intro"><span>[macro<wbr>.decl<wbr>.hygiene<wbr>.intro]</span></a>
</div>

<p>声明宏具有 <em>混合站点卫生</em> 。这意味着<a href="#loop-labels">循环标签</a>、<a href="#r-expr.loop.block-labels">块标签</a>和局部变量在宏定义站点查找，而其他符号在宏调用站点查找。例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = 1;
fn func() {
    unreachable!("this is never called")
}

macro_rules! check {
    () =&gt; {
        assert_eq!(x, 1); // 使用定义站点的 `x`。
        func();           // 使用调用站点的 `func`。
    };
}

{
    let x = 2;
    fn func() { /* 不会恐慌 */ }
    check!();
}
<span class="boring">}</span></code></pre>
<p>在宏展开中定义的标签和局部变量不共享于不同的调用之间，因此此代码无法编译：</p>
<pre class="playground"><code class="language-rust compile_fail E0425 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! m {
    (define) =&gt; {
        let x = 1;
    };
    (refer) =&gt; {
        dbg!(x);
    };
}

m!(define);
m!(refer);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-macro.decl.hygiene.crate"><a class="rule-link" href="#r-macro.decl.hygiene.crate" title="macro.decl.hygiene.crate"><span>[macro<wbr>.decl<wbr>.hygiene<wbr>.crate]</span></a>
</div>

<p>一个特殊情况是 <code>$crate</code> 元变量。它指代定义宏的 crate，可以用于路径的开头，以查找在调用站点不在作用域内的项或宏。</p>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">//// `helper_macro` crate 中的定义。
#[macro_export]
macro_rules! helped {
    // () =&gt; { helper!() } // 这可能会因 'helper' 不在作用域中而导致错误。
    () =&gt; { $crate::helper!() }
}

#[macro_export]
macro_rules! helper {
    () =&gt; { () }
}

//// 在另一个 crate 中的使用。
// 请注意，`helper_macro::helper` 并未导入！
use helper_macro::helped;

fn unit() {
    helped!();
}</code></pre>
<p>请注意，由于 <code>$crate</code> 指代当前 crate，因此在引用非宏项时必须与完全限定的模块路径一起使用：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub mod inner {
    #[macro_export]
    macro_rules! call_foo {
        () =&gt; { $crate::inner::foo() };
    }

    pub fn foo() {}
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-macro.decl.hygiene.vis"><a class="rule-link" href="#r-macro.decl.hygiene.vis" title="macro.decl.hygiene.vis"><span>[macro<wbr>.decl<wbr>.hygiene<wbr>.vis]</span></a>
</div>

<p>此外，即使 <code>$crate</code> 允许宏在展开时引用其自身 crate 内的项，其使用对可见性也没有影响。被引用的项或宏仍必须从调用站点可见。在下面的示例中，任何尝试从其 crate 外部调用 <code>call_foo!()</code> 的操作都会失败，因为 <code>foo()</code> 不是公共的。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[macro_export]
macro_rules! call_foo {
    () =&gt; { $crate::foo() };
}

fn foo() {}
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>在 Rust 1.30 之前，不支持 <code>$crate</code> 和 <a href="#r-macro.decl.scope.macro_export.local_inner_macros"><code>local_inner_macros</code></a>。它们是与<a href="#r-macro.decl.scope.macro_export">基于路径的宏导入</a>一起添加的，以确保辅助宏不需要由导出宏的 crate 用户手动导入。为早期 Rust 版本编写的、使用辅助宏的 crate 需要修改以使用 <code>$crate</code> 或 <code>local_inner_macros</code>，才能与基于路径的导入良好协作。</p>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.follow-set"><a class="rule-link" href="#r-macro.decl.follow-set" title="macro.decl.follow-set"><span>[macro<wbr>.decl<wbr>.follow-set]</span></a>
</div>

<h2 id="后续集歧义限制"><a class="header" href="#后续集歧义限制">后续集歧义限制</a></h2>
<div class="rule" id="r-macro.decl.follow-set.intro"><a class="rule-link" href="#r-macro.decl.follow-set.intro" title="macro.decl.follow-set.intro"><span>[macro<wbr>.decl<wbr>.follow-set<wbr>.intro]</span></a>
</div>

<p>宏系统使用的解析器功能相当强大，但它受到限制，以防止在语言的当前或未来版本中出现歧义。</p>
<p>具体来说，除了关于歧义展开的规则之外，元变量匹配的非终结符之后必须跟随一个已被确定可以安全地用于该类匹配的词法单元。</p>
<p>例如，像 <code>$i:expr [ , ]</code> 这样的宏匹配器理论上今天可以在 Rust 中接受，因为 <code>[,]</code> 不能是合法表达式的一部分，因此解析将始终是明确的。然而，由于 <code>[</code> 可以开始尾随表达式，<code>[</code> 不是一个可以安全地排除在表达式之后出现的字符。如果在后续的 Rust 版本中接受 <code>[,]</code>，这个匹配器将变得模糊或解析错误，从而破坏现有代码。然而，像 <code>$i:expr,</code> 或 <code>$i:expr;</code> 这样的匹配器是合法的，因为 <code>,</code> 和 <code>;</code> 是合法的表达式分隔符。具体规则是：</p>
<div class="rule" id="r-macro.decl.follow-set.token-expr-stmt"><a class="rule-link" href="#r-macro.decl.follow-set.token-expr-stmt" title="macro.decl.follow-set.token-expr-stmt"><span>[macro<wbr>.decl<wbr>.follow-set<wbr>.token-expr-stmt]</span></a>
</div>

<ul>
<li><code>expr</code> 和 <code>stmt</code> 只能跟随以下之一：<code>=&gt;</code>、<code>,</code> 或 <code>;</code>。</li>
</ul>
<div class="rule" id="r-macro.decl.follow-set.token-pat_param"><a class="rule-link" href="#r-macro.decl.follow-set.token-pat_param" title="macro.decl.follow-set.token-pat_param"><span>[macro<wbr>.decl<wbr>.follow-set<wbr>.token-pat_param]</span></a>
</div>

<ul>
<li><code>pat_param</code> 只能跟随以下之一：<code>=&gt;</code>、<code>,</code>、<code>=</code>、<code>|</code>、<code>if</code> 或 <code>in</code>。</li>
</ul>
<div class="rule" id="r-macro.decl.follow-set.token-pat"><a class="rule-link" href="#r-macro.decl.follow-set.token-pat" title="macro.decl.follow-set.token-pat"><span>[macro<wbr>.decl<wbr>.follow-set<wbr>.token-pat]</span></a>
</div>

<ul>
<li><code>pat</code> 只能跟随以下之一：<code>=&gt;</code>、<code>,</code>、<code>=</code>、<code>if</code> 或 <code>in</code>。</li>
</ul>
<div class="rule" id="r-macro.decl.follow-set.token-path-ty"><a class="rule-link" href="#r-macro.decl.follow-set.token-path-ty" title="macro.decl.follow-set.token-path-ty"><span>[macro<wbr>.decl<wbr>.follow-set<wbr>.token-path-ty]</span></a>
</div>

<ul>
<li><code>path</code> 和 <code>ty</code> 只能跟随以下之一：<code>=&gt;</code>、<code>,</code>、<code>=</code>、<code>|</code>、<code>;</code>、<code>:</code>、<code>&gt;</code>、<code>&gt;&gt;</code>、<code>[</code>、<code>{</code>、<code>as</code>、<code>where</code> 或 <code>block</code> 片段说明符的宏变量。</li>
</ul>
<div class="rule" id="r-macro.decl.follow-set.token-vis"><a class="rule-link" href="#r-macro.decl.follow-set.token-vis" title="macro.decl.follow-set.token-vis"><span>[macro<wbr>.decl<wbr>.follow-set<wbr>.token-vis]</span></a>
</div>

<ul>
<li><code>vis</code> 只能跟随以下之一：<code>,</code>，非原始 <code>priv</code> 之外的标识符，任何可以开始类型的词法单元，或具有 <code>ident</code>、<code>ty</code> 或 <code>path</code> 片段说明符的元变量。</li>
</ul>
<div class="rule" id="r-macro.decl.follow-set.token-other"><a class="rule-link" href="#r-macro.decl.follow-set.token-other" title="macro.decl.follow-set.token-other"><span>[macro<wbr>.decl<wbr>.follow-set<wbr>.token-other]</span></a>
</div>

<ul>
<li>所有其他片段说明符都没有限制。</li>
</ul>
<div class="rule" id="r-macro.decl.follow-set.edition2021"><a class="rule-link" href="#r-macro.decl.follow-set.edition2021" title="macro.decl.follow-set.edition2021"><span>[macro<wbr>.decl<wbr>.follow-set<wbr>.edition2021]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2021</span> 版次差异</p>

<p>在 2021 版次之前，<code>pat</code> 后面也可以跟随 <code>|</code>。</p>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.follow-set.repetition"><a class="rule-link" href="#r-macro.decl.follow-set.repetition" title="macro.decl.follow-set.repetition"><span>[macro<wbr>.decl<wbr>.follow-set<wbr>.repetition]</span></a>
</div>

<p>当涉及重复时，规则适用于所有可能的展开次数，并考虑分隔符。这意味着：</p>
<ul>
<li>如果重复包含分隔符，则该分隔符必须能够跟随重复的内容。</li>
<li>如果重复可以多次重复（<code>*</code> 或 <code>+</code>），则内容必须能够跟随自身。</li>
<li>重复的内容必须能够跟随其之前的内容，并且其之后的内容必须能够跟随重复的内容。</li>
<li>如果重复可以匹配零次（<code>*</code> 或 <code>?</code>），则其之后的内容必须能够跟随其之前的内容。</li>
</ul>
<p>有关更多详细信息，请参见<a href="#附录宏后继集歧义形式化规范">形式化规范</a>。</p>
<div style="break-before: page; page-break-before: always;"></div><!-- https://github.com/rust-lang/reference/blob/master/src/procedural-macros.md -->
<!-- commit 68bdfd15fa9feebfbf94a06cf574de598e239198 -->
<div class="rule" id="r-macro.proc"><a class="rule-link" href="#r-macro.proc" title="macro.proc"><span>[macro<wbr>.proc]</span></a>
</div>

<h1 id="过程宏"><a class="header" href="#过程宏">过程宏</a></h1>
<div class="rule" id="r-macro.proc.intro"><a class="rule-link" href="#r-macro.proc.intro" title="macro.proc.intro"><span>[macro<wbr>.proc<wbr>.intro]</span></a>
</div>

<p><em>过程宏</em>允许通过执行函数来创建语法扩展。
过程宏分为三种类型：</p>
<ul>
<li><a href="#proc_macro属性">函数式宏</a> - <code>custom!(...)</code></li>
<li><a href="#r-macro.proc.derive">派生宏</a> - <code>#[derive(CustomDerive)]</code></li>
<li><a href="#proc_macro_attribute属性">属性宏</a> - <code>#[CustomAttribute]</code></li>
</ul>
<p>过程宏允许你在编译时运行操作Rust语法的代码，既可以消费Rust语法，也可以生成Rust语法。你可以将过程宏视为从一个AST到另一个AST的函数。</p>
<div class="rule" id="r-macro.proc.def"><a class="rule-link" href="#r-macro.proc.def" title="macro.proc.def"><span>[macro<wbr>.proc<wbr>.def]</span></a>
</div>

<p>过程宏必须定义在<a href="#链接">crate类型</a>为<code>proc-macro</code>的crate根目录中。
宏不能在其定义的crate中使用，只能在另一个crate中导入后才能使用。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>当使用Cargo时，过程宏crate通过清单中的<code>proc-macro</code>键定义：</p>
<pre><code class="language-toml">[lib]
proc-macro = true
</code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.proc.result"><a class="rule-link" href="#r-macro.proc.result" title="macro.proc.result"><span>[macro<wbr>.proc<wbr>.result]</span></a>
</div>

<p>作为函数，它们必须返回语法、<a href="#r-panic">恐慌</a>，或无限循环。返回的语法会根据过程宏的种类替换或添加语法。编译器会捕获<a href="#r-panic">恐慌</a>，并将其转换为编译器错误。无限循环不会被编译器捕获，这会导致编译器挂起。</p>
<p>过程宏在编译期间运行，因此拥有与编译器相同的资源。例如，标准输入、错误和输出与编译器可访问的相同。同样，文件访问也相同。因此，过程宏具有与<a href="../cargo/reference/build-scripts.html">Cargo的构建脚本</a>相同的安全问题。</p>
<div class="rule" id="r-macro.proc.error"><a class="rule-link" href="#r-macro.proc.error" title="macro.proc.error"><span>[macro<wbr>.proc<wbr>.error]</span></a>
</div>

<p>过程宏有两种报告错误的方式。第一种是<a href="#r-panic">恐慌</a>。第二种是发出一个<a href="../core/macro.compile_error.html"><code>compile_error</code></a>宏调用。</p>
<div class="rule" id="r-macro.proc.proc_macro-crate"><a class="rule-link" href="#r-macro.proc.proc_macro-crate" title="macro.proc.proc_macro-crate"><span>[macro<wbr>.proc<wbr>.proc_macro-crate]</span></a>
</div>

<h2 id="proc_macro-crate"><a class="header" href="#proc_macro-crate"><code>proc_macro</code> crate</a></h2>
<div class="rule" id="r-macro.proc.proc_macro-crate.intro"><a class="rule-link" href="#r-macro.proc.proc_macro-crate.intro" title="macro.proc.proc_macro-crate.intro"><span>[macro<wbr>.proc<wbr>.proc_macro-crate<wbr>.intro]</span></a>
</div>

<p>过程宏crate几乎总是会链接到编译器提供的<a href="../proc_macro/index.html"><code>proc_macro</code> crate</a>。<a href="../proc_macro/index.html"><code>proc_macro</code> crate</a>提供了编写过程宏所需的类型和使其更方便的工具。</p>
<div class="rule" id="r-macro.proc.proc_macro-crate.token-stream"><a class="rule-link" href="#r-macro.proc.proc_macro-crate.token-stream" title="macro.proc.proc_macro-crate.token-stream"><span>[macro<wbr>.proc<wbr>.proc_macro-crate<wbr>.token-stream]</span></a>
</div>

<p>这个crate主要包含<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>类型。过程宏操作<em>词法单元流</em>而不是AST节点，这对于编译器和过程宏来说都是一个更稳定的长期接口。<em>词法单元流</em>大致等同于<code>Vec&lt;TokenTree&gt;</code>，其中<code>TokenTree</code>大致可以被认为是词法单元。例如，<code>foo</code>是一个<code>Ident</code>词法单元，<code>.</code>是一个<code>Punct</code>词法单元，<code>1.2</code>是一个<code>Literal</code>词法单元。<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>类型与<code>Vec&lt;TokenTree&gt;</code>不同，克隆开销很小。</p>
<div class="rule" id="r-macro.proc.proc_macro-crate.span"><a class="rule-link" href="#r-macro.proc.proc_macro-crate.span" title="macro.proc.proc_macro-crate.span"><span>[macro<wbr>.proc<wbr>.proc_macro-crate<wbr>.span]</span></a>
</div>

<p>所有词法单元都带有一个关联的<code>Span</code>。<code>Span</code>是一个不透明的值，不能被修改但可以被创建。<code>Span</code>代表程序中源代码的范围，主要用于错误报告。虽然你不能修改<code>Span</code>本身，但你总是可以更改与任何词法单元<em>关联的</em><code>Span</code>，例如通过从另一个词法单元获取<code>Span</code>。</p>
<div class="rule" id="r-macro.proc.hygiene"><a class="rule-link" href="#r-macro.proc.hygiene" title="macro.proc.hygiene"><span>[macro<wbr>.proc<wbr>.hygiene]</span></a>
</div>

<h2 id="过程宏卫生"><a class="header" href="#过程宏卫生">过程宏卫生</a></h2>
<p>过程宏是<em>不卫生</em>的。这意味着它们的行为就如同输出词法单元流被直接内联写入其旁边的代码一样。这意味着它受外部项影响，也影响外部导入。</p>
<p>宏作者需要小心，以确保他们的宏在给定此限制的情况下，尽可能在更多上下文中工作。这通常包括使用库中项的绝对路径（例如，<code>::std::option::Option</code>而不是<code>Option</code>），或者通过确保生成的函数具有不太可能与其他函数冲突的名称（如<code>__internal_foo</code>而不是<code>foo</code>）。</p>
<!-- TODO: rule name needs improvement -->
<!-- template:attributes -->
<div class="rule" id="r-macro.proc.proc_macro"><a class="rule-link" href="#r-macro.proc.proc_macro" title="macro.proc.proc_macro"><span>[macro<wbr>.proc<wbr>.proc_macro]</span></a>
</div>

<h2 id="proc_macro属性"><a class="header" href="#proc_macro属性"><code>proc_macro</code>属性</a></h2>
<div class="rule" id="r-macro.proc.proc_macro.intro"><a class="rule-link" href="#r-macro.proc.proc_macro.intro" title="macro.proc.proc_macro.intro"><span>[macro<wbr>.proc<wbr>.proc_macro<wbr>.intro]</span></a>
</div>

<p><em><code>proc_macro</code><a href="#属性-1">属性</a></em> 定义一个<a href="#r-macro.invocation">函数式</a>过程宏。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>此宏定义忽略其输入，并在其作用域中发出一个<code>answer</code><a href="#函数">函数</a>。</p>
<!-- ignore: test doesn't support proc-macro -->
<pre><code class="language-rust ignore"><span class="boring">#![crate_type = "proc-macro"]
</span>extern crate proc_macro;
use proc_macro::TokenStream;

#[proc_macro]
pub fn make_answer(_item: TokenStream) -&gt; TokenStream {
    "fn answer() -&gt; u32 { 42 }".parse().unwrap()
}</code></pre>
<p>我们可以在一个二进制crate中使用它来打印“42”到标准输出。</p>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">extern crate proc_macro_examples;
use proc_macro_examples::make_answer;

make_answer!();

fn main() {
    println!("{}", answer());
}</code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.proc.proc_macro.syntax"><a class="rule-link" href="#r-macro.proc.proc_macro.syntax" title="macro.proc.proc_macro.syntax"><span>[macro<wbr>.proc<wbr>.proc_macro<wbr>.syntax]</span></a>
</div>

<p><code>proc_macro</code>属性使用<a href="#grammar-MetaWord">MetaWord</a>语法。</p>
<div class="rule" id="r-macro.proc.proc_macro.allowed-positions"><a class="rule-link" href="#r-macro.proc.proc_macro.allowed-positions" title="macro.proc.proc_macro.allowed-positions"><span>[macro<wbr>.proc<wbr>.proc_macro<wbr>.allowed-positions]</span></a>
</div>

<p><code>proc_macro</code>属性只能应用于<code>fn(TokenStream) -&gt; TokenStream</code>类型的<code>pub</code><a href="#函数">函数</a>，其中<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>来自<a href="../proc_macro/index.html"><code>proc_macro</code> crate</a>。它必须具有 <a href="#r-items.fn.extern">“Rust” ABI</a>。不允许使用其他函数限定符。它必须位于crate的根目录中。</p>
<div class="rule" id="r-macro.proc.proc_macro.duplicates"><a class="rule-link" href="#r-macro.proc.proc_macro.duplicates" title="macro.proc.proc_macro.duplicates"><span>[macro<wbr>.proc<wbr>.proc_macro<wbr>.duplicates]</span></a>
</div>

<p><code>proc_macro</code>属性在一个函数上只能指定一次。</p>
<div class="rule" id="r-macro.proc.proc_macro.namespace"><a class="rule-link" href="#r-macro.proc.proc_macro.namespace" title="macro.proc.proc_macro.namespace"><span>[macro<wbr>.proc<wbr>.proc_macro<wbr>.namespace]</span></a>
</div>

<p><code>proc_macro</code>属性在crate根目录中的<a href="#命名空间">宏命名空间</a>中公开定义宏，其名称与函数同名。</p>
<div class="rule" id="r-macro.proc.proc_macro.behavior"><a class="rule-link" href="#r-macro.proc.proc_macro.behavior" title="macro.proc.proc_macro.behavior"><span>[macro<wbr>.proc<wbr>.proc_macro<wbr>.behavior]</span></a>
</div>

<p>一个函数式过程宏的函数式宏调用会将宏调用分隔符内的内容作为输入<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>参数传递，并用函数的输出<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>替换整个宏调用。</p>
<div class="rule" id="r-macro.proc.proc_macro.invocation"><a class="rule-link" href="#r-macro.proc.proc_macro.invocation" title="macro.proc.proc_macro.invocation"><span>[macro<wbr>.proc<wbr>.proc_macro<wbr>.invocation]</span></a>
</div>

<p>函数式过程宏可以在任何宏调用位置被调用，包括：</p>
<ul>
<li><a href="#语句">语句</a></li>
<li><a href="#表达式">表达式</a></li>
<li><a href="#模式">模式</a></li>
<li><a href="#type-expressions">类型表达式</a></li>
<li><a href="#项">项</a>位置，包括<a href="#外部块"><code>extern</code>块</a>中的项</li>
<li>固有和特型<a href="#实现">实现</a></li>
<li><a href="#特型">特型定义</a></li>
</ul>
<!-- template:attributes -->
<div class="rule" id="r-macro.proc.derive"><a class="rule-link" href="#r-macro.proc.derive" title="macro.proc.derive"><span>[macro<wbr>.proc<wbr>.derive]</span></a>
</div>

<h2 id="proc_macro_derive属性"><a class="header" href="#proc_macro_derive属性"><code>proc_macro_derive</code>属性</a></h2>
<div class="rule" id="r-macro.proc.derive.intro"><a class="rule-link" href="#r-macro.proc.derive.intro" title="macro.proc.derive.intro"><span>[macro<wbr>.proc<wbr>.derive<wbr>.intro]</span></a>
</div>

<p>将 <em><code>proc_macro_derive</code><a href="#属性-1">属性</a></em> 应用于<a href="#函数">函数</a>定义一个 <em>派生宏</em> ，它可以通过 <a href="#派生"><code>derive</code>属性</a> 调用。这些宏会获得一个<a href="#结构体">结构体</a>、<a href="#枚举">枚举</a>或<a href="#联合体">联合体</a>定义的词法单元流，并可以在其后发出新的<a href="#项">项</a>。它们还可以声明和使用<a href="#派生宏辅助属性">派生宏辅助属性</a>。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>这个派生宏忽略其输入，并添加定义一个函数的词法单元。</p>
<!-- ignore: test doesn't support proc-macro -->
<pre><code class="language-rust ignore"><span class="boring">#![crate_type = "proc-macro"]
</span>extern crate proc_macro;
use proc_macro::TokenStream;

#[proc_macro_derive(AnswerFn)]
pub fn derive_answer_fn(_item: TokenStream) -&gt; TokenStream {
    "fn answer() -&gt; u32 { 42 }".parse().unwrap()
}</code></pre>
<p>要使用它，我们可以这样写：</p>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">extern crate proc_macro_examples;
use proc_macro_examples::AnswerFn;

#[derive(AnswerFn)]
struct Struct;

fn main() {
    assert_eq!(42, answer());
}</code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.proc.derive.syntax"><a class="rule-link" href="#r-macro.proc.derive.syntax" title="macro.proc.derive.syntax"><span>[macro<wbr>.proc<wbr>.derive<wbr>.syntax]</span></a>
</div>

<p><code>proc_macro_derive</code>属性的语法格式是：</p>
<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ProcMacroDeriveAttribute" onclick="show_railroad()"><a href="#railroad-ProcMacroDeriveAttribute">ProcMacroDeriveAttribute</a></span> → <br>    <span class="grammar-literal">proc_macro_derive</span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-DeriveMacroName">DeriveMacroName</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-DeriveMacroAttributes">DeriveMacroAttributes</a></span> )<sup>?</sup> <span class="grammar-literal">,</span><sup>?</sup> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-DeriveMacroName" onclick="show_railroad()"><a href="#railroad-DeriveMacroName">DeriveMacroName</a></span> → <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-DeriveMacroAttributes" onclick="show_railroad()"><a href="#railroad-DeriveMacroAttributes">DeriveMacroAttributes</a></span> → <br>    <span class="grammar-literal">attributes</span> <span class="grammar-literal">(</span> ( <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup> )<sup>?</sup> <span class="grammar-literal">)</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 830px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ProcMacroDeriveAttribute"><svg class="railroad" viewbox="0 0 830 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ProcMacroDeriveAttribute">
<text class="comment" x="102" y="25">
ProcMacroDeriveAttribute</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="156" x="35" y="55" />
<text x="113" y="71">
proc_macro_derive</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="201" y="55" />
<text x="215" y="71">
(</text>
</g>
<a class="link" xlink:href="#railroad-DeriveMacroName">
<g class="nonterminal">
<rect height="22" width="140" x="239" y="55" />
<text x="309" y="71">
DeriveMacroName</text>
</g>
</a>
<g class="optional">
<path d=" M 389 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 234 m -114 0 l -5 -5 m 0 10 l 5 -5 m 114 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="413" y="55" />
<text x="427" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-DeriveMacroAttributes">
<g class="nonterminal">
<rect height="22" width="196" x="451" y="55" />
<text x="549" y="71">
DeriveMacroAttributes</text>
</g>
</a>
<path d=" M 441 66 h 10" />
</g>
</g>
<g class="optional">
<path d=" M 681 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="705" y="55" />
<text x="719" y="71">
,</text>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="767" y="55" />
<text x="781" y="71">
)</text>
</g>
<path d=" M 191 66 h 10" />
<path d=" M 229 66 h 10" />
<path d=" M 379 66 h 10" />
<path d=" M 671 66 h 10" />
<path d=" M 757 66 h 10" />
</g>
<path d=" M 805 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 795 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 170px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-DeriveMacroName"><svg class="railroad" viewbox="0 0 170 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-DeriveMacroName">
<text class="comment" x="67" y="25">
DeriveMacroName</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="42" />
<text x="85" y="58">
IDENTIFIER</text>
</g>
</a>
<path d=" M 145 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 135 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 710px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-DeriveMacroAttributes"><svg class="railroad" viewbox="0 0 710 112" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-DeriveMacroAttributes">
<text class="comment" x="92" y="25">
DeriveMacroAttributes</text>
</a>
<g class="sequence">
<path d=" M 10 78 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="100" x="35" y="67" />
<text x="85" y="83">
attributes</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="145" y="67" />
<text x="159" y="83">
(</text>
</g>
<g class="optional">
<path d=" M 183 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -12 a 12 12 0 0 1 12 -12 h 406 m -200 0 l -5 -5 m 0 10 l 5 -5 m 200 0 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="207" y="67" />
<text x="257" y="83">
IDENTIFIER</text>
</g>
</a>
<g class="optional">
<path d=" M 317 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 162 m -78 0 l -5 -5 m 0 10 l 5 -5 m 78 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 341 78 h 12 m 138 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -138 m 72 0 l 5 -5 m 0 10 l -5 -5 m -72 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="353" y="67" />
<text x="367" y="83">
,</text>
</g>
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="391" y="67" />
<text x="441" y="83">
IDENTIFIER</text>
</g>
</a>
<path d=" M 381 78 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 537 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="561" y="67" />
<text x="575" y="83">
,</text>
</g>
</g>
<path d=" M 307 78 h 10" />
<path d=" M 527 78 h 10" />
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="647" y="67" />
<text x="661" y="83">
)</text>
</g>
<path d=" M 135 78 h 10" />
<path d=" M 173 78 h 10" />
<path d=" M 637 78 h 10" />
</g>
<path d=" M 685 78 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 78 h 10" />
<path d=" M 675 78 h 10" />
</g>
</g>
</svg>
</div>

</div>

<p>派生宏的名称由<a href="#grammar-DeriveMacroName">DeriveMacroName</a>给出。可选的<code>attributes</code>参数在<a href="#r-macro.proc.derive.attributes">macro.proc.derive.attributes</a>中描述。</p>
<div class="rule" id="r-macro.proc.derive.allowed-positions"><a class="rule-link" href="#r-macro.proc.derive.allowed-positions" title="macro.proc.derive.allowed-positions"><span>[macro<wbr>.proc<wbr>.derive<wbr>.allowed-positions]</span></a>
</div>

<p><code>proc_macro_derive</code>属性只能应用于定义在crate根目录中，并带有<a href="#r-items.fn.extern">Rust ABI</a>的<code>pub</code><a href="#函数">函数</a>，其<a href="#类型">类型</a>为<code>fn(TokenStream) -&gt; TokenStream</code>，其中<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>来自<a href="../proc_macro/index.html"><code>proc_macro</code> crate</a>。该函数可以是<code>const</code>，并且可以使用<code>extern</code>显式指定 Rust ABI，但不能使用任何其他<a href="#grammar-FunctionQualifiers">限定符</a>（例如，它不能是<code>async</code>或<code>unsafe</code>）。</p>
<div class="rule" id="r-macro.proc.derive.duplicates"><a class="rule-link" href="#r-macro.proc.derive.duplicates" title="macro.proc.derive.duplicates"><span>[macro<wbr>.proc<wbr>.derive<wbr>.duplicates]</span></a>
</div>

<p><code>proc_macro_derive</code>属性在一个函数上只能使用一次。</p>
<div class="rule" id="r-macro.proc.derive.namespace"><a class="rule-link" href="#r-macro.proc.derive.namespace" title="macro.proc.derive.namespace"><span>[macro<wbr>.proc<wbr>.derive<wbr>.namespace]</span></a>
</div>

<p><code>proc_macro_derive</code>属性在crate的根目录中的<a href="#命名空间">宏命名空间</a>中公开定义派生宏。</p>
<div class="rule" id="r-macro.proc.derive.output"><a class="rule-link" href="#r-macro.proc.derive.output" title="macro.proc.derive.output"><span>[macro<wbr>.proc<wbr>.derive<wbr>.output]</span></a>
</div>

<p>输入<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>是应用<code>derive</code>属性的<a href="#项">项</a>的词法单元流。输出<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>必须是（可能为空的）一组<a href="#项">项</a>。这些<a href="#项">项</a>会在输入<a href="#项">项</a>之后，在同一<a href="#模块">模块</a>或<a href="#块表达式">块</a>内被追加。</p>
<div class="rule" id="r-macro.proc.derive.attributes"><a class="rule-link" href="#r-macro.proc.derive.attributes" title="macro.proc.derive.attributes"><span>[macro<wbr>.proc<wbr>.derive<wbr>.attributes]</span></a>
</div>

<h3 id="派生宏辅助属性"><a class="header" href="#派生宏辅助属性">派生宏辅助属性</a></h3>
<div class="rule" id="r-macro.proc.derive.attributes.intro"><a class="rule-link" href="#r-macro.proc.derive.attributes.intro" title="macro.proc.derive.attributes.intro"><span>[macro<wbr>.proc<wbr>.derive<wbr>.attributes<wbr>.intro]</span></a>
</div>

<p>派生宏可以声明 <em>派生宏辅助属性</em> ，用于派生宏所应用的<a href="#项">项</a>的作用域内。这些<a href="#属性-1">属性</a>是<a href="#active-and-inert-attributes">惰性的</a>。虽然它们的目的被声明它们的宏使用，但它们可以被任何宏看到。</p>
<div class="rule" id="r-macro.proc.derive.attributes.decl"><a class="rule-link" href="#r-macro.proc.derive.attributes.decl" title="macro.proc.derive.attributes.decl"><span>[macro<wbr>.proc<wbr>.derive<wbr>.attributes<wbr>.decl]</span></a>
</div>

<p>派生宏的辅助属性通过将其标识符添加到<code>proc_macro_derive</code>属性的<code>attributes</code>列表中来声明。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>这声明了一个辅助属性然后忽略了它。</p>
<!-- ignore: test doesn't support proc-macro -->
<pre><code class="language-rust ignore"><span class="boring">#![crate_type="proc-macro"]
</span><span class="boring">extern crate proc_macro;
</span><span class="boring">use proc_macro::TokenStream;
</span><span class="boring">
</span>#[proc_macro_derive(WithHelperAttr, attributes(helper))]
pub fn derive_with_helper_attr(_item: TokenStream) -&gt; TokenStream {
    TokenStream::new()
}</code></pre>
<p>要使用它，我们可以这样写：</p>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">extern crate proc_macro_examples;
use proc_macro_examples::WithHelperAttr;

#[derive(WithHelperAttr)]
struct Struct {
    #[helper] field: (),
}</code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.proc.derive.attributes.scope"><a class="rule-link" href="#r-macro.proc.derive.attributes.scope" title="macro.proc.derive.attributes.scope"><span>[macro<wbr>.proc<wbr>.derive<wbr>.attributes<wbr>.scope]</span></a>
</div>

<p>当一个派生宏调用应用于一个<a href="#项">项</a>时，该派生宏引入的辅助属性会在以下情况下生效：1) 用于应用于该<a href="#项">项</a>并在派生宏调用后词法应用的<a href="#属性-1">属性</a>，以及 2) 用于应用于<a href="#项">项</a>内部的字段和变体的<a href="#属性-1">属性</a>。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>rustc目前允许在引入它们的宏之前使用派生辅助。这种乱序使用的派生辅助可能不会遮蔽其他属性宏。此行为已被弃用，并计划移除。</p>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">#[helper] // 已弃用，未来将成为硬错误。
#[derive(WithHelperAttr)]
struct Struct {
    field: (),
}</code></pre>
<p>更多详情，请参见<a href="https://github.com/rust-lang/rust/issues/79202">Rust问题单#79202</a>。</p>
</blockquote>
</div>

<!-- template:attributes -->
<div class="rule" id="r-macro.proc.attribute"><a class="rule-link" href="#r-macro.proc.attribute" title="macro.proc.attribute"><span>[macro<wbr>.proc<wbr>.attribute]</span></a>
</div>

<h2 id="proc_macro_attribute属性"><a class="header" href="#proc_macro_attribute属性"><code>proc_macro_attribute</code>属性</a></h2>
<div class="rule" id="r-macro.proc.attribute.intro"><a class="rule-link" href="#r-macro.proc.attribute.intro" title="macro.proc.attribute.intro"><span>[macro<wbr>.proc<wbr>.attribute<wbr>.intro]</span></a>
</div>

<p><em><code>proc_macro_attribute</code><a href="#属性-1">属性</a></em> 定义一个 <em>属性宏</em> ，它可以作为<a href="#属性-1">外部属性</a>使用。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>此属性宏接受输入流并原样发出，实际上是一个空操作属性。</p>
<!-- ignore: test doesn't support proc-macro -->
<pre><code class="language-rust ignore"><span class="boring">#![crate_type = "proc-macro"]
</span><span class="boring">extern crate proc_macro;
</span><span class="boring">use proc_macro::TokenStream;
</span>
#[proc_macro_attribute]
pub fn return_as_is(_attr: TokenStream, item: TokenStream) -&gt; TokenStream {
    item
}</code></pre>
</blockquote>
</div>

<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>这显示了在编译器输出中，属性宏所看到的字符串化<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>。</p>
<!-- ignore: test doesn't support proc-macro -->
<pre><code class="language-rust ignore">// my-macro/src/lib.rs
<span class="boring">extern crate proc_macro;
</span><span class="boring">use proc_macro::TokenStream;
</span>#[proc_macro_attribute]
pub fn show_streams(attr: TokenStream, item: TokenStream) -&gt; TokenStream {
    println!("attr: \"{attr}\"");
    println!("item: \"{item}\"");
    item
}</code></pre>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">// src/lib.rs
extern crate my_macro;

use my_macro::show_streams;

// 示例：基本函数。
#[show_streams]
fn invoke1() {}
// 输出：attr: ""
// 输出：item: "fn invoke1() {}"

// 示例：带输入的属性。
#[show_streams(bar)]
fn invoke2() {}
// 输出：attr: "bar"
// 输出：item: "fn invoke2() {}"

// 示例：输入中有多个词法单元。
#[show_streams(multiple =&gt; tokens)]
fn invoke3() {}
// 输出：attr: "multiple =&gt; tokens"
// 输出：item: "fn invoke3() {}"

// 示例：输入中有分隔符。
#[show_streams { delimiters }]
fn invoke4() {}
// 输出：attr: "delimiters"
// 输出：item: "fn invoke4() {}"</code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.proc.attribute.syntax"><a class="rule-link" href="#r-macro.proc.attribute.syntax" title="macro.proc.attribute.syntax"><span>[macro<wbr>.proc<wbr>.attribute<wbr>.syntax]</span></a>
</div>

<p><code>proc_macro_attribute</code>属性使用<a href="#grammar-MetaWord">MetaWord</a>语法。</p>
<div class="rule" id="r-macro.proc.attribute.allowed-positions"><a class="rule-link" href="#r-macro.proc.attribute.allowed-positions" title="macro.proc.attribute.allowed-positions"><span>[macro<wbr>.proc<wbr>.attribute<wbr>.allowed-positions]</span></a>
</div>

<p><code>proc_macro_attribute</code>属性只能应用于<code>fn(TokenStream, TokenStream) -&gt; TokenStream</code>类型的<code>pub</code><a href="#函数">函数</a>，其中<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>来自 <a href="../proc_macro/index.html"><code>proc_macro</code> crate</a>。它必须具有 <a href="#r-items.fn.extern">“Rust” ABI</a>。不允许使用其他函数限定符。它必须位于crate的根目录中。</p>
<div class="rule" id="r-macro.proc.attribute.duplicates"><a class="rule-link" href="#r-macro.proc.attribute.duplicates" title="macro.proc.attribute.duplicates"><span>[macro<wbr>.proc<wbr>.attribute<wbr>.duplicates]</span></a>
</div>

<p><code>proc_macro_attribute</code>属性在一个函数上只能指定一次。</p>
<div class="rule" id="r-macro.proc.attribute.namespace"><a class="rule-link" href="#r-macro.proc.attribute.namespace" title="macro.proc.attribute.namespace"><span>[macro<wbr>.proc<wbr>.attribute<wbr>.namespace]</span></a>
</div>

<p><code>proc_macro_attribute</code>属性在crate的根目录中的<a href="#命名空间">宏命名空间</a>中定义属性，其名称与函数同名。</p>
<div class="rule" id="r-macro.proc.attribute.use-positions"><a class="rule-link" href="#r-macro.proc.attribute.use-positions" title="macro.proc.attribute.use-positions"><span>[macro<wbr>.proc<wbr>.attribute<wbr>.use-positions]</span></a>
</div>

<p>属性宏只能用于：</p>
<ul>
<li><a href="#项">项</a></li>
<li><a href="#外部块"><code>extern</code>块</a> 中的项</li>
<li>固有和特型 <a href="#实现">实现</a></li>
<li><a href="#特型">特型定义</a></li>
</ul>
<div class="rule" id="r-macro.proc.attribute.behavior"><a class="rule-link" href="#r-macro.proc.attribute.behavior" title="macro.proc.attribute.behavior"><span>[macro<wbr>.proc<wbr>.attribute<wbr>.behavior]</span></a>
</div>

<p>第一个<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>参数是属性名称后的带分隔符词法单元树，但不包括外部分隔符。如果应用的属性只包含属性名称，或属性名称后跟空分隔符，则<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>为空。</p>
<p>第二个<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>是<a href="#项">项</a>的其余部分，包括<a href="#项">项</a>上的其他<a href="#属性-1">属性</a>。</p>
<p>应用属性的<a href="#项">项</a>会被返回的<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>中的零个或多个<a href="#项">项</a>替换。</p>
<div class="rule" id="r-macro.proc.token"><a class="rule-link" href="#r-macro.proc.token" title="macro.proc.token"><span>[macro<wbr>.proc<wbr>.token]</span></a>
</div>

<h2 id="声明宏词法单元和过程宏词法单元"><a class="header" href="#声明宏词法单元和过程宏词法单元">声明宏词法单元和过程宏词法单元</a></h2>
<div class="rule" id="r-macro.proc.token.intro"><a class="rule-link" href="#r-macro.proc.token.intro" title="macro.proc.token.intro"><span>[macro<wbr>.proc<wbr>.token<wbr>.intro]</span></a>
</div>

<p>声明式<a href="#声明宏"><code>macro_rules</code></a>宏和过程宏对词法单元（或更确切地说，<a href="../proc_macro/enum.TokenTree.html"><code>TokenTree</code>s</a>）使用相似但不同的定义。</p>
<div class="rule" id="r-macro.proc.token.macro_rules"><a class="rule-link" href="#r-macro.proc.token.macro_rules" title="macro.proc.token.macro_rules"><span>[macro<wbr>.proc<wbr>.token<wbr>.macro_rules]</span></a>
</div>

<p><a href="#声明宏"><code>macro_rules</code></a>中的词法单元树（对应<code>tt</code>匹配器）定义如下：</p>
<ul>
<li>带分隔符的组（<code>(...)</code>、<code>{...}</code>等）</li>
<li>语言支持的所有运算符，包括单字符和多字符的（<code>+</code>、<code>+=</code>）。
<ul>
<li>请注意，此集合不包括单引号<code>'</code>。</li>
</ul>
</li>
<li>字面量（<code>"string"</code>、<code>1</code>等）
<ul>
<li>请注意，负号（例如<code>-1</code>）永远不会是此类字面量词法单元的一部分，而是一个单独的运算符词法单元。</li>
</ul>
</li>
<li>标识符，包括关键字（<code>ident</code>、<code>r#ident</code>、<code>fn</code>）</li>
<li>生命周期（<code>'ident</code>）</li>
<li><a href="#声明宏"><code>macro_rules</code></a>中的元变量替换（例如<code>macro_rules! mac { ($my_expr: expr) =&gt; { $my_expr } }</code>在<code>mac</code>展开后的<code>$my_expr</code>，无论传递的表达式如何，都将被视为单个词法单元树）</li>
</ul>
<div class="rule" id="r-macro.proc.token.tree"><a class="rule-link" href="#r-macro.proc.token.tree" title="macro.proc.token.tree"><span>[macro<wbr>.proc<wbr>.token<wbr>.tree]</span></a>
</div>

<p>过程宏中的词法单元树定义如下：</p>
<ul>
<li>带分隔符的组（<code>(...)</code>、<code>{...}</code>等）</li>
<li>语言支持的运算符中使用的所有标点符号（<code>+</code>，但不包括<code>+=</code>），以及单引号<code>'</code>字符（通常用于生命周期，有关生命周期拆分和合并行为，请参见下文）</li>
<li>字面量（<code>"string"</code>、<code>1</code>等）
<ul>
<li>负号（例如<code>-1</code>）作为整数和浮点字面量的一部分受支持。</li>
</ul>
</li>
<li>标识符，包括关键字（<code>ident</code>、<code>r#ident</code>、<code>fn</code>）</li>
</ul>
<div class="rule" id="r-macro.proc.token.conversion.intro"><a class="rule-link" href="#r-macro.proc.token.conversion.intro" title="macro.proc.token.conversion.intro"><span>[macro<wbr>.proc<wbr>.token<wbr>.conversion<wbr>.intro]</span></a>
</div>

<p>当词法单元流在过程宏之间传递时，会考虑这两种定义之间的不匹配。
请注意，下面的转换可能以惰性方式发生，因此如果词法单元未被实际检查，则可能不会发生转换。</p>
<div class="rule" id="r-macro.proc.token.conversion.to-proc_macro"><a class="rule-link" href="#r-macro.proc.token.conversion.to-proc_macro" title="macro.proc.token.conversion.to-proc_macro"><span>[macro<wbr>.proc<wbr>.token<wbr>.conversion<wbr>.to-proc_macro]</span></a>
</div>

<p>当传递给过程宏时</p>
<ul>
<li>所有多字符运算符都会被拆分为单字符。</li>
<li>生命周期会被拆分为一个<code>'</code>字符和一个标识符。</li>
<li>关键字元变量 <a href="#r-macro.decl.hygiene.crate"><code>$crate</code></a> 作为单个标识符传递。</li>
<li>所有其他元变量替换都表示为其底层词法单元流。
<ul>
<li>此类词法单元流可能被包装到带分隔符的组（<a href="../proc_macro/struct.Group.html"><code>Group</code></a>）中，使用隐式分隔符（<a href="../proc_macro/enum.Delimiter.html#variant.None"><code>Delimiter::None</code></a>），当需要保留解析优先级时。</li>
<li><code>tt</code>和<code>ident</code>替换永远不会被包装到此类组中，并且始终表示为其底层词法单元树。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-macro.proc.token.conversion.from-proc_macro"><a class="rule-link" href="#r-macro.proc.token.conversion.from-proc_macro" title="macro.proc.token.conversion.from-proc_macro"><span>[macro<wbr>.proc<wbr>.token<wbr>.conversion<wbr>.from-proc_macro]</span></a>
</div>

<p>当从过程宏发出时</p>
<ul>
<li>标点符号在适用时会被组合成多字符运算符。</li>
<li>与标识符连接的单引号<code>'</code>会被组合成生命周期。</li>
<li>负字面量会被转换为两个词法单元（<code>-</code>和字面量），可能被包装到带分隔符的组（<a href="../proc_macro/struct.Group.html"><code>Group</code></a>）中，使用隐式分隔符（<a href="../proc_macro/enum.Delimiter.html#variant.None"><code>Delimiter::None</code></a>），当需要保留解析优先级时。</li>
</ul>
<div class="rule" id="r-macro.proc.token.doc-comment"><a class="rule-link" href="#r-macro.proc.token.doc-comment" title="macro.proc.token.doc-comment"><span>[macro<wbr>.proc<wbr>.token<wbr>.doc-comment]</span></a>
</div>

<p>请注意，声明宏和过程宏都不支持文档注释词法单元（例如<code>/// Doc</code>），因此当它们被传递给宏时，总是会被转换为表示其等效<code>#[doc = r"str"]</code>属性的词法单元流。</p>
<div style="break-before: page; page-break-before: always;"></div><!-- https://github.com/rust-lang/reference/blob/master/src/crates-and-source-files.md -->
<!-- commit 68bdfd15fa9feebfbf94a06cf574de598e239198 -->
<div class="rule" id="r-crate"><a class="rule-link" href="#r-crate" title="crate"><span>[crate]</span></a>
</div>

<h1 id="crate与源文件"><a class="header" href="#crate与源文件">Crate与源文件</a></h1>
<div class="rule" id="r-crate.syntax"><a class="rule-link" href="#r-crate.syntax" title="crate.syntax"><span>[crate<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-Crate" onclick="show_railroad()"><a href="#railroad-Crate">Crate</a></span> → <br>    <span class="grammar-text"><a href="#grammar-InnerAttribute">InnerAttribute</a></span><sup>*</sup> <br>    <span class="grammar-text"><a href="#grammar-Item">Item</a></span><sup>*</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 408px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Crate"><svg class="railroad" viewbox="0 0 408 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Crate">
<text class="comment" x="32" y="25">
Crate</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-InnerAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
InnerAttribute</text>
</g>
</a>
</g>
</g>
<g class="optional">
<path d=" M 249 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 76 m -35 0 l -5 -5 m 0 10 l 5 -5 m 35 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 273 66 h 12 m 52 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -52 m 29 0 l 5 -5 m 0 10 l -5 -5 m -29 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-Item">
<g class="nonterminal">
<rect height="22" width="52" x="285" y="55" />
<text x="311" y="71">
Item</text>
</g>
</a>
</g>
</g>
<path d=" M 239 66 h 10" />
</g>
<path d=" M 383 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 373 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>尽管Rust与其他任何语言一样，既可以由解释器实现，也可以由编译器实现，但目前唯一的实现是编译器，并且该语言始终被设计为可编译的。因此，本节假定存在一个编译器。</p>
</blockquote>
</div>

<div class="rule" id="r-crate.compile-time"><a class="rule-link" href="#r-crate.compile-time" title="crate.compile-time"><span>[crate<wbr>.compile-time]</span></a>
</div>

<p>Rust的语义遵循编译期与运行期之间的 <em>阶段区别</em><sup class="footnote-reference" id="fr-phase-distinction-1"><a href="#footnote-phase-distinction">1</a></sup>。具有 <em>静态解释</em> 的语义规则决定编译的成功或失败，而具有 <em>动态解释</em> 的语义规则决定程序在运行时的行为。</p>
<div class="rule" id="r-crate.unit"><a class="rule-link" href="#r-crate.unit" title="crate.unit"><span>[crate<wbr>.unit]</span></a>
</div>

<p>编译模型围绕称为 <em>crate</em> 的制品展开。每次编译都会处理一个源代码形式的单个crate，如果成功，则生成一个二进制形式的单个crate：一个可执行文件或某种库。<sup class="footnote-reference" id="fr-cratesourcefile-1"><a href="#footnote-cratesourcefile">2</a></sup></p>
<div class="rule" id="r-crate.module"><a class="rule-link" href="#r-crate.module" title="crate.module"><span>[crate<wbr>.module]</span></a>
</div>

<p>一个 <em>crate</em> 是编译和链接的单元，也是版本控制、分发和运行时加载的单元。一个crate包含一个嵌套的<a href="#模块">模块</a>作用域_树_。这棵树的顶层是一个匿名模块（从模块内部路径的角度来看），并且crate内的任何<a href="#grammar-Item">项</a>都有一个规范的<a href="#路径">模块路径</a>，表示其在crate的模块树中的位置。</p>
<div class="rule" id="r-crate.input-source"><a class="rule-link" href="#r-crate.input-source" title="crate.input-source"><span>[crate<wbr>.input-source]</span></a>
</div>

<p>Rust编译器总是以单个源文件作为输入被调用，并总是生成单个输出crate。该源文件的处理可能会导致其他源文件作为模块被加载。源文件的扩展名为<code>.rs</code>。</p>
<div class="rule" id="r-crate.module-def"><a class="rule-link" href="#r-crate.module-def" title="crate.module-def"><span>[crate<wbr>.module-def]</span></a>
</div>

<p>一个Rust源文件描述了一个模块，该模块的名称和位置——在当前crate的模块树中——是从源文件外部定义的：可以通过引用源文件中的显式<a href="#grammar-Module">Module</a>项，或者通过crate本身的名称来定义。</p>
<div class="rule" id="r-crate.inline-module"><a class="rule-link" href="#r-crate.inline-module" title="crate.inline-module"><span>[crate<wbr>.inline-module]</span></a>
</div>

<p>每个源文件都是一个模块，但并非每个模块都需要自己的源文件：<a href="#模块">模块定义</a>可以嵌套在一个文件中。</p>
<div class="rule" id="r-crate.items"><a class="rule-link" href="#r-crate.items" title="crate.items"><span>[crate<wbr>.items]</span></a>
</div>

<p>每个源文件包含零个或多个<a href="#grammar-Item">项</a>定义序列，并且可以选择以任意数量应用于包含模块的<a href="#属性-1">属性</a>开头，其中大部分会影响编译器的行为。</p>
<div class="rule" id="r-crate.attributes"><a class="rule-link" href="#r-crate.attributes" title="crate.attributes"><span>[crate<wbr>.attributes]</span></a>
</div>

<p>匿名crate模块可以拥有适用于整个crate的额外属性。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>文件内容可以由<a href="#shebang移除">shebang</a>开头。</p>
</blockquote>
</div>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 指定crate名称。
#![crate_name = "projx"]

// 指定输出制品类型。
#![crate_type = "lib"]

// 开启一个警告。
// 这可以在任何模块中完成，而不仅仅是匿名crate模块。
#![warn(non_camel_case_types)]
<span class="boring">}</span></code></pre>
<div class="rule" id="r-crate.main"><a class="rule-link" href="#r-crate.main" title="crate.main"><span>[crate<wbr>.main]</span></a>
</div>

<h2 id="main函数"><a class="header" href="#main函数">main函数</a></h2>
<div class="rule" id="r-crate.main.general"><a class="rule-link" href="#r-crate.main.general" title="crate.main.general"><span>[crate<wbr>.main<wbr>.general]</span></a>
</div>

<p>包含<code>main</code><a href="#函数">函数</a>的crate可以编译成可执行文件。</p>
<div class="rule" id="r-crate.main.restriction"><a class="rule-link" href="#r-crate.main.restriction" title="crate.main.restriction"><span>[crate<wbr>.main<wbr>.restriction]</span></a>
</div>

<p>如果存在<code>main</code>函数，它必须不接受任何参数，不得声明任何<a href="#特型和生命周期界限">特型或生命周期边界</a>，不得有任何<a href="#where-clauses">where子句</a>，并且其返回类型必须实现<a href="https://doc.rust-lang.org/std/process/trait.Termination.html"><code>Termination</code></a>特型。</p>
<pre class="playground"><code class="language-rust edition2024">fn main() {}</code></pre>
<pre class="playground"><code class="language-rust edition2024">fn main() -&gt; ! {
    std::process::exit(0);
}</code></pre>
<pre class="playground"><code class="language-rust edition2024">fn main() -&gt; impl std::process::Termination {
    std::process::ExitCode::SUCCESS
}</code></pre>
<div class="rule" id="r-crate.main.import"><a class="rule-link" href="#r-crate.main.import" title="crate.main.import"><span>[crate<wbr>.main<wbr>.import]</span></a>
</div>

<p><code>main</code>函数可以是一个导入，例如来自外部crate或当前crate。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>mod foo {
    pub fn bar() {
        println!("Hello, world!");
    }
}
use foo::bar as main;
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>标准库中实现了<a href="https://doc.rust-lang.org/std/process/trait.Termination.html"><code>Termination</code></a>的类型包括：</p>
<ul>
<li><code>()</code></li>
<li><a href="#never类型"><code>!</code></a></li>
<li><a href="https://doc.rust-lang.org/core/convert/enum.Infallible.html"><code>Infallible</code></a></li>
<li><a href="https://doc.rust-lang.org/std/process/struct.ExitCode.html"><code>ExitCode</code></a></li>
<li><code>Result&lt;T, E&gt; where T: Termination, E: Debug</code></li>
</ul>
</blockquote>
</div>

<!-- If the previous section needs updating (from "must take no arguments"
  onwards, also update it in the testing.md file -->
<div class="rule" id="r-crate.uncaught-foreign-unwinding"><a class="rule-link" href="#r-crate.uncaught-foreign-unwinding" title="crate.uncaught-foreign-unwinding"><span>[crate<wbr>.uncaught-foreign-unwinding]</span></a>
</div>

<h3 id="未捕获的外部unwinding"><a class="header" href="#未捕获的外部unwinding">未捕获的外部unwinding</a></h3>
<p>当“外部“unwind（例如从C++代码抛出的异常，或使用不同恐慌处理器的Rust代码中的<code>panic!</code>）传播超出<code>main</code>函数时，进程将安全终止。这可能以中止的形式发生，在这种情况下，不保证会执行任何<code>Drop</code>调用，并且错误输出可能不如运行时被“原生“Rust <code>panic</code>终止时那么详细。</p>
<p>欲了解更多信息，请参阅<a href="#unwinding-across-ffi-boundaries">恐慌文档</a>。</p>
<div class="rule" id="r-crate.no_main"><a class="rule-link" href="#r-crate.no_main" title="crate.no_main"><span>[crate<wbr>.no_main]</span></a>
</div>

<h3 id="no_main属性"><a class="header" href="#no_main属性"><code>no_main</code>属性</a></h3>
<p><em><code>no_main</code><a href="#属性-1">属性</a></em> 可以应用于crate级别，以禁用为可执行二进制文件发出<code>main</code>符号。当链接到某个其他对象定义了<code>main</code>时，这会很有用。</p>
<div class="rule" id="r-crate.crate_name"><a class="rule-link" href="#r-crate.crate_name" title="crate.crate_name"><span>[crate<wbr>.crate_name]</span></a>
</div>

<h2 id="crate_name属性"><a class="header" href="#crate_name属性"><code>crate_name</code>属性</a></h2>
<div class="rule" id="r-crate.crate_name.general"><a class="rule-link" href="#r-crate.crate_name.general" title="crate.crate_name.general"><span>[crate<wbr>.crate_name<wbr>.general]</span></a>
</div>

<p><em><code>crate_name</code><a href="#属性-1">属性</a></em> 可以应用于crate级别，使用<a href="#grammar-MetaNameValueStr">MetaNameValueStr</a>语法格式指定crate的名称。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span>#![crate_name = "mycrate"]
<span class="boring">fn main() {
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-crate.crate_name.restriction"><a class="rule-link" href="#r-crate.crate_name.restriction" title="crate.crate_name.restriction"><span>[crate<wbr>.crate_name<wbr>.restriction]</span></a>
</div>

<p>crate名称不能为空，并且只能包含<a href="https://doc.rust-lang.org/std/primitive.char.html#method.is_alphanumeric">Unicode字母数字</a>字符或<code>_</code>(U+005F)字符。</p>
<hr>
<ol class="footnote-definition">
<li id="footnote-phase-distinction">
<p>这种区别也存在于解释器中。静态检查，如语法分析、类型检查和linting，无论程序何时执行，都应该在程序执行之前进行。 <a href="#fr-phase-distinction-1">↩</a></p>
</li>
<li id="footnote-cratesourcefile">
<p>一个crate在某种程度上类似于ECMA-335 CLI模型中的<em>assembly</em>，SML/NJ Compilation Manager中的 <em>库(library)</em>，Owens和Flatt模块系统中的 <em>单元(unit)</em>，或Mesa中的 <em>配置(configuration)</em>。 <a href="#fr-cratesourcefile-1">↩</a></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- https://github.com/rust-lang/reference/blob/master/src/conditional-compilation.md -->
<!-- commit 68bdfd15fa9feebfbf94a06cf574de598e239198 -->
<div class="rule" id="r-cfg"><a class="rule-link" href="#r-cfg" title="cfg"><span>[cfg]</span></a>
</div>

<h1 id="条件编译"><a class="header" href="#条件编译">条件编译</a></h1>
<div class="rule" id="r-cfg.syntax"><a class="rule-link" href="#r-cfg.syntax" title="cfg.syntax"><span>[cfg<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ConfigurationPredicate" onclick="show_railroad()"><a href="#railroad-ConfigurationPredicate">ConfigurationPredicate</a></span> → <br>      <span class="grammar-text"><a href="#grammar-ConfigurationOption">ConfigurationOption</a></span> <br>    | <span class="grammar-text"><a href="#grammar-ConfigurationAll">ConfigurationAll</a></span> <br>    | <span class="grammar-text"><a href="#grammar-ConfigurationAny">ConfigurationAny</a></span> <br>    | <span class="grammar-text"><a href="#grammar-ConfigurationNot">ConfigurationNot</a></span> <br>    | <span class="grammar-literal">true</span> <br>    | <span class="grammar-literal">false</span></p>
<p><span class="grammar-text grammar-production" id="grammar-ConfigurationOption" onclick="show_railroad()"><a href="#railroad-ConfigurationOption">ConfigurationOption</a></span> → <br>    <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> ( <span class="grammar-literal">=</span> ( <span class="grammar-text"><a href="#grammar-STRING_LITERAL">STRING_LITERAL</a></span> | <span class="grammar-text"><a href="#grammar-RAW_STRING_LITERAL">RAW_STRING_LITERAL</a></span> ) )<sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-ConfigurationAll" onclick="show_railroad()"><a href="#railroad-ConfigurationAll">ConfigurationAll</a></span> → <br>    <span class="grammar-literal">all</span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-ConfigurationPredicateList">ConfigurationPredicateList</a></span><sup>?</sup> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-ConfigurationAny" onclick="show_railroad()"><a href="#railroad-ConfigurationAny">ConfigurationAny</a></span> → <br>    <span class="grammar-literal">any</span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-ConfigurationPredicateList">ConfigurationPredicateList</a></span><sup>?</sup> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-ConfigurationNot" onclick="show_railroad()"><a href="#railroad-ConfigurationNot">ConfigurationNot</a></span> → <br>    <span class="grammar-literal">not</span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-ConfigurationPredicate">ConfigurationPredicate</a></span> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-ConfigurationPredicateList" onclick="show_railroad()"><a href="#railroad-ConfigurationPredicateList">ConfigurationPredicateList</a></span> → <br>    <span class="grammar-text"><a href="#grammar-ConfigurationPredicate">ConfigurationPredicate</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-ConfigurationPredicate">ConfigurationPredicate</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 290px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ConfigurationPredicate"><svg class="railroad" viewbox="0 0 290 239" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ConfigurationPredicate">
<text class="comment" x="95" y="25">
ConfigurationPredicate</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 172 0 h 24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ConfigurationOption">
<g class="nonterminal">
<rect height="22" width="172" x="59" y="42" />
<text x="145" y="58">
ConfigurationOption</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 196 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 196 0 v -33" />
<path d=" M 47 107 v 33 m 196 0 v -33" />
<path d=" M 47 140 v 33 m 196 0 v -33" />
<path d=" M 47 173 v 33 m 196 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 148 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ConfigurationAll">
<g class="nonterminal">
<rect height="22" width="148" x="59" y="75" />
<text x="133" y="91">
ConfigurationAll</text>
</g>
</a>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 148 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ConfigurationAny">
<g class="nonterminal">
<rect height="22" width="148" x="59" y="108" />
<text x="133" y="124">
ConfigurationAny</text>
</g>
</a>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 148 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ConfigurationNot">
<g class="nonterminal">
<rect height="22" width="148" x="59" y="141" />
<text x="133" y="157">
ConfigurationNot</text>
</g>
</a>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 52 0 h 120 m -57 0 l -5 -5 m 0 10 l 5 -5 m 57 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="174" />
<text x="85" y="190">
true</text>
</g>
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 60 0 h 112 m -53 0 l -5 -5 m 0 10 l 5 -5 m 53 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="59" y="207" />
<text x="89" y="223">
false</text>
</g>
</g>
<path d=" M 265 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 255 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 478px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ConfigurationOption"><svg class="railroad" viewbox="0 0 478 120" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ConfigurationOption">
<text class="comment" x="81" y="25">
ConfigurationOption</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="55" />
<text x="85" y="71">
IDENTIFIER</text>
</g>
</a>
<g class="optional">
<path d=" M 145 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 250 m -122 0 l -5 -5 m 0 10 l 5 -5 m 122 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="55" />
<text x="183" y="71">
=</text>
</g>
<g class="choice">
<path d=" M 207 66 h 24 m 132 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0" />
<a class="link" xlink:href="#railroad-STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="132" x="231" y="55" />
<text x="297" y="71">
STRING_LITERAL</text>
</g>
</a>
<path d=" M 207 66 a 12 12 0 0 1 12 12 v 9 m 188 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 219 87 v 0 a 12 12 0 0 0 12 12 m 164 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-RAW_STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="164" x="231" y="88" />
<text x="313" y="104">
RAW_STRING_LITERAL</text>
</g>
</a>
</g>
<path d=" M 197 66 h 10" />
</g>
</g>
<path d=" M 135 66 h 10" />
</g>
<path d=" M 453 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 443 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 484px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ConfigurationAll"><svg class="railroad" viewbox="0 0 484 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ConfigurationAll">
<text class="comment" x="71" y="25">
ConfigurationAll</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="55" />
<text x="57" y="71">
all</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="89" y="55" />
<text x="103" y="71">
(</text>
</g>
<g class="optional">
<path d=" M 127 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 236 m -115 0 l -5 -5 m 0 10 l 5 -5 m 115 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-ConfigurationPredicateList">
<g class="nonterminal">
<rect height="22" width="236" x="151" y="55" />
<text x="269" y="71">
ConfigurationPredicateList</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="421" y="55" />
<text x="435" y="71">
)</text>
</g>
<path d=" M 79 66 h 10" />
<path d=" M 117 66 h 10" />
<path d=" M 411 66 h 10" />
</g>
<path d=" M 459 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 449 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 484px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ConfigurationAny"><svg class="railroad" viewbox="0 0 484 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ConfigurationAny">
<text class="comment" x="71" y="25">
ConfigurationAny</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="55" />
<text x="57" y="71">
any</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="89" y="55" />
<text x="103" y="71">
(</text>
</g>
<g class="optional">
<path d=" M 127 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 236 m -115 0 l -5 -5 m 0 10 l 5 -5 m 115 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-ConfigurationPredicateList">
<g class="nonterminal">
<rect height="22" width="236" x="151" y="55" />
<text x="269" y="71">
ConfigurationPredicateList</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="421" y="55" />
<text x="435" y="71">
)</text>
</g>
<path d=" M 79 66 h 10" />
<path d=" M 117 66 h 10" />
<path d=" M 411 66 h 10" />
</g>
<path d=" M 459 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 449 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 404px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ConfigurationNot"><svg class="railroad" viewbox="0 0 404 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ConfigurationNot">
<text class="comment" x="71" y="25">
ConfigurationNot</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="42" />
<text x="57" y="58">
not</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="89" y="42" />
<text x="103" y="58">
(</text>
</g>
<a class="link" xlink:href="#railroad-ConfigurationPredicate">
<g class="nonterminal">
<rect height="22" width="204" x="127" y="42" />
<text x="229" y="58">
ConfigurationPredicate</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="341" y="42" />
<text x="355" y="58">
)</text>
</g>
<path d=" M 79 53 h 10" />
<path d=" M 117 53 h 10" />
<path d=" M 331 53 h 10" />
</g>
<path d=" M 379 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 369 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 684px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ConfigurationPredicateList"><svg class="railroad" viewbox="0 0 684 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ConfigurationPredicateList">
<text class="comment" x="109" y="25">
ConfigurationPredicateList</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ConfigurationPredicate">
<g class="nonterminal">
<rect height="22" width="204" x="35" y="55" />
<text x="137" y="71">
ConfigurationPredicate</text>
</g>
</a>
<g class="optional">
<path d=" M 249 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 266 m -130 0 l -5 -5 m 0 10 l 5 -5 m 130 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 273 66 h 12 m 242 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -242 m 124 0 l 5 -5 m 0 10 l -5 -5 m -124 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="285" y="55" />
<text x="299" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-ConfigurationPredicate">
<g class="nonterminal">
<rect height="22" width="204" x="323" y="55" />
<text x="425" y="71">
ConfigurationPredicate</text>
</g>
</a>
<path d=" M 313 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 573 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="597" y="55" />
<text x="611" y="71">
,</text>
</g>
</g>
<path d=" M 239 66 h 10" />
<path d=" M 563 66 h 10" />
</g>
<path d=" M 659 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 649 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-cfg.general"><a class="rule-link" href="#r-cfg.general" title="cfg.general"><span>[cfg<wbr>.general]</span></a>
</div>

<p><em>条件编译的源代码</em> 是指仅在特定条件下才会被编译的源代码。</p>
<div class="rule" id="r-cfg.attributes-macro"><a class="rule-link" href="#r-cfg.attributes-macro" title="cfg.attributes-macro"><span>[cfg<wbr>.attributes-macro]</span></a>
</div>

<p>可以使用<a href="#cfg属性"><code>cfg</code></a>和<a href="#cfg_attr属性"><code>cfg_attr</code></a> <a href="#属性-1">属性</a>以及内置的<a href="#cfg宏"><code>cfg!宏</code></a>来使源代码条件编译。</p>
<div class="rule" id="r-cfg.conditional"><a class="rule-link" href="#r-cfg.conditional" title="cfg.conditional"><span>[cfg<wbr>.conditional]</span></a>
</div>

<p>是否进行编译可以取决于被编译的crate的目标架构、传递给编译器的任意值，以及下面进一步描述的其他因素。</p>
<div class="rule" id="r-cfg.predicate"><a class="rule-link" href="#r-cfg.predicate" title="cfg.predicate"><span>[cfg<wbr>.predicate]</span></a>
</div>

<p>每种形式的条件编译都接受一个 <em>配置断言</em> ，该断言求值为真或假。该断言是以下形式之一：</p>
<div class="rule" id="r-cfg.predicate.option"><a class="rule-link" href="#r-cfg.predicate.option" title="cfg.predicate.option"><span>[cfg<wbr>.predicate<wbr>.option]</span></a>
</div>

<ul>
<li>一个配置选项。如果该选项已设置，则断言为真；如果未设置，则为假。</li>
</ul>
<div class="rule" id="r-cfg.predicate.all"><a class="rule-link" href="#r-cfg.predicate.all" title="cfg.predicate.all"><span>[cfg<wbr>.predicate<wbr>.all]</span></a>
</div>

<ul>
<li><code>all()</code>，带有一个逗号分隔的配置断言列表。如果所有给定的断言都为真，或者列表为空，则它为真。</li>
</ul>
<div class="rule" id="r-cfg.predicate.any"><a class="rule-link" href="#r-cfg.predicate.any" title="cfg.predicate.any"><span>[cfg<wbr>.predicate<wbr>.any]</span></a>
</div>

<ul>
<li><code>any()</code>，带有一个逗号分隔的配置断言列表。如果至少有一个给定的断言为真，则它为真。如果没有断言，则它为假。</li>
</ul>
<div class="rule" id="r-cfg.predicate.not"><a class="rule-link" href="#r-cfg.predicate.not" title="cfg.predicate.not"><span>[cfg<wbr>.predicate<wbr>.not]</span></a>
</div>

<ul>
<li><code>not()</code>，带有一个配置断言。如果其断言为假，则它为真；如果其断言为真，则它为假。</li>
</ul>
<div class="rule" id="r-cfg.predicate.literal"><a class="rule-link" href="#r-cfg.predicate.literal" title="cfg.predicate.literal"><span>[cfg<wbr>.predicate<wbr>.literal]</span></a>
</div>

<ul>
<li><code>true</code>或<code>false</code>字面量，分别总是为真或假。</li>
</ul>
<div class="rule" id="r-cfg.option-spec"><a class="rule-link" href="#r-cfg.option-spec" title="cfg.option-spec"><span>[cfg<wbr>.option-spec]</span></a>
</div>

<p><em>配置选项</em> 可以是名称，也可以是键值对，它们要么已设置，要么未设置。</p>
<div class="rule" id="r-cfg.option-name"><a class="rule-link" href="#r-cfg.option-name" title="cfg.option-name"><span>[cfg<wbr>.option-name]</span></a>
</div>

<p>名称写作单个标识符，例如<code>unix</code>。</p>
<div class="rule" id="r-cfg.option-key-value"><a class="rule-link" href="#r-cfg.option-key-value" title="cfg.option-key-value"><span>[cfg<wbr>.option-key-value]</span></a>
</div>

<p>键值对写作一个标识符、<code>=</code>，然后是一个字符串，例如<code>target_arch = "x86_64"</code>。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>=</code>周围的空白符会被忽略，所以<code>foo="bar"</code>和<code>foo = "bar"</code>是等效的。</p>
</blockquote>
</div>

<div class="rule" id="r-cfg.option-key-uniqueness"><a class="rule-link" href="#r-cfg.option-key-uniqueness" title="cfg.option-key-uniqueness"><span>[cfg<wbr>.option-key-uniqueness]</span></a>
</div>

<p>键不需要是唯一的。例如，<code>feature = "std"</code>和<code>feature = "serde"</code>可以同时设置。</p>
<div class="rule" id="r-cfg.options.set"><a class="rule-link" href="#r-cfg.options.set" title="cfg.options.set"><span>[cfg<wbr>.options<wbr>.set]</span></a>
</div>

<h2 id="已设置的配置选项"><a class="header" href="#已设置的配置选项">已设置的配置选项</a></h2>
<div class="rule" id="r-cfg.options.general"><a class="rule-link" href="#r-cfg.options.general" title="cfg.options.general"><span>[cfg<wbr>.options<wbr>.general]</span></a>
</div>

<p>哪些配置选项被设置是在crate编译期间静态确定的。</p>
<div class="rule" id="r-cfg.options.target"><a class="rule-link" href="#r-cfg.options.target" title="cfg.options.target"><span>[cfg<wbr>.options<wbr>.target]</span></a>
</div>

<p>一些选项是 <em>编译器设置的</em>，基于编译的相关数据。</p>
<div class="rule" id="r-cfg.options.other"><a class="rule-link" href="#r-cfg.options.other" title="cfg.options.other"><span>[cfg<wbr>.options<wbr>.other]</span></a>
</div>

<p>其他选项是 <em>任意设置的</em>，基于代码外部传递给编译器的输入。</p>
<div class="rule" id="r-cfg.options.crate"><a class="rule-link" href="#r-cfg.options.crate" title="cfg.options.crate"><span>[cfg<wbr>.options<wbr>.crate]</span></a>
</div>

<p>无法在被编译的crate的源代码内部设置配置选项。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>对于<code>rustc</code>，任意设置的配置选项使用<a href="https://doc.rust-lang.org/rustc/command-line-arguments.html#--cfg-configure-the-compilation-environment"><code>--cfg</code></a>标志设置。指定目标的配置值可以使用<code>rustc --print cfg --target $TARGET</code>显示。</p>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>键为<code>feature</code>的配置选项是<a href="https://doc.rust-lang.org/cargo/reference/features.html">Cargo</a>用于指定编译时选项和可选依赖项的约定。</p>
</blockquote>
</div>

<div class="rule" id="r-cfg.target_arch"><a class="rule-link" href="#r-cfg.target_arch" title="cfg.target_arch"><span>[cfg<wbr>.target_arch]</span></a>
</div>

<h3 id="target_arch"><a class="header" href="#target_arch"><code>target_arch</code></a></h3>
<div class="rule" id="r-cfg.target_arch.gen"><a class="rule-link" href="#r-cfg.target_arch.gen" title="cfg.target_arch.gen"><span>[cfg<wbr>.target_arch<wbr>.gen]</span></a>
</div>

<p>键值选项，设置为目标CPU架构一次。该值类似于平台目标三元组的第一个元素，但不完全相同。</p>
<div class="rule" id="r-cfg.target_arch.values"><a class="rule-link" href="#r-cfg.target_arch.values" title="cfg.target_arch.values"><span>[cfg<wbr>.target_arch<wbr>.values]</span></a>
</div>

<p>示例值：</p>
<ul>
<li><code>"x86"</code></li>
<li><code>"x86_64"</code></li>
<li><code>"mips"</code></li>
<li><code>"powerpc"</code></li>
<li><code>"powerpc64"</code></li>
<li><code>"arm"</code></li>
<li><code>"aarch64"</code></li>
</ul>
<div class="rule" id="r-cfg.target_feature"><a class="rule-link" href="#r-cfg.target_feature" title="cfg.target_feature"><span>[cfg<wbr>.target_feature]</span></a>
</div>

<h3 id="target_feature"><a class="header" href="#target_feature"><code>target_feature</code></a></h3>
<div class="rule" id="r-cfg.target_feature.general"><a class="rule-link" href="#r-cfg.target_feature.general" title="cfg.target_feature.general"><span>[cfg<wbr>.target_feature<wbr>.general]</span></a>
</div>

<p>键值选项，为当前编译目标可用的每个平台特性设置。</p>
<div class="rule" id="r-cfg.target_feature.values"><a class="rule-link" href="#r-cfg.target_feature.values" title="cfg.target_feature.values"><span>[cfg<wbr>.target_feature<wbr>.values]</span></a>
</div>

<p>示例值：</p>
<ul>
<li><code>"avx"</code></li>
<li><code>"avx2"</code></li>
<li><code>"crt-static"</code></li>
<li><code>"rdrand"</code></li>
<li><code>"sse"</code></li>
<li><code>"sse2"</code></li>
<li><code>"sse4.1"</code></li>
</ul>
<p>有关可用特性的更多详细信息，请参阅<a href="#the-target_feature-attribute"><code>target_feature</code>属性</a>。</p>
<div class="rule" id="r-cfg.target_feature.crt_static"><a class="rule-link" href="#r-cfg.target_feature.crt_static" title="cfg.target_feature.crt_static"><span>[cfg<wbr>.target_feature<wbr>.crt_static]</span></a>
</div>

<p><code>target_feature</code>选项还提供了一个额外的<code>crt-static</code>特性，用于指示<a href="#static-and-dynamic-c-runtimes">静态 C 运行时</a>是否可用。</p>
<div class="rule" id="r-cfg.target_os"><a class="rule-link" href="#r-cfg.target_os" title="cfg.target_os"><span>[cfg<wbr>.target_os]</span></a>
</div>

<h3 id="target_os"><a class="header" href="#target_os"><code>target_os</code></a></h3>
<div class="rule" id="r-cfg.target_os.general"><a class="rule-link" href="#r-cfg.target_os.general" title="cfg.target_os.general"><span>[cfg<wbr>.target_os<wbr>.general]</span></a>
</div>

<p>键值选项，设置为目标的操作系统一次。该值类似于平台目标三元组的第二个和第三个元素。</p>
<div class="rule" id="r-cfg.target_os.values"><a class="rule-link" href="#r-cfg.target_os.values" title="cfg.target_os.values"><span>[cfg<wbr>.target_os<wbr>.values]</span></a>
</div>

<p>示例值：</p>
<ul>
<li><code>"windows"</code></li>
<li><code>"macos"</code></li>
<li><code>"ios"</code></li>
<li><code>"linux"</code></li>
<li><code>"android"</code></li>
<li><code>"freebsd"</code></li>
<li><code>"dragonfly"</code></li>
<li><code>"openbsd"</code></li>
<li><code>"netbsd"</code></li>
<li><code>"none"</code>（通常用于嵌入式目标）</li>
</ul>
<div class="rule" id="r-cfg.target_family"><a class="rule-link" href="#r-cfg.target_family" title="cfg.target_family"><span>[cfg<wbr>.target_family]</span></a>
</div>

<h3 id="target_family"><a class="header" href="#target_family"><code>target_family</code></a></h3>
<div class="rule" id="r-cfg.target_family.general"><a class="rule-link" href="#r-cfg.target_family.general" title="cfg.target_family.general"><span>[cfg<wbr>.target_family<wbr>.general]</span></a>
</div>

<p>键值选项，提供目标的更通用描述，例如目标通常所属的操作系统或架构家族。可以设置任意数量的<code>target_family</code>键值对。</p>
<div class="rule" id="r-cfg.target_family.values"><a class="rule-link" href="#r-cfg.target_family.values" title="cfg.target_family.values"><span>[cfg<wbr>.target_family<wbr>.values]</span></a>
</div>

<p>示例值：</p>
<ul>
<li><code>"unix"</code></li>
<li><code>"windows"</code></li>
<li><code>"wasm"</code></li>
<li><code>"unix"</code>和<code>"wasm"</code>两者</li>
</ul>
<div class="rule" id="r-cfg.target_family.unix"><a class="rule-link" href="#r-cfg.target_family.unix" title="cfg.target_family.unix"><span>[cfg<wbr>.target_family<wbr>.unix]</span></a>
</div>

<h3 id="unix和windows"><a class="header" href="#unix和windows"><code>unix</code>和<code>windows</code></a></h3>
<p>如果设置了<code>target_family = "unix"</code>，则<code>unix</code>被设置。</p>
<div class="rule" id="r-cfg.target_family.windows"><a class="rule-link" href="#r-cfg.target_family.windows" title="cfg.target_family.windows"><span>[cfg<wbr>.target_family<wbr>.windows]</span></a>
</div>

<p>如果设置了<code>target_family = "windows"</code>，则<code>windows</code>被设置。</p>
<div class="rule" id="r-cfg.target_env"><a class="rule-link" href="#r-cfg.target_env" title="cfg.target_env"><span>[cfg<wbr>.target_env]</span></a>
</div>

<h3 id="target_env"><a class="header" href="#target_env"><code>target_env</code></a></h3>
<div class="rule" id="r-cfg.target_env.general"><a class="rule-link" href="#r-cfg.target_env.general" title="cfg.target_env.general"><span>[cfg<wbr>.target_env<wbr>.general]</span></a>
</div>

<p>键值选项，包含关于目标平台ABI或<code>libc</code>的进一步区分信息。出于历史原因，此值仅在实际需要区分时才定义为非空字符串。因此，例如，在许多GNU平台上，此值将为空。此值类似于平台目标三元组的第四个元素。一个区别是，像<code>gnueabihf</code>这样的嵌入式ABI将简单地将<code>target_env</code>定义为<code>"gnu"</code>。</p>
<div class="rule" id="r-cfg.target_env.values"><a class="rule-link" href="#r-cfg.target_env.values" title="cfg.target_env.values"><span>[cfg<wbr>.target_env<wbr>.values]</span></a>
</div>

<p>示例值：</p>
<ul>
<li><code>""</code></li>
<li><code>"gnu"</code></li>
<li><code>"msvc"</code></li>
<li><code>"musl"</code></li>
<li><code>"sgx"</code></li>
<li><code>"sim"</code></li>
<li><code>"macabi"</code></li>
</ul>
<div class="rule" id="r-cfg.target_abi"><a class="rule-link" href="#r-cfg.target_abi" title="cfg.target_abi"><span>[cfg<wbr>.target_abi]</span></a>
</div>

<h3 id="target_abi"><a class="header" href="#target_abi"><code>target_abi</code></a></h3>
<div class="rule" id="r-cfg.target_abi.general"><a class="rule-link" href="#r-cfg.target_abi.general" title="cfg.target_abi.general"><span>[cfg<wbr>.target_abi<wbr>.general]</span></a>
</div>

<p>键值选项，包含关于目标ABI的进一步区分信息。</p>
<div class="rule" id="r-cfg.target_abi.disambiguation"><a class="rule-link" href="#r-cfg.target_abi.disambiguation" title="cfg.target_abi.disambiguation"><span>[cfg<wbr>.target_abi<wbr>.disambiguation]</span></a>
</div>

<p>出于历史原因，此值仅在实际需要区分时才定义为非空字符串。因此，例如，在许多GNU平台上，此值将为空。</p>
<div class="rule" id="r-cfg.target_abi.values"><a class="rule-link" href="#r-cfg.target_abi.values" title="cfg.target_abi.values"><span>[cfg<wbr>.target_abi<wbr>.values]</span></a>
</div>

<p>示例值：</p>
<ul>
<li><code>""</code></li>
<li><code>"llvm"</code></li>
<li><code>"eabihf"</code></li>
<li><code>"abi64"</code></li>
</ul>
<div class="rule" id="r-cfg.target_endian"><a class="rule-link" href="#r-cfg.target_endian" title="cfg.target_endian"><span>[cfg<wbr>.target_endian]</span></a>
</div>

<h3 id="target_endian"><a class="header" href="#target_endian"><code>target_endian</code></a></h3>
<p>键值选项，根据目标CPU的字节序设置为<code>"little"</code>或<code>"big"</code>。</p>
<div class="rule" id="r-cfg.target_pointer_width"><a class="rule-link" href="#r-cfg.target_pointer_width" title="cfg.target_pointer_width"><span>[cfg<wbr>.target_pointer_width]</span></a>
</div>

<h3 id="target_pointer_width"><a class="header" href="#target_pointer_width"><code>target_pointer_width</code></a></h3>
<div class="rule" id="r-cfg.target_pointer_width.general"><a class="rule-link" href="#r-cfg.target_pointer_width.general" title="cfg.target_pointer_width.general"><span>[cfg<wbr>.target_pointer_width<wbr>.general]</span></a>
</div>

<p>键值选项，设置为目标指针宽度（以位为单位）一次。</p>
<div class="rule" id="r-cfg.target_pointer_width.values"><a class="rule-link" href="#r-cfg.target_pointer_width.values" title="cfg.target_pointer_width.values"><span>[cfg<wbr>.target_pointer_width<wbr>.values]</span></a>
</div>

<p>示例值：</p>
<ul>
<li><code>"16"</code></li>
<li><code>"32"</code></li>
<li><code>"64"</code></li>
</ul>
<div class="rule" id="r-cfg.target_vendor"><a class="rule-link" href="#r-cfg.target_vendor" title="cfg.target_vendor"><span>[cfg<wbr>.target_vendor]</span></a>
</div>

<h3 id="target_vendor"><a class="header" href="#target_vendor"><code>target_vendor</code></a></h3>
<div class="rule" id="r-cfg.target_vendor.general"><a class="rule-link" href="#r-cfg.target_vendor.general" title="cfg.target_vendor.general"><span>[cfg<wbr>.target_vendor<wbr>.general]</span></a>
</div>

<p>键值选项，设置为目标供应商一次。</p>
<div class="rule" id="r-cfg.target_vendor.values"><a class="rule-link" href="#r-cfg.target_vendor.values" title="cfg.target_vendor.values"><span>[cfg<wbr>.target_vendor<wbr>.values]</span></a>
</div>

<p>示例值：</p>
<ul>
<li><code>"apple"</code></li>
<li><code>"fortanix"</code></li>
<li><code>"pc"</code></li>
<li><code>"unknown"</code></li>
</ul>
<div class="rule" id="r-cfg.target_has_atomic"><a class="rule-link" href="#r-cfg.target_has_atomic" title="cfg.target_has_atomic"><span>[cfg<wbr>.target_has_atomic]</span></a>
</div>

<h3 id="target_has_atomic"><a class="header" href="#target_has_atomic"><code>target_has_atomic</code></a></h3>
<div class="rule" id="r-cfg.target_has_atomic.general"><a class="rule-link" href="#r-cfg.target_has_atomic.general" title="cfg.target_has_atomic.general"><span>[cfg<wbr>.target_has_atomic<wbr>.general]</span></a>
</div>

<p>键值选项，为目标支持原子加载、存储和比较并交换操作的每个位宽设置。</p>
<div class="rule" id="r-cfg.target_has_atomic.stdlib"><a class="rule-link" href="#r-cfg.target_has_atomic.stdlib" title="cfg.target_has_atomic.stdlib"><span>[cfg<wbr>.target_has_atomic<wbr>.stdlib]</span></a>
</div>

<p>当此cfg存在时，所有稳定的<a href="https://doc.rust-lang.org/core/sync/atomic/index.html"><code>core::sync::atomic</code></a>API都可用于相关的原子位宽。</p>
<div class="rule" id="r-cfg.target_has_atomic.values"><a class="rule-link" href="#r-cfg.target_has_atomic.values" title="cfg.target_has_atomic.values"><span>[cfg<wbr>.target_has_atomic<wbr>.values]</span></a>
</div>

<p>可能的值：</p>
<ul>
<li><code>"8"</code></li>
<li><code>"16"</code></li>
<li><code>"32"</code></li>
<li><code>"64"</code></li>
<li><code>"128"</code></li>
<li><code>"ptr"</code></li>
</ul>
<div class="rule" id="r-cfg.test"><a class="rule-link" href="#r-cfg.test" title="cfg.test"><span>[cfg<wbr>.test]</span></a>
</div>

<h3 id="test"><a class="header" href="#test"><code>test</code></a></h3>
<p>在编译测试harness时启用。通过<code>rustc</code>使用<a href="https://doc.rust-lang.org/rustc/command-line-arguments.html#--test-build-a-test-harness"><code>--test</code></a>标志来完成。有关测试支持的更多信息，请参见<a href="#测试属性">测试</a>。</p>
<div class="rule" id="r-cfg.debug_assertions"><a class="rule-link" href="#r-cfg.debug_assertions" title="cfg.debug_assertions"><span>[cfg<wbr>.debug_assertions]</span></a>
</div>

<h3 id="debug_assertions"><a class="header" href="#debug_assertions"><code>debug_assertions</code></a></h3>
<p>默认情况下在没有优化的情况下编译时启用。这可用于在开发中启用额外的调试代码，但在生产中不启用。例如，它控制标准库的<a href="https://doc.rust-lang.org/core/macro.debug_assert.html"><code>debug_assert!</code></a>宏的行为。</p>
<div class="rule" id="r-cfg.proc_macro"><a class="rule-link" href="#r-cfg.proc_macro" title="cfg.proc_macro"><span>[cfg<wbr>.proc_macro]</span></a>
</div>

<h3 id="proc_macro"><a class="header" href="#proc_macro"><code>proc_macro</code></a></h3>
<p>当被编译的crate使用<code>proc_macro</code> <a href="#链接">crate类型</a>编译时设置。</p>
<div class="rule" id="r-cfg.panic"><a class="rule-link" href="#r-cfg.panic" title="cfg.panic"><span>[cfg<wbr>.panic]</span></a>
</div>

<h3 id="panic"><a class="header" href="#panic"><code>panic</code></a></h3>
<div class="rule" id="r-cfg.panic.general"><a class="rule-link" href="#r-cfg.panic.general" title="cfg.panic.general"><span>[cfg<wbr>.panic<wbr>.general]</span></a>
</div>

<p>键值选项，根据<a href="#panic-strategy">恐慌策略</a>设置。请注意，将来可能会添加更多值。</p>
<div class="rule" id="r-cfg.panic.values"><a class="rule-link" href="#r-cfg.panic.values" title="cfg.panic.values"><span>[cfg<wbr>.panic<wbr>.values]</span></a>
</div>

<p>示例值：</p>
<ul>
<li><code>"abort"</code></li>
<li><code>"unwind"</code></li>
</ul>
<h2 id="条件编译的形式"><a class="header" href="#条件编译的形式">条件编译的形式</a></h2>
<!-- template:attributes -->
<div class="rule" id="r-cfg.attr"><a class="rule-link" href="#r-cfg.attr" title="cfg.attr"><span>[cfg<wbr>.attr]</span></a>
</div>

<h3 id="cfg属性"><a class="header" href="#cfg属性"><code>cfg</code>属性</a></h3>
<div class="rule" id="r-cfg.attr.intro"><a class="rule-link" href="#r-cfg.attr.intro" title="cfg.attr.intro"><span>[cfg<wbr>.attr<wbr>.intro]</span></a>
</div>

<p><em><code>cfg</code><a href="#属性-1">属性</a></em> 根据配置断言有条件地包含其所附加的形式。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 该函数只在为 macOS 编译时才会被包含在构建中
#[cfg(target_os = "macos")]
fn macos_only() {
  // ...
}

// 该函数只在 foo 或 bar 被定义时才会被包含
#[cfg(any(foo, bar))]
fn needs_foo_or_bar() {
  // ...
}

// 该函数只在为 32 位架构的类 Unix 操作系统编译时才会被包含
#[cfg(all(unix, target_pointer_width = "32"))]
fn on_32bit_unix() {
  // ...
}

// 该函数只在 foo 未定义时才会被包含
#[cfg(not(foo))]
fn needs_not_foo() {
  // ...
}

// 该函数只在恐慌策略设置为 unwound 时才会被包含
#[cfg(panic = "unwind")]
fn when_unwinding() {
  // ...
}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-cfg.attr.syntax"><a class="rule-link" href="#r-cfg.attr.syntax" title="cfg.attr.syntax"><span>[cfg<wbr>.attr<wbr>.syntax]</span></a>
</div>

<p><code>cfg</code>属性的语法是：</p>
<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-CfgAttribute" onclick="show_railroad()"><a href="#railroad-CfgAttribute">CfgAttribute</a></span> → <span class="grammar-literal">cfg</span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-ConfigurationPredicate">ConfigurationPredicate</a></span> <span class="grammar-literal">)</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 404px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-CfgAttribute"><svg class="railroad" viewbox="0 0 404 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-CfgAttribute">
<text class="comment" x="57" y="25">
CfgAttribute</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="42" />
<text x="57" y="58">
cfg</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="89" y="42" />
<text x="103" y="58">
(</text>
</g>
<a class="link" xlink:href="#railroad-ConfigurationPredicate">
<g class="nonterminal">
<rect height="22" width="204" x="127" y="42" />
<text x="229" y="58">
ConfigurationPredicate</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="341" y="42" />
<text x="355" y="58">
)</text>
</g>
<path d=" M 79 53 h 10" />
<path d=" M 117 53 h 10" />
<path d=" M 331 53 h 10" />
</g>
<path d=" M 379 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 369 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-cfg.attr.allowed-positions"><a class="rule-link" href="#r-cfg.attr.allowed-positions" title="cfg.attr.allowed-positions"><span>[cfg<wbr>.attr<wbr>.allowed-positions]</span></a>
</div>

<p><code>cfg</code>属性可以在允许属性的任何地方使用。</p>
<div class="rule" id="r-cfg.attr.duplicates"><a class="rule-link" href="#r-cfg.attr.duplicates" title="cfg.attr.duplicates"><span>[cfg<wbr>.attr<wbr>.duplicates]</span></a>
</div>

<p><code>cfg</code>属性可以用于一个形式任意多次。如果任何<code>cfg</code>断言为假，则附加了这些属性的形式将不会被包含，<a href="#r-cfg.attr.crate-level-attrs">cfg.attr.crate-level-attrs</a>中描述的情况除外。</p>
<div class="rule" id="r-cfg.attr.effect"><a class="rule-link" href="#r-cfg.attr.effect" title="cfg.attr.effect"><span>[cfg<wbr>.attr<wbr>.effect]</span></a>
</div>

<p>如果断言为真，则该形式将被重写为不带<code>cfg</code>属性。如果任何断言为假，则该形式将从源代码中删除。</p>
<div class="rule" id="r-cfg.attr.crate-level-attrs"><a class="rule-link" href="#r-cfg.attr.crate-level-attrs" title="cfg.attr.crate-level-attrs"><span>[cfg<wbr>.attr<wbr>.crate-level-attrs]</span></a>
</div>

<p>当crate级别的<code>cfg</code>有一个假断言时，crate本身仍然存在。任何在<code>cfg</code>之前的crate属性会被保留，而任何在<code>cfg</code>之后的crate属性以及所有后续的crate内容都会被移除。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>不移除前面属性的行为允许您执行诸如包含<code>#![no_std]</code>以避免链接<code>std</code>之类的操作，即使<code>#![cfg(...)]</code>已经移除了crate的内容。例如：</p>
<!-- ignore: test infrastructure can't handle no_std -->
<pre><code class="language-rust ignore">// 即使 crate 级别的 `cfg` 属性为 false，此 `no_std` 属性也会被保留。
#![no_std]
#![cfg(false)]

// 该函数未被包含。
pub fn example() {}</code></pre>
</blockquote>
</div>

<!-- template:attributes -->
<div class="rule" id="r-cfg.cfg_attr"><a class="rule-link" href="#r-cfg.cfg_attr" title="cfg.cfg_attr"><span>[cfg<wbr>.cfg_attr]</span></a>
</div>

<h3 id="cfg_attr属性"><a class="header" href="#cfg_attr属性"><code>cfg_attr</code>属性</a></h3>
<div class="rule" id="r-cfg.cfg_attr.intro"><a class="rule-link" href="#r-cfg.cfg_attr.intro" title="cfg.cfg_attr.intro"><span>[cfg<wbr>.cfg_attr<wbr>.intro]</span></a>
</div>

<p><em><code>cfg_attr</code><a href="#属性-1">属性</a></em> 根据配置断言有条件地包含属性。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>以下模块将根据目标平台，位于<code>linux.rs</code>或<code>windows.rs</code>。</p>
<!-- ignore: `mod` needs multiple files -->
<pre><code class="language-rust ignore">#[cfg_attr(target_os = "linux", path = "linux.rs")]
#[cfg_attr(windows, path = "windows.rs")]
mod os;</code></pre>
</blockquote>
</div>

<div class="rule" id="r-cfg.cfg_attr.syntax"><a class="rule-link" href="#r-cfg.cfg_attr.syntax" title="cfg.cfg_attr.syntax"><span>[cfg<wbr>.cfg_attr<wbr>.syntax]</span></a>
</div>

<p><code>cfg_attr</code>属性的语法是：</p>
<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-CfgAttrAttribute" onclick="show_railroad()"><a href="#railroad-CfgAttrAttribute">CfgAttrAttribute</a></span> → <span class="grammar-literal">cfg_attr</span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-ConfigurationPredicate">ConfigurationPredicate</a></span> <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-CfgAttrs">CfgAttrs</a></span><sup>?</sup> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-CfgAttrs" onclick="show_railroad()"><a href="#railroad-CfgAttrs">CfgAttrs</a></span> → <span class="grammar-text"><a href="#grammar-Attr">Attr</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-Attr">Attr</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 624px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-CfgAttrAttribute"><svg class="railroad" viewbox="0 0 624 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-CfgAttrAttribute">
<text class="comment" x="71" y="25">
CfgAttrAttribute</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="84" x="35" y="55" />
<text x="77" y="71">
cfg_attr</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="129" y="55" />
<text x="143" y="71">
(</text>
</g>
<a class="link" xlink:href="#railroad-ConfigurationPredicate">
<g class="nonterminal">
<rect height="22" width="204" x="167" y="55" />
<text x="269" y="71">
ConfigurationPredicate</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="381" y="55" />
<text x="395" y="71">
,</text>
</g>
<g class="optional">
<path d=" M 419 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 84 m -39 0 l -5 -5 m 0 10 l 5 -5 m 39 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-CfgAttrs">
<g class="nonterminal">
<rect height="22" width="84" x="443" y="55" />
<text x="485" y="71">
CfgAttrs</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="561" y="55" />
<text x="575" y="71">
)</text>
</g>
<path d=" M 119 66 h 10" />
<path d=" M 157 66 h 10" />
<path d=" M 371 66 h 10" />
<path d=" M 409 66 h 10" />
<path d=" M 551 66 h 10" />
</g>
<path d=" M 599 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 589 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 380px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-CfgAttrs"><svg class="railroad" viewbox="0 0 380 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-CfgAttrs">
<text class="comment" x="43" y="25">
CfgAttrs</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Attr">
<g class="nonterminal">
<rect height="22" width="52" x="35" y="55" />
<text x="61" y="71">
Attr</text>
</g>
</a>
<g class="optional">
<path d=" M 97 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 114 m -54 0 l -5 -5 m 0 10 l 5 -5 m 54 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 121 66 h 12 m 90 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -90 m 48 0 l 5 -5 m 0 10 l -5 -5 m -48 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="133" y="55" />
<text x="147" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-Attr">
<g class="nonterminal">
<rect height="22" width="52" x="171" y="55" />
<text x="197" y="71">
Attr</text>
</g>
</a>
<path d=" M 161 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 269 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="293" y="55" />
<text x="307" y="71">
,</text>
</g>
</g>
<path d=" M 87 66 h 10" />
<path d=" M 259 66 h 10" />
</g>
<path d=" M 355 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 345 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-cfg.cfg_attr.allowed-positions"><a class="rule-link" href="#r-cfg.cfg_attr.allowed-positions" title="cfg.cfg_attr.allowed-positions"><span>[cfg<wbr>.cfg_attr<wbr>.allowed-positions]</span></a>
</div>

<p><code>cfg_attr</code>属性可以在允许属性的任何地方使用。</p>
<div class="rule" id="r-cfg.cfg_attr.duplicates"><a class="rule-link" href="#r-cfg.cfg_attr.duplicates" title="cfg.cfg_attr.duplicates"><span>[cfg<wbr>.cfg_attr<wbr>.duplicates]</span></a>
</div>

<p><code>cfg_attr</code>属性可以用于一个形式任意多次。</p>
<div class="rule" id="r-cfg.cfg_attr.attr-restriction"><a class="rule-link" href="#r-cfg.cfg_attr.attr-restriction" title="cfg.cfg_attr.attr-restriction"><span>[cfg<wbr>.cfg_attr<wbr>.attr-restriction]</span></a>
</div>

<p><a href="#链接"><code>crate_type</code></a>和<a href="#crate_name属性"><code>crate_name</code></a>属性不能与<code>cfg_attr</code>一起使用。</p>
<div class="rule" id="r-cfg.cfg_attr.behavior"><a class="rule-link" href="#r-cfg.cfg_attr.behavior" title="cfg.cfg_attr.behavior"><span>[cfg<wbr>.cfg_attr<wbr>.behavior]</span></a>
</div>

<p>当配置断言为真时，<code>cfg_attr</code>会展开为断言后列出的属性。</p>
<div class="rule" id="r-cfg.cfg_attr.attribute-list"><a class="rule-link" href="#r-cfg.cfg_attr.attribute-list" title="cfg.cfg_attr.attribute-list"><span>[cfg<wbr>.cfg_attr<wbr>.attribute-list]</span></a>
</div>

<p>可以列出零个、一个或多个属性。多个属性将分别展开为单独的属性。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<!-- ignore: fake attributes -->
<pre><code class="language-rust ignore">#[cfg_attr(feature = "magic", sparkles, crackles)]
fn bewitched() {}

// 当`magic`特性标志被启用时，上面代码将展开为：
#[sparkles]
#[crackles]
fn bewitched() {}</code></pre>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>cfg_attr</code>可以展开为另一个<code>cfg_attr</code>。例如，<code>#[cfg_attr(target_os = "linux", cfg_attr(feature = "multithreaded", some_other_attribute))]</code>是有效的。这个例子等同于<code>#[cfg_attr(all(target_os = "linux", feature = "multithreaded"), some_other_attribute)]</code>。</p>
</blockquote>
</div>

<div class="rule" id="r-cfg.macro"><a class="rule-link" href="#r-cfg.macro" title="cfg.macro"><span>[cfg<wbr>.macro]</span></a>
</div>

<h3 id="cfg宏"><a class="header" href="#cfg宏"><code>cfg!宏</code></a></h3>
<p>内置的<code>cfg!宏</code>接受一个配置断言，并在断言为真时求值为<code>true</code>字面量，在断言为假时求值为<code>false</code>字面量。</p>
<p>例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let machine_kind = if cfg!(unix) {
  "unix"
} else if cfg!(windows) {
  "windows"
} else {
  "unknown"
};

println!("I'm running on a {} machine!", machine_kind);
<span class="boring">}</span></code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-items"><a class="rule-link" href="#r-items" title="items"><span>[items]</span></a>
</div>

<h1 id="项"><a class="header" href="#项">项</a></h1>
<div class="rule" id="r-items.syntax"><a class="rule-link" href="#r-items.syntax" title="items.syntax"><span>[items<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-Item" onclick="show_railroad()"><a href="#railroad-Item">Item</a></span> → <br>    <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> ( <span class="grammar-text"><a href="#grammar-VisItem">VisItem</a></span> | <span class="grammar-text"><a href="#grammar-MacroItem">MacroItem</a></span> )</p>
<p><span class="grammar-text grammar-production" id="grammar-VisItem" onclick="show_railroad()"><a href="#railroad-VisItem">VisItem</a></span> → <br>    <span class="grammar-text"><a href="#grammar-Visibility">Visibility</a></span><sup>?</sup> <br>    ( <br>        <span class="grammar-text"><a href="#grammar-Module">Module</a></span> <br>      | <span class="grammar-text"><a href="#grammar-ExternCrate">ExternCrate</a></span> <br>      | <span class="grammar-text"><a href="#grammar-UseDeclaration">UseDeclaration</a></span> <br>      | <span class="grammar-text"><a href="#grammar-Function">Function</a></span> <br>      | <span class="grammar-text"><a href="#grammar-TypeAlias">TypeAlias</a></span> <br>      | <span class="grammar-text"><a href="#grammar-Struct">Struct</a></span> <br>      | <span class="grammar-text"><a href="#grammar-Enumeration">Enumeration</a></span> <br>      | <span class="grammar-text"><a href="#grammar-Union">Union</a></span> <br>      | <span class="grammar-text"><a href="#grammar-ConstantItem">ConstantItem</a></span> <br>      | <span class="grammar-text"><a href="#grammar-StaticItem">StaticItem</a></span> <br>      | <span class="grammar-text"><a href="#grammar-Trait">Trait</a></span> <br>      | <span class="grammar-text"><a href="#grammar-Implementation">Implementation</a></span> <br>      | <span class="grammar-text"><a href="#grammar-ExternBlock">ExternBlock</a></span> <br>    )</p>
<p><span class="grammar-text grammar-production" id="grammar-MacroItem" onclick="show_railroad()"><a href="#railroad-MacroItem">MacroItem</a></span> → <br>      <span class="grammar-text"><a href="#grammar-MacroInvocationSemi">MacroInvocationSemi</a></span> <br>    | <span class="grammar-text"><a href="#grammar-MacroRulesDefinition">MacroRulesDefinition</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 424px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Item"><svg class="railroad" viewbox="0 0 424 120" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Item">
<text class="comment" x="29" y="25">
Item</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<g class="choice">
<path d=" M 249 66 h 24 m 76 0 h 40" />
<a class="link" xlink:href="#railroad-VisItem">
<g class="nonterminal">
<rect height="22" width="76" x="273" y="55" />
<text x="311" y="71">
VisItem</text>
</g>
</a>
<path d=" M 249 66 a 12 12 0 0 1 12 12 v 9 m 116 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 261 87 v 0 a 12 12 0 0 0 12 12 m 92 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-MacroItem">
<g class="nonterminal">
<rect height="22" width="92" x="273" y="88" />
<text x="319" y="104">
MacroItem</text>
</g>
</a>
</g>
<path d=" M 239 66 h 10" />
</g>
<path d=" M 399 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 389 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 408px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-VisItem"><svg class="railroad" viewbox="0 0 408 483" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-VisItem">
<text class="comment" x="39" y="25">
VisItem</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-Visibility">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="55" />
<text x="109" y="71">
Visibility</text>
</g>
</a>
</g>
<g class="choice">
<path d=" M 193 66 h 24 m 68 0 h 88 m -41 0 l -5 -5 m 0 10 l 5 -5 m 41 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Module">
<g class="nonterminal">
<rect height="22" width="68" x="217" y="55" />
<text x="251" y="71">
Module</text>
</g>
</a>
</g>
<path d=" M 193 66 a 12 12 0 0 1 12 12 v 9 m 156 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 205 87 v 33 m 156 0 v -33" />
<path d=" M 205 120 v 33 m 156 0 v -33" />
<path d=" M 205 153 v 33 m 156 0 v -33" />
<path d=" M 205 186 v 33 m 156 0 v -33" />
<path d=" M 205 219 v 33 m 156 0 v -33" />
<path d=" M 205 252 v 33 m 156 0 v -33" />
<path d=" M 205 285 v 33 m 156 0 v -33" />
<path d=" M 205 318 v 33 m 156 0 v -33" />
<path d=" M 205 351 v 33 m 156 0 v -33" />
<path d=" M 205 384 v 33 m 156 0 v -33" />
<path d=" M 205 417 v 33 m 156 0 v -33" />
<path d=" M 205 87 v 0 a 12 12 0 0 0 12 12 m 108 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ExternCrate">
<g class="nonterminal">
<rect height="22" width="108" x="217" y="88" />
<text x="271" y="104">
ExternCrate</text>
</g>
</a>
</g>
<path d=" M 205 120 v 0 a 12 12 0 0 0 12 12 m 132 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-UseDeclaration">
<g class="nonterminal">
<rect height="22" width="132" x="217" y="121" />
<text x="283" y="137">
UseDeclaration</text>
</g>
</a>
</g>
<path d=" M 205 153 v 0 a 12 12 0 0 0 12 12 m 84 0 h 48 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Function">
<g class="nonterminal">
<rect height="22" width="84" x="217" y="154" />
<text x="259" y="170">
Function</text>
</g>
</a>
</g>
<path d=" M 205 186 v 0 a 12 12 0 0 0 12 12 m 92 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-TypeAlias">
<g class="nonterminal">
<rect height="22" width="92" x="217" y="187" />
<text x="263" y="203">
TypeAlias</text>
</g>
</a>
</g>
<path d=" M 205 219 v 0 a 12 12 0 0 0 12 12 m 68 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Struct">
<g class="nonterminal">
<rect height="22" width="68" x="217" y="220" />
<text x="251" y="236">
Struct</text>
</g>
</a>
</g>
<path d=" M 205 252 v 0 a 12 12 0 0 0 12 12 m 108 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Enumeration">
<g class="nonterminal">
<rect height="22" width="108" x="217" y="253" />
<text x="271" y="269">
Enumeration</text>
</g>
</a>
</g>
<path d=" M 205 285 v 0 a 12 12 0 0 0 12 12 m 60 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Union">
<g class="nonterminal">
<rect height="22" width="60" x="217" y="286" />
<text x="247" y="302">
Union</text>
</g>
</a>
</g>
<path d=" M 205 318 v 0 a 12 12 0 0 0 12 12 m 116 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ConstantItem">
<g class="nonterminal">
<rect height="22" width="116" x="217" y="319" />
<text x="275" y="335">
ConstantItem</text>
</g>
</a>
</g>
<path d=" M 205 351 v 0 a 12 12 0 0 0 12 12 m 100 0 h 32 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-StaticItem">
<g class="nonterminal">
<rect height="22" width="100" x="217" y="352" />
<text x="267" y="368">
StaticItem</text>
</g>
</a>
</g>
<path d=" M 205 384 v 0 a 12 12 0 0 0 12 12 m 60 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Trait">
<g class="nonterminal">
<rect height="22" width="60" x="217" y="385" />
<text x="247" y="401">
Trait</text>
</g>
</a>
</g>
<path d=" M 205 417 v 0 a 12 12 0 0 0 12 12 m 132 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Implementation">
<g class="nonterminal">
<rect height="22" width="132" x="217" y="418" />
<text x="283" y="434">
Implementation</text>
</g>
</a>
</g>
<path d=" M 205 450 v 0 a 12 12 0 0 0 12 12 m 108 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ExternBlock">
<g class="nonterminal">
<rect height="22" width="108" x="217" y="451" />
<text x="271" y="467">
ExternBlock</text>
</g>
</a>
</g>
</g>
<path d=" M 183 66 h 10" />
</g>
<path d=" M 383 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 373 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 306px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroItem"><svg class="railroad" viewbox="0 0 306 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MacroItem">
<text class="comment" x="46" y="25">
MacroItem</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 172 0 h 40" />
<g class="sequence">
<a class="link" xlink:href="#railroad-MacroInvocationSemi">
<g class="nonterminal">
<rect height="22" width="172" x="59" y="42" />
<text x="145" y="58">
MacroInvocationSemi</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 212 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 188 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-MacroRulesDefinition">
<g class="nonterminal">
<rect height="22" width="188" x="59" y="75" />
<text x="153" y="91">
MacroRulesDefinition</text>
</g>
</a>
</g>
<path d=" M 281 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 271 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-items.intro"><a class="rule-link" href="#r-items.intro" title="items.intro"><span>[items<wbr>.intro]</span></a>
</div>

<p>一个 <em>项</em> 是 crate 的一个组件。 项 在 crate 中通过一组嵌套的 <a href="#模块">模块</a> 来组织。每个 crate 都有一个唯一的“最外层”匿名模块；crate 内的所有后续 项 在 crate 的模块树中都有 <a href="#路径">路径</a>。</p>
<div class="rule" id="r-items.static-def"><a class="rule-link" href="#r-items.static-def" title="items.static-def"><span>[items<wbr>.static-def]</span></a>
</div>

<p>项 完全在编译时确定，通常在执行期间保持固定，并可能驻留在只读内存中。</p>
<div class="rule" id="r-items.kinds"><a class="rule-link" href="#r-items.kinds" title="items.kinds"><span>[items<wbr>.kinds]</span></a>
</div>

<p>有几种类型的 项 ：</p>
<ul>
<li><a href="#模块">模块</a></li>
<li><a href="#extern-crate-声明"><code>extern crate</code> 声明</a></li>
<li><a href="#use声明"><code>use</code> 声明</a></li>
<li><a href="#函数">函数定义</a></li>
<li><a href="#类型别名">类型别名定义</a></li>
<li><a href="#结构体">结构体定义</a></li>
<li><a href="#枚举">枚举定义</a></li>
<li><a href="#联合体">联合体定义</a></li>
<li><a href="#常量项">常量项</a></li>
<li><a href="#静态项">静态项</a></li>
<li><a href="#特型">特型定义</a></li>
<li><a href="#实现">实现</a></li>
<li><a href="#外部块"><code>extern</code> 块</a></li>
</ul>
<div class="rule" id="r-items.locations"><a class="rule-link" href="#r-items.locations" title="items.locations"><span>[items<wbr>.locations]</span></a>
</div>

<p>项 可以在 <a href="#crate与源文件">crate 根部</a>、<a href="#模块">模块</a> 或 <a href="#块表达式">块表达式</a> 中声明。</p>
<div class="rule" id="r-items.associated-locations"><a class="rule-link" href="#r-items.associated-locations" title="items.associated-locations"><span>[items<wbr>.associated-locations]</span></a>
</div>

<p>项 的一个子集，称为 <a href="#关联项">关联项</a>，可以在 <a href="#特型">特型</a> 和 <a href="#实现">实现</a> 中声明。</p>
<div class="rule" id="r-items.extern-locations"><a class="rule-link" href="#r-items.extern-locations" title="items.extern-locations"><span>[items<wbr>.extern-locations]</span></a>
</div>

<p>项 的一个子集，称为外部项，可以在 <a href="#外部块"><code>extern</code> 块</a> 中声明。</p>
<div class="rule" id="r-items.decl-order"><a class="rule-link" href="#r-items.decl-order" title="items.decl-order"><span>[items<wbr>.decl-order]</span></a>
</div>

<p>项 可以按任何顺序定义，唯一的例外是 <a href="#声明宏"><code>macro_rules</code></a>，它有自己的作用域行为。</p>
<div class="rule" id="r-items.name-resolution"><a class="rule-link" href="#r-items.name-resolution" title="items.name-resolution"><span>[items<wbr>.name-resolution]</span></a>
</div>

<p>项 名称的 <a href="#名称解析">名称解析</a> 允许在模块或块中引用该 项 的位置之前或之后定义它。</p>
<p>有关 项 的作用域规则，请参见 <a href="#item-scopes">项作用域</a>。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-items.mod"><a class="rule-link" href="#r-items.mod" title="items.mod"><span>[items<wbr>.mod]</span></a>
</div>

<h1 id="模块"><a class="header" href="#模块">模块</a></h1>
<div class="rule" id="r-items.mod.syntax"><a class="rule-link" href="#r-items.mod.syntax" title="items.mod.syntax"><span>[items<wbr>.mod<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-Module" onclick="show_railroad()"><a href="#railroad-Module">Module</a></span> → <br>      <span class="grammar-literal">unsafe</span><sup>?</sup> <span class="grammar-literal">mod</span> <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-literal">;</span> <br>    | <span class="grammar-literal">unsafe</span><sup>?</sup> <span class="grammar-literal">mod</span> <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-literal">{</span> <br>        <span class="grammar-text"><a href="#grammar-InnerAttribute">InnerAttribute</a></span><sup>*</sup> <br>        <span class="grammar-text"><a href="#grammar-Item">Item</a></span><sup>*</sup> <br>      <span class="grammar-literal">}</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 822px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Module"><svg class="railroad" viewbox="0 0 822 145" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Module">
<text class="comment" x="36" y="25">
Module</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 66 h 24 m 318 0 h 410 m -202 0 l -5 -5 m 0 10 l 5 -5 m 202 0" />
<g class="sequence">
<g class="optional">
<path d=" M 59 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 68 m -31 0 l -5 -5 m 0 10 l 5 -5 m 31 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="83" y="55" />
<text x="117" y="71">
unsafe</text>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="185" y="55" />
<text x="207" y="71">
mod</text>
</g>
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="239" y="55" />
<text x="289" y="71">
IDENTIFIER</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="349" y="55" />
<text x="363" y="71">
;</text>
</g>
<path d=" M 175 66 h 10" />
<path d=" M 229 66 h 10" />
<path d=" M 339 66 h 10" />
</g>
<path d=" M 35 66 a 12 12 0 0 1 12 12 v 9 m 728 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 87 v 12 a 12 12 0 0 0 12 12 m 704 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="optional">
<path d=" M 59 111 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 68 m -31 0 l -5 -5 m 0 10 l 5 -5 m 31 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="83" y="100" />
<text x="117" y="116">
unsafe</text>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="185" y="100" />
<text x="207" y="116">
mod</text>
</g>
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="239" y="100" />
<text x="289" y="116">
IDENTIFIER</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="349" y="100" />
<text x="363" y="116">
{</text>
</g>
<g class="optional">
<path d=" M 387 111 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 411 111 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-InnerAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="423" y="100" />
<text x="489" y="116">
InnerAttribute</text>
</g>
</a>
</g>
</g>
<g class="optional">
<path d=" M 601 111 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 76 m -35 0 l -5 -5 m 0 10 l 5 -5 m 35 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 625 111 h 12 m 52 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -52 m 29 0 l 5 -5 m 0 10 l -5 -5 m -29 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-Item">
<g class="nonterminal">
<rect height="22" width="52" x="637" y="100" />
<text x="663" y="116">
Item</text>
</g>
</a>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="735" y="100" />
<text x="749" y="116">
}</text>
</g>
<path d=" M 175 111 h 10" />
<path d=" M 229 111 h 10" />
<path d=" M 339 111 h 10" />
<path d=" M 377 111 h 10" />
<path d=" M 591 111 h 10" />
<path d=" M 725 111 h 10" />
</g>
</g>
<path d=" M 797 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 787 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-items.mod.intro"><a class="rule-link" href="#r-items.mod.intro" title="items.mod.intro"><span>[items<wbr>.mod<wbr>.intro]</span></a>
</div>

<p>模块是零个或多个 <a href="#项">项</a> 的容器。</p>
<div class="rule" id="r-items.mod.def"><a class="rule-link" href="#r-items.mod.def" title="items.mod.def"><span>[items<wbr>.mod<wbr>.def]</span></a>
</div>

<p>一个  <em>模块项 (module item)</em>  是一个模块，由大括号包围、命名，并以前缀关键字 <code>mod</code> 开头。 模块项 向构成 crate 的模块树中引入一个新的、具名的模块。</p>
<div class="rule" id="r-items.mod.nesting"><a class="rule-link" href="#r-items.mod.nesting" title="items.mod.nesting"><span>[items<wbr>.mod<wbr>.nesting]</span></a>
</div>

<p>模块可以任意嵌套。</p>
<p>一个模块示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>mod math {
    type Complex = (f64, f64);
    fn sin(f: f64) -&gt; f64 {
        /* ... */
<span class="boring">      unimplemented!();
</span>    }
    fn cos(f: f64) -&gt; f64 {
        /* ... */
<span class="boring">      unimplemented!();
</span>    }
    fn tan(f: f64) -&gt; f64 {
        /* ... */
<span class="boring">      unimplemented!();
</span>    }
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.mod.namespace"><a class="rule-link" href="#r-items.mod.namespace" title="items.mod.namespace"><span>[items<wbr>.mod<wbr>.namespace]</span></a>
</div>

<p>模块定义在其所在的模块或块的 <a href="#命名空间">类型命名空间</a> 中。</p>
<div class="rule" id="r-items.mod.multiple-items"><a class="rule-link" href="#r-items.mod.multiple-items" title="items.mod.multiple-items"><span>[items<wbr>.mod<wbr>.multiple-items]</span></a>
</div>

<p>在模块内的同一命名空间中定义多个同名 项 是错误的。有关限制和遮蔽行为的更多细节，请参阅 <a href="#作用域">作用域章节</a>。</p>
<div class="rule" id="r-items.mod.unsafe"><a class="rule-link" href="#r-items.mod.unsafe" title="items.mod.unsafe"><span>[items<wbr>.mod<wbr>.unsafe]</span></a>
</div>

<p><code>unsafe</code> 关键字在语法上允许出现在 <code>mod</code> 关键字之前，但在语义层面会被拒绝。这允许宏消费该语法并利用 <code>unsafe</code> 关键字，然后将其从 词法单元 流中移除。</p>
<div class="rule" id="r-items.mod.outlined"><a class="rule-link" href="#r-items.mod.outlined" title="items.mod.outlined"><span>[items<wbr>.mod<wbr>.outlined]</span></a>
</div>

<h2 id="外部源文件模块"><a class="header" href="#外部源文件模块">外部源文件模块</a></h2>
<div class="rule" id="r-items.mod.outlined.intro"><a class="rule-link" href="#r-items.mod.outlined.intro" title="items.mod.outlined.intro"><span>[items<wbr>.mod<wbr>.outlined<wbr>.intro]</span></a>
</div>

<p>不带主体的模块从外部文件加载。当模块没有 <code>path</code> 属性时，文件的路径反映了逻辑 <a href="#路径">模块路径</a>。</p>
<div class="rule" id="r-items.mod.outlined.search"><a class="rule-link" href="#r-items.mod.outlined.search" title="items.mod.outlined.search"><span>[items<wbr>.mod<wbr>.outlined<wbr>.search]</span></a>
</div>

<p>祖先模块路径组件是目录，而模块的内容位于一个文件名与模块名相同并带有 <code>.rs</code> 扩展名的文件中。例如，以下模块结构可以具有对应如下的文件系统结构：</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>模块路径</th><th>文件系统路径</th><th>文件内容</th></tr>
</thead>
<tbody>
<tr><td><code>crate</code></td><td><code>lib.rs</code></td><td><code>mod util;</code></td></tr>
<tr><td><code>crate::util</code></td><td><code>util.rs</code></td><td><code>mod config;</code></td></tr>
<tr><td><code>crate::util::config</code></td><td><code>util/config.rs</code></td><td></td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-items.mod.outlined.search-mod"><a class="rule-link" href="#r-items.mod.outlined.search-mod" title="items.mod.outlined.search-mod"><span>[items<wbr>.mod<wbr>.outlined<wbr>.search-mod]</span></a>
</div>

<p>模块文件名也可以是以模块命名的目录，其内容位于该目录内名为 <code>mod.rs</code> 的文件中。上述示例也可以交替表示为将 <code>crate::util</code> 的内容放在名为 <code>util/mod.rs</code> 的文件中。不允许同时存在 <code>util.rs</code> 和 <code>util/mod.rs</code>。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>在 <code>rustc</code> 1.30 之前，使用 <code>mod.rs</code> 文件是加载带有嵌套子项模块的唯一方式。鼓励使用新的命名约定，因为它更一致，并能避免在项目中出现许多名为 <code>mod.rs</code> 的文件。</p>
</blockquote>
</div>

<div class="rule" id="r-items.mod.outlined.path"><a class="rule-link" href="#r-items.mod.outlined.path" title="items.mod.outlined.path"><span>[items<wbr>.mod<wbr>.outlined<wbr>.path]</span></a>
</div>

<h3 id="path属性"><a class="header" href="#path属性"><code>path</code>属性</a></h3>
<div class="rule" id="r-items.mod.outlined.path.intro"><a class="rule-link" href="#r-items.mod.outlined.path.intro" title="items.mod.outlined.path.intro"><span>[items<wbr>.mod<wbr>.outlined<wbr>.path<wbr>.intro]</span></a>
</div>

<p>用于加载外部文件模块的目录和文件可以通过 <code>path</code> 属性来影响。</p>
<div class="rule" id="r-items.mod.outlined.path.search"><a class="rule-link" href="#r-items.mod.outlined.path.search" title="items.mod.outlined.path.search"><span>[items<wbr>.mod<wbr>.outlined<wbr>.path<wbr>.search]</span></a>
</div>

<p>对于不在内联模块块内部的模块上的 <code>path</code> 属性，文件路径相对于源文件所在的目录。例如，以下代码片段将根据其所在位置使用显示的路径：</p>
<!-- ignore: requires external files -->
<pre><code class="language-rust ignore">#[path = "foo.rs"]
mod c;</code></pre>
<div class="table-wrapper">
<table>
<thead>
<tr><th>源文件</th><th><code>c</code> 的文件位置</th><th><code>c</code> 的模块路径</th></tr>
</thead>
<tbody>
<tr><td><code>src/a/b.rs</code></td><td><code>src/a/foo.rs</code></td><td><code>crate::a::b::c</code></td></tr>
<tr><td><code>src/a/mod.rs</code></td><td><code>src/a/foo.rs</code></td><td><code>crate::a::c</code></td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-items.mod.outlined.path.search-nested"><a class="rule-link" href="#r-items.mod.outlined.path.search-nested" title="items.mod.outlined.path.search-nested"><span>[items<wbr>.mod<wbr>.outlined<wbr>.path<wbr>.search-nested]</span></a>
</div>

<p>对于内联模块块内部的 <code>path</code> 属性，文件路径的相对位置取决于 <code>path</code> 属性所在的源文件类型。“mod-rs” 源文件是根模块（如 <code>lib.rs</code> 或 <code>main.rs</code>）和文件名为 <code>mod.rs</code> 的模块。“non-mod-rs” 源文件是所有其它模块文件。位于 mod-rs 文件中内联模块块内部的 <code>path</code> 属性的路径相对于 mod-rs 文件所在的目录，其中包含作为目录的内联模块组件。对于 non-mod-rs 文件，情况相同，不同之处在于路径起始于一个以 non-mod-rs 模块命名的目录。例如，以下代码片段将根据其所在位置使用显示的路径：</p>
<!-- ignore: requires external files -->
<pre><code class="language-rust ignore">mod inline {
    #[path = "other.rs"]
    mod inner;
}</code></pre>
<div class="table-wrapper">
<table>
<thead>
<tr><th>源文件</th><th><code>inner</code> 的文件位置</th><th><code>inner</code> 的模块路径</th></tr>
</thead>
<tbody>
<tr><td><code>src/a/b.rs</code></td><td><code>src/a/b/inline/other.rs</code></td><td><code>crate::a::b::inline::inner</code></td></tr>
<tr><td><code>src/a/mod.rs</code></td><td><code>src/a/inline/other.rs</code></td><td><code>crate::a::inline::inner</code></td></tr>
</tbody>
</table>
</div>
<p>结合上述关于内联模块及其内部嵌套模块的 <code>path</code> 属性规则的示例（适用于 mod-rs 和 non-mod-rs 文件）：</p>
<!-- ignore: requires external files -->
<pre><code class="language-rust ignore">#[path = "thread_files"]
mod thread {
    // 相对于此源文件的目录，从 `thread_files/tls.rs` 加载 `local_data` 模块。
    #[path = "tls.rs"]
    mod local_data;
}</code></pre>
<div class="rule" id="r-items.mod.attributes"><a class="rule-link" href="#r-items.mod.attributes" title="items.mod.attributes"><span>[items<wbr>.mod<wbr>.attributes]</span></a>
</div>

<h2 id="模块上的属性"><a class="header" href="#模块上的属性">模块上的属性</a></h2>
<div class="rule" id="r-items.mod.attributes.intro"><a class="rule-link" href="#r-items.mod.attributes.intro" title="items.mod.attributes.intro"><span>[items<wbr>.mod<wbr>.attributes<wbr>.intro]</span></a>
</div>

<p>模块与所有 项 一样，接受外部属性。它们也接受内部属性：对于带有主体的模块是在 <code>{</code> 之后，或者在源文件的开头，在可选的 BOM 和 shebang 之后。</p>
<div class="rule" id="r-items.mod.attributes.supported"><a class="rule-link" href="#r-items.mod.attributes.supported" title="items.mod.attributes.supported"><span>[items<wbr>.mod<wbr>.attributes<wbr>.supported]</span></a>
</div>

<p>对模块有意义的内置属性有 <a href="#条件编译"><code>cfg</code></a>、<a href="#the-deprecated-attribute"><code>deprecated</code></a>、<a href="https://doc.rust-lang.org/rustdoc/the-doc-attribute.html"><code>doc</code></a>、<a href="#lint-check-attributes">lint 检查属性</a>、<a href="#path属性"><code>path</code></a> 以及 <a href="#the-no_implicit_prelude-attribute"><code>no_implicit_prelude</code></a>。模块也接受宏属性。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-items.extern-crate"><a class="rule-link" href="#r-items.extern-crate" title="items.extern-crate"><span>[items<wbr>.extern-crate]</span></a>
</div>

<h1 id="extern-crate-声明"><a class="header" href="#extern-crate-声明">extern crate 声明</a></h1>
<div class="rule" id="r-items.extern-crate.syntax"><a class="rule-link" href="#r-items.extern-crate.syntax" title="items.extern-crate.syntax"><span>[items<wbr>.extern-crate<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ExternCrate" onclick="show_railroad()"><a href="#railroad-ExternCrate">ExternCrate</a></span> → <span class="grammar-literal">extern</span> <span class="grammar-literal">crate</span> <span class="grammar-text"><a href="#grammar-CrateRef">CrateRef</a></span> <span class="grammar-text"><a href="#grammar-AsClause">AsClause</a></span><sup>?</sup> <span class="grammar-literal">;</span></p>
<p><span class="grammar-text grammar-production" id="grammar-CrateRef" onclick="show_railroad()"><a href="#railroad-CrateRef">CrateRef</a></span> → <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> | <span class="grammar-literal">self</span></p>
<p><span class="grammar-text grammar-production" id="grammar-AsClause" onclick="show_railroad()"><a href="#railroad-AsClause">AsClause</a></span> → <span class="grammar-literal">as</span> ( <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> | <span class="grammar-literal">_</span> )</p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 482px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ExternCrate"><svg class="railroad" viewbox="0 0 482 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ExternCrate">
<text class="comment" x="53" y="25">
ExternCrate</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="35" y="55" />
<text x="69" y="71">
extern</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="113" y="55" />
<text x="143" y="71">
crate</text>
</g>
<a class="link" xlink:href="#railroad-CrateRef">
<g class="nonterminal">
<rect height="22" width="84" x="183" y="55" />
<text x="225" y="71">
CrateRef</text>
</g>
</a>
<g class="optional">
<path d=" M 277 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 84 m -39 0 l -5 -5 m 0 10 l 5 -5 m 39 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-AsClause">
<g class="nonterminal">
<rect height="22" width="84" x="301" y="55" />
<text x="343" y="71">
AsClause</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="419" y="55" />
<text x="433" y="71">
;</text>
</g>
<path d=" M 103 66 h 10" />
<path d=" M 173 66 h 10" />
<path d=" M 267 66 h 10" />
<path d=" M 409 66 h 10" />
</g>
<path d=" M 457 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 447 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 218px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-CrateRef"><svg class="railroad" viewbox="0 0 218 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-CrateRef">
<text class="comment" x="43" y="25">
CrateRef</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 100 0 h 24" />
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="42" />
<text x="109" y="58">
IDENTIFIER</text>
</g>
</a>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 124 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 52 0 h 48 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="75" />
<text x="85" y="91">
self</text>
</g>
</g>
<path d=" M 193 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 183 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 264px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-AsClause"><svg class="railroad" viewbox="0 0 264 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-AsClause">
<text class="comment" x="43" y="25">
AsClause</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="42" />
<text x="53" y="58">
as</text>
</g>
<g class="choice">
<path d=" M 81 53 h 24 m 100 0 h 24" />
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="105" y="42" />
<text x="155" y="58">
IDENTIFIER</text>
</g>
</a>
<path d=" M 81 53 a 12 12 0 0 1 12 12 v 9 m 124 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 93 74 v 0 a 12 12 0 0 0 12 12 m 28 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="105" y="75" />
<text x="119" y="91">
_</text>
</g>
</g>
<path d=" M 71 53 h 10" />
</g>
<path d=" M 239 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 229 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-items.extern-crate.intro"><a class="rule-link" href="#r-items.extern-crate.intro" title="items.extern-crate.intro"><span>[items<wbr>.extern-crate<wbr>.intro]</span></a>
</div>

<p>一个 <em><code>extern crate</code> 声明</em> 指定了对外部 crate 的依赖。</p>
<div class="rule" id="r-items.extern-crate.namespace"><a class="rule-link" href="#r-items.extern-crate.namespace" title="items.extern-crate.namespace"><span>[items<wbr>.extern-crate<wbr>.namespace]</span></a>
</div>

<p>外部 crate 随后在 <a href="#命名空间">类型命名空间</a> 中作为给定的 <a href="#标识符">标识符</a> 绑定到声明作用域中。</p>
<div class="rule" id="r-items.extern-crate.extern-prelude"><a class="rule-link" href="#r-items.extern-crate.extern-prelude" title="items.extern-crate.extern-prelude"><span>[items<wbr>.extern-crate<wbr>.extern-prelude]</span></a>
</div>

<p>此外，如果 <code>extern crate</code> 出现在 crate 根中，则该 crate 名称也会被添加到 <a href="#extern-prelude">外部预导入</a> 中，使其在所有模块的作用域内自动可用。</p>
<div class="rule" id="r-items.extern-crate.as"><a class="rule-link" href="#r-items.extern-crate.as" title="items.extern-crate.as"><span>[items<wbr>.extern-crate<wbr>.as]</span></a>
</div>

<p><code>as</code> 子句可用于将导入的 crate 绑定到不同的名称。</p>
<div class="rule" id="r-items.extern-crate.lookup"><a class="rule-link" href="#r-items.extern-crate.lookup" title="items.extern-crate.lookup"><span>[items<wbr>.extern-crate<wbr>.lookup]</span></a>
</div>

<p>外部 crate 在编译时解析为特定的 <code>soname</code>，并且对该 <code>soname</code> 的运行时链接要求会被传递给链接器，以便在运行时加载。<code>soname</code> 在编译时通过扫描编译器的库路径，并将提供的可选 <code>crate_name</code> 与外部 crate 编译时声明的 <a href="#crate_name属性"><code>crate_name</code> 属性</a> 进行匹配来解析。如果没有提供 <code>crate_name</code>，则假定使用默认的 <code>name</code> 属性，该属性等于 <code>extern crate</code> 声明中给出的 <a href="#标识符">标识符</a>。</p>
<div class="rule" id="r-items.extern-crate.self"><a class="rule-link" href="#r-items.extern-crate.self" title="items.extern-crate.self"><span>[items<wbr>.extern-crate<wbr>.self]</span></a>
</div>

<p>可以导入 <code>self</code> crate，这会创建到当前 crate 的绑定。在这种情况下，必须使用 <code>as</code> 子句来指定要绑定到的名称。</p>
<p>三个 <code>extern crate</code> 声明的示例：</p>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">extern crate pcre;

extern crate std; // 等同于：extern crate std as std;

extern crate std as ruststd; // 以另一个名称链接到 'std'</code></pre>
<div class="rule" id="r-items.extern-crate.name-restrictions"><a class="rule-link" href="#r-items.extern-crate.name-restrictions" title="items.extern-crate.name-restrictions"><span>[items<wbr>.extern-crate<wbr>.name-restrictions]</span></a>
</div>

<p>在命名 Rust crate 时，禁止使用连字符。然而，Cargo 包可以使用它们。在这种情况下，当 <code>Cargo.toml</code> 没有指定 crate 名称时，Cargo 会透明地将 <code>-</code> 替换为 <code>_</code>（详见 <a href="https://github.com/rust-lang/rfcs/blob/master/text/0940-hyphens-considered-harmful.md">RFC 940</a>）。</p>
<p>示例：</p>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">// 导入 Cargo 包 hello-world
extern crate hello_world; // 连字符被替换为下划线</code></pre>
<div class="rule" id="r-items.extern-crate.underscore"><a class="rule-link" href="#r-items.extern-crate.underscore" title="items.extern-crate.underscore"><span>[items<wbr>.extern-crate<wbr>.underscore]</span></a>
</div>

<h2 id="下划线导入"><a class="header" href="#下划线导入">下划线导入</a></h2>
<p>外部 crate 依赖可以通过在 <code>extern crate foo as _</code> 形式中使用下划线来声明，而不将其名称绑定到作用域内。这对于只需要链接但从不引用的 crate 可能很有用，并且可以避免被报告为未使用。</p>
<div class="rule" id="r-items.extern-crate.underscore.macro_use"><a class="rule-link" href="#r-items.extern-crate.underscore.macro_use" title="items.extern-crate.underscore.macro_use"><span>[items<wbr>.extern-crate<wbr>.underscore<wbr>.macro_use]</span></a>
</div>

<p>[<a href="#macro_use属性"><code>macro_use</code> 属性</a>] 照常工作，并将宏名称导入到 [<a href="#macro_use-prelude"><code>macro_use</code> 预导入</a>] 中。</p>
<!-- template:attributes -->
<div class="rule" id="r-items.extern-crate.no_link"><a class="rule-link" href="#r-items.extern-crate.no_link" title="items.extern-crate.no_link"><span>[items<wbr>.extern-crate<wbr>.no_link]</span></a>
</div>

<h2 id="no_link属性"><a class="header" href="#no_link属性"><code>no_link</code>属性</a></h2>
<p><em><code>no_link</code> <a href="#r-attributes">属性</a></em>  可以应用于 <code>extern crate</code> 项以防止链接该 crate。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>这很有帮助，例如，当只需要 crate 的宏时。</p>
</blockquote>
</div>

<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">#[no_link]
extern crate other_crate;

other_crate::some_macro!();</code></pre>
</blockquote>
</div>

<div class="rule" id="r-items.extern-crate.no_link.syntax"><a class="rule-link" href="#r-items.extern-crate.no_link.syntax" title="items.extern-crate.no_link.syntax"><span>[items<wbr>.extern-crate<wbr>.no_link<wbr>.syntax]</span></a>
</div>

<p><code>no_link</code> 属性使用 <a href="#grammar-MetaWord">MetaWord</a> 语法。</p>
<div class="rule" id="r-items.extern-crate.no_link.allowed-positions"><a class="rule-link" href="#r-items.extern-crate.no_link.allowed-positions" title="items.extern-crate.no_link.allowed-positions"><span>[items<wbr>.extern-crate<wbr>.no_link<wbr>.allowed-positions]</span></a>
</div>

<p><code>no_link</code> 属性只能应用于 <code>extern crate</code> 声明。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 会忽略在其他位置的使用，但会针对其发出 lint 警告。这在将来可能会变成一个错误。</p>
</blockquote>
</div>

<div class="rule" id="r-items.extern-crate.no_link.duplicates"><a class="rule-link" href="#r-items.extern-crate.no_link.duplicates" title="items.extern-crate.no_link.duplicates"><span>[items<wbr>.extern-crate<wbr>.no_link<wbr>.duplicates]</span></a>
</div>

<p>在 <code>extern crate</code> 声明上只有第一次使用 <code>no_link</code> 有效。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 会针对第一次之后的任何使用发出 lint 警告。这在将来可能会变成一个错误。</p>
</blockquote>
</div>

<div style="break-before: page; page-break-before: always;"></div><!-- https://github.com/rust-lang/reference/blob/master/src/items/use-declarations.md -->
<!-- commit 68bdfd15fa9feebfbf94a06cf574de598e239198 -->
<div class="rule" id="r-items.use"><a class="rule-link" href="#r-items.use" title="items.use"><span>[items<wbr>.use]</span></a>
</div>

<h1 id="use声明"><a class="header" href="#use声明">use声明</a></h1>
<div class="rule" id="r-items.use.syntax"><a class="rule-link" href="#r-items.use.syntax" title="items.use.syntax"><span>[items<wbr>.use<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-UseDeclaration" onclick="show_railroad()"><a href="#railroad-UseDeclaration">UseDeclaration</a></span> → <span class="grammar-literal">use</span> <span class="grammar-text"><a href="#grammar-UseTree">UseTree</a></span> <span class="grammar-literal">;</span></p>
<p><span class="grammar-text grammar-production" id="grammar-UseTree" onclick="show_railroad()"><a href="#railroad-UseTree">UseTree</a></span> → <br>      ( <span class="grammar-text"><a href="#grammar-SimplePath">SimplePath</a></span><sup>?</sup> <span class="grammar-literal">::</span> )<sup>?</sup> <span class="grammar-literal">*</span> <br>    | ( <span class="grammar-text"><a href="#grammar-SimplePath">SimplePath</a></span><sup>?</sup> <span class="grammar-literal">::</span> )<sup>?</sup> <span class="grammar-literal">{</span> ( <span class="grammar-text"><a href="#grammar-UseTree">UseTree</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-UseTree">UseTree</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup> )<sup>?</sup> <span class="grammar-literal">}</span> <br>    | <span class="grammar-text"><a href="#grammar-SimplePath">SimplePath</a></span> ( <span class="grammar-literal">as</span> ( <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> | <span class="grammar-literal">_</span> ) )<sup>?</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 238px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-UseDeclaration"><svg class="railroad" viewbox="0 0 238 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-UseDeclaration">
<text class="comment" x="64" y="25">
UseDeclaration</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="42" />
<text x="57" y="58">
use</text>
</g>
<a class="link" xlink:href="#railroad-UseTree">
<g class="nonterminal">
<rect height="22" width="76" x="89" y="42" />
<text x="127" y="58">
UseTree</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="175" y="42" />
<text x="189" y="58">
;</text>
</g>
<path d=" M 79 53 h 10" />
<path d=" M 165 53 h 10" />
</g>
<path d=" M 213 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 203 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 852px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-UseTree"><svg class="railroad" viewbox="0 0 852 247" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-UseTree">
<text class="comment" x="39" y="25">
UseTree</text>
</a>
<g class="sequence">
<path d=" M 10 78 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 78 h 24 m 280 0 h 478 m -236 0 l -5 -5 m 0 10 l 5 -5 m 236 0" />
<g class="sequence">
<g class="optional">
<path d=" M 59 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -12 a 12 12 0 0 1 12 -12 h 194 m -94 0 l -5 -5 m 0 10 l 5 -5 m 94 0 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="optional">
<path d=" M 83 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-SimplePath">
<g class="nonterminal">
<rect height="22" width="100" x="107" y="67" />
<text x="157" y="83">
SimplePath</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="241" y="67" />
<text x="259" y="83">
::</text>
</g>
<path d=" M 231 78 h 10" />
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="311" y="67" />
<text x="325" y="83">
*</text>
</g>
<path d=" M 301 78 h 10" />
</g>
<path d=" M 35 78 a 12 12 0 0 1 12 12 v 9 m 758 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 123 v 46 m 758 0 v -46" />
<path d=" M 47 99 v 24 a 12 12 0 0 0 12 12 m 734 0 h 0 a 12 12 0 0 0 12 -12 v -24" />
<g class="sequence">
<g class="optional">
<path d=" M 59 135 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -12 a 12 12 0 0 1 12 -12 h 194 m -94 0 l -5 -5 m 0 10 l 5 -5 m 94 0 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="optional">
<path d=" M 83 135 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-SimplePath">
<g class="nonterminal">
<rect height="22" width="100" x="107" y="124" />
<text x="157" y="140">
SimplePath</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="241" y="124" />
<text x="259" y="140">
::</text>
</g>
<path d=" M 231 135 h 10" />
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="311" y="124" />
<text x="325" y="140">
{</text>
</g>
<g class="optional">
<path d=" M 349 135 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -12 a 12 12 0 0 1 12 -12 h 358 m -176 0 l -5 -5 m 0 10 l 5 -5 m 176 0 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-UseTree">
<g class="nonterminal">
<rect height="22" width="76" x="373" y="124" />
<text x="411" y="140">
UseTree</text>
</g>
</a>
<g class="optional">
<path d=" M 459 135 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 138 m -66 0 l -5 -5 m 0 10 l 5 -5 m 66 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 483 135 h 12 m 114 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -114 m 60 0 l 5 -5 m 0 10 l -5 -5 m -60 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="495" y="124" />
<text x="509" y="140">
,</text>
</g>
<a class="link" xlink:href="#railroad-UseTree">
<g class="nonterminal">
<rect height="22" width="76" x="533" y="124" />
<text x="571" y="140">
UseTree</text>
</g>
</a>
<path d=" M 523 135 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 655 135 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="679" y="124" />
<text x="693" y="140">
,</text>
</g>
</g>
<path d=" M 449 135 h 10" />
<path d=" M 645 135 h 10" />
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="765" y="124" />
<text x="779" y="140">
}</text>
</g>
<path d=" M 301 135 h 10" />
<path d=" M 339 135 h 10" />
<path d=" M 755 135 h 10" />
</g>
<path d=" M 47 169 v 12 a 12 12 0 0 0 12 12 m 352 0 h 382 m -188 0 l -5 -5 m 0 10 l 5 -5 m 188 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<a class="link" xlink:href="#railroad-SimplePath">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="182" />
<text x="109" y="198">
SimplePath</text>
</g>
</a>
<g class="optional">
<path d=" M 169 193 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 194 m -94 0 l -5 -5 m 0 10 l 5 -5 m 94 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="193" y="182" />
<text x="211" y="198">
as</text>
</g>
<g class="choice">
<path d=" M 239 193 h 24 m 100 0 h 24" />
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="263" y="182" />
<text x="313" y="198">
IDENTIFIER</text>
</g>
</a>
<path d=" M 239 193 a 12 12 0 0 1 12 12 v 9 m 124 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 251 214 v 0 a 12 12 0 0 0 12 12 m 28 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="263" y="215" />
<text x="277" y="231">
_</text>
</g>
</g>
<path d=" M 229 193 h 10" />
</g>
</g>
<path d=" M 159 193 h 10" />
</g>
</g>
<path d=" M 827 78 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 78 h 10" />
<path d=" M 817 78 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-items.use.intro"><a class="rule-link" href="#r-items.use.intro" title="items.use.intro"><span>[items<wbr>.use<wbr>.intro]</span></a>
</div>

<p>一个  <em>use 声明</em>  创建一个或多个局部名称绑定，作为某个其他 <a href="#路径">路径</a> 的同义词。通常， <code>use</code> 声明用于缩短引用模块 项 所需的路径。这些声明可以出现在 <a href="#模块">模块</a> 和 <a href="#块表达式">块</a> 中，通常在顶部。
一个 <code>use</code> 声明有时也称为  <em>导入 (import)</em> ，如果它是公共的，则称为  <em>重新导出 (re-export)</em> 。</p>
<div class="rule" id="r-items.use.forms"><a class="rule-link" href="#r-items.use.forms" title="items.use.forms"><span>[items<wbr>.use<wbr>.forms]</span></a>
</div>

<p><code>use</code> 声明支持许多方便的快捷方式：</p>
<div class="rule" id="r-items.use.forms.multiple"><a class="rule-link" href="#r-items.use.forms.multiple" title="items.use.forms.multiple"><span>[items<wbr>.use<wbr>.forms<wbr>.multiple]</span></a>
</div>

<ul>
<li>使用大括号语法 <code>use a::b::{c, d, e::f, g::h::i};</code> 同时绑定具有共同前缀的路径列表。</li>
</ul>
<div class="rule" id="r-items.use.forms.self"><a class="rule-link" href="#r-items.use.forms.self" title="items.use.forms.self"><span>[items<wbr>.use<wbr>.forms<wbr>.self]</span></a>
</div>

<ul>
<li>使用 <code>self</code> 关键字同时绑定具有共同前缀的路径列表及其共同的父模块，例如 <code>use a::b::{self, c, d::e};</code>。</li>
</ul>
<div class="rule" id="r-items.use.forms.as"><a class="rule-link" href="#r-items.use.forms.as" title="items.use.forms.as"><span>[items<wbr>.use<wbr>.forms<wbr>.as]</span></a>
</div>

<ul>
<li>使用 <code>use p::q::r as x;</code> 语法将目标名称重新绑定为新的局部名称。这也可以与最后两个特性一起使用： <code>use a::b::{self as ab, c as abc}</code>。</li>
</ul>
<div class="rule" id="r-items.use.forms.glob"><a class="rule-link" href="#r-items.use.forms.glob" title="items.use.forms.glob"><span>[items<wbr>.use<wbr>.forms<wbr>.glob]</span></a>
</div>

<ul>
<li>使用星号通配符语法 <code>use a::b::*;</code> 绑定所有匹配给定前缀的路径。</li>
</ul>
<div class="rule" id="r-items.use.forms.nesting"><a class="rule-link" href="#r-items.use.forms.nesting" title="items.use.forms.nesting"><span>[items<wbr>.use<wbr>.forms<wbr>.nesting]</span></a>
</div>

<ul>
<li>多次嵌套前述特性的组，例如 <code>use a::b::{self as ab, c, d::{*, e::f}};</code>。</li>
</ul>
<p><code>use</code> 声明的示例：</p>
<pre class="playground"><code class="language-rust edition2024">use std::collections::hash_map::{self, HashMap};

fn foo&lt;T&gt;(_: T){}
fn bar(map1: HashMap&lt;String, usize&gt;, map2: hash_map::HashMap&lt;String, usize&gt;){}

fn main() {
    // use 声明也可以存在于函数内部
    use std::option::Option::{Some, None};

    // 等价于 'foo(vec![std::option::Option::Some(1.0f64),
    // std::option::Option::None]);'
    foo(vec![Some(1.0f64), None]);

    // `hash_map` 和 `HashMap` 都在作用域内。
    let map1 = HashMap::new();
    let map2 = hash_map::HashMap::new();
    bar(map1, map2);
}</code></pre>
<div class="rule" id="r-items.use.visibility"><a class="rule-link" href="#r-items.use.visibility" title="items.use.visibility"><span>[items<wbr>.use<wbr>.visibility]</span></a>
</div>

<h2 id="use可见性"><a class="header" href="#use可见性"><code>use</code>可见性</a></h2>
<div class="rule" id="r-items.use.visibility.intro"><a class="rule-link" href="#r-items.use.visibility.intro" title="items.use.visibility.intro"><span>[items<wbr>.use<wbr>.visibility<wbr>.intro]</span></a>
</div>

<p>默认情况下，与 项 一样， <code>use</code> 声明对其包含的模块是私有的。与 项 一样，如果用 <code>pub</code> 关键字限定， <code>use</code> 声明也可以是公共的。这样的 <code>use</code> 声明用于  <em>重新导出 (re-export)</em>  一个名称。因此，公共 <code>use</code> 声明可以  <em>重定向 (redirect)</em>  某个公共名称到不同的目标定义：即使是位于不同模块内具有私有规范路径的定义。</p>
<div class="rule" id="r-items.use.visibility.unambiguous"><a class="rule-link" href="#r-items.use.visibility.unambiguous" title="items.use.visibility.unambiguous"><span>[items<wbr>.use<wbr>.visibility<wbr>.unambiguous]</span></a>
</div>

<p>如果一系列此类重定向形成循环或无法明确解析，则它们会引发编译时错误。</p>
<p>重新导出的示例：</p>
<pre class="playground"><code class="language-rust edition2024">mod quux {
    pub use self::foo::{bar, baz};
    pub mod foo {
        pub fn bar() {}
        pub fn baz() {}
    }
}

fn main() {
    quux::bar();
    quux::baz();
}</code></pre>
<p>在此示例中，模块 <code>quux</code> 重新导出了在 <code>foo</code> 中定义的两个公共名称。</p>
<div class="rule" id="r-items.use.path"><a class="rule-link" href="#r-items.use.path" title="items.use.path"><span>[items<wbr>.use<wbr>.path]</span></a>
</div>

<h2 id="use路径"><a class="header" href="#use路径"><code>use</code>路径</a></h2>
<div class="rule" id="r-items.use.path.intro"><a class="rule-link" href="#r-items.use.path.intro" title="items.use.path.intro"><span>[items<wbr>.use<wbr>.path<wbr>.intro]</span></a>
</div>

<p><code>use</code> 项中允许的 <a href="#路径">路径</a> 遵循 <a href="#grammar-SimplePath">简单路径</a> 语法格式，并且与表达式中可用的路径相似。
它们可以为以下内容创建绑定：</p>
<ul>
<li>可命名的 <a href="#项">项</a></li>
<li><a href="#枚举">枚举变体</a></li>
<li><a href="#类型">内置类型</a></li>
<li><a href="#属性-1">属性</a></li>
<li><a href="#r-macro.proc.derive">派生宏</a></li>
<li><a href="#声明宏"><code>macro_rules</code></a></li>
</ul>
<div class="rule" id="r-items.use.path.disallowed"><a class="rule-link" href="#r-items.use.path.disallowed" title="items.use.path.disallowed"><span>[items<wbr>.use<wbr>.path<wbr>.disallowed]</span></a>
</div>

<p>它们不能导入 <a href="#关联项">关联项</a>、 <a href="#泛型参数">泛型参数</a>、 <a href="#变量">局部变量</a>、包含 <a href="#self"><code>Self</code></a> 的路径或 <a href="#tool-attributes">工具属性</a>。更多限制如下所述。</p>
<div class="rule" id="r-items.use.path.namespace"><a class="rule-link" href="#r-items.use.path.namespace" title="items.use.path.namespace"><span>[items<wbr>.use<wbr>.path<wbr>.namespace]</span></a>
</div>

<p><code>use</code> 将为所有导入实体的 <a href="#命名空间">命名空间</a> 创建绑定，但 <code>self</code> 导入仅从类型命名空间导入（如下所述）。
例如，以下示例说明了在两个命名空间中为相同名称创建绑定：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>mod stuff {
    pub struct Foo(pub i32);
}

// 同时导入 `Foo` 类型和 `Foo` 构造器。
use stuff::Foo;

fn example() {
    let ctor = Foo; // 使用值命名空间中的 `Foo`。
    let x: Foo = ctor(123); // 使用类型命名空间中的 `Foo`。
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.use.path.edition2018"><a class="rule-link" href="#r-items.use.path.edition2018" title="items.use.path.edition2018"><span>[items<wbr>.use<wbr>.path<wbr>.edition2018]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p>在 2015 版次中， <code>use</code> 路径相对于 crate 根。例如：</p>
<pre class="playground"><code class="language-rust edition2015">mod foo {
    pub mod example { pub mod iter {} }
    pub mod baz { pub fn foobaz() {} }
}
mod bar {
    // 从 crate 根解析 `foo`。
    use foo::example::iter;
    // `::` 前缀显式地从 crate 根解析 `foo`。
    use ::foo::baz::foobaz;
}

<span class="boring">fn main() {}</span></code></pre>
<p>2015 版次不允许 use 声明引用 <a href="#extern-prelude">外部预导入</a>。
因此，在 2015 版次中仍然需要 <a href="#extern-crate-声明"><code>extern crate</code></a> 声明才能在 use 声明中引用外部 crate。
从 2018 版次开始， <code>use</code> 声明可以像 <code>extern crate</code> 一样指定外部 crate 依赖项。</p>
</blockquote>
</div>

<div class="rule" id="r-items.use.as"><a class="rule-link" href="#r-items.use.as" title="items.use.as"><span>[items<wbr>.use<wbr>.as]</span></a>
</div>

<h2 id="as重命名"><a class="header" href="#as重命名"><code>as</code>重命名</a></h2>
<p><code>as</code> 关键字可用于更改导入实体的名称。
例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 为函数 `foo` 创建一个非公共别名 `bar`。
use inner::foo as bar;

mod inner {
    pub fn foo() {}
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.use.multiple-syntax"><a class="rule-link" href="#r-items.use.multiple-syntax" title="items.use.multiple-syntax"><span>[items<wbr>.use<wbr>.multiple-syntax]</span></a>
</div>

<h2 id="大括号语法"><a class="header" href="#大括号语法">大括号语法</a></h2>
<div class="rule" id="r-items.use.multiple-syntax.intro"><a class="rule-link" href="#r-items.use.multiple-syntax.intro" title="items.use.multiple-syntax.intro"><span>[items<wbr>.use<wbr>.multiple-syntax<wbr>.intro]</span></a>
</div>

<p>大括号可用于路径的最后一个段中，以从前一个段导入多个实体，或者，如果前一个段不存在，则从当前作用域导入。
大括号可以嵌套，创建路径树，其中每个段组都与其父级逻辑组合以创建完整路径。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 创建以下绑定：
// - `std::collections::BTreeSet`
// - `std::collections::hash_map`
// - `std::collections::hash_map::HashMap`
use std::collections::{BTreeSet, hash_map::{self, HashMap}};
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.use.multiple-syntax.empty"><a class="rule-link" href="#r-items.use.multiple-syntax.empty" title="items.use.multiple-syntax.empty"><span>[items<wbr>.use<wbr>.multiple-syntax<wbr>.empty]</span></a>
</div>

<p>一个空大括号不导入任何内容，尽管会验证其前导路径是否可访问。</p>
<div class="rule" id="r-items.use.multiple-syntax.edition2018"><a class="rule-link" href="#r-items.use.multiple-syntax.edition2018" title="items.use.multiple-syntax.edition2018"><span>[items<wbr>.use<wbr>.multiple-syntax<wbr>.edition2018]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p>在 2015 版次中，路径是相对于 crate 根的，因此像 <code>use {foo, bar};</code> 这样的导入会从 crate 根导入名称 <code>foo</code> 和 <code>bar</code>，而从 2018 版次开始，这些名称是相对于当前作用域的。</p>
</blockquote>
</div>

<div class="rule" id="r-items.use.self"><a class="rule-link" href="#r-items.use.self" title="items.use.self"><span>[items<wbr>.use<wbr>.self]</span></a>
</div>

<h2 id="self导入"><a class="header" href="#self导入"><code>self</code>导入</a></h2>
<div class="rule" id="r-items.use.self.intro"><a class="rule-link" href="#r-items.use.self.intro" title="items.use.self.intro"><span>[items<wbr>.use<wbr>.self<wbr>.intro]</span></a>
</div>

<p>关键字 <code>self</code> 可在 <a href="#大括号语法">大括号语法</a> 中使用，以其自身名称创建父实体的绑定。</p>
<pre class="playground"><code class="language-rust edition2024">mod stuff {
    pub fn foo() {}
    pub fn bar() {}
}
mod example {
    // 为 `stuff` 和 `foo` 创建绑定。
    use crate::stuff::{self, foo};
    pub fn baz() {
        foo();
        stuff::bar();
    }
}
<span class="boring">fn main() {}</span></code></pre>
<div class="rule" id="r-items.use.self.namespace"><a class="rule-link" href="#r-items.use.self.namespace" title="items.use.self.namespace"><span>[items<wbr>.use<wbr>.self<wbr>.namespace]</span></a>
</div>

<p><code>self</code> 只从父实体的 <a href="#命名空间">类型命名空间</a> 创建绑定。
例如，在以下代码中，只导入了 <code>foo</code> 模块：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024">mod bar {
    pub mod foo {}
    pub fn foo() {}
}

// 这仅导入模块 `foo`。函数 `foo` 存在于
// 值命名空间中，且未被导入。
use bar::foo::{self};

fn main() {
    foo(); //~ 错误 `foo` 是一个模块
}</code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>self</code> 也可以用作路径的第一个段。 <code>self</code> 作为第一个段的用法与在 <code>use</code> 大括号内的用法在逻辑上是相同的；它表示父段的当前模块，或者如果没有父段，则表示当前模块。有关前导 <code>self</code> 的含义的更多信息，请参见路径章节中的 <a href="#self"><code>self</code></a>。</p>
</blockquote>
</div>

<div class="rule" id="r-items.use.glob"><a class="rule-link" href="#r-items.use.glob" title="items.use.glob"><span>[items<wbr>.use<wbr>.glob]</span></a>
</div>

<h2 id="通配符导入"><a class="header" href="#通配符导入">通配符导入</a></h2>
<div class="rule" id="r-items.use.glob.intro"><a class="rule-link" href="#r-items.use.glob.intro" title="items.use.glob.intro"><span>[items<wbr>.use<wbr>.glob<wbr>.intro]</span></a>
</div>

<p><code>*</code> 字符可用作 <code>use</code> 路径的最后一个段，以从前一个段的实体中导入所有可导入的实体。
例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 为 `bar` 创建一个非公共别名。
use foo::*;

mod foo {
    fn i_am_private() {}
    enum Example {
        V1,
        V2,
    }
    pub fn bar() {
        // 为 `Example` 枚举的 `V1` 和 `V2` 创建局部别名。
        use Example::*;
        let x = V1;
    }
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.use.glob.shadowing"><a class="rule-link" href="#r-items.use.glob.shadowing" title="items.use.glob.shadowing"><span>[items<wbr>.use<wbr>.glob<wbr>.shadowing]</span></a>
</div>

<p>允许 项 和命名导入遮蔽来自同一 <a href="#命名空间">命名空间</a> 中通配符导入的名称。
也就是说，如果同一命名空间中已由另一个 项 定义了某个名称，则通配符导入将被遮蔽。
例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 这为 `clashing::Foo` 元组结构体构造器创建了一个绑定，
// 但没有导入其类型，因为那会与此处定义的 `Foo` 结构体冲突。
//
// 注意，此处的定义顺序并不重要。
use clashing::*;
struct Foo {
    field: f32,
}

fn do_stuff() {
    // 使用 `clashing::Foo` 的构造器。
    let f1 = Foo(123);
    // 结构体表达式使用上面定义的 `Foo` 结构体的类型。
    let f2 = Foo { field: 1.0 };
    // 由于通配符导入， `Bar` 也在作用域内。
    let z = Bar {};
}

mod clashing {
    pub struct Foo(pub i32);
    pub struct Bar {}
}
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>对于不允许遮蔽的区域，请参见 <a href="#r-names.resolution.expansion.imports.ambiguity">名称解析歧义</a>。</p>
</blockquote>
</div>

<div class="rule" id="r-items.use.glob.last-segment-only"><a class="rule-link" href="#r-items.use.glob.last-segment-only" title="items.use.glob.last-segment-only"><span>[items<wbr>.use<wbr>.glob<wbr>.last-segment-only]</span></a>
</div>

<p><code>*</code> 不能用作第一个或中间段。</p>
<div class="rule" id="r-items.use.glob.self-import"><a class="rule-link" href="#r-items.use.glob.self-import" title="items.use.glob.self-import"><span>[items<wbr>.use<wbr>.glob<wbr>.self-import]</span></a>
</div>

<p><code>*</code> 不能用于将模块的内容导入自身（例如 <code>use self::*;</code> ）。</p>
<div class="rule" id="r-items.use.glob.edition2018"><a class="rule-link" href="#r-items.use.glob.edition2018" title="items.use.glob.edition2018"><span>[items<wbr>.use<wbr>.glob<wbr>.edition2018]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p>在 2015 版次中，路径是相对于 crate 根的，因此像 <code>use *;</code> 这样的导入是有效的，它意味着从 crate 根导入所有内容。这不能在 crate 根本身中使用。</p>
</blockquote>
</div>

<div class="rule" id="r-items.use.as-underscore"><a class="rule-link" href="#r-items.use.as-underscore" title="items.use.as-underscore"><span>[items<wbr>.use<wbr>.as-underscore]</span></a>
</div>

<h2 id="下划线导入-1"><a class="header" href="#下划线导入-1">下划线导入</a></h2>
<div class="rule" id="r-items.use.as-underscore.intro"><a class="rule-link" href="#r-items.use.as-underscore.intro" title="items.use.as-underscore.intro"><span>[items<wbr>.use<wbr>.as-underscore<wbr>.intro]</span></a>
</div>

<p>可以通过使用下划线形式 <code>use path as _</code> 导入 项 而不绑定到名称。这对于导入一个 特型 特别有用，以便可以使用其方法而无需导入该 特型 的符号，例如，如果该 特型 的符号可能与其他符号冲突。另一个例子是链接外部 crate 而不导入其名称。</p>
<div class="rule" id="r-items.use.as-underscore.glob"><a class="rule-link" href="#r-items.use.as-underscore.glob" title="items.use.as-underscore.glob"><span>[items<wbr>.use<wbr>.as-underscore<wbr>.glob]</span></a>
</div>

<p>星号通配符导入将以不可命名的形式导入带有 <code>_</code> 的 项。</p>
<pre class="playground"><code class="language-rust edition2024">mod foo {
    pub trait Zoo {
        fn zoo(&amp;self) {}
    }

    impl&lt;T&gt; Zoo for T {}
}

use self::foo::Zoo as _;
struct Zoo;  // 下划线导入避免与此项发生命名冲突。

fn main() {
    let z = Zoo;
    z.zoo();
}</code></pre>
<div class="rule" id="r-items.use.as-underscore.macro"><a class="rule-link" href="#r-items.use.as-underscore.macro" title="items.use.as-underscore.macro"><span>[items<wbr>.use<wbr>.as-underscore<wbr>.macro]</span></a>
</div>

<p>独特的、不可命名的符号在宏展开后创建，这样宏可以安全地发出对 <code>_</code> 导入的多个引用。例如，以下代码不应产生错误：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! m {
    ($item: item) =&gt; { $item $item }
}

m!(use std as _;);
// 这将展开为：
// use std as _;
// use std as _;
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.use.restrictions"><a class="rule-link" href="#r-items.use.restrictions" title="items.use.restrictions"><span>[items<wbr>.use<wbr>.restrictions]</span></a>
</div>

<h2 id="限制"><a class="header" href="#限制">限制</a></h2>
<p>以下是有效 <code>use</code> 声明的限制：</p>
<div class="rule" id="r-items.use.restrictions.crate"><a class="rule-link" href="#r-items.use.restrictions.crate" title="items.use.restrictions.crate"><span>[items<wbr>.use<wbr>.restrictions<wbr>.crate]</span></a>
</div>

<ul>
<li><code>use crate;</code> 必须使用 <code>as</code> 来定义要绑定 crate 根的名称。</li>
</ul>
<div class="rule" id="r-items.use.restrictions.self"><a class="rule-link" href="#r-items.use.restrictions.self" title="items.use.restrictions.self"><span>[items<wbr>.use<wbr>.restrictions<wbr>.self]</span></a>
</div>

<ul>
<li><code>use {self};</code> 是一个错误；使用 <code>self</code> 时必须有一个前导段。</li>
</ul>
<div class="rule" id="r-items.use.restrictions.duplicate-name"><a class="rule-link" href="#r-items.use.restrictions.duplicate-name" title="items.use.restrictions.duplicate-name"><span>[items<wbr>.use<wbr>.restrictions<wbr>.duplicate-name]</span></a>
</div>

<ul>
<li>与任何 项 定义一样， <code>use</code> 导入不能在模块或块中的同一命名空间内创建相同名称的重复绑定。</li>
</ul>
<div class="rule" id="r-items.use.restrictions.macro-crate"><a class="rule-link" href="#r-items.use.restrictions.macro-crate" title="items.use.restrictions.macro-crate"><span>[items<wbr>.use<wbr>.restrictions<wbr>.macro-crate]</span></a>
</div>

<ul>
<li>包含 <code>$crate</code> 的 <code>use</code> 路径不允许在 <a href="#声明宏"><code>macro_rules</code></a> 展开中使用。</li>
</ul>
<div class="rule" id="r-items.use.restrictions.variant"><a class="rule-link" href="#r-items.use.restrictions.variant" title="items.use.restrictions.variant"><span>[items<wbr>.use<wbr>.restrictions<wbr>.variant]</span></a>
</div>

<ul>
<li><code>use</code> 路径不能通过 <a href="#类型别名">类型别名</a> 引用枚举变体。例如：
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum MyEnum {
    MyVariant
}
type TypeAlias = MyEnum;

use MyEnum::MyVariant; //~ 正常
use TypeAlias::MyVariant; //~ 错误
<span class="boring">}</span></code></pre>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-items.fn"><a class="rule-link" href="#r-items.fn" title="items.fn"><span>[items<wbr>.fn]</span></a>
</div>

<h1 id="函数"><a class="header" href="#函数">函数</a></h1>
<div class="rule" id="r-items.fn.syntax"><a class="rule-link" href="#r-items.fn.syntax" title="items.fn.syntax"><span>[items<wbr>.fn<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-Function" onclick="show_railroad()"><a href="#railroad-Function">Function</a></span> → <br>    <span class="grammar-text"><a href="#grammar-FunctionQualifiers">FunctionQualifiers</a></span> <span class="grammar-literal">fn</span> <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-text"><a href="#grammar-GenericParams">GenericParams</a></span><sup>?</sup> <br>        <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-FunctionParameters">FunctionParameters</a></span><sup>?</sup> <span class="grammar-literal">)</span> <br>        <span class="grammar-text"><a href="#grammar-FunctionReturnType">FunctionReturnType</a></span><sup>?</sup> <span class="grammar-text"><a href="#grammar-WhereClause">WhereClause</a></span><sup>?</sup> <br>        ( <span class="grammar-text"><a href="#grammar-BlockExpression">BlockExpression</a></span> | <span class="grammar-literal">;</span> )</p>
<p><span class="grammar-text grammar-production" id="grammar-FunctionQualifiers" onclick="show_railroad()"><a href="#railroad-FunctionQualifiers">FunctionQualifiers</a></span> → <span class="grammar-literal">const</span><sup>?</sup> <span class="grammar-literal">async</span><sup>?</sup>​<sup class="footnote-reference" id="fr-async-edition-1"><a href="#footnote-async-edition">1</a></sup> <span class="grammar-text"><a href="#grammar-ItemSafety">ItemSafety</a></span><sup>?</sup>​<sup class="footnote-reference" id="fr-extern-qualifiers-1"><a href="#footnote-extern-qualifiers">2</a></sup> ( <span class="grammar-literal">extern</span> <span class="grammar-text"><a href="#grammar-Abi">Abi</a></span><sup>?</sup> )<sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-ItemSafety" onclick="show_railroad()"><a href="#railroad-ItemSafety">ItemSafety</a></span> → <span class="grammar-literal">safe</span>​<sup class="footnote-reference" id="fr-extern-safe-1"><a href="#footnote-extern-safe">3</a></sup> | <span class="grammar-literal">unsafe</span></p>
<p><span class="grammar-text grammar-production" id="grammar-Abi" onclick="show_railroad()"><a href="#railroad-Abi">Abi</a></span> → <span class="grammar-text"><a href="#grammar-STRING_LITERAL">STRING_LITERAL</a></span> | <span class="grammar-text"><a href="#grammar-RAW_STRING_LITERAL">RAW_STRING_LITERAL</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-FunctionParameters" onclick="show_railroad()"><a href="#railroad-FunctionParameters">FunctionParameters</a></span> → <br>      <span class="grammar-text"><a href="#grammar-SelfParam">SelfParam</a></span> <span class="grammar-literal">,</span><sup>?</sup> <br>    | ( <span class="grammar-text"><a href="#grammar-SelfParam">SelfParam</a></span> <span class="grammar-literal">,</span> )<sup>?</sup> <span class="grammar-text"><a href="#grammar-FunctionParam">FunctionParam</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-FunctionParam">FunctionParam</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-SelfParam" onclick="show_railroad()"><a href="#railroad-SelfParam">SelfParam</a></span> → <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> ( <span class="grammar-text"><a href="#grammar-ShorthandSelf">ShorthandSelf</a></span> | <span class="grammar-text"><a href="#grammar-TypedSelf">TypedSelf</a></span> )</p>
<p><span class="grammar-text grammar-production" id="grammar-ShorthandSelf" onclick="show_railroad()"><a href="#railroad-ShorthandSelf">ShorthandSelf</a></span> → ( <span class="grammar-literal">&amp;</span> | <span class="grammar-literal">&amp;</span> <span class="grammar-text"><a href="#grammar-Lifetime">Lifetime</a></span> )<sup>?</sup> <span class="grammar-literal">mut</span><sup>?</sup> <span class="grammar-literal">self</span></p>
<p><span class="grammar-text grammar-production" id="grammar-TypedSelf" onclick="show_railroad()"><a href="#railroad-TypedSelf">TypedSelf</a></span> → <span class="grammar-literal">mut</span><sup>?</sup> <span class="grammar-literal">self</span> <span class="grammar-literal">:</span> <span class="grammar-text"><a href="#grammar-Type">Type</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-FunctionParam" onclick="show_railroad()"><a href="#railroad-FunctionParam">FunctionParam</a></span> → <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> ( <span class="grammar-text"><a href="#grammar-FunctionParamPattern">FunctionParamPattern</a></span> | <span class="grammar-literal">...</span> | <span class="grammar-text"><a href="#grammar-Type">Type</a></span>​<sup class="footnote-reference" id="fr-fn-param-2015-1"><a href="#footnote-fn-param-2015">4</a></sup> )</p>
<p><span class="grammar-text grammar-production" id="grammar-FunctionParamPattern" onclick="show_railroad()"><a href="#railroad-FunctionParamPattern">FunctionParamPattern</a></span> → <span class="grammar-text"><a href="#grammar-PatternNoTopAlt">PatternNoTopAlt</a></span> <span class="grammar-literal">:</span> ( <span class="grammar-text"><a href="#grammar-Type">Type</a></span> | <span class="grammar-literal">...</span> )</p>
<p><span class="grammar-text grammar-production" id="grammar-FunctionReturnType" onclick="show_railroad()"><a href="#railroad-FunctionReturnType">FunctionReturnType</a></span> → <span class="grammar-literal">-&gt;</span> <span class="grammar-text"><a href="#grammar-Type">Type</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 620px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Function"><svg class="railroad" viewbox="0 0 620 288" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Function">
<text class="comment" x="43" y="25">
Function</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="stack">
<path d=" M 35 66 h 12" />
<path d=" M 549 66 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 h -502 m 254 0 l 5 -5 m 0 10 l -5 -5 m -254 0 a 12 12 0 0 0 -12 12 v 12 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-FunctionQualifiers">
<g class="nonterminal">
<rect height="22" width="164" x="47" y="55" />
<text x="129" y="71">
FunctionQualifiers</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="221" y="55" />
<text x="239" y="71">
fn</text>
</g>
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="267" y="55" />
<text x="317" y="71">
IDENTIFIER</text>
</g>
</a>
<g class="optional">
<path d=" M 377 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 124 m -59 0 l -5 -5 m 0 10 l 5 -5 m 59 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-GenericParams">
<g class="nonterminal">
<rect height="22" width="124" x="401" y="55" />
<text x="463" y="71">
GenericParams</text>
</g>
</a>
</g>
<path d=" M 211 66 h 10" />
<path d=" M 257 66 h 10" />
<path d=" M 367 66 h 10" />
</g>
<path d=" M 335 126 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 h -288 m 147 0 l 5 -5 m 0 10 l -5 -5 m -147 0 a 12 12 0 0 0 -12 12 v 12 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="47" y="115" />
<text x="61" y="131">
(</text>
</g>
<g class="optional">
<path d=" M 85 126 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 164 m -79 0 l -5 -5 m 0 10 l 5 -5 m 79 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-FunctionParameters">
<g class="nonterminal">
<rect height="22" width="164" x="109" y="115" />
<text x="191" y="131">
FunctionParameters</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="307" y="115" />
<text x="321" y="131">
)</text>
</g>
<path d=" M 75 126 h 10" />
<path d=" M 297 126 h 10" />
</g>
<path d=" M 425 186 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 h -378 m 192 0 l 5 -5 m 0 10 l -5 -5 m -192 0 a 12 12 0 0 0 -12 12 v 0 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="optional">
<path d=" M 47 186 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 164 m -79 0 l -5 -5 m 0 10 l 5 -5 m 79 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-FunctionReturnType">
<g class="nonterminal">
<rect height="22" width="164" x="71" y="175" />
<text x="153" y="191">
FunctionReturnType</text>
</g>
</a>
</g>
<g class="optional">
<path d=" M 269 186 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 108 m -51 0 l -5 -5 m 0 10 l 5 -5 m 51 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-WhereClause">
<g class="nonterminal">
<rect height="22" width="108" x="293" y="175" />
<text x="347" y="191">
WhereClause</text>
</g>
</a>
</g>
<path d=" M 259 186 h 10" />
</g>
<path d=" M 235 234 h 326 m -160 0 l -5 -5 m 0 10 l 5 -5 m 160 0 a 12 12 0 0 0 12 -12 v -144 m 0 75 l -5 5 m 10 0 l -5 -5 m 0 -75 a 12 12 0 0 1 12 -12" />
<g class="sequence">
<g class="choice">
<path d=" M 47 234 h 24 m 140 0 h 24" />
<a class="link" xlink:href="#railroad-BlockExpression">
<g class="nonterminal">
<rect height="22" width="140" x="71" y="223" />
<text x="141" y="239">
BlockExpression</text>
</g>
</a>
<path d=" M 47 234 a 12 12 0 0 1 12 12 v 9 m 164 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 59 255 v 0 a 12 12 0 0 0 12 12 m 28 0 h 112 m -53 0 l -5 -5 m 0 10 l 5 -5 m 53 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="71" y="256" />
<text x="85" y="272">
;</text>
</g>
</g>
</g>
</g>
<path d=" M 595 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 585 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 682px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-FunctionQualifiers"><svg class="railroad" viewbox="0 0 682 99" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-FunctionQualifiers">
<text class="comment" x="78" y="25">
FunctionQualifiers</text>
</a>
<g class="sequence">
<path d=" M 10 78 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 60 m -27 0 l -5 -5 m 0 10 l 5 -5 m 27 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="59" y="67" />
<text x="89" y="83">
const</text>
</g>
</g>
<g class="optional">
<path d=" M 153 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 60 m -27 0 l -5 -5 m 0 10 l 5 -5 m 27 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="177" y="67" />
<text x="207" y="83">
async</text>
</g>
</g>
<g class="optional">
<path d=" M 271 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-ItemSafety">
<g class="nonterminal">
<rect height="22" width="100" x="295" y="67" />
<text x="345" y="83">
ItemSafety</text>
</g>
</a>
</g>
<g class="optional">
<path d=" M 429 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -12 a 12 12 0 0 1 12 -12 h 170 m -82 0 l -5 -5 m 0 10 l 5 -5 m 82 0 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="453" y="67" />
<text x="487" y="83">
extern</text>
</g>
<g class="optional">
<path d=" M 531 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 44 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-Abi">
<g class="nonterminal">
<rect height="22" width="44" x="555" y="67" />
<text x="577" y="83">
Abi</text>
</g>
</a>
</g>
<path d=" M 521 78 h 10" />
</g>
</g>
<path d=" M 143 78 h 10" />
<path d=" M 261 78 h 10" />
<path d=" M 419 78 h 10" />
</g>
<path d=" M 657 78 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 78 h 10" />
<path d=" M 647 78 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 186px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ItemSafety"><svg class="railroad" viewbox="0 0 186 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ItemSafety">
<text class="comment" x="50" y="25">
ItemSafety</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 52 0 h 40" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="42" />
<text x="85" y="58">
safe</text>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 92 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 68 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="75" />
<text x="93" y="91">
unsafe</text>
</g>
</g>
<path d=" M 161 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 151 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 282px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Abi"><svg class="railroad" viewbox="0 0 282 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Abi">
<text class="comment" x="25" y="25">
Abi</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 132 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0" />
<a class="link" xlink:href="#railroad-STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="132" x="59" y="42" />
<text x="125" y="58">
STRING_LITERAL</text>
</g>
</a>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 188 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 164 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-RAW_STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="164" x="59" y="75" />
<text x="141" y="91">
RAW_STRING_LITERAL</text>
</g>
</a>
</g>
<path d=" M 257 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 247 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 760px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-FunctionParameters"><svg class="railroad" viewbox="0 0 760 145" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-FunctionParameters">
<text class="comment" x="78" y="25">
FunctionParameters</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 66 h 24 m 178 0 h 488 m -241 0 l -5 -5 m 0 10 l 5 -5 m 241 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-SelfParam">
<g class="nonterminal">
<rect height="22" width="92" x="59" y="55" />
<text x="105" y="71">
SelfParam</text>
</g>
</a>
<g class="optional">
<path d=" M 161 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="185" y="55" />
<text x="199" y="71">
,</text>
</g>
</g>
<path d=" M 151 66 h 10" />
</g>
<path d=" M 35 66 a 12 12 0 0 1 12 12 v 9 m 666 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 87 v 12 a 12 12 0 0 0 12 12 m 642 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="optional">
<path d=" M 59 111 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 130 m -62 0 l -5 -5 m 0 10 l 5 -5 m 62 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-SelfParam">
<g class="nonterminal">
<rect height="22" width="92" x="83" y="100" />
<text x="129" y="116">
SelfParam</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="185" y="100" />
<text x="199" y="116">
,</text>
</g>
<path d=" M 175 111 h 10" />
</g>
</g>
<a class="link" xlink:href="#railroad-FunctionParam">
<g class="nonterminal">
<rect height="22" width="124" x="247" y="100" />
<text x="309" y="116">
FunctionParam</text>
</g>
</a>
<g class="optional">
<path d=" M 381 111 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 186 m -90 0 l -5 -5 m 0 10 l 5 -5 m 90 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 405 111 h 12 m 162 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -162 m 84 0 l 5 -5 m 0 10 l -5 -5 m -84 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="417" y="100" />
<text x="431" y="116">
,</text>
</g>
<a class="link" xlink:href="#railroad-FunctionParam">
<g class="nonterminal">
<rect height="22" width="124" x="455" y="100" />
<text x="517" y="116">
FunctionParam</text>
</g>
</a>
<path d=" M 445 111 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 625 111 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="649" y="100" />
<text x="663" y="116">
,</text>
</g>
</g>
<path d=" M 237 111 h 10" />
<path d=" M 371 111 h 10" />
<path d=" M 615 111 h 10" />
</g>
</g>
<path d=" M 735 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 725 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 456px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-SelfParam"><svg class="railroad" viewbox="0 0 456 120" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-SelfParam">
<text class="comment" x="46" y="25">
SelfParam</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<g class="choice">
<path d=" M 249 66 h 24 m 124 0 h 24" />
<a class="link" xlink:href="#railroad-ShorthandSelf">
<g class="nonterminal">
<rect height="22" width="124" x="273" y="55" />
<text x="335" y="71">
ShorthandSelf</text>
</g>
</a>
<path d=" M 249 66 a 12 12 0 0 1 12 12 v 9 m 148 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 261 87 v 0 a 12 12 0 0 0 12 12 m 92 0 h 32 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-TypedSelf">
<g class="nonterminal">
<rect height="22" width="92" x="273" y="88" />
<text x="319" y="104">
TypedSelf</text>
</g>
</a>
</g>
<path d=" M 239 66 h 10" />
</g>
<path d=" M 431 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 421 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 452px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ShorthandSelf"><svg class="railroad" viewbox="0 0 452 120" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ShorthandSelf">
<text class="comment" x="60" y="25">
ShorthandSelf</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 170 m -82 0 l -5 -5 m 0 10 l 5 -5 m 82 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="choice">
<path d=" M 59 66 h 24 m 28 0 h 118 m -56 0 l -5 -5 m 0 10 l 5 -5 m 56 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="83" y="55" />
<text x="97" y="71">
&amp;</text>
</g>
<path d=" M 59 66 a 12 12 0 0 1 12 12 v 9 m 146 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 71 87 v 0 a 12 12 0 0 0 12 12 m 122 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="83" y="88" />
<text x="97" y="104">
&amp;</text>
</g>
<a class="link" xlink:href="#railroad-Lifetime">
<g class="nonterminal">
<rect height="22" width="84" x="121" y="88" />
<text x="163" y="104">
Lifetime</text>
</g>
</a>
<path d=" M 111 99 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 263 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 44 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="287" y="55" />
<text x="309" y="71">
mut</text>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="365" y="55" />
<text x="391" y="71">
self</text>
</g>
<path d=" M 253 66 h 10" />
<path d=" M 355 66 h 10" />
</g>
<path d=" M 427 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 417 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 324px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TypedSelf"><svg class="railroad" viewbox="0 0 324 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TypedSelf">
<text class="comment" x="46" y="25">
TypedSelf</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 44 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="55" />
<text x="81" y="71">
mut</text>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="137" y="55" />
<text x="163" y="71">
self</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="199" y="55" />
<text x="213" y="71">
:</text>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="237" y="55" />
<text x="263" y="71">
Type</text>
</g>
</a>
<path d=" M 127 66 h 10" />
<path d=" M 189 66 h 10" />
<path d=" M 227 66 h 10" />
</g>
<path d=" M 299 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 289 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 520px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-FunctionParam"><svg class="railroad" viewbox="0 0 520 153" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-FunctionParam">
<text class="comment" x="60" y="25">
FunctionParam</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<g class="choice">
<path d=" M 249 66 h 24 m 188 0 h 24" />
<a class="link" xlink:href="#railroad-FunctionParamPattern">
<g class="nonterminal">
<rect height="22" width="188" x="273" y="55" />
<text x="367" y="71">
FunctionParamPattern</text>
</g>
</a>
<path d=" M 249 66 a 12 12 0 0 1 12 12 v 9 m 212 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 261 87 v 33 m 212 0 v -33" />
<path d=" M 261 87 v 0 a 12 12 0 0 0 12 12 m 44 0 h 144 m -69 0 l -5 -5 m 0 10 l 5 -5 m 69 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="273" y="88" />
<text x="295" y="104">
...</text>
</g>
<path d=" M 261 120 v 0 a 12 12 0 0 0 12 12 m 52 0 h 136 m -65 0 l -5 -5 m 0 10 l 5 -5 m 65 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="273" y="121" />
<text x="299" y="137">
Type</text>
</g>
</a>
</g>
<path d=" M 239 66 h 10" />
</g>
<path d=" M 495 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 485 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 358px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-FunctionParamPattern"><svg class="railroad" viewbox="0 0 358 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-FunctionParamPattern">
<text class="comment" x="88" y="25">
FunctionParamPattern</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-PatternNoTopAlt">
<g class="nonterminal">
<rect height="22" width="140" x="35" y="42" />
<text x="105" y="58">
PatternNoTopAlt</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="185" y="42" />
<text x="199" y="58">
:</text>
</g>
<g class="choice">
<path d=" M 223 53 h 24 m 52 0 h 24" />
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="247" y="42" />
<text x="273" y="58">
Type</text>
</g>
</a>
<path d=" M 223 53 a 12 12 0 0 1 12 12 v 9 m 76 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 235 74 v 0 a 12 12 0 0 0 12 12 m 44 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="247" y="75" />
<text x="269" y="91">
...</text>
</g>
</g>
<path d=" M 175 53 h 10" />
<path d=" M 213 53 h 10" />
</g>
<path d=" M 333 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 323 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 168px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-FunctionReturnType"><svg class="railroad" viewbox="0 0 168 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-FunctionReturnType">
<text class="comment" x="78" y="25">
FunctionReturnType</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="42" />
<text x="53" y="58">
-&gt;</text>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="81" y="42" />
<text x="107" y="58">
Type</text>
</g>
</a>
<path d=" M 71 53 h 10" />
</g>
<path d=" M 143 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 133 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-items.fn.intro"><a class="rule-link" href="#r-items.fn.intro" title="items.fn.intro"><span>[items<wbr>.fn<wbr>.intro]</span></a>
</div>

<p>一个 <em>函数 (function)</em> 由一个 <a href="#块表达式">块</a>（即函数的 <em>主体 (body)</em> ）、一个名称、一组参数以及一个输出类型组成。除了名称以外，这些都是可选的。</p>
<div class="rule" id="r-items.fn.namespace"><a class="rule-link" href="#r-items.fn.namespace" title="items.fn.namespace"><span>[items<wbr>.fn<wbr>.namespace]</span></a>
</div>

<p>函数使用关键字 <code>fn</code> 声明，它在所在的模块或块的 <a href="#命名空间">值命名空间</a> 中定义给定的名称。</p>
<div class="rule" id="r-items.fn.signature"><a class="rule-link" href="#r-items.fn.signature" title="items.fn.signature"><span>[items<wbr>.fn<wbr>.signature]</span></a>
</div>

<p>函数可以通过参数声明一组 <em>输入</em> <a href="#变量"><em>变量</em></a>，调用者通过这些参数将实参传递给函数；函数还可以声明在完成后返回给调用者的值的 <em>输出</em> <a href="#type-expressions"><em>类型</em></a>。</p>
<div class="rule" id="r-items.fn.implicit-return"><a class="rule-link" href="#r-items.fn.implicit-return" title="items.fn.implicit-return"><span>[items<wbr>.fn<wbr>.implicit-return]</span></a>
</div>

<p>如果未显式说明输出类型，则默认为 <a href="#元组类型">单元类型</a>。</p>
<div class="rule" id="r-items.fn.fn-item-type"><a class="rule-link" href="#r-items.fn.fn-item-type" title="items.fn.fn-item-type"><span>[items<wbr>.fn<wbr>.fn-item-type]</span></a>
</div>

<p>当被引用时，一个 <em>函数</em> 会产生一个对应的零大小的 <a href="#函数项类型"><em>函数项类型</em></a> 的一等 <em>值</em> ，当它被调用时，会执行对该函数的直接调用。</p>
<p>例如，这是一个简单的函数：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn answer_to_life_the_universe_and_everything() -&gt; i32 {
    return 42;
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.fn.safety-qualifiers"><a class="rule-link" href="#r-items.fn.safety-qualifiers" title="items.fn.safety-qualifiers"><span>[items<wbr>.fn<wbr>.safety-qualifiers]</span></a>
</div>

<p><code>safe</code> 函数在语义上仅允许在 <a href="#外部块"><code>extern</code> 块</a> 中使用。</p>
<div class="rule" id="r-items.fn.params"><a class="rule-link" href="#r-items.fn.params" title="items.fn.params"><span>[items<wbr>.fn<wbr>.params]</span></a>
</div>

<h2 id="函数参数"><a class="header" href="#函数参数">函数参数</a></h2>
<div class="rule" id="r-items.fn.params.intro"><a class="rule-link" href="#r-items.fn.params.intro" title="items.fn.params.intro"><span>[items<wbr>.fn<wbr>.params<wbr>.intro]</span></a>
</div>

<p>函数参数是不可反驳的 <a href="#模式">模式</a>，因此任何在没有 else 的 <code>let</code> 绑定中有效的模式作为参数也同样有效：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn first((value, _): (i32, i32)) -&gt; i32 { value }
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.fn.params.self-pat"><a class="rule-link" href="#r-items.fn.params.self-pat" title="items.fn.params.self-pat"><span>[items<wbr>.fn<wbr>.params<wbr>.self-pat]</span></a>
</div>

<p>如果第一个参数是一个 <a href="#grammar-SelfParam">SelfParam</a>，这表明该函数是一个 <a href="#方法">方法</a>。</p>
<div class="rule" id="r-items.fn.params.self-restriction"><a class="rule-link" href="#r-items.fn.params.self-restriction" title="items.fn.params.self-restriction"><span>[items<wbr>.fn<wbr>.params<wbr>.self-restriction]</span></a>
</div>

<p>带有 self 参数的函数只能作为 <a href="#特型">特型</a> 或 <a href="#实现">实现</a> 中的 <a href="#associated-functions-and-methods">关联函数</a> 出现。</p>
<div class="rule" id="r-items.fn.params.varargs"><a class="rule-link" href="#r-items.fn.params.varargs" title="items.fn.params.varargs"><span>[items<wbr>.fn<wbr>.params<wbr>.varargs]</span></a>
</div>

<p>带有 <code>...</code> 词法单元 的参数表示 <a href="#variadic-functions">变参函数</a>，且只能用作 <a href="#外部块">外部块</a> 函数的最后一个参数。变参参数可以有一个可选的标识符，例如 <code>args: ...</code>。</p>
<div class="rule" id="r-items.fn.body"><a class="rule-link" href="#r-items.fn.body" title="items.fn.body"><span>[items<wbr>.fn<wbr>.body]</span></a>
</div>

<h2 id="函数主体"><a class="header" href="#函数主体">函数主体</a></h2>
<div class="rule" id="r-items.fn.body.intro"><a class="rule-link" href="#r-items.fn.body.intro" title="items.fn.body.intro"><span>[items<wbr>.fn<wbr>.body<wbr>.intro]</span></a>
</div>

<p>函数的主体块在概念上被包装在另一个块中，该块首先绑定参数模式，然后 <code>return</code> 函数主体的值。这意味着如果块的尾随表达式被求值，它最终会返回给调用者。像往常一样，函数主体内显式的返回表达式如果被执行，将短路该隐式返回。</p>
<p>例如，上述函数的行为就像它被写成：</p>
<!-- ignore: example expansion -->
<pre><code class="language-rust ignore">// argument_0 是从调用者传递的实际第一个参数
let (value, _) = argument_0;
return {
    value
};</code></pre>
<div class="rule" id="r-items.fn.body.bodyless"><a class="rule-link" href="#r-items.fn.body.bodyless" title="items.fn.body.bodyless"><span>[items<wbr>.fn<wbr>.body<wbr>.bodyless]</span></a>
</div>

<p>没有主体块的函数以分号结尾。这种形式只能出现在 <a href="#特型">特型</a> 或 <a href="#外部块">外部块</a> 中。</p>
<div class="rule" id="r-items.fn.generics"><a class="rule-link" href="#r-items.fn.generics" title="items.fn.generics"><span>[items<wbr>.fn<wbr>.generics]</span></a>
</div>

<h2 id="泛型函数"><a class="header" href="#泛型函数">泛型函数</a></h2>
<div class="rule" id="r-items.fn.generics.intro"><a class="rule-link" href="#r-items.fn.generics.intro" title="items.fn.generics.intro"><span>[items<wbr>.fn<wbr>.generics<wbr>.intro]</span></a>
</div>

<p>一个 <em>泛型函数</em> 允许在其签名中出现一个或多个 <em>参数化类型</em> 。每个类型参数必须在函数名之后、由尖括号包围且以逗号分隔的列表中显式声明。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// foo 对 A 和 B 是泛型的

fn foo&lt;A, B&gt;(x: A, y: B) {
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-items.fn.generics.param-names"><a class="rule-link" href="#r-items.fn.generics.param-names" title="items.fn.generics.param-names"><span>[items<wbr>.fn<wbr>.generics<wbr>.param-names]</span></a>
</div>

<p>在函数签名和主体内部，类型参数的名称可以用作类型名称。</p>
<div class="rule" id="r-items.fn.generics.param-bounds"><a class="rule-link" href="#r-items.fn.generics.param-bounds" title="items.fn.generics.param-bounds"><span>[items<wbr>.fn<wbr>.generics<wbr>.param-bounds]</span></a>
</div>

<p>可以为类型参数指定 <a href="#特型">特型</a> 绑定，以允许在该类型的值上调用具有该 特型 的方法。这是使用 <code>where</code> 语法指定的：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use std::fmt::Debug;
</span>fn foo&lt;T&gt;(x: T) where T: Debug {
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-items.fn.generics.mono"><a class="rule-link" href="#r-items.fn.generics.mono" title="items.fn.generics.mono"><span>[items<wbr>.fn<wbr>.generics<wbr>.mono]</span></a>
</div>

<p>当引用泛型函数时，其类型会根据引用的上下文进行实例化。例如，在这里调用 <code>foo</code> 函数：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::fmt::Debug;

fn foo&lt;T&gt;(x: &amp;[T]) where T: Debug {
    // 细节已省略
}

foo(&amp;[1, 2]);
<span class="boring">}</span></code></pre>
<p>将使用 <code>i32</code> 实例化类型参数 <code>T</code>。</p>
<div class="rule" id="r-items.fn.generics.explicit-arguments"><a class="rule-link" href="#r-items.fn.generics.explicit-arguments" title="items.fn.generics.explicit-arguments"><span>[items<wbr>.fn<wbr>.generics<wbr>.explicit-arguments]</span></a>
</div>

<p>类型参数也可以在函数名之后的尾随 <a href="#路径">路径</a> 组件中显式提供。如果没有足够的上下文来确定类型参数，这可能是必要的。例如，<code>mem::size_of::&lt;u32&gt;() == 4</code>。</p>
<div class="rule" id="r-items.fn.extern"><a class="rule-link" href="#r-items.fn.extern" title="items.fn.extern"><span>[items<wbr>.fn<wbr>.extern]</span></a>
</div>

<h2 id="extern函数限定符"><a class="header" href="#extern函数限定符">Extern函数限定符</a></h2>
<div class="rule" id="r-items.fn.extern.intro"><a class="rule-link" href="#r-items.fn.extern.intro" title="items.fn.extern.intro"><span>[items<wbr>.fn<wbr>.extern<wbr>.intro]</span></a>
</div>

<p><code>extern</code> 函数限定符允许提供可以使用特定 ABI 调用的函数 <em>定义</em> ：</p>
<!-- ignore: fake ABI -->
<pre><code class="language-rust ignore">extern "ABI" fn foo() { /* ... */ }</code></pre>
<div class="rule" id="r-items.fn.extern.def"><a class="rule-link" href="#r-items.fn.extern.def" title="items.fn.extern.def"><span>[items<wbr>.fn<wbr>.extern<wbr>.def]</span></a>
</div>

<p>这些通常与 <a href="#外部块">外部块</a> 项结合使用，后者提供函数 <em>声明</em> ，可用于调用函数而无需提供其 <em>定义</em> ：</p>
<!-- ignore: fake ABI -->
<pre><code class="language-rust ignore">unsafe extern "ABI" {
  unsafe fn foo(); /* 没有主体 */
  safe fn bar(); /* 没有主体 */
}
unsafe { foo() };
bar();</code></pre>
<div class="rule" id="r-items.fn.extern.default-abi"><a class="rule-link" href="#r-items.fn.extern.default-abi" title="items.fn.extern.default-abi"><span>[items<wbr>.fn<wbr>.extern<wbr>.default-abi]</span></a>
</div>

<p>当函数 项 的 <code>FunctionQualifiers</code> 中省略了 <code>"extern" Abi?*</code> 时，将分配 ABI <code>"Rust"</code>。例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo() {}
<span class="boring">}</span></code></pre>
<p>等同于：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>extern "Rust" fn foo() {}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.fn.extern.foreign-call"><a class="rule-link" href="#r-items.fn.extern.foreign-call" title="items.fn.extern.foreign-call"><span>[items<wbr>.fn<wbr>.extern<wbr>.foreign-call]</span></a>
</div>

<p>函数可以被外部代码调用，并且使用与 Rust 不同的 ABI 允许提供可以从其他编程语言（如 C）调用的函数：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 声明一个具有 "C" ABI 的函数
extern "C" fn new_i32() -&gt; i32 { 0 }

// 声明一个具有 "stdcall" ABI 的函数
<span class="boring">#[cfg(any(windows, target_arch = "x86"))]
</span>extern "stdcall" fn new_i32_stdcall() -&gt; i32 { 0 }
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.fn.extern.default-extern"><a class="rule-link" href="#r-items.fn.extern.default-extern" title="items.fn.extern.default-extern"><span>[items<wbr>.fn<wbr>.extern<wbr>.default-extern]</span></a>
</div>

<p>就像 <a href="#外部块">外部块</a> 一样，当使用 <code>extern</code> 关键字并省略 <code>"ABI"</code> 时，使用的 ABI 默认为 <code>"C"</code>。也就是说，这段代码：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>extern fn new_i32() -&gt; i32 { 0 }
let fptr: extern fn() -&gt; i32 = new_i32;
<span class="boring">}</span></code></pre>
<p>等同于：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>extern "C" fn new_i32() -&gt; i32 { 0 }
let fptr: extern "C" fn() -&gt; i32 = new_i32;
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.fn.extern.unwind"><a class="rule-link" href="#r-items.fn.extern.unwind" title="items.fn.extern.unwind"><span>[items<wbr>.fn<wbr>.extern<wbr>.unwind]</span></a>
</div>

<h3 id="展开unwinding"><a class="header" href="#展开unwinding">展开(Unwinding)</a></h3>
<div class="rule" id="r-items.fn.extern.unwind.intro"><a class="rule-link" href="#r-items.fn.extern.unwind.intro" title="items.fn.extern.unwind.intro"><span>[items<wbr>.fn<wbr>.extern<wbr>.unwind<wbr>.intro]</span></a>
</div>

<p>大多数 ABI 字符串有两种变体，一种带有 <code>-unwind</code> 后缀，另一种没有。<code>Rust</code> ABI 总是允许展开，因此没有 <code>Rust-unwind</code> ABI。ABI 的选择与运行时的 <a href="#the-panic_handler-attribute">恐慌处理器</a> 一起决定了从函数中展开时的行为。</p>
<div class="rule" id="r-items.fn.extern.unwind.behavior"><a class="rule-link" href="#r-items.fn.extern.unwind.behavior" title="items.fn.extern.unwind.behavior"><span>[items<wbr>.fn<wbr>.extern<wbr>.unwind<wbr>.behavior]</span></a>
</div>

<p>下表说明了展开操作到达每种类型的 ABI 边界（使用相应 ABI 字符串的函数声明或定义）时的行为。请注意，Rust 运行时不受完全发生在另一种语言运行时内部的任何展开的影响，也无法对其产生影响，即在未到达 Rust ABI 边界的情况下抛出和捕获的展开。</p>
<p><code>panic</code>-unwind 列是指通过 <code>panic!</code> 宏和类似的标准库机制进行的 <a href="#恐慌">恐慌</a>，以及任何其他导致恐慌的 Rust 操作，例如数组索引越界或整数溢出。</p>
<p>“展开” ABI 类别是指 <code>"Rust"</code>（未标记为 <code>extern</code> 的 Rust 函数的隐式 ABI）、<code>"C-unwind"</code> 以及任何名称中带有 <code>-unwind</code> 的 ABI。“非展开” ABI 类别是指所有其他 ABI 字符串，包括 <code>"C"</code> 和 <code>"stdcall"</code>。</p>
<p>原生展开是针对每个目标定义的。在支持抛出和捕获 C++ 异常的目标上，它指的是用于实现此功能的机制。某些平台实现了一种被称为 <a href="https://rust-lang.github.io/rfcs/2945-c-unwind-abi.html#forced-unwinding">“强制展开”</a> 的展开形式；Windows 上的 <code>longjmp</code> 和 <code>glibc</code> 中的 <code>pthread_exit</code> 就是这样实现的。强制展开被明确排除在表中的“原生展开”列之外。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>恐慌运行时</th><th>ABI</th><th><code>panic</code>-unwind</th><th>原生展开 (非强制)</th></tr>
</thead>
<tbody>
<tr><td><code>panic=unwind</code></td><td>展开型</td><td>展开</td><td>展开</td></tr>
<tr><td><code>panic=unwind</code></td><td>非展开型</td><td>中止 (见下文注释)</td><td><a href="#被视为未定义的行为">未定义行为</a></td></tr>
<tr><td><code>panic=abort</code></td><td>展开型</td><td><code>panic</code> 在不展开的情况下中止</td><td>中止</td></tr>
<tr><td><code>panic=abort</code></td><td>非展开型</td><td><code>panic</code> 在不展开的情况下中止</td><td><a href="#被视为未定义的行为">未定义行为</a></td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-items.fn.extern.abort"><a class="rule-link" href="#r-items.fn.extern.abort" title="items.fn.extern.abort"><span>[items<wbr>.fn<wbr>.extern<wbr>.abort]</span></a>
</div>

<p>在 <code>panic=unwind</code> 的情况下，当 恐慌 被非展开 ABI 边界转变为中止时，要么不运行任何析构函数 (<code>Drop</code> 调用)，要么运行直到 ABI 边界为止的所有析构函数。具体发生这两种行为中的哪一种是未指定的。</p>
<p>有关跨 FFI 边界展开的其他注意事项和限制，请参阅 <a href="#unwinding-across-ffi-boundaries">恐慌文档中的相关部分</a>。</p>
<div class="rule" id="r-items.fn.const"><a class="rule-link" href="#r-items.fn.const" title="items.fn.const"><span>[items<wbr>.fn<wbr>.const]</span></a>
</div>

<h2 id="const函数"><a class="header" href="#const函数">Const函数</a></h2>
<p>有关 const 函数的定义，请参阅 <a href="#const-functions">const 函数</a>。</p>
<div class="rule" id="r-items.fn.async"><a class="rule-link" href="#r-items.fn.async" title="items.fn.async"><span>[items<wbr>.fn<wbr>.async]</span></a>
</div>

<h2 id="async函数"><a class="header" href="#async函数">Async函数</a></h2>
<div class="rule" id="r-items.fn.async.intro"><a class="rule-link" href="#r-items.fn.async.intro" title="items.fn.async.intro"><span>[items<wbr>.fn<wbr>.async<wbr>.intro]</span></a>
</div>

<p>函数可以被限定为 async，这也可以与 <code>unsafe</code> 限定符结合使用：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>async fn regular_example() { }
async unsafe fn unsafe_example() { }
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.fn.async.future"><a class="rule-link" href="#r-items.fn.async.future" title="items.fn.async.future"><span>[items<wbr>.fn<wbr>.async<wbr>.future]</span></a>
</div>

<p>Async 函数在调用时不执行任何操作：相反，它们将参数捕获到一个 future 中。当被轮询时，该 future 将执行函数的主体。</p>
<div class="rule" id="r-items.fn.async.desugar-brief"><a class="rule-link" href="#r-items.fn.async.desugar-brief" title="items.fn.async.desugar-brief"><span>[items<wbr>.fn<wbr>.async<wbr>.desugar-brief]</span></a>
</div>

<p>一个 async 函数大致相当于一个返回 <a href="#impl-trait"><code>impl Future</code></a> 并且以 <a href="#async-blocks"><code>async move</code> 块</a> 作为其主体的函数：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 源码
async fn example(x: &amp;str) -&gt; usize {
    x.len()
}
<span class="boring">}</span></code></pre>
<p>大致相当于：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use std::future::Future;
</span>// 脱糖后
fn example&lt;'a&gt;(x: &amp;'a str) -&gt; impl Future&lt;Output = usize&gt; + 'a {
    async move { x.len() }
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.fn.async.desugar"><a class="rule-link" href="#r-items.fn.async.desugar" title="items.fn.async.desugar"><span>[items<wbr>.fn<wbr>.async<wbr>.desugar]</span></a>
</div>

<p>实际的脱糖过程更为复杂：</p>
<div class="rule" id="r-items.fn.async.lifetime-capture"><a class="rule-link" href="#r-items.fn.async.lifetime-capture" title="items.fn.async.lifetime-capture"><span>[items<wbr>.fn<wbr>.async<wbr>.lifetime-capture]</span></a>
</div>

<ul>
<li>脱糖中的返回类型被假定为捕获了 <code>async fn</code> 声明中的所有生命周期参数。这可以在上面的脱糖示例中看到，它显式地超过了 <code>'a</code> 的生命周期，因此捕获了 <code>'a</code>。</li>
</ul>
<div class="rule" id="r-items.fn.async.param-capture"><a class="rule-link" href="#r-items.fn.async.param-capture" title="items.fn.async.param-capture"><span>[items<wbr>.fn<wbr>.async<wbr>.param-capture]</span></a>
</div>

<ul>
<li>主体中的 <a href="#async-blocks"><code>async move</code> 块</a> 捕获了所有函数参数，包括那些未使用或绑定到 <code>_</code> 模式的参数。这确保了函数参数的销毁顺序与函数非 async 时相同，不同之处在于销毁发生在返回的 future 被完全 await 之后。</li>
</ul>
<div class="rule" id="r-items.fn.async.edition2018"><a class="rule-link" href="#r-items.fn.async.edition2018" title="items.fn.async.edition2018"><span>[items<wbr>.fn<wbr>.async<wbr>.edition2018]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p>Async 函数仅从 Rust 2018 开始可用。</p>
</blockquote>
</div>

<div class="rule" id="r-items.fn.async.safety"><a class="rule-link" href="#r-items.fn.async.safety" title="items.fn.async.safety"><span>[items<wbr>.fn<wbr>.async<wbr>.safety]</span></a>
</div>

<h3 id="结合async和unsafe"><a class="header" href="#结合async和unsafe">结合<code>async</code>和<code>unsafe</code></a></h3>
<div class="rule" id="r-items.fn.async.safety.intro"><a class="rule-link" href="#r-items.fn.async.safety.intro" title="items.fn.async.safety.intro"><span>[items<wbr>.fn<wbr>.async<wbr>.safety<wbr>.intro]</span></a>
</div>

<p>声明一个既是 async 又是 unsafe 的函数是合法的。生成的函数调用时是不安全的，并且（像任何 async 函数一样）返回一个 future。这个 future 只是一个普通的 future，因此 “await” 它不需要 <code>unsafe</code> 上下文：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 返回一个在 await 时解引用 `x` 的 future。
//
// 健全性条件：在生成的 future 完成之前，`x` 必须可以安全地解引用。
async unsafe fn unsafe_example(x: *const i32) -&gt; i32 {
  *x
}

async fn safe_example() {
    // 最初调用该函数需要 `unsafe` 块：
    let p = 22;
    let future = unsafe { unsafe_example(&amp;p) };

    // 但这里不需要 `unsafe` 块。这将
    // 读取 `p` 的值：
    let q = future.await;
}
<span class="boring">}</span></code></pre>
<p>请注意，这种行为是脱糖为返回 <code>impl Future</code> 的函数的结果 —— 在这种情况下，我们脱糖到的函数是一个 <code>unsafe</code> 函数，但返回值保持不变。</p>
<p>Unsafe 在 async 函数上的使用方式与在其他函数上的使用方式完全相同：它表明该函数对调用者施加了一些额外的义务以确保健全性。与任何其他 unsafe 函数一样，这些条件可能会延伸到初始调用本身之外 —— 例如，在上面的代码片段中，<code>unsafe_example</code> 函数接受一个指针 <code>x</code> 作为参数，然后 (在被 await 时) 解引用该指针。这意味着 <code>x</code> 必须在 future 完成执行之前保持有效，而确保这一点是调用者的责任。</p>
<div class="rule" id="r-items.fn.attributes"><a class="rule-link" href="#r-items.fn.attributes" title="items.fn.attributes"><span>[items<wbr>.fn<wbr>.attributes]</span></a>
</div>

<h2 id="函数上的属性"><a class="header" href="#函数上的属性">函数上的属性</a></h2>
<div class="rule" id="r-items.fn.attributes.intro"><a class="rule-link" href="#r-items.fn.attributes.intro" title="items.fn.attributes.intro"><span>[items<wbr>.fn<wbr>.attributes<wbr>.intro]</span></a>
</div>

<p>函数允许使用 <a href="#属性-1">外部属性</a>。<a href="#属性-1">内部属性</a> 允许直接在函数主体 <a href="#块表达式">块</a> 内部的 <code>{</code> 之后使用。</p>
<p>这个例子展示了函数上的内部属性。该函数仅使用单词 “Example” 进行文档说明。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn documented() {
    #![doc = "Example"]
}
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>除了 lint 之外，在函数 项 上仅使用外部属性是符合习惯的。</p>
</blockquote>
</div>

<div class="rule" id="r-items.fn.attributes.builtin-attributes"><a class="rule-link" href="#r-items.fn.attributes.builtin-attributes" title="items.fn.attributes.builtin-attributes"><span>[items<wbr>.fn<wbr>.attributes<wbr>.builtin-attributes]</span></a>
</div>

<p>对函数有意义的属性有：</p>
<ul>
<li><a href="#cfg_attr属性"><code>cfg_attr</code></a></li>
<li><a href="#cfg属性"><code>cfg</code></a></li>
<li><a href="#the-cold-attribute"><code>cold</code></a></li>
<li><a href="#the-deprecated-attribute"><code>deprecated</code></a></li>
<li><a href="../rustdoc/the-doc-attribute.html"><code>doc</code></a></li>
<li><a href="#the-export_name-attribute"><code>export_name</code></a></li>
<li><a href="#the-inline-attribute"><code>inline</code></a></li>
<li><a href="#the-link_section-attribute"><code>link_section</code></a></li>
<li><a href="#the-must_use-attribute"><code>must_use</code></a></li>
<li><a href="#the-no_mangle-attribute"><code>no_mangle</code></a></li>
<li><a href="#lint-check-attributes">Lint 检查属性</a></li>
<li><a href="#r-macro.proc.attribute">过程宏属性</a></li>
<li><a href="#测试属性">测试属性</a></li>
</ul>
<div class="rule" id="r-items.fn.param-attributes"><a class="rule-link" href="#r-items.fn.param-attributes" title="items.fn.param-attributes"><span>[items<wbr>.fn<wbr>.param-attributes]</span></a>
</div>

<h2 id="函数参数上的属性"><a class="header" href="#函数参数上的属性">函数参数上的属性</a></h2>
<div class="rule" id="r-items.fn.param-attributes.intro"><a class="rule-link" href="#r-items.fn.param-attributes.intro" title="items.fn.param-attributes.intro"><span>[items<wbr>.fn<wbr>.param-attributes<wbr>.intro]</span></a>
</div>

<p>函数参数允许使用 <a href="#属性-1">外部属性</a>，允许的 <a href="#built-in-attributes-index">内置属性</a> 限于 <code>cfg</code>、<code>cfg_attr</code>、<code>allow</code>、<code>warn</code>、<code>deny</code> 和 <code>forbid</code>。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn len(
    #[cfg(windows)] slice: &amp;[u16],
    #[cfg(not(windows))] slice: &amp;[u8],
) -&gt; usize {
    slice.len()
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.fn.param-attributes.parsed-attributes"><a class="rule-link" href="#r-items.fn.param-attributes.parsed-attributes" title="items.fn.param-attributes.parsed-attributes"><span>[items<wbr>.fn<wbr>.param-attributes<wbr>.parsed-attributes]</span></a>
</div>

<p>应用于 项 的 过程宏 属性所使用的惰性辅助属性也是允许的，但要注意不要在最终的 <code>TokenStream</code> 中包含这些惰性属性。</p>
<p>例如，以下代码定义了一个在任何地方都没有正式定义的惰性 <code>some_inert_attribute</code> 属性，而 <code>some_proc_macro_attribute</code> 过程宏 负责检测它的存在并将其从输出词法单元流中移除。</p>
<!-- ignore: requires proc macro -->
<pre><code class="language-rust ignore">#[some_proc_macro_attribute]
fn foo_oof(#[some_inert_attribute] arg: u8) {
}</code></pre>
<hr>
<ol class="footnote-definition">
<li id="footnote-async-edition">
<p><code>async</code> 限定符在 2015 版次中是不允许的。 <a href="#fr-async-edition-1">↩</a></p>
</li>
<li id="footnote-extern-qualifiers">
<p><em>与 Rust 2024 之前的版次相关</em> ：在 <code>extern</code> 块内部，仅当 <code>extern</code> 被限定为 <code>unsafe</code> 时，才允许使用 <code>safe</code> 或 <code>unsafe</code> 函数限定符。 <a href="#fr-extern-qualifiers-1">↩</a></p>
</li>
<li id="footnote-extern-safe">
<p><code>safe</code> 函数限定符在语义上仅允许在 <code>extern</code> 块内部。 <a href="#fr-extern-safe-1">↩</a></p>
</li>
<li id="footnote-fn-param-2015">
<p>在 2015 版次中，仅包含类型的函数参数仅允许出现在 <a href="#特型">特型项</a> 的关联函数中。 <a href="#fr-fn-param-2015-1">↩</a></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-items.type"><a class="rule-link" href="#r-items.type" title="items.type"><span>[items<wbr>.type]</span></a>
</div>

<h1 id="类型别名"><a class="header" href="#类型别名">类型别名</a></h1>
<div class="rule" id="r-items.type.syntax"><a class="rule-link" href="#r-items.type.syntax" title="items.type.syntax"><span>[items<wbr>.type<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-TypeAlias" onclick="show_railroad()"><a href="#railroad-TypeAlias">TypeAlias</a></span> → <br>    <span class="grammar-literal">type</span> <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-text"><a href="#grammar-GenericParams">GenericParams</a></span><sup>?</sup> ( <span class="grammar-literal">:</span> <span class="grammar-text"><a href="#grammar-TypeParamBounds">TypeParamBounds</a></span> )<sup>?</sup> <br>        <span class="grammar-text"><a href="#grammar-WhereClause">WhereClause</a></span><sup>?</sup> <br>        ( <span class="grammar-literal">=</span> <span class="grammar-text"><a href="#grammar-Type">Type</a></span> <span class="grammar-text"><a href="#grammar-WhereClause">WhereClause</a></span><sup>?</sup> )<sup>?</sup> <span class="grammar-literal">;</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 698px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TypeAlias"><svg class="railroad" viewbox="0 0 698 219" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TypeAlias">
<text class="comment" x="46" y="25">
TypeAlias</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="stack">
<path d=" M 35 66 h 12" />
<path d=" M 627 66 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 h -580 m 293 0 l 5 -5 m 0 10 l -5 -5 m -293 0 a 12 12 0 0 0 -12 12 v 12 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="47" y="55" />
<text x="73" y="71">
type</text>
</g>
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="109" y="55" />
<text x="159" y="71">
IDENTIFIER</text>
</g>
</a>
<g class="optional">
<path d=" M 219 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 124 m -59 0 l -5 -5 m 0 10 l 5 -5 m 59 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-GenericParams">
<g class="nonterminal">
<rect height="22" width="124" x="243" y="55" />
<text x="305" y="71">
GenericParams</text>
</g>
</a>
</g>
<g class="optional">
<path d=" M 401 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 178 m -86 0 l -5 -5 m 0 10 l 5 -5 m 86 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="425" y="55" />
<text x="439" y="71">
:</text>
</g>
<a class="link" xlink:href="#railroad-TypeParamBounds">
<g class="nonterminal">
<rect height="22" width="140" x="463" y="55" />
<text x="533" y="71">
TypeParamBounds</text>
</g>
</a>
<path d=" M 453 66 h 10" />
</g>
</g>
<path d=" M 99 66 h 10" />
<path d=" M 209 66 h 10" />
<path d=" M 391 66 h 10" />
</g>
<path d=" M 203 126 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 h -156 m 81 0 l 5 -5 m 0 10 l -5 -5 m -81 0 a 12 12 0 0 0 -12 12 v 24 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="optional">
<path d=" M 47 126 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 108 m -51 0 l -5 -5 m 0 10 l 5 -5 m 51 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-WhereClause">
<g class="nonterminal">
<rect height="22" width="108" x="71" y="115" />
<text x="125" y="131">
WhereClause</text>
</g>
</a>
</g>
</g>
<path d=" M 389 198 h 250 m -122 0 l -5 -5 m 0 10 l 5 -5 m 122 0 a 12 12 0 0 0 12 -12 v -108 m 0 57 l -5 5 m 10 0 l -5 -5 m 0 -57 a 12 12 0 0 1 12 -12" />
<g class="sequence">
<g class="optional">
<path d=" M 47 198 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -12 a 12 12 0 0 1 12 -12 h 256 m -125 0 l -5 -5 m 0 10 l 5 -5 m 125 0 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="71" y="187" />
<text x="85" y="203">
=</text>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="109" y="187" />
<text x="135" y="203">
Type</text>
</g>
</a>
<g class="optional">
<path d=" M 171 198 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 108 m -51 0 l -5 -5 m 0 10 l 5 -5 m 51 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-WhereClause">
<g class="nonterminal">
<rect height="22" width="108" x="195" y="187" />
<text x="249" y="203">
WhereClause</text>
</g>
</a>
</g>
<path d=" M 99 198 h 10" />
<path d=" M 161 198 h 10" />
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="361" y="187" />
<text x="375" y="203">
;</text>
</g>
<path d=" M 351 198 h 10" />
</g>
</g>
<path d=" M 673 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 663 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-items.type.intro"><a class="rule-link" href="#r-items.type.intro" title="items.type.intro"><span>[items<wbr>.type<wbr>.intro]</span></a>
</div>

<p><em>类型别名</em>  为其所在的模块或代码块的  <a href="#命名空间">类型命名空间</a>  中的现有  <a href="#类型">类型</a>  定义一个新名称。
类型别名使用关键字 <code>type</code> 声明。
每个值都有一个单一、具体的类型，但可能实现几个不同的 特型，并且可能与几种不同的类型约束兼容。</p>
<p>例如，下面将类型 <code>Point</code> 定义为类型 <code>(u8, u8)</code>（即 8 位无符号整数对的类型）的同义词：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>type Point = (u8, u8);
let p: Point = (41, 68);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.type.constructor-alias"><a class="rule-link" href="#r-items.type.constructor-alias" title="items.type.constructor-alias"><span>[items<wbr>.type<wbr>.constructor-alias]</span></a>
</div>

<p>指向 元组结构体 或 单元结构体 的类型别名不能用于限定该类型的构造函数：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct MyStruct(u32);

use MyStruct as UseAlias;
type TypeAlias = MyStruct;

let _ = UseAlias(5); // 正常
let _ = TypeAlias(5); // 无法工作
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.type.associated-type"><a class="rule-link" href="#r-items.type.associated-type" title="items.type.associated-type"><span>[items<wbr>.type<wbr>.associated-type]</span></a>
</div>

<p>当类型别名不作为  <a href="#associated-types">关联类型</a>  使用时，必须包含一个  <a href="#grammar-Type">类型</a>  且不得包含 <a href="#grammar-TypeParamBounds">TypeParamBounds</a>。</p>
<div class="rule" id="r-items.type.associated-trait"><a class="rule-link" href="#r-items.type.associated-trait" title="items.type.associated-trait"><span>[items<wbr>.type<wbr>.associated-trait]</span></a>
</div>

<p>当类型别名在  <a href="#特型">特型</a>  中作为  <a href="#associated-types">关联类型</a>  使用时，不得包含  <a href="#grammar-Type">类型</a>  规范，但可以包含 <a href="#grammar-TypeParamBounds">TypeParamBounds</a>。</p>
<div class="rule" id="r-items.type.associated-impl"><a class="rule-link" href="#r-items.type.associated-impl" title="items.type.associated-impl"><span>[items<wbr>.type<wbr>.associated-impl]</span></a>
</div>

<p>当类型别名在  <a href="#trait-implementations">特型实现</a>  中作为  <a href="#associated-types">关联类型</a>  使用时，必须包含一个  <a href="#grammar-Type">类型</a>  规范，且不得包含 <a href="#grammar-TypeParamBounds">TypeParamBounds</a>。</p>
<div class="rule" id="r-items.type.deprecated"><a class="rule-link" href="#r-items.type.deprecated" title="items.type.deprecated"><span>[items<wbr>.type<wbr>.deprecated]</span></a>
</div>

<p>在  <a href="#trait-implementations">特型实现</a>  的类型别名中，等号之前的 Where 子句（如 <code>type TypeAlias&lt;T&gt; where T: Foo = Bar&lt;T&gt;</code>）已被弃用。等号之后的 Where 子句（如 <code>type TypeAlias&lt;T&gt; = Bar&lt;T&gt; where T: Foo</code>）是首选。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-items.struct"><a class="rule-link" href="#r-items.struct" title="items.struct"><span>[items<wbr>.struct]</span></a>
</div>

<h1 id="结构体"><a class="header" href="#结构体">结构体</a></h1>
<div class="rule" id="r-items.struct.syntax"><a class="rule-link" href="#r-items.struct.syntax" title="items.struct.syntax"><span>[items<wbr>.struct<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-Struct" onclick="show_railroad()"><a href="#railroad-Struct">Struct</a></span> → <br>      <span class="grammar-text"><a href="#grammar-StructStruct">StructStruct</a></span> <br>    | <span class="grammar-text"><a href="#grammar-TupleStruct">TupleStruct</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-StructStruct" onclick="show_railroad()"><a href="#railroad-StructStruct">StructStruct</a></span> → <br>    <span class="grammar-literal">struct</span> <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-text"><a href="#grammar-GenericParams">GenericParams</a></span><sup>?</sup> <span class="grammar-text"><a href="#grammar-WhereClause">WhereClause</a></span><sup>?</sup> ( <span class="grammar-literal">{</span> <span class="grammar-text"><a href="#grammar-StructFields">StructFields</a></span><sup>?</sup> <span class="grammar-literal">}</span> | <span class="grammar-literal">;</span> )</p>
<p><span class="grammar-text grammar-production" id="grammar-TupleStruct" onclick="show_railroad()"><a href="#railroad-TupleStruct">TupleStruct</a></span> → <br>    <span class="grammar-literal">struct</span> <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-text"><a href="#grammar-GenericParams">GenericParams</a></span><sup>?</sup> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-TupleFields">TupleFields</a></span><sup>?</sup> <span class="grammar-literal">)</span> <span class="grammar-text"><a href="#grammar-WhereClause">WhereClause</a></span><sup>?</sup> <span class="grammar-literal">;</span></p>
<p><span class="grammar-text grammar-production" id="grammar-StructFields" onclick="show_railroad()"><a href="#railroad-StructFields">StructFields</a></span> → <span class="grammar-text"><a href="#grammar-StructField">StructField</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-StructField">StructField</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-StructField" onclick="show_railroad()"><a href="#railroad-StructField">StructField</a></span> → <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> <span class="grammar-text"><a href="#grammar-Visibility">Visibility</a></span><sup>?</sup> <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-literal">:</span> <span class="grammar-text"><a href="#grammar-Type">Type</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-TupleFields" onclick="show_railroad()"><a href="#railroad-TupleFields">TupleFields</a></span> → <span class="grammar-text"><a href="#grammar-TupleField">TupleField</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-TupleField">TupleField</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-TupleField" onclick="show_railroad()"><a href="#railroad-TupleField">TupleField</a></span> → <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> <span class="grammar-text"><a href="#grammar-Visibility">Visibility</a></span><sup>?</sup> <span class="grammar-text"><a href="#grammar-Type">Type</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 234px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Struct"><svg class="railroad" viewbox="0 0 234 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Struct">
<text class="comment" x="36" y="25">
Struct</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 116 0 h 24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-StructStruct">
<g class="nonterminal">
<rect height="22" width="116" x="59" y="42" />
<text x="117" y="58">
StructStruct</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 140 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 108 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-TupleStruct">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="75" />
<text x="113" y="91">
TupleStruct</text>
</g>
</a>
</g>
<path d=" M 209 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 199 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 894px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-StructStruct"><svg class="railroad" viewbox="0 0 894 120" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-StructStruct">
<text class="comment" x="57" y="25">
StructStruct</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="35" y="55" />
<text x="69" y="71">
struct</text>
</g>
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="113" y="55" />
<text x="163" y="71">
IDENTIFIER</text>
</g>
</a>
<g class="optional">
<path d=" M 223 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 124 m -59 0 l -5 -5 m 0 10 l 5 -5 m 59 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-GenericParams">
<g class="nonterminal">
<rect height="22" width="124" x="247" y="55" />
<text x="309" y="71">
GenericParams</text>
</g>
</a>
</g>
<g class="optional">
<path d=" M 405 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 108 m -51 0 l -5 -5 m 0 10 l 5 -5 m 51 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-WhereClause">
<g class="nonterminal">
<rect height="22" width="108" x="429" y="55" />
<text x="483" y="71">
WhereClause</text>
</g>
</a>
</g>
<g class="choice">
<path d=" M 571 66 h 24 m 240 0 h 24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="595" y="55" />
<text x="609" y="71">
{</text>
</g>
<g class="optional">
<path d=" M 633 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 116 m -55 0 l -5 -5 m 0 10 l 5 -5 m 55 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-StructFields">
<g class="nonterminal">
<rect height="22" width="116" x="657" y="55" />
<text x="715" y="71">
StructFields</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="807" y="55" />
<text x="821" y="71">
}</text>
</g>
<path d=" M 623 66 h 10" />
<path d=" M 797 66 h 10" />
</g>
<path d=" M 571 66 a 12 12 0 0 1 12 12 v 9 m 264 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 583 87 v 0 a 12 12 0 0 0 12 12 m 28 0 h 212 m -103 0 l -5 -5 m 0 10 l 5 -5 m 103 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="595" y="88" />
<text x="609" y="104">
;</text>
</g>
</g>
<path d=" M 103 66 h 10" />
<path d=" M 213 66 h 10" />
<path d=" M 395 66 h 10" />
<path d=" M 561 66 h 10" />
</g>
<path d=" M 869 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 859 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 876px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TupleStruct"><svg class="railroad" viewbox="0 0 876 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TupleStruct">
<text class="comment" x="53" y="25">
TupleStruct</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="35" y="55" />
<text x="69" y="71">
struct</text>
</g>
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="113" y="55" />
<text x="163" y="71">
IDENTIFIER</text>
</g>
</a>
<g class="optional">
<path d=" M 223 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 124 m -59 0 l -5 -5 m 0 10 l 5 -5 m 59 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-GenericParams">
<g class="nonterminal">
<rect height="22" width="124" x="247" y="55" />
<text x="309" y="71">
GenericParams</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="405" y="55" />
<text x="419" y="71">
(</text>
</g>
<g class="optional">
<path d=" M 443 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 108 m -51 0 l -5 -5 m 0 10 l 5 -5 m 51 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-TupleFields">
<g class="nonterminal">
<rect height="22" width="108" x="467" y="55" />
<text x="521" y="71">
TupleFields</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="609" y="55" />
<text x="623" y="71">
)</text>
</g>
<g class="optional">
<path d=" M 647 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 108 m -51 0 l -5 -5 m 0 10 l 5 -5 m 51 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-WhereClause">
<g class="nonterminal">
<rect height="22" width="108" x="671" y="55" />
<text x="725" y="71">
WhereClause</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="813" y="55" />
<text x="827" y="71">
;</text>
</g>
<path d=" M 103 66 h 10" />
<path d=" M 213 66 h 10" />
<path d=" M 395 66 h 10" />
<path d=" M 433 66 h 10" />
<path d=" M 599 66 h 10" />
<path d=" M 637 66 h 10" />
<path d=" M 803 66 h 10" />
</g>
<path d=" M 851 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 841 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 492px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-StructFields"><svg class="railroad" viewbox="0 0 492 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-StructFields">
<text class="comment" x="57" y="25">
StructFields</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-StructField">
<g class="nonterminal">
<rect height="22" width="108" x="35" y="55" />
<text x="89" y="71">
StructField</text>
</g>
</a>
<g class="optional">
<path d=" M 153 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 170 m -82 0 l -5 -5 m 0 10 l 5 -5 m 82 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 177 66 h 12 m 146 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -146 m 76 0 l 5 -5 m 0 10 l -5 -5 m -76 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="189" y="55" />
<text x="203" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-StructField">
<g class="nonterminal">
<rect height="22" width="108" x="227" y="55" />
<text x="281" y="71">
StructField</text>
</g>
</a>
<path d=" M 217 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 381 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="405" y="55" />
<text x="419" y="71">
,</text>
</g>
</g>
<path d=" M 143 66 h 10" />
<path d=" M 371 66 h 10" />
</g>
<path d=" M 467 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 457 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 642px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-StructField"><svg class="railroad" viewbox="0 0 642 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-StructField">
<text class="comment" x="53" y="25">
StructField</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<g class="optional">
<path d=" M 249 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-Visibility">
<g class="nonterminal">
<rect height="22" width="100" x="273" y="55" />
<text x="323" y="71">
Visibility</text>
</g>
</a>
</g>
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="407" y="55" />
<text x="457" y="71">
IDENTIFIER</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="517" y="55" />
<text x="531" y="71">
:</text>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="555" y="55" />
<text x="581" y="71">
Type</text>
</g>
</a>
<path d=" M 239 66 h 10" />
<path d=" M 397 66 h 10" />
<path d=" M 507 66 h 10" />
<path d=" M 545 66 h 10" />
</g>
<path d=" M 617 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 607 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 476px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TupleFields"><svg class="railroad" viewbox="0 0 476 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TupleFields">
<text class="comment" x="53" y="25">
TupleFields</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-TupleField">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="55" />
<text x="85" y="71">
TupleField</text>
</g>
</a>
<g class="optional">
<path d=" M 145 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 162 m -78 0 l -5 -5 m 0 10 l 5 -5 m 78 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 169 66 h 12 m 138 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -138 m 72 0 l 5 -5 m 0 10 l -5 -5 m -72 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="181" y="55" />
<text x="195" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-TupleField">
<g class="nonterminal">
<rect height="22" width="100" x="219" y="55" />
<text x="269" y="71">
TupleField</text>
</g>
</a>
<path d=" M 209 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 365 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="389" y="55" />
<text x="403" y="71">
,</text>
</g>
</g>
<path d=" M 135 66 h 10" />
<path d=" M 355 66 h 10" />
</g>
<path d=" M 451 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 441 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 494px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TupleField"><svg class="railroad" viewbox="0 0 494 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TupleField">
<text class="comment" x="50" y="25">
TupleField</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<g class="optional">
<path d=" M 249 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-Visibility">
<g class="nonterminal">
<rect height="22" width="100" x="273" y="55" />
<text x="323" y="71">
Visibility</text>
</g>
</a>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="407" y="55" />
<text x="433" y="71">
Type</text>
</g>
</a>
<path d=" M 239 66 h 10" />
<path d=" M 397 66 h 10" />
</g>
<path d=" M 469 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 459 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-items.struct.intro"><a class="rule-link" href="#r-items.struct.intro" title="items.struct.intro"><span>[items<wbr>.struct<wbr>.intro]</span></a>
</div>

<p><em>结构体</em>  是一个名义  <a href="#结构体类型">结构体类型</a> ，使用关键字 <code>struct</code> 定义。</p>
<div class="rule" id="r-items.struct.namespace"><a class="rule-link" href="#r-items.struct.namespace" title="items.struct.namespace"><span>[items<wbr>.struct<wbr>.namespace]</span></a>
</div>

<p>结构体声明在其所在的模块或代码块的  <a href="#命名空间">类型命名空间</a>  中定义给定的名称。</p>
<p>一个  <code>struct</code>  项  及其用法的示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Point {x: i32, y: i32}
let p = Point {x: 10, y: 11};
let px: i32 = p.x;
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.struct.tuple"><a class="rule-link" href="#r-items.struct.tuple" title="items.struct.tuple"><span>[items<wbr>.struct<wbr>.tuple]</span></a>
</div>

<p><em>元组结构体</em>  是一个名义  <a href="#元组类型">元组类型</a> ，也是使用关键字 <code>struct</code> 定义的。
除了定义类型外，它还在  <a href="#命名空间">值命名空间</a>  中定义了一个同名的构造函数。
构造函数是一个可以调用来创建该 结构体 新实例的函数。
例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Point(i32, i32);
let p = Point(10, 11);
let px: i32 = match p { Point(x, _) =&gt; x };
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.struct.unit"><a class="rule-link" href="#r-items.struct.unit" title="items.struct.unit"><span>[items<wbr>.struct<wbr>.unit]</span></a>
</div>

<p><em>类单元结构体</em>  是不包含任何字段的 结构体，通过完全省略字段列表来定义。此类 结构体 隐式地定义了一个与其类型同名的  <a href="#常量项">常量</a> 。例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Cookie;
let c = [Cookie, Cookie {}, Cookie, Cookie {}];
<span class="boring">}</span></code></pre>
<p>等价于</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Cookie {}
const Cookie: Cookie = Cookie {};
let c = [Cookie, Cookie {}, Cookie, Cookie {}];
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.struct.layout"><a class="rule-link" href="#r-items.struct.layout" title="items.struct.layout"><span>[items<wbr>.struct<wbr>.layout]</span></a>
</div>

<p>结构体 的精确内存布局并未指定。可以使用  <a href="#representations"><code>repr</code> 属性</a>  指定特定的布局。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-items.enum"><a class="rule-link" href="#r-items.enum" title="items.enum"><span>[items<wbr>.enum]</span></a>
</div>

<h1 id="枚举"><a class="header" href="#枚举">枚举</a></h1>
<div class="rule" id="r-items.enum.syntax"><a class="rule-link" href="#r-items.enum.syntax" title="items.enum.syntax"><span>[items<wbr>.enum<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-Enumeration" onclick="show_railroad()"><a href="#railroad-Enumeration">Enumeration</a></span> → <br>    <span class="grammar-literal">enum</span> <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-text"><a href="#grammar-GenericParams">GenericParams</a></span><sup>?</sup> <span class="grammar-text"><a href="#grammar-WhereClause">WhereClause</a></span><sup>?</sup> <span class="grammar-literal">{</span> <span class="grammar-text"><a href="#grammar-EnumVariants">EnumVariants</a></span><sup>?</sup> <span class="grammar-literal">}</span></p>
<p><span class="grammar-text grammar-production" id="grammar-EnumVariants" onclick="show_railroad()"><a href="#railroad-EnumVariants">EnumVariants</a></span> → <span class="grammar-text"><a href="#grammar-EnumVariant">EnumVariant</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-EnumVariant">EnumVariant</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-EnumVariant" onclick="show_railroad()"><a href="#railroad-EnumVariant">EnumVariant</a></span> → <br>    <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> <span class="grammar-text"><a href="#grammar-Visibility">Visibility</a></span><sup>?</sup> <br>    <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> ( <span class="grammar-text"><a href="#grammar-EnumVariantTuple">EnumVariantTuple</a></span> | <span class="grammar-text"><a href="#grammar-EnumVariantStruct">EnumVariantStruct</a></span> )<sup>?</sup> <span class="grammar-text"><a href="#grammar-EnumVariantDiscriminant">EnumVariantDiscriminant</a></span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-EnumVariantTuple" onclick="show_railroad()"><a href="#railroad-EnumVariantTuple">EnumVariantTuple</a></span> → <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-TupleFields">TupleFields</a></span><sup>?</sup> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-EnumVariantStruct" onclick="show_railroad()"><a href="#railroad-EnumVariantStruct">EnumVariantStruct</a></span> → <span class="grammar-literal">{</span> <span class="grammar-text"><a href="#grammar-StructFields">StructFields</a></span><sup>?</sup> <span class="grammar-literal">}</span></p>
<p><span class="grammar-text grammar-production" id="grammar-EnumVariantDiscriminant" onclick="show_railroad()"><a href="#railroad-EnumVariantDiscriminant">EnumVariantDiscriminant</a></span> → <span class="grammar-literal">=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 830px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Enumeration"><svg class="railroad" viewbox="0 0 830 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Enumeration">
<text class="comment" x="53" y="25">
Enumeration</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="35" y="55" />
<text x="61" y="71">
enum</text>
</g>
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="97" y="55" />
<text x="147" y="71">
IDENTIFIER</text>
</g>
</a>
<g class="optional">
<path d=" M 207 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 124 m -59 0 l -5 -5 m 0 10 l 5 -5 m 59 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-GenericParams">
<g class="nonterminal">
<rect height="22" width="124" x="231" y="55" />
<text x="293" y="71">
GenericParams</text>
</g>
</a>
</g>
<g class="optional">
<path d=" M 389 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 108 m -51 0 l -5 -5 m 0 10 l 5 -5 m 51 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-WhereClause">
<g class="nonterminal">
<rect height="22" width="108" x="413" y="55" />
<text x="467" y="71">
WhereClause</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="555" y="55" />
<text x="569" y="71">
{</text>
</g>
<g class="optional">
<path d=" M 593 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 116 m -55 0 l -5 -5 m 0 10 l 5 -5 m 55 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-EnumVariants">
<g class="nonterminal">
<rect height="22" width="116" x="617" y="55" />
<text x="675" y="71">
EnumVariants</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="767" y="55" />
<text x="781" y="71">
}</text>
</g>
<path d=" M 87 66 h 10" />
<path d=" M 197 66 h 10" />
<path d=" M 379 66 h 10" />
<path d=" M 545 66 h 10" />
<path d=" M 583 66 h 10" />
<path d=" M 757 66 h 10" />
</g>
<path d=" M 805 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 795 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 492px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-EnumVariants"><svg class="railroad" viewbox="0 0 492 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-EnumVariants">
<text class="comment" x="57" y="25">
EnumVariants</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-EnumVariant">
<g class="nonterminal">
<rect height="22" width="108" x="35" y="55" />
<text x="89" y="71">
EnumVariant</text>
</g>
</a>
<g class="optional">
<path d=" M 153 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 170 m -82 0 l -5 -5 m 0 10 l 5 -5 m 82 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 177 66 h 12 m 146 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -146 m 76 0 l 5 -5 m 0 10 l -5 -5 m -76 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="189" y="55" />
<text x="203" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-EnumVariant">
<g class="nonterminal">
<rect height="22" width="108" x="227" y="55" />
<text x="281" y="71">
EnumVariant</text>
</g>
</a>
<path d=" M 217 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 381 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="405" y="55" />
<text x="419" y="71">
,</text>
</g>
</g>
<path d=" M 143 66 h 10" />
<path d=" M 371 66 h 10" />
</g>
<path d=" M 467 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 457 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 738px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-EnumVariant"><svg class="railroad" viewbox="0 0 738 192" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-EnumVariant">
<text class="comment" x="53" y="25">
EnumVariant</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="stack">
<path d=" M 35 66 h 12" />
<path d=" M 409 66 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 1 -12 12 h -362 m 184 0 l 5 -5 m 0 10 l -5 -5 m -184 0 a 12 12 0 0 0 -12 12 v 12 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="optional">
<path d=" M 47 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 71 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="83" y="55" />
<text x="149" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<g class="optional">
<path d=" M 261 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-Visibility">
<g class="nonterminal">
<rect height="22" width="100" x="285" y="55" />
<text x="335" y="71">
Visibility</text>
</g>
</a>
</g>
<path d=" M 251 66 h 10" />
</g>
<path d=" M 679 138 h 0 a 12 12 0 0 0 12 -12 v -48 a 12 12 0 0 1 12 -12" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="47" y="127" />
<text x="97" y="143">
IDENTIFIER</text>
</g>
</a>
<g class="optional">
<path d=" M 157 138 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 204 m -99 0 l -5 -5 m 0 10 l 5 -5 m 99 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="choice">
<path d=" M 181 138 h 24 m 148 0 h 32" />
<a class="link" xlink:href="#railroad-EnumVariantTuple">
<g class="nonterminal">
<rect height="22" width="148" x="205" y="127" />
<text x="279" y="143">
EnumVariantTuple</text>
</g>
</a>
<path d=" M 181 138 a 12 12 0 0 1 12 12 v 9 m 180 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 193 159 v 0 a 12 12 0 0 0 12 12 m 156 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-EnumVariantStruct">
<g class="nonterminal">
<rect height="22" width="156" x="205" y="160" />
<text x="283" y="176">
EnumVariantStruct</text>
</g>
</a>
</g>
</g>
<g class="optional">
<path d=" M 419 138 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 212 m -103 0 l -5 -5 m 0 10 l 5 -5 m 103 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-EnumVariantDiscriminant">
<g class="nonterminal">
<rect height="22" width="212" x="443" y="127" />
<text x="549" y="143">
EnumVariantDiscriminant</text>
</g>
</a>
</g>
<path d=" M 147 138 h 10" />
<path d=" M 409 138 h 10" />
</g>
</g>
<path d=" M 713 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 703 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 302px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-EnumVariantTuple"><svg class="railroad" viewbox="0 0 302 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-EnumVariantTuple">
<text class="comment" x="71" y="25">
EnumVariantTuple</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="55" />
<text x="49" y="71">
(</text>
</g>
<g class="optional">
<path d=" M 73 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 108 m -51 0 l -5 -5 m 0 10 l 5 -5 m 51 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-TupleFields">
<g class="nonterminal">
<rect height="22" width="108" x="97" y="55" />
<text x="151" y="71">
TupleFields</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="239" y="55" />
<text x="253" y="71">
)</text>
</g>
<path d=" M 63 66 h 10" />
<path d=" M 229 66 h 10" />
</g>
<path d=" M 277 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 267 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 310px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-EnumVariantStruct"><svg class="railroad" viewbox="0 0 310 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-EnumVariantStruct">
<text class="comment" x="74" y="25">
EnumVariantStruct</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="55" />
<text x="49" y="71">
{</text>
</g>
<g class="optional">
<path d=" M 73 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 116 m -55 0 l -5 -5 m 0 10 l 5 -5 m 55 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-StructFields">
<g class="nonterminal">
<rect height="22" width="116" x="97" y="55" />
<text x="155" y="71">
StructFields</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="247" y="55" />
<text x="261" y="71">
}</text>
</g>
<path d=" M 63 66 h 10" />
<path d=" M 237 66 h 10" />
</g>
<path d=" M 285 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 275 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 208px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-EnumVariantDiscriminant"><svg class="railroad" viewbox="0 0 208 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-EnumVariantDiscriminant">
<text class="comment" x="99" y="25">
EnumVariantDiscriminant</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="42" />
<text x="49" y="58">
=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="73" y="42" />
<text x="123" y="58">
Expression</text>
</g>
</a>
<path d=" M 63 53 h 10" />
</g>
<path d=" M 183 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 173 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-items.enum.intro"><a class="rule-link" href="#r-items.enum.intro" title="items.enum.intro"><span>[items<wbr>.enum<wbr>.intro]</span></a>
</div>

<p><em>枚举</em> （也称为  <em>enum</em> ）是对名义  <a href="#枚举类型">枚举类型</a>  以及一组  <em>构造函数</em>  的同步定义，这些构造函数可用于创建或模式匹配相应枚举类型的值。</p>
<div class="rule" id="r-items.enum.decl"><a class="rule-link" href="#r-items.enum.decl" title="items.enum.decl"><span>[items<wbr>.enum<wbr>.decl]</span></a>
</div>

<p>枚举使用关键字 <code>enum</code> 声明。</p>
<div class="rule" id="r-items.enum.namespace"><a class="rule-link" href="#r-items.enum.namespace" title="items.enum.namespace"><span>[items<wbr>.enum<wbr>.namespace]</span></a>
</div>

<p><code>enum</code> 声明在其所在的模块或代码块的  <a href="#命名空间">类型命名空间</a>  中定义枚举类型。</p>
<p>一个 <code>enum</code> 项及其用法的示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum Animal {
    Dog,
    Cat,
}

let mut a: Animal = Animal::Dog;
a = Animal::Cat;
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.enum.constructor"><a class="rule-link" href="#r-items.enum.constructor" title="items.enum.constructor"><span>[items<wbr>.enum<wbr>.constructor]</span></a>
</div>

<p>枚举构造函数可以具有命名或未命名字段：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum Animal {
    Dog(String, f64),
    Cat { name: String, weight: f64 },
}

let mut a: Animal = Animal::Dog("Cocoa".to_string(), 37.2);
a = Animal::Cat { name: "Spotty".to_string(), weight: 2.7 };
<span class="boring">}</span></code></pre>
<p>在此示例中，<code>Cat</code> 是  <em>类结构体枚举变体</em> ，而 <code>Dog</code> 仅被称为枚举变体。</p>
<div class="rule" id="r-items.enum.fieldless"><a class="rule-link" href="#r-items.enum.fieldless" title="items.enum.fieldless"><span>[items<wbr>.enum<wbr>.fieldless]</span></a>
</div>

<p>不包含字段的构造函数的枚举称为 <em><span id="field-less-enum">无字段枚举</span></em> 。例如，这是一个无字段枚举：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum Fieldless {
    Tuple(),
    Struct{},
    Unit,
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.enum.unit-only"><a class="rule-link" href="#r-items.enum.unit-only" title="items.enum.unit-only"><span>[items<wbr>.enum<wbr>.unit-only]</span></a>
</div>

<p>如果无字段枚举仅包含单元变体，则该枚举称为  <em><span id="unit-only-enum">仅单元枚举</span></em> 。例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum Enum {
    Foo = 3,
    Bar = 2,
    Baz = 1,
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.enum.constructor-names"><a class="rule-link" href="#r-items.enum.constructor-names" title="items.enum.constructor-names"><span>[items<wbr>.enum<wbr>.constructor-names]</span></a>
</div>

<p>变体构造函数类似于  <a href="#结构体">结构体</a>  定义，并且可以通过枚举名称的路径进行引用，包括在  <a href="#use声明">use 声明</a>  中。</p>
<div class="rule" id="r-items.enum.constructor-namespace"><a class="rule-link" href="#r-items.enum.constructor-namespace" title="items.enum.constructor-namespace"><span>[items<wbr>.enum<wbr>.constructor-namespace]</span></a>
</div>

<p>每个变体都在  <a href="#命名空间">类型命名空间</a>  中定义其类型，尽管该类型不能用作类型说明符。
类元组和类单元变体还在  <a href="#命名空间">值命名空间</a>  中定义了一个构造函数。</p>
<div class="rule" id="r-items.enum.struct-expr"><a class="rule-link" href="#r-items.enum.struct-expr" title="items.enum.struct-expr"><span>[items<wbr>.enum<wbr>.struct-expr]</span></a>
</div>

<p>类结构体变体可以使用  <a href="#结构体表达式">结构体表达式</a>  实例化。</p>
<div class="rule" id="r-items.enum.tuple-expr"><a class="rule-link" href="#r-items.enum.tuple-expr" title="items.enum.tuple-expr"><span>[items<wbr>.enum<wbr>.tuple-expr]</span></a>
</div>

<p>类元组变体可以使用  <a href="#调用表达式">调用表达式</a>  或  <a href="#结构体表达式">结构体表达式</a>  实例化。</p>
<div class="rule" id="r-items.enum.path-expr"><a class="rule-link" href="#r-items.enum.path-expr" title="items.enum.path-expr"><span>[items<wbr>.enum<wbr>.path-expr]</span></a>
</div>

<p>类单元变体可以使用  <a href="#路径表达式">路径表达式</a>  或  <a href="#结构体表达式">结构体表达式</a>  实例化。
例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum Examples {
    UnitLike,
    TupleLike(i32),
    StructLike { value: i32 },
}

use Examples::*; // 为所有变体创建别名。
let x = UnitLike; // 常量项的路径表达式。
let x = UnitLike {}; // 结构体表达式。
let y = TupleLike(123); // 调用表达式。
let y = TupleLike { 0: 123 }; // 使用整数字段名称的结构体表达式。
let z = StructLike { value: 123 }; // 结构体表达式。
<span class="boring">}</span></code></pre>
<p><span id="custom-discriminant-values-for-fieldless-enumerations"></span></p>
<div class="rule" id="r-items.enum.discriminant"><a class="rule-link" href="#r-items.enum.discriminant" title="items.enum.discriminant"><span>[items<wbr>.enum<wbr>.discriminant]</span></a>
</div>

<h2 id="判别值"><a class="header" href="#判别值">判别值</a></h2>
<div class="rule" id="r-items.enum.discriminant.intro"><a class="rule-link" href="#r-items.enum.discriminant.intro" title="items.enum.discriminant.intro"><span>[items<wbr>.enum<wbr>.discriminant<wbr>.intro]</span></a>
</div>

<p>每个枚举实例都有一个  <em>判别值</em> ：逻辑上与之关联的整数，用于确定它持有哪个变体。</p>
<div class="rule" id="r-items.enum.discriminant.repr-rust"><a class="rule-link" href="#r-items.enum.discriminant.repr-rust" title="items.enum.discriminant.repr-rust"><span>[items<wbr>.enum<wbr>.discriminant<wbr>.repr-rust]</span></a>
</div>

<p>在  <a href="#the-rust-representation"><code>Rust</code> 表示</a>  下，判别值被解释为一个 <code>isize</code> 值。但是，编译器允许在其实际内存布局中使用更小的类型（或其他区分变体的方法）。</p>
<h3 id="分配判别值"><a class="header" href="#分配判别值">分配判别值</a></h3>
<div class="rule" id="r-items.enum.discriminant.explicit"><a class="rule-link" href="#r-items.enum.discriminant.explicit" title="items.enum.discriminant.explicit"><span>[items<wbr>.enum<wbr>.discriminant<wbr>.explicit]</span></a>
</div>

<h4 id="显式判别值"><a class="header" href="#显式判别值">显式判别值</a></h4>
<div class="rule" id="r-items.enum.discriminant.explicit.intro"><a class="rule-link" href="#r-items.enum.discriminant.explicit.intro" title="items.enum.discriminant.explicit.intro"><span>[items<wbr>.enum<wbr>.discriminant<wbr>.explicit<wbr>.intro]</span></a>
</div>

<p>在两种情况下，变体的判别值可以通过在变体名称后跟 <code>=</code> 和一个  <a href="#常量表达式">常量表达式</a>  来显式设置：</p>
<div class="rule" id="r-items.enum.discriminant.explicit.unit-only"><a class="rule-link" href="#r-items.enum.discriminant.explicit.unit-only" title="items.enum.discriminant.explicit.unit-only"><span>[items<wbr>.enum<wbr>.discriminant<wbr>.explicit<wbr>.unit-only]</span></a>
</div>

<ol>
<li>如果该枚举是  “<a href="#unit-only-enum">仅单元</a>”  的。</li>
</ol>
<div class="rule" id="r-items.enum.discriminant.explicit.primitive-repr"><a class="rule-link" href="#r-items.enum.discriminant.explicit.primitive-repr" title="items.enum.discriminant.explicit.primitive-repr"><span>[items<wbr>.enum<wbr>.discriminant<wbr>.explicit<wbr>.primitive-repr]</span></a>
</div>

<ol start="2">
<li>
<p>如果使用了  <a href="#primitive-representations">原生表示</a> 。例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[repr(u8)]
enum Enum {
    Unit = 3,
    Tuple(u16),
    Struct {
        a: u8,
        b: u16,
    } = 1,
}
<span class="boring">}</span></code></pre>
</li>
</ol>
<div class="rule" id="r-items.enum.discriminant.implicit"><a class="rule-link" href="#r-items.enum.discriminant.implicit" title="items.enum.discriminant.implicit"><span>[items<wbr>.enum<wbr>.discriminant<wbr>.implicit]</span></a>
</div>

<h4 id="隐式判别值"><a class="header" href="#隐式判别值">隐式判别值</a></h4>
<p>如果未指定变体的判别值，则将其设置为比声明中前一个变体的判别值高 1。如果声明中第一个变体的判别值未指定，则将其设置为零。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum Foo {
    Bar,            // 0
    Baz = 123,      // 123
    Quux,           // 124
}

let baz_discriminant = Foo::Baz as u32;
assert_eq!(baz_discriminant, 123);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.enum.discriminant.restrictions"><a class="rule-link" href="#r-items.enum.discriminant.restrictions" title="items.enum.discriminant.restrictions"><span>[items<wbr>.enum<wbr>.discriminant<wbr>.restrictions]</span></a>
</div>

<h4 id="限制-1"><a class="header" href="#限制-1">限制</a></h4>
<div class="rule" id="r-items.enum.discriminant.restrictions.same-discriminant"><a class="rule-link" href="#r-items.enum.discriminant.restrictions.same-discriminant" title="items.enum.discriminant.restrictions.same-discriminant"><span>[items<wbr>.enum<wbr>.discriminant<wbr>.restrictions<wbr>.same-discriminant]</span></a>
</div>

<p>当两个变体共享同一个判别值时，这是一个错误。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum SharedDiscriminantError {
    SharedA = 1,
    SharedB = 1
}

enum SharedDiscriminantError2 {
    Zero,       // 0
    One,        // 1
    OneToo = 1  // 1 (与前一个冲突！)
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.enum.discriminant.restrictions.above-max-discriminant"><a class="rule-link" href="#r-items.enum.discriminant.restrictions.above-max-discriminant" title="items.enum.discriminant.restrictions.above-max-discriminant"><span>[items<wbr>.enum<wbr>.discriminant<wbr>.restrictions<wbr>.above-max-discriminant]</span></a>
</div>

<p>如果前一个判别值是判别值大小的最大值，而在其后紧跟一个未指定的判别值，这也是一个错误。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[repr(u8)]
enum OverflowingDiscriminantError {
    Max = 255,
    MaxPlusOne // 本该是 256，但那会导致枚举溢出。
}

#[repr(u8)]
enum OverflowingDiscriminantError2 {
    MaxMinusOne = 254, // 254
    Max,               // 255
    MaxPlusOne         // 本该是 256，但那会导致枚举溢出。
}
<span class="boring">}</span></code></pre>
<h3 id="访问判别值"><a class="header" href="#访问判别值">访问判别值</a></h3>
<h4 id="通过-memdiscriminant"><a class="header" href="#通过-memdiscriminant">通过 <code>mem::discriminant</code></a></h4>
<div class="rule" id="r-items.enum.discriminant.access-opaque"><a class="rule-link" href="#r-items.enum.discriminant.access-opaque" title="items.enum.discriminant.access-opaque"><span>[items<wbr>.enum<wbr>.discriminant<wbr>.access-opaque]</span></a>
</div>

<p><a href="../core/mem/fn.discriminant.html"><code>std::mem::discriminant</code></a> 返回对枚举值判别值的不透明引用，该引用可以进行比较。这不能用于获取判别值的值。</p>
<div class="rule" id="r-items.enum.discriminant.coercion"><a class="rule-link" href="#r-items.enum.discriminant.coercion" title="items.enum.discriminant.coercion"><span>[items<wbr>.enum<wbr>.discriminant<wbr>.coercion]</span></a>
</div>

<h4 id="转换"><a class="header" href="#转换">转换</a></h4>
<div class="rule" id="r-items.enum.discriminant.coercion.intro"><a class="rule-link" href="#r-items.enum.discriminant.coercion.intro" title="items.enum.discriminant.coercion.intro"><span>[items<wbr>.enum<wbr>.discriminant<wbr>.coercion<wbr>.intro]</span></a>
</div>

<p>如果枚举是  <a href="#unit-only-enum">仅单元</a>  的（没有元组和结构体变体），则可以使用  <a href="#semantics">数值转换</a>  直接访问其判别值；例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum Enum {
    Foo,
    Bar,
    Baz,
}

assert_eq!(0, Enum::Foo as isize);
assert_eq!(1, Enum::Bar as isize);
assert_eq!(2, Enum::Baz as isize);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.enum.discriminant.coercion.fieldless"><a class="rule-link" href="#r-items.enum.discriminant.coercion.fieldless" title="items.enum.discriminant.coercion.fieldless"><span>[items<wbr>.enum<wbr>.discriminant<wbr>.coercion<wbr>.fieldless]</span></a>
</div>

<p><a href="#field-less-enum">无字段枚举</a>  在没有显式判别值，或者只有单元变体是显式的情况下，可以进行转换。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum Fieldless {
    Tuple(),
    Struct{},
    Unit,
}

assert_eq!(0, Fieldless::Tuple() as isize);
assert_eq!(1, Fieldless::Struct{} as isize);
assert_eq!(2, Fieldless::Unit as isize);

#[repr(u8)]
enum FieldlessWithDiscriminants {
    First = 10,
    Tuple(),
    Second = 20,
    Struct{},
    Unit,
}

assert_eq!(10, FieldlessWithDiscriminants::First as u8);
assert_eq!(11, FieldlessWithDiscriminants::Tuple() as u8);
assert_eq!(20, FieldlessWithDiscriminants::Second as u8);
assert_eq!(21, FieldlessWithDiscriminants::Struct{} as u8);
assert_eq!(22, FieldlessWithDiscriminants::Unit as u8);
<span class="boring">}</span></code></pre>
<h4 id="指针转换"><a class="header" href="#指针转换">指针转换</a></h4>
<div class="rule" id="r-items.enum.discriminant.access-memory"><a class="rule-link" href="#r-items.enum.discriminant.access-memory" title="items.enum.discriminant.access-memory"><span>[items<wbr>.enum<wbr>.discriminant<wbr>.access-memory]</span></a>
</div>

<p>如果枚举指定了  <a href="#primitive-representations">原生表示</a> ，则可以通过不安全的指针转换可靠地访问判别值：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[repr(u8)]
enum Enum {
    Unit,
    Tuple(bool),
    Struct{a: bool},
}

impl Enum {
    fn discriminant(&amp;self) -&gt; u8 {
        unsafe { *(self as *const Self as *const u8) }
    }
}

let unit_like = Enum::Unit;
let tuple_like = Enum::Tuple(true);
let struct_like = Enum::Struct{a: false};

assert_eq!(0, unit_like.discriminant());
assert_eq!(1, tuple_like.discriminant());
assert_eq!(2, struct_like.discriminant());
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.enum.empty"><a class="rule-link" href="#r-items.enum.empty" title="items.enum.empty"><span>[items<wbr>.enum<wbr>.empty]</span></a>
</div>

<h2 id="零变体枚举"><a class="header" href="#零变体枚举">零变体枚举</a></h2>
<div class="rule" id="r-items.enum.empty.intro"><a class="rule-link" href="#r-items.enum.empty.intro" title="items.enum.empty.intro"><span>[items<wbr>.enum<wbr>.empty<wbr>.intro]</span></a>
</div>

<p>没有变体的枚举被称为  <em>零变体枚举</em> 。因为它们没有有效值，所以无法被实例化。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum ZeroVariants {}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.enum.empty.uninhabited"><a class="rule-link" href="#r-items.enum.empty.uninhabited" title="items.enum.empty.uninhabited"><span>[items<wbr>.enum<wbr>.empty<wbr>.uninhabited]</span></a>
</div>

<p>零变体枚举等价于  <a href="#never类型">never 类型</a> ，但它们不能被强制转换为其他类型。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">enum ZeroVariants {}
</span>let x: ZeroVariants = panic!();
let y: u32 = x; // 类型不匹配错误
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.enum.variant-visibility"><a class="rule-link" href="#r-items.enum.variant-visibility" title="items.enum.variant-visibility"><span>[items<wbr>.enum<wbr>.variant-visibility]</span></a>
</div>

<h2 id="变体可见性"><a class="header" href="#变体可见性">变体可见性</a></h2>
<p>枚举变体在语法上允许使用  <a href="#grammar-Visibility">可见性</a>  注解，但在验证枚举时会被拒绝。这允许项在使用的不同上下文中以统一的语法进行解析。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! mac_variant {
    ($vis:vis $name:ident) =&gt; {
        enum $name {
            $vis Unit,

            $vis Tuple(u8, u16),

            $vis Struct { f: u8 },
        }
    }
}

// 允许空的 vis。
mac_variant! { E }

// 这是允许的，因为它在通过验证之前已被删除。
#[cfg(false)]
enum E {
    pub U,
    pub(crate) T(u8),
    pub(super) T { f: String }
}
<span class="boring">}</span></code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-items.union"><a class="rule-link" href="#r-items.union" title="items.union"><span>[items<wbr>.union]</span></a>
</div>

<h1 id="联合体"><a class="header" href="#联合体">联合体</a></h1>
<div class="rule" id="r-items.union.syntax"><a class="rule-link" href="#r-items.union.syntax" title="items.union.syntax"><span>[items<wbr>.union<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-Union" onclick="show_railroad()"><a href="#railroad-Union">Union</a></span> → <br>    <span class="grammar-literal">union</span> <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-text"><a href="#grammar-GenericParams">GenericParams</a></span><sup>?</sup> <span class="grammar-text"><a href="#grammar-WhereClause">WhereClause</a></span><sup>?</sup> <span class="grammar-literal">{</span> <span class="grammar-text"><a href="#grammar-StructFields">StructFields</a></span><sup>?</sup> <span class="grammar-literal">}</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 838px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Union"><svg class="railroad" viewbox="0 0 838 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Union">
<text class="comment" x="32" y="25">
Union</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="35" y="55" />
<text x="65" y="71">
union</text>
</g>
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="105" y="55" />
<text x="155" y="71">
IDENTIFIER</text>
</g>
</a>
<g class="optional">
<path d=" M 215 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 124 m -59 0 l -5 -5 m 0 10 l 5 -5 m 59 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-GenericParams">
<g class="nonterminal">
<rect height="22" width="124" x="239" y="55" />
<text x="301" y="71">
GenericParams</text>
</g>
</a>
</g>
<g class="optional">
<path d=" M 397 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 108 m -51 0 l -5 -5 m 0 10 l 5 -5 m 51 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-WhereClause">
<g class="nonterminal">
<rect height="22" width="108" x="421" y="55" />
<text x="475" y="71">
WhereClause</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="563" y="55" />
<text x="577" y="71">
{</text>
</g>
<g class="optional">
<path d=" M 601 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 116 m -55 0 l -5 -5 m 0 10 l 5 -5 m 55 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-StructFields">
<g class="nonterminal">
<rect height="22" width="116" x="625" y="55" />
<text x="683" y="71">
StructFields</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="775" y="55" />
<text x="789" y="71">
}</text>
</g>
<path d=" M 95 66 h 10" />
<path d=" M 205 66 h 10" />
<path d=" M 387 66 h 10" />
<path d=" M 553 66 h 10" />
<path d=" M 591 66 h 10" />
<path d=" M 765 66 h 10" />
</g>
<path d=" M 813 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 803 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-items.union.intro"><a class="rule-link" href="#r-items.union.intro" title="items.union.intro"><span>[items<wbr>.union<wbr>.intro]</span></a>
</div>

<p>联合体 声明使用与 结构体 声明相同的 语法格式，除了用 <code>union</code> 代替 <code>struct</code>。</p>
<div class="rule" id="r-items.union.namespace"><a class="rule-link" href="#r-items.union.namespace" title="items.union.namespace"><span>[items<wbr>.union<wbr>.namespace]</span></a>
</div>

<p>联合体 声明在其所在的模块或代码块的  <a href="#命名空间">类型命名空间</a>  中定义给定的名称。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[repr(C)]
union MyUnion {
    f1: u32,
    f2: f32,
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.union.common-storage"><a class="rule-link" href="#r-items.union.common-storage" title="items.union.common-storage"><span>[items<wbr>.union<wbr>.common-storage]</span></a>
</div>

<p>联合体 的关键属性是 联合体 的所有字段共享公共存储。因此，对 联合体 的一个字段进行写入可能会覆盖其其他字段，并且 联合体 的大小由其最大字段的大小决定。</p>
<div class="rule" id="r-items.union.field-restrictions"><a class="rule-link" href="#r-items.union.field-restrictions" title="items.union.field-restrictions"><span>[items<wbr>.union<wbr>.field-restrictions]</span></a>
</div>

<p>联合体 字段类型仅限于以下类型子集：</p>
<div class="rule" id="r-items.union.field-copy"><a class="rule-link" href="#r-items.union.field-copy" title="items.union.field-copy"><span>[items<wbr>.union<wbr>.field-copy]</span></a>
</div>

<ul>
<li><code>Copy</code> 类型</li>
</ul>
<div class="rule" id="r-items.union.field-references"><a class="rule-link" href="#r-items.union.field-references" title="items.union.field-references"><span>[items<wbr>.union<wbr>.field-references]</span></a>
</div>

<ul>
<li>引用（针对任意 <code>T</code> 的 <code>&amp;T</code> 和 <code>&amp;mut T</code>）</li>
</ul>
<div class="rule" id="r-items.union.field-manually-drop"><a class="rule-link" href="#r-items.union.field-manually-drop" title="items.union.field-manually-drop"><span>[items<wbr>.union<wbr>.field-manually-drop]</span></a>
</div>

<ul>
<li><code>ManuallyDrop&lt;T&gt;</code>（针对任意 <code>T</code>）</li>
</ul>
<div class="rule" id="r-items.union.field-tuple"><a class="rule-link" href="#r-items.union.field-tuple" title="items.union.field-tuple"><span>[items<wbr>.union<wbr>.field-tuple]</span></a>
</div>

<ul>
<li>仅包含允许的 联合体 字段类型的元组和数组</li>
</ul>
<div class="rule" id="r-items.union.drop"><a class="rule-link" href="#r-items.union.drop" title="items.union.drop"><span>[items<wbr>.union<wbr>.drop]</span></a>
</div>

<p>这种限制特别确保了 联合体 字段永远不需要被 drop。与 结构体 和枚举一样，可以为 联合体 <code>impl Drop</code> 以手动定义其在被 drop 时发生的情况。</p>
<div class="rule" id="r-items.union.fieldless"><a class="rule-link" href="#r-items.union.fieldless" title="items.union.fieldless"><span>[items<wbr>.union<wbr>.fieldless]</span></a>
</div>

<p>编译器不接受没有任何字段的 联合体，但宏可以接受。</p>
<div class="rule" id="r-items.union.init"><a class="rule-link" href="#r-items.union.init" title="items.union.init"><span>[items<wbr>.union<wbr>.init]</span></a>
</div>

<h2 id="初始化-联合体"><a class="header" href="#初始化-联合体">初始化 联合体</a></h2>
<div class="rule" id="r-items.union.init.intro"><a class="rule-link" href="#r-items.union.init.intro" title="items.union.init.intro"><span>[items<wbr>.union<wbr>.init<wbr>.intro]</span></a>
</div>

<p>联合体 类型的值可以使用与 结构体 类型相同的 语法格式 创建，不同之处在于它必须恰好指定一个字段：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">union MyUnion { f1: u32, f2: f32 }
</span><span class="boring">
</span>let u = MyUnion { f1: 1 };
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.union.init.result"><a class="rule-link" href="#r-items.union.init.result" title="items.union.init.result"><span>[items<wbr>.union<wbr>.init<wbr>.result]</span></a>
</div>

<p>上面的表达式创建了一个 <code>MyUnion</code> 类型的值，并使用字段 <code>f1</code> 初始化存储。可以使用与 结构体 字段相同的 语法格式 访问 联合体：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">union MyUnion { f1: u32, f2: f32 }
</span><span class="boring">
</span><span class="boring">let u = MyUnion { f1: 1 };
</span>let f = unsafe { u.f1 };
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.union.fields"><a class="rule-link" href="#r-items.union.fields" title="items.union.fields"><span>[items<wbr>.union<wbr>.fields]</span></a>
</div>

<h2 id="读写-联合体-字段"><a class="header" href="#读写-联合体-字段">读写 联合体 字段</a></h2>
<div class="rule" id="r-items.union.fields.intro"><a class="rule-link" href="#r-items.union.fields.intro" title="items.union.fields.intro"><span>[items<wbr>.union<wbr>.fields<wbr>.intro]</span></a>
</div>

<p>联合体 没有“活动字段”的概念。相反，每次对 联合体 的访问只是将存储解释为用于访问的字段的类型。</p>
<div class="rule" id="r-items.union.fields.read"><a class="rule-link" href="#r-items.union.fields.read" title="items.union.fields.read"><span>[items<wbr>.union<wbr>.fields<wbr>.read]</span></a>
</div>

<p>读取 联合体 字段会按该字段的类型读取 联合体 的位。</p>
<div class="rule" id="r-items.union.fields.offset"><a class="rule-link" href="#r-items.union.fields.offset" title="items.union.fields.offset"><span>[items<wbr>.union<wbr>.fields<wbr>.offset]</span></a>
</div>

<p>字段可能具有非零偏移量（除非使用了  <a href="#reprc-unions">C 表示</a> ）；在这种情况下，将读取从字段偏移量开始的位。</p>
<div class="rule" id="r-items.union.fields.validity"><a class="rule-link" href="#r-items.union.fields.validity" title="items.union.fields.validity"><span>[items<wbr>.union<wbr>.fields<wbr>.validity]</span></a>
</div>

<p>程序员有责任确保数据在该字段的类型下是有效的。否则会导致  <a href="#被视为未定义的行为">未定义行为</a> 。例如，从  <a href="#布尔类型">布尔类型</a>  字段中读取值 <code>3</code> 是 未定义行为。实际上，在使用  <a href="#reprc-unions">C 表示</a>  的 联合体 中，先写入然后再读取，类似于从用于写入的类型到用于读取的类型的  <a href="https://doc.rust-lang.org/core/intrinsics/fn.transmute.html"><code>transmute</code></a> 。</p>
<div class="rule" id="r-items.union.fields.read-safety"><a class="rule-link" href="#r-items.union.fields.read-safety" title="items.union.fields.read-safety"><span>[items<wbr>.union<wbr>.fields<wbr>.read-safety]</span></a>
</div>

<p>因此，所有对 联合体 字段的读取都必须放在 <code>unsafe</code> 块中：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">union MyUnion { f1: u32, f2: f32 }
</span><span class="boring">let u = MyUnion { f1: 1 };
</span><span class="boring">
</span>unsafe {
    let f = u.f1;
}
<span class="boring">}</span></code></pre>
<p>通常，使用 联合体 的代码会为不安全的 联合体 字段访问提供安全包装。</p>
<div class="rule" id="r-items.union.fields.write-safety"><a class="rule-link" href="#r-items.union.fields.write-safety" title="items.union.fields.write-safety"><span>[items<wbr>.union<wbr>.fields<wbr>.write-safety]</span></a>
</div>

<p>相比之下，对 联合体 字段的写入是安全的，因为它们只是覆盖任意数据，不会导致 未定义行为。（注意，联合体 字段类型永远不会有 drop glue，因此 联合体 字段写入永远不会隐式地 drop 任何内容。）</p>
<div class="rule" id="r-items.union.pattern"><a class="rule-link" href="#r-items.union.pattern" title="items.union.pattern"><span>[items<wbr>.union<wbr>.pattern]</span></a>
</div>

<h2 id="在-联合体-上进行模式匹配"><a class="header" href="#在-联合体-上进行模式匹配">在 联合体 上进行模式匹配</a></h2>
<div class="rule" id="r-items.union.pattern.intro"><a class="rule-link" href="#r-items.union.pattern.intro" title="items.union.pattern.intro"><span>[items<wbr>.union<wbr>.pattern<wbr>.intro]</span></a>
</div>

<p>另一种访问 联合体 字段的方法是使用模式匹配。</p>
<div class="rule" id="r-items.union.pattern.one-field"><a class="rule-link" href="#r-items.union.pattern.one-field" title="items.union.pattern.one-field"><span>[items<wbr>.union<wbr>.pattern<wbr>.one-field]</span></a>
</div>

<p>在 联合体 字段上进行模式匹配使用与 结构体 模式相同的 语法格式，但模式必须恰好指定一个字段。</p>
<div class="rule" id="r-items.union.pattern.safety"><a class="rule-link" href="#r-items.union.pattern.safety" title="items.union.pattern.safety"><span>[items<wbr>.union<wbr>.pattern<wbr>.safety]</span></a>
</div>

<p>由于模式匹配就像使用特定字段读取 联合体，因此它也必须放在 <code>unsafe</code> 块中。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">union MyUnion { f1: u32, f2: f32 }
</span><span class="boring">
</span>fn f(u: MyUnion) {
    unsafe {
        match u {
            MyUnion { f1: 10 } =&gt; { println!("ten"); }
            MyUnion { f2 } =&gt; { println!("{}", f2); }
        }
    }
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.union.pattern.subpattern"><a class="rule-link" href="#r-items.union.pattern.subpattern" title="items.union.pattern.subpattern"><span>[items<wbr>.union<wbr>.pattern<wbr>.subpattern]</span></a>
</div>

<p>模式匹配可以将 联合体 作为更大结构的一个字段进行匹配。特别是，当使用 Rust 联合体 通过 FFI 实现 C 标签联合体时，这允许同时对标签和相应的字段进行匹配：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[repr(u32)]
enum Tag { I, F }

#[repr(C)]
union U {
    i: i32,
    f: f32,
}

#[repr(C)]
struct Value {
    tag: Tag,
    u: U,
}

fn is_zero(v: Value) -&gt; bool {
    unsafe {
        match v {
            Value { tag: Tag::I, u: U { i: 0 } } =&gt; true,
            Value { tag: Tag::F, u: U { f: num } } if num == 0.0 =&gt; true,
            _ =&gt; false,
        }
    }
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.union.ref"><a class="rule-link" href="#r-items.union.ref" title="items.union.ref"><span>[items<wbr>.union<wbr>.ref]</span></a>
</div>

<h2 id="指向-联合体-字段的引用"><a class="header" href="#指向-联合体-字段的引用">指向 联合体 字段的引用</a></h2>
<div class="rule" id="r-items.union.ref.intro"><a class="rule-link" href="#r-items.union.ref.intro" title="items.union.ref.intro"><span>[items<wbr>.union<wbr>.ref<wbr>.intro]</span></a>
</div>

<p>由于 联合体 字段共享公共存储，获得对 联合体 一个字段的写访问权可能会获得对其所有其余字段的写访问权。</p>
<div class="rule" id="r-items.union.ref.borrow"><a class="rule-link" href="#r-items.union.ref.borrow" title="items.union.ref.borrow"><span>[items<wbr>.union<wbr>.ref<wbr>.borrow]</span></a>
</div>

<p>借用检查规则必须进行调整以考虑到这一事实。因此，如果 联合体 的一个字段被借用，其所有其余字段也会在相同的生命周期内被借用。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">union MyUnion { f1: u32, f2: f32 }
</span>// 错误：一次不能多次将 `u`（通过 `u.f2`）借用为可变
fn test() {
    let mut u = MyUnion { f1: 1 };
    unsafe {
        let b1 = &amp;mut u.f1;
//                    ---- 第一次可变借用发生在这里（通过 `u.f1`）
        let b2 = &amp;mut u.f2;
//                    ^^^^ 第二次可变借用发生在这里（通过 `u.f2`）
        *b1 = 5;
    }
//  - 第一次借用在这里结束
    assert_eq!(unsafe { u.f1 }, 5);
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.union.ref.usage"><a class="rule-link" href="#r-items.union.ref.usage" title="items.union.ref.usage"><span>[items<wbr>.union<wbr>.ref<wbr>.usage]</span></a>
</div>

<p>如你所见，在许多方面（除了布局、安全性和所有权），联合体 的行为与 结构体 完全相同，这在很大程度上是由于继承了 结构体 的 语法格式 形状。对于 Rust 语言中许多未提及的方面也是如此（如私有性、名称解析、类型推导、 泛型 、 特型 实现、固有实现、一致性、模式检查等等）。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-items.const"><a class="rule-link" href="#r-items.const" title="items.const"><span>[items<wbr>.const]</span></a>
</div>

<h1 id="常量项"><a class="header" href="#常量项">常量项</a></h1>
<div class="rule" id="r-items.const.syntax"><a class="rule-link" href="#r-items.const.syntax" title="items.const.syntax"><span>[items<wbr>.const<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ConstantItem" onclick="show_railroad()"><a href="#railroad-ConstantItem">ConstantItem</a></span> → <br>    <span class="grammar-literal">const</span> ( <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> | <span class="grammar-literal">_</span> ) <span class="grammar-literal">:</span> <span class="grammar-text"><a href="#grammar-Type">Type</a></span> ( <span class="grammar-literal">=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> )<sup>?</sup> <span class="grammar-literal">;</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 622px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ConstantItem"><svg class="railroad" viewbox="0 0 622 120" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ConstantItem">
<text class="comment" x="57" y="25">
ConstantItem</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="35" y="55" />
<text x="65" y="71">
const</text>
</g>
<g class="choice">
<path d=" M 105 66 h 24 m 100 0 h 24" />
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="129" y="55" />
<text x="179" y="71">
IDENTIFIER</text>
</g>
</a>
<path d=" M 105 66 a 12 12 0 0 1 12 12 v 9 m 124 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 117 87 v 0 a 12 12 0 0 0 12 12 m 28 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="129" y="88" />
<text x="143" y="104">
_</text>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="263" y="55" />
<text x="277" y="71">
:</text>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="301" y="55" />
<text x="327" y="71">
Type</text>
</g>
</a>
<g class="optional">
<path d=" M 363 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 138 m -66 0 l -5 -5 m 0 10 l 5 -5 m 66 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="387" y="55" />
<text x="401" y="71">
=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="425" y="55" />
<text x="475" y="71">
Expression</text>
</g>
</a>
<path d=" M 415 66 h 10" />
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="559" y="55" />
<text x="573" y="71">
;</text>
</g>
<path d=" M 95 66 h 10" />
<path d=" M 253 66 h 10" />
<path d=" M 291 66 h 10" />
<path d=" M 353 66 h 10" />
<path d=" M 549 66 h 10" />
</g>
<path d=" M 597 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 587 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-items.const.intro"><a class="rule-link" href="#r-items.const.intro" title="items.const.intro"><span>[items<wbr>.const<wbr>.intro]</span></a>
</div>

<p><em>常量项</em>  是一个可选命名的  <a href="#常量表达式">常量值</a> ，它不与程序中特定的内存位置相关联。</p>
<div class="rule" id="r-items.const.behavior"><a class="rule-link" href="#r-items.const.behavior" title="items.const.behavior"><span>[items<wbr>.const<wbr>.behavior]</span></a>
</div>

<p>常量在本质上是在其被使用的地方内联的，这意味着在使用时它们被直接复制到相关的上下文中。这包括使用来自外部 crate 的常量，以及非 <a href="#copy"><code>Copy</code></a> 类型。指向同一常量的引用不一定保证指向相同的内存地址。</p>
<div class="rule" id="r-items.const.namespace"><a class="rule-link" href="#r-items.const.namespace" title="items.const.namespace"><span>[items<wbr>.const<wbr>.namespace]</span></a>
</div>

<p>常量声明在其所在的模块或代码块的  <a href="#命名空间">值命名空间</a>  中定义常量值。</p>
<div class="rule" id="r-items.const.static"><a class="rule-link" href="#r-items.const.static" title="items.const.static"><span>[items<wbr>.const<wbr>.static]</span></a>
</div>

<p>常量必须显式指定类型。该类型必须具有 <code>'static</code> 生命周期：初始化程序中的任何引用都必须具有 <code>'static</code> 生命周期。常量类型中的引用默认为 <code>'static</code> 生命周期；请参见  <a href="#const-and-static-elision">静态生命周期省略</a> 。</p>
<div class="rule" id="r-items.const.static-temporary"><a class="rule-link" href="#r-items.const.static-temporary" title="items.const.static-temporary"><span>[items<wbr>.const<wbr>.static-temporary]</span></a>
</div>

<p>如果常量值符合  <a href="#r-destructors.scope.const-promotion">提升</a>  条件，则指向该常量的引用将具有 <code>'static</code> 生命周期；否则，将创建一个临时变量。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>const BIT1: u32 = 1 &lt;&lt; 0;
const BIT2: u32 = 1 &lt;&lt; 1;

const BITS: [u32; 2] = [BIT1, BIT2];
const STRING: &amp;'static str = "bitstring";

struct BitsNStrings&lt;'a&gt; {
    mybits: [u32; 2],
    mystring: &amp;'a str,
}

const BITS_N_STRINGS: BitsNStrings&lt;'static&gt; = BitsNStrings {
    mybits: BITS,
    mystring: STRING,
};
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.const.expr-omission"><a class="rule-link" href="#r-items.const.expr-omission" title="items.const.expr-omission"><span>[items<wbr>.const<wbr>.expr-omission]</span></a>
</div>

<p>常量表达式仅在  <a href="#特型">特型定义</a>  中可以省略。</p>
<div class="rule" id="r-items.const.destructor"><a class="rule-link" href="#r-items.const.destructor" title="items.const.destructor"><span>[items<wbr>.const<wbr>.destructor]</span></a>
</div>

<h2 id="带有析构函数的常量"><a class="header" href="#带有析构函数的常量">带有析构函数的常量</a></h2>
<p>常量可以包含析构函数。当值超出作用域时，析构函数将运行。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct TypeWithDestructor(i32);

impl Drop for TypeWithDestructor {
    fn drop(&amp;mut self) {
        println!("Dropped. Held {}.", self.0);
    }
}

const ZERO_WITH_DESTRUCTOR: TypeWithDestructor = TypeWithDestructor(0);

fn create_and_drop_zero_with_destructor() {
    let x = ZERO_WITH_DESTRUCTOR;
    // x 在函数结束时被 drop，调用 drop。
    // 打印 "Dropped. Held 0."。
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.const.unnamed"><a class="rule-link" href="#r-items.const.unnamed" title="items.const.unnamed"><span>[items<wbr>.const<wbr>.unnamed]</span></a>
</div>

<h2 id="匿名常量"><a class="header" href="#匿名常量">匿名常量</a></h2>
<div class="rule" id="r-items.const.unnamed.intro"><a class="rule-link" href="#r-items.const.unnamed.intro" title="items.const.unnamed.intro"><span>[items<wbr>.const<wbr>.unnamed<wbr>.intro]</span></a>
</div>

<p>与  <a href="#associated-constants">关联常量</a>  不同， <a href="#自由项">自由</a>  常量可以通过使用下划线代替名称来保持匿名。例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>const _: () =  { struct _SameNameTwice; };

// 尽管名称与上面相同，但是 OK 的：
const _: () =  { struct _SameNameTwice; };
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.const.unnamed.repetition"><a class="rule-link" href="#r-items.const.unnamed.repetition" title="items.const.unnamed.repetition"><span>[items<wbr>.const<wbr>.unnamed<wbr>.repetition]</span></a>
</div>

<p>与  <a href="#下划线导入-1">下划线导入</a>  一样，宏可以在同一作用域内安全地多次生成同一个匿名常量。例如，以下代码不应产生错误：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! m {
    ($item: item) =&gt; { $item $item }
}

m!(const _: () = (););
// 这将展开为：
// const _: () = ();
// const _: () = ();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.const.eval"><a class="rule-link" href="#r-items.const.eval" title="items.const.eval"><span>[items<wbr>.const<wbr>.eval]</span></a>
</div>

<h2 id="求值"><a class="header" href="#求值">求值</a></h2>
<p><a href="#自由项">自由</a>  常量始终在编译时  <a href="#常量求值">求值</a>  以暴露 恐慌。即使在未使用的函数中也会发生这种情况：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 编译时恐慌
const PANIC: () = std::unimplemented!();

fn unused_generic_function&lt;T&gt;() {
    // 失败的编译时断言
    const _: () = assert!(usize::BITS == 0);
}
<span class="boring">}</span></code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-items.static"><a class="rule-link" href="#r-items.static" title="items.static"><span>[items<wbr>.static]</span></a>
</div>

<h1 id="静态项"><a class="header" href="#静态项">静态项</a></h1>
<div class="rule" id="r-items.static.syntax"><a class="rule-link" href="#r-items.static.syntax" title="items.static.syntax"><span>[items<wbr>.static<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-StaticItem" onclick="show_railroad()"><a href="#railroad-StaticItem">StaticItem</a></span> → <br>    <span class="grammar-text"><a href="#grammar-ItemSafety">ItemSafety</a></span><sup>?</sup>​<sup class="footnote-reference" id="fr-extern-safety-1"><a href="#footnote-extern-safety">1</a></sup> <span class="grammar-literal">static</span> <span class="grammar-literal">mut</span><sup>?</sup> <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-literal">:</span> <span class="grammar-text"><a href="#grammar-Type">Type</a></span> ( <span class="grammar-literal">=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> )<sup>?</sup> <span class="grammar-literal">;</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 842px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-StaticItem"><svg class="railroad" viewbox="0 0 842 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-StaticItem">
<text class="comment" x="50" y="25">
StaticItem</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-ItemSafety">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="55" />
<text x="109" y="71">
ItemSafety</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="193" y="55" />
<text x="227" y="71">
static</text>
</g>
<g class="optional">
<path d=" M 271 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 44 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="295" y="55" />
<text x="317" y="71">
mut</text>
</g>
</g>
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="373" y="55" />
<text x="423" y="71">
IDENTIFIER</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="483" y="55" />
<text x="497" y="71">
:</text>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="521" y="55" />
<text x="547" y="71">
Type</text>
</g>
</a>
<g class="optional">
<path d=" M 583 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 138 m -66 0 l -5 -5 m 0 10 l 5 -5 m 66 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="607" y="55" />
<text x="621" y="71">
=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="645" y="55" />
<text x="695" y="71">
Expression</text>
</g>
</a>
<path d=" M 635 66 h 10" />
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="779" y="55" />
<text x="793" y="71">
;</text>
</g>
<path d=" M 183 66 h 10" />
<path d=" M 261 66 h 10" />
<path d=" M 363 66 h 10" />
<path d=" M 473 66 h 10" />
<path d=" M 511 66 h 10" />
<path d=" M 573 66 h 10" />
<path d=" M 769 66 h 10" />
</g>
<path d=" M 817 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 807 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-items.static.intro"><a class="rule-link" href="#r-items.static.intro" title="items.static.intro"><span>[items<wbr>.static<wbr>.intro]</span></a>
</div>

<p>一个  <em>静态项</em>  与 <a href="#常量项">常量项</a> 类似，不同之处在于它表示程序中由初始化表达式初始化的分配。指向该 静态项 的所有引用和裸指针都指向同一个分配。</p>
<div class="rule" id="r-items.static.lifetime"><a class="rule-link" href="#r-items.static.lifetime" title="items.static.lifetime"><span>[items<wbr>.static<wbr>.lifetime]</span></a>
</div>

<p>静态项 具有 <code>static</code> 生命周期，它比 Rust 程序中的所有其他生命周期都要长。 静态项 在程序结束时不会调用 <a href="#析构函数"><code>drop</code></a>。</p>
<div class="rule" id="r-items.static.storage-disjointness"><a class="rule-link" href="#r-items.static.storage-disjointness" title="items.static.storage-disjointness"><span>[items<wbr>.static<wbr>.storage-disjointness]</span></a>
</div>

<p>如果 <code>static</code> 的大小至少为 1 字节，则此分配与所有其他此类 <code>static</code> 分配以及堆分配和栈分配变量是不相交的。然而，不可变  <em>静态项</em>  的存储可以与自身没有唯一地址的分配重叠，例如 <a href="#constant-promotion">提升项</a> 和 <a href="#常量项"><code>const</code> 项</a>。</p>
<div class="rule" id="r-items.static.namespace"><a class="rule-link" href="#r-items.static.namespace" title="items.static.namespace"><span>[items<wbr>.static<wbr>.namespace]</span></a>
</div>

<p>静态声明在它所在的模块或块的 <a href="#命名空间">值命名空间</a> 中定义了一个静态值。</p>
<div class="rule" id="r-items.static.init"><a class="rule-link" href="#r-items.static.init" title="items.static.init"><span>[items<wbr>.static<wbr>.init]</span></a>
</div>

<p>静态初始化器是一个在编译时求值的 <a href="#常量表达式">常量表达式</a>。静态初始化器可以引用并读取其他 静态项。从可变 静态项 读取时，它们读取该 静态项 的初始值。</p>
<div class="rule" id="r-items.static.read-only"><a class="rule-link" href="#r-items.static.read-only" title="items.static.read-only"><span>[items<wbr>.static<wbr>.read-only]</span></a>
</div>

<p>包含非 <a href="#内部可变性">内部可变</a> 类型的非 <code>mut</code> 静态项 可能会被放置在只读内存中。</p>
<div class="rule" id="r-items.static.safety"><a class="rule-link" href="#r-items.static.safety" title="items.static.safety"><span>[items<wbr>.static<wbr>.safety]</span></a>
</div>

<p>对 静态项 的所有访问都是安全的，但对 静态项 有一些限制：</p>
<div class="rule" id="r-items.static.sync"><a class="rule-link" href="#r-items.static.sync" title="items.static.sync"><span>[items<wbr>.static<wbr>.sync]</span></a>
</div>

<ul>
<li>类型必须具有 <a href="https://doc.rust-lang.org/core/marker/trait.Sync.html"><code>Sync</code></a> 特型 绑定以允许线程安全访问。</li>
</ul>
<div class="rule" id="r-items.static.init.omission"><a class="rule-link" href="#r-items.static.init.omission" title="items.static.init.omission"><span>[items<wbr>.static<wbr>.init<wbr>.omission]</span></a>
</div>

<p>初始化表达式在 <a href="#外部块">外部块</a> 中必须省略，而在自由 静态项 中必须提供。</p>
<div class="rule" id="r-items.static.safety-qualifiers"><a class="rule-link" href="#r-items.static.safety-qualifiers" title="items.static.safety-qualifiers"><span>[items<wbr>.static<wbr>.safety-qualifiers]</span></a>
</div>

<p>从语义上讲，<code>safe</code> 和 <code>unsafe</code> 限定符仅在 <a href="#外部块">外部块</a> 中使用时才被允许。</p>
<div class="rule" id="r-items.static.generics"><a class="rule-link" href="#r-items.static.generics" title="items.static.generics"><span>[items<wbr>.static<wbr>.generics]</span></a>
</div>

<h2 id="静态项与泛型"><a class="header" href="#静态项与泛型">静态项与泛型</a></h2>
<p>在 泛型 作用域（例如在全覆盖实现或默认实现）中定义的 静态项 将导致仅定义一个 静态项，就好像静态定义从当前作用域提取到了模块中一样。每一单态化实例将  <em>不</em>  有一个 项。</p>
<p>这段代码：</p>
<pre class="playground"><code class="language-rust edition2024">use std::sync::atomic::{AtomicUsize, Ordering};

trait Tr {
    fn default_impl() {
        static COUNTER: AtomicUsize = AtomicUsize::new(0);
        println!("default_impl: counter was {}", COUNTER.fetch_add(1, Ordering::Relaxed));
    }

    fn blanket_impl();
}

struct Ty1 {}
struct Ty2 {}

impl&lt;T&gt; Tr for T {
    fn blanket_impl() {
        static COUNTER: AtomicUsize = AtomicUsize::new(0);
        println!("blanket_impl: counter was {}", COUNTER.fetch_add(1, Ordering::Relaxed));
    }
}

fn main() {
    &lt;Ty1 as Tr&gt;::default_impl();
    &lt;Ty2 as Tr&gt;::default_impl();
    &lt;Ty1 as Tr&gt;::blanket_impl();
    &lt;Ty2 as Tr&gt;::blanket_impl();
}</code></pre>
<p>打印：</p>
<pre><code class="language-text">default_impl: counter was 0
default_impl: counter was 1
blanket_impl: counter was 0
blanket_impl: counter was 1
</code></pre>
<div class="rule" id="r-items.static.mut"><a class="rule-link" href="#r-items.static.mut" title="items.static.mut"><span>[items<wbr>.static<wbr>.mut]</span></a>
</div>

<h2 id="可变静态项"><a class="header" href="#可变静态项">可变静态项</a></h2>
<div class="rule" id="r-items.static.mut.intro"><a class="rule-link" href="#r-items.static.mut.intro" title="items.static.mut.intro"><span>[items<wbr>.static<wbr>.mut<wbr>.intro]</span></a>
</div>

<p>如果 静态项 使用 <code>mut</code> 关键字声明，则允许程序对其进行修改。Rust 的目标之一是使并发错误难以发生，而这显然是竞争条件或其他错误的一个非常大的来源。</p>
<div class="rule" id="r-items.static.mut.safety"><a class="rule-link" href="#r-items.static.mut.safety" title="items.static.mut.safety"><span>[items<wbr>.static<wbr>.mut<wbr>.safety]</span></a>
</div>

<p>出于这个原因，在读取或写入可变静态变量时都需要 <code>unsafe</code> 块。应注意确保对可变静态项的修改相对于在同一进程中运行的其他线程是安全的。</p>
<div class="rule" id="r-items.static.mut.extern"><a class="rule-link" href="#r-items.static.mut.extern" title="items.static.mut.extern"><span>[items<wbr>.static<wbr>.mut<wbr>.extern]</span></a>
</div>

<p>然而，可变静态项仍然非常有用。它们可以与 C 库一起使用，也可以在 <code>extern</code> 块中从 C 库绑定。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn atomic_add(_: *mut u32, _: u32) -&gt; u32 { 2 }
</span>
static mut LEVELS: u32 = 0;

// 这违反了无共享状态的想法，且这在内部不防御竞争，因此这个函数是 `unsafe` 的
unsafe fn bump_levels_unsafe() -&gt; u32 {
    unsafe {
        let ret = LEVELS;
        LEVELS += 1;
        return ret;
    }
}

// 作为 `bump_levels_unsafe` 的替代方案，假设我们有一个返回旧值的 atomic_add 函数，那么这个函数就是安全的。
// 只有在没有其他代码以非原子方式访问该静态项的情况下，此函数才是安全的。
// 如果此类访问是可能的（例如在 `bump_levels_unsafe` 中），那么这将需要是 `unsafe` 的，
// 以向调用者指示他们仍必须防范并发访问。
fn bump_levels_safe() -&gt; u32 {
    unsafe {
        return atomic_add(&amp;raw mut LEVELS, 1);
    }
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.static.mut.sync"><a class="rule-link" href="#r-items.static.mut.sync" title="items.static.mut.sync"><span>[items<wbr>.static<wbr>.mut<wbr>.sync]</span></a>
</div>

<p>可变静态项具有与普通 静态项 相同的限制，但类型不必实现 <code>Sync</code> 特型。</p>
<div class="rule" id="r-items.static.alternate"><a class="rule-link" href="#r-items.static.alternate" title="items.static.alternate"><span>[items<wbr>.static<wbr>.alternate]</span></a>
</div>

<h2 id="使用静态项或常量项"><a class="header" href="#使用静态项或常量项">使用静态项或常量项</a></h2>
<p>使用 常量项 还是 静态项 可能会令人困惑。通常情况下，应优先使用 常量项 而非 静态项，除非满足以下条件之一：</p>
<ul>
<li>正在存储大量数据。</li>
<li>需要 静态项 的单地址属性。</li>
<li>需要内部可变性。</li>
</ul>
<hr>
<ol class="footnote-definition">
<li id="footnote-extern-safety">
<p><code>safe</code> 和 <code>unsafe</code> 函数限定符在语义上仅允许在 <code>extern</code> 块中使用。 <a href="#fr-extern-safety-1">↩</a></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-items.traits"><a class="rule-link" href="#r-items.traits" title="items.traits"><span>[items<wbr>.traits]</span></a>
</div>

<h1 id="特型"><a class="header" href="#特型">特型</a></h1>
<div class="rule" id="r-items.traits.syntax"><a class="rule-link" href="#r-items.traits.syntax" title="items.traits.syntax"><span>[items<wbr>.traits<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-Trait" onclick="show_railroad()"><a href="#railroad-Trait">Trait</a></span> → <br>    <span class="grammar-literal">unsafe</span><sup>?</sup> <span class="grammar-literal">trait</span> <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-text"><a href="#grammar-GenericParams">GenericParams</a></span><sup>?</sup> ( <span class="grammar-literal">:</span> <span class="grammar-text"><a href="#grammar-TypeParamBounds">TypeParamBounds</a></span><sup>?</sup> )<sup>?</sup> <span class="grammar-text"><a href="#grammar-WhereClause">WhereClause</a></span><sup>?</sup> <br>    <span class="grammar-literal">{</span> <br>        <span class="grammar-text"><a href="#grammar-InnerAttribute">InnerAttribute</a></span><sup>*</sup> <br>        <span class="grammar-text"><a href="#grammar-AssociatedItem">AssociatedItem</a></span><sup>*</sup> <br>    <span class="grammar-literal">}</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 1046px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Trait"><svg class="railroad" viewbox="0 0 1046 339" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Trait">
<text class="comment" x="32" y="25">
Trait</text>
</a>
<g class="sequence">
<path d=" M 10 78 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="stack">
<path d=" M 35 78 h 12" />
<path d=" M 975 78 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 h -928 m 467 0 l 5 -5 m 0 10 l -5 -5 m -467 0 a 12 12 0 0 0 -12 12 v 0 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="optional">
<path d=" M 47 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 68 m -31 0 l -5 -5 m 0 10 l 5 -5 m 31 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="71" y="67" />
<text x="105" y="83">
unsafe</text>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="173" y="67" />
<text x="203" y="83">
trait</text>
</g>
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="243" y="67" />
<text x="293" y="83">
IDENTIFIER</text>
</g>
</a>
<g class="optional">
<path d=" M 353 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 124 m -59 0 l -5 -5 m 0 10 l 5 -5 m 59 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-GenericParams">
<g class="nonterminal">
<rect height="22" width="124" x="377" y="67" />
<text x="439" y="83">
GenericParams</text>
</g>
</a>
</g>
<g class="optional">
<path d=" M 535 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -12 a 12 12 0 0 1 12 -12 h 226 m -110 0 l -5 -5 m 0 10 l 5 -5 m 110 0 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="559" y="67" />
<text x="573" y="83">
:</text>
</g>
<g class="optional">
<path d=" M 597 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 140 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-TypeParamBounds">
<g class="nonterminal">
<rect height="22" width="140" x="621" y="67" />
<text x="691" y="83">
TypeParamBounds</text>
</g>
</a>
</g>
<path d=" M 587 78 h 10" />
</g>
</g>
<g class="optional">
<path d=" M 819 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 108 m -51 0 l -5 -5 m 0 10 l 5 -5 m 51 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-WhereClause">
<g class="nonterminal">
<rect height="22" width="108" x="843" y="67" />
<text x="897" y="83">
WhereClause</text>
</g>
</a>
</g>
<path d=" M 163 78 h 10" />
<path d=" M 233 78 h 10" />
<path d=" M 343 78 h 10" />
<path d=" M 525 78 h 10" />
<path d=" M 809 78 h 10" />
</g>
<path d=" M 75 126 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 h -28 a 12 12 0 0 0 -12 12 v 12 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="47" y="115" />
<text x="61" y="131">
{</text>
</g>
</g>
<path d=" M 251 186 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 1 -12 12 h -204 m 105 0 l 5 -5 m 0 10 l -5 -5 m -105 0 a 12 12 0 0 0 -12 12 v 12 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="optional">
<path d=" M 47 186 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 71 186 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-InnerAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="83" y="175" />
<text x="149" y="191">
InnerAttribute</text>
</g>
</a>
</g>
</g>
</g>
<path d=" M 251 258 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 1 -12 12 h -204 m 105 0 l 5 -5 m 0 10 l -5 -5 m -105 0 a 12 12 0 0 0 -12 12 v 0 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="optional">
<path d=" M 47 258 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 71 258 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-AssociatedItem">
<g class="nonterminal">
<rect height="22" width="132" x="83" y="247" />
<text x="149" y="263">
AssociatedItem</text>
</g>
</a>
</g>
</g>
</g>
<path d=" M 75 318 h 912 m -453 0 l -5 -5 m 0 10 l 5 -5 m 453 0 a 12 12 0 0 0 12 -12 v -216 m 0 111 l -5 5 m 10 0 l -5 -5 m 0 -111 a 12 12 0 0 1 12 -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="47" y="307" />
<text x="61" y="323">
}</text>
</g>
</g>
</g>
<path d=" M 1021 78 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 78 h 10" />
<path d=" M 1011 78 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-items.traits.intro"><a class="rule-link" href="#r-items.traits.intro" title="items.traits.intro"><span>[items<wbr>.traits<wbr>.intro]</span></a>
</div>

<p>一个 <em>特型</em> 描述了一个类型可以实现的抽象接口。此接口由 <a href="#关联项">关联项</a> 组成，共有三种：</p>
<ul>
<li><a href="#associated-functions-and-methods">函数</a></li>
<li><a href="#associated-types">类型</a></li>
<li><a href="#associated-constants">常量</a></li>
</ul>
<div class="rule" id="r-items.traits.namespace"><a class="rule-link" href="#r-items.traits.namespace" title="items.traits.namespace"><span>[items<wbr>.traits<wbr>.namespace]</span></a>
</div>

<p>特型 声明在它所在的模块或块的 <a href="#命名空间">类型命名空间</a> 中定义了一个 特型。</p>
<div class="rule" id="r-items.traits.associated-item-namespaces"><a class="rule-link" href="#r-items.traits.associated-item-namespaces" title="items.traits.associated-item-namespaces"><span>[items<wbr>.traits<wbr>.associated-item-namespaces]</span></a>
</div>

<p>关联项 在其各自的命名空间中被定义为 特型 的成员。关联类型 定义在 类型命名空间 中。关联常量 和 关联函数 定义在 值命名空间 中。</p>
<div class="rule" id="r-items.traits.self-param"><a class="rule-link" href="#r-items.traits.self-param" title="items.traits.self-param"><span>[items<wbr>.traits<wbr>.self-param]</span></a>
</div>

<p>所有 特型 都定义了一个隐式的 类型参数 <code>Self</code>，它指向 “实现此接口的类型” 。 特型 还可以包含额外的 类型参数。这些 类型参数（包括 <code>Self</code>）可以像 <a href="#泛型参数">往常一样</a> 受到其他 特型 等的约束。</p>
<div class="rule" id="r-items.traits.impls"><a class="rule-link" href="#r-items.traits.impls" title="items.traits.impls"><span>[items<wbr>.traits<wbr>.impls]</span></a>
</div>

<p>特型 通过单独的 <a href="#实现">实现</a> 为特定类型实现。</p>
<div class="rule" id="r-items.traits.associated-item-decls"><a class="rule-link" href="#r-items.traits.associated-item-decls" title="items.traits.associated-item-decls"><span>[items<wbr>.traits<wbr>.associated-item-decls]</span></a>
</div>

<p>特型 函数可以通过用分号替换函数体来省略它。这表示 实现 必须定义该函数。如果 特型 函数定义了函数体，则该定义对于任何未覆盖它的 实现 都充当默认值。类似地，关联常量 可以省略等号和表达式，以表示 实现 必须定义常量值。 关联类型 绝不能定义类型，类型只能在 实现 中指定。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 具有定义和不具有定义的特型关联项示例。
trait Example {
    const CONST_NO_DEFAULT: i32;
    const CONST_WITH_DEFAULT: i32 = 99;
    type TypeNoDefault;
    fn method_without_default(&amp;self);
    fn method_with_default(&amp;self) {}
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.traits.const-fn"><a class="rule-link" href="#r-items.traits.const-fn" title="items.traits.const-fn"><span>[items<wbr>.traits<wbr>.const-fn]</span></a>
</div>

<p>特型 函数不允许是 <a href="#const-functions"><code>const</code></a>。</p>
<div class="rule" id="r-items.traits.bounds"><a class="rule-link" href="#r-items.traits.bounds" title="items.traits.bounds"><span>[items<wbr>.traits<wbr>.bounds]</span></a>
</div>

<h2 id="特型绑定"><a class="header" href="#特型绑定">特型绑定</a></h2>
<p>泛型 项 可以使用 特型 作为其 类型参数 的 <a href="#特型和生命周期界限">绑定</a>。</p>
<div class="rule" id="r-items.traits.generic"><a class="rule-link" href="#r-items.traits.generic" title="items.traits.generic"><span>[items<wbr>.traits<wbr>.generic]</span></a>
</div>

<h2 id="泛型特型"><a class="header" href="#泛型特型">泛型特型</a></h2>
<p>可以为 特型 指定 类型参数 以使其成为 泛型。这些出现在 特型 名称之后，使用与 <a href="#generic-functions">泛型函数</a> 相同的语法。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Seq&lt;T&gt; {
    fn len(&amp;self) -&gt; u32;
    fn elt_at(&amp;self, n: u32) -&gt; T;
    fn iter&lt;F&gt;(&amp;self, f: F) where F: Fn(T);
}
<span class="boring">}</span></code></pre>
<p><a id="object-safety"></a></p>
<div class="rule" id="r-items.traits.dyn-compatible"><a class="rule-link" href="#r-items.traits.dyn-compatible" title="items.traits.dyn-compatible"><span>[items<wbr>.traits<wbr>.dyn-compatible]</span></a>
</div>

<h2 id="dyn兼容性"><a class="header" href="#dyn兼容性">Dyn兼容性</a></h2>
<div class="rule" id="r-items.traits.dyn-compatible.intro"><a class="rule-link" href="#r-items.traits.dyn-compatible.intro" title="items.traits.dyn-compatible.intro"><span>[items<wbr>.traits<wbr>.dyn-compatible<wbr>.intro]</span></a>
</div>

<p>一个 dyn 兼容的 特型 可以作为 <a href="#特型对象">特型对象</a> 的基础 特型。如果一个 特型 具备以下特质，则它是 <em>dyn 兼容的 (dyn compatible)</em> ：</p>
<div class="rule" id="r-items.traits.dyn-compatible.supertraits"><a class="rule-link" href="#r-items.traits.dyn-compatible.supertraits" title="items.traits.dyn-compatible.supertraits"><span>[items<wbr>.traits<wbr>.dyn-compatible<wbr>.supertraits]</span></a>
</div>

<ul>
<li>所有 <a href="#父特型">父特型</a> 也必须是 dyn 兼容的。</li>
</ul>
<div class="rule" id="r-items.traits.dyn-compatible.sized"><a class="rule-link" href="#r-items.traits.dyn-compatible.sized" title="items.traits.dyn-compatible.sized"><span>[items<wbr>.traits<wbr>.dyn-compatible<wbr>.sized]</span></a>
</div>

<ul>
<li><code>Sized</code> 不能是一个 <a href="#父特型">父特型</a>。换句话说，它不能要求 <code>Self: Sized</code>。</li>
</ul>
<div class="rule" id="r-items.traits.dyn-compatible.associated-consts"><a class="rule-link" href="#r-items.traits.dyn-compatible.associated-consts" title="items.traits.dyn-compatible.associated-consts"><span>[items<wbr>.traits<wbr>.dyn-compatible<wbr>.associated-consts]</span></a>
</div>

<ul>
<li>它不能有任何 关联常量。</li>
</ul>
<div class="rule" id="r-items.traits.dyn-compatible.associated-types"><a class="rule-link" href="#r-items.traits.dyn-compatible.associated-types" title="items.traits.dyn-compatible.associated-types"><span>[items<wbr>.traits<wbr>.dyn-compatible<wbr>.associated-types]</span></a>
</div>

<ul>
<li>它不能有任何带有 泛型 的 关联类型。</li>
</ul>
<div class="rule" id="r-items.traits.dyn-compatible.associated-functions"><a class="rule-link" href="#r-items.traits.dyn-compatible.associated-functions" title="items.traits.dyn-compatible.associated-functions"><span>[items<wbr>.traits<wbr>.dyn-compatible<wbr>.associated-functions]</span></a>
</div>

<ul>
<li>所有 关联函数 必须要么可以从 特型对象 分派，要么是明确的不可分派：
<ul>
<li>可分派函数必须：
<ul>
<li>不具有任何 类型参数（尽管允许生命周期参数）。</li>
<li>是一个除了在 接收者 类型中之外不使用 <code>Self</code> 的 <a href="#方法">方法</a>。</li>
<li>拥有以下类型之一的 接收者：
<ul>
<li><code>&amp;Self</code> (即 <code>&amp;self</code>)</li>
<li><code>&amp;mut Self</code> (即 <code>&amp;mut self</code>)</li>
<li><a href="#boxt"><code>Box&lt;Self&gt;</code></a></li>
<li><a href="#rct"><code>Rc&lt;Self&gt;</code></a></li>
<li><a href="#arct"><code>Arc&lt;Self&gt;</code></a></li>
<li><a href="#pinp"><code>Pin&lt;P&gt;</code></a> 其中 <code>P</code> 是上述类型之一</li>
</ul>
</li>
<li>不具有 不透明返回类型；即，
<ul>
<li>不是 <code>async fn</code>（它具有隐藏的 <code>Future</code> 类型）。</li>
<li>不具有 返回位置 <code>impl Trait</code> 类型 (<code>fn example(&amp;self) -&gt; impl Trait</code>)。</li>
</ul>
</li>
<li>不具有 <code>where Self: Sized</code> 绑定（<code>Self</code> 的 接收者 类型 (即 <code>self</code>) 隐含了这一点）。</li>
</ul>
</li>
<li>明确的不可分派函数要求：
<ul>
<li>具有 <code>where Self: Sized</code> 绑定（<code>Self</code> 的 接收者 类型 (即 <code>self</code>) 隐含了这一点）。</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="rule" id="r-items.traits.dyn-compatible.async-traits"><a class="rule-link" href="#r-items.traits.dyn-compatible.async-traits" title="items.traits.dyn-compatible.async-traits"><span>[items<wbr>.traits<wbr>.dyn-compatible<wbr>.async-traits]</span></a>
</div>

<ul>
<li><a href="https://doc.rust-lang.org/core/ops/async_function/trait.AsyncFn.html"><code>AsyncFn</code></a>、<a href="https://doc.rust-lang.org/core/ops/async_function/trait.AsyncFnMut.html"><code>AsyncFnMut</code></a> 和 <a href="https://doc.rust-lang.org/core/ops/async_function/trait.AsyncFnOnce.html"><code>AsyncFnOnce</code></a> 特型 不是 dyn 兼容的。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>这个概念以前被称为 <em>对象安全 (object safety)</em> 。</p>
</blockquote>
</div>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use std::rc::Rc;
</span><span class="boring">use std::sync::Arc;
</span><span class="boring">use std::pin::Pin;
</span>// dyn 兼容方法的示例。
trait TraitMethods {
    fn by_ref(self: &amp;Self) {}
    fn by_ref_mut(self: &amp;mut Self) {}
    fn by_box(self: Box&lt;Self&gt;) {}
    fn by_rc(self: Rc&lt;Self&gt;) {}
    fn by_arc(self: Arc&lt;Self&gt;) {}
    fn by_pin(self: Pin&lt;&amp;Self&gt;) {}
    fn with_lifetime&lt;'a&gt;(self: &amp;'a Self) {}
    fn nested_pin(self: Pin&lt;Arc&lt;Self&gt;&gt;) {}
}
<span class="boring">struct S;
</span><span class="boring">impl TraitMethods for S {}
</span><span class="boring">let t: Box&lt;dyn TraitMethods&gt; = Box::new(S);
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 此特型是 dyn 兼容的，但这些方法不能在特型对象上分派。
trait NonDispatchable {
    // 非方法不能被分派。
    fn foo() where Self: Sized {}
    // Self 类型在运行时才已知。
    fn returns(&amp;self) -&gt; Self where Self: Sized;
    // `other` 可能是接收者的不同具体类型。
    fn param(&amp;self, other: Self) where Self: Sized {}
    // 泛型与虚表 (vtable) 不兼容。
    fn typed&lt;T&gt;(&amp;self, x: T) where Self: Sized {}
}

struct S;
impl NonDispatchable for S {
    fn returns(&amp;self) -&gt; Self where Self: Sized { S }
}
let obj: Box&lt;dyn NonDispatchable&gt; = Box::new(S);
obj.returns(); // 错误：不能通过 Self 返回值调用
obj.param(S);  // 错误：不能通过 Self 参数调用
obj.typed(1);  // 错误：不能通过泛型类型调用
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use std::rc::Rc;
</span>// dyn 不兼容特型的示例。
trait DynIncompatible {
    const CONST: i32 = 1;  // 错误：不能拥有关联常量

    fn foo() {}  // 错误：没有 Sized 的关联函数
    fn returns(&amp;self) -&gt; Self; // 错误：返回类型中存在 Self
    fn typed&lt;T&gt;(&amp;self, x: T) {} // 错误：具有泛型类型参数
    fn nested(self: Rc&lt;Box&lt;Self&gt;&gt;) {} // 错误：嵌套接收者不能被分派
}

struct S;
impl DynIncompatible for S {
    fn returns(&amp;self) -&gt; Self { S }
}
let obj: Box&lt;dyn DynIncompatible&gt; = Box::new(S); // 错误
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// `Self: Sized` 特型是 dyn 不兼容的。
trait TraitWithSize where Self: Sized {}

struct S;
impl TraitWithSize for S {}
let obj: Box&lt;dyn TraitWithSize&gt; = Box::new(S); // 错误
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 如果 `Self` 是一个类型参数，则 dyn 不兼容。
trait Super&lt;A&gt; {}
trait WithSelf: Super&lt;Self&gt; where Self: Sized {}

struct S;
impl&lt;A&gt; Super&lt;A&gt; for S {}
impl WithSelf for S {}
let obj: Box&lt;dyn WithSelf&gt; = Box::new(S); // 错误：不能使用 `Self` 类型参数
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.traits.supertraits"><a class="rule-link" href="#r-items.traits.supertraits" title="items.traits.supertraits"><span>[items<wbr>.traits<wbr>.supertraits]</span></a>
</div>

<h2 id="父特型"><a class="header" href="#父特型">父特型</a></h2>
<div class="rule" id="r-items.traits.supertraits.intro"><a class="rule-link" href="#r-items.traits.supertraits.intro" title="items.traits.supertraits.intro"><span>[items<wbr>.traits<wbr>.supertraits<wbr>.intro]</span></a>
</div>

<p><strong>父特型 (Supertraits)</strong> 是指为了让某个类型实现特定 特型 而必须先为该类型实现的 特型。此外，任何被 特型 绑定的 <a href="#泛型参数">泛型</a> 或 <a href="#特型对象">特型对象</a> 都可以访问其 父特型 的 关联项。</p>
<div class="rule" id="r-items.traits.supertraits.decl"><a class="rule-link" href="#r-items.traits.supertraits.decl" title="items.traits.supertraits.decl"><span>[items<wbr>.traits<wbr>.supertraits<wbr>.decl]</span></a>
</div>

<p>父特型 通过 特型 的 <code>Self</code> 类型上的 特型绑定 来声明，并以此类推，包括那些 特型绑定 中声明的 特型 的 父特型。 特型 成为其自身的 父特型 是一个错误。</p>
<div class="rule" id="r-items.traits.supertraits.subtrait"><a class="rule-link" href="#r-items.traits.supertraits.subtrait" title="items.traits.supertraits.subtrait"><span>[items<wbr>.traits<wbr>.supertraits<wbr>.subtrait]</span></a>
</div>

<p>拥有 父特型 的 特型 被称为其 父特型 的 <strong>子特型 (subtrait)</strong> 。</p>
<p>以下是声明 <code>Shape</code> 为 <code>Circle</code> 的 父特型 的示例。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Shape { fn area(&amp;self) -&gt; f64; }
trait Circle: Shape { fn radius(&amp;self) -&gt; f64; }
<span class="boring">}</span></code></pre>
<p>以下是相同的示例，只是使用了 <a href="#where-clauses">where 子句</a>。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Shape { fn area(&amp;self) -&gt; f64; }
trait Circle where Self: Shape { fn radius(&amp;self) -&gt; f64; }
<span class="boring">}</span></code></pre>
<p>下一个示例使用来自 <code>Shape</code> 的 <code>area</code> 函数为 <code>radius</code> 提供默认实现。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">trait Shape { fn area(&amp;self) -&gt; f64; }
</span>trait Circle where Self: Shape {
    fn radius(&amp;self) -&gt; f64 {
        // A = pi * r^2
        // 所以在代数上，
        // r = sqrt(A / pi)
        (self.area() / std::f64::consts::PI).sqrt()
    }
}
<span class="boring">}</span></code></pre>
<p>下一个示例在 泛型 参数上调用 父特型 方法。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">trait Shape { fn area(&amp;self) -&gt; f64; }
</span><span class="boring">trait Circle: Shape { fn radius(&amp;self) -&gt; f64; }
</span>fn print_area_and_radius&lt;C: Circle&gt;(c: C) {
    // 这里我们调用来自 `Circle` 的父特型 `Shape` 的 area 方法。
    println!("Area: {}", c.area());
    println!("Radius: {}", c.radius());
}
<span class="boring">}</span></code></pre>
<p>类似地，这里是一个在 特型对象 上调用 父特型 方法的示例。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">trait Shape { fn area(&amp;self) -&gt; f64; }
</span><span class="boring">trait Circle: Shape { fn radius(&amp;self) -&gt; f64; }
</span><span class="boring">struct UnitCircle;
</span><span class="boring">impl Shape for UnitCircle { fn area(&amp;self) -&gt; f64 { std::f64::consts::PI } }
</span><span class="boring">impl Circle for UnitCircle { fn radius(&amp;self) -&gt; f64 { 1.0 } }
</span><span class="boring">let circle = UnitCircle;
</span>let circle = Box::new(circle) as Box&lt;dyn Circle&gt;;
let nonsense = circle.radius() * circle.area();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.traits.safety"><a class="rule-link" href="#r-items.traits.safety" title="items.traits.safety"><span>[items<wbr>.traits<wbr>.safety]</span></a>
</div>

<h2 id="不安全特型"><a class="header" href="#不安全特型">不安全特型</a></h2>
<div class="rule" id="r-items.traits.safety.intro"><a class="rule-link" href="#r-items.traits.safety.intro" title="items.traits.safety.intro"><span>[items<wbr>.traits<wbr>.safety<wbr>.intro]</span></a>
</div>

<p>以 <code>unsafe</code> 关键字开头的 特型 项 表示 <em>实现</em> 该 特型 可能是 <a href="#不安全性">不安全</a> 的。使用正确实现的 不安全特型 是安全的。 <a href="#trait-implementations">特型实现</a> 也必须以 <code>unsafe</code> 关键字开头。</p>
<p><a href="#sync"><code>Sync</code></a> 和 <a href="#send"><code>Send</code></a> 是 不安全特型 的示例。</p>
<div class="rule" id="r-items.traits.params"><a class="rule-link" href="#r-items.traits.params" title="items.traits.params"><span>[items<wbr>.traits<wbr>.params]</span></a>
</div>

<h2 id="参数模式"><a class="header" href="#参数模式">参数模式</a></h2>
<div class="rule" id="r-items.traits.params.patterns-no-body"><a class="rule-link" href="#r-items.traits.params.patterns-no-body" title="items.traits.params.patterns-no-body"><span>[items<wbr>.traits<wbr>.params<wbr>.patterns-no-body]</span></a>
</div>

<p>在没有函数体的 关联函数 中，参数仅允许 <a href="#grammar-IDENTIFIER">标识符</a> 或 <code>_</code> <a href="#wildcard-pattern">通配符模式</a>，以及 <a href="#grammar-SelfParam">Self 参数</a> 允许的形式。 <code>mut</code> <a href="#grammar-IDENTIFIER">标识符</a> 目前是允许的，但它已被弃用，将来会变成一个硬错误。</p>
<!-- https://github.com/rust-lang/rust/issues/35203 -->
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait T {
    fn f1(&amp;self);
    fn f2(x: Self, _: i32);
}
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0642 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait T {
    fn f2(&amp;x: &amp;i32); // 错误：在没有函数体的函数中不允许使用模式
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.traits.params.patterns-with-body"><a class="rule-link" href="#r-items.traits.params.patterns-with-body" title="items.traits.params.patterns-with-body"><span>[items<wbr>.traits<wbr>.params<wbr>.patterns-with-body]</span></a>
</div>

<p>带有函数体的 关联函数 中的参数仅允许 不可驳模式。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait T {
    fn f1((a, b): (i32, i32)) {} // OK：是不可驳模式
}
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0005 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait T {
    fn f1(123: i32) {} // 错误：模式是可驳的
    fn f2(Some(x): Option&lt;i32&gt;) {} // 错误：模式是可驳的
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.traits.params.pattern-required.edition2018"><a class="rule-link" href="#r-items.traits.params.pattern-required.edition2018" title="items.traits.params.pattern-required.edition2018"><span>[items<wbr>.traits<wbr>.params<wbr>.pattern-required<wbr>.edition2018]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p>在 2018 版次 之前，关联函数参数的模式是可选的：</p>
<pre class="playground"><code class="language-rust edition2015"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 2015 版次
trait T {
    fn f(i32); // OK：参数标识符不是必需的
}
<span class="boring">}</span></code></pre>
<p>从 2018 版次 开始，模式不再是可选的。</p>
</blockquote>
</div>

<div class="rule" id="r-items.traits.params.restriction-patterns.edition2018"><a class="rule-link" href="#r-items.traits.params.restriction-patterns.edition2018" title="items.traits.params.restriction-patterns.edition2018"><span>[items<wbr>.traits<wbr>.params<wbr>.restriction-patterns<wbr>.edition2018]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p>在 2018 版次 之前，带有函数体的 关联函数 中的参数仅限于以下几种 模式：</p>
<ul>
<li><a href="#grammar-IDENTIFIER">标识符</a></li>
<li><code>mut</code> <a href="#grammar-IDENTIFIER">标识符</a></li>
<li><a href="#wildcard-pattern"><code>_</code></a></li>
<li><code>&amp;</code> <a href="#grammar-IDENTIFIER">标识符</a></li>
<li><code>&amp;&amp;</code> <a href="#grammar-IDENTIFIER">标识符</a></li>
</ul>
<pre class="playground"><code class="language-rust edition2015 compile_fail E0642"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 2015 版次
trait T {
    fn f1((a, b): (i32, i32)) {} // 错误：不允许使用该模式
}
<span class="boring">}</span></code></pre>
<p>从 2018 开始，所有不可驳模式都是允许的，如 <a href="#r-items.traits.params.patterns-with-body">items.traits.params.patterns-with-body</a> 中所述。</p>
</blockquote>
</div>

<div class="rule" id="r-items.traits.associated-visibility"><a class="rule-link" href="#r-items.traits.associated-visibility" title="items.traits.associated-visibility"><span>[items<wbr>.traits<wbr>.associated-visibility]</span></a>
</div>

<h2 id="项可见性"><a class="header" href="#项可见性">项可见性</a></h2>
<div class="rule" id="r-items.traits.associated-visibility.intro"><a class="rule-link" href="#r-items.traits.associated-visibility.intro" title="items.traits.associated-visibility.intro"><span>[items<wbr>.traits<wbr>.associated-visibility<wbr>.intro]</span></a>
</div>

<p>特型项 在语法格式上允许 <a href="#grammar-Visibility">可见性</a> 注解，但在验证 特型 时会被拒绝。这允许 项 在使用它们的不同上下文中以统一的语法格式进行解析。例如，空的 <code>vis</code> 宏片段说明符可以用于 特型项，其中该宏规则可以用于允许可见性的其他情况。</p>
<pre class="playground"><code class="language-rust edition2024">macro_rules! create_method {
    ($vis:vis $name:ident) =&gt; {
        $vis fn $name(&amp;self) {}
    };
}

trait T1 {
    // 允许空的 `vis`。
    create_method! { method_of_t1 }
}

struct S;

impl S {
    // 这里允许可见性。
    create_method! { pub method_of_s }
}

impl T1 for S {}

fn main() {
    let s = S;
    s.method_of_t1();
    s.method_of_s();
}</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-items.impl"><a class="rule-link" href="#r-items.impl" title="items.impl"><span>[items<wbr>.impl]</span></a>
</div>

<h1 id="实现"><a class="header" href="#实现">实现</a></h1>
<div class="rule" id="r-items.impl.syntax"><a class="rule-link" href="#r-items.impl.syntax" title="items.impl.syntax"><span>[items<wbr>.impl<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-Implementation" onclick="show_railroad()"><a href="#railroad-Implementation">Implementation</a></span> → <span class="grammar-text"><a href="#grammar-InherentImpl">InherentImpl</a></span> | <span class="grammar-text"><a href="#grammar-TraitImpl">TraitImpl</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-InherentImpl" onclick="show_railroad()"><a href="#railroad-InherentImpl">InherentImpl</a></span> → <br>    <span class="grammar-literal">impl</span> <span class="grammar-text"><a href="#grammar-GenericParams">GenericParams</a></span><sup>?</sup> <span class="grammar-text"><a href="#grammar-Type">Type</a></span> <span class="grammar-text"><a href="#grammar-WhereClause">WhereClause</a></span><sup>?</sup> <span class="grammar-literal">{</span> <br>        <span class="grammar-text"><a href="#grammar-InnerAttribute">InnerAttribute</a></span><sup>*</sup> <br>        <span class="grammar-text"><a href="#grammar-AssociatedItem">AssociatedItem</a></span><sup>*</sup> <br>    <span class="grammar-literal">}</span></p>
<p><span class="grammar-text grammar-production" id="grammar-TraitImpl" onclick="show_railroad()"><a href="#railroad-TraitImpl">TraitImpl</a></span> → <br>    <span class="grammar-literal">unsafe</span><sup>?</sup> <span class="grammar-literal">impl</span> <span class="grammar-text"><a href="#grammar-GenericParams">GenericParams</a></span><sup>?</sup> <span class="grammar-literal">!</span><sup>?</sup> <span class="grammar-text"><a href="#grammar-TypePath">TypePath</a></span> <span class="grammar-literal">for</span> <span class="grammar-text"><a href="#grammar-Type">Type</a></span> <br>    <span class="grammar-text"><a href="#grammar-WhereClause">WhereClause</a></span><sup>?</sup> <br>    <span class="grammar-literal">{</span> <br>        <span class="grammar-text"><a href="#grammar-InnerAttribute">InnerAttribute</a></span><sup>*</sup> <br>        <span class="grammar-text"><a href="#grammar-AssociatedItem">AssociatedItem</a></span><sup>*</sup> <br>    <span class="grammar-literal">}</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 234px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Implementation"><svg class="railroad" viewbox="0 0 234 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Implementation">
<text class="comment" x="64" y="25">
Implementation</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 116 0 h 24" />
<a class="link" xlink:href="#railroad-InherentImpl">
<g class="nonterminal">
<rect height="22" width="116" x="59" y="42" />
<text x="117" y="58">
InherentImpl</text>
</g>
</a>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 140 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 92 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-TraitImpl">
<g class="nonterminal">
<rect height="22" width="92" x="59" y="75" />
<text x="105" y="91">
TraitImpl</text>
</g>
</a>
</g>
<path d=" M 209 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 199 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 618px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-InherentImpl"><svg class="railroad" viewbox="0 0 618 279" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-InherentImpl">
<text class="comment" x="57" y="25">
InherentImpl</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="stack">
<path d=" M 35 66 h 12" />
<path d=" M 547 66 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 h -500 m 253 0 l 5 -5 m 0 10 l -5 -5 m -253 0 a 12 12 0 0 0 -12 12 v 12 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="47" y="55" />
<text x="73" y="71">
impl</text>
</g>
<g class="optional">
<path d=" M 109 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 124 m -59 0 l -5 -5 m 0 10 l 5 -5 m 59 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-GenericParams">
<g class="nonterminal">
<rect height="22" width="124" x="133" y="55" />
<text x="195" y="71">
GenericParams</text>
</g>
</a>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="291" y="55" />
<text x="317" y="71">
Type</text>
</g>
</a>
<g class="optional">
<path d=" M 353 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 108 m -51 0 l -5 -5 m 0 10 l 5 -5 m 51 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-WhereClause">
<g class="nonterminal">
<rect height="22" width="108" x="377" y="55" />
<text x="431" y="71">
WhereClause</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="519" y="55" />
<text x="533" y="71">
{</text>
</g>
<path d=" M 99 66 h 10" />
<path d=" M 281 66 h 10" />
<path d=" M 343 66 h 10" />
<path d=" M 509 66 h 10" />
</g>
<path d=" M 251 126 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 1 -12 12 h -204 m 105 0 l 5 -5 m 0 10 l -5 -5 m -105 0 a 12 12 0 0 0 -12 12 v 12 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="optional">
<path d=" M 47 126 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 71 126 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-InnerAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="83" y="115" />
<text x="149" y="131">
InnerAttribute</text>
</g>
</a>
</g>
</g>
</g>
<path d=" M 251 198 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 1 -12 12 h -204 m 105 0 l 5 -5 m 0 10 l -5 -5 m -105 0 a 12 12 0 0 0 -12 12 v 0 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="optional">
<path d=" M 47 198 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 71 198 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-AssociatedItem">
<g class="nonterminal">
<rect height="22" width="132" x="83" y="187" />
<text x="149" y="203">
AssociatedItem</text>
</g>
</a>
</g>
</g>
</g>
<path d=" M 75 258 h 484 m -239 0 l -5 -5 m 0 10 l 5 -5 m 239 0 a 12 12 0 0 0 12 -12 v -168 m 0 87 l -5 5 m 10 0 l -5 -5 m 0 -87 a 12 12 0 0 1 12 -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="47" y="247" />
<text x="61" y="263">
}</text>
</g>
</g>
</g>
<path d=" M 593 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 583 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 774px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TraitImpl"><svg class="railroad" viewbox="0 0 774 387" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TraitImpl">
<text class="comment" x="46" y="25">
TraitImpl</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="stack">
<path d=" M 35 66 h 12" />
<path d=" M 703 66 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 h -656 m 331 0 l 5 -5 m 0 10 l -5 -5 m -331 0 a 12 12 0 0 0 -12 12 v 12 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="optional">
<path d=" M 47 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 68 m -31 0 l -5 -5 m 0 10 l 5 -5 m 31 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="71" y="55" />
<text x="105" y="71">
unsafe</text>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="173" y="55" />
<text x="199" y="71">
impl</text>
</g>
<g class="optional">
<path d=" M 235 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 124 m -59 0 l -5 -5 m 0 10 l 5 -5 m 59 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-GenericParams">
<g class="nonterminal">
<rect height="22" width="124" x="259" y="55" />
<text x="321" y="71">
GenericParams</text>
</g>
</a>
</g>
<g class="optional">
<path d=" M 417 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="441" y="55" />
<text x="455" y="71">
!</text>
</g>
</g>
<a class="link" xlink:href="#railroad-TypePath">
<g class="nonterminal">
<rect height="22" width="84" x="503" y="55" />
<text x="545" y="71">
TypePath</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="597" y="55" />
<text x="619" y="71">
for</text>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="651" y="55" />
<text x="677" y="71">
Type</text>
</g>
</a>
<path d=" M 163 66 h 10" />
<path d=" M 225 66 h 10" />
<path d=" M 407 66 h 10" />
<path d=" M 493 66 h 10" />
<path d=" M 587 66 h 10" />
<path d=" M 641 66 h 10" />
</g>
<path d=" M 203 126 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 h -156 m 81 0 l 5 -5 m 0 10 l -5 -5 m -81 0 a 12 12 0 0 0 -12 12 v 0 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="optional">
<path d=" M 47 126 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 108 m -51 0 l -5 -5 m 0 10 l 5 -5 m 51 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-WhereClause">
<g class="nonterminal">
<rect height="22" width="108" x="71" y="115" />
<text x="125" y="131">
WhereClause</text>
</g>
</a>
</g>
</g>
<path d=" M 75 174 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 h -28 a 12 12 0 0 0 -12 12 v 12 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="47" y="163" />
<text x="61" y="179">
{</text>
</g>
</g>
<path d=" M 251 234 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 1 -12 12 h -204 m 105 0 l 5 -5 m 0 10 l -5 -5 m -105 0 a 12 12 0 0 0 -12 12 v 12 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="optional">
<path d=" M 47 234 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 71 234 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-InnerAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="83" y="223" />
<text x="149" y="239">
InnerAttribute</text>
</g>
</a>
</g>
</g>
</g>
<path d=" M 251 306 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 1 -12 12 h -204 m 105 0 l 5 -5 m 0 10 l -5 -5 m -105 0 a 12 12 0 0 0 -12 12 v 0 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="optional">
<path d=" M 47 306 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 71 306 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-AssociatedItem">
<g class="nonterminal">
<rect height="22" width="132" x="83" y="295" />
<text x="149" y="311">
AssociatedItem</text>
</g>
</a>
</g>
</g>
</g>
<path d=" M 75 366 h 640 m -317 0 l -5 -5 m 0 10 l 5 -5 m 317 0 a 12 12 0 0 0 12 -12 v -276 m 0 141 l -5 5 m 10 0 l -5 -5 m 0 -141 a 12 12 0 0 1 12 -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="47" y="355" />
<text x="61" y="371">
}</text>
</g>
</g>
</g>
<path d=" M 749 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 739 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-items.impl.intro"><a class="rule-link" href="#r-items.impl.intro" title="items.impl.intro"><span>[items<wbr>.impl<wbr>.intro]</span></a>
</div>

<p>一个  <em>实现 (implementation)</em>  是一个将 项 与一个  <em>实现类型 (implementing type)</em>  相关联的 项。实现 使用关键字 <code>impl</code> 定义，并包含属于正在实现的类型的实例或静态属于该类型的函数。</p>
<div class="rule" id="r-items.impl.kinds"><a class="rule-link" href="#r-items.impl.kinds" title="items.impl.kinds"><span>[items<wbr>.impl<wbr>.kinds]</span></a>
</div>

<p>实现 有两种类型：</p>
<ul>
<li>固有实现 (inherent implementations)</li>
<li><a href="#特型">特型</a> 实现</li>
</ul>
<div class="rule" id="r-items.impl.inherent"><a class="rule-link" href="#r-items.impl.inherent" title="items.impl.inherent"><span>[items<wbr>.impl<wbr>.inherent]</span></a>
</div>

<h2 id="固有实现"><a class="header" href="#固有实现">固有实现</a></h2>
<div class="rule" id="r-items.impl.inherent.intro"><a class="rule-link" href="#r-items.impl.inherent.intro" title="items.impl.inherent.intro"><span>[items<wbr>.impl<wbr>.inherent<wbr>.intro]</span></a>
</div>

<p>固有实现被定义为 <code>impl</code> 关键字、 泛型 类型声明、指向标称类型的路径、where 子句以及一组用大括号括起来的可关联 项 的序列。</p>
<div class="rule" id="r-items.impl.inherent.implementing-type"><a class="rule-link" href="#r-items.impl.inherent.implementing-type" title="items.impl.inherent.implementing-type"><span>[items<wbr>.impl<wbr>.inherent<wbr>.implementing-type]</span></a>
</div>

<p>该标称类型被称为  <em>实现类型 (implementing type)</em> ，而可关联 项 是该实现类型的  <em>关联项 (associated items)</em> 。</p>
<div class="rule" id="r-items.impl.inherent.associated-items"><a class="rule-link" href="#r-items.impl.inherent.associated-items" title="items.impl.inherent.associated-items"><span>[items<wbr>.impl<wbr>.inherent<wbr>.associated-items]</span></a>
</div>

<p>固有实现将包含的 项 与实现类型相关联。</p>
<div class="rule" id="r-items.impl.inherent.associated-items.allowed-items"><a class="rule-link" href="#r-items.impl.inherent.associated-items.allowed-items" title="items.impl.inherent.associated-items.allowed-items"><span>[items<wbr>.impl<wbr>.inherent<wbr>.associated-items<wbr>.allowed-items]</span></a>
</div>

<p>固有实现可以包含 <a href="#associated-functions-and-methods">关联函数</a>（包括 <a href="#方法">方法</a>）和 <a href="#associated-constants">关联常量</a>。</p>
<div class="rule" id="r-items.impl.inherent.type-alias"><a class="rule-link" href="#r-items.impl.inherent.type-alias" title="items.impl.inherent.type-alias"><span>[items<wbr>.impl<wbr>.inherent<wbr>.type-alias]</span></a>
</div>

<p>它们不能包含关联类型别名。</p>
<div class="rule" id="r-items.impl.inherent.associated-item-path"><a class="rule-link" href="#r-items.impl.inherent.associated-item-path" title="items.impl.inherent.associated-item-path"><span>[items<wbr>.impl<wbr>.inherent<wbr>.associated-item-path]</span></a>
</div>

<p>指向关联项的 <a href="#路径">路径</a> 是指向实现类型的任何路径，后跟关联项的标识符作为路径的最后一个组件。</p>
<div class="rule" id="r-items.impl.inherent.coherence"><a class="rule-link" href="#r-items.impl.inherent.coherence" title="items.impl.inherent.coherence"><span>[items<wbr>.impl<wbr>.inherent<wbr>.coherence]</span></a>
</div>

<p>一个类型也可以有多个固有实现。实现类型必须定义在与原始类型定义相同的 crate 中。</p>
<pre class="playground"><code class="language-rust edition2024">pub mod color {
    pub struct Color(pub u8, pub u8, pub u8);

    impl Color {
        pub const WHITE: Color = Color(255, 255, 255);
    }
}

mod values {
    use super::color::Color;
    impl Color {
        pub fn red() -&gt; Color {
            Color(255, 0, 0)
        }
    }
}

pub use self::color::Color;
fn main() {
    // 实现类型和 impl 在同一个模块中的实际路径。
    color::Color::WHITE;

    // 不同模块中的 impl 块仍然通过指向该类型的路径进行访问。
    color::Color::red();

    // 实现类型的重导出路径也有效。
    Color::red();

    // 无效，因为 values 中的 use 不是 pub。
    // values::Color::red();
}</code></pre>
<div class="rule" id="r-items.impl.trait"><a class="rule-link" href="#r-items.impl.trait" title="items.impl.trait"><span>[items<wbr>.impl<wbr>.trait]</span></a>
</div>

<h2 id="特型实现"><a class="header" href="#特型实现">特型实现</a></h2>
<div class="rule" id="r-items.impl.trait.intro"><a class="rule-link" href="#r-items.impl.trait.intro" title="items.impl.trait.intro"><span>[items<wbr>.impl<wbr>.trait<wbr>.intro]</span></a>
</div>

<p><em>特型实现</em>  的定义类似于固有实现，不同之处在于可选的 泛型 类型声明后面跟着一个 <a href="#特型">特型</a>，然后是关键字 <code>for</code>，最后是到一个标称类型的路径。</p>
<div class="rule" id="r-items.impl.trait.implemented-trait"><a class="rule-link" href="#r-items.impl.trait.implemented-trait" title="items.impl.trait.implemented-trait"><span>[items<wbr>.impl<wbr>.trait<wbr>.implemented-trait]</span></a>
</div>

<p>该 特型 被称为  <em>实现的特型 (implemented trait)</em> 。实现类型实现该 实现的特型。</p>
<div class="rule" id="r-items.impl.trait.def-requirement"><a class="rule-link" href="#r-items.impl.trait.def-requirement" title="items.impl.trait.def-requirement"><span>[items<wbr>.impl<wbr>.trait<wbr>.def-requirement]</span></a>
</div>

<p>特型实现必须定义由 实现的特型 声明的所有非默认 关联项，可以重新定义由 实现的特型 定义的默认 关联项，并且不能定义任何其他 项。</p>
<div class="rule" id="r-items.impl.trait.associated-item-path"><a class="rule-link" href="#r-items.impl.trait.associated-item-path" title="items.impl.trait.associated-item-path"><span>[items<wbr>.impl<wbr>.trait<wbr>.associated-item-path]</span></a>
</div>

<p>指向关联项的路径是 <code>&lt;</code> 后跟指向实现类型的路径，后跟 <code>as</code>，后跟指向 特型 的路径，后跟 <code>&gt;</code> 作为路径组件，再后跟关联项的路径组件。</p>
<div class="rule" id="r-items.impl.trait.safety"><a class="rule-link" href="#r-items.impl.trait.safety" title="items.impl.trait.safety"><span>[items<wbr>.impl<wbr>.trait<wbr>.safety]</span></a>
</div>

<p><a href="#unsafe-traits">不安全特型</a> 要求特型实现以 <code>unsafe</code> 关键字开头。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[derive(Copy, Clone)]
</span><span class="boring">struct Point {x: f64, y: f64};
</span><span class="boring">type Surface = i32;
</span><span class="boring">struct BoundingBox {x: f64, y: f64, width: f64, height: f64};
</span><span class="boring">trait Shape { fn draw(&amp;self, s: Surface); fn bounding_box(&amp;self) -&gt; BoundingBox; }
</span><span class="boring">fn do_draw_circle(s: Surface, c: Circle) { }
</span>struct Circle {
    radius: f64,
    center: Point,
}

impl Copy for Circle {}

impl Clone for Circle {
    fn clone(&amp;self) -&gt; Circle { *self }
}

impl Shape for Circle {
    fn draw(&amp;self, s: Surface) { do_draw_circle(s, *self); }
    fn bounding_box(&amp;self) -&gt; BoundingBox {
        let r = self.radius;
        BoundingBox {
            x: self.center.x - r,
            y: self.center.y - r,
            width: 2.0 * r,
            height: 2.0 * r,
        }
    }
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.impl.trait.coherence"><a class="rule-link" href="#r-items.impl.trait.coherence" title="items.impl.trait.coherence"><span>[items<wbr>.impl<wbr>.trait<wbr>.coherence]</span></a>
</div>

<h3 id="特型实现一致性"><a class="header" href="#特型实现一致性">特型实现一致性</a></h3>
<div class="rule" id="r-items.impl.trait.coherence.intro"><a class="rule-link" href="#r-items.impl.trait.coherence.intro" title="items.impl.trait.coherence.intro"><span>[items<wbr>.impl<wbr>.trait<wbr>.coherence<wbr>.intro]</span></a>
</div>

<p>如果孤儿规则检查失败或存在重叠的实现实例，则 特型实现 被认为是不一致的。</p>
<div class="rule" id="r-items.impl.trait.coherence.overlapping"><a class="rule-link" href="#r-items.impl.trait.coherence.overlapping" title="items.impl.trait.coherence.overlapping"><span>[items<wbr>.impl<wbr>.trait<wbr>.coherence<wbr>.overlapping]</span></a>
</div>

<p>当两个 特型实现 所针对的 特型 存在非空交集时，即这两个实现可以用相同的类型实例化，则它们发生重叠。</p>
<div class="rule" id="r-items.impl.trait.orphan-rule"><a class="rule-link" href="#r-items.impl.trait.orphan-rule" title="items.impl.trait.orphan-rule"><span>[items<wbr>.impl<wbr>.trait<wbr>.orphan-rule]</span></a>
</div>

<h4 id="孤儿规则"><a class="header" href="#孤儿规则">孤儿规则</a></h4>
<div class="rule" id="r-items.impl.trait.orphan-rule.intro"><a class="rule-link" href="#r-items.impl.trait.orphan-rule.intro" title="items.impl.trait.orphan-rule.intro"><span>[items<wbr>.impl<wbr>.trait<wbr>.orphan-rule<wbr>.intro]</span></a>
</div>

<p><em>孤儿规则 (orphan rule)</em>  规定，只有当 特型 或实现中的至少一个类型定义在当前 crate 中时，才允许进行 特型实现。它防止了不同 crate 之间冲突的 特型实现，并且是确保一致性的关键。</p>
<p>一个孤儿实现是指为外部类型实现外部 特型。如果允许自由定义这些实现，则两个 crate 可能会以不兼容的方式为相同的类型实现相同的 特型，从而导致添加或更新依赖项可能会因实现冲突而破坏编译。</p>
<p>孤儿规则 允许库作者为其 特型 添加新的实现，而无需担心会破坏下游代码。如果没有这些限制，库将无法添加像 <code>impl&lt;T: Display&gt; MyTrait for T</code> 这样的实现，因为这可能会与下游实现产生冲突。</p>
<div class="rule" id="r-items.impl.trait.orphan-rule.general"><a class="rule-link" href="#r-items.impl.trait.orphan-rule.general" title="items.impl.trait.orphan-rule.general"><span>[items<wbr>.impl<wbr>.trait<wbr>.orphan-rule<wbr>.general]</span></a>
</div>

<p>对于 <code>impl&lt;P1..=Pn&gt; Trait&lt;T1..=Tn&gt; for T0</code>，只有当以下至少一项为真时，<code>impl</code> 才是有效的：</p>
<ul>
<li><code>Trait</code> 是一个 <a href="#local-trait">本地特型</a></li>
<li>以下全部成立：
<ul>
<li>类型 <code>T0..=Tn</code> 中必须至少有一个是 <a href="#local-type">本地类型</a>。设 <code>Ti</code> 为第一个此类类型。</li>
<li>在 <code>T0..Ti</code>（不包括 <code>Ti</code>）中不得出现 <a href="#uncovered-type">未覆盖的类型</a> 参数 <code>P1..=Pn</code></li>
</ul>
</li>
</ul>
<div class="rule" id="r-items.impl.trait.uncovered-param"><a class="rule-link" href="#r-items.impl.trait.uncovered-param" title="items.impl.trait.uncovered-param"><span>[items<wbr>.impl<wbr>.trait<wbr>.uncovered-param]</span></a>
</div>

<p>仅对  <em>未覆盖的 (uncovered)</em>  类型参数的出现进行限制。</p>
<div class="rule" id="r-items.impl.trait.fundamental"><a class="rule-link" href="#r-items.impl.trait.fundamental" title="items.impl.trait.fundamental"><span>[items<wbr>.impl<wbr>.trait<wbr>.fundamental]</span></a>
</div>

<p>请注意，为了保持一致性，<a href="#fundamental-type-constructors">基础类型</a> 是特殊的。<code>Box&lt;T&gt;</code> 中的 <code>T</code> 不被视为已覆盖，且 <code>Box&lt;LocalType&gt;</code> 被视为本地的。</p>
<div class="rule" id="r-items.impl.generics"><a class="rule-link" href="#r-items.impl.generics" title="items.impl.generics"><span>[items<wbr>.impl<wbr>.generics]</span></a>
</div>

<h2 id="泛型实现"><a class="header" href="#泛型实现">泛型实现</a></h2>
<div class="rule" id="r-items.impl.generics.intro"><a class="rule-link" href="#r-items.impl.generics.intro" title="items.impl.generics.intro"><span>[items<wbr>.impl<wbr>.generics<wbr>.intro]</span></a>
</div>

<p>实现可以接受 <a href="#泛型参数">泛型参数</a>，这些参数可以用于实现的其余部分。实现参数直接写在 <code>impl</code> 关键字后面。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">trait Seq&lt;T&gt; { fn dummy(&amp;self, _: T) { } }
</span>impl&lt;T&gt; Seq&lt;T&gt; for Vec&lt;T&gt; {
    /* ... */
}
impl Seq&lt;bool&gt; for u32 {
    /* 将整数视为位序列 */
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.impl.generics.usage"><a class="rule-link" href="#r-items.impl.generics.usage" title="items.impl.generics.usage"><span>[items<wbr>.impl<wbr>.generics<wbr>.usage]</span></a>
</div>

<p>如果泛型参数在以下位置至少出现一次，则该参数会  <em>约束 (constrain)</em>  实现：</p>
<ul>
<li>实现的 特型（如果存在）</li>
<li>实现类型</li>
<li>作为包含另一个约束实现的参数的类型的 <a href="#特型和生命周期界限">绑定</a> 中的 <a href="#associated-types">关联类型</a></li>
</ul>
<div class="rule" id="r-items.impl.generics.constrain"><a class="rule-link" href="#r-items.impl.generics.constrain" title="items.impl.generics.constrain"><span>[items<wbr>.impl<wbr>.generics<wbr>.constrain]</span></a>
</div>

<p>类型参数和常量参数必须始终约束实现。如果生命周期在关联类型中使用，则生命周期必须约束实现。</p>
<p>产生约束的情况示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">trait Trait{}
</span><span class="boring">trait GenericTrait&lt;T&gt; {}
</span><span class="boring">trait HasAssocType { type Ty; }
</span><span class="boring">struct Struct;
</span><span class="boring">struct GenericStruct&lt;T&gt;(T);
</span><span class="boring">struct ConstGenericStruct&lt;const N: usize&gt;([(); N]);
</span>// T 通过作为 GenericTrait 的参数来产生约束。
impl&lt;T&gt; GenericTrait&lt;T&gt; for i32 { /* ... */ }

// T 通过作为 GenericStruct 的参数来产生约束
impl&lt;T&gt; Trait for GenericStruct&lt;T&gt; { /* ... */ }

// 同样地，N 通过作为 ConstGenericStruct 的参数来产生约束
impl&lt;const N: usize&gt; Trait for ConstGenericStruct&lt;N&gt; { /* ... */ }

// T 通过作为类型 U 的绑定中的关联类型来产生约束，而 U 本身是约束该特型的泛型参数。
impl&lt;T, U&gt; GenericTrait&lt;U&gt; for u32 where U: HasAssocType&lt;Ty = T&gt; { /* ... */ }

// 与前一个类似，除了类型是 (U, isize)。U 出现在包含 T 的类型内部，而不是该类型本身。
impl&lt;T, U&gt; GenericStruct&lt;U&gt; where (U, isize): HasAssocType&lt;Ty = T&gt; { /* ... */ }
<span class="boring">}</span></code></pre>
<p>不产生约束的情况示例：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 以下其余部分都是错误，因为它们具有不产生约束的类型或常量参数。

// T 不产生约束，因为它根本没有出现。
impl&lt;T&gt; Struct { /* ... */ }

// N 出因同样的原因不产生约束。
impl&lt;const N: usize&gt; Struct { /* ... */ }

// 在实现内部使用 T 并不约束 impl。
impl&lt;T&gt; Struct {
    fn uses_t(t: &amp;T) { /* ... */ }
}

// T 在 U 的绑定中被用作关联类型，但 U 并不产生约束。
impl&lt;T, U&gt; Struct where U: HasAssocType&lt;Ty = T&gt; { /* ... */ }

// T 在绑定中使用，但不是作为关联类型使用，因此它不产生约束。
impl&lt;T, U&gt; GenericTrait&lt;U&gt; for u32 where U: GenericTrait&lt;T&gt; {}
<span class="boring">}</span></code></pre>
<p>允许的不产生约束的生命周期参数示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct Struct;
</span>impl&lt;'a&gt; Struct {}
<span class="boring">}</span></code></pre>
<p>不允许的不产生约束的生命周期参数示例：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct Struct;
</span><span class="boring">trait HasAssocType { type Ty; }
</span>impl&lt;'a&gt; HasAssocType for Struct {
    type Ty = &amp;'a Struct;
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.impl.attributes"><a class="rule-link" href="#r-items.impl.attributes" title="items.impl.attributes"><span>[items<wbr>.impl<wbr>.attributes]</span></a>
</div>

<h2 id="实现上的属性"><a class="header" href="#实现上的属性">实现上的属性</a></h2>
<p>实现可以在 <code>impl</code> 关键字之前包含外部 <a href="#属性-1">属性</a>，并在包含关联项的大括号内包含内部 <a href="#属性-1">属性</a>。内部属性必须位于任何关联项之前。此处有意义的属性是 <a href="#条件编译"><code>cfg</code></a>、<a href="#the-deprecated-attribute"><code>deprecated</code></a>、<a href="https://doc.rust-lang.org/rustdoc/the-doc-attribute.html"><code>doc</code></a> 和 <a href="#lint-check-attributes">lint 检查属性</a>。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-items.extern"><a class="rule-link" href="#r-items.extern" title="items.extern"><span>[items<wbr>.extern]</span></a>
</div>

<h1 id="外部块"><a class="header" href="#外部块">外部块</a></h1>
<div class="rule" id="r-items.extern.syntax"><a class="rule-link" href="#r-items.extern.syntax" title="items.extern.syntax"><span>[items<wbr>.extern<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ExternBlock" onclick="show_railroad()"><a href="#railroad-ExternBlock">ExternBlock</a></span> → <br>    <span class="grammar-literal">unsafe</span><sup>?</sup>​<sup class="footnote-reference" id="fr-unsafe-2024-1"><a href="#footnote-unsafe-2024">1</a></sup> <span class="grammar-literal">extern</span> <span class="grammar-text"><a href="#grammar-Abi">Abi</a></span><sup>?</sup> <span class="grammar-literal">{</span> <br>        <span class="grammar-text"><a href="#grammar-InnerAttribute">InnerAttribute</a></span><sup>*</sup> <br>        <span class="grammar-text"><a href="#grammar-ExternalItem">ExternalItem</a></span><sup>*</sup> <br>    <span class="grammar-literal">}</span></p>
<p><span class="grammar-text grammar-production" id="grammar-ExternalItem" onclick="show_railroad()"><a href="#railroad-ExternalItem">ExternalItem</a></span> → <br>    <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> ( <br>        <span class="grammar-text"><a href="#grammar-MacroInvocationSemi">MacroInvocationSemi</a></span> <br>      | <span class="grammar-text"><a href="#grammar-Visibility">Visibility</a></span><sup>?</sup> <span class="grammar-text"><a href="#grammar-StaticItem">StaticItem</a></span> <br>      | <span class="grammar-text"><a href="#grammar-Visibility">Visibility</a></span><sup>?</sup> <span class="grammar-text"><a href="#grammar-Function">Function</a></span> <br>    )</p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 854px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ExternBlock"><svg class="railroad" viewbox="0 0 854 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ExternBlock">
<text class="comment" x="53" y="25">
ExternBlock</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 68 m -31 0 l -5 -5 m 0 10 l 5 -5 m 31 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="55" />
<text x="93" y="71">
unsafe</text>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="161" y="55" />
<text x="195" y="71">
extern</text>
</g>
<g class="optional">
<path d=" M 239 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 44 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-Abi">
<g class="nonterminal">
<rect height="22" width="44" x="263" y="55" />
<text x="285" y="71">
Abi</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="341" y="55" />
<text x="355" y="71">
{</text>
</g>
<g class="optional">
<path d=" M 379 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 403 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-InnerAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="415" y="55" />
<text x="481" y="71">
InnerAttribute</text>
</g>
</a>
</g>
</g>
<g class="optional">
<path d=" M 593 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 140 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 617 66 h 12 m 116 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -116 m 61 0 l 5 -5 m 0 10 l -5 -5 m -61 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-ExternalItem">
<g class="nonterminal">
<rect height="22" width="116" x="629" y="55" />
<text x="687" y="71">
ExternalItem</text>
</g>
</a>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="791" y="55" />
<text x="805" y="71">
}</text>
</g>
<path d=" M 151 66 h 10" />
<path d=" M 229 66 h 10" />
<path d=" M 331 66 h 10" />
<path d=" M 369 66 h 10" />
<path d=" M 583 66 h 10" />
<path d=" M 781 66 h 10" />
</g>
<path d=" M 829 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 819 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 590px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ExternalItem"><svg class="railroad" viewbox="0 0 590 177" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ExternalItem">
<text class="comment" x="57" y="25">
ExternalItem</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<g class="choice">
<path d=" M 249 66 h 24 m 172 0 h 110 m -52 0 l -5 -5 m 0 10 l 5 -5 m 52 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-MacroInvocationSemi">
<g class="nonterminal">
<rect height="22" width="172" x="273" y="55" />
<text x="359" y="71">
MacroInvocationSemi</text>
</g>
</a>
</g>
<path d=" M 249 66 a 12 12 0 0 1 12 12 v 9 m 282 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 261 99 v 33 m 282 0 v -33" />
<path d=" M 261 87 v 12 a 12 12 0 0 0 12 12 m 258 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="optional">
<path d=" M 273 111 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-Visibility">
<g class="nonterminal">
<rect height="22" width="100" x="297" y="100" />
<text x="347" y="116">
Visibility</text>
</g>
</a>
</g>
<a class="link" xlink:href="#railroad-StaticItem">
<g class="nonterminal">
<rect height="22" width="100" x="431" y="100" />
<text x="481" y="116">
StaticItem</text>
</g>
</a>
<path d=" M 421 111 h 10" />
</g>
<path d=" M 261 132 v 12 a 12 12 0 0 0 12 12 m 242 0 h 16 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="optional">
<path d=" M 273 156 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-Visibility">
<g class="nonterminal">
<rect height="22" width="100" x="297" y="145" />
<text x="347" y="161">
Visibility</text>
</g>
</a>
</g>
<a class="link" xlink:href="#railroad-Function">
<g class="nonterminal">
<rect height="22" width="84" x="431" y="145" />
<text x="473" y="161">
Function</text>
</g>
</a>
<path d=" M 421 156 h 10" />
</g>
</g>
<path d=" M 239 66 h 10" />
</g>
<path d=" M 565 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 555 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-items.extern.intro"><a class="rule-link" href="#r-items.extern.intro" title="items.extern.intro"><span>[items<wbr>.extern<wbr>.intro]</span></a>
</div>

<p>外部块提供在当前 crate 中未  <em>定义</em>  而是  <em>声明</em>  的 项 的声明，是 Rust 外部函数接口 (FFI) 的基础。这些类似于未经检查的导入。</p>
<div class="rule" id="r-items.extern.allowed-kinds"><a class="rule-link" href="#r-items.extern.allowed-kinds" title="items.extern.allowed-kinds"><span>[items<wbr>.extern<wbr>.allowed-kinds]</span></a>
</div>

<p>外部块中允许两种 项 <em>声明</em> ： <a href="#函数">函数</a> 和 <a href="#静态项">静态项</a>。</p>
<div class="rule" id="r-items.extern.safety"><a class="rule-link" href="#r-items.extern.safety" title="items.extern.safety"><span>[items<wbr>.extern<wbr>.safety]</span></a>
</div>

<p>仅允许在 <a href="#unsafe-关键字"><code>unsafe</code> 上下文</a> 中调用在外部块中声明的 不安全 函数或访问 不安全 静态项。</p>
<div class="rule" id="r-items.extern.namespace"><a class="rule-link" href="#r-items.extern.namespace" title="items.extern.namespace"><span>[items<wbr>.extern<wbr>.namespace]</span></a>
</div>

<p>外部块在其所在的模块或块的 <a href="#命名空间">值命名空间</a> 中定义其函数和静态项。</p>
<div class="rule" id="r-items.extern.unsafe-required"><a class="rule-link" href="#r-items.extern.unsafe-required" title="items.extern.unsafe-required"><span>[items<wbr>.extern<wbr>.unsafe-required]</span></a>
</div>

<p>从语义上讲，<code>unsafe</code> 关键字必须出现在外部块的 <code>extern</code> 关键字之前。</p>
<div class="rule" id="r-items.extern.edition2024"><a class="rule-link" href="#r-items.extern.edition2024" title="items.extern.edition2024"><span>[items<wbr>.extern<wbr>.edition2024]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2024</span> 版次差异</p>

<p>在 2024 版次 之前，<code>unsafe</code> 关键字是可选的。只有当外部块本身被标记为 <code>unsafe</code> 时，才允许使用 <code>safe</code> 和 <code>unsafe</code> 项限定符。</p>
</blockquote>
</div>

<div class="rule" id="r-items.extern.fn"><a class="rule-link" href="#r-items.extern.fn" title="items.extern.fn"><span>[items<wbr>.extern<wbr>.fn]</span></a>
</div>

<h2 id="函数-1"><a class="header" href="#函数-1">函数</a></h2>
<div class="rule" id="r-items.extern.fn.body"><a class="rule-link" href="#r-items.extern.fn.body" title="items.extern.fn.body"><span>[items<wbr>.extern<wbr>.fn<wbr>.body]</span></a>
</div>

<p>外部块中的函数声明方式与其它 Rust 函数相同，不同之处在于它们不能有函数体，而是以分号结尾。</p>
<div class="rule" id="r-items.extern.fn.param-patterns"><a class="rule-link" href="#r-items.extern.fn.param-patterns" title="items.extern.fn.param-patterns"><span>[items<wbr>.extern<wbr>.fn<wbr>.param-patterns]</span></a>
</div>

<p>参数中不允许使用模式，只能使用 <a href="#grammar-IDENTIFIER">IDENTIFIER</a> 或 <code>_</code>。</p>
<div class="rule" id="r-items.extern.fn.qualifiers"><a class="rule-link" href="#r-items.extern.fn.qualifiers" title="items.extern.fn.qualifiers"><span>[items<wbr>.extern<wbr>.fn<wbr>.qualifiers]</span></a>
</div>

<p>允许使用 <code>safe</code> 和 <code>unsafe</code> 函数限定符，但不允许使用其它函数限定符（例如 <code>const</code>、<code>async</code>、<code>extern</code>）。</p>
<div class="rule" id="r-items.extern.fn.foreign-abi"><a class="rule-link" href="#r-items.extern.fn.foreign-abi" title="items.extern.fn.foreign-abi"><span>[items<wbr>.extern<wbr>.fn<wbr>.foreign-abi]</span></a>
</div>

<p>外部块中的函数可以被 Rust 代码调用，就像在 Rust 中定义的函数一样。Rust 编译器会自动在 Rust ABI 和外部 ABI 之间进行转换。</p>
<div class="rule" id="r-items.extern.fn.safety"><a class="rule-link" href="#r-items.extern.fn.safety" title="items.extern.fn.safety"><span>[items<wbr>.extern<wbr>.fn<wbr>.safety]</span></a>
</div>

<p>在 extern 块中声明的函数隐式地是 <code>unsafe</code> 的，除非存在 <code>safe</code> 函数限定符。</p>
<div class="rule" id="r-items.extern.fn.fn-ptr"><a class="rule-link" href="#r-items.extern.fn.fn-ptr" title="items.extern.fn.fn-ptr"><span>[items<wbr>.extern<wbr>.fn<wbr>.fn-ptr]</span></a>
</div>

<p>当强制转换为函数指针时，在 extern 块中声明的函数具有类型 <code>extern "abi" for&lt;'l1, ..., 'lm&gt; fn(A1, ..., An) -&gt; R</code>，其中 <code>'l1</code>、… <code>'lm</code> 是其生命周期参数，<code>A1</code>、…、<code>An</code> 是其参数的声明类型，而 <code>R</code> 是声明的返回类型。</p>
<div class="rule" id="r-items.extern.static"><a class="rule-link" href="#r-items.extern.static" title="items.extern.static"><span>[items<wbr>.extern<wbr>.static]</span></a>
</div>

<h2 id="静态项-1"><a class="header" href="#静态项-1">静态项</a></h2>
<div class="rule" id="r-items.extern.static.intro"><a class="rule-link" href="#r-items.extern.static.intro" title="items.extern.static.intro"><span>[items<wbr>.extern<wbr>.static<wbr>.intro]</span></a>
</div>

<p>外部块中的 静态项 的声明方式与外部块之外的 <a href="#静态项">静态项</a> 相同，不同之处在于它们没有初始化其值的表达式。</p>
<div class="rule" id="r-items.extern.static.safety"><a class="rule-link" href="#r-items.extern.static.safety" title="items.extern.static.safety"><span>[items<wbr>.extern<wbr>.static<wbr>.safety]</span></a>
</div>

<p>除非在 extern 块中声明的 静态项 被限定为 <code>safe</code>，否则访问该 项 是 <code>unsafe</code> 的，无论它是否可变，因为由于某些任意（例如 C）代码负责初始化该 静态项，因此没有任何东西能保证该 静态项 内存处的位模式对于声明它的类型是有效的。</p>
<div class="rule" id="r-items.extern.static.mut"><a class="rule-link" href="#r-items.extern.static.mut" title="items.extern.static.mut"><span>[items<wbr>.extern<wbr>.static<wbr>.mut]</span></a>
</div>

<p>外部 静态项 既可以是不可变的，也可以是可变的，就像外部块之外的 <a href="#静态项">静态项</a> 一样。</p>
<div class="rule" id="r-items.extern.static.read-only"><a class="rule-link" href="#r-items.extern.static.read-only" title="items.extern.static.read-only"><span>[items<wbr>.extern<wbr>.static<wbr>.read-only]</span></a>
</div>

<p>在执行任何 Rust 代码之前， <em>必须</em>  初始化不可变 静态项。仅在 Rust 代码从中读取之前初始化 静态项 是不够的。一旦 Rust 代码运行，修改不可变 静态项（从 Rust 内部或外部）就是 未定义行为 (UB)，除非修改发生在 <code>UnsafeCell</code> 内部的字节上。</p>
<div class="rule" id="r-items.extern.abi"><a class="rule-link" href="#r-items.extern.abi" title="items.extern.abi"><span>[items<wbr>.extern<wbr>.abi]</span></a>
</div>

<h2 id="abi"><a class="header" href="#abi">ABI</a></h2>
<div class="rule" id="r-items.extern.abi.intro"><a class="rule-link" href="#r-items.extern.abi.intro" title="items.extern.abi.intro"><span>[items<wbr>.extern<wbr>.abi<wbr>.intro]</span></a>
</div>

<p><code>extern</code> 关键字后面可以跟一个可选的 <a href="#r-glossary.abi">ABI</a> 字符串。ABI 指定了块中函数的调用约定。调用约定定义了函数的低级接口，例如参数如何放置在寄存器或栈中，返回值如何传递，以及谁负责清理栈。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Windows API 接口。
unsafe extern "system" { /* ... */ }
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-items.extern.abi.default"><a class="rule-link" href="#r-items.extern.abi.default" title="items.extern.abi.default"><span>[items<wbr>.extern<wbr>.abi<wbr>.default]</span></a>
</div>

<p>如果未指定 ABI 字符串，则默认为 <code>"C"</code>。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>不带显式 ABI 的 <code>extern</code> 语法正在逐步淘汰，因此最好始终显式写入 ABI。</p>
<p>有关更多详细信息，请参阅 <a href="https://github.com/rust-lang/rust/issues/134986">Rust 问题 #134986</a>。</p>
</blockquote>
</div>

<div class="rule" id="r-items.extern.abi.standard"><a class="rule-link" href="#r-items.extern.abi.standard" title="items.extern.abi.standard"><span>[items<wbr>.extern<wbr>.abi<wbr>.standard]</span></a>
</div>

<p>所有平台都支持以下 ABI 字符串：</p>
<div class="rule" id="r-items.extern.abi.rust"><a class="rule-link" href="#r-items.extern.abi.rust" title="items.extern.abi.rust"><span>[items<wbr>.extern<wbr>.abi<wbr>.rust]</span></a>
</div>

<ul>
<li><code>unsafe extern "Rust"</code> — Rust 函数和闭包的原生调用约定。当声明函数而不使用 <a href="#r-items.fn.extern"><code>extern fn</code></a> 时，这是默认值。Rust ABI 不提供稳定性保证。</li>
</ul>
<div class="rule" id="r-items.extern.abi.c"><a class="rule-link" href="#r-items.extern.abi.c" title="items.extern.abi.c"><span>[items<wbr>.extern<wbr>.abi<wbr>.c]</span></a>
</div>

<ul>
<li><code>unsafe extern "C"</code> — “C” ABI 与目标平台的主流 C 编译器选择的默认 ABI 匹配。</li>
</ul>
<div class="rule" id="r-items.extern.abi.system"><a class="rule-link" href="#r-items.extern.abi.system" title="items.extern.abi.system"><span>[items<wbr>.extern<wbr>.abi<wbr>.system]</span></a>
</div>

<ul>
<li>
<p><code>unsafe extern "system"</code> — 这等同于 <code>extern "C"</code>，但在 Windows x86_32 上除外，对于非变长参数函数，它等同于 <code>"stdcall"</code>，而对于变长参数函数，它等同于 <code>"C"</code>。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>由于 Windows 上正确的底层 ABI 与目标平台相关，因此在尝试链接不使用显式定义 ABI 的 Windows API 函数时，最好使用 <code>extern "system"</code>。</p>
</blockquote>
</div>

</li>
</ul>
<div class="rule" id="r-items.extern.abi.unwind"><a class="rule-link" href="#r-items.extern.abi.unwind" title="items.extern.abi.unwind"><span>[items<wbr>.extern<wbr>.abi<wbr>.unwind]</span></a>
</div>

<ul>
<li><code>extern "C-unwind"</code> 和 <code>extern "system-unwind"</code> — 分别与 <code>"C"</code> 和 <code>"system"</code> 相同，但在被调用者展开（通过 恐慌 或抛出 C++ 风格异常）时具有 <a href="#unwinding">不同的行为</a>。</li>
</ul>
<div class="rule" id="r-items.extern.abi.platform"><a class="rule-link" href="#r-items.extern.abi.platform" title="items.extern.abi.platform"><span>[items<wbr>.extern<wbr>.abi<wbr>.platform]</span></a>
</div>

<p>还有一些平台特定的 ABI 字符串：</p>
<div class="rule" id="r-items.extern.abi.cdecl"><a class="rule-link" href="#r-items.extern.abi.cdecl" title="items.extern.abi.cdecl"><span>[items<wbr>.extern<wbr>.abi<wbr>.cdecl]</span></a>
</div>

<ul>
<li>
<p><code>unsafe extern "cdecl"</code> — 通常用于 x86_32 C 代码的调用约定。</p>
<ul>
<li>仅适用于 x86_32 目标。</li>
<li>对应于 MSVC 的 <code>__cdecl</code> 以及 GCC 和 clang 的 <code>__attribute__((cdecl))</code>。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>有关详细信息，请参阅：</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/cpp/cpp/cdecl">https://learn.microsoft.com/en-us/cpp/cpp/cdecl</a></li>
<li><a href="https://en.wikipedia.org/wiki/X86_calling_conventions#cdecl">https://en.wikipedia.org/wiki/X86_calling_conventions#cdecl</a></li>
</ul>
</blockquote>
</div>

</li>
</ul>
<div class="rule" id="r-items.extern.abi.stdcall"><a class="rule-link" href="#r-items.extern.abi.stdcall" title="items.extern.abi.stdcall"><span>[items<wbr>.extern<wbr>.abi<wbr>.stdcall]</span></a>
</div>

<ul>
<li>
<p><code>unsafe extern "stdcall"</code> — 通常由 x86_32 上的 <a href="https://learn.microsoft.com/en-us/windows/win32/api/">Win32 API</a> 使用的调用约定。</p>
<ul>
<li>仅适用于 x86_32 目标。</li>
<li>对应于 MSVC 的 <code>__stdcall</code> 以及 GCC 和 clang 的 <code>__attribute__((stdcall))</code>。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>有关详细信息，请参阅：</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/cpp/cpp/stdcall">https://learn.microsoft.com/en-us/cpp/cpp/stdcall</a></li>
<li><a href="https://en.wikipedia.org/wiki/X86_calling_conventions#stdcall">https://en.wikipedia.org/wiki/X86_calling_conventions#stdcall</a></li>
</ul>
</blockquote>
</div>

</li>
</ul>
<div class="rule" id="r-items.extern.abi.win64"><a class="rule-link" href="#r-items.extern.abi.win64" title="items.extern.abi.win64"><span>[items<wbr>.extern<wbr>.abi<wbr>.win64]</span></a>
</div>

<ul>
<li>
<p><code>unsafe extern "win64"</code> — Windows x64 ABI。</p>
<ul>
<li>仅适用于 x86_64 目标。</li>
<li>“win64” 与 Windows x86_64 目标上的 “C” ABI 相同。</li>
<li>对应于 GCC 和 clang 的 <code>__attribute__((ms_abi))</code>。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>有关详细信息，请参阅：</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/cpp/build/x64-software-conventions">https://learn.microsoft.com/en-us/cpp/build/x64-software-conventions</a></li>
<li><a href="https://en.wikipedia.org/wiki/X86_calling_conventions#Microsoft_x64_calling_convention">https://en.wikipedia.org/wiki/X86_calling_conventions#Microsoft_x64_calling_convention</a></li>
</ul>
</blockquote>
</div>

</li>
</ul>
<div class="rule" id="r-items.extern.abi.sysv64"><a class="rule-link" href="#r-items.extern.abi.sysv64" title="items.extern.abi.sysv64"><span>[items<wbr>.extern<wbr>.abi<wbr>.sysv64]</span></a>
</div>

<ul>
<li>
<p><code>unsafe extern "sysv64"</code> — System V ABI。</p>
<ul>
<li>仅适用于 x86_64 目标。</li>
<li>“sysv64” 与非 Windows x86_64 目标上的 “C” ABI 相同。</li>
<li>对应于 GCC 和 clang 的 <code>__attribute__((sysv_abi))</code>。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>有关详细信息，请参阅：</p>
<ul>
<li><a href="https://wiki.osdev.org/System_V_ABI">https://wiki.osdev.org/System_V_ABI</a></li>
<li><a href="https://en.wikipedia.org/wiki/X86_calling_conventions#System_V_AMD64_ABI">https://en.wikipedia.org/wiki/X86_calling_conventions#System_V_AMD64_ABI</a></li>
</ul>
</blockquote>
</div>

</li>
</ul>
<div class="rule" id="r-items.extern.abi.aapcs"><a class="rule-link" href="#r-items.extern.abi.aapcs" title="items.extern.abi.aapcs"><span>[items<wbr>.extern<wbr>.abi<wbr>.aapcs]</span></a>
</div>

<ul>
<li>
<p><code>unsafe extern "aapcs"</code> — ARM 的软浮点 ABI。</p>
<ul>
<li>仅适用于 ARM32 目标。</li>
<li>“aapcs” 与软浮点 ARM32 上的 “C” ABI 相同。</li>
<li>对应于 clang 的 <code>__attribute__((pcs("aapcs")))</code>。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>有关详细信息，请参阅：</p>
<ul>
<li><a href="https://developer.arm.com/documentation/107656/0101/Getting-started-with-Armv8-M-based-systems/Procedure-Call-Standard-for-Arm-Architecture--AAPCS-">Arm 过程调用标准</a></li>
</ul>
</blockquote>
</div>

</li>
</ul>
<div class="rule" id="r-items.extern.abi.fastcall"><a class="rule-link" href="#r-items.extern.abi.fastcall" title="items.extern.abi.fastcall"><span>[items<wbr>.extern<wbr>.abi<wbr>.fastcall]</span></a>
</div>

<ul>
<li>
<p><code>unsafe extern "fastcall"</code> — stdcall 的 “快速” 变体，通过寄存器传递某些参数。</p>
<ul>
<li>仅适用于 x86_32 目标。</li>
<li>对应于 MSVC 的 <code>__fastcall</code> 以及 GCC 和 clang 的 <code>__attribute__((fastcall))</code>。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>有关详细信息，请参阅：</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/cpp/cpp/fastcall">https://learn.microsoft.com/en-us/cpp/cpp/fastcall</a></li>
<li><a href="https://en.wikipedia.org/wiki/X86_calling_conventions#Microsoft_fastcall">https://en.wikipedia.org/wiki/X86_calling_conventions#Microsoft_fastcall</a></li>
</ul>
</blockquote>
</div>

</li>
</ul>
<div class="rule" id="r-items.extern.abi.thiscall"><a class="rule-link" href="#r-items.extern.abi.thiscall" title="items.extern.abi.thiscall"><span>[items<wbr>.extern<wbr>.abi<wbr>.thiscall]</span></a>
</div>

<ul>
<li>
<p><code>unsafe extern "thiscall"</code> — 通常在 x86_32 MSVC 上用于 C++ 类成员函数的调用约定。</p>
<ul>
<li>仅适用于 x86_32 目标。</li>
<li>对应于 MSVC 的 <code>__thiscall</code> 以及 GCC 和 clang 的 <code>__attribute__((thiscall))</code>。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>有关详细信息，请参阅：</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/X86_calling_conventions#thiscall">https://en.wikipedia.org/wiki/X86_calling_conventions#thiscall</a></li>
<li><a href="https://learn.microsoft.com/en-us/cpp/cpp/thiscall">https://learn.microsoft.com/en-us/cpp/cpp/thiscall</a></li>
</ul>
</blockquote>
</div>

</li>
</ul>
<div class="rule" id="r-items.extern.abi.efiapi"><a class="rule-link" href="#r-items.extern.abi.efiapi" title="items.extern.abi.efiapi"><span>[items<wbr>.extern<wbr>.abi<wbr>.efiapi]</span></a>
</div>

<ul>
<li><code>unsafe extern "efiapi"</code> — 用于 <a href="https://uefi.org/specifications">UEFI</a> 函数的 ABI。
<ul>
<li>仅适用于 x86 和 ARM 目标（32 位和 64 位）。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-items.extern.abi.platform-unwind-variants"><a class="rule-link" href="#r-items.extern.abi.platform-unwind-variants" title="items.extern.abi.platform-unwind-variants"><span>[items<wbr>.extern<wbr>.abi<wbr>.platform-unwind-variants]</span></a>
</div>

<p>与 <code>"C"</code> 和 <code>"system"</code> 类似，大多数平台特定的 ABI 字符串也具有 <a href="#unwinding">对应的 <code>-unwind</code> 变体</a>；具体而言，它们是：</p>
<ul>
<li><code>"aapcs-unwind"</code></li>
<li><code>"cdecl-unwind"</code></li>
<li><code>"fastcall-unwind"</code></li>
<li><code>"stdcall-unwind"</code></li>
<li><code>"sysv64-unwind"</code></li>
<li><code>"thiscall-unwind"</code></li>
<li><code>"win64-unwind"</code></li>
</ul>
<div class="rule" id="r-items.extern.variadic"><a class="rule-link" href="#r-items.extern.variadic" title="items.extern.variadic"><span>[items<wbr>.extern<wbr>.variadic]</span></a>
</div>

<h2 id="变长参数函数"><a class="header" href="#变长参数函数">变长参数函数</a></h2>
<p>外部块中的函数可以通过指定 <code>...</code> 作为最后一个参数来成为变长的。变长参数可以可选地指定一个标识符。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>unsafe extern "C" {
    unsafe fn foo(...);
    unsafe fn bar(x: i32, ...);
    unsafe fn with_name(format: *const u8, args: ...);
    // 安全性：此函数保证它根本不会访问变长参数。
    safe fn ignores_variadic_arguments(x: i32, ...);
}
<span class="boring">}</span></code></pre>
<div class="alert alert-warning">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>警告</p>

<p>不应在 <code>extern</code> 块中的函数上使用 <code>safe</code> 限定符，除非该函数保证它根本不会访问变长参数。向变长参数函数传递非预期数量的参数或非预期类型的参数可能会导致 <a href="#r-undefined">未定义行为</a>。</p>
</blockquote>
</div>

<div class="rule" id="r-items.extern.variadic.conventions"><a class="rule-link" href="#r-items.extern.variadic.conventions" title="items.extern.variadic.conventions"><span>[items<wbr>.extern<wbr>.variadic<wbr>.conventions]</span></a>
</div>

<p>变长参数只能在具有以下 ABI 字符串或其对应 <a href="#r-items.fn.extern.unwind"><code>-unwind</code> 变体</a> 的 <code>extern</code> 块中指定：</p>
<ul>
<li><code>"aapcs"</code></li>
<li><code>"C"</code></li>
<li><code>"cdecl"</code></li>
<li><code>"efiapi"</code></li>
<li><code>"system"</code></li>
<li><code>"sysv64"</code></li>
<li><code>"win64"</code></li>
</ul>
<div class="rule" id="r-items.extern.attributes"><a class="rule-link" href="#r-items.extern.attributes" title="items.extern.attributes"><span>[items<wbr>.extern<wbr>.attributes]</span></a>
</div>

<h2 id="外部块上的属性"><a class="header" href="#外部块上的属性">外部块上的属性</a></h2>
<div class="rule" id="r-items.extern.attributes.intro"><a class="rule-link" href="#r-items.extern.attributes.intro" title="items.extern.attributes.intro"><span>[items<wbr>.extern<wbr>.attributes<wbr>.intro]</span></a>
</div>

<p>以下 <a href="#属性-1">属性</a> 控制外部块的行为。</p>
<div class="rule" id="r-items.extern.attributes.link"><a class="rule-link" href="#r-items.extern.attributes.link" title="items.extern.attributes.link"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link]</span></a>
</div>

<h3 id="link属性"><a class="header" href="#link属性"><code>link</code>属性</a></h3>
<div class="rule" id="r-items.extern.attributes.link.intro"><a class="rule-link" href="#r-items.extern.attributes.link.intro" title="items.extern.attributes.link.intro"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.intro]</span></a>
</div>

<p><em><code>link</code> 属性</em>  指定了编译器应针对 <code>extern</code> 块内的 项 进行链接的原生库的名称。</p>
<div class="rule" id="r-items.extern.attributes.link.syntax"><a class="rule-link" href="#r-items.extern.attributes.link.syntax" title="items.extern.attributes.link.syntax"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.syntax]</span></a>
</div>

<p>它使用 <a href="#grammar-MetaListNameValueStr">MetaListNameValueStr</a> 语法来指定其输入。<code>name</code> 键是要链接的原生库的名称。<code>kind</code> 键是一个可选值，它指定了库的类型，具有以下可能的值：</p>
<div class="rule" id="r-items.extern.attributes.link.dylib"><a class="rule-link" href="#r-items.extern.attributes.link.dylib" title="items.extern.attributes.link.dylib"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.dylib]</span></a>
</div>

<ul>
<li><code>dylib</code> — 表示动态库。如果未指定 <code>kind</code>，则这是默认值。</li>
</ul>
<div class="rule" id="r-items.extern.attributes.link.static"><a class="rule-link" href="#r-items.extern.attributes.link.static" title="items.extern.attributes.link.static"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.static]</span></a>
</div>

<ul>
<li><code>static</code> — 表示静态库。</li>
</ul>
<div class="rule" id="r-items.extern.attributes.link.framework"><a class="rule-link" href="#r-items.extern.attributes.link.framework" title="items.extern.attributes.link.framework"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.framework]</span></a>
</div>

<ul>
<li><code>framework</code> — 表示 macOS 框架。这仅对 macOS 目标有效。</li>
</ul>
<div class="rule" id="r-items.extern.attributes.link.raw-dylib"><a class="rule-link" href="#r-items.extern.attributes.link.raw-dylib" title="items.extern.attributes.link.raw-dylib"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.raw-dylib]</span></a>
</div>

<ul>
<li><code>raw-dylib</code> — 表示一个动态库，编译器将生成一个导入库来与其链接（详见下文的 <a href="#dylib-versus-raw-dylib"><code>dylib</code> 与 <code>raw-dylib</code> 比较</a>）。这仅对 Windows 目标有效。</li>
</ul>
<div class="rule" id="r-items.extern.attributes.link.name-requirement"><a class="rule-link" href="#r-items.extern.attributes.link.name-requirement" title="items.extern.attributes.link.name-requirement"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.name-requirement]</span></a>
</div>

<p>如果指定了 <code>kind</code>，则必须包含 <code>name</code> 键。</p>
<div class="rule" id="r-items.extern.attributes.link.modifiers"><a class="rule-link" href="#r-items.extern.attributes.link.modifiers" title="items.extern.attributes.link.modifiers"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.modifiers]</span></a>
</div>

<p>可选的 <code>modifiers</code> 参数是一种为要链接的库指定链接修饰符的方法。</p>
<div class="rule" id="r-items.extern.attributes.link.modifiers.syntax"><a class="rule-link" href="#r-items.extern.attributes.link.modifiers.syntax" title="items.extern.attributes.link.modifiers.syntax"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.modifiers<wbr>.syntax]</span></a>
</div>

<p>修饰符指定为以逗号分隔的字符串，每个修饰符前缀为 <code>+</code> 或 <code>-</code>，分别表示启用或禁用该修饰符。</p>
<div class="rule" id="r-items.extern.attributes.link.modifiers.multiple"><a class="rule-link" href="#r-items.extern.attributes.link.modifiers.multiple" title="items.extern.attributes.link.modifiers.multiple"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.modifiers<wbr>.multiple]</span></a>
</div>

<p>目前不支持在单个 <code>link</code> 属性中指定多个 <code>modifiers</code> 参数，或者在同一个 <code>modifiers</code> 参数中指定多个相同的修饰符。 <br>示例：<code>#[link(name = "mylib", kind = "static", modifiers = "+whole-archive")]</code>。</p>
<div class="rule" id="r-items.extern.attributes.link.wasm_import_module"><a class="rule-link" href="#r-items.extern.attributes.link.wasm_import_module" title="items.extern.attributes.link.wasm_import_module"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.wasm_import_module]</span></a>
</div>

<p>当从宿主环境导入符号时，<code>wasm_import_module</code> 键可用于为 <code>extern</code> 块中的 项 指定 <a href="https://webassembly.github.io/spec/core/syntax/modules.html">WebAssembly 模块</a> 名称。如果未指定 <code>wasm_import_module</code>，则默认模块名称为 <code>env</code>。</p>
<!-- ignore: requires extern linking -->
<pre><code class="language-rust ignore">#[link(name = "crypto")]
unsafe extern {
    // …
}

#[link(name = "CoreFoundation", kind = "framework")]
unsafe extern {
    // …
}

#[link(wasm_import_module = "foo")]
unsafe extern {
    // …
}</code></pre>
<div class="rule" id="r-items.extern.attributes.link.empty-block"><a class="rule-link" href="#r-items.extern.attributes.link.empty-block" title="items.extern.attributes.link.empty-block"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.empty-block]</span></a>
</div>

<p>在空的外部块上添加 <code>link</code> 属性是有效的。您可以使用它来满足代码中其他地方（包括上游 crate）外部块的链接要求，而不是在每个外部块中都添加该属性。</p>
<div class="rule" id="r-items.extern.attributes.link.modifiers.bundle"><a class="rule-link" href="#r-items.extern.attributes.link.modifiers.bundle" title="items.extern.attributes.link.modifiers.bundle"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.modifiers<wbr>.bundle]</span></a>
</div>

<h4 id="链接修饰符bundle"><a class="header" href="#链接修饰符bundle">链接修饰符：<code>bundle</code></a></h4>
<div class="rule" id="r-items.extern.attributes.link.modifiers.bundle.allowed-kinds"><a class="rule-link" href="#r-items.extern.attributes.link.modifiers.bundle.allowed-kinds" title="items.extern.attributes.link.modifiers.bundle.allowed-kinds"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.modifiers<wbr>.bundle<wbr>.allowed-kinds]</span></a>
</div>

<p>此修饰符仅与 <code>static</code> 链接类型兼容。使用任何其他类型都将导致编译器错误。</p>
<div class="rule" id="r-items.extern.attributes.link.modifiers.bundle.behavior"><a class="rule-link" href="#r-items.extern.attributes.link.modifiers.bundle.behavior" title="items.extern.attributes.link.modifiers.bundle.behavior"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.modifiers<wbr>.bundle<wbr>.behavior]</span></a>
</div>

<p>在构建 rlib 或 staticlib 时，<code>+bundle</code> 意味着原生静态库将被打包到 rlib 或 staticlib 归档中，然后在链接最终二进制文件期间从中检索。</p>
<div class="rule" id="r-items.extern.attributes.link.modifiers.bundle.behavior-negative"><a class="rule-link" href="#r-items.extern.attributes.link.modifiers.bundle.behavior-negative" title="items.extern.attributes.link.modifiers.bundle.behavior-negative"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.modifiers<wbr>.bundle<wbr>.behavior-negative]</span></a>
</div>

<p>在构建 rlib 时，<code>-bundle</code> 意味着原生静态库被 “按名称” 注册为该 rlib 的依赖项，并且仅在链接最终二进制文件期间才包含其中的目标文件，在最终链接期间也会执行按该名称的文件搜索。 <br>在构建 staticlib 时，<code>-bundle</code> 意味着原生静态库根本不包含在归档中，某些更高级别的构建系统将需要在稍后链接最终二进制文件期间添加它。</p>
<div class="rule" id="r-items.extern.attributes.link.modifiers.bundle.no-effect"><a class="rule-link" href="#r-items.extern.attributes.link.modifiers.bundle.no-effect" title="items.extern.attributes.link.modifiers.bundle.no-effect"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.modifiers<wbr>.bundle<wbr>.no-effect]</span></a>
</div>

<p>在构建可执行文件或动态库等其他目标时，此修饰符没有效果。</p>
<div class="rule" id="r-items.extern.attributes.link.modifiers.bundle.default"><a class="rule-link" href="#r-items.extern.attributes.link.modifiers.bundle.default" title="items.extern.attributes.link.modifiers.bundle.default"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.modifiers<wbr>.bundle<wbr>.default]</span></a>
</div>

<p>此修饰符的默认值为 <code>+bundle</code>。</p>
<p>有关此修饰符的更多实现细节，可以在 <a href="https://doc.rust-lang.org/rustc/command-line-arguments.html#linking-modifiers-bundle">rustc 的 <code>bundle</code> 文档</a> 中找到。</p>
<div class="rule" id="r-items.extern.attributes.link.modifiers.whole-archive"><a class="rule-link" href="#r-items.extern.attributes.link.modifiers.whole-archive" title="items.extern.attributes.link.modifiers.whole-archive"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.modifiers<wbr>.whole-archive]</span></a>
</div>

<h4 id="链接修饰符whole-archive"><a class="header" href="#链接修饰符whole-archive">链接修饰符：<code>whole-archive</code></a></h4>
<div class="rule" id="r-items.extern.attributes.link.modifiers.whole-archive.allowed-kinds"><a class="rule-link" href="#r-items.extern.attributes.link.modifiers.whole-archive.allowed-kinds" title="items.extern.attributes.link.modifiers.whole-archive.allowed-kinds"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.modifiers<wbr>.whole-archive<wbr>.allowed-kinds]</span></a>
</div>

<p>此修饰符仅与 <code>static</code> 链接类型兼容。使用任何其他类型都将导致编译器错误。</p>
<div class="rule" id="r-items.extern.attributes.link.modifiers.whole-archive.behavior"><a class="rule-link" href="#r-items.extern.attributes.link.modifiers.whole-archive.behavior" title="items.extern.attributes.link.modifiers.whole-archive.behavior"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.modifiers<wbr>.whole-archive<wbr>.behavior]</span></a>
</div>

<p><code>+whole-archive</code> 意味着静态库作为整个归档进行链接，而不丢弃任何目标文件。</p>
<div class="rule" id="r-items.extern.attributes.link.modifiers.whole-archive.default"><a class="rule-link" href="#r-items.extern.attributes.link.modifiers.whole-archive.default" title="items.extern.attributes.link.modifiers.whole-archive.default"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.modifiers<wbr>.whole-archive<wbr>.default]</span></a>
</div>

<p>此修饰符的默认值为 <code>-whole-archive</code>。</p>
<p>有关此修饰符的更多实现细节，可以在 <a href="https://doc.rust-lang.org/rustc/command-line-arguments.html#linking-modifiers-whole-archive">rustc 的 <code>whole-archive</code> 文档</a> 中找到。</p>
<div class="rule" id="r-items.extern.attributes.link.modifiers.verbatim"><a class="rule-link" href="#r-items.extern.attributes.link.modifiers.verbatim" title="items.extern.attributes.link.modifiers.verbatim"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.modifiers<wbr>.verbatim]</span></a>
</div>

<h3 id="链接修饰符verbatim"><a class="header" href="#链接修饰符verbatim">链接修饰符：<code>verbatim</code></a></h3>
<div class="rule" id="r-items.extern.attributes.link.modifiers.verbatim.allowed-kinds"><a class="rule-link" href="#r-items.extern.attributes.link.modifiers.verbatim.allowed-kinds" title="items.extern.attributes.link.modifiers.verbatim.allowed-kinds"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.modifiers<wbr>.verbatim<wbr>.allowed-kinds]</span></a>
</div>

<p>此修饰符与所有链接类型兼容。</p>
<div class="rule" id="r-items.extern.attributes.link.modifiers.verbatim.behavior"><a class="rule-link" href="#r-items.extern.attributes.link.modifiers.verbatim.behavior" title="items.extern.attributes.link.modifiers.verbatim.behavior"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.modifiers<wbr>.verbatim<wbr>.behavior]</span></a>
</div>

<p><code>+verbatim</code> 意味着 rustc 本身不会向库名称添加任何目标平台指定的库前缀或后缀（如 <code>lib</code> 或 <code>.a</code>），并将尽力向链接器请求同样的内容。</p>
<div class="rule" id="r-items.extern.attributes.link.modifiers.verbatim.behavior-negative"><a class="rule-link" href="#r-items.extern.attributes.link.modifiers.verbatim.behavior-negative" title="items.extern.attributes.link.modifiers.verbatim.behavior-negative"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.modifiers<wbr>.verbatim<wbr>.behavior-negative]</span></a>
</div>

<p><code>-verbatim</code> 意味着 rustc 在将库名称传递给链接器之前，会向其添加目标平台特定的前缀和后缀，或者不会阻止链接器隐式添加它。</p>
<div class="rule" id="r-items.extern.attributes.link.modifiers.verbatim.default"><a class="rule-link" href="#r-items.extern.attributes.link.modifiers.verbatim.default" title="items.extern.attributes.link.modifiers.verbatim.default"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.modifiers<wbr>.verbatim<wbr>.default]</span></a>
</div>

<p>此修饰符的默认值为 <code>-verbatim</code>。</p>
<p>有关此修饰符的更多实现细节，可以在 <a href="https://doc.rust-lang.org/rustc/command-line-arguments.html#linking-modifiers-verbatim">rustc 的 <code>verbatim</code> 文档</a> 中找到。</p>
<div class="rule" id="r-items.extern.attributes.link.kind-raw-dylib"><a class="rule-link" href="#r-items.extern.attributes.link.kind-raw-dylib" title="items.extern.attributes.link.kind-raw-dylib"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.kind-raw-dylib]</span></a>
</div>

<h4 id="dylib与-raw-dylib比较"><a class="header" href="#dylib与-raw-dylib比较"><code>dylib</code>与 <code>raw-dylib</code>比较</a></h4>
<div class="rule" id="r-items.extern.attributes.link.kind-raw-dylib.intro"><a class="rule-link" href="#r-items.extern.attributes.link.kind-raw-dylib.intro" title="items.extern.attributes.link.kind-raw-dylib.intro"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.kind-raw-dylib<wbr>.intro]</span></a>
</div>

<p>在 Windows 上，与动态库链接要求向链接器提供一个导入库：这是一个特殊的静态库，它声明了动态库导出的所有符号，其方式使链接器知道它们必须在运行时动态加载。</p>
<div class="rule" id="r-items.extern.attributes.link.kind-raw-dylib.import"><a class="rule-link" href="#r-items.extern.attributes.link.kind-raw-dylib.import" title="items.extern.attributes.link.kind-raw-dylib.import"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.kind-raw-dylib<wbr>.import]</span></a>
</div>

<p>指定 <code>kind = "dylib"</code> 会指示 Rust 编译器链接一个基于 <code>name</code> 键的导入库。链接器随后将使用其正常的库解析逻辑来查找该导入库。或者，指定 <code>kind = "raw-dylib"</code> 会指示编译器在编译期间生成一个导入库，并将该导入库提供给链接器。</p>
<div class="rule" id="r-items.extern.attributes.link.kind-raw-dylib.platform-specific"><a class="rule-link" href="#r-items.extern.attributes.link.kind-raw-dylib.platform-specific" title="items.extern.attributes.link.kind-raw-dylib.platform-specific"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.kind-raw-dylib<wbr>.platform-specific]</span></a>
</div>

<p><code>raw-dylib</code> 仅在 Windows 上受支持。针对其他平台使用它将导致编译器错误。</p>
<div class="rule" id="r-items.extern.attributes.link.import_name_type"><a class="rule-link" href="#r-items.extern.attributes.link.import_name_type" title="items.extern.attributes.link.import_name_type"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.import_name_type]</span></a>
</div>

<h4 id="import_name_type键"><a class="header" href="#import_name_type键"><code>import_name_type</code>键</a></h4>
<div class="rule" id="r-items.extern.attributes.link.import_name_type.intro"><a class="rule-link" href="#r-items.extern.attributes.link.import_name_type.intro" title="items.extern.attributes.link.import_name_type.intro"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.import_name_type<wbr>.intro]</span></a>
</div>

<p>在 x86 Windows 上，函数名称会被 “修饰” (decorated)（即添加特定的前缀和/或后缀）以指示其调用约定。例如，一个名为 <code>fn1</code> 且没有参数的 <code>stdcall</code> 调用约定函数将被修饰为 <code>_fn1@0</code>。然而，<a href="https://learn.microsoft.com/windows/win32/debug/pe-format#import-name-type">PE 格式</a> 也确实允许名称没有前缀或不被修饰。此外，MSVC 和 GNU 工具链对相同的调用约定使用不同的修饰，这意味着默认情况下，某些 Win32 函数无法通过 GNU 工具链使用 <code>raw-dylib</code> 链接类型进行调用。</p>
<div class="rule" id="r-items.extern.attributes.link.import_name_type.values"><a class="rule-link" href="#r-items.extern.attributes.link.import_name_type.values" title="items.extern.attributes.link.import_name_type.values"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.import_name_type<wbr>.values]</span></a>
</div>

<p>为了允许这些差异，在使用 <code>raw-dylib</code> 链接类型时，您还可以使用以下值之一指定 <code>import_name_type</code> 键，以更改生成的导入库中函数的命名方式：</p>
<ul>
<li><code>decorated</code>：函数名称将使用 MSVC 工具链格式进行完整修饰。</li>
<li><code>noprefix</code>：函数名称将使用 MSVC 工具链格式进行修饰，但跳过前导的 <code>?</code>、<code>@</code> 或可选的 <code>_</code>。</li>
<li><code>undecorated</code>：函数名称将不被修饰。</li>
</ul>
<div class="rule" id="r-items.extern.attributes.link.import_name_type.default"><a class="rule-link" href="#r-items.extern.attributes.link.import_name_type.default" title="items.extern.attributes.link.import_name_type.default"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.import_name_type<wbr>.default]</span></a>
</div>

<p>如果未指定 <code>import_name_type</code> 键，则函数名称将使用目标工具链的格式进行完整修饰。</p>
<div class="rule" id="r-items.extern.attributes.link.import_name_type.variables"><a class="rule-link" href="#r-items.extern.attributes.link.import_name_type.variables" title="items.extern.attributes.link.import_name_type.variables"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.import_name_type<wbr>.variables]</span></a>
</div>

<p>变量永远不会被修饰，因此 <code>import_name_type</code> 键对它们在生成的导入库中的命名方式没有影响。</p>
<div class="rule" id="r-items.extern.attributes.link.import_name_type.platform-specific"><a class="rule-link" href="#r-items.extern.attributes.link.import_name_type.platform-specific" title="items.extern.attributes.link.import_name_type.platform-specific"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link<wbr>.import_name_type<wbr>.platform-specific]</span></a>
</div>

<p><code>import_name_type</code> 键仅在 x86 Windows 上受支持。针对其他平台使用它将导致编译器错误。</p>
<!-- template:attributes -->
<div class="rule" id="r-items.extern.attributes.link_name"><a class="rule-link" href="#r-items.extern.attributes.link_name" title="items.extern.attributes.link_name"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link_name]</span></a>
</div>

<h3 id="link_name属性"><a class="header" href="#link_name属性"><code>link_name</code>属性</a></h3>
<div class="rule" id="r-items.extern.attributes.link_name.intro"><a class="rule-link" href="#r-items.extern.attributes.link_name.intro" title="items.extern.attributes.link_name.intro"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link_name<wbr>.intro]</span></a>
</div>

<p><em><code>link_name</code> <a href="#属性-1">属性</a></em>  可以应用于外部块内的声明，以指定要为给定函数或静态项导入的符号。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>unsafe extern "C" {
    #[link_name = "actual_symbol_name"]
    safe fn name_in_rust();
}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-items.extern.attributes.link_name.syntax"><a class="rule-link" href="#r-items.extern.attributes.link_name.syntax" title="items.extern.attributes.link_name.syntax"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link_name<wbr>.syntax]</span></a>
</div>

<p><code>link_name</code> 属性使用 <a href="#grammar-MetaNameValueStr">MetaNameValueStr</a> 语法。</p>
<div class="rule" id="r-items.extern.attributes.link_name.allowed-positions"><a class="rule-link" href="#r-items.extern.attributes.link_name.allowed-positions" title="items.extern.attributes.link_name.allowed-positions"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link_name<wbr>.allowed-positions]</span></a>
</div>

<p><code>link_name</code> 属性只能应用于外部块中的函数或 静态项。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 忽略在其他位置的使用，但会针对其发出 lint。这在将来可能会变成错误。</p>
</blockquote>
</div>

<div class="rule" id="r-items.extern.attributes.link_name.duplicates"><a class="rule-link" href="#r-items.extern.attributes.link_name.duplicates" title="items.extern.attributes.link_name.duplicates"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link_name<wbr>.duplicates]</span></a>
</div>

<p>只有 项 上最后一次使用的 <code>link_name</code> 才会生效。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 会针对最后一次使用之前的任何使用发出 lint。这在将来可能会变成错误。</p>
</blockquote>
</div>

<div class="rule" id="r-items.extern.attributes.link_name.link_ordinal"><a class="rule-link" href="#r-items.extern.attributes.link_name.link_ordinal" title="items.extern.attributes.link_name.link_ordinal"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link_name<wbr>.link_ordinal]</span></a>
</div>

<p><code>link_name</code> 属性不得与 <a href="#r-items.extern.attributes.link_ordinal"><code>link_ordinal</code></a> 属性一起使用。</p>
<div class="rule" id="r-items.extern.attributes.link_ordinal"><a class="rule-link" href="#r-items.extern.attributes.link_ordinal" title="items.extern.attributes.link_ordinal"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link_ordinal]</span></a>
</div>

<h3 id="link_ordinal属性"><a class="header" href="#link_ordinal属性"><code>link_ordinal</code>属性</a></h3>
<div class="rule" id="r-items.extern.attributes.link_ordinal.intro"><a class="rule-link" href="#r-items.extern.attributes.link_ordinal.intro" title="items.extern.attributes.link_ordinal.intro"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link_ordinal<wbr>.intro]</span></a>
</div>

<p><em><code>link_ordinal</code> 属性</em>  可以应用于外部块内的声明，以指示生成要链接的导入库时要使用的数字序数。序数是 Windows 上动态库导出的每个符号的唯一编号，在加载库以查找该符号时可以使用序数，而不必按名称查找。</p>
<div class="alert alert-warning">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>警告</p>

<p><code>link_ordinal</code> 仅应在已知符号序数稳定的情况下使用：如果符号的序数在构建其包含的二进制文件时未显式设置，则系统会自动为其分配一个序数，并且分配的序数可能会在二进制文件的不同构建之间发生变化。</p>
</blockquote>
</div>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(all(windows, target_arch = "x86"))]
</span>#[link(name = "exporter", kind = "raw-dylib")]
unsafe extern "stdcall" {
    #[link_ordinal(15)]
    safe fn imported_function_stdcall(i: i32);
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.extern.attributes.link_ordinal.allowed-kinds"><a class="rule-link" href="#r-items.extern.attributes.link_ordinal.allowed-kinds" title="items.extern.attributes.link_ordinal.allowed-kinds"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link_ordinal<wbr>.allowed-kinds]</span></a>
</div>

<p>此属性仅与 <code>raw-dylib</code> 链接类型一起使用。使用任何其他类型都将导致编译器错误。</p>
<div class="rule" id="r-items.extern.attributes.link_ordinal.exclusive"><a class="rule-link" href="#r-items.extern.attributes.link_ordinal.exclusive" title="items.extern.attributes.link_ordinal.exclusive"><span>[items<wbr>.extern<wbr>.attributes<wbr>.link_ordinal<wbr>.exclusive]</span></a>
</div>

<p>将此属性与 <code>link_name</code> 属性一起使用将导致编译器错误。</p>
<div class="rule" id="r-items.extern.attributes.fn-parameters"><a class="rule-link" href="#r-items.extern.attributes.fn-parameters" title="items.extern.attributes.fn-parameters"><span>[items<wbr>.extern<wbr>.attributes<wbr>.fn-parameters]</span></a>
</div>

<h3 id="函数参数上的属性-1"><a class="header" href="#函数参数上的属性-1">函数参数上的属性</a></h3>
<p>外部函数参数上的属性遵循与 <a href="#attributes-on-function-parameters">常规函数参数</a> 相同的规则和限制。</p>
<hr>
<ol class="footnote-definition">
<li id="footnote-unsafe-2024">
<p>从 2024 版次 开始，<code>unsafe</code> 关键字在语义上是必需的。 <a href="#fr-unsafe-2024-1">↩</a></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-items.generics"><a class="rule-link" href="#r-items.generics" title="items.generics"><span>[items<wbr>.generics]</span></a>
</div>

<h1 id="泛型参数"><a class="header" href="#泛型参数">泛型参数</a></h1>
<div class="rule" id="r-items.generics.syntax"><a class="rule-link" href="#r-items.generics.syntax" title="items.generics.syntax"><span>[items<wbr>.generics<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-GenericParams" onclick="show_railroad()"><a href="#railroad-GenericParams">GenericParams</a></span> → <span class="grammar-literal">&lt;</span> ( <span class="grammar-text"><a href="#grammar-GenericParam">GenericParam</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-GenericParam">GenericParam</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup> )<sup>?</sup> <span class="grammar-literal">&gt;</span></p>
<p><span class="grammar-text grammar-production" id="grammar-GenericParam" onclick="show_railroad()"><a href="#railroad-GenericParam">GenericParam</a></span> → <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> ( <span class="grammar-text"><a href="#grammar-LifetimeParam">LifetimeParam</a></span> | <span class="grammar-text"><a href="#grammar-TypeParam">TypeParam</a></span> | <span class="grammar-text"><a href="#grammar-ConstParam">ConstParam</a></span> )</p>
<p><span class="grammar-text grammar-production" id="grammar-LifetimeParam" onclick="show_railroad()"><a href="#railroad-LifetimeParam">LifetimeParam</a></span> → <span class="grammar-text"><a href="#grammar-Lifetime">Lifetime</a></span> ( <span class="grammar-literal">:</span> <span class="grammar-text"><a href="#grammar-LifetimeBounds">LifetimeBounds</a></span> )<sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-TypeParam" onclick="show_railroad()"><a href="#railroad-TypeParam">TypeParam</a></span> → <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> ( <span class="grammar-literal">:</span> <span class="grammar-text"><a href="#grammar-TypeParamBounds">TypeParamBounds</a></span><sup>?</sup> )<sup>?</sup> ( <span class="grammar-literal">=</span> <span class="grammar-text"><a href="#grammar-Type">Type</a></span> )<sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-ConstParam" onclick="show_railroad()"><a href="#railroad-ConstParam">ConstParam</a></span> → <br>    <span class="grammar-literal">const</span> <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-literal">:</span> <span class="grammar-text"><a href="#grammar-Type">Type</a></span> <br>    ( <span class="grammar-literal">=</span> ( <span class="grammar-text"><a href="#grammar-BlockExpression">BlockExpression</a></span> | <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> | <span class="grammar-literal">-</span><sup>?</sup> <span class="grammar-text"><a href="#grammar-LiteralExpression">LiteralExpression</a></span> ) )<sup>?</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 632px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-GenericParams"><svg class="railroad" viewbox="0 0 632 112" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-GenericParams">
<text class="comment" x="60" y="25">
GenericParams</text>
</a>
<g class="sequence">
<path d=" M 10 78 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="67" />
<text x="49" y="83">
&lt;</text>
</g>
<g class="optional">
<path d=" M 73 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -12 a 12 12 0 0 1 12 -12 h 438 m -216 0 l -5 -5 m 0 10 l 5 -5 m 216 0 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-GenericParam">
<g class="nonterminal">
<rect height="22" width="116" x="97" y="67" />
<text x="155" y="83">
GenericParam</text>
</g>
</a>
<g class="optional">
<path d=" M 223 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 178 m -86 0 l -5 -5 m 0 10 l 5 -5 m 86 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 247 78 h 12 m 154 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -154 m 80 0 l 5 -5 m 0 10 l -5 -5 m -80 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="259" y="67" />
<text x="273" y="83">
,</text>
</g>
<a class="link" xlink:href="#railroad-GenericParam">
<g class="nonterminal">
<rect height="22" width="116" x="297" y="67" />
<text x="355" y="83">
GenericParam</text>
</g>
</a>
<path d=" M 287 78 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 459 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="483" y="67" />
<text x="497" y="83">
,</text>
</g>
</g>
<path d=" M 213 78 h 10" />
<path d=" M 449 78 h 10" />
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="569" y="67" />
<text x="583" y="83">
&gt;</text>
</g>
<path d=" M 63 78 h 10" />
<path d=" M 559 78 h 10" />
</g>
<path d=" M 607 78 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 78 h 10" />
<path d=" M 597 78 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 456px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-GenericParam"><svg class="railroad" viewbox="0 0 456 153" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-GenericParam">
<text class="comment" x="57" y="25">
GenericParam</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<g class="choice">
<path d=" M 249 66 h 24 m 124 0 h 24" />
<a class="link" xlink:href="#railroad-LifetimeParam">
<g class="nonterminal">
<rect height="22" width="124" x="273" y="55" />
<text x="335" y="71">
LifetimeParam</text>
</g>
</a>
<path d=" M 249 66 a 12 12 0 0 1 12 12 v 9 m 148 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 261 87 v 33 m 148 0 v -33" />
<path d=" M 261 87 v 0 a 12 12 0 0 0 12 12 m 92 0 h 32 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-TypeParam">
<g class="nonterminal">
<rect height="22" width="92" x="273" y="88" />
<text x="319" y="104">
TypeParam</text>
</g>
</a>
<path d=" M 261 120 v 0 a 12 12 0 0 0 12 12 m 100 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-ConstParam">
<g class="nonterminal">
<rect height="22" width="100" x="273" y="121" />
<text x="323" y="137">
ConstParam</text>
</g>
</a>
</g>
<path d=" M 239 66 h 10" />
</g>
<path d=" M 431 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 421 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 382px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-LifetimeParam"><svg class="railroad" viewbox="0 0 382 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-LifetimeParam">
<text class="comment" x="60" y="25">
LifetimeParam</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Lifetime">
<g class="nonterminal">
<rect height="22" width="84" x="35" y="55" />
<text x="77" y="71">
Lifetime</text>
</g>
</a>
<g class="optional">
<path d=" M 129 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 170 m -82 0 l -5 -5 m 0 10 l 5 -5 m 82 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="153" y="55" />
<text x="167" y="71">
:</text>
</g>
<a class="link" xlink:href="#railroad-LifetimeBounds">
<g class="nonterminal">
<rect height="22" width="132" x="191" y="55" />
<text x="257" y="71">
LifetimeBounds</text>
</g>
</a>
<path d=" M 181 66 h 10" />
</g>
</g>
<path d=" M 119 66 h 10" />
</g>
<path d=" M 357 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 347 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 602px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TypeParam"><svg class="railroad" viewbox="0 0 602 99" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TypeParam">
<text class="comment" x="46" y="25">
TypeParam</text>
</a>
<g class="sequence">
<path d=" M 10 78 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="67" />
<text x="85" y="83">
IDENTIFIER</text>
</g>
</a>
<g class="optional">
<path d=" M 145 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -12 a 12 12 0 0 1 12 -12 h 226 m -110 0 l -5 -5 m 0 10 l 5 -5 m 110 0 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="67" />
<text x="183" y="83">
:</text>
</g>
<g class="optional">
<path d=" M 207 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 140 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-TypeParamBounds">
<g class="nonterminal">
<rect height="22" width="140" x="231" y="67" />
<text x="301" y="83">
TypeParamBounds</text>
</g>
</a>
</g>
<path d=" M 197 78 h 10" />
</g>
</g>
<g class="optional">
<path d=" M 429 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 90 m -42 0 l -5 -5 m 0 10 l 5 -5 m 42 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="453" y="67" />
<text x="467" y="83">
=</text>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="491" y="67" />
<text x="517" y="83">
Type</text>
</g>
</a>
<path d=" M 481 78 h 10" />
</g>
</g>
<path d=" M 135 78 h 10" />
<path d=" M 419 78 h 10" />
</g>
<path d=" M 577 78 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 78 h 10" />
<path d=" M 567 78 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 726px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ConstParam"><svg class="railroad" viewbox="0 0 726 165" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ConstParam">
<text class="comment" x="50" y="25">
ConstParam</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="35" y="55" />
<text x="65" y="71">
const</text>
</g>
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="105" y="55" />
<text x="155" y="71">
IDENTIFIER</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="215" y="55" />
<text x="229" y="71">
:</text>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="253" y="55" />
<text x="279" y="71">
Type</text>
</g>
</a>
<g class="optional">
<path d=" M 315 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 328 m -161 0 l -5 -5 m 0 10 l 5 -5 m 161 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="339" y="55" />
<text x="353" y="71">
=</text>
</g>
<g class="choice">
<path d=" M 377 66 h 24 m 140 0 h 126 m -60 0 l -5 -5 m 0 10 l 5 -5 m 60 0" />
<a class="link" xlink:href="#railroad-BlockExpression">
<g class="nonterminal">
<rect height="22" width="140" x="401" y="55" />
<text x="471" y="71">
BlockExpression</text>
</g>
</a>
<path d=" M 377 66 a 12 12 0 0 1 12 12 v 9 m 266 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 389 87 v 33 m 266 0 v -33" />
<path d=" M 389 87 v 0 a 12 12 0 0 0 12 12 m 100 0 h 142 m -68 0 l -5 -5 m 0 10 l 5 -5 m 68 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="401" y="88" />
<text x="451" y="104">
IDENTIFIER</text>
</g>
</a>
<path d=" M 389 120 v 12 a 12 12 0 0 0 12 12 m 242 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="optional">
<path d=" M 401 144 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="425" y="133" />
<text x="439" y="149">
-</text>
</g>
</g>
<a class="link" xlink:href="#railroad-LiteralExpression">
<g class="nonterminal">
<rect height="22" width="156" x="487" y="133" />
<text x="565" y="149">
LiteralExpression</text>
</g>
</a>
<path d=" M 477 144 h 10" />
</g>
</g>
<path d=" M 367 66 h 10" />
</g>
</g>
<path d=" M 95 66 h 10" />
<path d=" M 205 66 h 10" />
<path d=" M 243 66 h 10" />
<path d=" M 305 66 h 10" />
</g>
<path d=" M 701 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 691 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-items.generics.syntax.intro"><a class="rule-link" href="#r-items.generics.syntax.intro" title="items.generics.syntax.intro"><span>[items<wbr>.generics<wbr>.syntax<wbr>.intro]</span></a>
</div>

<p><a href="#函数">函数</a>、<a href="#类型别名">类型别名</a>、<a href="#结构体">结构体</a>、<a href="#枚举">枚举</a>、<a href="#联合体">联合体</a>、<a href="#特型">特型</a> 和 <a href="#实现">实现</a> 可以通过类型、常量和生命周期进行  <em>参数化 (parameterized)</em> 。这些参数列在尖括号 <span class="parenthetical">（<code>&lt;...&gt;</code>）</span>中，通常紧跟在 项 的名称之后、其定义之前。对于没有名称的 实现，它们直接跟在 <code>impl</code> 后面。</p>
<div class="rule" id="r-items.generics.syntax.decl-order"><a class="rule-link" href="#r-items.generics.syntax.decl-order" title="items.generics.syntax.decl-order"><span>[items<wbr>.generics<wbr>.syntax<wbr>.decl-order]</span></a>
</div>

<p>泛型参数 的顺序受限，必须先是 生命周期参数，然后是混合在一起的 类型参数 和 常量参数。</p>
<div class="rule" id="r-items.generics.syntax.duplicate-params"><a class="rule-link" href="#r-items.generics.syntax.duplicate-params" title="items.generics.syntax.duplicate-params"><span>[items<wbr>.generics<wbr>.syntax<wbr>.duplicate-params]</span></a>
</div>

<p>在 <a href="#grammar-GenericParams">GenericParams</a> 列表中，同一个参数名不得声明多次。</p>
<p>带类型、常量和生命周期参数的 项 示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo&lt;'a, T&gt;() {}
trait A&lt;U&gt; {}
struct Ref&lt;'a, T&gt; where T: 'a { r: &amp;'a T }
struct InnerArray&lt;T, const N: usize&gt;([T; N]);
struct EitherOrderWorks&lt;const N: bool, U&gt;(U);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.generics.syntax.scope"><a class="rule-link" href="#r-items.generics.syntax.scope" title="items.generics.syntax.scope"><span>[items<wbr>.generics<wbr>.syntax<wbr>.scope]</span></a>
</div>

<p>泛型参数 在其声明所在的 项 定义的作用域内。它们不在函数体内部声明的 项 的作用域内，如 <a href="#item-declarations">项声明</a> 中所述。有关更多详细信息，请参阅 <a href="#generic-parameter-scopes">泛型参数作用域</a>。</p>
<div class="rule" id="r-items.generics.builtin-generic-types"><a class="rule-link" href="#r-items.generics.builtin-generic-types" title="items.generics.builtin-generic-types"><span>[items<wbr>.generics<wbr>.builtin-generic-types]</span></a>
</div>

<p><a href="#shared-references-">引用</a>、<a href="#raw-pointers-const-and-mut">原始指针</a>、<a href="#数组类型">数组</a>、<a href="#切片类型">切片</a>、<a href="#元组类型">元组</a> 和 <a href="#函数指针类型">函数指针</a> 也有生命周期或类型参数，但不是通过路径语法引用的。</p>
<div class="rule" id="r-items.generics.invalid-lifetimes"><a class="rule-link" href="#r-items.generics.invalid-lifetimes" title="items.generics.invalid-lifetimes"><span>[items<wbr>.generics<wbr>.invalid-lifetimes]</span></a>
</div>

<p><code>'_</code> 和 <code>'static</code> 不是有效的 生命周期参数 名称。</p>
<div class="rule" id="r-items.generics.const"><a class="rule-link" href="#r-items.generics.const" title="items.generics.const"><span>[items<wbr>.generics<wbr>.const]</span></a>
</div>

<h3 id="常量泛型"><a class="header" href="#常量泛型">常量泛型</a></h3>
<div class="rule" id="r-items.generics.const.intro"><a class="rule-link" href="#r-items.generics.const.intro" title="items.generics.const.intro"><span>[items<wbr>.generics<wbr>.const<wbr>.intro]</span></a>
</div>

<p><em>常量泛型参数 (Const generic parameters)</em>  允许 项 对常量值进行泛型化。</p>
<div class="rule" id="r-items.generics.const.namespace"><a class="rule-link" href="#r-items.generics.const.namespace" title="items.generics.const.namespace"><span>[items<wbr>.generics<wbr>.const<wbr>.namespace]</span></a>
</div>

<p>常量标识符在 <a href="#命名空间">值命名空间</a> 中为 常量参数 引入一个名称，并且该 项 的所有实例必须使用给定类型的值进行实例化。</p>
<div class="rule" id="r-items.generics.const.allowed-types"><a class="rule-link" href="#r-items.generics.const.allowed-types" title="items.generics.const.allowed-types"><span>[items<wbr>.generics<wbr>.const<wbr>.allowed-types]</span></a>
</div>

<p>常量参数 唯一允许的类型是 <code>u8</code>、<code>u16</code>、<code>u32</code>、<code>u64</code>、<code>u128</code>、<code>usize</code>、<code>i8</code>、<code>i16</code>、<code>i32</code>、<code>i64</code>、<code>i128</code>、<code>isize</code>、<code>char</code> 和 <code>bool</code>。</p>
<div class="rule" id="r-items.generics.const.usage"><a class="rule-link" href="#r-items.generics.const.usage" title="items.generics.const.usage"><span>[items<wbr>.generics<wbr>.const<wbr>.usage]</span></a>
</div>

<p>常量参数 可以用在任何可以使用 <a href="#常量项">常量项</a> 的地方，但在 <a href="#类型">类型</a> 或 <a href="#数组和数组索引表达式">数组重复表达式</a> 中使用时，它必须是  <em>独立的 (standalone)</em> （如下所述）。也就是说，它们允许出现在以下位置：</p>
<ol>
<li>作为应用于构成相关 项 签名一部分的任何类型的常量。</li>
<li>作为用于定义 <a href="#associated-constants">关联常量</a> 的常量表达式的一部分，或作为 <a href="#associated-types">关联类型</a> 的参数。</li>
<li>作为该 项 中任何函数体内的任何运行时表达式的值。</li>
<li>作为该 项 中任何函数体内使用的任何类型的参数。</li>
<li>作为该 项 中任何字段类型的一部分。</li>
</ol>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 常量泛型参数可以使用的示例。

// 在项本身的签名中使用。
fn foo&lt;const N: usize&gt;(arr: [i32; N]) {
    // 在函数体中作为类型使用。
    let x: [i32; N];
    // 作为表达式使用。
    println!("{}", N * 2);
}

// 作为结构体的字段使用。
struct Foo&lt;const N: usize&gt;([i32; N]);

impl&lt;const N: usize&gt; Foo&lt;N&gt; {
    // 作为关联常量使用。
    const CONST: usize = N * 4;
}

trait Trait {
    type Output;
}

impl&lt;const N: usize&gt; Trait for Foo&lt;N&gt; {
    // 作为关联类型使用。
    type Output = [i32; N];
}
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 常量泛型参数不能使用的示例。
fn foo&lt;const N: usize&gt;() {
    // 不能在函数体内的项定义中使用。
    const BAD_CONST: [usize; N] = [1; N];
    static BAD_STATIC: [usize; N] = [1; N];
    fn inner(bad_arg: [usize; N]) {
        let bad_value = N * 2;
    }
    type BadAlias = [usize; N];
    struct BadStruct([usize; N]);
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.generics.const.standalone"><a class="rule-link" href="#r-items.generics.const.standalone" title="items.generics.const.standalone"><span>[items<wbr>.generics<wbr>.const<wbr>.standalone]</span></a>
</div>

<p>作为进一步的限制， 常量参数 只能作为 <a href="#类型">类型</a> 或 <a href="#数组和数组索引表达式">数组重复表达式</a> 内部的独立参数出现。在这些上下文中，它们只能用作单段 <a href="#路径表达式">路径表达式</a>，可能位于 <a href="#块表达式">块</a> 内部（例如 <code>N</code> 或 <code>{N}</code>）。也就是说，它们不能与其他表达式结合使用。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 不允许使用常量参数的示例。

// 不允许在类型的其他表达式中进行组合，例如
// 这里返回类型中的算术表达式。
fn bad_function&lt;const N: usize&gt;() -&gt; [u8; {N + 1}] {
    // 数组重复表达式同样不允许。
    [1; {N + 1}]
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.generics.const.argument"><a class="rule-link" href="#r-items.generics.const.argument" title="items.generics.const.argument"><span>[items<wbr>.generics<wbr>.const<wbr>.argument]</span></a>
</div>

<p><a href="#路径">路径</a> 中的常量参数指定了用于该 项 的常量值。</p>
<div class="rule" id="r-items.generics.const.argument.const-expr"><a class="rule-link" href="#r-items.generics.const.argument.const-expr" title="items.generics.const.argument.const-expr"><span>[items<wbr>.generics<wbr>.const<wbr>.argument<wbr>.const-expr]</span></a>
</div>

<p>该参数必须是 <a href="#r-items.generics.const.inferred">推断常量</a> 或者是归属于 常量参数 类型的 <a href="#常量表达式">常量表达式</a>。常量表达式必须是 <a href="#块表达式">块表达式</a>（用大括号包围），除非它是单个路径段（一个 <a href="#grammar-IDENTIFIER">IDENTIFIER</a>）或 <a href="#字面量表达式">字面量</a>（可能带有前导的 <code>-</code> 词法单元）。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>这种语法限制是必要的，以避免在解析类型内部的表达式时需要无限前瞻。</p>
</blockquote>
</div>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S&lt;const N: i64&gt;;
const C: i64 = 1;
fn f&lt;const N: i64&gt;() -&gt; S&lt;N&gt; { S }

let _ = f::&lt;1&gt;(); // 字面量。
let _ = f::&lt;-1&gt;(); // 负数字面量。
let _ = f::&lt;{ 1 + 2 }&gt;(); // 常量表达式。
let _ = f::&lt;C&gt;(); // 单段路径。
let _ = f::&lt;{ C + 1 }&gt;(); // 常量表达式。
let _: S&lt;1&gt; = f::&lt;_&gt;(); // 推断常量。
let _: S&lt;1&gt; = f::&lt;(((_)))&gt;(); // 推断常量。
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>在泛型参数列表中，<a href="#r-items.generics.const.inferred">推断常量</a> 被解析为 <a href="#grammar-InferredType">推断类型</a>，但在语义上被视为一种单独的 <a href="#r-items.generics.const.argument">常量泛型参数</a>。</p>
</blockquote>
</div>

<div class="rule" id="r-items.generics.const.inferred"><a class="rule-link" href="#r-items.generics.const.inferred" title="items.generics.const.inferred"><span>[items<wbr>.generics<wbr>.const<wbr>.inferred]</span></a>
</div>

<p>在需要常量参数的地方，可以使用 <code>_</code>（可选地由任意数量的匹配括号包围），称为  <em>推断常量 (inferred const)</em> （<a href="#r-paths.expr.complex-const-params">路径规则</a>，<a href="#r-expr.array.length-restriction">数组表达式规则</a>）。这要求编译器在可能的情况下根据周围信息推断常量参数。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn make_buf&lt;const N: usize&gt;() -&gt; [u8; N] {
    [0; _]
    //  ^ 推断出 `N`。
}
let _: [u8; 1024] = make_buf::&lt;_&gt;();
//                             ^ 推断出 `1024`。
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><a href="#r-items.generics.const.inferred">推断常量</a> 在语义上不是一个 <a href="#grammar-Expression">表达式</a>，因此不被大括号接受。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn f&lt;const N: usize&gt;() -&gt; [u8; N] { [0; _] }
let _: [_; 1] = f::&lt;{ _ }&gt;();
//                    ^ 错误：这里不允许使用 `_`
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-items.generics.const.inferred.constraint"><a class="rule-link" href="#r-items.generics.const.inferred.constraint" title="items.generics.const.inferred.constraint"><span>[items<wbr>.generics<wbr>.const<wbr>.inferred<wbr>.constraint]</span></a>
</div>

<p>推断常量 不能在 项 签名中使用。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn f&lt;const N: usize&gt;(x: [u8; N]) -&gt; [u8; _] { x }
//                                       ^ 错误：不允许
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.generics.const.type-ambiguity"><a class="rule-link" href="#r-items.generics.const.type-ambiguity" title="items.generics.const.type-ambiguity"><span>[items<wbr>.generics<wbr>.const<wbr>.type-ambiguity]</span></a>
</div>

<p>当泛型参数是否可以被解析为类型参数或常量参数存在歧义时，它总是被解析为类型。将参数放置在块表达式中可以强制将其解释为常量参数。</p>
<!-- TODO: Rewrite the paragraph above to be in terms of namespaces, once
    namespaces are introduced, and it is clear which namespace each parameter
    lives in. -->
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>type N = u32;
struct Foo&lt;const N: usize&gt;;
// 以下是一个错误，因为 `N` 被解释为类型别名 `N`。
fn foo&lt;const N: usize&gt;() -&gt; Foo&lt;N&gt; { todo!() } // 错误
// 可以通过包裹在大括号中来修复，以强制将其解释为 `N` 
// 常量参数：
fn bar&lt;const N: usize&gt;() -&gt; Foo&lt;{ N }&gt; { todo!() } // ok
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.generics.const.variance"><a class="rule-link" href="#r-items.generics.const.variance" title="items.generics.const.variance"><span>[items<wbr>.generics<wbr>.const<wbr>.variance]</span></a>
</div>

<p>与类型和生命周期参数不同， 常量参数 可以在不在 参数化项 内部使用的情况下声明，但 <a href="#generic-implementations">泛型实现</a> 中描述的 实现 除外：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// ok
struct Foo&lt;const N: usize&gt;;
enum Bar&lt;const M: usize&gt; { A, B }

// 错误：未使用的参数
struct Baz&lt;T&gt;;
struct Biz&lt;'a&gt;;
struct Unconstrained;
impl&lt;const N: usize&gt; Unconstrained {}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.generics.const.exhaustiveness"><a class="rule-link" href="#r-items.generics.const.exhaustiveness" title="items.generics.const.exhaustiveness"><span>[items<wbr>.generics<wbr>.const<wbr>.exhaustiveness]</span></a>
</div>

<p>在解析 特型绑定 义务时，确定绑定是否满足时不考虑 常量参数 所有实现的  <em>完备性 (exhaustiveness)</em> 。例如，在下文中，即使实现了 <code>bool</code> 类型所有可能的常量值，但 特型绑定 未满足仍然是一个错误：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Foo&lt;const B: bool&gt;;
trait Bar {}
impl Bar for Foo&lt;true&gt; {}
impl Bar for Foo&lt;false&gt; {}

fn needs_bar(_: impl Bar) {}
fn generic&lt;const B: bool&gt;() {
    let v = Foo::&lt;B&gt;;
    needs_bar(v); // 错误：特型绑定 `Foo&lt;B&gt;: Bar` 未满足
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.generics.where"><a class="rule-link" href="#r-items.generics.where" title="items.generics.where"><span>[items<wbr>.generics<wbr>.where]</span></a>
</div>

<h2 id="where子句"><a class="header" href="#where子句">Where子句</a></h2>
<div class="rule" id="r-items.generics.where.syntax"><a class="rule-link" href="#r-items.generics.where.syntax" title="items.generics.where.syntax"><span>[items<wbr>.generics<wbr>.where<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-WhereClause" onclick="show_railroad()"><a href="#railroad-WhereClause">WhereClause</a></span> → <span class="grammar-literal">where</span> ( <span class="grammar-text"><a href="#grammar-WhereClauseItem">WhereClauseItem</a></span> <span class="grammar-literal">,</span> )<sup>*</sup> <span class="grammar-text"><a href="#grammar-WhereClauseItem">WhereClauseItem</a></span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-WhereClauseItem" onclick="show_railroad()"><a href="#railroad-WhereClauseItem">WhereClauseItem</a></span> → <br>      <span class="grammar-text"><a href="#grammar-LifetimeWhereClauseItem">LifetimeWhereClauseItem</a></span> <br>    | <span class="grammar-text"><a href="#grammar-TypeBoundWhereClauseItem">TypeBoundWhereClauseItem</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-LifetimeWhereClauseItem" onclick="show_railroad()"><a href="#railroad-LifetimeWhereClauseItem">LifetimeWhereClauseItem</a></span> → <span class="grammar-text"><a href="#grammar-Lifetime">Lifetime</a></span> <span class="grammar-literal">:</span> <span class="grammar-text"><a href="#grammar-LifetimeBounds">LifetimeBounds</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-TypeBoundWhereClauseItem" onclick="show_railroad()"><a href="#railroad-TypeBoundWhereClauseItem">TypeBoundWhereClauseItem</a></span> → <span class="grammar-text"><a href="#grammar-ForLifetimes">ForLifetimes</a></span><sup>?</sup> <span class="grammar-text"><a href="#grammar-Type">Type</a></span> <span class="grammar-literal">:</span> <span class="grammar-text"><a href="#grammar-TypeParamBounds">TypeParamBounds</a></span><sup>?</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 588px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-WhereClause"><svg class="railroad" viewbox="0 0 588 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-WhereClause">
<text class="comment" x="53" y="25">
WhereClause</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="35" y="55" />
<text x="65" y="71">
where</text>
</g>
<g class="optional">
<path d=" M 105 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 202 m -98 0 l -5 -5 m 0 10 l 5 -5 m 98 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 129 66 h 12 m 178 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -178 m 92 0 l 5 -5 m 0 10 l -5 -5 m -92 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<a class="link" xlink:href="#railroad-WhereClauseItem">
<g class="nonterminal">
<rect height="22" width="140" x="141" y="55" />
<text x="211" y="71">
WhereClauseItem</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="291" y="55" />
<text x="305" y="71">
,</text>
</g>
<path d=" M 281 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 365 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 140 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-WhereClauseItem">
<g class="nonterminal">
<rect height="22" width="140" x="389" y="55" />
<text x="459" y="71">
WhereClauseItem</text>
</g>
</a>
</g>
<path d=" M 95 66 h 10" />
<path d=" M 355 66 h 10" />
</g>
<path d=" M 563 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 553 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 338px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-WhereClauseItem"><svg class="railroad" viewbox="0 0 338 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-WhereClauseItem">
<text class="comment" x="67" y="25">
WhereClauseItem</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 212 0 h 32" />
<g class="sequence">
<a class="link" xlink:href="#railroad-LifetimeWhereClauseItem">
<g class="nonterminal">
<rect height="22" width="212" x="59" y="42" />
<text x="165" y="58">
LifetimeWhereClauseItem</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 244 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 220 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-TypeBoundWhereClauseItem">
<g class="nonterminal">
<rect height="22" width="220" x="59" y="75" />
<text x="169" y="91">
TypeBoundWhereClauseItem</text>
</g>
</a>
</g>
<path d=" M 313 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 303 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 334px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-LifetimeWhereClauseItem"><svg class="railroad" viewbox="0 0 334 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-LifetimeWhereClauseItem">
<text class="comment" x="99" y="25">
LifetimeWhereClauseItem</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Lifetime">
<g class="nonterminal">
<rect height="22" width="84" x="35" y="42" />
<text x="77" y="58">
Lifetime</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="129" y="42" />
<text x="143" y="58">
:</text>
</g>
<a class="link" xlink:href="#railroad-LifetimeBounds">
<g class="nonterminal">
<rect height="22" width="132" x="167" y="42" />
<text x="233" y="58">
LifetimeBounds</text>
</g>
</a>
<path d=" M 119 53 h 10" />
<path d=" M 157 53 h 10" />
</g>
<path d=" M 309 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 299 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 532px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TypeBoundWhereClauseItem"><svg class="railroad" viewbox="0 0 532 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TypeBoundWhereClauseItem">
<text class="comment" x="102" y="25">
TypeBoundWhereClauseItem</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 116 m -55 0 l -5 -5 m 0 10 l 5 -5 m 55 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-ForLifetimes">
<g class="nonterminal">
<rect height="22" width="116" x="59" y="55" />
<text x="117" y="71">
ForLifetimes</text>
</g>
</a>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="209" y="55" />
<text x="235" y="71">
Type</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="271" y="55" />
<text x="285" y="71">
:</text>
</g>
<g class="optional">
<path d=" M 309 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 140 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-TypeParamBounds">
<g class="nonterminal">
<rect height="22" width="140" x="333" y="55" />
<text x="403" y="71">
TypeParamBounds</text>
</g>
</a>
</g>
<path d=" M 199 66 h 10" />
<path d=" M 261 66 h 10" />
<path d=" M 299 66 h 10" />
</g>
<path d=" M 507 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 497 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-items.generics.where.intro"><a class="rule-link" href="#r-items.generics.where.intro" title="items.generics.where.intro"><span>[items<wbr>.generics<wbr>.where<wbr>.intro]</span></a>
</div>

<p><em>Where 子句</em>  提供了另一种指定类型和生命周期参数绑定的方法，以及一种为非类型参数的类型指定绑定的方法。</p>
<div class="rule" id="r-items.generics.where.higher-ranked-lifetimes"><a class="rule-link" href="#r-items.generics.where.higher-ranked-lifetimes" title="items.generics.where.higher-ranked-lifetimes"><span>[items<wbr>.generics<wbr>.where<wbr>.higher-ranked-lifetimes]</span></a>
</div>

<p><code>for</code> 关键字可用于引入 <a href="#higher-ranked-trait-bounds">高阶生命周期</a>。它只允许 <a href="#grammar-LifetimeParam">LifetimeParam</a> 参数。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct A&lt;T&gt;
where
    T: Iterator,            // 也可以使用 A&lt;T: Iterator&gt;
    T::Item: Copy,          // 关联类型上的绑定
    String: PartialEq&lt;T&gt;,   // 在 `String` 上的绑定，使用类型参数
    i32: Default,           // 允许，但没什么用
{
    f: T,
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.generics.attributes"><a class="rule-link" href="#r-items.generics.attributes" title="items.generics.attributes"><span>[items<wbr>.generics<wbr>.attributes]</span></a>
</div>

<h2 id="属性"><a class="header" href="#属性">属性</a></h2>
<p>泛型生命周期和类型参数允许在其上使用 <a href="#属性-1">属性</a>。虽然自定义派生属性可能会赋予其含义，但目前没有内置属性在此位置执行任何操作。</p>
<p>此示例显示使用自定义派生属性来修改 泛型参数 的含义。</p>
<!-- ignore: requires proc macro derive -->
<pre><code class="language-rust ignore">// 假设 MyFlexibleClone 的派生宏将 `my_flexible_clone` 声明为
// 其理解的属性。
#[derive(MyFlexibleClone)]
struct Foo&lt;#[my_flexible_clone(unbounded)] H&gt; {
    a: *const H
}</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-items.associated"><a class="rule-link" href="#r-items.associated" title="items.associated"><span>[items<wbr>.associated]</span></a>
</div>

<h1 id="关联项"><a class="header" href="#关联项">关联项</a></h1>
<div class="rule" id="r-items.associated.syntax"><a class="rule-link" href="#r-items.associated.syntax" title="items.associated.syntax"><span>[items<wbr>.associated<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-AssociatedItem" onclick="show_railroad()"><a href="#railroad-AssociatedItem">AssociatedItem</a></span> → <br>    <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> ( <br>        <span class="grammar-text"><a href="#grammar-MacroInvocationSemi">MacroInvocationSemi</a></span> <br>      | ( <span class="grammar-text"><a href="#grammar-Visibility">Visibility</a></span><sup>?</sup> ( <span class="grammar-text"><a href="#grammar-TypeAlias">TypeAlias</a></span> | <span class="grammar-text"><a href="#grammar-ConstantItem">ConstantItem</a></span> | <span class="grammar-text"><a href="#grammar-Function">Function</a></span> ) ) <br>    )</p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 654px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-AssociatedItem"><svg class="railroad" viewbox="0 0 654 198" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-AssociatedItem">
<text class="comment" x="64" y="25">
AssociatedItem</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<g class="choice">
<path d=" M 249 66 h 24 m 172 0 h 174 m -84 0 l -5 -5 m 0 10 l 5 -5 m 84 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-MacroInvocationSemi">
<g class="nonterminal">
<rect height="22" width="172" x="273" y="55" />
<text x="359" y="71">
MacroInvocationSemi</text>
</g>
</a>
</g>
<path d=" M 249 66 a 12 12 0 0 1 12 12 v 9 m 346 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 261 87 v 12 a 12 12 0 0 0 12 12 m 322 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="sequence">
<g class="optional">
<path d=" M 273 111 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-Visibility">
<g class="nonterminal">
<rect height="22" width="100" x="297" y="100" />
<text x="347" y="116">
Visibility</text>
</g>
</a>
</g>
<g class="choice">
<path d=" M 431 111 h 24 m 92 0 h 48" />
<a class="link" xlink:href="#railroad-TypeAlias">
<g class="nonterminal">
<rect height="22" width="92" x="455" y="100" />
<text x="501" y="116">
TypeAlias</text>
</g>
</a>
<path d=" M 431 111 a 12 12 0 0 1 12 12 v 9 m 140 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 443 132 v 33 m 140 0 v -33" />
<path d=" M 443 132 v 0 a 12 12 0 0 0 12 12 m 116 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-ConstantItem">
<g class="nonterminal">
<rect height="22" width="116" x="455" y="133" />
<text x="513" y="149">
ConstantItem</text>
</g>
</a>
<path d=" M 443 165 v 0 a 12 12 0 0 0 12 12 m 84 0 h 32 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-Function">
<g class="nonterminal">
<rect height="22" width="84" x="455" y="166" />
<text x="497" y="182">
Function</text>
</g>
</a>
</g>
<path d=" M 421 111 h 10" />
</g>
</g>
</g>
<path d=" M 239 66 h 10" />
</g>
<path d=" M 629 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 619 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-items.associated.intro"><a class="rule-link" href="#r-items.associated.intro" title="items.associated.intro"><span>[items<wbr>.associated<wbr>.intro]</span></a>
</div>

<p><em>关联项 (Associated Items)</em>  是在 <a href="#特型">特型</a> 中声明或在 <a href="#实现">实现</a> 中定义的 项。它们之所以被称为关联项，是因为它们定义在一个关联类型上 —— 即实现中的类型。</p>
<div class="rule" id="r-items.associated.kinds"><a class="rule-link" href="#r-items.associated.kinds" title="items.associated.kinds"><span>[items<wbr>.associated<wbr>.kinds]</span></a>
</div>

<p>它们是可以在模块中声明的 项 的一个子集。具体来说，包括 <a href="#关联函数和方法">关联函数</a>（包括方法）、<a href="#关联类型">关联类型</a> 和 <a href="#关联常量">关联常量</a>。</p>
<div class="rule" id="r-items.associated.related"><a class="rule-link" href="#r-items.associated.related" title="items.associated.related"><span>[items<wbr>.associated<wbr>.related]</span></a>
</div>

<p>当关联项在逻辑上与被关联的 项 相关时，使用关联项非常有用。例如，<code>Option</code> 上的 <code>is_some</code> 方法本质上与 Options 相关，因此应该被关联。</p>
<div class="rule" id="r-items.associated.decl-def"><a class="rule-link" href="#r-items.associated.decl-def" title="items.associated.decl-def"><span>[items<wbr>.associated<wbr>.decl-def]</span></a>
</div>

<p>每种关联项都有两种形式：包含实际实现的定义，以及为定义声明签名的声明。</p>
<div class="rule" id="r-items.associated.trait-items"><a class="rule-link" href="#r-items.associated.trait-items" title="items.associated.trait-items"><span>[items<wbr>.associated<wbr>.trait-items]</span></a>
</div>

<p>正是这些声明构成了 特型 的契约，以及 泛型 类型上可用的功能。</p>
<div class="rule" id="r-items.associated.fn"><a class="rule-link" href="#r-items.associated.fn" title="items.associated.fn"><span>[items<wbr>.associated<wbr>.fn]</span></a>
</div>

<h2 id="关联函数和方法"><a class="header" href="#关联函数和方法">关联函数和方法</a></h2>
<div class="rule" id="r-items.associated.fn.intro"><a class="rule-link" href="#r-items.associated.fn.intro" title="items.associated.fn.intro"><span>[items<wbr>.associated<wbr>.fn<wbr>.intro]</span></a>
</div>

<p><em>关联函数 (Associated functions)</em>  是与类型关联的 <a href="#函数">函数</a>。</p>
<div class="rule" id="r-items.associated.fn.decl"><a class="rule-link" href="#r-items.associated.fn.decl" title="items.associated.fn.decl"><span>[items<wbr>.associated<wbr>.fn<wbr>.decl]</span></a>
</div>

<p><em>关联函数声明</em>  为关联函数定义声明一个签名。它的写法与函数 项 类似，只是函数体被替换为 <code>;</code>。</p>
<div class="rule" id="r-items.associated.name"><a class="rule-link" href="#r-items.associated.name" title="items.associated.name"><span>[items<wbr>.associated<wbr>.name]</span></a>
</div>

<p>标识符是函数的名称。</p>
<div class="rule" id="r-items.associated.same-signature"><a class="rule-link" href="#r-items.associated.same-signature" title="items.associated.same-signature"><span>[items<wbr>.associated<wbr>.same-signature]</span></a>
</div>

<p>关联函数的 泛型、参数列表、返回类型和 where 子句必须与关联函数声明的相同。</p>
<div class="rule" id="r-items.associated.fn.def"><a class="rule-link" href="#r-items.associated.fn.def" title="items.associated.fn.def"><span>[items<wbr>.associated<wbr>.fn<wbr>.def]</span></a>
</div>

<p><em>关联函数定义</em>  定义了一个与另一个类型关联的函数。它的写法与 <a href="#函数项类型">函数项</a> 相同。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>一个常见的例子是名为 <code>new</code> 的关联函数，它返回一个与之关联的类型的值。</p>
</blockquote>
</div>

<pre class="playground"><code class="language-rust edition2024">struct Struct {
    field: i32
}

impl Struct {
    fn new() -&gt; Struct {
        Struct {
            field: 0i32
        }
    }
}

fn main () {
    let _struct = Struct::new();
}</code></pre>
<div class="rule" id="r-items.associated.fn.qualified-self"><a class="rule-link" href="#r-items.associated.fn.qualified-self" title="items.associated.fn.qualified-self"><span>[items<wbr>.associated<wbr>.fn<wbr>.qualified-self]</span></a>
</div>

<p>当关联函数在 特型 上声明时，也可以使用指向该 特型 并在其后追加 特型 名称的 <a href="#路径">路径</a> 来调用该函数。当发生这种情况时，它会被替换为 <code>&lt;_ as Trait&gt;::function_name</code>。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Num {
    fn from_i32(n: i32) -&gt; Self;
}

impl Num for f64 {
    fn from_i32(n: i32) -&gt; f64 { n as f64 }
}

// 在这种情况下，这 4 种写法都是等价的。
let _: f64 = Num::from_i32(42);
let _: f64 = &lt;_ as Num&gt;::from_i32(42);
let _: f64 = &lt;f64 as Num&gt;::from_i32(42);
let _: f64 = f64::from_i32(42);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.associated.fn.method"><a class="rule-link" href="#r-items.associated.fn.method" title="items.associated.fn.method"><span>[items<wbr>.associated<wbr>.fn<wbr>.method]</span></a>
</div>

<h3 id="方法"><a class="header" href="#方法">方法</a></h3>
<div class="rule" id="r-items.associated.fn.method.intro"><a class="rule-link" href="#r-items.associated.fn.method.intro" title="items.associated.fn.method.intro"><span>[items<wbr>.associated<wbr>.fn<wbr>.method<wbr>.intro]</span></a>
</div>

<p>第一个参数名为 <code>self</code> 的关联函数被称为  <em>方法 (methods)</em> ，可以使用 <a href="#方法调用表达式">方法调用运算符</a> 调用，例如 <code>x.foo()</code>，也可以使用通常的函数调用 记法。</p>
<div class="rule" id="r-items.associated.fn.method.self-ty"><a class="rule-link" href="#r-items.associated.fn.method.self-ty" title="items.associated.fn.method.self-ty"><span>[items<wbr>.associated<wbr>.fn<wbr>.method<wbr>.self-ty]</span></a>
</div>

<p>如果指定了 <code>self</code> 参数的类型，则它仅限于解析为由以下语法生成的类型（其中 <code>'lt</code> 表示某个任意生命周期）：</p>
<pre><code class="language-text">P = &amp;'lt S | &amp;'lt mut S | Box&lt;S&gt; | Rc&lt;S&gt; | Arc&lt;S&gt; | Pin&lt;P&gt;
S = Self | P
</code></pre>
<p>此语法中的 <code>Self</code> 终结符表示解析为实现类型的类型。这也可以包括上下文类型别名 <code>Self</code>、其他类型别名，或解析为实现类型的关联类型投影。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use std::rc::Rc;
</span><span class="boring">use std::sync::Arc;
</span><span class="boring">use std::pin::Pin;
</span>// 在结构体 `Example` 上实现的方法示例。
struct Example;
type Alias = Example;
trait Trait { type Output; }
impl Trait for Example { type Output = Example; }
impl Example {
    fn by_value(self: Self) {}
    fn by_ref(self: &amp;Self) {}
    fn by_ref_mut(self: &amp;mut Self) {}
    fn by_box(self: Box&lt;Self&gt;) {}
    fn by_rc(self: Rc&lt;Self&gt;) {}
    fn by_arc(self: Arc&lt;Self&gt;) {}
    fn by_pin(self: Pin&lt;&amp;Self&gt;) {}
    fn explicit_type(self: Arc&lt;Example&gt;) {}
    fn with_lifetime&lt;'a&gt;(self: &amp;'a Self) {}
    fn nested&lt;'a&gt;(self: &amp;mut &amp;'a Arc&lt;Rc&lt;Box&lt;Alias&gt;&gt;&gt;) {}
    fn via_projection(self: &lt;Example as Trait&gt;::Output) {}
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-associated.fn.method.self-pat-shorthands"><a class="rule-link" href="#r-associated.fn.method.self-pat-shorthands" title="associated.fn.method.self-pat-shorthands"><span>[associated<wbr>.fn<wbr>.method<wbr>.self-pat-shorthands]</span></a>
</div>

<p>可以使用简写语法而不指定类型，它们具有以下等价形式：</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>简写</th><th>等价形式</th></tr>
</thead>
<tbody>
<tr><td><code>self</code></td><td><code>self: Self</code></td></tr>
<tr><td><code>&amp;'lifetime self</code></td><td><code>self: &amp;'lifetime Self</code></td></tr>
<tr><td><code>&amp;'lifetime mut self</code></td><td><code>self: &amp;'lifetime mut Self</code></td></tr>
</tbody>
</table>
</div>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>生命周期可以，且通常在这种简写中被省略。</p>
</blockquote>
</div>

<div class="rule" id="r-associated.fn.method.self-pat-mut"><a class="rule-link" href="#r-associated.fn.method.self-pat-mut" title="associated.fn.method.self-pat-mut"><span>[associated<wbr>.fn<wbr>.method<wbr>.self-pat-mut]</span></a>
</div>

<p>如果 <code>self</code> 参数带有 <code>mut</code> 前缀，它就会变成一个可变变量，类似于使用 <code>mut</code> <a href="#identifier-patterns">标识符模式</a> 的常规参数。例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Changer: Sized {
    fn change(mut self) {}
    fn modify(mut self: Box&lt;Self&gt;) {}
}
<span class="boring">}</span></code></pre>
<p>作为 特型 上方法的示例，请考虑以下内容：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">type Surface = i32;
</span><span class="boring">type BoundingBox = i32;
</span>trait Shape {
    fn draw(&amp;self, surface: Surface);
    fn bounding_box(&amp;self) -&gt; BoundingBox;
}
<span class="boring">}</span></code></pre>
<p>这定义了一个具有两个方法的 特型。在 特型 处于作用域内时，所有具有该 特型 <a href="#实现">实现</a> 的值都可以调用其 <code>draw</code> 和 <code>bounding_box</code> 方法。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">type Surface = i32;
</span><span class="boring">type BoundingBox = i32;
</span><span class="boring">trait Shape {
</span><span class="boring">    fn draw(&amp;self, surface: Surface);
</span><span class="boring">    fn bounding_box(&amp;self) -&gt; BoundingBox;
</span><span class="boring">}
</span><span class="boring">
</span>struct Circle {
    // ...
}

impl Shape for Circle {
    // ...
<span class="boring">  fn draw(&amp;self, _: Surface) {}
</span><span class="boring">  fn bounding_box(&amp;self) -&gt; BoundingBox { 0i32 }
</span>}

<span class="boring">impl Circle {
</span><span class="boring">    fn new() -&gt; Circle { Circle{} }
</span><span class="boring">}
</span><span class="boring">
</span>let circle_shape = Circle::new();
let bounding_box = circle_shape.bounding_box();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.associated.fn.params.edition2018"><a class="rule-link" href="#r-items.associated.fn.params.edition2018" title="items.associated.fn.params.edition2018"><span>[items<wbr>.associated<wbr>.fn<wbr>.params<wbr>.edition2018]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p>在 2015 版次中，可以使用匿名参数声明 特型 方法（例如 <code>fn foo(u8)</code>）。从 2018 版次开始，这种做法已被弃用并被视为错误。所有参数都必须有一个参数名称。</p>
</blockquote>
</div>

<div class="rule" id="r-items.associated.fn.param-attributes"><a class="rule-link" href="#r-items.associated.fn.param-attributes" title="items.associated.fn.param-attributes"><span>[items<wbr>.associated<wbr>.fn<wbr>.param-attributes]</span></a>
</div>

<h4 id="方法参数上的属性"><a class="header" href="#方法参数上的属性">方法参数上的属性</a></h4>
<p>方法参数上的属性遵循与 <a href="#attributes-on-function-parameters">常规函数参数</a> 相同的规则和限制。</p>
<div class="rule" id="r-items.associated.type"><a class="rule-link" href="#r-items.associated.type" title="items.associated.type"><span>[items<wbr>.associated<wbr>.type]</span></a>
</div>

<h2 id="关联类型"><a class="header" href="#关联类型">关联类型</a></h2>
<div class="rule" id="r-items.associated.type.intro"><a class="rule-link" href="#r-items.associated.type.intro" title="items.associated.type.intro"><span>[items<wbr>.associated<wbr>.type<wbr>.intro]</span></a>
</div>

<p><em>关联类型 (Associated types)</em>  是与另一个类型关联的 <a href="#类型别名">类型别名</a>。</p>
<div class="rule" id="r-items.associated.type.restrictions"><a class="rule-link" href="#r-items.associated.type.restrictions" title="items.associated.type.restrictions"><span>[items<wbr>.associated<wbr>.type<wbr>.restrictions]</span></a>
</div>

<p>关联类型不能在 <a href="#inherent-implementations">固有实现</a> 中定义，也不能在 特型 中给出默认实现。</p>
<div class="rule" id="r-items.associated.type.decl"><a class="rule-link" href="#r-items.associated.type.decl" title="items.associated.type.decl"><span>[items<wbr>.associated<wbr>.type<wbr>.decl]</span></a>
</div>

<p><em>关联类型声明</em>  为关联类型定义声明一个签名。它的写法有以下形式之一，其中 <code>Assoc</code> 是关联类型的名称，<code>Params</code> 是以逗号分隔的类型、生命周期或常量参数列表，<code>Bounds</code> 是以加号分隔的关联类型必须满足的特型绑定列表，而 <code>WhereBounds</code> 是以逗号分隔的参数必须满足的绑定列表：</p>
<!-- ignore: illustrative example forms -->
<pre><code class="language-rust ignore">type Assoc;
type Assoc: Bounds;
type Assoc&lt;Params&gt;;
type Assoc&lt;Params&gt;: Bounds;
type Assoc&lt;Params&gt; where WhereBounds;
type Assoc&lt;Params&gt;: Bounds where WhereBounds;</code></pre>
<div class="rule" id="r-items.associated.type.name"><a class="rule-link" href="#r-items.associated.type.name" title="items.associated.type.name"><span>[items<wbr>.associated<wbr>.type<wbr>.name]</span></a>
</div>

<p>标识符是声明的类型别名的名称。</p>
<div class="rule" id="r-items.associated.type.impl-fulfillment"><a class="rule-link" href="#r-items.associated.type.impl-fulfillment" title="items.associated.type.impl-fulfillment"><span>[items<wbr>.associated<wbr>.type<wbr>.impl-fulfillment]</span></a>
</div>

<p>可选的 特型 绑定必须由类型别名的实现满足。</p>
<div class="rule" id="r-items.associated.type.sized"><a class="rule-link" href="#r-items.associated.type.sized" title="items.associated.type.sized"><span>[items<wbr>.associated<wbr>.type<wbr>.sized]</span></a>
</div>

<p>关联类型上有一个隐式的 <a href="#sized-1"><code>Sized</code></a> 绑定，可以使用特殊的 <code>?Sized</code> 绑定来放宽。</p>
<div class="rule" id="r-items.associated.type.def"><a class="rule-link" href="#r-items.associated.type.def" title="items.associated.type.def"><span>[items<wbr>.associated<wbr>.type<wbr>.def]</span></a>
</div>

<p><em>关联类型定义</em>  为 特型 在类型上的实现定义了一个类型别名。</p>
<div class="rule" id="r-items.associated.type.def.restriction"><a class="rule-link" href="#r-items.associated.type.def.restriction" title="items.associated.type.def.restriction"><span>[items<wbr>.associated<wbr>.type<wbr>.def<wbr>.restriction]</span></a>
</div>

<p>它们的写法类似于  <em>关联类型声明</em> ，但不能包含 <code>Bounds</code>，而是必须包含一个 <code>Type</code>：</p>
<!-- ignore: illustrative example forms -->
<pre><code class="language-rust ignore">type Assoc = Type;
type Assoc&lt;Params&gt; = Type; // 这里的类型 `Type` 可以引用 `Params`
type Assoc&lt;Params&gt; = Type where WhereBounds;
type Assoc&lt;Params&gt; where WhereBounds = Type; // 已弃用，推荐使用上述形式</code></pre>
<div class="rule" id="r-items.associated.type.alias"><a class="rule-link" href="#r-items.associated.type.alias" title="items.associated.type.alias"><span>[items<wbr>.associated<wbr>.type<wbr>.alias]</span></a>
</div>

<p>如果类型 <code>Item</code> 具有来自 特型 <code>Trait</code> 的关联类型 <code>Assoc</code>，那么 <code>&lt;Item as Trait&gt;::Assoc</code> 就是一个类型，它是关联类型定义中指定的类型的别名。</p>
<div class="rule" id="r-items.associated.type.param"><a class="rule-link" href="#r-items.associated.type.param" title="items.associated.type.param"><span>[items<wbr>.associated<wbr>.type<wbr>.param]</span></a>
</div>

<p>此外，如果 <code>Item</code> 是一个 类型参数，那么 <code>Item::Assoc</code> 可以用在类型参数中。</p>
<div class="rule" id="r-items.associated.type.generic"><a class="rule-link" href="#r-items.associated.type.generic" title="items.associated.type.generic"><span>[items<wbr>.associated<wbr>.type<wbr>.generic]</span></a>
</div>

<p>关联类型可以包含 <a href="#泛型参数">泛型参数</a> 和 <a href="#where-clauses">where 子句</a>；这些通常被称为  <em>泛型关联类型 (generic associated types)</em>  或  <em>GATs</em> 。如果类型 <code>Thing</code> 具有来自 特型 <code>Trait</code> 且带有泛型 <code>&lt;'a&gt;</code> 的关联类型 <code>Item</code>，则该类型可以被命名为 <code>&lt;Thing as Trait&gt;::Item&lt;'x&gt;</code>，其中 <code>'x</code> 是作用域内的某个生命周期。在这种情况下，在 impl 上的关联类型定义中，凡是出现 <code>'a</code> 的地方都会使用 <code>'x</code>。</p>
<pre class="playground"><code class="language-rust edition2024">trait AssociatedType {
    // 关联类型声明
    type Assoc;
}

struct Struct;

struct OtherStruct;

impl AssociatedType for Struct {
    // 关联类型定义
    type Assoc = OtherStruct;
}

impl OtherStruct {
    fn new() -&gt; OtherStruct {
        OtherStruct
    }
}

fn main() {
    // 使用关联类型以 &lt;Struct as AssociatedType&gt;::Assoc 形式引用 OtherStruct
    let _other_struct: OtherStruct = &lt;Struct as AssociatedType&gt;::Assoc::new();
}</code></pre>
<p>带有泛型和 where 子句的关联类型示例：</p>
<pre class="playground"><code class="language-rust edition2024">struct ArrayLender&lt;'a, T&gt;(&amp;'a mut [T; 16]);

trait Lend {
    // 泛型关联类型声明
    type Lender&lt;'a&gt; where Self: 'a;
    fn lend&lt;'a&gt;(&amp;'a mut self) -&gt; Self::Lender&lt;'a&gt;;
}

impl&lt;T&gt; Lend for [T; 16] {
    // 泛型关联类型定义
    type Lender&lt;'a&gt; = ArrayLender&lt;'a, T&gt; where Self: 'a;

    fn lend&lt;'a&gt;(&amp;'a mut self) -&gt; Self::Lender&lt;'a&gt; {
        ArrayLender(self)
    }
}

fn borrow&lt;'a, T: Lend&gt;(array: &amp;'a mut T) -&gt; &lt;T as Lend&gt;::Lender&lt;'a&gt; {
    array.lend()
}

fn main() {
    let mut array = [0usize; 16];
    let lender = borrow(&amp;mut array);
}</code></pre>
<h3 id="关联类型容器示例"><a class="header" href="#关联类型容器示例">关联类型容器示例</a></h3>
<p>考虑以下 <code>Container</code> 特型 的示例。请注意，该类型可在方法签名中使用：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Container {
    type E;
    fn empty() -&gt; Self;
    fn insert(&amp;mut self, elem: Self::E);
}
<span class="boring">}</span></code></pre>
<p>为了让一个类型实现这个 特型，它不仅必须为每个方法提供实现，还必须指定类型 <code>E</code>。下面是为标准库类型 <code>Vec</code> 实现 <code>Container</code> 的示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">trait Container {
</span><span class="boring">    type E;
</span><span class="boring">    fn empty() -&gt; Self;
</span><span class="boring">    fn insert(&amp;mut self, elem: Self::E);
</span><span class="boring">}
</span>impl&lt;T&gt; Container for Vec&lt;T&gt; {
    type E = T;
    fn empty() -&gt; Vec&lt;T&gt; { Vec::new() }
    fn insert(&amp;mut self, x: T) { self.push(x); }
}
<span class="boring">}</span></code></pre>
<h3 id="bounds和wherebounds之间的关系"><a class="header" href="#bounds和wherebounds之间的关系"><code>Bounds</code>和<code>WhereBounds</code>之间的关系</a></h3>
<p>在这个例子中：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use std::fmt::Debug;
</span>trait Example {
    type Output&lt;T&gt;: Ord where T: Debug;
}
<span class="boring">}</span></code></pre>
<p>给定关联类型的引用如 <code>&lt;X as Example&gt;::Output&lt;Y&gt;</code>，关联类型本身必须是 <code>Ord</code>，且类型 <code>Y</code> 必须是 <code>Debug</code>。</p>
<div class="rule" id="r-items.associated.type.generic-where-clause"><a class="rule-link" href="#r-items.associated.type.generic-where-clause" title="items.associated.type.generic-where-clause"><span>[items<wbr>.associated<wbr>.type<wbr>.generic-where-clause]</span></a>
</div>

<h3 id="泛型关联类型上必需的-where子句"><a class="header" href="#泛型关联类型上必需的-where子句">泛型关联类型上必需的 where子句</a></h3>
<div class="rule" id="r-items.associated.type.generic-where-clause.intro"><a class="rule-link" href="#r-items.associated.type.generic-where-clause.intro" title="items.associated.type.generic-where-clause.intro"><span>[items<wbr>.associated<wbr>.type<wbr>.generic-where-clause<wbr>.intro]</span></a>
</div>

<p>特型 上的泛型关联类型声明目前可能需要一系列 where 子句，这取决于 特型 中的函数以及 GAT 的使用方式。这些规则将来可能会放宽；更新可以在 <a href="https://rust-lang.github.io/generic-associated-types-initiative/explainer/required_bounds.html">泛型关联类型计划仓库 (generic associated types initiative repository)</a> 中找到。</p>
<div class="rule" id="r-items.associated.type.generic-where-clause.valid-fn"><a class="rule-link" href="#r-items.associated.type.generic-where-clause.valid-fn" title="items.associated.type.generic-where-clause.valid-fn"><span>[items<wbr>.associated<wbr>.type<wbr>.generic-where-clause<wbr>.valid-fn]</span></a>
</div>

<p>简而言之，为了最大限度地允许 impl 中关联类型的定义，这些 where 子句是必需的。为此，对于 GAT 作为输入或输出出现的任何函数，凡是 <em>可以被证明在函数上成立</em> 的子句（使用函数或 特型 的参数），也必须写在 GAT 自身之上。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait LendingIterator {
    type Item&lt;'x&gt; where Self: 'x;
    fn next&lt;'a&gt;(&amp;'a mut self) -&gt; Self::Item&lt;'a&gt;;
}
<span class="boring">}</span></code></pre>
<p>在上面 <code>next</code> 函数中，由于 <code>&amp;'a mut self</code> 的隐含绑定，我们可以证明 <code>Self: 'a</code>；因此，我们必须在 GAT 自身上写下等效的绑定：<code>where Self: 'x</code>。</p>
<div class="rule" id="r-items.associated.type.generic-where-clause.intersection"><a class="rule-link" href="#r-items.associated.type.generic-where-clause.intersection" title="items.associated.type.generic-where-clause.intersection"><span>[items<wbr>.associated<wbr>.type<wbr>.generic-where-clause<wbr>.intersection]</span></a>
</div>

<p>当 特型 中有多个函数使用该 GAT 时，将使用来自不同函数的绑定的  <em>交集 (intersection)</em> ，而不是并集。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Check&lt;T&gt; {
    type Checker&lt;'x&gt;;
    fn create_checker&lt;'a&gt;(item: &amp;'a T) -&gt; Self::Checker&lt;'a&gt;;
    fn do_check(checker: Self::Checker&lt;'_&gt;);
}
<span class="boring">}</span></code></pre>
<p>在这个例子中，<code>type Checker&lt;'a&gt;;</code> 上不需要任何绑定。虽然我们知道在 <code>create_checker</code> 上 <code>T: 'a</code>，但在 <code>do_check</code> 上我们并不知道这一点。但是，如果 <code>do_check</code> 被注释掉，那么 <code>Checker</code> 上就需要 <code>where T: 'x</code> 绑定。</p>
<div class="rule" id="r-items.associated.type.generic-where-clause.forward"><a class="rule-link" href="#r-items.associated.type.generic-where-clause.forward" title="items.associated.type.generic-where-clause.forward"><span>[items<wbr>.associated<wbr>.type<wbr>.generic-where-clause<wbr>.forward]</span></a>
</div>

<p>关联类型上的绑定也会传播必需的 where 子句。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Iterable {
    type Item&lt;'a&gt; where Self: 'a;
    type Iterator&lt;'a&gt;: Iterator&lt;Item = Self::Item&lt;'a&gt;&gt; where Self: 'a;
    fn iter&lt;'a&gt;(&amp;'a self) -&gt; Self::Iterator&lt;'a&gt;;
}
<span class="boring">}</span></code></pre>
<p>这里，由于 <code>iter</code> 的缘故，<code>Item</code> 上需要 <code>where Self: 'a</code>。然而，由于 <code>Item</code> 被用于 <code>Iterator</code> 的绑定中，<code>where Self: 'a</code> 子句在那里也是必需的。</p>
<div class="rule" id="r-items.associated.type.generic-where-clause.static"><a class="rule-link" href="#r-items.associated.type.generic-where-clause.static" title="items.associated.type.generic-where-clause.static"><span>[items<wbr>.associated<wbr>.type<wbr>.generic-where-clause<wbr>.static]</span></a>
</div>

<p>最后，在 特型 中的 GAT 上显式使用的任何 <code>'static</code> 都不计入必需绑定。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait StaticReturn {
    type Y&lt;'a&gt;;
    fn foo(&amp;self) -&gt; Self::Y&lt;'static&gt;;
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-items.associated.const"><a class="rule-link" href="#r-items.associated.const" title="items.associated.const"><span>[items<wbr>.associated<wbr>.const]</span></a>
</div>

<h2 id="关联常量"><a class="header" href="#关联常量">关联常量</a></h2>
<div class="rule" id="r-items.associated.const.intro"><a class="rule-link" href="#r-items.associated.const.intro" title="items.associated.const.intro"><span>[items<wbr>.associated<wbr>.const<wbr>.intro]</span></a>
</div>

<p><em>关联常量 (Associated constants)</em>  是与类型关联的 <a href="#常量项">常量</a>。</p>
<div class="rule" id="r-items.associated.const.decl"><a class="rule-link" href="#r-items.associated.const.decl" title="items.associated.const.decl"><span>[items<wbr>.associated<wbr>.const<wbr>.decl]</span></a>
</div>

<p><em>关联常量声明</em>  为关联常量定义声明一个签名。它的写法是 <code>const</code>，然后是一个标识符，然后是 <code>:</code>，然后是一个类型，最后以 <code>;</code> 结束。</p>
<div class="rule" id="r-items.associated.const.name"><a class="rule-link" href="#r-items.associated.const.name" title="items.associated.const.name"><span>[items<wbr>.associated<wbr>.const<wbr>.name]</span></a>
</div>

<p>标识符是在路径中使用的常量的名称。类型是定义必须实现的类型。</p>
<div class="rule" id="r-items.associated.const.def"><a class="rule-link" href="#r-items.associated.const.def" title="items.associated.const.def"><span>[items<wbr>.associated<wbr>.const<wbr>.def]</span></a>
</div>

<p><em>关联常量定义</em>  定义了一个与类型关联的常量。它的写法与 <a href="#常量项">常量项</a> 相同。</p>
<div class="rule" id="r-items.associated.const.eval"><a class="rule-link" href="#r-items.associated.const.eval" title="items.associated.const.eval"><span>[items<wbr>.associated<wbr>.const<wbr>.eval]</span></a>
</div>

<p>关联常量定义仅在被引用时才进行 <a href="#常量求值">常量求值</a>。此外，包含 <a href="#泛型参数">泛型参数</a> 的定义会在单态化后进行求值。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024">struct Struct;
struct GenericStruct&lt;const ID: i32&gt;;

impl Struct {
    // 定义不会立即求值
    const PANIC: () = panic!("compile-time panic");
}

impl&lt;const ID: i32&gt; GenericStruct&lt;ID&gt; {
    // 定义不会立即求值
    const NON_ZERO: () = if ID == 0 {
        panic!("contradiction")
    };
}

fn main() {
    // 引用 Struct::PANIC 会导致编译错误
    let _ = Struct::PANIC;

    // 正常，ID 不是 0
    let _ = GenericStruct::&lt;1&gt;::NON_ZERO;

    // 求值 ID=0 的 NON_ZERO 时产生编译错误
    let _ = GenericStruct::&lt;0&gt;::NON_ZERO;
}</code></pre>
<h3 id="关联常量示例"><a class="header" href="#关联常量示例">关联常量示例</a></h3>
<p>一个基本示例：</p>
<pre class="playground"><code class="language-rust edition2024">trait ConstantId {
    const ID: i32;
}

struct Struct;

impl ConstantId for Struct {
    const ID: i32 = 1;
}

fn main() {
    assert_eq!(1, Struct::ID);
}</code></pre>
<p>使用默认值：</p>
<pre class="playground"><code class="language-rust edition2024">trait ConstantIdDefault {
    const ID: i32 = 1;
}

struct Struct;
struct OtherStruct;

impl ConstantIdDefault for Struct {}

impl ConstantIdDefault for OtherStruct {
    const ID: i32 = 5;
}

fn main() {
    assert_eq!(1, Struct::ID);
    assert_eq!(5, OtherStruct::ID);
}</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-attributes"><a class="rule-link" href="#r-attributes" title="attributes"><span>[attributes]</span></a>
</div>

<h1 id="属性-1"><a class="header" href="#属性-1">属性</a></h1>
<div class="rule" id="r-attributes.syntax"><a class="rule-link" href="#r-attributes.syntax" title="attributes.syntax"><span>[attributes<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-InnerAttribute" onclick="show_railroad()"><a href="#railroad-InnerAttribute">InnerAttribute</a></span> → <span class="grammar-literal">#</span> <span class="grammar-literal">!</span> <span class="grammar-literal">[</span> <span class="grammar-text"><a href="#grammar-Attr">Attr</a></span> <span class="grammar-literal">]</span></p>
<p><span class="grammar-text grammar-production" id="grammar-OuterAttribute" onclick="show_railroad()"><a href="#railroad-OuterAttribute">OuterAttribute</a></span> → <span class="grammar-literal">#</span> <span class="grammar-literal">[</span> <span class="grammar-text"><a href="#grammar-Attr">Attr</a></span> <span class="grammar-literal">]</span></p>
<p><span class="grammar-text grammar-production" id="grammar-Attr" onclick="show_railroad()"><a href="#railroad-Attr">Attr</a></span> → <br>      <span class="grammar-text"><a href="#grammar-SimplePath">SimplePath</a></span> <span class="grammar-text"><a href="#grammar-AttrInput">AttrInput</a></span><sup>?</sup> <br>    | <span class="grammar-literal">unsafe</span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-SimplePath">SimplePath</a></span> <span class="grammar-text"><a href="#grammar-AttrInput">AttrInput</a></span><sup>?</sup> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-AttrInput" onclick="show_railroad()"><a href="#railroad-AttrInput">AttrInput</a></span> → <br>      <span class="grammar-text"><a href="#grammar-DelimTokenTree">DelimTokenTree</a></span> <br>    | <span class="grammar-literal">=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 274px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-InnerAttribute"><svg class="railroad" viewbox="0 0 274 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-InnerAttribute">
<text class="comment" x="64" y="25">
InnerAttribute</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="42" />
<text x="49" y="58">
#</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="73" y="42" />
<text x="87" y="58">
!</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="111" y="42" />
<text x="125" y="58">
[</text>
</g>
<a class="link" xlink:href="#railroad-Attr">
<g class="nonterminal">
<rect height="22" width="52" x="149" y="42" />
<text x="175" y="58">
Attr</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="211" y="42" />
<text x="225" y="58">
]</text>
</g>
<path d=" M 63 53 h 10" />
<path d=" M 101 53 h 10" />
<path d=" M 139 53 h 10" />
<path d=" M 201 53 h 10" />
</g>
<path d=" M 249 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 239 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 236px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-OuterAttribute"><svg class="railroad" viewbox="0 0 236 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-OuterAttribute">
<text class="comment" x="64" y="25">
OuterAttribute</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="42" />
<text x="49" y="58">
#</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="73" y="42" />
<text x="87" y="58">
[</text>
</g>
<a class="link" xlink:href="#railroad-Attr">
<g class="nonterminal">
<rect height="22" width="52" x="111" y="42" />
<text x="137" y="58">
Attr</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="173" y="42" />
<text x="187" y="58">
]</text>
</g>
<path d=" M 63 53 h 10" />
<path d=" M 101 53 h 10" />
<path d=" M 163 53 h 10" />
</g>
<path d=" M 211 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 201 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 522px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Attr"><svg class="railroad" viewbox="0 0 522 132" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Attr">
<text class="comment" x="29" y="25">
Attr</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 66 h 24 m 250 0 h 178 m -86 0 l -5 -5 m 0 10 l 5 -5 m 86 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-SimplePath">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="55" />
<text x="109" y="71">
SimplePath</text>
</g>
</a>
<g class="optional">
<path d=" M 169 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 92 m -43 0 l -5 -5 m 0 10 l 5 -5 m 43 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-AttrInput">
<g class="nonterminal">
<rect height="22" width="92" x="193" y="55" />
<text x="239" y="71">
AttrInput</text>
</g>
</a>
</g>
<path d=" M 159 66 h 10" />
</g>
<path d=" M 35 66 a 12 12 0 0 1 12 12 v 9 m 428 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 87 v 12 a 12 12 0 0 0 12 12 m 404 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="100" />
<text x="93" y="116">
unsafe</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="137" y="100" />
<text x="151" y="116">
(</text>
</g>
<a class="link" xlink:href="#railroad-SimplePath">
<g class="nonterminal">
<rect height="22" width="100" x="175" y="100" />
<text x="225" y="116">
SimplePath</text>
</g>
</a>
<g class="optional">
<path d=" M 285 111 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 92 m -43 0 l -5 -5 m 0 10 l 5 -5 m 43 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-AttrInput">
<g class="nonterminal">
<rect height="22" width="92" x="309" y="100" />
<text x="355" y="116">
AttrInput</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="435" y="100" />
<text x="449" y="116">
)</text>
</g>
<path d=" M 127 111 h 10" />
<path d=" M 165 111 h 10" />
<path d=" M 275 111 h 10" />
<path d=" M 425 111 h 10" />
</g>
</g>
<path d=" M 497 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 487 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 256px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-AttrInput"><svg class="railroad" viewbox="0 0 256 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-AttrInput">
<text class="comment" x="46" y="25">
AttrInput</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 132 0 h 30" />
<g class="sequence">
<a class="link" xlink:href="#railroad-DelimTokenTree">
<g class="nonterminal">
<rect height="22" width="132" x="59" y="42" />
<text x="125" y="58">
DelimTokenTree</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 162 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 138 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="75" />
<text x="73" y="91">
=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="97" y="75" />
<text x="147" y="91">
Expression</text>
</g>
</a>
<path d=" M 87 86 h 10" />
</g>
</g>
<path d=" M 231 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 221 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-attributes.intro"><a class="rule-link" href="#r-attributes.intro" title="attributes.intro"><span>[attributes<wbr>.intro]</span></a>
</div>

<p>一个 <em>属性</em> 是一个通用的、自由形式的元数据，根据名称、约定、语言和编译器版本进行解释。属性的建模基于 <a href="https://www.ecma-international.org/publications-and-standards/standards/ecma-335/">ECMA-335</a> 中的属性，其 语法格式 源自 <a href="https://www.ecma-international.org/publications-and-standards/standards/ecma-334/">ECMA-334</a> (C#)。</p>
<div class="rule" id="r-attributes.inner"><a class="rule-link" href="#r-attributes.inner" title="attributes.inner"><span>[attributes<wbr>.inner]</span></a>
</div>

<p><em>内部属性</em>，写在哈希符号 (<code>#</code>) 后带一个感叹号 (<code>!</code>)，适用于声明该属性的所在形式。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 适用于 enclosing 模块或 crate 的通用元数据。
#![crate_type = "lib"]

// 内部属性适用于整个函数。
fn some_unused_variables() {
  #![allow(unused_variables)]

  let x = ();
  let y = ();
  let z = ();
}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-attributes.outer"><a class="rule-link" href="#r-attributes.outer" title="attributes.outer"><span>[attributes<wbr>.outer]</span></a>
</div>

<p><em>外部属性</em>，写在哈希符号后不带感叹号，适用于属性后面的形式。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 标记为单元测试的函数
#[test]
fn test_foo() {
    /* ... */
}

// 有条件编译的模块
#[cfg(target_os = "linux")]
mod bar {
    /* ... */
}

// 用于抑制警告/错误的 lint 属性
#[allow(non_camel_case_types)]
type int8_t = i8;
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-attributes.input"><a class="rule-link" href="#r-attributes.input" title="attributes.input"><span>[attributes<wbr>.input]</span></a>
</div>

<p>属性由属性的路径组成，后跟一个可选的带分隔符的词法单元树，其解释由属性定义。除了宏属性之外，属性还允许输入是一个等号 (<code>=</code>) 后跟一个表达式。有关更多详细信息，请参阅下面的 <a href="#meta-item-attribute-syntax">元项属性语法</a>。</p>
<div class="rule" id="r-attributes.safety"><a class="rule-link" href="#r-attributes.safety" title="attributes.safety"><span>[attributes<wbr>.safety]</span></a>
</div>

<p>属性的应用可能不安全。为避免在使用这些属性时出现未定义行为，必须满足某些编译器无法检查的义务。为了声明这些义务已满足，属性被 <code>unsafe(..)</code> 包裹，例如 <code>#[unsafe(no_mangle)]</code>。</p>
<p>以下属性是不安全的：</p>
<ul>
<li><a href="#the-export_name-attribute"><code>export_name</code></a></li>
<li><a href="#the-link_section-attribute"><code>link_section</code></a></li>
<li><a href="#the-naked-attribute"><code>naked</code></a></li>
<li><a href="#the-no_mangle-attribute"><code>no_mangle</code></a></li>
</ul>
<div class="rule" id="r-attributes.kind"><a class="rule-link" href="#r-attributes.kind" title="attributes.kind"><span>[attributes<wbr>.kind]</span></a>
</div>

<p>属性可以分为以下几种：</p>
<ul>
<li><a href="#built-in-attributes-index">内置属性</a></li>
<li><a href="#proc_macro_attribute属性">过程宏属性</a></li>
<li><a href="#派生宏辅助属性">派生宏辅助属性</a></li>
<li><a href="#tool-attributes">工具属性</a></li>
</ul>
<div class="rule" id="r-attributes.allowed-position"><a class="rule-link" href="#r-attributes.allowed-position" title="attributes.allowed-position"><span>[attributes<wbr>.allowed-position]</span></a>
</div>

<p>属性可以应用于语言中的多种形式：</p>
<ul>
<li>所有 <a href="#项">项声明</a> 接受外部属性，而 <a href="#外部块">外部块</a>、<a href="#函数">函数</a>、<a href="#实现">实现</a> 和 <a href="#模块">模块</a> 接受内部属性。</li>
<li>大多数 <a href="#语句">语句</a> 接受外部属性（有关表达式语句的限制，请参阅 <a href="#expression-attributes">表达式属性</a>）。</li>
<li><a href="#块表达式">块表达式</a> 接受外部和内部属性，但仅当它们是 <a href="#expression-statements">表达式语句</a> 的外部表达式或另一个块表达式的最终表达式时。</li>
<li><a href="#枚举">枚举</a> 变体和 <a href="#结构体">结构体</a> 及 <a href="#联合体">联合体</a> 字段接受外部属性。</li>
<li><a href="#match表达式">匹配表达式分支</a> 接受外部属性。</li>
<li><a href="#泛型参数">泛型 生命周期或类型参数</a> 接受外部属性。</li>
<li>表达式在有限情况下接受外部属性，详见 <a href="#expression-attributes">表达式属性</a>。</li>
<li><a href="#函数">函数</a>、<a href="#闭包表达式">闭包</a> 和 <a href="#函数指针类型">函数指针</a> 参数接受外部属性。这包括在函数指针和 <a href="#variadic-functions">外部块</a> 中用 <code>...</code> 表示的可变参数上的属性。</li>
<li><a href="#内联汇编">内联汇编</a> 模板字符串和操作数接受外部属性。语义上只接受某些属性；有关详细信息，请参阅 <a href="#r-asm.attributes.supported-attributes">asm.attributes.supported-attributes</a>。</li>
</ul>
<div class="rule" id="r-attributes.meta"><a class="rule-link" href="#r-attributes.meta" title="attributes.meta"><span>[attributes<wbr>.meta]</span></a>
</div>

<h2 id="元项属性语法"><a class="header" href="#元项属性语法">元项属性语法</a></h2>
<div class="rule" id="r-attributes.meta.intro"><a class="rule-link" href="#r-attributes.meta.intro" title="attributes.meta.intro"><span>[attributes<wbr>.meta<wbr>.intro]</span></a>
</div>

<p>“元项”是大多数 <a href="#built-in-attributes-index">内置属性</a> 用于 <a href="#grammar-Attr">Attr</a> 规则的 语法格式。它具有以下语法：</p>
<div class="rule" id="r-attributes.meta.syntax"><a class="rule-link" href="#r-attributes.meta.syntax" title="attributes.meta.syntax"><span>[attributes<wbr>.meta<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-MetaItem" onclick="show_railroad()"><a href="#railroad-MetaItem">MetaItem</a></span> → <br>      <span class="grammar-text"><a href="#grammar-SimplePath">SimplePath</a></span> <br>    | <span class="grammar-text"><a href="#grammar-SimplePath">SimplePath</a></span> <span class="grammar-literal">=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-SimplePath">SimplePath</a></span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-MetaSeq">MetaSeq</a></span><sup>?</sup> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-MetaSeq" onclick="show_railroad()"><a href="#railroad-MetaSeq">MetaSeq</a></span> → <br>    <span class="grammar-text"><a href="#grammar-MetaItemInner">MetaItemInner</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-MetaItemInner">MetaItemInner</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-MetaItemInner" onclick="show_railroad()"><a href="#railroad-MetaItemInner">MetaItemInner</a></span> → <br>      <span class="grammar-text"><a href="#grammar-MetaItem">MetaItem</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 428px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MetaItem"><svg class="railroad" viewbox="0 0 428 152" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MetaItem">
<text class="comment" x="43" y="25">
MetaItem</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 100 0 h 234 m -114 0 l -5 -5 m 0 10 l 5 -5 m 114 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-SimplePath">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="42" />
<text x="109" y="58">
SimplePath</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 334 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 334 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 248 0 h 62 m -28 0 l -5 -5 m 0 10 l 5 -5 m 28 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-SimplePath">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="75" />
<text x="109" y="91">
SimplePath</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="75" />
<text x="183" y="91">
=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="207" y="75" />
<text x="257" y="91">
Expression</text>
</g>
</a>
<path d=" M 159 86 h 10" />
<path d=" M 197 86 h 10" />
</g>
<path d=" M 47 107 v 12 a 12 12 0 0 0 12 12 m 310 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<a class="link" xlink:href="#railroad-SimplePath">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="120" />
<text x="109" y="136">
SimplePath</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="120" />
<text x="183" y="136">
(</text>
</g>
<g class="optional">
<path d=" M 207 131 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 76 m -35 0 l -5 -5 m 0 10 l 5 -5 m 35 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-MetaSeq">
<g class="nonterminal">
<rect height="22" width="76" x="231" y="120" />
<text x="269" y="136">
MetaSeq</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="341" y="120" />
<text x="355" y="136">
)</text>
</g>
<path d=" M 159 131 h 10" />
<path d=" M 197 131 h 10" />
<path d=" M 331 131 h 10" />
</g>
</g>
<path d=" M 403 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 393 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 524px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MetaSeq"><svg class="railroad" viewbox="0 0 524 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MetaSeq">
<text class="comment" x="39" y="25">
MetaSeq</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-MetaItemInner">
<g class="nonterminal">
<rect height="22" width="124" x="35" y="55" />
<text x="97" y="71">
MetaItemInner</text>
</g>
</a>
<g class="optional">
<path d=" M 169 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 186 m -90 0 l -5 -5 m 0 10 l 5 -5 m 90 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 193 66 h 12 m 162 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -162 m 84 0 l 5 -5 m 0 10 l -5 -5 m -84 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="205" y="55" />
<text x="219" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-MetaItemInner">
<g class="nonterminal">
<rect height="22" width="124" x="243" y="55" />
<text x="305" y="71">
MetaItemInner</text>
</g>
</a>
<path d=" M 233 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 413 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="437" y="55" />
<text x="451" y="71">
,</text>
</g>
</g>
<path d=" M 159 66 h 10" />
<path d=" M 403 66 h 10" />
</g>
<path d=" M 499 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 489 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 218px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MetaItemInner"><svg class="railroad" viewbox="0 0 218 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MetaItemInner">
<text class="comment" x="60" y="25">
MetaItemInner</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 84 0 h 40" />
<g class="sequence">
<a class="link" xlink:href="#railroad-MetaItem">
<g class="nonterminal">
<rect height="22" width="84" x="59" y="42" />
<text x="101" y="58">
MetaItem</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 124 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 100 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="75" />
<text x="109" y="91">
Expression</text>
</g>
</a>
</g>
<path d=" M 193 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 183 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-attributes.meta.literal-expr"><a class="rule-link" href="#r-attributes.meta.literal-expr" title="attributes.meta.literal-expr"><span>[attributes<wbr>.meta<wbr>.literal-expr]</span></a>
</div>

<p>元项中的表达式必须宏展开为字面量表达式，其中不得包含整数或浮点类型后缀。非字面量表达式的表达式在语法上会被接受（并可传递给过程宏），但会在解析后被拒绝。</p>
<div class="rule" id="r-attributes.meta.order"><a class="rule-link" href="#r-attributes.meta.order" title="attributes.meta.order"><span>[attributes<wbr>.meta<wbr>.order]</span></a>
</div>

<p>请注意，如果属性出现在另一个宏中，它将在该外部宏之后展开。例如，以下代码将首先展开 <code>Serialize</code> 过程宏，该宏必须保留 <code>include_str!</code> 调用才能被展开：</p>
<pre><code class="language-rust ignore">#[derive(Serialize)]
struct Foo {
    #[doc = include_str!("x.md")]
    x: u32
}</code></pre>
<div class="rule" id="r-attributes.meta.order-macro"><a class="rule-link" href="#r-attributes.meta.order-macro" title="attributes.meta.order-macro"><span>[attributes<wbr>.meta<wbr>.order-macro]</span></a>
</div>

<p>此外，属性中的宏只会在应用于该 项 的所有其他属性之后展开：</p>
<pre><code class="language-rust ignore">#[macro_attr1] // 首先展开
#[doc = mac!()] // `mac!` 第四次展开。
#[macro_attr2] // 第二次展开
#[derive(MacroDerive1, MacroDerive2)] // 第三次展开
fn foo() {}</code></pre>
<div class="rule" id="r-attributes.meta.builtin"><a class="rule-link" href="#r-attributes.meta.builtin" title="attributes.meta.builtin"><span>[attributes<wbr>.meta<wbr>.builtin]</span></a>
</div>

<p>各种内置属性使用元项语法的不同子集来指定它们的输入。以下语法规则展示了一些常用形式：</p>
<div class="rule" id="r-attributes.meta.builtin.syntax"><a class="rule-link" href="#r-attributes.meta.builtin.syntax" title="attributes.meta.builtin.syntax"><span>[attributes<wbr>.meta<wbr>.builtin<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-MetaWord" onclick="show_railroad()"><a href="#railroad-MetaWord">MetaWord</a></span> → <br>    <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-MetaNameValueStr" onclick="show_railroad()"><a href="#railroad-MetaNameValueStr">MetaNameValueStr</a></span> → <br>    <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-literal">=</span> ( <span class="grammar-text"><a href="#grammar-STRING_LITERAL">STRING_LITERAL</a></span> | <span class="grammar-text"><a href="#grammar-RAW_STRING_LITERAL">RAW_STRING_LITERAL</a></span> )</p>
<p><span class="grammar-text grammar-production" id="grammar-MetaListPaths" onclick="show_railroad()"><a href="#railroad-MetaListPaths">MetaListPaths</a></span> → <br>    <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-literal">(</span> ( <span class="grammar-text"><a href="#grammar-SimplePath">SimplePath</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-SimplePath">SimplePath</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup> )<sup>?</sup> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-MetaListIdents" onclick="show_railroad()"><a href="#railroad-MetaListIdents">MetaListIdents</a></span> → <br>    <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-literal">(</span> ( <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup> )<sup>?</sup> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-MetaListNameValueStr" onclick="show_railroad()"><a href="#railroad-MetaListNameValueStr">MetaListNameValueStr</a></span> → <br>    <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-literal">(</span> ( <span class="grammar-text"><a href="#grammar-MetaNameValueStr">MetaNameValueStr</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-MetaNameValueStr">MetaNameValueStr</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup> )<sup>?</sup> <span class="grammar-literal">)</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 170px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MetaWord"><svg class="railroad" viewbox="0 0 170 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MetaWord">
<text class="comment" x="43" y="25">
MetaWord</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="42" />
<text x="85" y="58">
IDENTIFIER</text>
</g>
</a>
</g>
<path d=" M 145 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 135 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 430px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MetaNameValueStr"><svg class="railroad" viewbox="0 0 430 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MetaNameValueStr">
<text class="comment" x="71" y="25">
MetaNameValueStr</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="42" />
<text x="85" y="58">
IDENTIFIER</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="145" y="42" />
<text x="159" y="58">
=</text>
</g>
<g class="choice">
<path d=" M 183 53 h 24 m 132 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0" />
<a class="link" xlink:href="#railroad-STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="132" x="207" y="42" />
<text x="273" y="58">
STRING_LITERAL</text>
</g>
</a>
<path d=" M 183 53 a 12 12 0 0 1 12 12 v 9 m 188 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 195 74 v 0 a 12 12 0 0 0 12 12 m 164 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-RAW_STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="164" x="207" y="75" />
<text x="289" y="91">
RAW_STRING_LITERAL</text>
</g>
</a>
</g>
<path d=" M 135 53 h 10" />
<path d=" M 173 53 h 10" />
</g>
<path d=" M 405 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 395 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 710px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MetaListPaths"><svg class="railroad" viewbox="0 0 710 112" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MetaListPaths">
<text class="comment" x="60" y="25">
MetaListPaths</text>
</a>
<g class="sequence">
<path d=" M 10 78 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="67" />
<text x="85" y="83">
IDENTIFIER</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="145" y="67" />
<text x="159" y="83">
(</text>
</g>
<g class="optional">
<path d=" M 183 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -12 a 12 12 0 0 1 12 -12 h 406 m -200 0 l -5 -5 m 0 10 l 5 -5 m 200 0 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-SimplePath">
<g class="nonterminal">
<rect height="22" width="100" x="207" y="67" />
<text x="257" y="83">
SimplePath</text>
</g>
</a>
<g class="optional">
<path d=" M 317 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 162 m -78 0 l -5 -5 m 0 10 l 5 -5 m 78 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 341 78 h 12 m 138 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -138 m 72 0 l 5 -5 m 0 10 l -5 -5 m -72 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="353" y="67" />
<text x="367" y="83">
,</text>
</g>
<a class="link" xlink:href="#railroad-SimplePath">
<g class="nonterminal">
<rect height="22" width="100" x="391" y="67" />
<text x="441" y="83">
SimplePath</text>
</g>
</a>
<path d=" M 381 78 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 537 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="561" y="67" />
<text x="575" y="83">
,</text>
</g>
</g>
<path d=" M 307 78 h 10" />
<path d=" M 527 78 h 10" />
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="647" y="67" />
<text x="661" y="83">
)</text>
</g>
<path d=" M 135 78 h 10" />
<path d=" M 173 78 h 10" />
<path d=" M 637 78 h 10" />
</g>
<path d=" M 685 78 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 78 h 10" />
<path d=" M 675 78 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 710px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MetaListIdents"><svg class="railroad" viewbox="0 0 710 112" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MetaListIdents">
<text class="comment" x="64" y="25">
MetaListIdents</text>
</a>
<g class="sequence">
<path d=" M 10 78 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="67" />
<text x="85" y="83">
IDENTIFIER</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="145" y="67" />
<text x="159" y="83">
(</text>
</g>
<g class="optional">
<path d=" M 183 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -12 a 12 12 0 0 1 12 -12 h 406 m -200 0 l -5 -5 m 0 10 l 5 -5 m 200 0 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="207" y="67" />
<text x="257" y="83">
IDENTIFIER</text>
</g>
</a>
<g class="optional">
<path d=" M 317 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 162 m -78 0 l -5 -5 m 0 10 l 5 -5 m 78 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 341 78 h 12 m 138 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -138 m 72 0 l 5 -5 m 0 10 l -5 -5 m -72 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="353" y="67" />
<text x="367" y="83">
,</text>
</g>
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="391" y="67" />
<text x="441" y="83">
IDENTIFIER</text>
</g>
</a>
<path d=" M 381 78 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 537 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="561" y="67" />
<text x="575" y="83">
,</text>
</g>
</g>
<path d=" M 307 78 h 10" />
<path d=" M 527 78 h 10" />
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="647" y="67" />
<text x="661" y="83">
)</text>
</g>
<path d=" M 135 78 h 10" />
<path d=" M 173 78 h 10" />
<path d=" M 637 78 h 10" />
</g>
<path d=" M 685 78 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 78 h 10" />
<path d=" M 675 78 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 806px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MetaListNameValueStr"><svg class="railroad" viewbox="0 0 806 112" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MetaListNameValueStr">
<text class="comment" x="88" y="25">
MetaListNameValueStr</text>
</a>
<g class="sequence">
<path d=" M 10 78 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="67" />
<text x="85" y="83">
IDENTIFIER</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="145" y="67" />
<text x="159" y="83">
(</text>
</g>
<g class="optional">
<path d=" M 183 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -12 a 12 12 0 0 1 12 -12 h 502 m -248 0 l -5 -5 m 0 10 l 5 -5 m 248 0 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-MetaNameValueStr">
<g class="nonterminal">
<rect height="22" width="148" x="207" y="67" />
<text x="281" y="83">
MetaNameValueStr</text>
</g>
</a>
<g class="optional">
<path d=" M 365 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 210 m -102 0 l -5 -5 m 0 10 l 5 -5 m 102 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 389 78 h 12 m 186 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -186 m 96 0 l 5 -5 m 0 10 l -5 -5 m -96 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="401" y="67" />
<text x="415" y="83">
,</text>
</g>
<a class="link" xlink:href="#railroad-MetaNameValueStr">
<g class="nonterminal">
<rect height="22" width="148" x="439" y="67" />
<text x="513" y="83">
MetaNameValueStr</text>
</g>
</a>
<path d=" M 429 78 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 633 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="657" y="67" />
<text x="671" y="83">
,</text>
</g>
</g>
<path d=" M 355 78 h 10" />
<path d=" M 623 78 h 10" />
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="743" y="67" />
<text x="757" y="83">
)</text>
</g>
<path d=" M 135 78 h 10" />
<path d=" M 173 78 h 10" />
<path d=" M 733 78 h 10" />
</g>
<path d=" M 781 78 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 78 h 10" />
<path d=" M 771 78 h 10" />
</g>
</g>
</svg>
</div>

</div>

<p>一些元项的示例如下：</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>样式</th><th>示例</th></tr>
</thead>
<tbody>
<tr><td><a href="#grammar-MetaWord">元字</a></td><td><code>no_std</code></td></tr>
<tr><td><a href="#grammar-MetaNameValueStr">元名称值字符串</a></td><td><code>doc = "example"</code></td></tr>
<tr><td><a href="#grammar-MetaListPaths">元列表路径</a></td><td><code>allow(unused, clippy::inline_always)</code></td></tr>
<tr><td><a href="#grammar-MetaListIdents">元列表标识符</a></td><td><code>macro_use(foo, bar)</code></td></tr>
<tr><td><a href="#grammar-MetaListNameValueStr">元列表名称值字符串</a></td><td><code>link(name = "CoreFoundation", kind = "framework")</code></td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-attributes.activity"><a class="rule-link" href="#r-attributes.activity" title="attributes.activity"><span>[attributes<wbr>.activity]</span></a>
</div>

<h2 id="活跃属性和惰性属性"><a class="header" href="#活跃属性和惰性属性">活跃属性和惰性属性</a></h2>
<div class="rule" id="r-attributes.activity.intro"><a class="rule-link" href="#r-attributes.activity.intro" title="attributes.activity.intro"><span>[attributes<wbr>.activity<wbr>.intro]</span></a>
</div>

<p>属性要么是活跃的，要么是惰性的。在属性处理期间，<em>活跃属性</em> 会从它们所在的表单中移除自己，而 <em>惰性属性</em> 则保留在表单上。</p>
<p><a href="#cfg属性"><code>cfg</code></a> 和 <a href="#cfg_attr属性"><code>cfg_attr</code></a> 属性是活跃的。<a href="#proc_macro_attribute属性">属性宏</a> 是活跃的。所有其他属性都是惰性的。</p>
<div class="rule" id="r-attributes.tool"><a class="rule-link" href="#r-attributes.tool" title="attributes.tool"><span>[attributes<wbr>.tool]</span></a>
</div>

<h2 id="工具属性"><a class="header" href="#工具属性">工具属性</a></h2>
<div class="rule" id="r-attributes.tool.intro"><a class="rule-link" href="#r-attributes.tool.intro" title="attributes.tool.intro"><span>[attributes<wbr>.tool<wbr>.intro]</span></a>
</div>

<p>编译器可能允许外部工具的属性，其中每个工具都位于 <a href="#tool-prelude">工具预导入</a> 中的自己的模块中。属性路径的第一个段是工具的名称，带有一个或多个额外段，其解释由工具决定。</p>
<div class="rule" id="r-attributes.tool.ignored"><a class="rule-link" href="#r-attributes.tool.ignored" title="attributes.tool.ignored"><span>[attributes<wbr>.tool<wbr>.ignored]</span></a>
</div>

<p>当工具未使用时，工具的属性会被接受，而不会发出警告。当工具在使用时，工具负责处理和解释其属性。</p>
<div class="rule" id="r-attributes.tool.prelude"><a class="rule-link" href="#r-attributes.tool.prelude" title="attributes.tool.prelude"><span>[attributes<wbr>.tool<wbr>.prelude]</span></a>
</div>

<p>如果使用了 <a href="#the-no_implicit_prelude-attribute"><code>no_implicit_prelude</code></a> 属性，则工具属性不可用。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 告诉 rustfmt 工具不要格式化以下元素。
#[rustfmt::skip]
struct S {
}

// 控制 clippy 工具的“圈复杂度”阈值。
#[clippy::cyclomatic_complexity = "100"]
pub fn f() {}
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 目前识别的工具包括 “clippy”, “rustfmt”, “diagnostic”, “miri” 和 “rust_analyzer”。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.builtin"><a class="rule-link" href="#r-attributes.builtin" title="attributes.builtin"><span>[attributes<wbr>.builtin]</span></a>
</div>

<h2 id="内置属性索引"><a class="header" href="#内置属性索引">内置属性索引</a></h2>
<p>以下是所有内置属性的索引。</p>
<ul>
<li>
<p>条件编译</p>
<ul>
<li><a href="#cfg属性"><code>cfg</code></a> — 控制条件编译。</li>
<li><a href="#cfg_attr属性"><code>cfg_attr</code></a> — 有条件地包含属性。</li>
</ul>
</li>
<li>
<p>测试</p>
<ul>
<li><a href="#the-test-attribute"><code>test</code></a> — 将函数标记为测试。</li>
<li><a href="#the-ignore-attribute"><code>ignore</code></a> — 禁用测试函数。</li>
<li><a href="#the-should_panic-attribute"><code>should_panic</code></a> — 表示测试应生成一个 恐慌。</li>
</ul>
</li>
<li>
<p>派生</p>
<ul>
<li><a href="#派生"><code>derive</code></a> — 自动 特型 实现。</li>
<li><a href="#the-automatically_derived-attribute"><code>automatically_derived</code></a> — <code>derive</code> 创建的实现的标记。</li>
</ul>
</li>
<li>
<p>宏</p>
<ul>
<li><a href="#macro_export属性"><code>macro_export</code></a> — 导出用于跨 crate 使用的 <code>macro_rules</code> 宏。</li>
<li><a href="#macro_use属性"><code>macro_use</code></a> — 扩展宏可见性，或从其他 crate 导入宏。</li>
<li><a href="#proc_macro属性"><code>proc_macro</code></a> — 定义函数式宏。</li>
<li><a href="#r-macro.proc.derive"><code>proc_macro_derive</code></a> — 定义派生宏。</li>
<li><a href="#proc_macro_attribute属性"><code>proc_macro_attribute</code></a> — 定义属性宏。</li>
</ul>
</li>
<li>
<p>诊断</p>
<ul>
<li><a href="#lint-check-attributes"><code>allow</code></a>、<a href="#lint-check-attributes"><code>expect</code></a>、<a href="#lint-check-attributes"><code>warn</code></a>、<a href="#lint-check-attributes"><code>deny</code></a>、<a href="#lint-check-attributes"><code>forbid</code></a> — 更改默认 lint 级别。</li>
<li><a href="#the-deprecated-attribute"><code>deprecated</code></a> — 生成弃用通知。</li>
<li><a href="#the-must_use-attribute"><code>must_use</code></a> — 对未使用的值生成 lint。</li>
<li><a href="#the-diagnosticon_unimplemented-attribute"><code>diagnostic::on_unimplemented</code></a> — 提示编译器在 未实现 特型 时发出特定错误消息。</li>
<li><a href="#the-diagnosticdo_not_recommend-attribute"><code>diagnostic::do_not_recommend</code></a> — 提示编译器不要在错误消息中显示某个 特型 实现。</li>
</ul>
</li>
<li>
<p>ABI、链接、符号和 FFI</p>
<ul>
<li><a href="#the-link-attribute"><code>link</code></a> — 指定要与 <code>extern</code> 块链接的本地库。</li>
<li><a href="#the-link_name-attribute"><code>link_name</code></a> — 指定 <code>extern</code> 块中函数或静态变量的符号名称。</li>
<li><a href="#the-link_ordinal-attribute"><code>link_ordinal</code></a> — 指定 <code>extern</code> 块中函数或静态变量的符号序号。</li>
<li><a href="#the-no_link-attribute"><code>no_link</code></a> — 阻止链接外部 crate。</li>
<li><a href="#representations"><code>repr</code></a> — 控制类型布局。</li>
<li><a href="#链接"><code>crate_type</code></a> — 指定 crate 的类型（库、可执行文件等）。</li>
<li><a href="#no_main属性"><code>no_main</code></a> — 禁用发出 <code>main</code> 符号。</li>
<li><a href="#the-export_name-attribute"><code>export_name</code></a> — 指定函数或静态变量的导出符号名称。</li>
<li><a href="#the-link_section-attribute"><code>link_section</code></a> — 指定函数或静态变量要使用的对象文件节。</li>
<li><a href="#the-no_mangle-attribute"><code>no_mangle</code></a> — 禁用符号名称编码。</li>
<li><a href="#the-used-attribute"><code>used</code></a> — 强制编译器将静态 项 保留在输出对象文件中。</li>
<li><a href="#crate_name属性"><code>crate_name</code></a> — 指定 crate 名称。</li>
</ul>
</li>
<li>
<p>代码生成</p>
<ul>
<li><a href="#the-inline-attribute"><code>inline</code></a> — 提示内联代码。</li>
<li><a href="#the-cold-attribute"><code>cold</code></a> — 提示函数不太可能被调用。</li>
<li><a href="#the-naked-attribute"><code>naked</code></a> — 阻止编译器发出函数序言和尾声。</li>
<li><a href="#the-no_builtins-attribute"><code>no_builtins</code></a> — 禁用使用某些内置函数。</li>
<li><a href="#the-target_feature-attribute"><code>target_feature</code></a> — 配置特定于平台的代码生成。</li>
<li><a href="#the-track_caller-attribute"><code>track_caller</code></a> — 将父调用位置传递给 <code>std::panic::Location::caller()</code>。</li>
<li><a href="#the-instruction_set-attribute"><code>instruction_set</code></a> — 指定用于生成函数代码的指令集。</li>
</ul>
</li>
<li>
<p>文档</p>
<ul>
<li><code>doc</code> — 指定文档。有关更多信息，请参阅 <a href="../rustdoc/the-doc-attribute.html">The Rustdoc Book</a>。 <a href="#文档注释">文档注释</a> 会转换为 <code>doc</code> 属性。</li>
</ul>
</li>
<li>
<p>预导入</p>
<ul>
<li><a href="#the-no_std-attribute"><code>no_std</code></a> — 从 预导入 中移除 std。</li>
<li><a href="#the-no_implicit_prelude-attribute"><code>no_implicit_prelude</code></a> — 禁用模块内的 预导入 查找。</li>
</ul>
</li>
<li>
<p>模块</p>
<ul>
<li><a href="#the-path-attribute"><code>path</code></a> — 指定模块的文件名。</li>
</ul>
</li>
<li>
<p>限制</p>
<ul>
<li><a href="#the-recursion_limit-attribute"><code>recursion_limit</code></a> — 设置某些编译时操作的最大递归限制。</li>
<li><a href="#the-type_length_limit-attribute"><code>type_length_limit</code></a> — 设置多态类型的最大大小。</li>
</ul>
</li>
<li>
<p>运行时</p>
<ul>
<li><a href="#the-panic_handler-attribute"><code>panic_handler</code></a> — 设置处理 恐慌 的函数。</li>
<li><a href="#the-global_allocator-attribute"><code>global_allocator</code></a> — 设置全局内存分配器。</li>
<li><a href="#the-windows_subsystem-attribute"><code>windows_subsystem</code></a> — 指定要链接的 Windows 子系统。</li>
</ul>
</li>
<li>
<p>特性</p>
<ul>
<li><code>feature</code> — 用于启用不稳定或实验性编译器 特性。有关 <code>rustc</code> 中实现的 特性，请参阅 <a href="../unstable-book/index.html">The Unstable Book</a>。</li>
</ul>
</li>
<li>
<p>类型系统</p>
<ul>
<li><a href="#the-non_exhaustive-attribute"><code>non_exhaustive</code></a> — 指示将来会为类型添加更多字段/变体。</li>
</ul>
</li>
<li>
<p>调试器</p>
<ul>
<li><a href="#the-debugger_visualizer-attribute"><code>debugger_visualizer</code></a> — 嵌入一个文件，该文件指定某种类型的调试器输出。</li>
<li><a href="#the-collapse_debuginfo-attribute"><code>collapse_debuginfo</code></a> — 控制宏调用在调试信息中编码的方式。</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-attributes.testing"><a class="rule-link" href="#r-attributes.testing" title="attributes.testing"><span>[attributes<wbr>.testing]</span></a>
</div>

<h1 id="测试属性"><a class="header" href="#测试属性">测试属性</a></h1>
<p>以下 <a href="#属性-1">属性</a> 用于指定执行测试的函数。在“测试”模式下编译 crate 会启用测试函数的构建以及执行测试的测试工具。启用测试模式还会启用 <a href="#test"><code>test</code> 条件编译选项</a>。</p>
<!-- template:attributes -->
<div class="rule" id="r-attributes.testing.test"><a class="rule-link" href="#r-attributes.testing.test" title="attributes.testing.test"><span>[attributes<wbr>.testing<wbr>.test]</span></a>
</div>

<h2 id="test-属性"><a class="header" href="#test-属性"><code>test</code> 属性</a></h2>
<div class="rule" id="r-attributes.testing.test.intro"><a class="rule-link" href="#r-attributes.testing.test.intro" title="attributes.testing.test.intro"><span>[attributes<wbr>.testing<wbr>.test<wbr>.intro]</span></a>
</div>

<p><em><code>test</code> <a href="#属性-1">属性</a></em> 将一个函数标记为要作为测试执行。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">pub fn add(left: u64, right: u64) -&gt; u64 { left + right }
</span>#[test]
fn it_works() {
    let result = add(2, 2);
    assert_eq!(result, 4);
}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-attributes.testing.test.syntax"><a class="rule-link" href="#r-attributes.testing.test.syntax" title="attributes.testing.test.syntax"><span>[attributes<wbr>.testing<wbr>.test<wbr>.syntax]</span></a>
</div>

<p><code>test</code> 属性使用 <a href="#grammar-MetaWord">元字</a> 语法格式。</p>
<div class="rule" id="r-attributes.testing.test.allowed-positions"><a class="rule-link" href="#r-attributes.testing.test.allowed-positions" title="attributes.testing.test.allowed-positions"><span>[attributes<wbr>.testing<wbr>.test<wbr>.allowed-positions]</span></a>
</div>

<p><code>test</code> 属性只能应用于单态的、不带参数且返回类型实现 <a href="../std/process/trait.Termination.html"><code>Termination</code></a> 特型 的 <a href="#自由项">自由函数</a>。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>实现了 <a href="../std/process/trait.Termination.html"><code>Termination</code></a> 特型 的一些类型包括：</p>
<ul>
<li><code>()</code></li>
<li><code>Result&lt;T, E&gt; where T: Termination, E: Debug</code></li>
</ul>
</blockquote>
</div>

<div class="rule" id="r-attributes.testing.test.duplicates"><a class="rule-link" href="#r-attributes.testing.test.duplicates" title="attributes.testing.test.duplicates"><span>[attributes<wbr>.testing<wbr>.test<wbr>.duplicates]</span></a>
</div>

<p><code>test</code> 在函数上的第一次使用才有效。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 对第一次使用之后的任何使用都会发出 lint 警告。这在将来可能会变为错误。</p>
</blockquote>
</div>

<!-- TODO: This is a minor lie. Currently rustc warns that duplicates are ignored, but it then generates multiple test entries with the same name. I would vote for rejecting this in the future. -->
<div class="rule" id="r-attributes.testing.test.stdlib"><a class="rule-link" href="#r-attributes.testing.test.stdlib" title="attributes.testing.test.stdlib"><span>[attributes<wbr>.testing<wbr>.test<wbr>.stdlib]</span></a>
</div>

<p><code>test</code> 属性从标准库 预导入 <a href="../core/macros/builtin/attr.test.html"><code>std::prelude::v1::test</code></a> 中导出。</p>
<div class="rule" id="r-attributes.testing.test.enabled"><a class="rule-link" href="#r-attributes.testing.test.enabled" title="attributes.testing.test.enabled"><span>[attributes<wbr>.testing<wbr>.test<wbr>.enabled]</span></a>
</div>

<p>这些函数只在测试模式下编译。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>测试模式通过向 <code>rustc</code> 传递 <code>--test</code> 参数或使用 <code>cargo test</code> 启用。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.testing.test.success"><a class="rule-link" href="#r-attributes.testing.test.success" title="attributes.testing.test.success"><span>[attributes<wbr>.testing<wbr>.test<wbr>.success]</span></a>
</div>

<p>测试工具调用返回值的 <a href="../std/process/trait.Termination.html#tymethod.report"><code>report</code></a> 方法，并根据生成的 <a href="../std/process/struct.ExitCode.html"><code>ExitCode</code></a> 是否表示成功终止来将测试分类为通过或失败。
特别是：</p>
<ul>
<li>返回 <code>()</code> 的测试只要终止且不 恐慌 就通过。</li>
<li>返回 <code>Result&lt;(), E&gt;</code> 的测试只要返回 <code>Ok(())</code> 就通过。</li>
<li>返回 <code>ExitCode::SUCCESS</code> 的测试通过，返回 <code>ExitCode::FAILURE</code> 的测试失败。</li>
<li>不终止的测试既不通过也不失败。</li>
</ul>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use std::io;
</span><span class="boring">fn setup_the_thing() -&gt; io::Result&lt;i32&gt; { Ok(1) }
</span><span class="boring">fn do_the_thing(s: &amp;i32) -&gt; io::Result&lt;()&gt; { Ok(()) }
</span>#[test]
fn test_the_thing() -&gt; io::Result&lt;()&gt; {
    let state = setup_the_thing()?; // 预期成功
    do_the_thing(&amp;state)?;          // 预期成功
    Ok(())
}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<!-- template:attributes -->
<div class="rule" id="r-attributes.testing.ignore"><a class="rule-link" href="#r-attributes.testing.ignore" title="attributes.testing.ignore"><span>[attributes<wbr>.testing<wbr>.ignore]</span></a>
</div>

<h2 id="ignore-属性"><a class="header" href="#ignore-属性"><code>ignore</code> 属性</a></h2>
<div class="rule" id="r-attributes.testing.ignore.intro"><a class="rule-link" href="#r-attributes.testing.ignore.intro" title="attributes.testing.ignore.intro"><span>[attributes<wbr>.testing<wbr>.ignore<wbr>.intro]</span></a>
</div>

<p><em><code>ignore</code> <a href="#属性-1">属性</a></em> 可以与 <a href="#r-attributes.testing.test"><code>test</code> 属性</a> 一起使用，以告知测试工具不要将该函数作为测试执行。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[test]
#[ignore]
fn check_thing() {
    // ...
}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 测试工具支持 <code>--include-ignored</code> 标志来强制运行被忽略的测试。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.testing.ignore.syntax"><a class="rule-link" href="#r-attributes.testing.ignore.syntax" title="attributes.testing.ignore.syntax"><span>[attributes<wbr>.testing<wbr>.ignore<wbr>.syntax]</span></a>
</div>

<p><code>ignore</code> 属性使用 <a href="#grammar-MetaWord">元字</a> 和 <a href="#grammar-MetaNameValueStr">元名称值字符串</a> 语法格式。</p>
<div class="rule" id="r-attributes.testing.ignore.reason"><a class="rule-link" href="#r-attributes.testing.ignore.reason" title="attributes.testing.ignore.reason"><span>[attributes<wbr>.testing<wbr>.ignore<wbr>.reason]</span></a>
</div>

<p><code>ignore</code> 属性的 <a href="#grammar-MetaNameValueStr">元名称值字符串</a> 形式提供了一种方法来指定忽略测试的原因。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[test]
#[ignore = "not yet implemented"] // 尚未实现
fn mytest() {
    // ...
}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-attributes.testing.ignore.allowed-positions"><a class="rule-link" href="#r-attributes.testing.ignore.allowed-positions" title="attributes.testing.ignore.allowed-positions"><span>[attributes<wbr>.testing<wbr>.ignore<wbr>.allowed-positions]</span></a>
</div>

<p><code>ignore</code> 属性只能应用于带有 <code>test</code> 属性注解的函数。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 在其他位置的使用会被忽略，但会发出 lint 警告。这在将来可能会变为错误。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.testing.ignore.duplicates"><a class="rule-link" href="#r-attributes.testing.ignore.duplicates" title="attributes.testing.ignore.duplicates"><span>[attributes<wbr>.testing<wbr>.ignore<wbr>.duplicates]</span></a>
</div>

<p><code>ignore</code> 在函数上的第一次使用才有效。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 对第一次使用之后的任何使用都会发出 lint 警告。这在将来可能会变为错误。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.testing.ignore.behavior"><a class="rule-link" href="#r-attributes.testing.ignore.behavior" title="attributes.testing.ignore.behavior"><span>[attributes<wbr>.testing<wbr>.ignore<wbr>.behavior]</span></a>
</div>

<p>被忽略的测试在测试模式下仍然会被编译，但不会执行。</p>
<!-- template:attributes -->
<div class="rule" id="r-attributes.testing.should_panic"><a class="rule-link" href="#r-attributes.testing.should_panic" title="attributes.testing.should_panic"><span>[attributes<wbr>.testing<wbr>.should_panic]</span></a>
</div>

<h2 id="should_panic-属性"><a class="header" href="#should_panic-属性"><code>should_panic</code> 属性</a></h2>
<div class="rule" id="r-attributes.testing.should_panic.intro"><a class="rule-link" href="#r-attributes.testing.should_panic.intro" title="attributes.testing.should_panic.intro"><span>[attributes<wbr>.testing<wbr>.should_panic<wbr>.intro]</span></a>
</div>

<p><em><code>should_panic</code> <a href="#属性-1">属性</a></em> 会使测试仅在应用该属性的 <a href="#r-attributes.testing.test">测试函数</a> 发生 恐慌 时才通过。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[test]
#[should_panic(expected = "values don't match")] // 预期为“值不匹配”
fn mytest() {
    assert_eq!(1, 2, "values don't match"); // 值不匹配
}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-attributes.testing.should_panic.syntax"><a class="rule-link" href="#r-attributes.testing.should_panic.syntax" title="attributes.testing.should_panic.syntax"><span>[attributes<wbr>.testing<wbr>.should_panic<wbr>.syntax]</span></a>
</div>

<p><code>should_panic</code> 属性有以下形式：</p>
<ul>
<li>
<p><a href="#grammar-MetaWord">元字</a></p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[test]
#[should_panic]
fn mytest() { panic!("error: some message, and more"); } // 错误：一些消息，还有更多
<span class="boring">}</span></code></pre>
</blockquote>
</div>

</li>
<li>
<p><a href="#grammar-MetaNameValueStr">元名称值字符串</a> — 给定字符串必须出现在 恐慌 消息中，测试才能通过。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[test]
#[should_panic = "some message"] // 一些消息
fn mytest() { panic!("error: some message, and more"); } // 错误：一些消息，还有更多
<span class="boring">}</span></code></pre>
</blockquote>
</div>

</li>
<li>
<p><a href="#grammar-MetaListNameValueStr">元列表名称值字符串</a> — 与 <a href="#grammar-MetaNameValueStr">元名称值字符串</a> 语法格式 一样，给定字符串必须出现在 恐慌 消息中。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[test]
#[should_panic(expected = "some message")] // 预期为“一些消息”
fn mytest() { panic!("error: some message, and more"); } // 错误：一些消息，还有更多
<span class="boring">}</span></code></pre>
</blockquote>
</div>

</li>
</ul>
<div class="rule" id="r-attributes.testing.should_panic.allowed-positions"><a class="rule-link" href="#r-attributes.testing.should_panic.allowed-positions" title="attributes.testing.should_panic.allowed-positions"><span>[attributes<wbr>.testing<wbr>.should_panic<wbr>.allowed-positions]</span></a>
</div>

<p><code>should_panic</code> 属性只能应用于带有 <code>test</code> 属性注解的函数。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 在其他位置的使用会被忽略，但会发出 lint 警告。这在将来可能会变为错误。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.testing.should_panic.duplicates"><a class="rule-link" href="#r-attributes.testing.should_panic.duplicates" title="attributes.testing.should_panic.duplicates"><span>[attributes<wbr>.testing<wbr>.should_panic<wbr>.duplicates]</span></a>
</div>

<p><code>should_panic</code> 在函数上的第一次使用才有效。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 对第一次使用之后的任何使用都会发出未来兼容性警告。这在将来可能会变为错误。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.testing.should_panic.expected"><a class="rule-link" href="#r-attributes.testing.should_panic.expected" title="attributes.testing.should_panic.expected"><span>[attributes<wbr>.testing<wbr>.should_panic<wbr>.expected]</span></a>
</div>

<p>当使用 <a href="#grammar-MetaNameValueStr">元名称值字符串</a> 形式或带有 <code>expected</code> 键的 <a href="#grammar-MetaListNameValueStr">元列表名称值字符串</a> 形式时，给定字符串必须出现在 恐慌 消息中的某个位置，测试才能通过。</p>
<div class="rule" id="r-attributes.testing.should_panic.return"><a class="rule-link" href="#r-attributes.testing.should_panic.return" title="attributes.testing.should_panic.return"><span>[attributes<wbr>.testing<wbr>.should_panic<wbr>.return]</span></a>
</div>

<p>测试函数的返回类型必须是 <code>()</code>。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-attributes.derive"><a class="rule-link" href="#r-attributes.derive" title="attributes.derive"><span>[attributes<wbr>.derive]</span></a>
</div>

<h1 id="派生"><a class="header" href="#派生">派生</a></h1>
<div class="rule" id="r-attributes.derive.intro"><a class="rule-link" href="#r-attributes.derive.intro" title="attributes.derive.intro"><span>[attributes<wbr>.derive<wbr>.intro]</span></a>
</div>

<p><em><code>derive</code> <a href="#r-attributes">属性</a></em> 调用一个或多个 <a href="#r-macro.proc.derive">派生宏</a>，允许为数据结构自动生成新的 <a href="#项">项</a>。你可以使用 <a href="#r-macro.proc.derive">过程宏</a> 创建 <code>derive</code> 宏。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p><a href="../core/cmp/derive.PartialEq.html"><code>PartialEq</code></a> 派生宏 为 <code>Foo&lt;T&gt; where T: PartialEq</code> 发出一个 <a href="../core/cmp/trait.PartialEq.html"><code>PartialEq</code></a> 的 <a href="#实现">实现</a>。<a href="../core/clone/derive.Clone.html"><code>Clone</code></a> 派生宏 为 <a href="../core/clone/trait.Clone.html"><code>Clone</code></a> 也做同样的事情。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(PartialEq, Clone)]
struct Foo&lt;T&gt; {
    a: i32,
    b: T,
}
<span class="boring">}</span></code></pre>
<p>生成的 <code>impl</code> 项 等同于：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct Foo&lt;T&gt; { a: i32, b: T }
</span>impl&lt;T: PartialEq&gt; PartialEq for Foo&lt;T&gt; {
    fn eq(&amp;self, other: &amp;Foo&lt;T&gt;) -&gt; bool {
        self.a == other.a &amp;&amp; self.b == other.b
    }
}

impl&lt;T: Clone&gt; Clone for Foo&lt;T&gt; {
    fn clone(&amp;self) -&gt; Self {
        Foo { a: self.a.clone(), b: self.b.clone() }
    }
}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-attributes.derive.syntax"><a class="rule-link" href="#r-attributes.derive.syntax" title="attributes.derive.syntax"><span>[attributes<wbr>.derive<wbr>.syntax]</span></a>
</div>

<p><code>derive</code> 属性使用 <a href="#grammar-MetaListPaths">MetaListPaths</a> 语法格式 来指定要调用的 <a href="#r-macro.proc.derive">派生宏</a> 的路径列表。</p>
<div class="rule" id="r-attributes.derive.allowed-positions"><a class="rule-link" href="#r-attributes.derive.allowed-positions" title="attributes.derive.allowed-positions"><span>[attributes<wbr>.derive<wbr>.allowed-positions]</span></a>
</div>

<p><code>derive</code> 属性只能应用于 <a href="#r-items.struct">结构体</a>、<a href="#r-items.enum">枚举</a> 和 <a href="#r-items.union">联合体</a>。</p>
<div class="rule" id="r-attributes.derive.duplicates"><a class="rule-link" href="#r-attributes.derive.duplicates" title="attributes.derive.duplicates"><span>[attributes<wbr>.derive<wbr>.duplicates]</span></a>
</div>

<p><code>derive</code> 属性可以在一个 项 上使用任意次数。所有属性中列出的所有 派生宏 都会被调用。</p>
<div class="rule" id="r-attributes.derive.stdlib"><a class="rule-link" href="#r-attributes.derive.stdlib" title="attributes.derive.stdlib"><span>[attributes<wbr>.derive<wbr>.stdlib]</span></a>
</div>

<p><code>derive</code> 属性在标准库 预导入 中作为 <a href="../core/macros/builtin/attr.derive.html"><code>core::prelude::v1::derive</code></a> 导出。</p>
<div class="rule" id="r-attributes.derive.built-in"><a class="rule-link" href="#r-attributes.derive.built-in" title="attributes.derive.built-in"><span>[attributes<wbr>.derive<wbr>.built-in]</span></a>
</div>

<p>内置派生在 <a href="#r-names.preludes.lang">语言预导入</a> 中定义。内置派生的列表是：</p>
<ul>
<li><a href="../core/clone/trait.Clone.html"><code>Clone</code></a></li>
<li><a href="../core/marker/trait.Copy.html"><code>Copy</code></a></li>
<li><a href="../core/fmt/macros/derive.Debug.html"><code>Debug</code></a></li>
<li><a href="../core/default/trait.Default.html"><code>Default</code></a></li>
<li><a href="../core/cmp/trait.Eq.html"><code>Eq</code></a></li>
<li><a href="../core/hash/macros/derive.Hash.html"><code>Hash</code></a></li>
<li><a href="../core/cmp/trait.Ord.html"><code>Ord</code></a></li>
<li><a href="../core/cmp/trait.PartialEq.html"><code>PartialEq</code></a></li>
<li><a href="../core/cmp/trait.PartialOrd.html"><code>PartialOrd</code></a></li>
</ul>
<div class="rule" id="r-attributes.derive.built-in-automatically_derived"><a class="rule-link" href="#r-attributes.derive.built-in-automatically_derived" title="attributes.derive.built-in-automatically_derived"><span>[attributes<wbr>.derive<wbr>.built-in-automatically_derived]</span></a>
</div>

<p>内置派生在它们生成的 实现 上包含 <a href="#r-attributes.derive.automatically_derived"><code>automatically_derived</code> 属性</a>。</p>
<div class="rule" id="r-attributes.derive.behavior"><a class="rule-link" href="#r-attributes.derive.behavior" title="attributes.derive.behavior"><span>[attributes<wbr>.derive<wbr>.behavior]</span></a>
</div>

<p>在宏扩展期间，对于派生列表中的每个元素，相应的 派生宏 扩展为零个或多个 <a href="#项">项</a>。</p>
<!-- template:attributes -->
<div class="rule" id="r-attributes.derive.automatically_derived"><a class="rule-link" href="#r-attributes.derive.automatically_derived" title="attributes.derive.automatically_derived"><span>[attributes<wbr>.derive<wbr>.automatically_derived]</span></a>
</div>

<h2 id="automatically_derived-属性"><a class="header" href="#automatically_derived-属性"><code>automatically_derived</code> 属性</a></h2>
<div class="rule" id="r-attributes.derive.automatically_derived.intro"><a class="rule-link" href="#r-attributes.derive.automatically_derived.intro" title="attributes.derive.automatically_derived.intro"><span>[attributes<wbr>.derive<wbr>.automatically_derived<wbr>.intro]</span></a>
</div>

<p><em><code>automatically_derived</code> <a href="#r-attributes">属性</a></em> 用于注解一个 <a href="#实现">实现</a>，以表明它是由 <a href="#r-macro.proc.derive">派生宏</a> 自动创建的。它没有直接作用，但工具和诊断 lint 可能会用它来检测这些自动生成的 实现。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>给定 <code>struct Example</code> 上的 <a href="../core/clone/derive.Clone.html"><code>#[derive(Clone)]</code></a>，<a href="#r-macro.proc.derive">派生宏</a> 可能会生成：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct Example;
</span>#[automatically_derived]
impl ::core::clone::Clone for Example {
    #[inline]
    fn clone(&amp;self) -&gt; Self {
        Example
    }
}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-attributes.derive.automatically_derived.syntax"><a class="rule-link" href="#r-attributes.derive.automatically_derived.syntax" title="attributes.derive.automatically_derived.syntax"><span>[attributes<wbr>.derive<wbr>.automatically_derived<wbr>.syntax]</span></a>
</div>

<p><code>automatically_derived</code> 属性使用 <a href="#grammar-MetaWord">MetaWord</a> 语法格式。</p>
<div class="rule" id="r-attributes.derive.automatically_derived.allowed-positions"><a class="rule-link" href="#r-attributes.derive.automatically_derived.allowed-positions" title="attributes.derive.automatically_derived.allowed-positions"><span>[attributes<wbr>.derive<wbr>.automatically_derived<wbr>.allowed-positions]</span></a>
</div>

<p><code>automatically_derived</code> 属性只能应用于 <a href="#实现">实现</a>。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 在其他位置的使用会被忽略，但会发出 lint 警告。这在将来可能会变为错误。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.derive.automatically_derived.duplicates"><a class="rule-link" href="#r-attributes.derive.automatically_derived.duplicates" title="attributes.derive.automatically_derived.duplicates"><span>[attributes<wbr>.derive<wbr>.automatically_derived<wbr>.duplicates]</span></a>
</div>

<p>在一个 实现 上多次使用 <code>automatically_derived</code> 与使用一次效果相同。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 对第一次使用之后的任何使用都会发出 lint 警告。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.derive.automatically_derived.behavior"><a class="rule-link" href="#r-attributes.derive.automatically_derived.behavior" title="attributes.derive.automatically_derived.behavior"><span>[attributes<wbr>.derive<wbr>.automatically_derived<wbr>.behavior]</span></a>
</div>

<p><code>automatically_derived</code> 属性没有行为。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-attributes.diagnostics"><a class="rule-link" href="#r-attributes.diagnostics" title="attributes.diagnostics"><span>[attributes<wbr>.diagnostics]</span></a>
</div>

<h1 id="诊断属性"><a class="header" href="#诊断属性">诊断属性</a></h1>
<p>以下 <a href="#属性-1">属性</a> 用于在编译期间控制或生成诊断消息。</p>
<div class="rule" id="r-attributes.diagnostics.lint"><a class="rule-link" href="#r-attributes.diagnostics.lint" title="attributes.diagnostics.lint"><span>[attributes<wbr>.diagnostics<wbr>.lint]</span></a>
</div>

<h2 id="lint检查属性"><a class="header" href="#lint检查属性">Lint检查属性</a></h2>
<p>Lint 检查命名了一种可能不理想的编码模式，例如不可达代码或遗漏的文档。</p>
<div class="rule" id="r-attributes.diagnostics.lint.level"><a class="rule-link" href="#r-attributes.diagnostics.lint.level" title="attributes.diagnostics.lint.level"><span>[attributes<wbr>.diagnostics<wbr>.lint<wbr>.level]</span></a>
</div>

<p>lint 属性 <code>allow</code>、
<code>expect</code>、<code>warn</code>、<code>deny</code> 和 <code>forbid</code> 使用 <a href="#grammar-MetaListPaths">MetaListPaths</a> 语法格式
来指定 lint 名称列表，以更改属性所应用实体的 lint 级别。</p>
<p>对于任何 lint 检查 <code>C</code>：</p>
<div class="rule" id="r-attributes.diagnostics.lint.allow"><a class="rule-link" href="#r-attributes.diagnostics.lint.allow" title="attributes.diagnostics.lint.allow"><span>[attributes<wbr>.diagnostics<wbr>.lint<wbr>.allow]</span></a>
</div>

<ul>
<li><code>#[allow(C)]</code> 覆盖对 <code>C</code> 的检查，以便违规行为将不被报告。</li>
</ul>
<div class="rule" id="r-attributes.diagnostics.lint.expect"><a class="rule-link" href="#r-attributes.diagnostics.lint.expect" title="attributes.diagnostics.lint.expect"><span>[attributes<wbr>.diagnostics<wbr>.lint<wbr>.expect]</span></a>
</div>

<ul>
<li><code>#[expect(C)]</code> 表示预期会发出 lint <code>C</code>。如果预期未实现，则该属性将抑制 <code>C</code> 的发出或发出警告。</li>
</ul>
<div class="rule" id="r-attributes.diagnostics.lint.warn"><a class="rule-link" href="#r-attributes.diagnostics.lint.warn" title="attributes.diagnostics.lint.warn"><span>[attributes<wbr>.diagnostics<wbr>.lint<wbr>.warn]</span></a>
</div>

<ul>
<li><code>#[warn(C)]</code> 警告 <code>C</code> 的违规行为，但继续编译。</li>
</ul>
<div class="rule" id="r-attributes.diagnostics.lint.deny"><a class="rule-link" href="#r-attributes.diagnostics.lint.deny" title="attributes.diagnostics.lint.deny"><span>[attributes<wbr>.diagnostics<wbr>.lint<wbr>.deny]</span></a>
</div>

<ul>
<li><code>#[deny(C)]</code> 在遇到 <code>C</code> 的违规行为后发出错误信号，</li>
</ul>
<div class="rule" id="r-attributes.diagnostics.lint.forbid"><a class="rule-link" href="#r-attributes.diagnostics.lint.forbid" title="attributes.diagnostics.lint.forbid"><span>[attributes<wbr>.diagnostics<wbr>.lint<wbr>.forbid]</span></a>
</div>

<ul>
<li><code>#[forbid(C)]</code> 与 <code>deny(C)</code> 相同，但事后也禁止更改 lint 级别，</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>通过 <code>rustc -W help</code> 可以找到 <code>rustc</code> 支持的 lint 检查，以及它们的默认设置，并记录在 <a href="https://doc.rust-lang.org/rustc/lints/index.html">rustc book</a> 中。</p>
</blockquote>
</div>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub mod m1 {
    // 此处忽略缺少文档
    #[allow(missing_docs)]
    pub fn undocumented_one() -&gt; i32 { 1 }

    // 此处缺少文档会发出警告
    #[warn(missing_docs)]
    pub fn undocumented_too() -&gt; i32 { 2 }

    // 此处缺少文档会发出错误
    #[deny(missing_docs)]
    pub fn undocumented_end() -&gt; i32 { 3 }
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-attributes.diagnostics.lint.override"><a class="rule-link" href="#r-attributes.diagnostics.lint.override" title="attributes.diagnostics.lint.override"><span>[attributes<wbr>.diagnostics<wbr>.lint<wbr>.override]</span></a>
</div>

<p>lint 属性可以覆盖先前属性指定的级别，只要该级别不尝试更改被禁止的 lint
（除了 <code>deny</code>，它在 <code>forbid</code> 上下文中是允许的，但会被忽略）。
先前的属性是指在语法树中更高级别的属性，或在同一实体上按从左到右源代码顺序列出的先前属性。</p>
<p>此示例展示了如何使用 <code>allow</code> 和 <code>warn</code> 来开启和关闭特定检查：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[warn(missing_docs)]
pub mod m2 {
    #[allow(missing_docs)]
    pub mod nested {
        // 此处忽略缺少文档
        pub fn undocumented_one() -&gt; i32 { 1 }

        // 此处缺少文档会发出警告，
        // 尽管上面有 allow。
        #[warn(missing_docs)]
        pub fn undocumented_two() -&gt; i32 { 2 }
    }

    // 此处缺少文档会发出警告
    pub fn undocumented_too() -&gt; i32 { 3 }
}
<span class="boring">}</span></code></pre>
<p>此示例展示了如何使用 <code>forbid</code> 来禁止对该 lint 检查使用 <code>allow</code> 或 <code>expect</code>：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[forbid(missing_docs)]
pub mod m3 {
    // 尝试切换警告在此处发出错误
    #[allow(missing_docs)]
    /// 返回 2。
    pub fn undocumented_too() -&gt; i32 { 2 }
}
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 允许在 <a href="https://doc.rust-lang.org/rustc/lints/levels.html#via-compiler-flag">命令行</a> 上设置 lint 级别，并且还支持对报告的 lint <a href="https://doc.rust-lang.org/rustc/lints/levels.html#capping-lints">设置上限</a>。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.diagnostics.lint.reason"><a class="rule-link" href="#r-attributes.diagnostics.lint.reason" title="attributes.diagnostics.lint.reason"><span>[attributes<wbr>.diagnostics<wbr>.lint<wbr>.reason]</span></a>
</div>

<h3 id="lint原因"><a class="header" href="#lint原因">Lint原因</a></h3>
<p>所有 lint 属性都支持一个额外的 <code>reason</code> 参数，以提供添加某个属性的上下文。如果 lint 在定义的级别发出，此原因将作为 lint 消息的一部分显示。</p>
<pre class="playground"><code class="language-rust edition2015 compile_fail"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// `keyword_idents` 默认是允许的。此处我们禁止它以
// 避免在更新 版次 时标识符的迁移。
#![deny(
    keyword_idents,
    reason = "we want to avoid these idents to be future compatible"
)]

// 此名称在 Rust 的 2015 版次 中是允许的。我们仍然旨在避免
// 这以便未来兼容并且不混淆最终用户。
fn dyn() {}
<span class="boring">}</span></code></pre>
<p>这是另一个示例，其中 lint 被允许并带有原因：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::path::PathBuf;

pub fn get_path() -&gt; PathBuf {
    // `allow` 属性上的 `reason` 参数作为读者的文档。
    #[allow(unused_mut, reason = "this is only modified on some platforms")]
    let mut file_name = PathBuf::from("git");

    #[cfg(target_os = "windows")]
    file_name.set_extension("exe");

    file_name
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-attributes.diagnostics.expect"><a class="rule-link" href="#r-attributes.diagnostics.expect" title="attributes.diagnostics.expect"><span>[attributes<wbr>.diagnostics<wbr>.expect]</span></a>
</div>

<h3 id="expect属性"><a class="header" href="#expect属性"><code>#[expect]</code>属性</a></h3>
<div class="rule" id="r-attributes.diagnostics.expect.intro"><a class="rule-link" href="#r-attributes.diagnostics.expect.intro" title="attributes.diagnostics.expect.intro"><span>[attributes<wbr>.diagnostics<wbr>.expect<wbr>.intro]</span></a>
</div>

<p><code>#[expect(C)]</code> 属性为 lint <code>C</code> 创建一个 lint 预期。如果同一位置的 <code>#[warn(C)]</code> 属性会导致 lint 发出，则该预期将被实现。如果预期未实现，因为 lint <code>C</code> 不会发出，则将在该属性处发出 <code>unfulfilled_lint_expectations</code> lint。</p>
<pre class="playground"><code class="language-rust edition2024">fn main() {
    // 这个 `#[expect]` 属性创建了一个 lint 预期，即 `unused_variables`
    // lint 将由以下语句发出。由于 `question` 变量被 `println!` 宏使用，
    // 因此此预期未实现。
    // 因此，`unfulfilled_lint_expectations` lint 将在此属性处发出。
    #[expect(unused_variables)]
    let question = "who lives in a pineapple under the sea?";
    println!("{question}");

    // 这个 `#[expect]` 属性创建了一个 lint 预期，它将被实现，因为
    // `answer` 变量从未被使用。通常会发出的 `unused_variables` lint 被抑制。
    // 不会为语句或属性发出警告。
    #[expect(unused_variables)]
    let answer = "SpongeBob SquarePants!";
}</code></pre>
<div class="rule" id="r-attributes.diagnostics.expect.fulfillment"><a class="rule-link" href="#r-attributes.diagnostics.expect.fulfillment" title="attributes.diagnostics.expect.fulfillment"><span>[attributes<wbr>.diagnostics<wbr>.expect<wbr>.fulfillment]</span></a>
</div>

<p>lint 预期仅由被 <code>expect</code> 属性抑制的 lint 发出所实现。如果在作用域中使用 <code>allow</code> 或 <code>warn</code> 等其他级别属性修改了 lint 级别，则 lint 发出将相应处理，并且预期将保持未实现状态。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[expect(unused_variables)]
fn select_song() {
    // 这将按 `warn` 属性定义发出 `unused_variables` lint 的警告级别。
    // 这不会实现函数上方的预期。
    #[warn(unused_variables)]
    let song_name = "Crab Rave";

    // `allow` 属性抑制了 lint 发出。这不会实现预期，
    // 因为它已被 `allow` 属性抑制，而不是函数上方的 `expect` 属性。
    #[allow(unused_variables)]
    let song_creator = "Noisestorm";

    // 这个 `expect` 属性将抑制变量处的 `unused_variables` lint 发出。
    // 函数上方的 `expect` 属性仍然不会被实现，因为此 lint 发出已被本地
    // expect 属性抑制。
    #[expect(unused_variables)]
    let song_version = "Monstercat Release";
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-attributes.diagnostics.expect.independent"><a class="rule-link" href="#r-attributes.diagnostics.expect.independent" title="attributes.diagnostics.expect.independent"><span>[attributes<wbr>.diagnostics<wbr>.expect<wbr>.independent]</span></a>
</div>

<p>如果 <code>expect</code> 属性包含多个 lint，则每个 lint 都单独预期。对于 lint 组，只要组内有一个 lint 被发出就足够了：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 这个预期将被函数内未使用的值实现，
// 因为发出的 `unused_variables` lint 在 `unused` lint 组内。
#[expect(unused)]
pub fn thoughts() {
    let unused = "I'm running out of examples";
}

pub fn another_example() {
    // 此属性创建两个 lint 预期。`unused_mut` lint 将被抑制，
    // 从而实现第一个预期。`unused_variables` 不会发出，因为变量已被使用。
    // 因此，该预期将未实现，并会发出警告。
    #[expect(unused_mut, unused_variables)]
    let mut link = "https://www.rust-lang.org/";

    println!("Welcome to our community: {link}");
}
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>#[expect(unfulfilled_lint_expectations)]</code> 的行为目前定义为始终生成 <code>unfulfilled_lint_expectations</code> lint。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.diagnostics.lint.group"><a class="rule-link" href="#r-attributes.diagnostics.lint.group" title="attributes.diagnostics.lint.group"><span>[attributes<wbr>.diagnostics<wbr>.lint<wbr>.group]</span></a>
</div>

<h3 id="lint组"><a class="header" href="#lint组">Lint组</a></h3>
<p>Lint 可以组织成命名组，以便可以一起调整相关 lint 的级别。使用命名组等同于列出该组内的 lint。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 这允许“unused”组中的所有 lint。
#[allow(unused)]
// 这将“unused”组中的“unused_must_use”lint 覆盖为 deny。
#[deny(unused_must_use)]
fn example() {
    // 这不会生成警告，因为“unused_variables”
    // lint 在“unused”组中。
    let x = 1;
    // 这会生成错误，因为结果未使用，并且
    // “unused_must_use”被标记为“deny”。
    std::fs::remove_file("some_file"); // 错误：必须使用的未使用的 `Result`
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-attributes.diagnostics.lint.group.warnings"><a class="rule-link" href="#r-attributes.diagnostics.lint.group.warnings" title="attributes.diagnostics.lint.group.warnings"><span>[attributes<wbr>.diagnostics<wbr>.lint<wbr>.group<wbr>.warnings]</span></a>
</div>

<p>有一个名为“warnings”的特殊组，它包含所有警告级别的 lint。 “warnings”组忽略属性顺序，并应用于实体内所有本应发出警告的 lint。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">unsafe fn an_unsafe_fn() {}
</span>// 这两个属性的顺序无关紧要。
#[deny(warnings)]
// `unsafe_code` lint  normally "allow" by default.
#[warn(unsafe_code)]
fn example_err() {
    // 这是一个错误，因为 `unsafe_code` 警告已
    // 提升为“deny”。
    unsafe { an_unsafe_fn() } // 错误：使用了 `unsafe` 块
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-attributes.diagnostics.lint.tool"><a class="rule-link" href="#r-attributes.diagnostics.lint.tool" title="attributes.diagnostics.lint.tool"><span>[attributes<wbr>.diagnostics<wbr>.lint<wbr>.tool]</span></a>
</div>

<h3 id="工具lint属性"><a class="header" href="#工具lint属性">工具lint属性</a></h3>
<div class="rule" id="r-attributes.diagnostics.lint.tool.intro"><a class="rule-link" href="#r-attributes.diagnostics.lint.tool.intro" title="attributes.diagnostics.lint.tool.intro"><span>[attributes<wbr>.diagnostics<wbr>.lint<wbr>.tool<wbr>.intro]</span></a>
</div>

<p>工具 lint 允许使用作用域 lint，以 <code>allow</code>、<code>warn</code>、<code>deny</code> 或 <code>forbid</code>
某些工具的 lint。</p>
<div class="rule" id="r-attributes.diagnostics.lint.tool.activation"><a class="rule-link" href="#r-attributes.diagnostics.lint.tool.activation" title="attributes.diagnostics.lint.tool.activation"><span>[attributes<wbr>.diagnostics<wbr>.lint<wbr>.tool<wbr>.activation]</span></a>
</div>

<p>工具 lint 仅在相关工具处于活动状态时才会被检查。如果像 <code>allow</code> 这样的 lint 属性引用了不存在的工具 lint，编译器在您使用该工具之前不会警告不存在的 lint。</p>
<p>否则，它们的工作方式与常规 lint 属性相同：</p>
<pre class="playground"><code class="language-rust edition2024">// set the entire `pedantic` clippy lint group to warn
#![warn(clippy::pedantic)]
// silence warnings from the `filter_map` clippy lint
#![allow(clippy::filter_map)]

fn main() {
    // ...
}

// silence the `cmp_nan` clippy lint just for this function
#[allow(clippy::cmp_nan)]
fn foo() {
    // ...
}</code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 目前识别 “<a href="https://github.com/rust-lang/rust-clippy">clippy</a>” 和 “<a href="../rustdoc/lints.html">rustdoc</a>” 的工具 lint。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.diagnostics.deprecated"><a class="rule-link" href="#r-attributes.diagnostics.deprecated" title="attributes.diagnostics.deprecated"><span>[attributes<wbr>.diagnostics<wbr>.deprecated]</span></a>
</div>

<h2 id="deprecated属性"><a class="header" href="#deprecated属性"><code>deprecated</code>属性</a></h2>
<div class="rule" id="r-attributes.diagnostics.deprecated.intro"><a class="rule-link" href="#r-attributes.diagnostics.deprecated.intro" title="attributes.diagnostics.deprecated.intro"><span>[attributes<wbr>.diagnostics<wbr>.deprecated<wbr>.intro]</span></a>
</div>

<p><em><code>deprecated</code> 属性</em> 将一个 项 标记为已弃用。<code>rustc</code> 将在使用 <code>#[deprecated]</code> 项 时发出警告。<code>rustdoc</code> 将显示 项 弃用信息，包括 <code>since</code> 版本和 <code>note</code>（如果可用）。</p>
<div class="rule" id="r-attributes.diagnostics.deprecated.syntax"><a class="rule-link" href="#r-attributes.diagnostics.deprecated.syntax" title="attributes.diagnostics.deprecated.syntax"><span>[attributes<wbr>.diagnostics<wbr>.deprecated<wbr>.syntax]</span></a>
</div>

<p><code>deprecated</code> 属性有几种形式：</p>
<ul>
<li><code>deprecated</code> — 发出通用消息。</li>
<li><code>deprecated = "message"</code> — 在弃用消息中包含给定的字符串。</li>
<li><a href="#grammar-MetaListNameValueStr">MetaListNameValueStr</a> 语法格式，带有两个可选字段：
<ul>
<li><code>since</code> — 指定 项 被弃用时的版本号。<code>rustc</code> 目前不解释该字符串，但 <a href="https://github.com/rust-lang/rust-clippy">Clippy</a> 等外部工具可能会检查该值的有效性。</li>
<li><code>note</code> — 指定应包含在弃用消息中的字符串。这通常用于提供有关弃用的解释和首选替代方案。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-attributes.diagnostic.deprecated.allowed-positions"><a class="rule-link" href="#r-attributes.diagnostic.deprecated.allowed-positions" title="attributes.diagnostic.deprecated.allowed-positions"><span>[attributes<wbr>.diagnostic<wbr>.deprecated<wbr>.allowed-positions]</span></a>
</div>

<p><code>deprecated</code> 属性可以应用于任何 <a href="#项">项</a>、<a href="#特型">特型项</a>、<a href="#枚举">枚举变体</a>、<a href="#结构体">结构体字段</a>、<a href="#外部块">外部块项</a> 或 <a href="#声明宏">宏定义</a>。它不能应用于 <a href="#特型实现">特型实现项</a>。当应用于包含其他 项 的 项 （例如 <a href="#模块">模块</a> 或 <a href="#实现">实现</a>）时，所有子 项 都继承弃用属性。</p>
<p>这里有一个例子：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[deprecated(since = "5.2.0", note = "foo was rarely used. Users should instead use bar")]
pub fn foo() {}

pub fn bar() {}
<span class="boring">}</span></code></pre>
<p><a href="https://github.com/rust-lang/rfcs/blob/master/text/1270-deprecation.md">RFC</a> 包含了动机和更多细节。</p>
<div class="rule" id="r-attributes.diagnostics.must_use"><a class="rule-link" href="#r-attributes.diagnostics.must_use" title="attributes.diagnostics.must_use"><span>[attributes<wbr>.diagnostics<wbr>.must_use]</span></a>
</div>

<h2 id="must_use属性"><a class="header" href="#must_use属性"><code>must_use</code>属性</a></h2>
<div class="rule" id="r-attributes.diagnostics.must_use.intro"><a class="rule-link" href="#r-attributes.diagnostics.must_use.intro" title="attributes.diagnostics.must_use.intro"><span>[attributes<wbr>.diagnostics<wbr>.must_use<wbr>.intro]</span></a>
</div>

<p><em><code>must_use</code> 属性</em> 用于在值未“使用”时发出诊断警告。</p>
<div class="rule" id="r-attributes.diagnostics.must_use.allowed-positions"><a class="rule-link" href="#r-attributes.diagnostics.must_use.allowed-positions" title="attributes.diagnostics.must_use.allowed-positions"><span>[attributes<wbr>.diagnostics<wbr>.must_use<wbr>.allowed-positions]</span></a>
</div>

<p><code>must_use</code> 属性可以应用于用户定义的复合类型（<a href="#结构体"><code>结构体</code></a>、<a href="#枚举"><code>枚举</code></a> 和 <a href="#联合体"><code>联合体</code></a>）、<a href="#函数">函数</a> 和 <a href="#特型">特型</a>。</p>
<div class="rule" id="r-attributes.diagnostics.must_use.message"><a class="rule-link" href="#r-attributes.diagnostics.must_use.message" title="attributes.diagnostics.must_use.message"><span>[attributes<wbr>.diagnostics<wbr>.must_use<wbr>.message]</span></a>
</div>

<p><code>must_use</code> 属性可以使用 <a href="#grammar-MetaNameValueStr">MetaNameValueStr</a> 语法格式 包含一条消息，例如 <code>#[must_use = "example message"]</code>。该消息将与警告一起给出。</p>
<div class="rule" id="r-attributes.diagnostics.must_use.type"><a class="rule-link" href="#r-attributes.diagnostics.must_use.type" title="attributes.diagnostics.must_use.type"><span>[attributes<wbr>.diagnostics<wbr>.must_use<wbr>.type]</span></a>
</div>

<p>当用于用户定义的复合类型时，如果 <a href="#表达式语句">表达式语句</a> 的 <a href="#表达式">表达式</a> 具有该类型，则 <code>unused_must_use</code> lint 被违反。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[must_use]
struct MustUse {
    // 一些字段
}

<span class="boring">impl MustUse {
</span><span class="boring">  fn new() -&gt; MustUse { MustUse {} }
</span><span class="boring">}
</span><span class="boring">
</span>// 违反 `unused_must_use` lint。
MustUse::new();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-attributes.diagnostics.must_use.fn"><a class="rule-link" href="#r-attributes.diagnostics.must_use.fn" title="attributes.diagnostics.must_use.fn"><span>[attributes<wbr>.diagnostics<wbr>.must_use<wbr>.fn]</span></a>
</div>

<p>当用于函数时，如果 <a href="#表达式语句">表达式语句</a> 的 <a href="#表达式">表达式</a> 是对该函数的 <a href="#调用表达式">调用表达式</a>，则 <code>unused_must_use</code> lint 被违反。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[must_use]
fn five() -&gt; i32 { 5i32 }

// 违反 `unused_must_use` lint。
five();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-attributes.diagnostics.must_use.trait"><a class="rule-link" href="#r-attributes.diagnostics.must_use.trait" title="attributes.diagnostics.must_use.trait"><span>[attributes<wbr>.diagnostics<wbr>.must_use<wbr>.trait]</span></a>
</div>

<p>当用于 <a href="#特型">特型声明</a> 时，如果 <a href="#表达式语句">表达式语句</a> 对一个返回该 特型 的 <a href="#impl-trait">impl trait</a> 或 <a href="#特型对象">dyn trait</a> 的函数的 <a href="#调用表达式">调用表达式</a> 被未使用，则违反 <code>unused_must_use</code> lint。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[must_use]
trait Critical {}
impl Critical for i32 {}

fn get_critical() -&gt; impl Critical {
    4i32
}

// 违反 `unused_must_use` lint。
get_critical();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-attributes.diagnostics.must_use.trait-function"><a class="rule-link" href="#r-attributes.diagnostics.must_use.trait-function" title="attributes.diagnostics.must_use.trait-function"><span>[attributes<wbr>.diagnostics<wbr>.must_use<wbr>.trait-function]</span></a>
</div>

<p>当用于 特型 声明中的函数时，当调用表达式是 特型 实现中的函数时，该行为也适用。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Trait {
    #[must_use]
    fn use_me(&amp;self) -&gt; i32;
}

impl Trait for i32 {
    fn use_me(&amp;self) -&gt; i32 { 0i32 }
}

// 违反 `unused_must_use` lint。
5i32.use_me();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-attributes.diagnostics.must_use.trait-impl-function"><a class="rule-link" href="#r-attributes.diagnostics.must_use.trait-impl-function" title="attributes.diagnostics.must_use.trait-impl-function"><span>[attributes<wbr>.diagnostics<wbr>.must_use<wbr>.trait-impl-function]</span></a>
</div>

<p>当用于 特型 实现中的函数时，该属性不执行任何操作。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>包含该值的普通无操作表达式不会违反 lint。示例包括将值包装在一个不实现 <a href="#drop"><code>Drop</code></a> 的类型中然后不使用该类型，以及作为未使用的 <a href="#块表达式">块表达式</a> 的最终表达式。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[must_use]
fn five() -&gt; i32 { 5i32 }

// 这些都不会违反 `unused_must_use` lint。
(five(),);
Some(five());
{ five() };
if true { five() } else { 0i32 };
match true {
    _ =&gt; five()
};
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>当有意丢弃一个必须使用的值时，习惯上使用带有 <code>_</code> 模式的 <a href="#let语句">let 语句</a>。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[must_use]
fn five() -&gt; i32 { 5i32 }

// 不违反 `unused_must_use` lint。
let _ = five();
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-attributes.diagnostic.namespace"><a class="rule-link" href="#r-attributes.diagnostic.namespace" title="attributes.diagnostic.namespace"><span>[attributes<wbr>.diagnostic<wbr>.namespace]</span></a>
</div>

<h2 id="diagnostic工具属性命名空间"><a class="header" href="#diagnostic工具属性命名空间"><code>diagnostic</code>工具属性命名空间</a></h2>
<div class="rule" id="r-attributes.diagnostic.namespace.intro"><a class="rule-link" href="#r-attributes.diagnostic.namespace.intro" title="attributes.diagnostic.namespace.intro"><span>[attributes<wbr>.diagnostic<wbr>.namespace<wbr>.intro]</span></a>
</div>

<p><code>#[diagnostic]</code> 属性命名空间是用于影响编译时错误消息的属性的归属。这些属性提供的提示不保证会被使用。</p>
<div class="rule" id="r-attributes.diagnostic.namespace.unknown-invalid-syntax"><a class="rule-link" href="#r-attributes.diagnostic.namespace.unknown-invalid-syntax" title="attributes.diagnostic.namespace.unknown-invalid-syntax"><span>[attributes<wbr>.diagnostic<wbr>.namespace<wbr>.unknown-invalid-syntax]</span></a>
</div>

<p>此命名空间中未知的属性会被接受，尽管它们可能会为未使用的属性发出警告。此外，已知属性的无效输入通常会是警告（详见属性定义）。这旨在允许将来添加或丢弃属性和更改输入，从而允许更改而无需保持无意义的属性或选项继续工作。</p>
<div class="rule" id="r-attributes.diagnostic.on_unimplemented"><a class="rule-link" href="#r-attributes.diagnostic.on_unimplemented" title="attributes.diagnostic.on_unimplemented"><span>[attributes<wbr>.diagnostic<wbr>.on_unimplemented]</span></a>
</div>

<h3 id="diagnosticon_unimplemented属性"><a class="header" href="#diagnosticon_unimplemented属性"><code>diagnostic::on_unimplemented</code>属性</a></h3>
<div class="rule" id="r-attributes.diagnostic.on_unimplemented.intro"><a class="rule-link" href="#r-attributes.diagnostic.on_unimplemented.intro" title="attributes.diagnostic.on_unimplemented.intro"><span>[attributes<wbr>.diagnostic<wbr>.on_unimplemented<wbr>.intro]</span></a>
</div>

<p><code>#[diagnostic::on_unimplemented]</code> 属性是给编译器的一个提示，用于补充在需要 特型 但类型上未实现 特型 的情况下通常会生成的错误消息。</p>
<div class="rule" id="r-attributes.diagnostic.on_unimplemented.allowed-positions"><a class="rule-link" href="#r-attributes.diagnostic.on_unimplemented.allowed-positions" title="attributes.diagnostic.on_unimplemented.allowed-positions"><span>[attributes<wbr>.diagnostic<wbr>.on_unimplemented<wbr>.allowed-positions]</span></a>
</div>

<p>该属性应放置在 <a href="#特型">特型声明</a> 上，尽管放置在其他位置不是错误。</p>
<div class="rule" id="r-attributes.diagnostic.on_unimplemented.syntax"><a class="rule-link" href="#r-attributes.diagnostic.on_unimplemented.syntax" title="attributes.diagnostic.on_unimplemented.syntax"><span>[attributes<wbr>.diagnostic<wbr>.on_unimplemented<wbr>.syntax]</span></a>
</div>

<p>该属性使用 <a href="#grammar-MetaListNameValueStr">MetaListNameValueStr</a> 语法格式 来指定其输入，尽管任何格式错误的属性输入都不被视为错误，以提供向前和向后兼容性。</p>
<div class="rule" id="r-attributes.diagnostic.on_unimplemented.keys"><a class="rule-link" href="#r-attributes.diagnostic.on_unimplemented.keys" title="attributes.diagnostic.on_unimplemented.keys"><span>[attributes<wbr>.diagnostic<wbr>.on_unimplemented<wbr>.keys]</span></a>
</div>

<p>以下键具有给定含义：</p>
<ul>
<li><code>message</code> — 顶级错误消息的文本。</li>
<li><code>label</code> — 错误消息中损坏代码内联显示的标签文本。</li>
<li><code>note</code> — 提供额外备注。</li>
</ul>
<div class="rule" id="r-attributes.diagnostic.on_unimplemented.note-repetition"><a class="rule-link" href="#r-attributes.diagnostic.on_unimplemented.note-repetition" title="attributes.diagnostic.on_unimplemented.note-repetition"><span>[attributes<wbr>.diagnostic<wbr>.on_unimplemented<wbr>.note-repetition]</span></a>
</div>

<p><code>note</code> 选项可以出现多次，这将导致发出多条备注消息。</p>
<div class="rule" id="r-attributes.diagnostic.on_unimplemented.repetition"><a class="rule-link" href="#r-attributes.diagnostic.on_unimplemented.repetition" title="attributes.diagnostic.on_unimplemented.repetition"><span>[attributes<wbr>.diagnostic<wbr>.on_unimplemented<wbr>.repetition]</span></a>
</div>

<p>如果其他选项中的任何一个出现多次，则相关选项的第一次出现指定实际使用的值。随后的出现会生成警告。</p>
<div class="rule" id="r-attributes.diagnostic.on_unimplemented.unknown-keys"><a class="rule-link" href="#r-attributes.diagnostic.on_unimplemented.unknown-keys" title="attributes.diagnostic.on_unimplemented.unknown-keys"><span>[attributes<wbr>.diagnostic<wbr>.on_unimplemented<wbr>.unknown-keys]</span></a>
</div>

<p>任何未知键都会生成警告。</p>
<div class="rule" id="r-attributes.diagnostic.on_unimplemented.format-string"><a class="rule-link" href="#r-attributes.diagnostic.on_unimplemented.format-string" title="attributes.diagnostic.on_unimplemented.format-string"><span>[attributes<wbr>.diagnostic<wbr>.on_unimplemented<wbr>.format-string]</span></a>
</div>

<p>所有三个选项都接受一个字符串作为参数，使用与 <a href="../alloc/fmt/index.html"><code>std::fmt</code></a> 字符串相同的格式进行解释。</p>
<div class="rule" id="r-attributes.diagnostic.on_unimplemented.format-parameters"><a class="rule-link" href="#r-attributes.diagnostic.on_unimplemented.format-parameters" title="attributes.diagnostic.on_unimplemented.format-parameters"><span>[attributes<wbr>.diagnostic<wbr>.on_unimplemented<wbr>.format-parameters]</span></a>
</div>

<p>带有给定命名参数的格式参数将被以下文本替换：</p>
<ul>
<li><code>{Self}</code> — 实现 特型 的类型名称。</li>
<li><code>{</code> <em>GenericParameterName</em> <code>}</code> — 给定 泛型 参数的 泛型 参数的类型名称。</li>
</ul>
<div class="rule" id="r-attributes.diagnostic.on_unimplemented.invalid-formats"><a class="rule-link" href="#r-attributes.diagnostic.on_unimplemented.invalid-formats" title="attributes.diagnostic.on_unimplemented.invalid-formats"><span>[attributes<wbr>.diagnostic<wbr>.on_unimplemented<wbr>.invalid-formats]</span></a>
</div>

<p>任何其他格式参数都会生成警告，但除此之外，将按原样包含在字符串中。</p>
<div class="rule" id="r-attributes.diagnostic.on_unimplemented.invalid-string"><a class="rule-link" href="#r-attributes.diagnostic.on_unimplemented.invalid-string" title="attributes.diagnostic.on_unimplemented.invalid-string"><span>[attributes<wbr>.diagnostic<wbr>.on_unimplemented<wbr>.invalid-string]</span></a>
</div>

<p>无效格式字符串可能会生成警告，但除此之外是允许的，但可能不会按预期显示。格式说明符可能会生成警告，但除此之外会被忽略。</p>
<p>在此示例中：</p>
<pre class="playground"><code class="language-rust compile_fail E0277 edition2024">#[diagnostic::on_unimplemented(
    message = "My Message for `ImportantTrait&lt;{A}&gt;` implemented for `{Self}`",
    label = "My Label",
    note = "Note 1",
    note = "Note 2"
)]
trait ImportantTrait&lt;A&gt; {}

fn use_my_trait(_: impl ImportantTrait&lt;i32&gt;) {}

fn main() {
    use_my_trait(String::new());
}</code></pre>
<p>编译器可能会生成一个看起来像这样的错误消息：</p>
<pre><code class="language-text">error[E0277]: My Message for `ImportantTrait&lt;i32&gt;` implemented for `String`
  --&gt; src/main.rs:14:18
   |
14 |     use_my_trait(String::new());
   |     ------------ ^^^^^^^^^^^^^ My Label
   |     |
   |     required by a bound introduced by this call
   |
   = help: the trait `ImportantTrait&lt;i32&gt;` is not implemented for `String`
   = note: Note 1
   = note: Note 2
</code></pre>
<div class="rule" id="r-attributes.diagnostic.do_not_recommend"><a class="rule-link" href="#r-attributes.diagnostic.do_not_recommend" title="attributes.diagnostic.do_not_recommend"><span>[attributes<wbr>.diagnostic<wbr>.do_not_recommend]</span></a>
</div>

<h3 id="diagnosticdo_not_recommend属性"><a class="header" href="#diagnosticdo_not_recommend属性"><code>diagnostic::do_not_recommend</code>属性</a></h3>
<div class="rule" id="r-attributes.diagnostic.do_not_recommend.intro"><a class="rule-link" href="#r-attributes.diagnostic.do_not_recommend.intro" title="attributes.diagnostic.do_not_recommend.intro"><span>[attributes<wbr>.diagnostic<wbr>.do_not_recommend<wbr>.intro]</span></a>
</div>

<p><code>#[diagnostic::do_not_recommend]</code> 属性是给编译器的一个提示，指示它不要在诊断消息中显示带注解的 特型 实现。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>如果你知道该推荐通常对程序员没有用处，那么抑制该推荐可能会很有用。这种情况经常发生在广泛的、包罗万象的 impl 上。该推荐可能会将程序员引入歧途，或者 特型 实现可能是你不希望公开的内部细节，或者程序员可能无法满足其边界。</p>
<p>例如，在关于某个类型未实现所需 特型 的错误消息中，编译器可能会找到一个 特型 实现，如果不是因为 特型 实现中的特定边界，该实现将满足要求。编译器可能会告诉用户存在一个 impl，但问题在于 特型 实现中的边界。<code>#[diagnostic::do_not_recommend]</code> 属性可以用来告诉编译器 <em>不要</em> 告诉用户该 特型 实现，而是简单地告诉用户该类型未实现所需的 特型。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.diagnostic.do_not_recommend.allowed-positions"><a class="rule-link" href="#r-attributes.diagnostic.do_not_recommend.allowed-positions" title="attributes.diagnostic.do_not_recommend.allowed-positions"><span>[attributes<wbr>.diagnostic<wbr>.do_not_recommend<wbr>.allowed-positions]</span></a>
</div>

<p>该属性应放置在 <a href="#特型实现">特型实现项</a> 上，尽管放置在其他位置不是错误。</p>
<div class="rule" id="r-attributes.diagnostic.do_not_recommend.syntax"><a class="rule-link" href="#r-attributes.diagnostic.do_not_recommend.syntax" title="attributes.diagnostic.do_not_recommend.syntax"><span>[attributes<wbr>.diagnostic<wbr>.do_not_recommend<wbr>.syntax]</span></a>
</div>

<p>该属性不接受任何参数，尽管意外参数不被视为错误。</p>
<p>在以下示例中，有一个名为 <code>AsExpression</code> 的 特型，它用于将任意类型转换为 SQL 库中使用的 <code>Expression</code> 类型。有一个名为 <code>check</code> 的方法，它接受一个 <code>AsExpression</code>。</p>
<pre class="playground"><code class="language-rust compile_fail E0277 edition2024"><span class="boring">pub trait Expression {
</span><span class="boring">    type SqlType;
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub trait AsExpression&lt;ST&gt; {
</span><span class="boring">    type Expression: Expression&lt;SqlType = ST&gt;;
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub struct Text;
</span><span class="boring">pub struct Integer;
</span><span class="boring">
</span><span class="boring">pub struct Bound&lt;T&gt;(T);
</span><span class="boring">pub struct SelectInt;
</span><span class="boring">
</span><span class="boring">impl Expression for SelectInt {
</span><span class="boring">    type SqlType = Integer;
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl&lt;T&gt; Expression for Bound&lt;T&gt; {
</span><span class="boring">    type SqlType = T;
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl AsExpression&lt;Integer&gt; for i32 {
</span><span class="boring">    type Expression = Bound&lt;Integer&gt;;
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl AsExpression&lt;Text&gt; for &amp;'_ str {
</span><span class="boring">    type Expression = Bound&lt;Text&gt;;
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl&lt;T&gt; Foo for T where T: Expression {}
</span>
// 取消注释此行以更改推荐。
// #[diagnostic::do_not_recommend]
impl&lt;T, ST&gt; AsExpression&lt;ST&gt; for T
where
    T: Expression&lt;SqlType = ST&gt;,
{
    type Expression = T;
}

trait Foo: Expression + Sized {
    fn check&lt;T&gt;(&amp;self, _: T) -&gt; &lt;T as AsExpression&lt;&lt;Self as Expression&gt;::SqlType&gt;&gt;::Expression
    where
        T: AsExpression&lt;Self::SqlType&gt;,
    {
        todo!()
    }
}

fn main() {
    SelectInt.check("bar");
}</code></pre>
<p><code>SelectInt</code> 类型的 <code>check</code> 方法期望 <code>Integer</code> 类型。使用 i32 类型调用它会成功，因为它通过 <code>AsExpression</code> 特型 转换为 <code>Integer</code>。但是，使用字符串调用它则不会成功，并会生成一个可能看起来像这样的错误：</p>
<pre><code class="language-text">error[E0277]: 特型 边界 `&amp;str: Expression` 未满足
  --&gt; src/main.rs:53:15
   |
53 |     SelectInt.check("bar");
   |               ^^^^^ 特型 `Expression` 未为 `&amp;str` 实现
   |
   = help: 以下其他类型实现了 特型 `Expression`：
             Bound&lt;T&gt;
             SelectInt
note: `&amp;str` 实现 `AsExpression&lt;Integer&gt;` 所需
  --&gt; src/main.rs:45:13
   |
45 | impl&lt;T, ST&gt; AsExpression&lt;ST&gt; for T
   |             ^^^^^^^^^^^^^^^^     ^
46 | where
47 |     T: Expression&lt;SqlType = ST&gt;,
   |        ------------------------ 此处引入的未满足的 特型 边界
</code></pre>
<p>通过将 <code>#[diagnostic::do_not_recommend]</code> 属性添加到 <code>AsExpression</code> 的通用 <code>impl</code> 中，消息更改为：</p>
<pre><code class="language-text">error[E0277]: 特型 边界 `&amp;str: AsExpression&lt;Integer&gt;` 未满足
  --&gt; src/main.rs:53:15
   |
53 |     SelectInt.check("bar");
   |               ^^^^^ 特型 `AsExpression&lt;Integer&gt;` 未为 `&amp;str` 实现
   |
   = help: 特型 `AsExpression&lt;Integer&gt;` 未为 `&amp;str` 实现
           但 特型 `AsExpression&lt;Text&gt;` 已为其实现
   = help: 对于该 特型 实现，预期为 `Text`，但找到 `Integer`
</code></pre>
<p>第一个错误消息包含了一个关于 <code>&amp;str</code> 和 <code>Expression</code> 关系的有些令人困惑的错误消息，以及通用 impl 中未满足的 特型 边界。添加 <code>#[diagnostic::do_not_recommend]</code> 后，它不再考虑通用 impl 作为推荐。消息应该更清晰一些，表明字符串无法转换为 <code>Integer</code>。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-attributes.codegen"><a class="rule-link" href="#r-attributes.codegen" title="attributes.codegen"><span>[attributes<wbr>.codegen]</span></a>
</div>

<h1 id="代码生成属性"><a class="header" href="#代码生成属性">代码生成属性</a></h1>
<p>以下 <a href="#属性-1">属性</a> 用于控制代码生成。</p>
<!-- template:attributes -->
<div class="rule" id="r-attributes.codegen.inline"><a class="rule-link" href="#r-attributes.codegen.inline" title="attributes.codegen.inline"><span>[attributes<wbr>.codegen<wbr>.inline]</span></a>
</div>

<h3 id="inline属性"><a class="header" href="#inline属性"><code>inline</code>属性</a></h3>
<div class="rule" id="r-attributes.codegen.inline.intro"><a class="rule-link" href="#r-attributes.codegen.inline.intro" title="attributes.codegen.inline.intro"><span>[attributes<wbr>.codegen<wbr>.inline<wbr>.intro]</span></a>
</div>

<p><em><code>inline</code> <a href="#属性-1">属性</a></em> 建议是将所修饰函数代码的副本放置在调用者中，而不是生成对函数的调用。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[inline]
pub fn example1() {}

#[inline(always)]
pub fn example2() {}

#[inline(never)]
pub fn example3() {}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 在看起来值得时会自动内联函数。请谨慎使用此属性，因为内联决策不当可能会降低程序速度。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.codegen.inline.syntax"><a class="rule-link" href="#r-attributes.codegen.inline.syntax" title="attributes.codegen.inline.syntax"><span>[attributes<wbr>.codegen<wbr>.inline<wbr>.syntax]</span></a>
</div>

<p><code>inline</code> 属性的 语法格式 如下：</p>
<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-InlineAttribute" onclick="show_railroad()"><a href="#railroad-InlineAttribute">InlineAttribute</a></span> → <br>      <span class="grammar-literal">inline</span> <span class="grammar-literal">(</span> <span class="grammar-literal">always</span> <span class="grammar-literal">)</span> <br>    | <span class="grammar-literal">inline</span> <span class="grammar-literal">(</span> <span class="grammar-literal">never</span> <span class="grammar-literal">)</span> <br>    | <span class="grammar-literal">inline</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 340px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-InlineAttribute"><svg class="railroad" viewbox="0 0 340 140" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-InlineAttribute">
<text class="comment" x="67" y="25">
InlineAttribute</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 222 0 h 24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="42" />
<text x="93" y="58">
inline</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="137" y="42" />
<text x="151" y="58">
(</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="175" y="42" />
<text x="209" y="58">
always</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="253" y="42" />
<text x="267" y="58">
)</text>
</g>
<path d=" M 127 53 h 10" />
<path d=" M 165 53 h 10" />
<path d=" M 243 53 h 10" />
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 246 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 246 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 214 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="75" />
<text x="93" y="91">
inline</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="137" y="75" />
<text x="151" y="91">
(</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="175" y="75" />
<text x="205" y="91">
never</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="245" y="75" />
<text x="259" y="91">
)</text>
</g>
<path d=" M 127 86 h 10" />
<path d=" M 165 86 h 10" />
<path d=" M 235 86 h 10" />
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 68 0 h 154 m -74 0 l -5 -5 m 0 10 l 5 -5 m 74 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="108" />
<text x="93" y="124">
inline</text>
</g>
</g>
<path d=" M 315 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 305 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-attributes.codegen.inline.allowed-positions"><a class="rule-link" href="#r-attributes.codegen.inline.allowed-positions" title="attributes.codegen.inline.allowed-positions"><span>[attributes<wbr>.codegen<wbr>.inline<wbr>.allowed-positions]</span></a>
</div>

<p><code>inline</code> 属性只能应用于带有 <a href="#r-items.fn.body">函数体</a> 的函数——<a href="#r-expr.closure">闭包</a>、<a href="#r-expr.block.async">异步块</a>、<a href="#r-items.fn">自由函数</a>、<a href="#r-items.impl.inherent">固有实现</a> 或 <a href="#r-items.impl.trait">特型实现</a> 中的 <a href="#r-items.associated.fn">关联函数</a>，以及 <a href="#r-items.traits">特型定义</a> 中带有 <a href="#r-items.traits.associated-item-decls">默认定义</a> 的关联函数。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 忽略在其他位置的使用，但会对其进行 lint 检查。这在将来可能会成为错误。</p>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>尽管该属性可以应用于 <a href="#r-expr.closure">闭包</a> 和 <a href="#r-expr.block.async">异步块</a>，但其用处有限，因为我们尚不支持表达式上的属性。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 我们允许在语句上使用属性。
#[inline] || (); // OK
#[inline] async {}; // OK
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0658 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 我们尚不支持在表达式上使用属性。
let f = #[inline] || (); // ERROR
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-attributes.codegen.inline.duplicates"><a class="rule-link" href="#r-attributes.codegen.inline.duplicates" title="attributes.codegen.inline.duplicates"><span>[attributes<wbr>.codegen<wbr>.inline<wbr>.duplicates]</span></a>
</div>

<p><code>inline</code> 在函数上的首次使用才生效。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 会对首次使用之后的任何使用进行 lint 检查。这在将来可能会成为错误。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.codegen.inline.modes"><a class="rule-link" href="#r-attributes.codegen.inline.modes" title="attributes.codegen.inline.modes"><span>[attributes<wbr>.codegen<wbr>.inline<wbr>.modes]</span></a>
</div>

<p><code>inline</code> 属性支持以下模式：</p>
<ul>
<li><code>#[inline]</code> <em>建议</em> 执行内联展开。</li>
<li><code>#[inline(always)]</code> <em>建议</em> 始终执行内联展开。</li>
<li><code>#[inline(never)]</code> <em>建议</em> 永不执行内联展开。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>无论何种形式，该属性都只是一个提示。编译器可能会忽略它。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.codegen.inline.trait"><a class="rule-link" href="#r-attributes.codegen.inline.trait" title="attributes.codegen.inline.trait"><span>[attributes<wbr>.codegen<wbr>.inline<wbr>.trait]</span></a>
</div>

<p>当 <code>inline</code> 应用于 <a href="#r-items.traits">特型</a> 中的函数时，它仅应用于 <a href="#r-items.traits.associated-item-decls">默认定义</a> 的代码。</p>
<div class="rule" id="r-attributes.codegen.inline.async"><a class="rule-link" href="#r-attributes.codegen.inline.async" title="attributes.codegen.inline.async"><span>[attributes<wbr>.codegen<wbr>.inline<wbr>.async]</span></a>
</div>

<p>当 <code>inline</code> 应用于 <a href="#r-items.fn.async">异步函数</a> 或 <a href="#r-expr.closure.async">异步闭包</a> 时，它仅应用于生成的 <code>poll</code> 函数的代码。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>欲了解更多详情，请参阅 <a href="https://github.com/rust-lang/rust/issues/129347">Rust issue #129347</a>。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.codegen.inline.externally-exported"><a class="rule-link" href="#r-attributes.codegen.inline.externally-exported" title="attributes.codegen.inline.externally-exported"><span>[attributes<wbr>.codegen<wbr>.inline<wbr>.externally-exported]</span></a>
</div>

<p>如果函数通过 <a href="#r-abi.no_mangle"><code>no_mangle</code></a> 或 <a href="#r-abi.export_name"><code>export_name</code></a> 外部导出，则 <code>inline</code> 属性会被忽略。</p>
<!-- template:attributes -->
<div class="rule" id="r-attributes.codegen.cold"><a class="rule-link" href="#r-attributes.codegen.cold" title="attributes.codegen.cold"><span>[attributes<wbr>.codegen<wbr>.cold]</span></a>
</div>

<h3 id="cold属性"><a class="header" href="#cold属性"><code>cold</code>属性</a></h3>
<div class="rule" id="r-attributes.codegen.cold.intro"><a class="rule-link" href="#r-attributes.codegen.cold.intro" title="attributes.codegen.cold.intro"><span>[attributes<wbr>.codegen<wbr>.cold<wbr>.intro]</span></a>
</div>

<p><em><code>cold</code> <a href="#属性-1">属性</a></em> 建议所修饰的函数不太可能被调用，这可能有助于编译器生成更好的代码。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[cold]
pub fn example() {}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-attributes.codegen.cold.syntax"><a class="rule-link" href="#r-attributes.codegen.cold.syntax" title="attributes.codegen.cold.syntax"><span>[attributes<wbr>.codegen<wbr>.cold<wbr>.syntax]</span></a>
</div>

<p><code>cold</code> 属性使用 <a href="#grammar-MetaWord">MetaWord</a> 语法格式。</p>
<div class="rule" id="r-attributes.codegen.cold.allowed-positions"><a class="rule-link" href="#r-attributes.codegen.cold.allowed-positions" title="attributes.codegen.cold.allowed-positions"><span>[attributes<wbr>.codegen<wbr>.cold<wbr>.allowed-positions]</span></a>
</div>

<p><code>cold</code> 属性只能应用于带有 <a href="#r-items.fn.body">函数体</a> 的函数——<a href="#r-expr.closure">闭包</a>、<a href="#r-expr.block.async">异步块</a>、<a href="#r-items.fn">自由函数</a>、<a href="#r-items.impl.inherent">固有实现</a> 或 <a href="#r-items.impl.trait">特型实现</a> 中的 <a href="#r-items.associated.fn">关联函数</a>，以及 <a href="#r-items.traits">特型定义</a> 中带有 <a href="#r-items.traits.associated-item-decls">默认定义</a> 的关联函数。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 忽略在其他位置的使用，但会对其进行 lint 检查。这在将来可能会成为错误。</p>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>尽管该属性可以应用于 <a href="#r-expr.closure">闭包</a> 和 <a href="#r-expr.block.async">异步块</a>，但其用处有限，因为我们尚不支持表达式上的属性。</p>
</blockquote>
</div>

<!-- TODO: rustc currently seems to allow cold on a trait function without a body, but it appears to be ignored. I think that may be a bug, and it should at least warn if not reject (like inline does). -->
<div class="rule" id="r-attributes.codegen.cold.duplicates"><a class="rule-link" href="#r-attributes.codegen.cold.duplicates" title="attributes.codegen.cold.duplicates"><span>[attributes<wbr>.codegen<wbr>.cold<wbr>.duplicates]</span></a>
</div>

<p><code>cold</code> 在函数上的首次使用才生效。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 会对首次使用之后的任何使用进行 lint 检查。这在将来可能会成为错误。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.codegen.cold.trait"><a class="rule-link" href="#r-attributes.codegen.cold.trait" title="attributes.codegen.cold.trait"><span>[attributes<wbr>.codegen<wbr>.cold<wbr>.trait]</span></a>
</div>

<p>当 <code>cold</code> 应用于 <a href="#r-items.traits">特型</a> 中的函数时，它仅应用于 <a href="#r-items.traits.associated-item-decls">默认定义</a> 的代码。</p>
<div class="rule" id="r-attributes.codegen.naked"><a class="rule-link" href="#r-attributes.codegen.naked" title="attributes.codegen.naked"><span>[attributes<wbr>.codegen<wbr>.naked]</span></a>
</div>

<h2 id="naked属性"><a class="header" href="#naked属性"><code>naked</code>属性</a></h2>
<div class="rule" id="r-attributes.codegen.naked.intro"><a class="rule-link" href="#r-attributes.codegen.naked.intro" title="attributes.codegen.naked.intro"><span>[attributes<wbr>.codegen<wbr>.naked<wbr>.intro]</span></a>
</div>

<p><em><code>naked</code> <a href="#属性-1">属性</a></em> 阻止编译器为所修饰的函数发出函数序言和函数尾声。</p>
<div class="rule" id="r-attributes.codegen.naked.body"><a class="rule-link" href="#r-attributes.codegen.naked.body" title="attributes.codegen.naked.body"><span>[attributes<wbr>.codegen<wbr>.naked<wbr>.body]</span></a>
</div>

<p><a href="#function-body">函数体</a> 必须由且仅由一个 <a href="#内联汇编"><code>naked_asm!</code></a> 宏调用组成。</p>
<div class="rule" id="r-attributes.codegen.naked.prologue-epilogue"><a class="rule-link" href="#r-attributes.codegen.naked.prologue-epilogue" title="attributes.codegen.naked.prologue-epilogue"><span>[attributes<wbr>.codegen<wbr>.naked<wbr>.prologue-epilogue]</span></a>
</div>

<p>不会为所修饰的函数生成函数序言或函数尾声。<code>naked_asm!</code> 块中的汇编代码构成了裸函数的完整函数体。</p>
<div class="rule" id="r-attributes.codegen.naked.unsafe-attribute"><a class="rule-link" href="#r-attributes.codegen.naked.unsafe-attribute" title="attributes.codegen.naked.unsafe-attribute"><span>[attributes<wbr>.codegen<wbr>.naked<wbr>.unsafe-attribute]</span></a>
</div>

<p><code>naked</code> 属性是一个 <a href="#r-attributes.safety">不安全 属性</a>。使用 <code>#[unsafe(naked)]</code> 注解函数附带的安全义务是，函数体必须遵守函数的调用约定，维护其签名，并且要么返回，要么发散（即，不能在汇编代码末尾之后继续执行）。</p>
<div class="rule" id="r-attributes.codegen.naked.call-stack"><a class="rule-link" href="#r-attributes.codegen.naked.call-stack" title="attributes.codegen.naked.call-stack"><span>[attributes<wbr>.codegen<wbr>.naked<wbr>.call-stack]</span></a>
</div>

<p>汇编代码可以假定调用栈和寄存器状态在入口处是有效的，符合函数的签名和调用约定。</p>
<div class="rule" id="r-attributes.codegen.naked.no-duplication"><a class="rule-link" href="#r-attributes.codegen.naked.no-duplication" title="attributes.codegen.naked.no-duplication"><span>[attributes<wbr>.codegen<wbr>.naked<wbr>.no-duplication]</span></a>
</div>

<p>除了多态函数单态化时，编译器不得复制汇编代码。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>保证汇编代码何时可以或不可以被复制对于定义符号的裸函数很重要。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.codegen.naked.unused-variables"><a class="rule-link" href="#r-attributes.codegen.naked.unused-variables" title="attributes.codegen.naked.unused-variables"><span>[attributes<wbr>.codegen<wbr>.naked<wbr>.unused-variables]</span></a>
</div>

<p><a href="https://doc.rust-lang.org/rustc/lints/listing/warn-by-default.html#unused-variables"><code>unused_variables</code></a> lint 在裸函数内部被抑制。</p>
<div class="rule" id="r-attributes.codegen.naked.inline"><a class="rule-link" href="#r-attributes.codegen.naked.inline" title="attributes.codegen.naked.inline"><span>[attributes<wbr>.codegen<wbr>.naked<wbr>.inline]</span></a>
</div>

<p><a href="#inline属性"><code>inline</code></a> 属性不能应用于裸函数。</p>
<div class="rule" id="r-attributes.codegen.naked.track_caller"><a class="rule-link" href="#r-attributes.codegen.naked.track_caller" title="attributes.codegen.naked.track_caller"><span>[attributes<wbr>.codegen<wbr>.naked<wbr>.track_caller]</span></a>
</div>

<p><a href="#track_caller属性"><code>track_caller</code></a> 属性不能应用于裸函数。</p>
<div class="rule" id="r-attributes.codegen.naked.testing"><a class="rule-link" href="#r-attributes.codegen.naked.testing" title="attributes.codegen.naked.testing"><span>[attributes<wbr>.codegen<wbr>.naked<wbr>.testing]</span></a>
</div>

<p><a href="#测试属性">测试属性</a> 不能应用于裸函数。</p>
<!-- template:attributes -->
<div class="rule" id="r-attributes.codegen.no_builtins"><a class="rule-link" href="#r-attributes.codegen.no_builtins" title="attributes.codegen.no_builtins"><span>[attributes<wbr>.codegen<wbr>.no_builtins]</span></a>
</div>

<h2 id="no_builtins属性"><a class="header" href="#no_builtins属性"><code>no_builtins</code>属性</a></h2>
<div class="rule" id="r-attributes.codegen.no_builtins.intro"><a class="rule-link" href="#r-attributes.codegen.no_builtins.intro" title="attributes.codegen.no_builtins.intro"><span>[attributes<wbr>.codegen<wbr>.no_builtins<wbr>.intro]</span></a>
</div>

<p><em><code>no_builtins</code> <a href="#属性-1">属性</a></em> 禁用与对假定存在的库函数调用相关的某些代码模式的优化。</p>
<!-- TODO: This needs expanding, see <https://github.com/rust-lang/reference/issues/542>. -->
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span>#![no_builtins]
<span class="boring">fn main() {
</span><span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-attributes.codegen.no_builtins.syntax"><a class="rule-link" href="#r-attributes.codegen.no_builtins.syntax" title="attributes.codegen.no_builtins.syntax"><span>[attributes<wbr>.codegen<wbr>.no_builtins<wbr>.syntax]</span></a>
</div>

<p><code>no_builtins</code> 属性使用 <a href="#grammar-MetaWord">MetaWord</a> 语法格式。</p>
<div class="rule" id="r-attributes.codegen.no_builtins.allowed-positions"><a class="rule-link" href="#r-attributes.codegen.no_builtins.allowed-positions" title="attributes.codegen.no_builtins.allowed-positions"><span>[attributes<wbr>.codegen<wbr>.no_builtins<wbr>.allowed-positions]</span></a>
</div>

<p><code>no_builtins</code> 属性只能应用于 crate 根。</p>
<div class="rule" id="r-attributes.codegen.no_builtins.duplicates"><a class="rule-link" href="#r-attributes.codegen.no_builtins.duplicates" title="attributes.codegen.no_builtins.duplicates"><span>[attributes<wbr>.codegen<wbr>.no_builtins<wbr>.duplicates]</span></a>
</div>

<p><code>no_builtins</code> 属性的首次使用才生效。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 会对首次使用之后的任何使用进行 lint 检查。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.codegen.target_feature"><a class="rule-link" href="#r-attributes.codegen.target_feature" title="attributes.codegen.target_feature"><span>[attributes<wbr>.codegen<wbr>.target_feature]</span></a>
</div>

<h2 id="target_feature属性"><a class="header" href="#target_feature属性"><code>target_feature</code>属性</a></h2>
<div class="rule" id="r-attributes.codegen.target_feature.intro"><a class="rule-link" href="#r-attributes.codegen.target_feature.intro" title="attributes.codegen.target_feature.intro"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.intro]</span></a>
</div>

<p><em><code>target_feature</code> <a href="#属性-1">属性</a></em> 可以应用于函数，以启用该函数针对特定平台架构 特性 的代码生成。它使用 <a href="#grammar-MetaListNameValueStr">MetaListNameValueStr</a> 语法格式，其中包含一个 <code>enable</code> 的键，其值是逗号分隔的 特性 名称字符串，以启用这些 特性。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_feature = "avx2")]
</span>#[target_feature(enable = "avx2")]
fn foo_avx2() {}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-attributes.codegen.target_feature.arch"><a class="rule-link" href="#r-attributes.codegen.target_feature.arch" title="attributes.codegen.target_feature.arch"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.arch]</span></a>
</div>

<p>每个 <a href="#target_arch">目标架构</a> 都有一组可以启用的 特性。为 crate 未编译的目标架构指定 特性 是一个错误。</p>
<div class="rule" id="r-attributes.codegen.target_feature.closures"><a class="rule-link" href="#r-attributes.codegen.target_feature.closures" title="attributes.codegen.target_feature.closures"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.closures]</span></a>
</div>

<p>在带有 <code>target_feature</code> 注解的函数中定义的闭包会从封闭函数继承该属性。</p>
<div class="rule" id="r-attributes.codegen.target_feature.target-ub"><a class="rule-link" href="#r-attributes.codegen.target_feature.target-ub" title="attributes.codegen.target_feature.target-ub"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.target-ub]</span></a>
</div>

<p>调用使用当前代码运行平台不支持的 特性 编译的函数是 <a href="#被视为未定义的行为">未定义行为</a>，<em>除非</em> 平台明确文档说明这是安全的。</p>
<div class="rule" id="r-attributes.codegen.target_feature.safety-restrictions"><a class="rule-link" href="#r-attributes.codegen.target_feature.safety-restrictions" title="attributes.codegen.target_feature.safety-restrictions"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.safety-restrictions]</span></a>
</div>

<p>除非以下平台规则另有规定，否则适用以下限制：</p>
<ul>
<li>安全的 <code>#[target_feature]</code> 函数（以及继承该属性的闭包）只能在启用了被调用者启用所有 <code>target_feature</code> 的调用者中安全地调用。此限制不适用于 <code>unsafe</code> 上下文。</li>
<li>安全的 <code>#[target_feature]</code> 函数（以及继承该属性的闭包）只能在启用了被强制转换者启用所有 <code>target_feature</code> 的上下文中被强制转换为 <em>安全</em> 的函数指针。此限制不适用于 <code>unsafe</code> 函数指针。</li>
</ul>
<p>隐式启用的 特性 也包含在此规则中。例如，一个 <code>sse2</code> 函数可以调用标记有 <code>sse</code> 的函数。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_feature = "sse2")] {
</span>#[target_feature(enable = "sse")]
fn foo_sse() {}

fn bar() {
    // 在这里调用 `foo_sse` 是不安全的，因为我们必须首先确保 SSE 可用，
    // 即使 `sse` 在目标平台上默认启用或通过编译器标志手动启用。
    unsafe {
        foo_sse();
    }
}

#[target_feature(enable = "sse")]
fn bar_sse() {
    // 在这里调用 `foo_sse` 是安全的。
    foo_sse();
    || foo_sse();
}

#[target_feature(enable = "sse2")]
fn bar_sse2() {
    // 在这里调用 `foo_sse` 是安全的，因为 `sse2` 意味着 `sse`。
    foo_sse();
}
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-attributes.codegen.target_feature.fn-traits"><a class="rule-link" href="#r-attributes.codegen.target_feature.fn-traits" title="attributes.codegen.target_feature.fn-traits"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.fn-traits]</span></a>
</div>

<p>带有 <code>#[target_feature]</code> 属性 的函数 <em>从不</em> 实现 <code>Fn</code> 特型 家族，尽管从封闭函数继承 特性 的闭包会实现。</p>
<div class="rule" id="r-attributes.codegen.target_feature.allowed-positions"><a class="rule-link" href="#r-attributes.codegen.target_feature.allowed-positions" title="attributes.codegen.target_feature.allowed-positions"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.allowed-positions]</span></a>
</div>

<p><code>#[target_feature]</code> 属性不允许在以下位置使用：</p>
<ul>
<li><a href="#r-crate.main">主函数</a></li>
<li><a href="#r-panic.panic_handler">恐慌处理器函数</a></li>
<li>安全的 特型 方法</li>
<li>特型 中安全的默认函数</li>
</ul>
<div class="rule" id="r-attributes.codegen.target_feature.inline"><a class="rule-link" href="#r-attributes.codegen.target_feature.inline" title="attributes.codegen.target_feature.inline"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.inline]</span></a>
</div>

<p>标记有 <code>target_feature</code> 的函数不会内联到不支持给定 特性 的上下文中。<code>#[inline(always)]</code> 属性不能与 <code>target_feature</code> 属性一起使用。</p>
<div class="rule" id="r-attributes.codegen.target_feature.availability"><a class="rule-link" href="#r-attributes.codegen.target_feature.availability" title="attributes.codegen.target_feature.availability"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.availability]</span></a>
</div>

<h3 id="可用的特性"><a class="header" href="#可用的特性">可用的特性</a></h3>
<p>以下是可用 特性 名称的列表。</p>
<div class="rule" id="r-attributes.codegen.target_feature.x86"><a class="rule-link" href="#r-attributes.codegen.target_feature.x86" title="attributes.codegen.target_feature.x86"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.x86]</span></a>
</div>

<h4 id="x86或x86_64"><a class="header" href="#x86或x86_64"><code>x86</code>或<code>x86_64</code></a></h4>
<p>在此平台上执行带有不支持 特性 的代码是未定义行为。因此，在此平台上使用 <code>#[target_feature]</code> 函数遵循 <a href="#r-attributes.codegen.target_feature.safety-restrictions">上述限制</a>。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>特性</th><th>隐式启用</th><th>描述</th></tr>
</thead>
<tbody>
<tr><td><code>adx</code></td><td></td><td><a href="https://en.wikipedia.org/wiki/Intel_ADX">ADX</a> — 多精度加进位指令扩展</td></tr>
<tr><td><code>aes</code></td><td><code>sse2</code></td><td><a href="https://en.wikipedia.org/wiki/AES_instruction_set">AES</a> — 高级加密标准</td></tr>
<tr><td><code>avx</code></td><td><code>sse4.2</code></td><td><a href="https://en.wikipedia.org/wiki/Advanced_Vector_Extensions">AVX</a> — 高级向量扩展</td></tr>
<tr><td><code>avx2</code></td><td><code>avx</code></td><td><a href="https://en.wikipedia.org/wiki/Advanced_Vector_Extensions#AVX2">AVX2</a> — 高级向量扩展 2</td></tr>
<tr><td><code>avx512bf16</code></td><td><code>avx512bw</code></td><td><a href="https://en.wikipedia.org/wiki/AVX-512#BF16">AVX512-BF16</a> — 高级向量扩展 512 位 - Bfloat16 扩展</td></tr>
<tr><td><code>avx512bitalg</code></td><td><code>avx512bw</code></td><td><a href="https://en.wikipedia.org/wiki/AVX-512#VPOPCNTDQ_and_BITALG">AVX512-BITALG</a> — 高级向量扩展 512 位 - 位算法</td></tr>
<tr><td><code>avx512bw</code></td><td><code>avx512f</code></td><td><a href="https://en.wikipedia.org/wiki/AVX-512#BW,_DQ_and_VBMI">AVX512-BW</a> — 高级向量扩展 512 位 - 字节和字指令</td></tr>
<tr><td><code>avx512cd</code></td><td><code>avx512f</code></td><td><a href="https://en.wikipedia.org/wiki/AVX-512#Conflict_detection">AVX512-CD</a> — 高级向量扩展 512 位 - 冲突检测指令</td></tr>
<tr><td><code>avx512dq</code></td><td><code>avx512f</code></td><td><a href="https://en.wikipedia.org/wiki/AVX-512#BW,_DQ_and_VBMI">AVX512-DQ</a> — 高级向量扩展 512 位 - 双字和四字指令</td></tr>
<tr><td><code>avx512f</code></td><td><code>avx2</code>, <code>fma</code>, <code>f16c</code></td><td><a href="https://en.wikipedia.org/wiki/AVX-512">AVX512-F</a> — 高级向量扩展 512 位 - 基础</td></tr>
<tr><td><code>avx512fp16</code></td><td><code>avx512bw</code></td><td><a href="https://en.wikipedia.org/wiki/AVX-512#FP16">AVX512-FP16</a> — 高级向量扩展 512 位 - 浮点16 扩展</td></tr>
<tr><td><code>avx512ifma</code></td><td><code>avx512f</code></td><td><a href="https://en.wikipedia.org/wiki/AVX-512#IFMA">AVX512-IFMA</a> — 高级向量扩展 512 位 - 整数融合乘加</td></tr>
<tr><td><code>avx512vbmi</code></td><td><code>avx512bw</code></td><td><a href="https://en.wikipedia.org/wiki/AVX-512#BW,_DQ_and_VBMI">AVX512-VBMI</a> — 高级向量扩展 512 位 - 向量字节操作指令</td></tr>
<tr><td><code>avx512vbmi2</code></td><td><code>avx512bw</code></td><td><a href="https://en.wikipedia.org/wiki/AVX-512#VBMI2">AVX512-VBMI2</a> — 高级向量扩展 512 位 - 向量字节操作指令 2</td></tr>
<tr><td><code>avx512vl</code></td><td><code>avx512f</code></td><td><a href="https://en.wikipedia.org/wiki/AVX-512">AVX512-VL</a> — 高级向量扩展 512 位 - 向量长度扩展</td></tr>
<tr><td><code>avx512vnni</code></td><td><code>avx512f</code></td><td><a href="https://en.wikipedia.org/wiki/AVX-512#VNNI">AVX512-VNNI</a> — 高级向量扩展 512 位 - 向量神经网络指令</td></tr>
<tr><td><code>avx512vp2intersect</code></td><td><code>avx512f</code></td><td><a href="https://en.wikipedia.org/wiki/AVX-512#VP2INTERSECT">AVX512-VP2INTERSECT</a> — 高级向量扩展 512 位 - 向量对交集到一对掩码寄存器</td></tr>
<tr><td><code>avx512vpopcntdq</code></td><td><code>avx512f</code></td><td><a href="https://en.wikipedia.org/wiki/AVX-512#VPOPCNTDQ_and_BITALG">AVX512-VPOPCNTDQ</a> — 高级向量扩展 512 位 - 向量人口计数指令</td></tr>
<tr><td><code>avxifma</code></td><td><code>avx2</code></td><td><a href="https://en.wikipedia.org/wiki/Advanced_Vector_Extensions#AVX-VNNI,_AVX-IFMA">AVX-IFMA</a> — 高级向量扩展 - 整数融合乘加</td></tr>
<tr><td><code>avxneconvert</code></td><td><code>avx2</code></td><td><a href="https://en.wikipedia.org/wiki/Advanced_Vector_Extensions#AVX-VNNI,_AVX-IFMA">AVX-NE-CONVERT</a> — 高级向量扩展 - 无异常浮点转换指令</td></tr>
<tr><td><code>avxvnni</code></td><td><code>avx2</code></td><td><a href="https://en.wikipedia.org/wiki/Advanced_Vector_Extensions#AVX-VNNI,_AVX-IFMA">AVX-VNNI</a> — 高级向量扩展 - 向量神经网络指令</td></tr>
<tr><td><code>avxvnniint16</code></td><td><code>avx2</code></td><td><a href="https://en.wikipedia.org/wiki/Advanced_Vector_Extensions#AVX-VNNI,_AVX-IFMA">AVX-VNNI-INT16</a> — 高级向量扩展 - 带有 16 位整数的向量神经网络指令</td></tr>
<tr><td><code>avxvnniint8</code></td><td><code>avx2</code></td><td><a href="https://en.wikipedia.org/wiki/Advanced_Vector_Extensions#AVX-VNNI,_AVX-IFMA">AVX-VNNI-INT8</a> — 高级向量扩展 - 带有 8 位整数的向量神经网络指令</td></tr>
<tr><td><code>bmi1</code></td><td></td><td><a href="https://en.wikipedia.org/wiki/Bit_Manipulation_Instruction_Sets">BMI1</a> — 位操作指令集</td></tr>
<tr><td><code>bmi2</code></td><td></td><td><a href="https://en.wikipedia.org/wiki/Bit_Manipulation_Instruction_Sets#BMI2">BMI2</a> — 位操作指令集 2</td></tr>
<tr><td><code>cmpxchg16b</code></td><td></td><td><a href="https://www.felixcloutier.com/x86/cmpxchg8b:cmpxchg16b"><code>cmpxchg16b</code></a> — 原子地比较和交换 16 字节（128 位）数据</td></tr>
<tr><td><code>f16c</code></td><td><code>avx</code></td><td><a href="https://en.wikipedia.org/wiki/F16C">F16C</a> — 16 位浮点转换指令</td></tr>
<tr><td><code>fma</code></td><td><code>avx</code></td><td><a href="https://en.wikipedia.org/wiki/FMA_instruction_set">FMA3</a> — 三操作数融合乘加</td></tr>
<tr><td><code>fxsr</code></td><td></td><td><a href="https://www.felixcloutier.com/x86/fxsave"><code>fxsave</code></a> 和 <a href="https://www.felixcloutier.com/x86/fxrstor"><code>fxrstor</code></a> — 保存和恢复 x87 FPU、MMX 技术和 SSE 状态</td></tr>
<tr><td><code>gfni</code></td><td><code>sse2</code></td><td><a href="https://en.wikipedia.org/wiki/AVX-512#GFNI">GFNI</a> — 伽罗瓦域新指令</td></tr>
<tr><td><code>kl</code></td><td><code>sse2</code></td><td><a href="https://en.wikipedia.org/wiki/List_of_x86_cryptographic_instructions#Intel_Key_Locker_instructions">KEYLOCKER</a> — 英特尔密钥锁定指令</td></tr>
<tr><td><code>lzcnt</code></td><td></td><td><a href="https://www.felixcloutier.com/x86/lzcnt"><code>lzcnt</code></a> — 前导零计数</td></tr>
<tr><td><code>movbe</code></td><td></td><td><a href="https://www.felixcloutier.com/x86/movbe"><code>movbe</code></a> — 字节交换后移动数据</td></tr>
<tr><td><code>pclmulqdq</code></td><td><code>sse2</code></td><td><a href="https://www.felixcloutier.com/x86/pclmulqdq"><code>pclmulqdq</code></a> — 打包无进位乘法四字</td></tr>
<tr><td><code>popcnt</code></td><td></td><td><a href="https://www.felixcloutier.com/x86/popcnt"><code>popcnt</code></a> — 设置为 1 的位数计数</td></tr>
<tr><td><code>rdrand</code></td><td></td><td><a href="https://en.wikipedia.org/wiki/RdRand"><code>rdrand</code></a> — 读取随机数</td></tr>
<tr><td><code>rdseed</code></td><td></td><td><a href="https://en.wikipedia.org/wiki/RdRand"><code>rdseed</code></a> — 读取随机种子</td></tr>
<tr><td><code>sha</code></td><td><code>sse2</code></td><td><a href="https://en.wikipedia.org/wiki/Intel_SHA_extensions">SHA</a> — 安全散列算法</td></tr>
<tr><td><code>sha512</code></td><td><code>avx2</code></td><td><a href="https://en.wikipedia.org/wiki/Intel_SHA_extensions">SHA512</a> — 安全散列算法与 512 位摘要</td></tr>
<tr><td><code>sm3</code></td><td><code>avx</code></td><td><a href="https://en.wikipedia.org/wiki/List_of_x86_cryptographic_instructions#Intel_SHA_and_SM3_instructions">SM3</a> — 商密 3 散列算法</td></tr>
<tr><td><code>sm4</code></td><td><code>avx2</code></td><td><a href="https://en.wikipedia.org/wiki/List_of_x86_cryptographic_instructions#Intel_SHA_and_SM3_instructions">SM4</a> — 商密 4 密码算法</td></tr>
<tr><td><code>sse</code></td><td></td><td><a href="https://en.wikipedia.org/wiki/Streaming_SIMD_Extensions">SSE</a> — 流式 <abbr title="Single Instruction Multiple Data">SIMD</abbr> 扩展</td></tr>
<tr><td><code>sse2</code></td><td><code>sse</code></td><td><a href="https://en.wikipedia.org/wiki/SSE2">SSE2</a> — 流式 SIMD 扩展 2</td></tr>
<tr><td><code>sse3</code></td><td><code>sse2</code></td><td><a href="https://en.wikipedia.org/wiki/SSE3">SSE3</a> — 流式 SIMD 扩展 3</td></tr>
<tr><td><code>sse4.1</code></td><td><code>ssse3</code></td><td><a href="https://en.wikipedia.org/wiki/SSE4#SSE4.1">SSE4.1</a> — 流式 SIMD 扩展 4.1</td></tr>
<tr><td><code>sse4.2</code></td><td><code>sse4.1</code></td><td><a href="https://en.wikipedia.org/wiki/SSE4#SSE4.2">SSE4.2</a> — 流式 SIMD 扩展 4.2</td></tr>
<tr><td><code>sse4a</code></td><td><code>sse3</code></td><td><a href="https://en.wikipedia.org/wiki/SSE4#SSE4a">SSE4a</a> — 流式 SIMD 扩展 4a</td></tr>
<tr><td><code>ssse3</code></td><td><code>sse3</code></td><td><a href="https://en.wikipedia.org/wiki/SSSE3">SSSE3</a> — 补充流式 SIMD 扩展 3</td></tr>
<tr><td><code>tbm</code></td><td></td><td><a href="https://en.wikipedia.org/wiki/X86_Bit_manipulation_instruction_set#TBM_(Trailing_Bit_Manipulation)">TBM</a> — 尾随位操作</td></tr>
<tr><td><code>vaes</code></td><td><code>avx2</code>, <code>aes</code></td><td><a href="https://en.wikipedia.org/wiki/AVX-512#VAES">VAES</a> — 向量 AES 指令</td></tr>
<tr><td><code>vpclmulqdq</code></td><td><code>avx</code>, <code>pclmulqdq</code></td><td><a href="https://en.wikipedia.org/wiki/AVX-512#VPCLMULQDQ">VPCLMULQDQ</a> — 四字向量无进位乘法</td></tr>
<tr><td><code>widekl</code></td><td><code>kl</code></td><td><a href="https://en.wikipedia.org/wiki/List_of_x86_cryptographic_instructions#Intel_Key_Locker_instructions">KEYLOCKER_WIDE</a> — 英特尔宽密钥锁定指令</td></tr>
<tr><td><code>xsave</code></td><td></td><td><a href="https://www.felixcloutier.com/x86/xsave"><code>xsave</code></a> — 保存处理器扩展状态</td></tr>
<tr><td><code>xsavec</code></td><td></td><td><a href="https://www.felixcloutier.com/x86/xsavec"><code>xsavec</code></a> — 保存处理器带压缩的扩展状态</td></tr>
<tr><td><code>xsaveopt</code></td><td></td><td><a href="https://www.felixcloutier.com/x86/xsaveopt"><code>xsaveopt</code></a> — 保存处理器优化扩展状态</td></tr>
<tr><td><code>xsaves</code></td><td></td><td><a href="https://www.felixcloutier.com/x86/xsaves"><code>xsaves</code></a> — 保存处理器主管扩展状态</td></tr>
</tbody>
</table>
</div>
<!-- Keep links near each table to make it easier to move and update. -->
<div class="rule" id="r-attributes.codegen.target_feature.aarch64"><a class="rule-link" href="#r-attributes.codegen.target_feature.aarch64" title="attributes.codegen.target_feature.aarch64"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.aarch64]</span></a>
</div>

<h4 id="aarch64"><a class="header" href="#aarch64"><code>aarch64</code></a></h4>
<p>在此平台上，<code>#[target_feature]</code> 函数的使用遵循 <a href="#r-attributes.codegen.target_feature.safety-restrictions">上述限制</a>。</p>
<p>有关这些 特性 的更多文档可以在 <a href="https://developer.arm.com/documentation/ddi0487/latest">ARM Architecture Reference Manual</a> 或 <a href="https://developer.arm.com">developer.arm.com</a> 上的其他位置找到。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>如果使用以下 特性 对，应同时将其标记为启用或禁用：</p>
<ul>
<li><code>paca</code> 和 <code>pacg</code>，LLVM 目前将其实现为一个 特性。</li>
</ul>
</blockquote>
</div>

<div class="table-wrapper">
<table>
<thead>
<tr><th>特性</th><th>隐式启用</th><th>特性 名称</th></tr>
</thead>
<tbody>
<tr><td><code>aes</code></td><td><code>neon</code></td><td>FEAT_AES &amp; FEAT_PMULL — 高级 <abbr title="Single Instruction Multiple Data">SIMD</abbr> AES 和 PMULL 指令</td></tr>
<tr><td><code>bf16</code></td><td></td><td>FEAT_BF16 — BFloat16 指令</td></tr>
<tr><td><code>bti</code></td><td></td><td>FEAT_BTI — 分支目标识别</td></tr>
<tr><td><code>crc</code></td><td></td><td>FEAT_CRC — CRC32 校验和指令</td></tr>
<tr><td><code>dit</code></td><td></td><td>FEAT_DIT  — 数据无关时序指令</td></tr>
<tr><td><code>dotprod</code></td><td><code>neon</code></td><td>FEAT_DotProd — 高级 SIMD Int8 点积指令</td></tr>
<tr><td><code>dpb</code></td><td></td><td>FEAT_DPB — 数据缓存清理到持久点</td></tr>
<tr><td><code>dpb2</code></td><td><code>dpb</code></td><td>FEAT_DPB2 — 数据缓存清理到深度持久点</td></tr>
<tr><td><code>f32mm</code></td><td><code>sve</code></td><td>FEAT_F32MM — SVE 单精度浮点矩阵乘法指令</td></tr>
<tr><td><code>f64mm</code></td><td><code>sve</code></td><td>FEAT_F64MM — SVE 双精度浮点矩阵乘法指令</td></tr>
<tr><td><code>fcma</code></td><td><code>neon</code></td><td>FEAT_FCMA — 浮点复数支持</td></tr>
<tr><td><code>fhm</code></td><td><code>fp16</code></td><td>FEAT_FHM — 半精度浮点 FMLAL 指令</td></tr>
<tr><td><code>flagm</code></td><td></td><td>FEAT_FLAGM — 条件标志操作</td></tr>
<tr><td><code>fp16</code></td><td><code>neon</code></td><td>FEAT_FP16 — 半精度浮点数据处理</td></tr>
<tr><td><code>frintts</code></td><td></td><td>FEAT_FRINTTS — 浮点到整数辅助指令</td></tr>
<tr><td><code>i8mm</code></td><td></td><td>FEAT_I8MM — Int8 矩阵乘法</td></tr>
<tr><td><code>jsconv</code></td><td><code>neon</code></td><td>FEAT_JSCVT — JavaScript 转换指令</td></tr>
<tr><td><code>lor</code></td><td></td><td>FEAT_LOR — 有限排序区域扩展</td></tr>
<tr><td><code>lse</code></td><td></td><td>FEAT_LSE — 大型系统扩展</td></tr>
<tr><td><code>mte</code></td><td></td><td>FEAT_MTE &amp; FEAT_MTE2 — 内存标记扩展</td></tr>
<tr><td><code>neon</code></td><td></td><td>FEAT_AdvSimd &amp; FEAT_FP — 浮点和高级 SIMD 扩展</td></tr>
<tr><td><code>paca</code></td><td></td><td>FEAT_PAUTH — 指针认证（地址认证）</td></tr>
<tr><td><code>pacg</code></td><td></td><td>FEAT_PAUTH — 指针认证（通用认证）</td></tr>
<tr><td><code>pan</code></td><td></td><td>FEAT_PAN — 特权访问永不扩展</td></tr>
<tr><td><code>pmuv3</code></td><td></td><td>FEAT_PMUv3 — 性能监视器扩展 (v3)</td></tr>
<tr><td><code>rand</code></td><td></td><td>FEAT_RNG — 随机数生成器</td></tr>
<tr><td><code>ras</code></td><td></td><td>FEAT_RAS &amp; FEAT_RASv1p1 — 可靠性、可用性和可服务性扩展</td></tr>
<tr><td><code>rcpc</code></td><td></td><td>FEAT_LRCPC — 释放一致处理器一致</td></tr>
<tr><td><code>rcpc2</code></td><td><code>rcpc</code></td><td>FEAT_LRCPC2 — 带立即偏移的 RcPc</td></tr>
<tr><td><code>rdm</code></td><td><code>neon</code></td><td>FEAT_RDM — 舍入双精度乘累加</td></tr>
<tr><td><code>sb</code></td><td></td><td>FEAT_SB — 推测屏障</td></tr>
<tr><td><code>sha2</code></td><td><code>neon</code></td><td>FEAT_SHA1 &amp; FEAT_SHA256 — 高级 SIMD SHA 指令</td></tr>
<tr><td><code>sha3</code></td><td><code>sha2</code></td><td>FEAT_SHA512 &amp; FEAT_SHA3 — 高级 SIMD SHA 指令</td></tr>
<tr><td><code>sm4</code></td><td><code>neon</code></td><td>FEAT_SM3 &amp; FEAT_SM4 — 高级 SIMD SM3/4 指令</td></tr>
<tr><td><code>spe</code></td><td></td><td>FEAT_SPE — 统计分析扩展</td></tr>
<tr><td><code>ssbs</code></td><td></td><td>FEAT_SSBS &amp; FEAT_SSBS2 — 推测存储旁路安全</td></tr>
<tr><td><code>sve</code></td><td><code>neon</code></td><td>FEAT_SVE — 可伸缩向量扩展</td></tr>
<tr><td><code>sve2</code></td><td><code>sve</code></td><td>FEAT_SVE2 — 可伸缩向量扩展 2</td></tr>
<tr><td><code>sve2-aes</code></td><td><code>sve2</code>, <code>aes</code></td><td>FEAT_SVE_AES &amp; FEAT_SVE_PMULL128 — SVE AES 指令</td></tr>
<tr><td><code>sve2-bitperm</code></td><td><code>sve2</code></td><td>FEAT_SVE2_BitPerm — SVE 位置换</td></tr>
<tr><td><code>sve2-sha3</code></td><td><code>sve2</code>, <code>sha3</code></td><td>FEAT_SVE2_SHA3 — SVE SHA3 指令</td></tr>
<tr><td><code>sve2-sm4</code></td><td><code>sve2</code>, <code>sm4</code></td><td>FEAT_SVE2_SM4 — SVE SM4 指令</td></tr>
<tr><td><code>tme</code></td><td></td><td>FEAT_TME — 事务性内存扩展</td></tr>
<tr><td><code>vh</code></td><td></td><td>FEAT_VHE — 虚拟化主机扩展</td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-attributes.codegen.target_feature.loongarch"><a class="rule-link" href="#r-attributes.codegen.target_feature.loongarch" title="attributes.codegen.target_feature.loongarch"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.loongarch]</span></a>
</div>

<h4 id="loongarch"><a class="header" href="#loongarch"><code>loongarch</code></a></h4>
<p>在此平台上，<code>#[target_feature]</code> 函数的使用遵循 <a href="#r-attributes.codegen.target_feature.safety-restrictions">上述限制</a>。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>特性</th><th>隐式启用</th><th>描述</th></tr>
</thead>
<tbody>
<tr><td><code>f</code></td><td></td><td><a href="https://loongson.github.io/LoongArch-Documentation/LoongArch-Vol1-EN.html#cpucfg-fp_sp">F</a> — 单精度浮点指令</td></tr>
<tr><td><code>d</code></td><td><code>f</code></td><td><a href="https://loongson.github.io/LoongArch-Documentation/LoongArch-Vol1-EN.html#cpucfg-fp_dp">D</a> — 双精度浮点指令</td></tr>
<tr><td><code>frecipe</code></td><td></td><td><a href="https://loongson.github.io/LoongArch-Documentation/LoongArch-Vol1-EN.html#cpucfg-frecipe">FRECIPE</a> — 倒数近似指令</td></tr>
<tr><td><code>lasx</code></td><td><code>lsx</code></td><td><a href="https://loongson.github.io/LoongArch-Documentation/LoongArch-Vol1-EN.html#cpucfg-lasx">LASX</a> — 256 位向量指令</td></tr>
<tr><td><code>lbt</code></td><td></td><td><a href="https://loongson.github.io/LoongArch-Documentation/LoongArch-Vol1-EN.html#cpucfg-lbt_x86">LBT</a> — 二进制翻译指令</td></tr>
<tr><td><code>lsx</code></td><td><code>d</code></td><td><a href="https://loongson.github.io/LoongArch-Documentation/LoongArch-Vol1-EN.html#cpucfg-lsx">LSX</a> — 128 位向量指令</td></tr>
<tr><td><code>lvz</code></td><td></td><td><a href="https://loongson.github.io/LoongArch-Documentation/LoongArch-Vol1-EN.html#cpucfg-lvz">LVZ</a> — 虚拟化指令</td></tr>
</tbody>
</table>
</div>
<!-- Keep links near each table to make it easier to move and update. -->
<div class="rule" id="r-attributes.codegen.target_feature.riscv"><a class="rule-link" href="#r-attributes.codegen.target_feature.riscv" title="attributes.codegen.target_feature.riscv"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.riscv]</span></a>
</div>

<h4 id="riscv32或riscv64"><a class="header" href="#riscv32或riscv64"><code>riscv32</code>或<code>riscv64</code></a></h4>
<p>在此平台上，<code>#[target_feature]</code> 函数的使用遵循 <a href="#r-attributes.codegen.target_feature.safety-restrictions">上述限制</a>。</p>
<p>有关这些 特性 的更多文档可以在它们各自的规范中找到。许多规范在 <a href="https://github.com/riscv/riscv-isa-manual">RISC-V ISA Manual</a>，<a href="https://github.com/riscv/riscv-isa-manual/tree/20250508">version 20250508</a>，或 <a href="https://github.com/riscv">RISC-V GitHub Account</a> 上的另一本手册中描述。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>特性</th><th>隐式启用</th><th>描述</th></tr>
</thead>
<tbody>
<tr><td><code>a</code></td><td></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/a-st-ext.adoc">A</a> — 原子指令</td></tr>
<tr><td><code>c</code></td><td></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/c-st-ext.adoc">C</a> — 压缩指令</td></tr>
<tr><td><code>m</code></td><td></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/m-st-ext.adoc">M</a> — 整数乘法和除法指令</td></tr>
<tr><td><code>zba</code></td><td></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/b-st-ext.adoc">Zba</a> — 地址生成指令</td></tr>
<tr><td><code>zbb</code></td><td></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/b-st-ext.adoc">Zbb</a> — 基本位操作</td></tr>
<tr><td><code>zbc</code></td><td><code>zbkc</code></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/b-st-ext.adoc">Zbc</a> — 无进位乘法</td></tr>
<tr><td><code>zbkb</code></td><td></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/b-st-ext.adoc">Zbkb</a> — 密码学位操作指令</td></tr>
<tr><td><code>zbkc</code></td><td></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/b-st-ext.adoc">Zbkc</a> — 密码学无进位乘法</td></tr>
<tr><td><code>zbkx</code></td><td></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/b-st-ext.adoc">Zbkx</a> — 交叉置换</td></tr>
<tr><td><code>zbs</code></td><td></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/b-st-ext.adoc">Zbs</a> — 单比特指令</td></tr>
<tr><td><code>zk</code></td><td><code>zkn</code>, <code>zkr</code>, <code>zks</code>, <code>zkt</code>, <code>zbkb</code>, <code>zbkc</code>, <code>zkbx</code></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/scalar-crypto.adoc">Zk</a> — 标量密码学</td></tr>
<tr><td><code>zkn</code></td><td><code>zknd</code>, <code>zkne</code>, <code>zknh</code>, <code>zbkb</code>, <code>zbkc</code>, <code>zkbx</code></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/scalar-crypto.adoc">Zkn</a> — NIST 算法套件扩展</td></tr>
<tr><td><code>zknd</code></td><td></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/scalar-crypto.adoc">Zknd</a> — NIST 套件: AES 解密</td></tr>
<tr><td><code>zkne</code></td><td></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/scalar-crypto.adoc">Zkne</a> — NIST 套件: AES 加密</td></tr>
<tr><td><code>zknh</code></td><td></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/scalar-crypto.adoc">Zknh</a> — NIST 套件: 哈希函数指令</td></tr>
<tr><td><code>zkr</code></td><td></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/scalar-crypto.adoc">Zkr</a> — 熵源扩展</td></tr>
<tr><td><code>zks</code></td><td><code>zksed</code>, <code>zksh</code>, <code>zbkb</code>, <code>zbkc</code>, <code>zkbx</code></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/scalar-crypto.adoc">Zks</a> — 商密算法套件</td></tr>
<tr><td><code>zksed</code></td><td></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/scalar-crypto.adoc">Zksed</a> — 商密套件: SM4 分组密码指令</td></tr>
<tr><td><code>zksh</code></td><td></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/scalar-crypto.adoc">Zksh</a> — 商密套件: SM3 哈希函数指令</td></tr>
<tr><td><code>zkt</code></td><td></td><td><a href="https://github.com/riscv/riscv-isa-manual/blob/20250508/src/scalar-crypto.adoc">Zkt</a> — 数据无关执行延迟子集</td></tr>
</tbody>
</table>
</div>
<!-- Keep links near each table to make it easier to move and update. -->
<div class="rule" id="r-attributes.codegen.target_feature.wasm"><a class="rule-link" href="#r-attributes.codegen.target_feature.wasm" title="attributes.codegen.target_feature.wasm"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.wasm]</span></a>
</div>

<h4 id="wasm32或wasm64"><a class="header" href="#wasm32或wasm64"><code>wasm32</code>或<code>wasm64</code></a></h4>
<p>安全的 <code>#[target_feature]</code> 函数始终可以在 Wasm 平台上在安全上下文中使用。通过 <code>#[target_feature]</code> 属性 造成未定义行为是不可能的，因为尝试使用 Wasm 引擎不支持的指令会在加载时失败，而不会有被以编译器预期之外的方式解释的风险。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>特性</th><th>隐式启用</th><th>描述</th></tr>
</thead>
<tbody>
<tr><td><code>bulk-memory</code></td><td></td><td><a href="https://github.com/WebAssembly/bulk-memory-operations">WebAssembly bulk memory operations proposal</a></td></tr>
<tr><td><code>extended-const</code></td><td></td><td><a href="https://github.com/WebAssembly/extended-const">WebAssembly extended const expressions proposal</a></td></tr>
<tr><td><code>mutable-globals</code></td><td></td><td><a href="https://github.com/WebAssembly/mutable-global">WebAssembly mutable global proposal</a></td></tr>
<tr><td><code>nontrapping-fptoint</code></td><td></td><td><a href="https://github.com/WebAssembly/nontrapping-float-to-int-conversions">WebAssembly non-trapping float-to-int conversion proposal</a></td></tr>
<tr><td><code>relaxed-simd</code></td><td><code>simd128</code></td><td><a href="https://github.com/WebAssembly/relaxed-simd">WebAssembly relaxed simd proposal</a></td></tr>
<tr><td><code>sign-ext</code></td><td></td><td><a href="https://github.com/WebAssembly/sign-extension-ops">WebAssembly sign extension operators Proposal</a></td></tr>
<tr><td><code>simd128</code></td><td></td><td><a href="https://github.com/webassembly/simd">WebAssembly simd proposal</a></td></tr>
<tr><td><code>multivalue</code></td><td></td><td><a href="https://github.com/webassembly/multi-value">WebAssembly multivalue proposal</a></td></tr>
<tr><td><code>reference-types</code></td><td></td><td><a href="https://github.com/webassembly/reference-types">WebAssembly reference-types proposal</a></td></tr>
<tr><td><code>tail-call</code></td><td></td><td><a href="https://github.com/webassembly/tail-call">WebAssembly tail-call proposal</a></td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-attributes.codegen.target_feature.s390x"><a class="rule-link" href="#r-attributes.codegen.target_feature.s390x" title="attributes.codegen.target_feature.s390x"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.s390x]</span></a>
</div>

<h4 id="s390x"><a class="header" href="#s390x"><code>s390x</code></a></h4>
<p>在 <code>s390x</code> 目标上，使用带有 <code>#[target_feature]</code> 属性 的函数遵循 <a href="#r-attributes.codegen.target_feature.safety-restrictions">上述限制</a>。</p>
<p>有关这些 特性 的更多文档可以在 <em><a href="https://publibfp.dhe.ibm.com/epubs/pdf/a227832d.pdf">z/Architecture Principles of Operation</a></em> 的第 1 章“对 z/Architecture 的补充”部分中找到。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>特性</th><th>隐式启用</th><th>描述</th></tr>
</thead>
<tbody>
<tr><td><code>vector</code></td><td></td><td>128 位向量指令</td></tr>
<tr><td><code>vector-enhancements-1</code></td><td><code>vector</code></td><td>向量增强 1</td></tr>
<tr><td><code>vector-enhancements-2</code></td><td><code>vector-enhancements-1</code></td><td>向量增强 2</td></tr>
<tr><td><code>vector-enhancements-3</code></td><td><code>vector-enhancements-2</code></td><td>向量增强 3</td></tr>
<tr><td><code>vector-packed-decimal</code></td><td><code>vector</code></td><td>向量压缩十进制</td></tr>
<tr><td><code>vector-packed-decimal-enhancement</code></td><td><code>vector-packed-decimal</code></td><td>向量压缩十进制增强</td></tr>
<tr><td><code>vector-packed-decimal-enhancement-2</code></td><td><code>vector-packed-decimal-enhancement-2</code></td><td>向量压缩十进制增强 2</td></tr>
<tr><td><code>vector-packed-decimal-enhancement-3</code></td><td><code>vector-packed-decimal-enhancement-3</code></td><td>向量压缩十进制增强 3</td></tr>
<tr><td><code>nnp-assist</code></td><td><code>vector</code></td><td>NNP 辅助</td></tr>
<tr><td><code>miscellaneous-extensions-2</code></td><td></td><td>杂项扩展 2</td></tr>
<tr><td><code>miscellaneous-extensions-3</code></td><td></td><td>杂项扩展 3</td></tr>
<tr><td><code>miscellaneous-extensions-4</code></td><td></td><td>杂项扩展 4</td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-attributes.codegen.target_feature.info"><a class="rule-link" href="#r-attributes.codegen.target_feature.info" title="attributes.codegen.target_feature.info"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.info]</span></a>
</div>

<h3 id="附加信息"><a class="header" href="#附加信息">附加信息</a></h3>
<div class="rule" id="r-attributes.codegen.target_feature.remark-cfg"><a class="rule-link" href="#r-attributes.codegen.target_feature.remark-cfg" title="attributes.codegen.target_feature.remark-cfg"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.remark-cfg]</span></a>
</div>

<p>有关根据编译时设置有选择地启用或禁用代码编译，请参阅 <a href="#target_feature"><code>target_feature</code> conditional compilation option</a>。请注意，此选项不受 <code>target_feature</code> 属性 的影响，仅由整个 crate 启用的 特性 驱动。</p>
<div class="rule" id="r-attributes.codegen.target_feature.remark-rt"><a class="rule-link" href="#r-attributes.codegen.target_feature.remark-rt" title="attributes.codegen.target_feature.remark-rt"><span>[attributes<wbr>.codegen<wbr>.target_feature<wbr>.remark-rt]</span></a>
</div>

<p>可以在运行时使用标准库中平台特定的宏检查 特性 是否启用，例如 <a href="https://doc.rust-lang.org/std/arch/macro.is_x86_feature_detected.html"><code>is_x86_feature_detected</code></a> 或 <a href="https://doc.rust-lang.org/std/arch/macro.is_aarch64_feature_detected.html"><code>is_aarch64_feature_detected</code></a>。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 为每个目标和 CPU 启用了一组默认 特性。可以使用 <a href="https://doc.rust-lang.org/rustc/codegen-options/index.html#target-cpu"><code>-C target-cpu</code></a> 标志选择 CPU。可以使用 <a href="https://doc.rust-lang.org/rustc/codegen-options/index.html#target-feature"><code>-C target-feature</code></a> 标志为整个 crate 启用或禁用单个 特性。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.codegen.track_caller"><a class="rule-link" href="#r-attributes.codegen.track_caller" title="attributes.codegen.track_caller"><span>[attributes<wbr>.codegen<wbr>.track_caller]</span></a>
</div>

<h2 id="track_caller属性"><a class="header" href="#track_caller属性"><code>track_caller</code>属性</a></h2>
<div class="rule" id="r-attributes.codegen.track_caller.allowed-positions"><a class="rule-link" href="#r-attributes.codegen.track_caller.allowed-positions" title="attributes.codegen.track_caller.allowed-positions"><span>[attributes<wbr>.codegen<wbr>.track_caller<wbr>.allowed-positions]</span></a>
</div>

<p><code>track_caller</code> 属性可以应用于任何具有 <a href="#abi"><code>"Rust"</code> ABI</a> 的函数，但入口点 <code>fn main</code> 除外。</p>
<div class="rule" id="r-attributes.codegen.track_caller.traits"><a class="rule-link" href="#r-attributes.codegen.track_caller.traits" title="attributes.codegen.track_caller.traits"><span>[attributes<wbr>.codegen<wbr>.track_caller<wbr>.traits]</span></a>
</div>

<p>当应用于 特型 声明中的函数和方法时，该属性适用于所有实现。如果 特型 提供带有该属性 的默认实现，则该属性也适用于覆盖实现。</p>
<div class="rule" id="r-attributes.codegen.track_caller.extern"><a class="rule-link" href="#r-attributes.codegen.track_caller.extern" title="attributes.codegen.track_caller.extern"><span>[attributes<wbr>.codegen<wbr>.track_caller<wbr>.extern]</span></a>
</div>

<p>当应用于 <code>extern</code> 块中的函数时，该属性也必须应用于任何链接的实现，否则会导致未定义行为。当应用于可用于 <code>extern</code> 块的函数时，<code>extern</code> 块中的声明也必须具有该属性，否则会导致未定义行为。</p>
<div class="rule" id="r-attributes.codegen.track_caller.behavior"><a class="rule-link" href="#r-attributes.codegen.track_caller.behavior" title="attributes.codegen.track_caller.behavior"><span>[attributes<wbr>.codegen<wbr>.track_caller<wbr>.behavior]</span></a>
</div>

<h3 id="行为"><a class="header" href="#行为">行为</a></h3>
<p>将该属性应用于函数 <code>f</code> 允许 <code>f</code> 内的代码获取导致 <code>f</code> 被调用的“最顶层”跟踪调用的 <a href="../core/panic/location/struct.Location.html"><code>Location</code></a> 提示。在观察点，实现的行为就像它从 <code>f</code> 的栈帧向上查找最近的 <em>未修饰</em> 函数 <code>outer</code> 的栈帧，并返回 <code>outer</code> 中跟踪调用的 <a href="../core/panic/location/struct.Location.html"><code>Location</code></a>。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[track_caller]
fn f() {
    println!("{}", std::panic::Location::caller());
}
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>core</code> 提供 <a href="../core/panic/location/struct.Location.html#method.caller"><code>core::panic::Location::caller</code></a> 用于观察调用者位置。它包装了 <code>rustc</code> 实现的 <a href="../core/intrinsics/fn.caller_location.html"><code>core::intrinsics::caller_location</code></a> 内部函数。</p>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>因为生成的 <code>Location</code> 是一个提示，实现可能会提前停止其栈向上查找。有关重要的注意事项，请参阅 <a href="#limitations">限制</a>。</p>
</blockquote>
</div>

<h4 id="示例-2"><a class="header" href="#示例-2">示例</a></h4>
<p>当 <code>f</code> 被 <code>calls_f</code> 直接调用时，<code>f</code> 中的代码观察到其在 <code>calls_f</code> 中的调用点：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[track_caller]
</span><span class="boring">fn f() {
</span><span class="boring">    println!("{}", std::panic::Location::caller());
</span><span class="boring">}
</span>fn calls_f() {
    f(); // &lt;-- f() prints this location
}
<span class="boring">}</span></code></pre>
<p>当 <code>f</code> 被另一个带有属性 的函数 <code>g</code> 调用，而 <code>g</code> 又被 <code>calls_g</code> 调用时，<code>f</code> 和 <code>g</code> 中的代码都观察到 <code>g</code> 在 <code>calls_g</code> 中的调用点：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[track_caller]
</span><span class="boring">fn f() {
</span><span class="boring">    println!("{}", std::panic::Location::caller());
</span><span class="boring">}
</span>#[track_caller]
fn g() {
    println!("{}", std::panic::Location::caller());
    f();
}

fn calls_g() {
    g(); // &lt;-- g() prints this location twice, once itself and once from f()
}
<span class="boring">}</span></code></pre>
<p>当 <code>g</code> 被另一个带有属性 的函数 <code>h</code> 调用，而 <code>h</code> 又被 <code>calls_h</code> 调用时，<code>f</code>、<code>g</code> 和 <code>h</code> 中的所有代码都观察到 <code>h</code> 在 <code>calls_h</code> 中的调用点：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[track_caller]
</span><span class="boring">fn f() {
</span><span class="boring">    println!("{}", std::panic::Location::caller());
</span><span class="boring">}
</span><span class="boring">#[track_caller]
</span><span class="boring">fn g() {
</span><span class="boring">    println!("{}", std::panic::Location::caller());
</span><span class="boring">    f();
</span><span class="boring">}
</span>#[track_caller]
fn h() {
    println!("{}", std::panic::Location::caller());
    g();
}

fn calls_h() {
    h(); // &lt;-- prints this location three times, once itself, once from g(), once from f()
}
<span class="boring">}</span></code></pre>
<p>依此类推。</p>
<div class="rule" id="r-attributes.codegen.track_caller.limits"><a class="rule-link" href="#r-attributes.codegen.track_caller.limits" title="attributes.codegen.track_caller.limits"><span>[attributes<wbr>.codegen<wbr>.track_caller<wbr>.limits]</span></a>
</div>

<h3 id="限制-2"><a class="header" href="#限制-2">限制</a></h3>
<div class="rule" id="r-attributes.codegen.track_caller.hint"><a class="rule-link" href="#r-attributes.codegen.track_caller.hint" title="attributes.codegen.track_caller.hint"><span>[attributes<wbr>.codegen<wbr>.track_caller<wbr>.hint]</span></a>
</div>

<p>此信息是一个提示，不要求实现保留它。</p>
<div class="rule" id="r-attributes.codegen.track_caller.decay"><a class="rule-link" href="#r-attributes.codegen.track_caller.decay" title="attributes.codegen.track_caller.decay"><span>[attributes<wbr>.codegen<wbr>.track_caller<wbr>.decay]</span></a>
</div>

<p>特别是，将带有 <code>#[track_caller]</code> 的函数强制转换为函数指针会创建一个 shim，该 shim 在观察者看来是在所修饰函数的定义点被调用，从而在虚拟调用中丢失实际的调用者信息。这种强制转换的一个常见示例是创建其方法带有属性 的 特型 对象。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>上述函数指针的 shim 是必要的，因为 <code>rustc</code> 在代码生成上下文中通过向函数 ABI 附加一个隐式参数来实现 <code>track_caller</code>，但对于间接调用来说，这会是不健全的，因为该参数不是函数类型的一部分，并且给定的函数指针类型可能引用也可能不引用带有该属性 的函数。创建 shim 隐藏了函数指针调用者中的隐式参数，从而保持了健全性。</p>
</blockquote>
</div>

<!-- template:attributes -->
<div class="rule" id="r-attributes.codegen.instruction_set"><a class="rule-link" href="#r-attributes.codegen.instruction_set" title="attributes.codegen.instruction_set"><span>[attributes<wbr>.codegen<wbr>.instruction_set]</span></a>
</div>

<h2 id="instruction_set属性"><a class="header" href="#instruction_set属性"><code>instruction_set</code>属性</a></h2>
<div class="rule" id="r-attributes.codegen.instruction_set.intro"><a class="rule-link" href="#r-attributes.codegen.instruction_set.intro" title="attributes.codegen.instruction_set.intro"><span>[attributes<wbr>.codegen<wbr>.instruction_set<wbr>.intro]</span></a>
</div>

<p><em><code>instruction_set</code> <a href="#属性-1">属性</a></em> 指定函数在代码生成过程中将使用的指令集。这允许在单个程序中混合使用多个指令集。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<!-- ignore: arm-only -->
<pre><code class="language-rust ignore">#[instruction_set(arm::a32)]
fn arm_code() {}

#[instruction_set(arm::t32)]
fn thumb_code() {}</code></pre>
</blockquote>
</div>

<div class="rule" id="r-attributes.codegen.instruction_set.syntax"><a class="rule-link" href="#r-attributes.codegen.instruction_set.syntax" title="attributes.codegen.instruction_set.syntax"><span>[attributes<wbr>.codegen<wbr>.instruction_set<wbr>.syntax]</span></a>
</div>

<p><code>instruction_set</code> 属性使用 <a href="#grammar-MetaListPaths">MetaListPaths</a> 语法格式来指定一个由架构家族名称和指令集名称组成的单一路径。</p>
<div class="rule" id="r-attributes.codegen.instruction_set.allowed-positions"><a class="rule-link" href="#r-attributes.codegen.instruction_set.allowed-positions" title="attributes.codegen.instruction_set.allowed-positions"><span>[attributes<wbr>.codegen<wbr>.instruction_set<wbr>.allowed-positions]</span></a>
</div>

<p><code>instruction_set</code> 属性只能应用于带有 <a href="#r-items.fn.body">函数体</a> 的函数——<a href="#r-expr.closure">闭包</a>、<a href="#r-expr.block.async">异步块</a>、<a href="#r-items.fn">自由函数</a>、<a href="#r-items.impl.inherent">固有实现</a> 或 <a href="#r-items.impl.trait">特型实现</a> 中的 <a href="#r-items.associated.fn">关联函数</a>，以及 <a href="#r-items.traits">特型定义</a> 中带有 <a href="#r-items.traits.associated-item-decls">默认定义</a> 的关联函数。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 忽略在其他位置的使用，但会对其进行 lint 检查。这在将来可能会成为错误。</p>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>尽管该属性可以应用于 <a href="#r-expr.closure">闭包</a> 和 <a href="#r-expr.block.async">异步块</a>，但其用处有限，因为我们尚不支持表达式上的属性。</p>
</blockquote>
</div>

<div class="rule" id="r-attributes.codegen.instruction_set.duplicates"><a class="rule-link" href="#r-attributes.codegen.instruction_set.duplicates" title="attributes.codegen.instruction_set.duplicates"><span>[attributes<wbr>.codegen<wbr>.instruction_set<wbr>.duplicates]</span></a>
</div>

<p><code>instruction_set</code> 属性在函数上只能使用一次。</p>
<div class="rule" id="r-attributes.codegen.instruction_set.target-limits"><a class="rule-link" href="#r-attributes.codegen.instruction_set.target-limits" title="attributes.codegen.instruction_set.target-limits"><span>[attributes<wbr>.codegen<wbr>.instruction_set<wbr>.target-limits]</span></a>
</div>

<p><code>instruction_set</code> 属性只能与支持给定值的目标一起使用。</p>
<div class="rule" id="r-attributes.codegen.instruction_set.inline-asm"><a class="rule-link" href="#r-attributes.codegen.instruction_set.inline-asm" title="attributes.codegen.instruction_set.inline-asm"><span>[attributes<wbr>.codegen<wbr>.instruction_set<wbr>.inline-asm]</span></a>
</div>

<p>当使用 <code>instruction_set</code> 属性时，函数中的任何内联汇编都必须使用指定的指令集而不是目标默认指令集。</p>
<div class="rule" id="r-attributes.codegen.instruction_set.arm"><a class="rule-link" href="#r-attributes.codegen.instruction_set.arm" title="attributes.codegen.instruction_set.arm"><span>[attributes<wbr>.codegen<wbr>.instruction_set<wbr>.arm]</span></a>
</div>

<h3 id="arm上的instruction_set"><a class="header" href="#arm上的instruction_set">ARM上的<code>instruction_set</code></a></h3>
<p>当目标为 <code>ARMv4T</code> 和 <code>ARMv5te</code> 架构时，<code>instruction_set</code> 支持的值有：</p>
<ul>
<li><code>arm::a32</code> — 将函数生成为 A32 “ARM” 代码。</li>
<li><code>arm::t32</code> — 将函数生成为 T32 “Thumb” 代码。</li>
</ul>
<p>如果将函数的地址作为函数指针，则地址的低位将取决于所选的指令集：</p>
<ul>
<li>对于 <code>arm::a32</code> (“ARM”)，它将为 0。</li>
<li>对于 <code>arm::t32</code> (“Thumb”)，它将为 1。</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="限制-3"><a class="header" href="#限制-3">限制</a></h1>
<p>以下 <a href="#属性-1">属性</a> 影响编译时限制。</p>
<h2 id="recursion_limit属性"><a class="header" href="#recursion_limit属性"><code>recursion_limit</code>属性</a></h2>
<p><em><code>recursion_limit</code> 属性</em> 可以应用于 <a href="#crate与源文件">crate</a> 级别，以设置可能无限递归的编译时操作的最大深度，例如宏展开或自动解引用。</p>
<p>它使用 <a href="#grammar-MetaNameValueStr">MetaNameValueStr</a> 语法格式 来指定递归深度。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 中的默认值为 128。</p>
</blockquote>
</div>

<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span>#![recursion_limit = "4"]

<span class="boring">fn main() {
</span>macro_rules! a {
    () =&gt; { a!(1); };
    (1) =&gt; { a!(2); };
    (2) =&gt; { a!(3); };
    (3) =&gt; { a!(4); };
    (4) =&gt; { };
}

// 此展开失败，因为它需要的递归深度大于 4。
a!{}
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span>#![recursion_limit = "1"]

<span class="boring">fn main() {
</span>// 此失败，因为它需要两个递归步骤才能自动解引用。
(|_: &amp;u8| {})(&amp;&amp;&amp;1);
<span class="boring">}</span></code></pre>
<!-- template:attributes -->
<h2 id="type_length_limit属性"><a class="header" href="#type_length_limit属性"><code>type_length_limit</code>属性</a></h2>
<p><em><code>type_length_limit</code> <a href="#属性-1">属性</a></em> 设置在单态化期间构造具体类型时允许的最大类型替换次数。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 仅在 nightly <code>-Zenforce-type-length-limit</code> 标志处于活动状态时强制执行此限制。</p>
<p>欲了解更多信息，请参阅 <a href="https://github.com/rust-lang/rust/pull/127670">Rust PR #127670</a>。</p>
</blockquote>
</div>

<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<!-- 忽略：在没有 nightly 标志的情况下不强制执行 -->
<pre><code class="language-rust ignore">#![type_length_limit = "4"]

fn f&lt;T&gt;(x: T) {}

// 此编译失败，因为单态化为
// `f::&lt;((((i32,), i32), i32), i32)&gt;` 需要多于
// 4 个类型元素。
f(((((1,), 2), 3), 4));</code></pre>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 中的默认值为 <code>1048576</code>。</p>
</blockquote>
</div>

<p><code>type_length_limit</code> 属性使用 <a href="#grammar-MetaNameValueStr">MetaNameValueStr</a> 语法格式。字符串中的值必须是非负数。</p>
<p><code>type_length_limit</code> 属性只能应用于 crate 根。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 忽略在其他位置的使用，但会对其进行 lint 检查。这在将来可能会成为错误。</p>
</blockquote>
</div>

<p><code>type_length_limit</code> 在 <a href="#grammar-Item">项</a> 上的首次使用才生效。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 会对首次使用之后的任何使用进行 lint 检查。这在将来可能会成为错误。</p>
</blockquote>
</div>

<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-attributes.type-system"><a class="rule-link" href="#r-attributes.type-system" title="attributes.type-system"><span>[attributes<wbr>.type-system]</span></a>
</div>

<h1 id="类型系统属性"><a class="header" href="#类型系统属性">类型系统属性</a></h1>
<p>以下 <a href="#属性-1">属性</a> 用于更改类型的使用方式。</p>
<div class="rule" id="r-attributes.type-system.non_exhaustive"><a class="rule-link" href="#r-attributes.type-system.non_exhaustive" title="attributes.type-system.non_exhaustive"><span>[attributes<wbr>.type-system<wbr>.non_exhaustive]</span></a>
</div>

<h2 id="non_exhaustive属性"><a class="header" href="#non_exhaustive属性"><code>non_exhaustive</code>属性</a></h2>
<div class="rule" id="r-attributes.type-system.non_exhaustive.intro"><a class="rule-link" href="#r-attributes.type-system.non_exhaustive.intro" title="attributes.type-system.non_exhaustive.intro"><span>[attributes<wbr>.type-system<wbr>.non_exhaustive<wbr>.intro]</span></a>
</div>

<p><em>non_exhaustive 属性</em> 表示以后可能会向类型或变体中添加更多字段或变体。</p>
<div class="rule" id="r-attributes.type-system.non_exhaustive.allowed-positions"><a class="rule-link" href="#r-attributes.type-system.non_exhaustive.allowed-positions" title="attributes.type-system.non_exhaustive.allowed-positions"><span>[attributes<wbr>.type-system<wbr>.non_exhaustive<wbr>.allowed-positions]</span></a>
</div>

<p>它可以应用于 <a href="#结构体">结构体</a>、<a href="#枚举">枚举</a> 和 enum 变体。</p>
<div class="rule" id="r-attributes.type-system.non_exhaustive.syntax"><a class="rule-link" href="#r-attributes.type-system.non_exhaustive.syntax" title="attributes.type-system.non_exhaustive.syntax"><span>[attributes<wbr>.type-system<wbr>.non_exhaustive<wbr>.syntax]</span></a>
</div>

<p><code>non_exhaustive</code> 属性使用 <a href="#grammar-MetaWord">MetaWord</a> 语法格式，因此不接受任何输入。</p>
<div class="rule" id="r-attributes.type-system.non_exhaustive.same-crate"><a class="rule-link" href="#r-attributes.type-system.non_exhaustive.same-crate" title="attributes.type-system.non_exhaustive.same-crate"><span>[attributes<wbr>.type-system<wbr>.non_exhaustive<wbr>.same-crate]</span></a>
</div>

<p>在定义它的 crate 内部， <code>non_exhaustive</code> 没有效果。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[non_exhaustive]
pub struct Config {
    pub window_width: u16,
    pub window_height: u16,
}

#[non_exhaustive]
pub struct Token;

#[non_exhaustive]
pub struct Id(pub u64);

#[non_exhaustive]
pub enum Error {
    Message(String),
    Other,
}

pub enum Message {
    #[non_exhaustive] Send { from: u32, to: u32, contents: String },
    #[non_exhaustive] Reaction(u32),
    #[non_exhaustive] Quit,
}

// 在定义它的 crate 内部，可以像往常一样构造非详尽结构体。
let config = Config { window_width: 640, window_height: 480 };
let token = Token;
let id = Id(4);

// 在定义它的 crate 内部，可以对非详尽结构体进行详尽匹配。
let Config { window_width, window_height } = config;
let Token = token;
let Id(id_number) = id;

let error = Error::Other;
let message = Message::Reaction(3);

// 在定义它的 crate 内部，可以对非详尽枚举进行详尽匹配。
match error {
    Error::Message(ref s) =&gt; { },
    Error::Other =&gt; { },
}

match message {
    // 在定义它的 crate 内部，可以对非详尽变体进行详尽匹配。
    Message::Send { from, to, contents } =&gt; { },
    Message::Reaction(id) =&gt; { },
    Message::Quit =&gt; { },
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-attributes.type-system.non_exhaustive.external-crate"><a class="rule-link" href="#r-attributes.type-system.non_exhaustive.external-crate" title="attributes.type-system.non_exhaustive.external-crate"><span>[attributes<wbr>.type-system<wbr>.non_exhaustive<wbr>.external-crate]</span></a>
</div>

<p>在定义它的 crate 之外，带有 <code>non_exhaustive</code> 标注的类型具有一些限制，以便在添加新字段或变体时保持向后兼容性。</p>
<div class="rule" id="r-attributes.type-system.non_exhaustive.construction"><a class="rule-link" href="#r-attributes.type-system.non_exhaustive.construction" title="attributes.type-system.non_exhaustive.construction"><span>[attributes<wbr>.type-system<wbr>.non_exhaustive<wbr>.construction]</span></a>
</div>

<p>在定义它的 crate 之外，无法构造非详尽类型：</p>
<ul>
<li>非详尽变体（ <a href="#结构体">结构体</a> 或 <a href="#枚举">枚举变体</a> ）不能使用 <a href="#grammar-StructExpression">结构体表达式</a> 构造（包括使用 <a href="#函数式更新语法">功能性更新语法格式</a> ）。</li>
<li><a href="#结构体">单元结构体</a> 隐式定义的同名常量，或 <a href="#结构体">元组结构体</a> 的同名构造函数，其 <a href="#可见性和私有性">可见性</a> 不大于 <code>pub(crate)</code> 。
也就是说，如果结构体的可见性是 <code>pub</code> ，那么常量或构造函数的可见性就是 <code>pub(crate)</code> ，否则这两个 <a href="#grammar-Item">项</a> 的可见性相同（就像没有 <code>#[non_exhaustive]</code> 的情况一样）。</li>
<li><a href="#枚举">枚举</a> 实例可以被构造。</li>
</ul>
<p>以下构造示例在定义它的 crate 之外时无法编译：</p>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">// 这些是在上游 crate 中定义并标注为 `#[non_exhaustive]` 的类型。
use upstream::{Config, Token, Id, Error, Message};

// 无法构造 Config 的实例；如果在 upstream 的新版本中添加了新字段，
// 这将导致编译失败，因此是不允许的。
let config = Config { window_width: 640, window_height: 480 };

// 无法构造 Token 的实例；如果添加了新字段，那么
// 它将不再是一个单元结构体，因此由其作为单元结构体创建的
// 同名常量在 crate 外部是不公开的；这段代码无法编译。
let token = Token;

// 无法构造 Id 的实例；如果添加了新字段，那么
// 其构造函数签名将会改变，因此其构造函数
// 在 crate 外部是不公开的；这段代码无法编译。
let id = Id(5);

// 可以构造 Error 的实例；引入新变体
// 不会导致编译失败。
let error = Error::Message("foo".to_string());

// 无法构造 Message::Send 或 Message::Reaction 的实例；
// 如果在 upstream 的新版本中添加了新字段，那么这将会
// 导致编译失败，因此是不允许的。
let message = Message::Send { from: 0, to: 1, contents: "foo".to_string(), };
let message = Message::Reaction(0);

// 无法构造 Message::Quit 的实例；如果这在 upstream 中被转换为
// 元组枚举变体，这将导致编译失败。
let message = Message::Quit;</code></pre>
<div class="rule" id="r-attributes.type-system.non_exhaustive.match"><a class="rule-link" href="#r-attributes.type-system.non_exhaustive.match" title="attributes.type-system.non_exhaustive.match"><span>[attributes<wbr>.type-system<wbr>.non_exhaustive<wbr>.match]</span></a>
</div>

<p>在定义它的 crate 外部匹配非详尽类型时存在一些限制：</p>
<ul>
<li>在对非详尽变体（ <a href="#结构体">结构体</a> 或 <a href="#枚举">枚举变体</a> ）进行模式匹配时，必须使用包含 <code>..</code> 的 <a href="#grammar-StructPattern">结构体模式</a> 。元组枚举变体的构造函数的 <a href="#可见性和私有性">可见性</a> 被降低到不大于 <code>pub(crate)</code> 。</li>
<li>在对非详尽 <a href="#枚举">枚举</a> 进行模式匹配时，匹配某个变体不会对匹配臂的详尽性做出贡献。当在定义它的 crate 之外时，以下匹配示例无法编译：</li>
</ul>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">// 这些是在上游 crate 中定义并标注为 `#[non_exhaustive]` 的类型。
use upstream::{Config, Token, Id, Error, Message};

// 在不包含通配符臂的情况下，无法匹配非详尽枚举。
match error {
  Error::Message(ref s) =&gt; { },
  Error::Other =&gt; { },
  // 使用 `_ =&gt; {},` 可以编译
}

// 在没有通配符的情况下，无法匹配非详尽结构体。
if let Ok(Config { window_width, window_height }) = config {
    // 使用 `..` 可以编译
}

// 除非使用带有通配符的大括号结构体语法，否则
// 无法匹配非详尽单元结构体或元组结构体。
// 这将编译为 `let Token { .. } = token;`
let Token = token;
// 这将编译为 `let Id { 0: id_number, .. } = id;`
let Id(id_number) = id;

match message {
  // 在不包含通配符的情况下，无法匹配非详尽结构体枚举变体。
  Message::Send { from, to, contents } =&gt; { },
  // 无法匹配非详尽元组或单元枚举变体。
  Message::Reaction(type) =&gt; { },
  Message::Quit =&gt; { },
}</code></pre>
<p>也不允许在包含任何非详尽变体的枚举上使用数值转换（ <code>as</code> ）。</p>
<p>例如，可以转换以下枚举，因为它不包含任何非详尽变体：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[non_exhaustive]
pub enum Example {
    First,
    Second
}
<span class="boring">}</span></code></pre>
<p>但是，如果枚举包含哪怕一个非详尽变体，转换也会导致错误。考虑同一枚举的这个修改版本：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[non_exhaustive]
pub enum EnumWithNonExhaustiveVariants {
    First,
    #[non_exhaustive]
    Second
}
<span class="boring">}</span></code></pre>
<!-- ignore: needs multiple crates -->
<pre><code class="language-rust ignore">use othercrate::EnumWithNonExhaustiveVariants;

// 错误：无法转换在另一个 crate 中定义且带有非详尽变体的枚举
let _ = EnumWithNonExhaustiveVariants::First as u8;</code></pre>
<p>在下游 crate 中，非详尽类型始终被视为 inhabited 。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-attributes.debugger"><a class="rule-link" href="#r-attributes.debugger" title="attributes.debugger"><span>[attributes<wbr>.debugger]</span></a>
</div>

<h1 id="调试器属性"><a class="header" href="#调试器属性">调试器属性</a></h1>
<p>以下 <a href="#属性-1">属性</a> 用于在使用 GDB 或 WinDbg 等第三方调试器时增强调试体验。</p>
<!-- template:attributes -->
<div class="rule" id="r-attributes.debugger.debugger_visualizer"><a class="rule-link" href="#r-attributes.debugger.debugger_visualizer" title="attributes.debugger.debugger_visualizer"><span>[attributes<wbr>.debugger<wbr>.debugger_visualizer]</span></a>
</div>

<h2 id="debugger_visualizer属性"><a class="header" href="#debugger_visualizer属性"><code>debugger_visualizer</code>属性</a></h2>
<div class="rule" id="r-attributes.debugger.debugger_visualizer.intro"><a class="rule-link" href="#r-attributes.debugger.debugger_visualizer.intro" title="attributes.debugger.debugger_visualizer.intro"><span>[attributes<wbr>.debugger<wbr>.debugger_visualizer<wbr>.intro]</span></a>
</div>

<p><em><code>debugger_visualizer</code> <a href="#属性-1">属性</a></em> 可用于将调试器可视化工具文件嵌入到调试信息中。这改进了显示值时的调试器体验。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<!-- ignore: requires external files-->
<pre><code class="language-rust ignore">#![debugger_visualizer(natvis_file = "Example.natvis")]
#![debugger_visualizer(gdb_script_file = "example.py")]</code></pre>
</blockquote>
</div>

<div class="rule" id="r-attributes.debugger.debugger_visualizer.syntax"><a class="rule-link" href="#r-attributes.debugger.debugger_visualizer.syntax" title="attributes.debugger.debugger_visualizer.syntax"><span>[attributes<wbr>.debugger<wbr>.debugger_visualizer<wbr>.syntax]</span></a>
</div>

<p><code>debugger_visualizer</code> 属性使用 <a href="#grammar-MetaListNameValueStr">MetaListNameValueStr</a> 语法来指定其输入。必须指定以下键之一：</p>
<ul>
<li><a href="#r-attributes.debugger.debugger_visualizer.natvis"><code>natvis_file</code></a></li>
<li><a href="#r-attributes.debugger.debugger_visualizer.gdb"><code>gdb_script_file</code></a></li>
</ul>
<div class="rule" id="r-attributes.debugger.debugger_visualizer.allowed-positions"><a class="rule-link" href="#r-attributes.debugger.debugger_visualizer.allowed-positions" title="attributes.debugger.debugger_visualizer.allowed-positions"><span>[attributes<wbr>.debugger<wbr>.debugger_visualizer<wbr>.allowed-positions]</span></a>
</div>

<p><code>debugger_visualizer</code> 属性只能应用于 <a href="#模块">模块</a> 或 crate 根。</p>
<div class="rule" id="r-attributes.debugger.debugger_visualizer.duplicates"><a class="rule-link" href="#r-attributes.debugger.debugger_visualizer.duplicates" title="attributes.debugger.debugger_visualizer.duplicates"><span>[attributes<wbr>.debugger<wbr>.debugger_visualizer<wbr>.duplicates]</span></a>
</div>

<p><code>debugger_visualizer</code> 属性可以在一个形式上使用任意多次。所有指定的可视化工具文件都将被加载。</p>
<div class="rule" id="r-attributes.debugger.debugger_visualizer.natvis"><a class="rule-link" href="#r-attributes.debugger.debugger_visualizer.natvis" title="attributes.debugger.debugger_visualizer.natvis"><span>[attributes<wbr>.debugger<wbr>.debugger_visualizer<wbr>.natvis]</span></a>
</div>

<h3 id="将debugger_visualizer与natvis结合使用"><a class="header" href="#将debugger_visualizer与natvis结合使用">将<code>debugger_visualizer</code>与Natvis结合使用</a></h3>
<div class="rule" id="r-attributes.debugger.debugger_visualizer.natvis.intro"><a class="rule-link" href="#r-attributes.debugger.debugger_visualizer.natvis.intro" title="attributes.debugger.debugger_visualizer.natvis.intro"><span>[attributes<wbr>.debugger<wbr>.debugger_visualizer<wbr>.natvis<wbr>.intro]</span></a>
</div>

<p>Natvis 是一个基于 XML 的框架，适用于 Microsoft 调试器（如 Visual Studio 和 WinDbg），它使用声明性规则来自定义类型的显示。有关 Natvis 格式的详细信息，请参阅 Microsoft 的 <a href="https://docs.microsoft.com/en-us/visualstudio/debugger/create-custom-views-of-native-objects">Natvis 文档</a>。</p>
<div class="rule" id="r-attributes.debugger.debugger_visualizer.natvis.msvc"><a class="rule-link" href="#r-attributes.debugger.debugger_visualizer.natvis.msvc" title="attributes.debugger.debugger_visualizer.natvis.msvc"><span>[attributes<wbr>.debugger<wbr>.debugger_visualizer<wbr>.natvis<wbr>.msvc]</span></a>
</div>

<p>此属性仅支持在 <code>-windows-msvc</code> 目标上嵌入 Natvis 文件。</p>
<div class="rule" id="r-attributes.debugger.debugger_visualizer.natvis.path"><a class="rule-link" href="#r-attributes.debugger.debugger_visualizer.natvis.path" title="attributes.debugger.debugger_visualizer.natvis.path"><span>[attributes<wbr>.debugger<wbr>.debugger_visualizer<wbr>.natvis<wbr>.path]</span></a>
</div>

<p>Natvis 文件的路径由 <code>natvis_file</code> 键指定，该路径是相对于源文件的路径。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<!-- ignore: requires external files and msvc -->
<pre><code class="language-rust ignore">#![debugger_visualizer(natvis_file = "Rectangle.natvis")]

struct FancyRect {
    x: f32,
    y: f32,
    dx: f32,
    dy: f32,
}

fn main() {
    let fancy_rect = FancyRect { x: 10.0, y: 10.0, dx: 5.0, dy: 5.0 };
    println!("在此设置断点");
}</code></pre>
<p><code>Rectangle.natvis</code> 包含：</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;AutoVisualizer xmlns="http://schemas.microsoft.com/vstudio/debugger/natvis/2010"&gt;
    &lt;Type Name="foo::FancyRect"&gt;
      &lt;DisplayString&gt;({x},{y}) + ({dx}, {dy})&lt;/DisplayString&gt;
      &lt;Expand&gt;
        &lt;Synthetic Name="LowerLeft"&gt;
          &lt;DisplayString&gt;({x}, {y})&lt;/DisplayString&gt;
        &lt;/Synthetic&gt;
        &lt;Synthetic Name="UpperLeft"&gt;
          &lt;DisplayString&gt;({x}, {y + dy})&lt;/DisplayString&gt;
        &lt;/Synthetic&gt;
        &lt;Synthetic Name="UpperRight"&gt;
          &lt;DisplayString&gt;({x + dx}, {y + dy})&lt;/DisplayString&gt;
        &lt;/Synthetic&gt;
        &lt;Synthetic Name="LowerRight"&gt;
          &lt;DisplayString&gt;({x + dx}, {y})&lt;/DisplayString&gt;
        &lt;/Synthetic&gt;
      &lt;/Expand&gt;
    &lt;/Type&gt;
&lt;/AutoVisualizer&gt;
</code></pre>
<p>在 WinDbg 下查看时，<code>fancy_rect</code> 变量将显示如下：</p>
<pre><code class="language-text">&gt; Variables:
  &gt; fancy_rect: (10.0, 10.0) + (5.0, 5.0)
    &gt; LowerLeft: (10.0, 10.0)
    &gt; UpperLeft: (10.0, 15.0)
    &gt; UpperRight: (15.0, 15.0)
    &gt; LowerRight: (15.0, 10.0)
</code></pre>
</blockquote>
</div>

<div class="rule" id="r-attributes.debugger.debugger_visualizer.gdb"><a class="rule-link" href="#r-attributes.debugger.debugger_visualizer.gdb" title="attributes.debugger.debugger_visualizer.gdb"><span>[attributes<wbr>.debugger<wbr>.debugger_visualizer<wbr>.gdb]</span></a>
</div>

<h3 id="将debugger_visualizer与gdb结合使用"><a class="header" href="#将debugger_visualizer与gdb结合使用">将<code>debugger_visualizer</code>与GDB结合使用</a></h3>
<div class="rule" id="r-attributes.debugger.debugger_visualizer.gdb.pretty"><a class="rule-link" href="#r-attributes.debugger.debugger_visualizer.gdb.pretty" title="attributes.debugger.debugger_visualizer.gdb.pretty"><span>[attributes<wbr>.debugger<wbr>.debugger_visualizer<wbr>.gdb<wbr>.pretty]</span></a>
</div>

<p>GDB 支持使用结构化的 Python 脚本，称为 <em>pretty printer</em>，它描述了类型应如何在调试器视图中可视化。有关 pretty printer 的详细信息，请参阅 GDB 的 <a href="https://sourceware.org/gdb/onlinedocs/gdb/Pretty-Printing.html">pretty printing 文档</a>。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>在 GDB 下调试二进制文件时，嵌入式 pretty printer 不会自动加载。</p>
<p>有两种方法可以启用自动加载嵌入式 pretty printer：</p>
<ol>
<li>启动 GDB 时带上额外参数，以显式添加目录或二进制文件到自动加载安全路径：<code>gdb -iex "add-auto-load-safe-path safe-path path/to/binary" path/to/binary</code>。有关更多信息，请参阅 GDB 的 <a href="https://sourceware.org/gdb/onlinedocs/gdb/Auto_002dloading-safe-path.html">auto-loading 文档</a>。</li>
<li>在 <code>$HOME/.config/gdb</code> 下创建一个名为 <code>gdbinit</code> 的文件（如果目录不存在，您可能需要创建它）。在该文件中添加以下行：<code>add-auto-load-safe-path path/to/binary</code>。</li>
</ol>
</blockquote>
</div>

<div class="rule" id="r-attributes.debugger.debugger_visualizer.gdb.path"><a class="rule-link" href="#r-attributes.debugger.debugger_visualizer.gdb.path" title="attributes.debugger.debugger_visualizer.gdb.path"><span>[attributes<wbr>.debugger<wbr>.debugger_visualizer<wbr>.gdb<wbr>.path]</span></a>
</div>

<p>这些脚本使用 <code>gdb_script_file</code> 键嵌入，该键是相对于源文件的路径。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<!-- ignore: requires external files -->
<pre><code class="language-rust ignore">#![debugger_visualizer(gdb_script_file = "printer.py")]

struct Person {
    name: String,
    age: i32,
}

fn main() {
    let bob = Person { name: String::from("Bob"), age: 10 };
    println!("在此设置断点");
}</code></pre>
<p><code>printer.py</code> 包含：</p>
<pre><code class="language-python">import gdb

class PersonPrinter:
    "打印一个 Person"

    def __init__(self, val):
        self.val = val
        self.name = val["name"]
        self.age = int(val["age"])

    def to_string(self):
        return "{} is {} years old.".format(self.name, self.age)

def lookup(val):
    lookup_tag = val.type.tag
    if lookup_tag is None:
        return None
    if "foo::Person" == lookup_tag:
        return PersonPrinter(val)

    return None

gdb.current_objfile().pretty_printers.append(lookup)
</code></pre>
<p>当 crate 的调试可执行文件传递给 GDB<sup class="footnote-reference" id="fr-rust-gdb-1"><a href="#footnote-rust-gdb">1</a></sup> 时，<code>print bob</code> 将显示：</p>
<pre><code class="language-text">"Bob" is 10 years old.
</code></pre>
</blockquote>
</div>

<!-- template:attributes -->
<div class="rule" id="r-attributes.debugger.collapse_debuginfo"><a class="rule-link" href="#r-attributes.debugger.collapse_debuginfo" title="attributes.debugger.collapse_debuginfo"><span>[attributes<wbr>.debugger<wbr>.collapse_debuginfo]</span></a>
</div>

<h2 id="collapse_debuginfo属性"><a class="header" href="#collapse_debuginfo属性"><code>collapse_debuginfo</code>属性</a></h2>
<div class="rule" id="r-attributes.debugger.collapse_debuginfo.intro"><a class="rule-link" href="#r-attributes.debugger.collapse_debuginfo.intro" title="attributes.debugger.collapse_debuginfo.intro"><span>[attributes<wbr>.debugger<wbr>.collapse_debuginfo<wbr>.intro]</span></a>
</div>

<p><em><code>collapse_debuginfo</code> <a href="#属性-1">属性</a></em> 控制在为调用此宏的代码生成调试信息时，是否将来自宏定义的代码位置折叠到与宏的调用点关联的单个位置。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[collapse_debuginfo(yes)]
macro_rules! example {
    () =&gt; {
        println!("你好！");
    };
}
<span class="boring">}</span></code></pre>
<p>当使用调试器时，调用 <code>example</code> 宏可能看起来像是调用一个函数。也就是说，当您单步执行到调用点时，它可能会显示宏调用而不是展开的代码。</p>
</blockquote>
</div>

<!-- TODO: I think it would be nice to extend this to explain a little more about why this is useful, and the kinds of scenarios where you would want one vs the other. See https://github.com/rust-lang/rfcs/pull/2117 for some guidance. -->
<div class="rule" id="r-attributes.debugger.collapse_debuginfo.syntax"><a class="rule-link" href="#r-attributes.debugger.collapse_debuginfo.syntax" title="attributes.debugger.collapse_debuginfo.syntax"><span>[attributes<wbr>.debugger<wbr>.collapse_debuginfo<wbr>.syntax]</span></a>
</div>

<p><code>collapse_debuginfo</code> 属性的 语法格式 是：</p>
<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-CollapseDebuginfoAttribute" onclick="show_railroad()"><a href="#railroad-CollapseDebuginfoAttribute">CollapseDebuginfoAttribute</a></span> → <span class="grammar-literal">collapse_debuginfo</span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-CollapseDebuginfoOption">CollapseDebuginfoOption</a></span> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-CollapseDebuginfoOption" onclick="show_railroad()"><a href="#railroad-CollapseDebuginfoOption">CollapseDebuginfoOption</a></span> → <br>      <span class="grammar-literal">yes</span> <br>    | <span class="grammar-literal">no</span> <br>    | <span class="grammar-literal">external</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 532px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-CollapseDebuginfoAttribute"><svg class="railroad" viewbox="0 0 532 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-CollapseDebuginfoAttribute">
<text class="comment" x="109" y="25">
CollapseDebuginfoAttribute</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="164" x="35" y="42" />
<text x="117" y="58">
collapse_debuginfo</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="209" y="42" />
<text x="223" y="58">
(</text>
</g>
<a class="link" xlink:href="#railroad-CollapseDebuginfoOption">
<g class="nonterminal">
<rect height="22" width="212" x="247" y="42" />
<text x="353" y="58">
CollapseDebuginfoOption</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="469" y="42" />
<text x="483" y="58">
)</text>
</g>
<path d=" M 199 53 h 10" />
<path d=" M 237 53 h 10" />
<path d=" M 459 53 h 10" />
</g>
<path d=" M 507 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 497 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 202px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-CollapseDebuginfoOption"><svg class="railroad" viewbox="0 0 202 140" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-CollapseDebuginfoOption">
<text class="comment" x="99" y="25">
CollapseDebuginfoOption</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 44 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="42" />
<text x="81" y="58">
yes</text>
</g>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 108 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 108 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 36 0 h 48 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="75" />
<text x="77" y="91">
no</text>
</g>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 84 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="84" x="59" y="108" />
<text x="101" y="124">
external</text>
</g>
</g>
<path d=" M 177 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 167 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-attributes.debugger.collapse_debuginfo.allowed-positions"><a class="rule-link" href="#r-attributes.debugger.collapse_debuginfo.allowed-positions" title="attributes.debugger.collapse_debuginfo.allowed-positions"><span>[attributes<wbr>.debugger<wbr>.collapse_debuginfo<wbr>.allowed-positions]</span></a>
</div>

<p><code>collapse_debuginfo</code> 属性只能应用于 <a href="#声明宏"><code>macro_rules</code> 定义</a>。</p>
<div class="rule" id="r-attributes.debugger.collapse_debuginfo.duplicates"><a class="rule-link" href="#r-attributes.debugger.collapse_debuginfo.duplicates" title="attributes.debugger.collapse_debuginfo.duplicates"><span>[attributes<wbr>.debugger<wbr>.collapse_debuginfo<wbr>.duplicates]</span></a>
</div>

<p><code>collapse_debuginfo</code> 属性在一个宏上只能使用一次。</p>
<div class="rule" id="r-attributes.debugger.collapse_debuginfo.options"><a class="rule-link" href="#r-attributes.debugger.collapse_debuginfo.options" title="attributes.debugger.collapse_debuginfo.options"><span>[attributes<wbr>.debugger<wbr>.collapse_debuginfo<wbr>.options]</span></a>
</div>

<p><code>collapse_debuginfo</code> 属性接受以下选项：</p>
<ul>
<li><code>#[collapse_debuginfo(yes)]</code> — 调试信息中的代码位置被折叠。</li>
<li><code>#[collapse_debuginfo(no)]</code> — 调试信息中的代码位置不被折叠。</li>
<li><code>#[collapse_debuginfo(external)]</code> — 仅当宏来自不同的 crate 时，调试信息中的代码位置才被折叠。</li>
</ul>
<div class="rule" id="r-attributes.debugger.collapse_debuginfo.default"><a class="rule-link" href="#r-attributes.debugger.collapse_debuginfo.default" title="attributes.debugger.collapse_debuginfo.default"><span>[attributes<wbr>.debugger<wbr>.collapse_debuginfo<wbr>.default]</span></a>
</div>

<p>对于没有此属性的宏，<code>external</code> 行为是默认值，除非它们是内置宏。对于内置宏，默认值是 <code>yes</code>。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 有一个 <a href="https://doc.rust-lang.org/rustc/codegen-options/index.html#collapse-macro-debuginfo"><code>-C collapse-macro-debuginfo</code></a> CLI 选项，可以覆盖默认行为以及任何 <code>#[collapse_debuginfo]</code> 属性的值。</p>
</blockquote>
</div>

<hr>
<ol class="footnote-definition">
<li id="footnote-rust-gdb">
<p>注意：这假设您正在使用 <code>rust-gdb</code> 脚本，该脚本为 <code>String</code> 等标准库类型配置了 pretty printer。 <a href="#fr-rust-gdb-1">↩</a></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-stmt-expr"><a class="rule-link" href="#r-stmt-expr" title="stmt-expr"><span>[stmt-expr]</span></a>
</div>

<h1 id="语句与表达式"><a class="header" href="#语句与表达式">语句与表达式</a></h1>
<p>Rust <em>主要</em> 是一种表达式语言。这意味着大多数产生值或产生副作用的求值形式都由 <em>表达式</em> 这一统一的 语法格式 类别引导。每种表达式通常都可以 <em>嵌套</em> 在另一种表达式中，表达式的求值规则包括指定表达式产生的值以及其子表达式本身的求值顺序。</p>
<p>相比之下，语句的用途 <em>主要</em> 是包含表达式求值并明确其顺序。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-statement"><a class="rule-link" href="#r-statement" title="statement"><span>[statement]</span></a>
</div>

<h1 id="语句"><a class="header" href="#语句">语句</a></h1>
<div class="rule" id="r-statement.syntax"><a class="rule-link" href="#r-statement.syntax" title="statement.syntax"><span>[statement<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-Statement" onclick="show_railroad()"><a href="#railroad-Statement">Statement</a></span> → <br>      <span class="grammar-literal">;</span> <br>    | <span class="grammar-text"><a href="#grammar-Item">Item</a></span> <br>    | <span class="grammar-text"><a href="#grammar-LetStatement">LetStatement</a></span> <br>    | <span class="grammar-text"><a href="#grammar-ExpressionStatement">ExpressionStatement</a></span> <br>    | <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> <span class="grammar-text"><a href="#grammar-MacroInvocationSemi">MacroInvocationSemi</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 504px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Statement"><svg class="railroad" viewbox="0 0 504 231" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Statement">
<text class="comment" x="46" y="25">
Statement</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 28 0 h 382 m -188 0 l -5 -5 m 0 10 l 5 -5 m 188 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="42" />
<text x="73" y="58">
;</text>
</g>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 410 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 410 0 v -33" />
<path d=" M 47 107 v 33 m 410 0 v -33" />
<path d=" M 47 140 v 33 m 410 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 52 0 h 334 m -164 0 l -5 -5 m 0 10 l 5 -5 m 164 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Item">
<g class="nonterminal">
<rect height="22" width="52" x="59" y="75" />
<text x="85" y="91">
Item</text>
</g>
</a>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 116 0 h 270 m -132 0 l -5 -5 m 0 10 l 5 -5 m 132 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-LetStatement">
<g class="nonterminal">
<rect height="22" width="116" x="59" y="108" />
<text x="117" y="124">
LetStatement</text>
</g>
</a>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 172 0 h 214 m -104 0 l -5 -5 m 0 10 l 5 -5 m 104 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ExpressionStatement">
<g class="nonterminal">
<rect height="22" width="172" x="59" y="141" />
<text x="145" y="157">
ExpressionStatement</text>
</g>
</a>
</g>
<path d=" M 47 173 v 12 a 12 12 0 0 0 12 12 m 386 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="optional">
<path d=" M 59 197 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 83 197 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="95" y="186" />
<text x="161" y="202">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<a class="link" xlink:href="#railroad-MacroInvocationSemi">
<g class="nonterminal">
<rect height="22" width="172" x="273" y="186" />
<text x="359" y="202">
MacroInvocationSemi</text>
</g>
</a>
<path d=" M 263 197 h 10" />
</g>
</g>
<path d=" M 479 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 469 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-statement.intro"><a class="rule-link" href="#r-statement.intro" title="statement.intro"><span>[statement<wbr>.intro]</span></a>
</div>

<p><em>语句 (statement)</em> 是 <a href="#块表达式">块</a> 的组成部分，而块又是外部 <a href="#表达式">表达式</a> 或 <a href="#函数">函数</a> 的组成部分。</p>
<div class="rule" id="r-statement.kind"><a class="rule-link" href="#r-statement.kind" title="statement.kind"><span>[statement<wbr>.kind]</span></a>
</div>

<p>Rust 有两种语句： <a href="#declaration-statements">声明语句</a> 和 <a href="#expression-statements">表达式语句</a>。</p>
<div class="rule" id="r-statement.decl"><a class="rule-link" href="#r-statement.decl" title="statement.decl"><span>[statement<wbr>.decl]</span></a>
</div>

<h2 id="声明语句"><a class="header" href="#声明语句">声明语句</a></h2>
<p><em>声明语句</em> 是指在封闭的语句块中引入一个或多个 <em>名称</em> 的语句。声明的名称可能表示新变量或新 <a href="#项">项</a>。</p>
<p>两种声明语句分别是项声明和 <code>let</code> 语句。</p>
<div class="rule" id="r-statement.item"><a class="rule-link" href="#r-statement.item" title="statement.item"><span>[statement<wbr>.item]</span></a>
</div>

<h3 id="项声明"><a class="header" href="#项声明">项声明</a></h3>
<div class="rule" id="r-statement.item.intro"><a class="rule-link" href="#r-statement.item.intro" title="statement.item.intro"><span>[statement<wbr>.item<wbr>.intro]</span></a>
</div>

<p><em>项声明语句</em> 的 语法格式 与 <a href="#模块">模块</a> 中的 <a href="#项">项声明</a> 相同。</p>
<div class="rule" id="r-statement.item.scope"><a class="rule-link" href="#r-statement.item.scope" title="statement.item.scope"><span>[statement<wbr>.item<wbr>.scope]</span></a>
</div>

<p>在语句块中声明项会将其 <a href="#作用域">作用域</a> 限制在包含该语句的块中。该项及其可能声明的任何子项都不会被赋予 <a href="#canonical-paths">规范路径</a>。</p>
<div class="rule" id="r-statement.item.associated-scope"><a class="rule-link" href="#r-statement.item.associated-scope" title="statement.item.associated-scope"><span>[statement<wbr>.item<wbr>.associated-scope]</span></a>
</div>

<p>此规则的例外是，只要项以及（如果适用） 特型 是可访问的，由 <a href="#实现">实现</a> 定义的关联项在外部作用域中仍然是可访问的。在其他方面的含义与在模块内部声明该项相同。</p>
<div class="rule" id="r-statement.item.outer-generics"><a class="rule-link" href="#r-statement.item.outer-generics" title="statement.item.outer-generics"><span>[statement<wbr>.item<wbr>.outer-generics]</span></a>
</div>

<p>不会隐式捕获包含函数的 泛型 参数、参数和局部变量。例如， <code>inner</code> 无法访问 <code>outer_var</code>。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn outer() {
  let outer_var = true;

  fn inner() { /* outer_var 在此处不在作用域内 */ }

  inner();
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-statement.let"><a class="rule-link" href="#r-statement.let" title="statement.let"><span>[statement<wbr>.let]</span></a>
</div>

<h3 id="let语句"><a class="header" href="#let语句"><code>let</code>语句</a></h3>
<div class="rule" id="r-statement.let.syntax"><a class="rule-link" href="#r-statement.let.syntax" title="statement.let.syntax"><span>[statement<wbr>.let<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-LetStatement" onclick="show_railroad()"><a href="#railroad-LetStatement">LetStatement</a></span> → <br>    <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> <span class="grammar-literal">let</span> <span class="grammar-text"><a href="#grammar-PatternNoTopAlt">PatternNoTopAlt</a></span> ( <span class="grammar-literal">:</span> <span class="grammar-text"><a href="#grammar-Type">Type</a></span> )<sup>?</sup> <br>    ( <br>          <span class="grammar-literal">=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>        | <span class="grammar-literal">=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span><sub class="grammar-text">except <a href="#grammar-LazyBooleanExpression">LazyBooleanExpression</a> or end with a <code>}</code></sub> <span class="grammar-literal">else</span> <span class="grammar-text"><a href="#grammar-BlockExpression">BlockExpression</a></span> <br>    )<sup>?</sup> <span class="grammar-literal">;</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 852px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-LetStatement"><svg class="railroad" viewbox="0 0 852 235" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-LetStatement">
<text class="comment" x="57" y="25">
LetStatement</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="stack">
<path d=" M 35 66 h 12" />
<path d=" M 603 66 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 1 -12 12 h -556 m 281 0 l 5 -5 m 0 10 l -5 -5 m -281 0 a 12 12 0 0 0 -12 12 v 12 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="optional">
<path d=" M 47 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 71 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="83" y="55" />
<text x="149" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="261" y="55" />
<text x="283" y="71">
let</text>
</g>
<a class="link" xlink:href="#railroad-PatternNoTopAlt">
<g class="nonterminal">
<rect height="22" width="140" x="315" y="55" />
<text x="385" y="71">
PatternNoTopAlt</text>
</g>
</a>
<g class="optional">
<path d=" M 465 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 90 m -42 0 l -5 -5 m 0 10 l 5 -5 m 42 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="489" y="55" />
<text x="503" y="71">
:</text>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="527" y="55" />
<text x="553" y="71">
Type</text>
</g>
</a>
<path d=" M 517 66 h 10" />
</g>
</g>
<path d=" M 251 66 h 10" />
<path d=" M 305 66 h 10" />
<path d=" M 455 66 h 10" />
</g>
<path d=" M 793 138 h 0 a 12 12 0 0 0 12 -12 v -48 a 12 12 0 0 1 12 -12" />
<g class="sequence">
<g class="optional">
<path d=" M 47 138 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 660 m -327 0 l -5 -5 m 0 10 l 5 -5 m 327 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="choice">
<path d=" M 71 138 h 24 m 138 0 h 498 m -246 0 l -5 -5 m 0 10 l 5 -5 m 246 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="95" y="127" />
<text x="109" y="143">
=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="133" y="127" />
<text x="183" y="143">
Expression</text>
</g>
</a>
<path d=" M 123 138 h 10" />
</g>
<path d=" M 71 138 a 12 12 0 0 1 12 12 v 9 m 636 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 83 159 v 35 a 12 12 0 0 0 12 12 m 612 0 h 0 a 12 12 0 0 0 12 -12 v -35" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="95" y="195" />
<text x="109" y="211">
=</text>
</g>
<g class="labeledbox">
<rect height="66" width="362" x="133" y="159" />
<path d=" M 133 206 h 8 m 100 0 h 254 m -124 0 l -5 -5 m 0 10 l 5 -5 m 124 0" />
<text class="comment" x="314" y="182">
except LazyBooleanExpression or end with a `}`</text>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="141" y="195" />
<text x="191" y="211">
Expression</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="505" y="195" />
<text x="531" y="211">
else</text>
</g>
<a class="link" xlink:href="#railroad-BlockExpression">
<g class="nonterminal">
<rect height="22" width="140" x="567" y="195" />
<text x="637" y="211">
BlockExpression</text>
</g>
</a>
<path d=" M 123 206 h 10" />
<path d=" M 495 206 h 10" />
<path d=" M 557 206 h 10" />
</g>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="765" y="127" />
<text x="779" y="143">
;</text>
</g>
<path d=" M 755 138 h 10" />
</g>
</g>
<path d=" M 827 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 817 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-statement.let.intro"><a class="rule-link" href="#r-statement.let.intro" title="statement.let.intro"><span>[statement<wbr>.let<wbr>.intro]</span></a>
</div>

<ul>
<li><code>let</code> 语句* 通过 <a href="#模式">模式</a> 引入一组新 <a href="#变量">变量</a>。模式后面可以跟一个可选的类型标注，然后要么结束，要么后面跟一个初始化表达式以及一个可选的 <code>else</code> 块。</li>
</ul>
<div class="rule" id="r-statement.let.inference"><a class="rule-link" href="#r-statement.let.inference" title="statement.let.inference"><span>[statement<wbr>.let<wbr>.inference]</span></a>
</div>

<p>如果未给出类型标注，编译器将推断类型；如果没有足够的类型信息进行明确推断，则报错。</p>
<div class="rule" id="r-statement.let.scope"><a class="rule-link" href="#r-statement.let.scope" title="statement.let.scope"><span>[statement<wbr>.let<wbr>.scope]</span></a>
</div>

<p>由变量声明引入的任何变量从声明点到封闭块作用域结束都是可见的，除非它们被另一个变量声明遮蔽。</p>
<div class="rule" id="r-statement.let.constraint"><a class="rule-link" href="#r-statement.let.constraint" title="statement.let.constraint"><span>[statement<wbr>.let<wbr>.constraint]</span></a>
</div>

<p>如果没有 <code>else</code> 块，模式必须是不可驳回的。如果有 <code>else</code> 块，模式可以是可驳回的。</p>
<div class="rule" id="r-statement.let.behavior"><a class="rule-link" href="#r-statement.let.behavior" title="statement.let.behavior"><span>[statement<wbr>.let<wbr>.behavior]</span></a>
</div>

<p>如果模式不匹配（这要求它是可驳回的），则执行 <code>else</code> 块。 <code>else</code> 块必须始终发散（求值为 <a href="#never类型">never 类型</a>）。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let (mut v, w) = (vec![1, 2, 3], 42); // 绑定可以是 mut 或 const
let Some(t) = v.pop() else { // 可驳回模式需要 else 块
    panic!(); // else 块必须发散
};
let [u, v] = [v[0], v[1]] else { // 此模式是不可驳回的，因此编译器
                                 // 会发出 lint，因为 else 块是多余的。
    panic!();
};
<span class="boring">}</span></code></pre>
<div class="rule" id="r-statement.expr"><a class="rule-link" href="#r-statement.expr" title="statement.expr"><span>[statement<wbr>.expr]</span></a>
</div>

<h2 id="表达式语句"><a class="header" href="#表达式语句">表达式语句</a></h2>
<div class="rule" id="r-statement.expr.syntax"><a class="rule-link" href="#r-statement.expr.syntax" title="statement.expr.syntax"><span>[statement<wbr>.expr<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ExpressionStatement" onclick="show_railroad()"><a href="#railroad-ExpressionStatement">ExpressionStatement</a></span> → <br>      <span class="grammar-text"><a href="#grammar-ExpressionWithoutBlock">ExpressionWithoutBlock</a></span> <span class="grammar-literal">;</span> <br>    | <span class="grammar-text"><a href="#grammar-ExpressionWithBlock">ExpressionWithBlock</a></span> <span class="grammar-literal">;</span><sup>?</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 376px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ExpressionStatement"><svg class="railroad" viewbox="0 0 376 119" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ExpressionStatement">
<text class="comment" x="81" y="25">
ExpressionStatement</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 242 0 h 40" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ExpressionWithoutBlock">
<g class="nonterminal">
<rect height="22" width="204" x="59" y="42" />
<text x="161" y="58">
ExpressionWithoutBlock</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="273" y="42" />
<text x="287" y="58">
;</text>
</g>
<path d=" M 263 53 h 10" />
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 282 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 12 a 12 12 0 0 0 12 12 m 258 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ExpressionWithBlock">
<g class="nonterminal">
<rect height="22" width="172" x="59" y="87" />
<text x="145" y="103">
ExpressionWithBlock</text>
</g>
</a>
<g class="optional">
<path d=" M 241 98 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="265" y="87" />
<text x="279" y="103">
;</text>
</g>
</g>
<path d=" M 231 98 h 10" />
</g>
</g>
<path d=" M 351 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 341 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-statement.expr.intro"><a class="rule-link" href="#r-statement.expr.intro" title="statement.expr.intro"><span>[statement<wbr>.expr<wbr>.intro]</span></a>
</div>

<p><em>表达式语句</em> 是指对 <a href="#表达式">表达式</a> 求值并忽略其结果的语句。通常，表达式语句的目的是触发其表达式求值的副作用。</p>
<div class="rule" id="r-statement.expr.restriction-semicolon"><a class="rule-link" href="#r-statement.expr.restriction-semicolon" title="statement.expr.restriction-semicolon"><span>[statement<wbr>.expr<wbr>.restriction-semicolon]</span></a>
</div>

<p>在允许使用语句的上下文中，仅由 <a href="#块表达式">块表达式</a> 或控制流表达式组成的表达式可以省略末尾的分号。这可能会导致将其解析为独立语句还是解析为另一个表达式的一部分之间产生歧义；在这种情况下，它被解析为语句。</p>
<div class="rule" id="r-statement.expr.constraint-block"><a class="rule-link" href="#r-statement.expr.constraint-block" title="statement.expr.constraint-block"><span>[statement<wbr>.expr<wbr>.constraint-block]</span></a>
</div>

<p>当 <a href="#grammar-ExpressionWithBlock">ExpressionWithBlock</a> 表达式用作语句时，其类型必须是单元类型。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">let mut v = vec![1, 2, 3];
</span>v.pop();          // 忽略 pop 返回的元素
if v.is_empty() {
    v.push(5);
} else {
    v.remove(0);
}                 // 分号可以省略。
[1];              // 独立的表达式语句，不是索引表达式。
<span class="boring">}</span></code></pre>
<p>当省略末尾分号时，结果必须是类型 <code>()</code>。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 错误：块的类型是 i32，而不是 ()
// Error: expected `()` because of default return type
// if true {
//   1
// }

// 正确：块的类型是 i32
if true {
  1
} else {
  2
};
<span class="boring">}</span></code></pre>
<div class="rule" id="r-statement.attribute"><a class="rule-link" href="#r-statement.attribute" title="statement.attribute"><span>[statement<wbr>.attribute]</span></a>
</div>

<h2 id="语句上的属性"><a class="header" href="#语句上的属性">语句上的属性</a></h2>
<p>语句接受 <a href="#属性-1">外部属性</a>。在语句上有意义的属性是 <a href="#条件编译"><code>cfg</code></a> 和 <a href="#lint-check-attributes">lint 检查属性</a>。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr"><a class="rule-link" href="#r-expr" title="expr"><span>[expr]</span></a>
</div>

<h1 id="表达式"><a class="header" href="#表达式">表达式</a></h1>
<div class="rule" id="r-expr.syntax"><a class="rule-link" href="#r-expr.syntax" title="expr.syntax"><span>[expr<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-Expression" onclick="show_railroad()"><a href="#railroad-Expression">Expression</a></span> → <br>      <span class="grammar-text"><a href="#grammar-ExpressionWithoutBlock">ExpressionWithoutBlock</a></span> <br>    | <span class="grammar-text"><a href="#grammar-ExpressionWithBlock">ExpressionWithBlock</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-ExpressionWithoutBlock" onclick="show_railroad()"><a href="#railroad-ExpressionWithoutBlock">ExpressionWithoutBlock</a></span> → <br>    <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> <br>    ( <br>        <span class="grammar-text"><a href="#grammar-LiteralExpression">LiteralExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-PathExpression">PathExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-OperatorExpression">OperatorExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-GroupedExpression">GroupedExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-ArrayExpression">ArrayExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-AwaitExpression">AwaitExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-IndexExpression">IndexExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-TupleExpression">TupleExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-TupleIndexingExpression">TupleIndexingExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-StructExpression">StructExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-CallExpression">CallExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-MethodCallExpression">MethodCallExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-FieldExpression">FieldExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-ClosureExpression">ClosureExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-AsyncBlockExpression">AsyncBlockExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-ContinueExpression">ContinueExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-BreakExpression">BreakExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-RangeExpression">RangeExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-ReturnExpression">ReturnExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-UnderscoreExpression">UnderscoreExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-MacroInvocation">MacroInvocation</a></span> <br>    )</p>
<p><span class="grammar-text grammar-production" id="grammar-ExpressionWithBlock" onclick="show_railroad()"><a href="#railroad-ExpressionWithBlock">ExpressionWithBlock</a></span> → <br>    <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> <br>    ( <br>        <span class="grammar-text"><a href="#grammar-BlockExpression">BlockExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-ConstBlockExpression">ConstBlockExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-UnsafeBlockExpression">UnsafeBlockExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-LoopExpression">LoopExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-IfExpression">IfExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-MatchExpression">MatchExpression</a></span> <br>    )</p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 322px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Expression"><svg class="railroad" viewbox="0 0 322 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Expression">
<text class="comment" x="50" y="25">
Expression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 204 0 h 24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ExpressionWithoutBlock">
<g class="nonterminal">
<rect height="22" width="204" x="59" y="42" />
<text x="161" y="58">
ExpressionWithoutBlock</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 228 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 172 0 h 32 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-ExpressionWithBlock">
<g class="nonterminal">
<rect height="22" width="172" x="59" y="75" />
<text x="145" y="91">
ExpressionWithBlock</text>
</g>
</a>
</g>
<path d=" M 297 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 287 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 544px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ExpressionWithoutBlock"><svg class="railroad" viewbox="0 0 544 747" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ExpressionWithoutBlock">
<text class="comment" x="95" y="25">
ExpressionWithoutBlock</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<g class="choice">
<path d=" M 249 66 h 24 m 156 0 h 80 m -37 0 l -5 -5 m 0 10 l 5 -5 m 37 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-LiteralExpression">
<g class="nonterminal">
<rect height="22" width="156" x="273" y="55" />
<text x="351" y="71">
LiteralExpression</text>
</g>
</a>
</g>
<path d=" M 249 66 a 12 12 0 0 1 12 12 v 9 m 236 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 261 87 v 33 m 236 0 v -33" />
<path d=" M 261 120 v 33 m 236 0 v -33" />
<path d=" M 261 153 v 33 m 236 0 v -33" />
<path d=" M 261 186 v 33 m 236 0 v -33" />
<path d=" M 261 219 v 33 m 236 0 v -33" />
<path d=" M 261 252 v 33 m 236 0 v -33" />
<path d=" M 261 285 v 33 m 236 0 v -33" />
<path d=" M 261 318 v 33 m 236 0 v -33" />
<path d=" M 261 351 v 33 m 236 0 v -33" />
<path d=" M 261 384 v 33 m 236 0 v -33" />
<path d=" M 261 417 v 33 m 236 0 v -33" />
<path d=" M 261 450 v 33 m 236 0 v -33" />
<path d=" M 261 483 v 33 m 236 0 v -33" />
<path d=" M 261 516 v 33 m 236 0 v -33" />
<path d=" M 261 549 v 33 m 236 0 v -33" />
<path d=" M 261 582 v 33 m 236 0 v -33" />
<path d=" M 261 615 v 33 m 236 0 v -33" />
<path d=" M 261 648 v 33 m 236 0 v -33" />
<path d=" M 261 681 v 33 m 236 0 v -33" />
<path d=" M 261 87 v 0 a 12 12 0 0 0 12 12 m 132 0 h 80 m -37 0 l -5 -5 m 0 10 l 5 -5 m 37 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-PathExpression">
<g class="nonterminal">
<rect height="22" width="132" x="273" y="88" />
<text x="339" y="104">
PathExpression</text>
</g>
</a>
</g>
<path d=" M 261 120 v 0 a 12 12 0 0 0 12 12 m 164 0 h 48 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-OperatorExpression">
<g class="nonterminal">
<rect height="22" width="164" x="273" y="121" />
<text x="355" y="137">
OperatorExpression</text>
</g>
</a>
</g>
<path d=" M 261 153 v 0 a 12 12 0 0 0 12 12 m 156 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-GroupedExpression">
<g class="nonterminal">
<rect height="22" width="156" x="273" y="154" />
<text x="351" y="170">
GroupedExpression</text>
</g>
</a>
</g>
<path d=" M 261 186 v 0 a 12 12 0 0 0 12 12 m 140 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ArrayExpression">
<g class="nonterminal">
<rect height="22" width="140" x="273" y="187" />
<text x="343" y="203">
ArrayExpression</text>
</g>
</a>
</g>
<path d=" M 261 219 v 0 a 12 12 0 0 0 12 12 m 140 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-AwaitExpression">
<g class="nonterminal">
<rect height="22" width="140" x="273" y="220" />
<text x="343" y="236">
AwaitExpression</text>
</g>
</a>
</g>
<path d=" M 261 252 v 0 a 12 12 0 0 0 12 12 m 140 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IndexExpression">
<g class="nonterminal">
<rect height="22" width="140" x="273" y="253" />
<text x="343" y="269">
IndexExpression</text>
</g>
</a>
</g>
<path d=" M 261 285 v 0 a 12 12 0 0 0 12 12 m 140 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-TupleExpression">
<g class="nonterminal">
<rect height="22" width="140" x="273" y="286" />
<text x="343" y="302">
TupleExpression</text>
</g>
</a>
</g>
<path d=" M 261 318 v 0 a 12 12 0 0 0 12 12 m 212 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-TupleIndexingExpression">
<g class="nonterminal">
<rect height="22" width="212" x="273" y="319" />
<text x="379" y="335">
TupleIndexingExpression</text>
</g>
</a>
</g>
<path d=" M 261 351 v 0 a 12 12 0 0 0 12 12 m 148 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-StructExpression">
<g class="nonterminal">
<rect height="22" width="148" x="273" y="352" />
<text x="347" y="368">
StructExpression</text>
</g>
</a>
</g>
<path d=" M 261 384 v 0 a 12 12 0 0 0 12 12 m 132 0 h 80 m -37 0 l -5 -5 m 0 10 l 5 -5 m 37 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-CallExpression">
<g class="nonterminal">
<rect height="22" width="132" x="273" y="385" />
<text x="339" y="401">
CallExpression</text>
</g>
</a>
</g>
<path d=" M 261 417 v 0 a 12 12 0 0 0 12 12 m 188 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-MethodCallExpression">
<g class="nonterminal">
<rect height="22" width="188" x="273" y="418" />
<text x="367" y="434">
MethodCallExpression</text>
</g>
</a>
</g>
<path d=" M 261 450 v 0 a 12 12 0 0 0 12 12 m 140 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-FieldExpression">
<g class="nonterminal">
<rect height="22" width="140" x="273" y="451" />
<text x="343" y="467">
FieldExpression</text>
</g>
</a>
</g>
<path d=" M 261 483 v 0 a 12 12 0 0 0 12 12 m 156 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ClosureExpression">
<g class="nonterminal">
<rect height="22" width="156" x="273" y="484" />
<text x="351" y="500">
ClosureExpression</text>
</g>
</a>
</g>
<path d=" M 261 516 v 0 a 12 12 0 0 0 12 12 m 188 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-AsyncBlockExpression">
<g class="nonterminal">
<rect height="22" width="188" x="273" y="517" />
<text x="367" y="533">
AsyncBlockExpression</text>
</g>
</a>
</g>
<path d=" M 261 549 v 0 a 12 12 0 0 0 12 12 m 164 0 h 48 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ContinueExpression">
<g class="nonterminal">
<rect height="22" width="164" x="273" y="550" />
<text x="355" y="566">
ContinueExpression</text>
</g>
</a>
</g>
<path d=" M 261 582 v 0 a 12 12 0 0 0 12 12 m 140 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-BreakExpression">
<g class="nonterminal">
<rect height="22" width="140" x="273" y="583" />
<text x="343" y="599">
BreakExpression</text>
</g>
</a>
</g>
<path d=" M 261 615 v 0 a 12 12 0 0 0 12 12 m 140 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RangeExpression">
<g class="nonterminal">
<rect height="22" width="140" x="273" y="616" />
<text x="343" y="632">
RangeExpression</text>
</g>
</a>
</g>
<path d=" M 261 648 v 0 a 12 12 0 0 0 12 12 m 148 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ReturnExpression">
<g class="nonterminal">
<rect height="22" width="148" x="273" y="649" />
<text x="347" y="665">
ReturnExpression</text>
</g>
</a>
</g>
<path d=" M 261 681 v 0 a 12 12 0 0 0 12 12 m 188 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-UnderscoreExpression">
<g class="nonterminal">
<rect height="22" width="188" x="273" y="682" />
<text x="367" y="698">
UnderscoreExpression</text>
</g>
</a>
</g>
<path d=" M 261 714 v 0 a 12 12 0 0 0 12 12 m 140 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-MacroInvocation">
<g class="nonterminal">
<rect height="22" width="140" x="273" y="715" />
<text x="343" y="731">
MacroInvocation</text>
</g>
</a>
</g>
</g>
<path d=" M 239 66 h 10" />
</g>
<path d=" M 519 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 509 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 528px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ExpressionWithBlock"><svg class="railroad" viewbox="0 0 528 252" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ExpressionWithBlock">
<text class="comment" x="81" y="25">
ExpressionWithBlock</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<g class="choice">
<path d=" M 249 66 h 24 m 140 0 h 80 m -37 0 l -5 -5 m 0 10 l 5 -5 m 37 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-BlockExpression">
<g class="nonterminal">
<rect height="22" width="140" x="273" y="55" />
<text x="343" y="71">
BlockExpression</text>
</g>
</a>
</g>
<path d=" M 249 66 a 12 12 0 0 1 12 12 v 9 m 220 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 261 87 v 33 m 220 0 v -33" />
<path d=" M 261 120 v 33 m 220 0 v -33" />
<path d=" M 261 153 v 33 m 220 0 v -33" />
<path d=" M 261 186 v 33 m 220 0 v -33" />
<path d=" M 261 87 v 0 a 12 12 0 0 0 12 12 m 188 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ConstBlockExpression">
<g class="nonterminal">
<rect height="22" width="188" x="273" y="88" />
<text x="367" y="104">
ConstBlockExpression</text>
</g>
</a>
</g>
<path d=" M 261 120 v 0 a 12 12 0 0 0 12 12 m 196 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-UnsafeBlockExpression">
<g class="nonterminal">
<rect height="22" width="196" x="273" y="121" />
<text x="371" y="137">
UnsafeBlockExpression</text>
</g>
</a>
</g>
<path d=" M 261 153 v 0 a 12 12 0 0 0 12 12 m 132 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-LoopExpression">
<g class="nonterminal">
<rect height="22" width="132" x="273" y="154" />
<text x="339" y="170">
LoopExpression</text>
</g>
</a>
</g>
<path d=" M 261 186 v 0 a 12 12 0 0 0 12 12 m 116 0 h 80 m -37 0 l -5 -5 m 0 10 l 5 -5 m 37 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IfExpression">
<g class="nonterminal">
<rect height="22" width="116" x="273" y="187" />
<text x="331" y="203">
IfExpression</text>
</g>
</a>
</g>
<path d=" M 261 219 v 0 a 12 12 0 0 0 12 12 m 140 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-MatchExpression">
<g class="nonterminal">
<rect height="22" width="140" x="273" y="220" />
<text x="343" y="236">
MatchExpression</text>
</g>
</a>
</g>
</g>
<path d=" M 239 66 h 10" />
</g>
<path d=" M 503 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 493 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.intro"><a class="rule-link" href="#r-expr.intro" title="expr.intro"><span>[expr<wbr>.intro]</span></a>
</div>

<p>一个表达式可能有两种角色：它总是产生一个 <em>值</em>，并且可能产生 <em>副作用</em> 。</p>
<div class="rule" id="r-expr.evaluation"><a class="rule-link" href="#r-expr.evaluation" title="expr.evaluation"><span>[expr<wbr>.evaluation]</span></a>
</div>

<p>表达式 <em>求值为</em> 一个值，并在 <em>求值</em> 过程中产生副作用。</p>
<div class="rule" id="r-expr.operands"><a class="rule-link" href="#r-expr.operands" title="expr.operands"><span>[expr<wbr>.operands]</span></a>
</div>

<p>许多表达式包含子表达式，称为该表达式的 <em>操作数</em>。</p>
<div class="rule" id="r-expr.behavior"><a class="rule-link" href="#r-expr.behavior" title="expr.behavior"><span>[expr<wbr>.behavior]</span></a>
</div>

<p>每种表达式的含义决定了几件事：</p>
<ul>
<li>在对表达式求值时是否对操作数求值</li>
<li>对操作数求值的顺序</li>
<li>如何组合操作数的值以获得表达式的值</li>
</ul>
<div class="rule" id="r-expr.structure"><a class="rule-link" href="#r-expr.structure" title="expr.structure"><span>[expr<wbr>.structure]</span></a>
</div>

<p>通过这种方式，表达式的结构决定了执行的结构。块只是另一种表达式，因此块、语句、表达式以及再次嵌套的块可以递归地相互嵌套到任意深度。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>我们给表达式的操作数命名以便于讨论，但这些名称并不稳定，可能会被更改。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.precedence"><a class="rule-link" href="#r-expr.precedence" title="expr.precedence"><span>[expr<wbr>.precedence]</span></a>
</div>

<h2 id="表达式优先级"><a class="header" href="#表达式优先级">表达式优先级</a></h2>
<p>Rust 运算符和表达式的优先级按以下顺序排列，从强到弱。同一优先级水平的二元运算符按其结合性给出的顺序进行分组。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>运算符/表达式</th><th>结合性</th></tr>
</thead>
<tbody>
<tr><td><a href="#r-expr.path">路径</a></td><td></td></tr>
<tr><td><a href="#r-expr.method">方法调用</a></td><td></td></tr>
<tr><td><a href="#r-expr.field">字段表达式</a></td><td>从左到右</td></tr>
<tr><td><a href="#r-expr.call">函数调用</a>, <a href="#r-expr.array.index">数组索引</a></td><td></td></tr>
<tr><td><a href="#r-expr.try"><code>?</code></a></td><td></td></tr>
<tr><td>一元 <a href="#r-expr.negate"><code>-</code></a> <a href="#r-expr.negate"><code>!</code></a> <a href="#r-expr.deref"><code>*</code></a> <a href="#r-expr.operator.borrow">借用</a></td><td></td></tr>
<tr><td><a href="#r-expr.as"><code>as</code></a></td><td>从左到右</td></tr>
<tr><td><a href="#r-expr.arith-logic"><code>*</code></a> <a href="#r-expr.arith-logic"><code>/</code></a> <a href="#r-expr.arith-logic"><code>%</code></a></td><td>从左到右</td></tr>
<tr><td><a href="#r-expr.arith-logic"><code>+</code></a> <a href="#r-expr.arith-logic"><code>-</code></a></td><td>从左到右</td></tr>
<tr><td><a href="#r-expr.arith-logic"><code>&lt;&lt;</code></a> <a href="#r-expr.arith-logic"><code>&gt;&gt;</code></a></td><td>从左到右</td></tr>
<tr><td><a href="#r-expr.arith-logic"><code>&amp;</code></a></td><td>从左到右</td></tr>
<tr><td><a href="#r-expr.arith-logic"><code>^</code></a></td><td>从左到右</td></tr>
<tr><td><a href="#r-expr.arith-logic"><code>|</code></a></td><td>从左到右</td></tr>
<tr><td><a href="#r-expr.cmp"><code>==</code></a> <a href="#r-expr.cmp"><code>!=</code></a> <a href="#r-expr.cmp"><code>&lt;</code></a> <a href="#r-expr.cmp"><code>&gt;</code></a> <a href="#r-expr.cmp"><code>&lt;=</code></a> <a href="#r-expr.cmp"><code>&gt;=</code></a></td><td>需要括号</td></tr>
<tr><td><a href="#r-expr.bool-logic"><code>&amp;&amp;</code></a></td><td>从左到右</td></tr>
<tr><td><a href="#r-expr.bool-logic"><code>||</code></a></td><td>从左到右</td></tr>
<tr><td><a href="#r-expr.range"><code>..</code></a> <a href="#r-expr.range"><code>..=</code></a></td><td>需要括号</td></tr>
<tr><td><a href="#r-expr.assign"><code>=</code></a> <a href="#r-expr.compound-assign"><code>+=</code></a> <a href="#r-expr.compound-assign"><code>-=</code></a> <a href="#r-expr.compound-assign"><code>*=</code></a> <a href="#r-expr.compound-assign"><code>/=</code></a> <a href="#r-expr.compound-assign"><code>%=</code></a> <br> <a href="#r-expr.compound-assign"><code>&amp;=</code></a> <a href="#r-expr.compound-assign"><code>|=</code></a> <a href="#r-expr.compound-assign"><code>^=</code></a> <a href="#r-expr.compound-assign"><code>&lt;&lt;=</code></a> <a href="#r-expr.compound-assign"><code>&gt;&gt;=</code></a></td><td>从右到左</td></tr>
<tr><td><a href="#r-expr.return"><code>return</code></a> <a href="#r-expr.loop.break"><code>break</code></a> <a href="#r-expr.closure">闭包</a></td><td></td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-expr.operand-order"><a class="rule-link" href="#r-expr.operand-order" title="expr.operand-order"><span>[expr<wbr>.operand-order]</span></a>
</div>

<h2 id="操作数的求值顺序"><a class="header" href="#操作数的求值顺序">操作数的求值顺序</a></h2>
<div class="rule" id="r-expr.operand-order.default"><a class="rule-link" href="#r-expr.operand-order.default" title="expr.operand-order.default"><span>[expr<wbr>.operand-order<wbr>.default]</span></a>
</div>

<p>以下表达式列表都以相同的方式对其操作数求值，如列表后所述。其他表达式要么不接受操作数，要么根据其各自页面的描述有条件地对其求值。</p>
<ul>
<li>解引用表达式</li>
<li>错误传播表达式</li>
<li>取反表达式</li>
<li>算术和逻辑二元运算符</li>
<li>比较运算符</li>
<li>类型转换表达式</li>
<li>分组表达式</li>
<li>数组表达式</li>
<li>Await 表达式</li>
<li>索引表达式</li>
<li>元组表达式</li>
<li>元组索引表达式</li>
<li>结构体表达式</li>
<li>调用表达式</li>
<li>方法调用表达式</li>
<li>字段表达式</li>
<li>Break 表达式</li>
<li>范围表达式</li>
<li>返回表达式</li>
</ul>
<div class="rule" id="r-expr.operand-order.operands-before-primary"><a class="rule-link" href="#r-expr.operand-order.operands-before-primary" title="expr.operand-order.operands-before-primary"><span>[expr<wbr>.operand-order<wbr>.operands-before-primary]</span></a>
</div>

<p>这些表达式的操作数在应用表达式的效果之前进行求值。接受多个操作数的表达式按照源代码中编写的顺序从左到右进行求值。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>哪些子表达式是表达式的操作数，由前一节所述的表达式优先级决定。</p>
</blockquote>
</div>

<p>例如，两个 <code>next</code> 方法调用将始终按相同的顺序调用：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">// 使用 vec 而不是数组来避免引用，
</span><span class="boring">// 因为在编写此示例时
</span><span class="boring">// 还没有稳定的所有权数组迭代器。
</span>let mut one_two = vec![1, 2].into_iter();
assert_eq!(
    (1, 2),
    (one_two.next().unwrap(), one_two.next().unwrap())
);
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>由于这是递归应用的，因此这些表达式也从最内层向最外层求值，忽略同级表达式，直到没有内部子表达式。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.place-value"><a class="rule-link" href="#r-expr.place-value" title="expr.place-value"><span>[expr<wbr>.place-value]</span></a>
</div>

<h2 id="位置表达式和值表达式"><a class="header" href="#位置表达式和值表达式">位置表达式和值表达式</a></h2>
<div class="rule" id="r-expr.place-value.intro"><a class="rule-link" href="#r-expr.place-value.intro" title="expr.place-value.intro"><span>[expr<wbr>.place-value<wbr>.intro]</span></a>
</div>

<p>表达式分为两个主要类别：位置表达式和值表达式；还有第三个较小的表达式类别，称为被赋值者表达式。在每个表达式中，操作数同样可能出现在位置环境或值环境中。表达式的求值取决于其自身的类别以及它所处的环境。</p>
<div class="rule" id="r-expr.place-value.place-memory-location"><a class="rule-link" href="#r-expr.place-value.place-memory-location" title="expr.place-value.place-memory-location"><span>[expr<wbr>.place-value<wbr>.place-memory-location]</span></a>
</div>

<p><em>位置表达式</em> 是代表内存位置的表达式。</p>
<div class="rule" id="r-expr.place-value.place-expr-kinds"><a class="rule-link" href="#r-expr.place-value.place-expr-kinds" title="expr.place-value.place-expr-kinds"><span>[expr<wbr>.place-value<wbr>.place-expr-kinds]</span></a>
</div>

<p>这些表达式是引用局部变量的 <a href="#路径表达式">路径</a>、<a href="#静态项">静态变量</a>、<a href="#the-dereference-operator">解引用</a> (<code>*expr</code>)、<a href="#array-and-slice-indexing-expressions">数组索引</a> 表达式 (<code>expr[expr]</code>)、<a href="#字段访问表达式">字段</a> 引用 (<code>expr.f</code>) 以及括号括起来的位置表达式。</p>
<div class="rule" id="r-expr.place-value.value-expr-kinds"><a class="rule-link" href="#r-expr.place-value.value-expr-kinds" title="expr.place-value.value-expr-kinds"><span>[expr<wbr>.place-value<wbr>.value-expr-kinds]</span></a>
</div>

<p>所有其他表达式都是值表达式。</p>
<div class="rule" id="r-expr.place-value.value-result"><a class="rule-link" href="#r-expr.place-value.value-result" title="expr.place-value.value-result"><span>[expr<wbr>.place-value<wbr>.value-result]</span></a>
</div>

<p><em>值表达式</em> 是代表实际值的表达式。</p>
<div class="rule" id="r-expr.place-value.place-context"><a class="rule-link" href="#r-expr.place-value.place-context" title="expr.place-value.place-context"><span>[expr<wbr>.place-value<wbr>.place-context]</span></a>
</div>

<p>以下环境是 <em>位置表达式</em> 环境：</p>
<ul>
<li><a href="#compound-assignment-expressions">复合赋值</a> 表达式的左操作数。</li>
<li>一元 <a href="#borrow-operators">借用</a>、<a href="#raw-borrow-operators">原始借用</a> 或 <a href="#the-dereference-operator">解引用</a> 运算符的操作数。</li>
<li>字段表达式的操作数。</li>
<li>数组索引表达式的被索引操作数。</li>
<li>任何 <a href="#implicit-borrows">隐式借用</a> 的操作数。</li>
<li><a href="#let-statements">let 语句</a> 的初始化器。</li>
<li><a href="#if-let-patterns"><code>if let</code></a>、<a href="#match表达式"><code>match</code></a> 或 <a href="#while-let-patterns"><code>while let</code></a> 表达式的 <a href="#scrutinee">审查对象</a>。</li>
<li><a href="#functional-update-syntax">函数式更新</a> 结构体 表达式的基准。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>在历史上，位置表达式被称为 <em>左值 (lvalues)</em>，而值表达式被称为 <em>右值 (rvalues)</em>。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.place-value.assignee"><a class="rule-link" href="#r-expr.place-value.assignee" title="expr.place-value.assignee"><span>[expr<wbr>.place-value<wbr>.assignee]</span></a>
</div>

<p><em>被赋值者表达式</em> 是出现在 <a href="#assignment-expressions">赋值</a> 表达式左操作数中的表达式。显式地，被赋值者表达式有：</p>
<ul>
<li>位置表达式。</li>
<li><a href="#_表达式">下划线</a>。</li>
<li>被赋值者表达式的 <a href="#元组和元组索引表达式">元组</a>。</li>
<li>被赋值者表达式的 <a href="#r-expr.array.index">切片</a>。</li>
<li>被赋值者表达式的 <a href="#r-items.struct.tuple">元组结构体</a>。</li>
<li>被赋值者表达式的 <a href="#r-expr.struct">结构体</a>（带有可选命名字段）。</li>
<li><a href="#r-items.struct.unit">单元结构体</a></li>
</ul>
<div class="rule" id="r-expr.place-value.parenthesis"><a class="rule-link" href="#r-expr.place-value.parenthesis" title="expr.place-value.parenthesis"><span>[expr<wbr>.place-value<wbr>.parenthesis]</span></a>
</div>

<p>在被赋值者表达式内部允许使用任意括号。</p>
<div class="rule" id="r-expr.move"><a class="rule-link" href="#r-expr.move" title="expr.move"><span>[expr<wbr>.move]</span></a>
</div>

<h3 id="移动和复制类型"><a class="header" href="#移动和复制类型">移动和复制类型</a></h3>
<div class="rule" id="r-expr.move.intro"><a class="rule-link" href="#r-expr.move.intro" title="expr.move.intro"><span>[expr<wbr>.move<wbr>.intro]</span></a>
</div>

<p>当位置表达式在值表达式环境中求值，或在模式中通过值绑定时，它表示该内存位置中 <em>持有</em> 的值。</p>
<div class="rule" id="r-expr.move.copy"><a class="rule-link" href="#r-expr.move.copy" title="expr.move.copy"><span>[expr<wbr>.move<wbr>.copy]</span></a>
</div>

<p>如果该值的类型实现了 <a href="#copy"><code>Copy</code></a>，那么该值将被复制。</p>
<div class="rule" id="r-expr.move.requires-sized"><a class="rule-link" href="#r-expr.move.requires-sized" title="expr.move.requires-sized"><span>[expr<wbr>.move<wbr>.requires-sized]</span></a>
</div>

<p>在其余情况下，如果该类型是 <a href="#sized-1"><code>Sized</code></a>，则可能会移动该值。</p>
<div class="rule" id="r-expr.move.movable-place"><a class="rule-link" href="#r-expr.move.movable-place" title="expr.move.movable-place"><span>[expr<wbr>.move<wbr>.movable-place]</span></a>
</div>

<p>只有以下位置表达式可以被移出：</p>
<ul>
<li>当前未被借用的 <a href="#变量">变量</a>。</li>
<li><a href="#temporaries">临时值</a>。</li>
<li>可以移出且未实现 <a href="#drop"><code>Drop</code></a> 的位置表达式的 <a href="#字段访问表达式">字段</a>。</li>
<li><a href="#the-dereference-operator">解引用</a> 类型为 <a href="../alloc/boxed/struct.Box.html"><code>Box&lt;T&gt;</code></a> 且也可以被移出的表达式的结果。</li>
</ul>
<div class="rule" id="r-expr.move.deinitialization"><a class="rule-link" href="#r-expr.move.deinitialization" title="expr.move.deinitialization"><span>[expr<wbr>.move<wbr>.deinitialization]</span></a>
</div>

<p>在移出一个求值为局部变量的位置表达式后，该位置将被去初始化，并且在重新初始化之前不能再次从中读取。</p>
<div class="rule" id="r-expr.move.place-invalid"><a class="rule-link" href="#r-expr.move.place-invalid" title="expr.move.place-invalid"><span>[expr<wbr>.move<wbr>.place-invalid]</span></a>
</div>

<p>在所有其他情况下，尝试在值表达式环境中使用位置表达式都会报错。</p>
<div class="rule" id="r-expr.mut"><a class="rule-link" href="#r-expr.mut" title="expr.mut"><span>[expr<wbr>.mut]</span></a>
</div>

<h3 id="可变性"><a class="header" href="#可变性">可变性</a></h3>
<div class="rule" id="r-expr.mut.intro"><a class="rule-link" href="#r-expr.mut.intro" title="expr.mut.intro"><span>[expr<wbr>.mut<wbr>.intro]</span></a>
</div>

<p>为了使位置表达式能被 <a href="#assignment-expressions">赋值</a>、可变 <a href="#borrow-operators">借用</a>、<a href="#implicit-borrows">隐式可变借用</a> 或绑定到包含 <code>ref mut</code> 的模式，它必须是 <em>可变的</em>。我们称这些为 <em>可变位置表达式</em>。相比之下，其他位置表达式称为 <em>不可变位置表达式</em>。</p>
<div class="rule" id="r-expr.mut.valid-places"><a class="rule-link" href="#r-expr.mut.valid-places" title="expr.mut.valid-places"><span>[expr<wbr>.mut<wbr>.valid-places]</span></a>
</div>

<p>以下表达式可以是可变位置表达式环境：</p>
<ul>
<li>当前未被借用的可变 <a href="#变量">变量</a>。</li>
<li><a href="#mutable-statics">可变 <code>static</code> 项</a>。</li>
<li><a href="#temporaries">临时值</a>。</li>
<li><a href="#字段访问表达式">字段</a>：这在可变位置表达式环境中对子表达式求值。</li>
<li><code>*mut T</code> 指针的 <a href="#the-dereference-operator">解引用</a>。</li>
<li>类型为 <code>&amp;mut T</code> 的变量或变量字段的解引用。
注意：这是下一条规则要求的例外。</li>
<li>实现了 <code>DerefMut</code> 的类型的解引用：
这随后要求被解引用的值在可变位置表达式环境中求值。</li>
<li>实现了 <code>IndexMut</code> 的类型的 <a href="#array-and-slice-indexing-expressions">数组索引</a>：
这随后在可变位置表达式环境中对被索引的值（而非索引本身）求值。</li>
</ul>
<div class="rule" id="r-expr.temporary"><a class="rule-link" href="#r-expr.temporary" title="expr.temporary"><span>[expr<wbr>.temporary]</span></a>
</div>

<h3 id="临时变量"><a class="header" href="#临时变量">临时变量</a></h3>
<p>在大多数位置表达式环境中使用值表达式时，会创建一个临时的未命名内存位置并将其初始化为该值。该表达式求值为该位置，除非被 <a href="#constant-promotion">提升</a> 为 <code>static</code>。临时变量的 <a href="#drop-scopes">销毁范围</a> 通常是封闭语句的末尾。</p>
<div class="rule" id="r-expr.super-macros"><a class="rule-link" href="#r-expr.super-macros" title="expr.super-macros"><span>[expr<wbr>.super-macros]</span></a>
</div>

<h3 id="超级宏"><a class="header" href="#超级宏">超级宏</a></h3>
<div class="rule" id="r-expr.super-macros.intro"><a class="rule-link" href="#r-expr.super-macros.intro" title="expr.super-macros.intro"><span>[expr<wbr>.super-macros<wbr>.intro]</span></a>
</div>

<p>某些内置宏可能会创建 <a href="#r-expr.temporary">临时变量</a>，其 <a href="#r-destructors.scope.temporary">作用域</a> 可能会被 <a href="#r-destructors.scope.lifetime-extension">延长</a>。这些临时变量是 <em>超级临时变量</em>，而这些宏是 <em>超级宏</em>。这些宏的 <a href="#r-macro.invocation">调用</a> 是 <em>超级宏调用表达式</em>。这些宏的参数可能是 <em>超级操作数</em>。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>当超级宏调用表达式是一个 <a href="#r-destructors.scope.lifetime-extension.exprs">延长表达式</a> 时，它的超级操作数也是 <a href="#r-destructors.scope.lifetime-extension.exprs">延长表达式</a>，并且超级临时变量的 <a href="#r-destructors.scope.temporary">作用域</a> 会被 <a href="#r-destructors.scope.lifetime-extension">延长</a>。参见 <a href="#r-destructors.scope.lifetime-extension.exprs">destructors.scope.lifetime-extension.exprs</a>。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.super-macros.format_args"><a class="rule-link" href="#r-expr.super-macros.format_args" title="expr.super-macros.format_args"><span>[expr<wbr>.super-macros<wbr>.format_args]</span></a>
</div>

<h4 id="format_args"><a class="header" href="#format_args"><code>format_args!</code></a></h4>
<div class="rule" id="r-expr.super-macros.format_args.super-operands"><a class="rule-link" href="#r-expr.super-macros.format_args.super-operands" title="expr.super-macros.format_args.super-operands"><span>[expr<wbr>.super-macros<wbr>.format_args<wbr>.super-operands]</span></a>
</div>

<p>除了格式化字符串参数外，传递给 <a href="../core/macro.format_args.html"><code>format_args!</code></a> 的所有参数都是 <em>超级操作数</em>。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() -&gt; String { String::from("") }
</span>// 由于调用是一个延长表达式且参数是一个超级操作数，
// 内部块是一个延长表达式，
// 因此在其尾部表达式中创建的临时变量的作用域被延长了。
let _ = format_args!("{}", { &amp;temp() }); // OK
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.super-macros.format_args.super-temporaries"><a class="rule-link" href="#r-expr.super-macros.format_args.super-temporaries" title="expr.super-macros.format_args.super-temporaries"><span>[expr<wbr>.super-macros<wbr>.format_args<wbr>.super-temporaries]</span></a>
</div>

<p><a href="../core/macro.format_args.html"><code>format_args!</code></a> 的超级操作数是 <a href="#r-expr.implicit-borrow">隐式借用</a> 的，因此是 <a href="#r-expr.place-value">位置表达式环境</a>。当 <a href="#r-expr.place-value">值表达式</a> 被作为参数传递时，它会创建一个 <em>超级临时变量</em>。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() -&gt; String { String::from("") }
</span>let x = format_args!("{}", temp());
x; // &lt;-- 临时变量被延长，允许在此处使用。
<span class="boring">}</span></code></pre>
<p><a href="../core/macro.format_args.html"><code>format_args!</code></a> 调用的展开有时会创建其他内部 <em>超级临时变量</em>。</p>
<pre class="playground"><code class="language-rust compile_fail E0716 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = {
    // 此调用创建一个内部临时变量。
    let x = format_args!("{:?}", 0);
    x // &lt;-- 临时变量被延长，允许在此处使用。
}; // &lt;-- 临时变量在此处被销毁。
x; // 错误
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 此调用不创建内部临时变量。
let x = { let x = format_args!("{}", 0); x };
x; // OK
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>关于 <a href="../core/macro.format_args.html"><code>format_args!</code></a> 何时会或不会创建内部临时变量的细节目前尚未指定。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.super-macros.pin"><a class="rule-link" href="#r-expr.super-macros.pin" title="expr.super-macros.pin"><span>[expr<wbr>.super-macros<wbr>.pin]</span></a>
</div>

<h4 id="pin"><a class="header" href="#pin"><code>pin!</code></a></h4>
<div class="rule" id="r-expr.super-macros.pin.super-operands"><a class="rule-link" href="#r-expr.super-macros.pin.super-operands" title="expr.super-macros.pin.super-operands"><span>[expr<wbr>.super-macros<wbr>.pin<wbr>.super-operands]</span></a>
</div>

<p><a href="../core/pin/macro.pin.html"><code>pin!</code></a> 的参数是 <em>超级操作数</em>。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use core::pin::pin;
</span><span class="boring">fn temp() {}
</span>// 同上 `format_args!`。
let _ = pin!({ &amp;temp() }); // OK
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.super-macros.pin.super-temporaries"><a class="rule-link" href="#r-expr.super-macros.pin.super-temporaries" title="expr.super-macros.pin.super-temporaries"><span>[expr<wbr>.super-macros<wbr>.pin<wbr>.super-temporaries]</span></a>
</div>

<p><a href="../core/pin/macro.pin.html"><code>pin!</code></a> 的参数是 <a href="#r-expr.place-value">值表达式环境</a>，并创建一个 <em>超级临时变量</em>。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use core::pin::pin;
</span><span class="boring">fn temp() {}
</span>// 参数被求值为超级临时变量。
let x = pin!(temp());
// 临时变量被延长，允许在此处使用。
x; // OK
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.implicit-borrow"><a class="rule-link" href="#r-expr.implicit-borrow" title="expr.implicit-borrow"><span>[expr<wbr>.implicit-borrow]</span></a>
</div>

<h3 id="隐式借用"><a class="header" href="#隐式借用">隐式借用</a></h3>
<div class="rule" id="r-expr.implicit-borrow-intro"><a class="rule-link" href="#r-expr.implicit-borrow-intro" title="expr.implicit-borrow-intro"><span>[expr<wbr>.implicit-borrow-intro]</span></a>
</div>

<p>某些表达式会通过隐式借用将一个表达式视为位置表达式。例如，可以直接比较两个无固定大小的 <a href="#切片类型">切片</a> 是否相等，因为 <code>==</code> 运算符会隐式借用其操作数：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">let c = [1, 2, 3];
</span><span class="boring">let d = vec![1, 2, 3];
</span>let a: &amp;[i32];
let b: &amp;[i32];
<span class="boring">a = &amp;c;
</span><span class="boring">b = &amp;d;
</span>// ...
*a == *b;
// 等效形式：
::std::cmp::PartialEq::eq(&amp;*a, &amp;*b);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.implicit-borrow.application"><a class="rule-link" href="#r-expr.implicit-borrow.application" title="expr.implicit-borrow.application"><span>[expr<wbr>.implicit-borrow<wbr>.application]</span></a>
</div>

<p>隐式借用可能会在以下表达式中发生：</p>
<ul>
<li><a href="#方法调用表达式">方法调用</a> 表达式中的左操作数。</li>
<li><a href="#字段访问表达式">字段</a> 表达式中的左操作数。</li>
<li><a href="#调用表达式">调用表达式</a> 中的左操作数。</li>
<li><a href="#array-and-slice-indexing-expressions">数组索引</a> 表达式中的左操作数。</li>
<li><a href="#the-dereference-operator">解引用运算符</a> (<code>*</code>) 的操作数。</li>
<li><a href="#comparison-operators">比较</a> 的操作数。</li>
<li><a href="#compound-assignment-expressions">复合赋值</a> 的左操作数。</li>
<li>除了格式字符串之外传递给 <a href="../core/macro.format_args.html"><code>format_args!</code></a> 的参数。</li>
</ul>
<div class="rule" id="r-expr.overload"><a class="rule-link" href="#r-expr.overload" title="expr.overload"><span>[expr<wbr>.overload]</span></a>
</div>

<h2 id="重载特型"><a class="header" href="#重载特型">重载特型</a></h2>
<p>许多以下运算符和表达式也可以使用 <code>std::ops</code> 或 <code>std::cmp</code> 中的 特型 对其他类型进行重载。这些 特型 在 <code>core::ops</code> 和 <code>core::cmp</code> 中也以相同的名称存在。</p>
<div class="rule" id="r-expr.attr"><a class="rule-link" href="#r-expr.attr" title="expr.attr"><span>[expr<wbr>.attr]</span></a>
</div>

<h2 id="表达式属性"><a class="header" href="#表达式属性">表达式属性</a></h2>
<div class="rule" id="r-expr.attr.restriction"><a class="rule-link" href="#r-expr.attr.restriction" title="expr.attr.restriction"><span>[expr<wbr>.attr<wbr>.restriction]</span></a>
</div>

<p>表达式前的 <a href="#属性-1">外部属性</a> 仅在少数特定情况下允许：</p>
<ul>
<li>在用作 <a href="#语句">语句</a> 的表达式之前。</li>
<li><a href="#数组和数组索引表达式">数组表达式</a>、<a href="#元组和元组索引表达式">元组表达式</a>、<a href="#调用表达式">调用表达式</a> 以及元组风格 <a href="#结构体表达式">结构体</a> 表达式的元素。</li>
<li><a href="#块表达式">块表达式</a> 的尾部表达式。</li>
</ul>
<!-- Keep list in sync with block-expr.md -->
<div class="rule" id="r-expr.attr.never-before"><a class="rule-link" href="#r-expr.attr.never-before" title="expr.attr.never-before"><span>[expr<wbr>.attr<wbr>.never-before]</span></a>
</div>

<p>在以下情况前绝不允许：</p>
<ul>
<li><a href="#范围表达式">范围</a> 表达式。</li>
<li>二元运算符表达式（<a href="#grammar-ArithmeticOrLogicalExpression">ArithmeticOrLogicalExpression</a>, <a href="#grammar-ComparisonExpression">ComparisonExpression</a>, <a href="#grammar-LazyBooleanExpression">LazyBooleanExpression</a>, <a href="#grammar-TypeCastExpression">TypeCastExpression</a>, <a href="#grammar-AssignmentExpression">AssignmentExpression</a>, <a href="#grammar-CompoundAssignmentExpression">CompoundAssignmentExpression</a>）。</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr.literal"><a class="rule-link" href="#r-expr.literal" title="expr.literal"><span>[expr<wbr>.literal]</span></a>
</div>

<h1 id="字面量表达式"><a class="header" href="#字面量表达式">字面量表达式</a></h1>
<div class="rule" id="r-expr.literal.syntax"><a class="rule-link" href="#r-expr.literal.syntax" title="expr.literal.syntax"><span>[expr<wbr>.literal<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-LiteralExpression" onclick="show_railroad()"><a href="#railroad-LiteralExpression">LiteralExpression</a></span> → <br>      <span class="grammar-text"><a href="#grammar-CHAR_LITERAL">CHAR_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-STRING_LITERAL">STRING_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RAW_STRING_LITERAL">RAW_STRING_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-BYTE_LITERAL">BYTE_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-BYTE_STRING_LITERAL">BYTE_STRING_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RAW_BYTE_STRING_LITERAL">RAW_BYTE_STRING_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-C_STRING_LITERAL">C_STRING_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RAW_C_STRING_LITERAL">RAW_C_STRING_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-INTEGER_LITERAL">INTEGER_LITERAL</a></span> <br>    | <span class="grammar-text"><a href="#grammar-FLOAT_LITERAL">FLOAT_LITERAL</a></span> <br>    | <span class="grammar-literal">true</span> <br>    | <span class="grammar-literal">false</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 330px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-LiteralExpression"><svg class="railroad" viewbox="0 0 330 437" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-LiteralExpression">
<text class="comment" x="74" y="25">
LiteralExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 116 0 h 120 m -57 0 l -5 -5 m 0 10 l 5 -5 m 57 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-CHAR_LITERAL">
<g class="nonterminal">
<rect height="22" width="116" x="59" y="42" />
<text x="117" y="58">
CHAR_LITERAL</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 236 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 236 0 v -33" />
<path d=" M 47 107 v 33 m 236 0 v -33" />
<path d=" M 47 140 v 33 m 236 0 v -33" />
<path d=" M 47 173 v 33 m 236 0 v -33" />
<path d=" M 47 206 v 33 m 236 0 v -33" />
<path d=" M 47 239 v 33 m 236 0 v -33" />
<path d=" M 47 272 v 33 m 236 0 v -33" />
<path d=" M 47 305 v 33 m 236 0 v -33" />
<path d=" M 47 338 v 33 m 236 0 v -33" />
<path d=" M 47 371 v 33 m 236 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 132 0 h 80 m -37 0 l -5 -5 m 0 10 l 5 -5 m 37 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="132" x="59" y="75" />
<text x="125" y="91">
STRING_LITERAL</text>
</g>
</a>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 164 0 h 48 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RAW_STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="164" x="59" y="108" />
<text x="141" y="124">
RAW_STRING_LITERAL</text>
</g>
</a>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 116 0 h 96 m -45 0 l -5 -5 m 0 10 l 5 -5 m 45 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-BYTE_LITERAL">
<g class="nonterminal">
<rect height="22" width="116" x="59" y="141" />
<text x="117" y="157">
BYTE_LITERAL</text>
</g>
</a>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 172 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-BYTE_STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="172" x="59" y="174" />
<text x="145" y="190">
BYTE_STRING_LITERAL</text>
</g>
</a>
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 212 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RAW_BYTE_STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="212" x="59" y="207" />
<text x="165" y="223">
RAW_BYTE_STRING_LITERAL</text>
</g>
</a>
</g>
<path d=" M 47 239 v 0 a 12 12 0 0 0 12 12 m 148 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-C_STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="148" x="59" y="240" />
<text x="133" y="256">
C_STRING_LITERAL</text>
</g>
</a>
</g>
<path d=" M 47 272 v 0 a 12 12 0 0 0 12 12 m 188 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RAW_C_STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="188" x="59" y="273" />
<text x="153" y="289">
RAW_C_STRING_LITERAL</text>
</g>
</a>
</g>
<path d=" M 47 305 v 0 a 12 12 0 0 0 12 12 m 140 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-INTEGER_LITERAL">
<g class="nonterminal">
<rect height="22" width="140" x="59" y="306" />
<text x="129" y="322">
INTEGER_LITERAL</text>
</g>
</a>
</g>
<path d=" M 47 338 v 0 a 12 12 0 0 0 12 12 m 124 0 h 88 m -41 0 l -5 -5 m 0 10 l 5 -5 m 41 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-FLOAT_LITERAL">
<g class="nonterminal">
<rect height="22" width="124" x="59" y="339" />
<text x="121" y="355">
FLOAT_LITERAL</text>
</g>
</a>
</g>
<path d=" M 47 371 v 0 a 12 12 0 0 0 12 12 m 52 0 h 160 m -77 0 l -5 -5 m 0 10 l 5 -5 m 77 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="372" />
<text x="85" y="388">
true</text>
</g>
</g>
<path d=" M 47 404 v 0 a 12 12 0 0 0 12 12 m 60 0 h 152 m -73 0 l -5 -5 m 0 10 l 5 -5 m 73 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="59" y="405" />
<text x="89" y="421">
false</text>
</g>
</g>
<path d=" M 305 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 295 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.literal.intro"><a class="rule-link" href="#r-expr.literal.intro" title="expr.literal.intro"><span>[expr<wbr>.literal<wbr>.intro]</span></a>
</div>

<p><em>字面量表达式</em> 是由单个 词法单元 组成的表达式，而不是一系列 词法单元 ，它立即并直接地表示它所求得的值，而不是通过名称或其他求值规则来引用它。</p>
<div class="rule" id="r-expr.literal.const-expr"><a class="rule-link" href="#r-expr.literal.const-expr" title="expr.literal.const-expr"><span>[expr<wbr>.literal<wbr>.const-expr]</span></a>
</div>

<p>字面量是 <a href="#常量表达式">常量表达式</a> 的一种形式，因此（主要）在编译时求值。</p>
<div class="rule" id="r-expr.literal.literal-token"><a class="rule-link" href="#r-expr.literal.literal-token" title="expr.literal.literal-token"><span>[expr<wbr>.literal<wbr>.literal-token]</span></a>
</div>

<p>前面描述的每种词法 <a href="#字面量">字面量</a> 形式都可以构成字面量表达式，关键字 <code>true</code> 和 <code>false</code> 也是如此。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>"hello";   // 字符串类型
'5';       // 字符类型
5;         // 整数类型
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.literal.string-representation"><a class="rule-link" href="#r-expr.literal.string-representation" title="expr.literal.string-representation"><span>[expr<wbr>.literal<wbr>.string-representation]</span></a>
</div>

<p>在下面的描述中， 词法单元 的 <em>字符串表示</em> 是指输入中与 词法分析器 语法片段中的 词法单元 生成式匹配的字符序列。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>此字符串表示永远不会包含紧跟在 <code>U+000D</code> (CR) 之后的字符 <code>U+000A</code> (LF): 这对字符之前会被转换为单个 <code>U+000A</code> (LF)。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.literal.escape"><a class="rule-link" href="#r-expr.literal.escape" title="expr.literal.escape"><span>[expr<wbr>.literal<wbr>.escape]</span></a>
</div>

<h2 id="转义"><a class="header" href="#转义">转义</a></h2>
<div class="rule" id="r-expr.literal.escape.intro"><a class="rule-link" href="#r-expr.literal.escape.intro" title="expr.literal.escape.intro"><span>[expr<wbr>.literal<wbr>.escape<wbr>.intro]</span></a>
</div>

<p>下面对文本字面量表达式的描述使用了几种形式的 <em>转义</em> 。</p>
<div class="rule" id="r-expr.literal.escape.sequence"><a class="rule-link" href="#r-expr.literal.escape.sequence" title="expr.literal.escape.sequence"><span>[expr<wbr>.literal<wbr>.escape<wbr>.sequence]</span></a>
</div>

<p>每种形式的转义都具有以下特征:</p>
<ul>
<li><em>转义序列</em> : 一个字符序列，总是以 <code>U+005C</code> (<code>\</code>) 开头</li>
<li><em>转义值</em> : 单个字符或空字符序列</li>
</ul>
<p>在下面的转义定义中:</p>
<ul>
<li><em>八进制数字</em> 是范围 [<code>0</code>-<code>7</code>] 中的任何字符。</li>
<li><em>十六进制数字</em> 是范围 [<code>0</code>-<code>9</code>], [<code>a</code>-<code>f</code>], 或 [<code>A</code>-<code>F</code>] 中的任何字符。</li>
</ul>
<div class="rule" id="r-expr.literal.escape.simple"><a class="rule-link" href="#r-expr.literal.escape.simple" title="expr.literal.escape.simple"><span>[expr<wbr>.literal<wbr>.escape<wbr>.simple]</span></a>
</div>

<h3 id="简单转义"><a class="header" href="#简单转义">简单转义</a></h3>
<p>下表第一列中出现的每个字符序列都是一个转义序列。</p>
<p>在每种情况下，转义值都是第二列相应条目中给出的字符。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>转义序列</th><th>转义值</th></tr>
</thead>
<tbody>
<tr><td><code>\0</code></td><td>U+0000 (NUL)</td></tr>
<tr><td><code>\t</code></td><td>U+0009 (HT)</td></tr>
<tr><td><code>\n</code></td><td>U+000A (LF)</td></tr>
<tr><td><code>\r</code></td><td>U+000D (CR)</td></tr>
<tr><td><code>\"</code></td><td>U+0022 (QUOTATION MARK)</td></tr>
<tr><td><code>\'</code></td><td>U+0027 (APOSTROPHE)</td></tr>
<tr><td><code>\\</code></td><td>U+005C (REVERSE SOLIDUS)</td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-expr.literal.escape.hex-octet"><a class="rule-link" href="#r-expr.literal.escape.hex-octet" title="expr.literal.escape.hex-octet"><span>[expr<wbr>.literal<wbr>.escape<wbr>.hex-octet]</span></a>
</div>

<h3 id="8位转义"><a class="header" href="#8位转义">8位转义</a></h3>
<p>转义序列由 <code>\x</code> 后跟两个十六进制数字组成。</p>
<p>转义值是其 <a href="http://www.unicode.org/glossary/#unicode_scalar_value">Unicode 标量值</a> 为将转义序列中的最后两个字符解释为十六进制整数的结果的字符，就像通过基数为 16 的 <a href="../std/primitive.u8.html#method.from_str_radix"><code>u8::from_str_radix</code></a> 处理一样。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>因此，转义值具有 <a href="#数值类型"><code>u8</code></a> 范围内的 <a href="http://www.unicode.org/glossary/#unicode_scalar_value">Unicode 标量值</a> 。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.literal.escape.hex-ascii"><a class="rule-link" href="#r-expr.literal.escape.hex-ascii" title="expr.literal.escape.hex-ascii"><span>[expr<wbr>.literal<wbr>.escape<wbr>.hex-ascii]</span></a>
</div>

<h3 id="7位转义"><a class="header" href="#7位转义">7位转义</a></h3>
<p>转义序列由 <code>\x</code> 后跟一个八进制数字，然后是一个十六进制数字组成。</p>
<p>转义值是其 <a href="http://www.unicode.org/glossary/#unicode_scalar_value">Unicode 标量值</a> 为将转义序列中的最后两个字符解释为十六进制整数的结果的字符，就像通过基数为 16 的 <a href="../std/primitive.u8.html#method.from_str_radix"><code>u8::from_str_radix</code></a> 处理一样。</p>
<div class="rule" id="r-expr.literal.escape.unicode"><a class="rule-link" href="#r-expr.literal.escape.unicode" title="expr.literal.escape.unicode"><span>[expr<wbr>.literal<wbr>.escape<wbr>.unicode]</span></a>
</div>

<h3 id="unicode-转义"><a class="header" href="#unicode-转义">Unicode 转义</a></h3>
<p>转义序列由 <code>\u{</code>, 后跟一系列字符（每个字符都是十六进制数字或 <code>_</code> ）, 最后跟 <code>}</code> 组成。</p>
<p>转义值是其 <a href="http://www.unicode.org/glossary/#unicode_scalar_value">Unicode 标量值</a> 为将转义序列中包含的十六进制数字解释为十六进制整数的结果的字符，就像通过基数为 16 的 <a href="../std/primitive.u32.html#method.from_str_radix"><code>u32::from_str_radix</code></a> 处理一样。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><a href="#grammar-CHAR_LITERAL">CHAR_LITERAL</a> 或 <a href="#grammar-STRING_LITERAL">STRING_LITERAL</a> 词法单元 的允许形式确保存在这样的字符。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.literal.continuation"><a class="rule-link" href="#r-expr.literal.continuation" title="expr.literal.continuation"><span>[expr<wbr>.literal<wbr>.continuation]</span></a>
</div>

<h3 id="字符串续行转义"><a class="header" href="#字符串续行转义">字符串续行转义</a></h3>
<p>转义序列由 <code>\</code> 紧跟 <code>U+000A</code> (LF) 组成，以及在下一个非空白字符之前的所有后续空白字符。
为此，空白字符为 <code>U+0009</code> (HT), <code>U+000A</code> (LF), <code>U+000D</code> (CR), 和 <code>U+0020</code> (SPACE)。</p>
<p>转义值是一个空字符序列。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>这种形式的转义效果是字符串续行会跳过后续的空白字符，包括额外的换行符。因此 <code>a</code>, <code>b</code> 和 <code>c</code> 是相等的:</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let a = "foobar";
let b = "foo\
         bar";
let c = "foo\

     bar";

assert_eq!(a, b);
assert_eq!(b, c);
<span class="boring">}</span></code></pre>
<p>跳过额外的换行符（如示例 c 所示）可能会令人困惑且出乎意料。此行为将来可能会进行调整。在做出决定之前，建议避免依赖于通过行续行跳过多个换行符。有关更多信息，请参阅 <a href="https://github.com/rust-lang/reference/pull/1042">此问题</a> 。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.literal.char"><a class="rule-link" href="#r-expr.literal.char" title="expr.literal.char"><span>[expr<wbr>.literal<wbr>.char]</span></a>
</div>

<h2 id="字符字面量表达式"><a class="header" href="#字符字面量表达式">字符字面量表达式</a></h2>
<div class="rule" id="r-expr.literal.char.intro"><a class="rule-link" href="#r-expr.literal.char.intro" title="expr.literal.char.intro"><span>[expr<wbr>.literal<wbr>.char<wbr>.intro]</span></a>
</div>

<p>字符字面量表达式由单个 <a href="#grammar-CHAR_LITERAL">CHAR_LITERAL</a> 词法单元 组成。</p>
<div class="rule" id="r-expr.literal.char.type"><a class="rule-link" href="#r-expr.literal.char.type" title="expr.literal.char.type"><span>[expr<wbr>.literal<wbr>.char<wbr>.type]</span></a>
</div>

<p>该表达式的类型是原始 <a href="#文本类型"><code>char</code></a> 类型。</p>
<div class="rule" id="r-expr.literal.char.no-suffix"><a class="rule-link" href="#r-expr.literal.char.no-suffix" title="expr.literal.char.no-suffix"><span>[expr<wbr>.literal<wbr>.char<wbr>.no-suffix]</span></a>
</div>

<p>词法单元 必须没有后缀。</p>
<div class="rule" id="r-expr.literal.char.literal-content"><a class="rule-link" href="#r-expr.literal.char.literal-content" title="expr.literal.char.literal-content"><span>[expr<wbr>.literal<wbr>.char<wbr>.literal-content]</span></a>
</div>

<p>词法单元 的 <em>字面量内容</em> 是该 词法单元 的字符串表示中第一个 <code>U+0027</code> (<code>'</code>) 之后且最后一个 <code>U+0027</code> (<code>'</code>) 之前的字符序列。</p>
<div class="rule" id="r-expr.literal.char.represented"><a class="rule-link" href="#r-expr.literal.char.represented" title="expr.literal.char.represented"><span>[expr<wbr>.literal<wbr>.char<wbr>.represented]</span></a>
</div>

<p>字面量表达式的 <em>表示字符</em> 按如下方式从字面量内容导出:</p>
<div class="rule" id="r-expr.literal.char.escape"><a class="rule-link" href="#r-expr.literal.char.escape" title="expr.literal.char.escape"><span>[expr<wbr>.literal<wbr>.char<wbr>.escape]</span></a>
</div>

<ul>
<li>如果字面量内容是以下形式之一的转义序列，则表示字符是该转义序列的转义值:
<ul>
<li><a href="#simple-escapes">简单转义</a></li>
<li><a href="#7-bit-escapes">7位转义</a></li>
<li><a href="#unicode-escapes">Unicode 转义</a></li>
</ul>
</li>
</ul>
<div class="rule" id="r-expr.literal.char.single"><a class="rule-link" href="#r-expr.literal.char.single" title="expr.literal.char.single"><span>[expr<wbr>.literal<wbr>.char<wbr>.single]</span></a>
</div>

<ul>
<li>否则，表示字符是构成字面量内容的单个字符。</li>
</ul>
<div class="rule" id="r-expr.literal.char.result"><a class="rule-link" href="#r-expr.literal.char.result" title="expr.literal.char.result"><span>[expr<wbr>.literal<wbr>.char<wbr>.result]</span></a>
</div>

<p>该表达式的值是与表示字符的 <a href="http://www.unicode.org/glossary/#unicode_scalar_value">Unicode 标量值</a> 对应的 <a href="#文本类型"><code>char</code></a> 。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><a href="#grammar-CHAR_LITERAL">CHAR_LITERAL</a> 词法单元 的允许形式确保这些规则总是产生单个字符。</p>
</blockquote>
</div>

<p>字符字面量表达式的示例:</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>'R';                               // R
'\'';                              // '
'\x52';                            // R
'\u{00E6}';                        // 拉丁文小写字母 AE (U+00E6)
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.literal.string"><a class="rule-link" href="#r-expr.literal.string" title="expr.literal.string"><span>[expr<wbr>.literal<wbr>.string]</span></a>
</div>

<h2 id="字符串字面量表达式"><a class="header" href="#字符串字面量表达式">字符串字面量表达式</a></h2>
<div class="rule" id="r-expr.literal.string.intro"><a class="rule-link" href="#r-expr.literal.string.intro" title="expr.literal.string.intro"><span>[expr<wbr>.literal<wbr>.string<wbr>.intro]</span></a>
</div>

<p>字符串字面量表达式由单个 <a href="#grammar-STRING_LITERAL">STRING_LITERAL</a> 或 <a href="#grammar-RAW_STRING_LITERAL">RAW_STRING_LITERAL</a> 词法单元 组成。</p>
<div class="rule" id="r-expr.literal.string.type"><a class="rule-link" href="#r-expr.literal.string.type" title="expr.literal.string.type"><span>[expr<wbr>.literal<wbr>.string<wbr>.type]</span></a>
</div>

<p>该表达式的类型是向原始 <a href="#文本类型"><code>str</code></a> 类型的共享引用（具有 <code>static</code> 生命周期）。
也就是说，类型是 <code>&amp;'static str</code> 。</p>
<div class="rule" id="r-expr.literal.string.no-suffix"><a class="rule-link" href="#r-expr.literal.string.no-suffix" title="expr.literal.string.no-suffix"><span>[expr<wbr>.literal<wbr>.string<wbr>.no-suffix]</span></a>
</div>

<p>词法单元 必须没有后缀。</p>
<div class="rule" id="r-expr.literal.string.literal-content"><a class="rule-link" href="#r-expr.literal.string.literal-content" title="expr.literal.string.literal-content"><span>[expr<wbr>.literal<wbr>.string<wbr>.literal-content]</span></a>
</div>

<p>词法单元 的 <em>字面量内容</em> 是该 词法单元 的字符串表示中第一个 <code>U+0022</code> (<code>"</code>) 之后且最后一个 <code>U+0022</code> (<code>"</code>) 之前的字符序列。</p>
<div class="rule" id="r-expr.literal.string.represented"><a class="rule-link" href="#r-expr.literal.string.represented" title="expr.literal.string.represented"><span>[expr<wbr>.literal<wbr>.string<wbr>.represented]</span></a>
</div>

<p>字面量表达式的 <em>表示字符串</em> 是按如下方式从字面量内容导出的字符序列:</p>
<div class="rule" id="r-expr.literal.string.escape"><a class="rule-link" href="#r-expr.literal.string.escape" title="expr.literal.string.escape"><span>[expr<wbr>.literal<wbr>.string<wbr>.escape]</span></a>
</div>

<ul>
<li>
<p>如果 词法单元 是 <a href="#grammar-STRING_LITERAL">STRING_LITERAL</a> ，则字面量内容中出现的以下任何形式的每个转义序列都将被替换为该转义序列的转义值。</p>
<ul>
<li><a href="#simple-escapes">简单转义</a></li>
<li><a href="#7-bit-escapes">7位转义</a></li>
<li><a href="#unicode-escapes">Unicode 转义</a></li>
<li><a href="#string-continuation-escapes">字符串续行转义</a></li>
</ul>
<p>这些替换按从左到右的顺序进行。
例如， 词法单元 <code>"\\x41"</code> 被转换为字符 <code>\</code> <code>x</code> <code>4</code> <code>1</code> 。</p>
</li>
</ul>
<div class="rule" id="r-expr.literal.string.raw"><a class="rule-link" href="#r-expr.literal.string.raw" title="expr.literal.string.raw"><span>[expr<wbr>.literal<wbr>.string<wbr>.raw]</span></a>
</div>

<ul>
<li>如果 词法单元 是 <a href="#grammar-RAW_STRING_LITERAL">RAW_STRING_LITERAL</a> ，则表示字符串与字面量内容完全相同。</li>
</ul>
<div class="rule" id="r-expr.literal.string.result"><a class="rule-link" href="#r-expr.literal.string.result" title="expr.literal.string.result"><span>[expr<wbr>.literal<wbr>.string<wbr>.result]</span></a>
</div>

<p>该表达式的值是一个指向静态分配的 <a href="#文本类型"><code>str</code></a> 的引用，该字符串包含表示字符串的 UTF-8 编码。</p>
<p>字符串字面量表达式的示例:</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>"foo"; r"foo";                     // foo
"\"foo\""; r#""foo""#;             // "foo"

"foo #\"# bar";
r##"foo #"# bar"##;                // foo #"# bar

"\x52"; "R"; r"R";                 // R
"\\x52"; r"\x52";                  // \x52
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.literal.byte-char"><a class="rule-link" href="#r-expr.literal.byte-char" title="expr.literal.byte-char"><span>[expr<wbr>.literal<wbr>.byte-char]</span></a>
</div>

<h2 id="字节字面量表达式"><a class="header" href="#字节字面量表达式">字节字面量表达式</a></h2>
<div class="rule" id="r-expr.literal.byte-char.intro"><a class="rule-link" href="#r-expr.literal.byte-char.intro" title="expr.literal.byte-char.intro"><span>[expr<wbr>.literal<wbr>.byte-char<wbr>.intro]</span></a>
</div>

<p>字节字面量表达式由单个 <a href="#grammar-BYTE_LITERAL">BYTE_LITERAL</a> 词法单元 组成。</p>
<div class="rule" id="r-expr.literal.byte-char.literal"><a class="rule-link" href="#r-expr.literal.byte-char.literal" title="expr.literal.byte-char.literal"><span>[expr<wbr>.literal<wbr>.byte-char<wbr>.literal]</span></a>
</div>

<p>该表达式的类型是原始 <a href="#数值类型"><code>u8</code></a> 类型。</p>
<div class="rule" id="r-expr.literal.byte-char.no-suffix"><a class="rule-link" href="#r-expr.literal.byte-char.no-suffix" title="expr.literal.byte-char.no-suffix"><span>[expr<wbr>.literal<wbr>.byte-char<wbr>.no-suffix]</span></a>
</div>

<p>词法单元 必须没有后缀。</p>
<div class="rule" id="r-expr.literal.byte-char.literal-content"><a class="rule-link" href="#r-expr.literal.byte-char.literal-content" title="expr.literal.byte-char.literal-content"><span>[expr<wbr>.literal<wbr>.byte-char<wbr>.literal-content]</span></a>
</div>

<p>词法单元 的 <em>字面量内容</em> 是该 词法单元 的字符串表示中第一个 <code>U+0027</code> (<code>'</code>) 之后且最后一个 <code>U+0027</code> (<code>'</code>) 之前的字符序列。</p>
<div class="rule" id="r-expr.literal.byte-char.represented"><a class="rule-link" href="#r-expr.literal.byte-char.represented" title="expr.literal.byte-char.represented"><span>[expr<wbr>.literal<wbr>.byte-char<wbr>.represented]</span></a>
</div>

<p>字面量表达式的 <em>表示字符</em> 按如下方式从字面量内容导出:</p>
<div class="rule" id="r-expr.literal.byte-char.escape"><a class="rule-link" href="#r-expr.literal.byte-char.escape" title="expr.literal.byte-char.escape"><span>[expr<wbr>.literal<wbr>.byte-char<wbr>.escape]</span></a>
</div>

<ul>
<li>如果字面量内容是以下形式之一的转义序列，则表示字符是该转义序列的转义值:
<ul>
<li><a href="#simple-escapes">简单转义</a></li>
<li><a href="#8-bit-escapes">8位转义</a></li>
</ul>
</li>
</ul>
<div class="rule" id="r-expr.literal.byte-char.single"><a class="rule-link" href="#r-expr.literal.byte-char.single" title="expr.literal.byte-char.single"><span>[expr<wbr>.literal<wbr>.byte-char<wbr>.single]</span></a>
</div>

<ul>
<li>否则，表示字符是构成字面量内容的单个字符。</li>
</ul>
<div class="rule" id="r-expr.literal.byte-char.result"><a class="rule-link" href="#r-expr.literal.byte-char.result" title="expr.literal.byte-char.result"><span>[expr<wbr>.literal<wbr>.byte-char<wbr>.result]</span></a>
</div>

<p>该表达式的值是表示字符的 <a href="http://www.unicode.org/glossary/#unicode_scalar_value">Unicode 标量值</a> 。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><a href="#grammar-BYTE_LITERAL">BYTE_LITERAL</a> 词法单元 的允许形式确保这些规则总是产生单个字符，其 Unicode 标量值在 <a href="#数值类型"><code>u8</code></a> 范围内。</p>
</blockquote>
</div>

<p>字节字面量表达式的示例:</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>b'R';                              // 82
b'\'';                             // 39
b'\x52';                           // 82
b'\xA0';                           // 160
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.literal.byte-string"><a class="rule-link" href="#r-expr.literal.byte-string" title="expr.literal.byte-string"><span>[expr<wbr>.literal<wbr>.byte-string]</span></a>
</div>

<h2 id="字节串字面量表达式"><a class="header" href="#字节串字面量表达式">字节串字面量表达式</a></h2>
<div class="rule" id="r-expr.literal.byte-string.intro"><a class="rule-link" href="#r-expr.literal.byte-string.intro" title="expr.literal.byte-string.intro"><span>[expr<wbr>.literal<wbr>.byte-string<wbr>.intro]</span></a>
</div>

<p>字节串字面量表达式由单个 <a href="#grammar-BYTE_STRING_LITERAL">BYTE_STRING_LITERAL</a> 或 <a href="#grammar-RAW_BYTE_STRING_LITERAL">RAW_BYTE_STRING_LITERAL</a> 词法单元 组成。</p>
<div class="rule" id="r-expr.literal.byte-string.type"><a class="rule-link" href="#r-expr.literal.byte-string.type" title="expr.literal.byte-string.type"><span>[expr<wbr>.literal<wbr>.byte-string<wbr>.type]</span></a>
</div>

<p>该表达式的类型是对一个元素类型为 <a href="#数值类型"><code>u8</code></a> 的数组的共享引用（具有 <code>static</code> 生命周期）。
也就是说，类型是 <code>&amp;'static [u8; N]</code> ，其中 <code>N</code> 是下面描述的表示字符串中的字节数。</p>
<div class="rule" id="r-expr.literal.byte-string.no-suffix"><a class="rule-link" href="#r-expr.literal.byte-string.no-suffix" title="expr.literal.byte-string.no-suffix"><span>[expr<wbr>.literal<wbr>.byte-string<wbr>.no-suffix]</span></a>
</div>

<p>词法单元 必须没有后缀。</p>
<div class="rule" id="r-expr.literal.byte-string.literal-content"><a class="rule-link" href="#r-expr.literal.byte-string.literal-content" title="expr.literal.byte-string.literal-content"><span>[expr<wbr>.literal<wbr>.byte-string<wbr>.literal-content]</span></a>
</div>

<p>词法单元 的 <em>字面量内容</em> 是该 词法单元 的字符串表示中第一个 <code>U+0022</code> (<code>"</code>) 之后且最后一个 <code>U+0022</code> (<code>"</code>) 之前的字符序列。</p>
<div class="rule" id="r-expr.literal.byte-string.represented"><a class="rule-link" href="#r-expr.literal.byte-string.represented" title="expr.literal.byte-string.represented"><span>[expr<wbr>.literal<wbr>.byte-string<wbr>.represented]</span></a>
</div>

<p>字面量表达式的 <em>表示字符串</em> 是按如下方式从字面量内容导出的字符序列:</p>
<div class="rule" id="r-expr.literal.byte-string.escape"><a class="rule-link" href="#r-expr.literal.byte-string.escape" title="expr.literal.byte-string.escape"><span>[expr<wbr>.literal<wbr>.byte-string<wbr>.escape]</span></a>
</div>

<ul>
<li>
<p>如果 词法单元 是 <a href="#grammar-BYTE_STRING_LITERAL">BYTE_STRING_LITERAL</a> ，则字面量内容中出现的以下任何形式的每个转义序列都将被替换为该转义序列的转义值。</p>
<ul>
<li><a href="#simple-escapes">简单转义</a></li>
<li><a href="#8-bit-escapes">8位转义</a></li>
<li><a href="#string-continuation-escapes">字符串续行转义</a></li>
</ul>
<p>这些替换按从左到右的顺序进行。
例如， 词法单元 <code>b"\\x41"</code> 被转换为字符 <code>\</code> <code>x</code> <code>4</code> <code>1</code> 。</p>
</li>
</ul>
<div class="rule" id="r-expr.literal.byte-string.raw"><a class="rule-link" href="#r-expr.literal.byte-string.raw" title="expr.literal.byte-string.raw"><span>[expr<wbr>.literal<wbr>.byte-string<wbr>.raw]</span></a>
</div>

<ul>
<li>如果 词法单元 是 <a href="#grammar-RAW_BYTE_STRING_LITERAL">RAW_BYTE_STRING_LITERAL</a> ，则表示字符串与字面量内容完全相同。</li>
</ul>
<div class="rule" id="r-expr.literal.byte-string.result"><a class="rule-link" href="#r-expr.literal.byte-string.result" title="expr.literal.byte-string.result"><span>[expr<wbr>.literal<wbr>.byte-string<wbr>.result]</span></a>
</div>

<p>该表达式的值是一个指向静态分配数组的引用，该数组按相同顺序包含表示字符串中字符的 <a href="http://www.unicode.org/glossary/#unicode_scalar_value">Unicode 标量值</a> 。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><a href="#grammar-BYTE_STRING_LITERAL">BYTE_STRING_LITERAL</a> 和 <a href="#grammar-RAW_BYTE_STRING_LITERAL">RAW_BYTE_STRING_LITERAL</a> 词法单元 的允许形式确保这些规则总是产生 <a href="#数值类型"><code>u8</code></a> 范围内的数组元素值。</p>
</blockquote>
</div>

<p>字节串字面量表达式的示例:</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>b"foo"; br"foo";                     // foo
b"\"foo\""; br#""foo""#;             // "foo"

b"foo #\"# bar";
br##"foo #"# bar"##;                 // foo #"# bar

b"\x52"; b"R"; br"R";                // R
b"\\x52"; br"\x52";                  // \x52
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.literal.c-string"><a class="rule-link" href="#r-expr.literal.c-string" title="expr.literal.c-string"><span>[expr<wbr>.literal<wbr>.c-string]</span></a>
</div>

<h2 id="c字符串字面量表达式"><a class="header" href="#c字符串字面量表达式">C字符串字面量表达式</a></h2>
<div class="rule" id="r-expr.literal.c-string.intro"><a class="rule-link" href="#r-expr.literal.c-string.intro" title="expr.literal.c-string.intro"><span>[expr<wbr>.literal<wbr>.c-string<wbr>.intro]</span></a>
</div>

<p>C 字符串字面量表达式由单个 <a href="#grammar-C_STRING_LITERAL">C_STRING_LITERAL</a> 或 <a href="#grammar-RAW_C_STRING_LITERAL">RAW_C_STRING_LITERAL</a> 词法单元 组成。</p>
<div class="rule" id="r-expr.literal.c-string.type"><a class="rule-link" href="#r-expr.literal.c-string.type" title="expr.literal.c-string.type"><span>[expr<wbr>.literal<wbr>.c-string<wbr>.type]</span></a>
</div>

<p>该表达式的类型是对标准库 <a href="../core/ffi/c_str/struct.CStr.html">CStr</a> 类型的共享引用（具有 <code>static</code> 生命周期）。
也就是说，类型是 <code>&amp;'static core::ffi::CStr</code> 。</p>
<div class="rule" id="r-expr.literal.c-string.no-suffix"><a class="rule-link" href="#r-expr.literal.c-string.no-suffix" title="expr.literal.c-string.no-suffix"><span>[expr<wbr>.literal<wbr>.c-string<wbr>.no-suffix]</span></a>
</div>

<p>词法单元 必须没有后缀。</p>
<div class="rule" id="r-expr.literal.c-string.literal-content"><a class="rule-link" href="#r-expr.literal.c-string.literal-content" title="expr.literal.c-string.literal-content"><span>[expr<wbr>.literal<wbr>.c-string<wbr>.literal-content]</span></a>
</div>

<p>词法单元 的 <em>字面量内容</em> 是该 词法单元 的字符串表示中第一个 <code>"</code> 之后且最后一个 <code>"</code> 之前的字符序列。</p>
<div class="rule" id="r-expr.literal.c-string.represented"><a class="rule-link" href="#r-expr.literal.c-string.represented" title="expr.literal.c-string.represented"><span>[expr<wbr>.literal<wbr>.c-string<wbr>.represented]</span></a>
</div>

<p>字面量表达式的 <em>表示字节</em> 是按如下方式从字面量内容导出的字节序列:</p>
<div class="rule" id="r-expr.literal.c-string.escape"><a class="rule-link" href="#r-expr.literal.c-string.escape" title="expr.literal.c-string.escape"><span>[expr<wbr>.literal<wbr>.c-string<wbr>.escape]</span></a>
</div>

<ul>
<li>如果 词法单元 是 <a href="#grammar-C_STRING_LITERAL">C_STRING_LITERAL</a> ，则字面量内容被视为一系列 项 ，其中每个 项 要么是除 <code>\</code> 之外的单个 Unicode 字符，要么是一个 <a href="#escapes">转义</a> 。
项 序列按如下方式转换为字节序列:
<ul>
<li>每个单个 Unicode 字符贡献其 UTF-8 表示。</li>
<li>每个 <a href="#simple-escapes">简单转义</a> 贡献其转义值的 <a href="http://www.unicode.org/glossary/#unicode_scalar_value">Unicode 标量值</a> 。</li>
<li>每个 <a href="#8-bit-escapes">8位转义</a> 贡献一个包含其转义值的 <a href="http://www.unicode.org/glossary/#unicode_scalar_value">Unicode 标量值</a> 的单字节。</li>
<li>每个 <a href="#unicode-escapes">Unicode 转义</a> 贡献其转义值的 UTF-8 表示。</li>
<li>每个 <a href="#string-continuation-escapes">字符串续行转义</a> 不贡献字节。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-expr.literal.c-string.raw"><a class="rule-link" href="#r-expr.literal.c-string.raw" title="expr.literal.c-string.raw"><span>[expr<wbr>.literal<wbr>.c-string<wbr>.raw]</span></a>
</div>

<ul>
<li>如果 词法单元 是 <a href="#grammar-RAW_C_STRING_LITERAL">RAW_C_STRING_LITERAL</a> ，则表示字节是字面量内容的 UTF-8 编码。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><a href="#grammar-C_STRING_LITERAL">C_STRING_LITERAL</a> 和 <a href="#grammar-RAW_C_STRING_LITERAL">RAW_C_STRING_LITERAL</a> 词法单元 的允许形式确保表示字节永远不会包含空字节。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.literal.c-string.result"><a class="rule-link" href="#r-expr.literal.c-string.result" title="expr.literal.c-string.result"><span>[expr<wbr>.literal<wbr>.c-string<wbr>.result]</span></a>
</div>

<p>该表达式的值是一个指向静态分配的 <a href="../core/ffi/c_str/struct.CStr.html">CStr</a> 的引用，其字节数组包含表示字节，后跟一个空字节。</p>
<p>C 字符串字面量表达式的示例:</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>c"foo"; cr"foo";                     // foo
c"\"foo\""; cr#""foo""#;             // "foo"

c"foo #\"# bar";
cr##"foo #"# bar"##;                 // foo #"# bar

c"\x52"; c"R"; cr"R";                // R
c"\\x52"; cr"\x52";                  // \x52

c"æ";                                // 拉丁文小写字母 AE (U+00E6)
c"\u{00E6}";                         // 拉丁文小写字母 AE (U+00E6)
c"\xC3\xA6";                         // 拉丁文小写字母 AE (U+00E6)

c"\xE6".to_bytes();                  // [230]
c"\u{00E6}".to_bytes();              // [195, 166]
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.literal.int"><a class="rule-link" href="#r-expr.literal.int" title="expr.literal.int"><span>[expr<wbr>.literal<wbr>.int]</span></a>
</div>

<h2 id="整数字面量表达式"><a class="header" href="#整数字面量表达式">整数字面量表达式</a></h2>
<div class="rule" id="r-expr.literal.int.intro"><a class="rule-link" href="#r-expr.literal.int.intro" title="expr.literal.int.intro"><span>[expr<wbr>.literal<wbr>.int<wbr>.intro]</span></a>
</div>

<p>整数字面量表达式由单个 <a href="#grammar-INTEGER_LITERAL">INTEGER_LITERAL</a> 词法单元 组成。</p>
<div class="rule" id="r-expr.literal.int.suffix"><a class="rule-link" href="#r-expr.literal.int.suffix" title="expr.literal.int.suffix"><span>[expr<wbr>.literal<wbr>.int<wbr>.suffix]</span></a>
</div>

<p>如果 词法单元 具有 <a href="#后缀">后缀</a> ，则后缀必须是 <a href="#数值类型">原始整数类型</a> 之一的名称:  <code>u8</code>, <code>i8</code>, <code>u16</code>, <code>i16</code>, <code>u32</code>, <code>i32</code>, <code>u64</code>, <code>i64</code>, <code>u128</code>, <code>i128</code>, <code>usize</code>, 或 <code>isize</code> ，并且表达式具有该类型。</p>
<div class="rule" id="r-expr.literal.int.infer"><a class="rule-link" href="#r-expr.literal.int.infer" title="expr.literal.int.infer"><span>[expr<wbr>.literal<wbr>.int<wbr>.infer]</span></a>
</div>

<p>如果 词法单元 没有后缀，则表达式的类型通过类型推导确定:</p>
<div class="rule" id="r-expr.literal.int.inference-unique-type"><a class="rule-link" href="#r-expr.literal.int.inference-unique-type" title="expr.literal.int.inference-unique-type"><span>[expr<wbr>.literal<wbr>.int<wbr>.inference-unique-type]</span></a>
</div>

<ul>
<li>如果可以从周围的程序上下文中 <em>唯一</em> 确定整数类型，则该表达式具有该类型。</li>
</ul>
<div class="rule" id="r-expr.literal.int.inference-default"><a class="rule-link" href="#r-expr.literal.int.inference-default" title="expr.literal.int.inference-default"><span>[expr<wbr>.literal<wbr>.int<wbr>.inference-default]</span></a>
</div>

<ul>
<li>如果程序上下文对类型的约束不足，则默认为有符号 32 位整数 <code>i32</code> 。</li>
</ul>
<div class="rule" id="r-expr.literal.int.inference-error"><a class="rule-link" href="#r-expr.literal.int.inference-error" title="expr.literal.int.inference-error"><span>[expr<wbr>.literal<wbr>.int<wbr>.inference-error]</span></a>
</div>

<ul>
<li>如果程序上下文对类型的约束过度，则被视为静态类型错误。</li>
</ul>
<p>整数字面量表达式的示例:</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>123;                               // 类型 i32
123i32;                            // 类型 i32
123u32;                            // 类型 u32
123_u32;                           // 类型 u32
let a: u64 = 123;                  // 类型 u64

0xff;                              // 类型 i32
0xff_u8;                           // 类型 u8

0o70;                              // 类型 i32
0o70_i16;                          // 类型 i16

0b1111_1111_1001_0000;             // 类型 i32
0b1111_1111_1001_0000i64;          // 类型 i64

0usize;                            // 类型 usize
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.literal.int.representation"><a class="rule-link" href="#r-expr.literal.int.representation" title="expr.literal.int.representation"><span>[expr<wbr>.literal<wbr>.int<wbr>.representation]</span></a>
</div>

<p>该表达式的值从 词法单元 的字符串表示中按如下方式确定:</p>
<div class="rule" id="r-expr.literal.int.radix"><a class="rule-link" href="#r-expr.literal.int.radix" title="expr.literal.int.radix"><span>[expr<wbr>.literal<wbr>.int<wbr>.radix]</span></a>
</div>

<ul>
<li>
<p>通过检查字符串的前两个字符来选择整数基数，如下所示:</p>
<ul>
<li><code>0b</code> 表示基数 2</li>
<li><code>0o</code> 表示基数 8</li>
<li><code>0x</code> 表示基数 16</li>
<li>否则基数为 10。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-expr.literal.int.radix-prefix-stripped"><a class="rule-link" href="#r-expr.literal.int.radix-prefix-stripped" title="expr.literal.int.radix-prefix-stripped"><span>[expr<wbr>.literal<wbr>.int<wbr>.radix-prefix-stripped]</span></a>
</div>

<ul>
<li>如果基数不是 10，则从字符串中移除前两个字符。</li>
</ul>
<div class="rule" id="r-expr.literal.int.type-suffix-stripped"><a class="rule-link" href="#r-expr.literal.int.type-suffix-stripped" title="expr.literal.int.type-suffix-stripped"><span>[expr<wbr>.literal<wbr>.int<wbr>.type-suffix-stripped]</span></a>
</div>

<ul>
<li>从字符串中移除任何后缀。</li>
</ul>
<div class="rule" id="r-expr.literal.int.separators-stripped"><a class="rule-link" href="#r-expr.literal.int.separators-stripped" title="expr.literal.int.separators-stripped"><span>[expr<wbr>.literal<wbr>.int<wbr>.separators-stripped]</span></a>
</div>

<ul>
<li>从字符串中移除任何下划线。</li>
</ul>
<div class="rule" id="r-expr.literal.int.u128-value"><a class="rule-link" href="#r-expr.literal.int.u128-value" title="expr.literal.int.u128-value"><span>[expr<wbr>.literal<wbr>.int<wbr>.u128-value]</span></a>
</div>

<ul>
<li>字符串被转换为 <code>u128</code> 值，就像通过具有所选基数的 <a href="../std/primitive.u128.html#method.from_str_radix"><code>u128::from_str_radix</code></a> 处理一样。
如果值不适合 <code>u128</code> ，则是编译器错误。</li>
</ul>
<div class="rule" id="r-expr.literal.int.cast"><a class="rule-link" href="#r-expr.literal.int.cast" title="expr.literal.int.cast"><span>[expr<wbr>.literal<wbr>.int<wbr>.cast]</span></a>
</div>

<ul>
<li><code>u128</code> 值通过 <a href="#numeric-cast">数值强转</a> 转换为表达式的类型。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>如果字面量的值不适合表达式的类型，最终的强转将截断该值。 <code>rustc</code> 包含一个名为 <code>overflowing_literals</code> 的 <a href="#lint-check-attributes">lint 检查</a> ，默认为 <code>deny</code> ，它会拒绝发生这种情况的表达式。</p>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>例如， <code>-1i8</code> 是 <a href="#negation-operators">求负运算符</a> 对字面量表达式 <code>1i8</code> 的应用，而不是单个整数字面量表达式。有关表示有符号类型的最小负值（绝对值最大）的注意事项，请参阅 <a href="#overflow">溢出</a> 。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.literal.float"><a class="rule-link" href="#r-expr.literal.float" title="expr.literal.float"><span>[expr<wbr>.literal<wbr>.float]</span></a>
</div>

<h2 id="浮点数字面量表达式"><a class="header" href="#浮点数字面量表达式">浮点数字面量表达式</a></h2>
<div class="rule" id="r-expr.literal.float.intro"><a class="rule-link" href="#r-expr.literal.float.intro" title="expr.literal.float.intro"><span>[expr<wbr>.literal<wbr>.float<wbr>.intro]</span></a>
</div>

<p>浮点数字面量表达式具有以下两种形式之一:</p>
<ul>
<li>单个 <a href="#grammar-FLOAT_LITERAL">FLOAT_LITERAL</a> 词法单元</li>
<li>具有后缀且没有基数指示符的单个 <a href="#grammar-INTEGER_LITERAL">INTEGER_LITERAL</a> 词法单元</li>
</ul>
<div class="rule" id="r-expr.literal.float.suffix"><a class="rule-link" href="#r-expr.literal.float.suffix" title="expr.literal.float.suffix"><span>[expr<wbr>.literal<wbr>.float<wbr>.suffix]</span></a>
</div>

<p>如果 词法单元 具有 <a href="#后缀">后缀</a> ，则后缀必须是 <a href="#floating-point-types">原始浮点类型</a> 之一的名称:  <code>f32</code> 或 <code>f64</code> ，并且表达式具有该类型。</p>
<div class="rule" id="r-expr.literal.float.infer"><a class="rule-link" href="#r-expr.literal.float.infer" title="expr.literal.float.infer"><span>[expr<wbr>.literal<wbr>.float<wbr>.infer]</span></a>
</div>

<p>如果 词法单元 没有后缀，则表达式的类型通过类型推导确定:</p>
<div class="rule" id="r-expr.literal.float.inference-unique-type"><a class="rule-link" href="#r-expr.literal.float.inference-unique-type" title="expr.literal.float.inference-unique-type"><span>[expr<wbr>.literal<wbr>.float<wbr>.inference-unique-type]</span></a>
</div>

<ul>
<li>如果可以从周围的程序上下文中 <em>唯一</em> 确定浮点类型，则该表达式具有该类型。</li>
</ul>
<div class="rule" id="r-expr.literal.float.inference-default"><a class="rule-link" href="#r-expr.literal.float.inference-default" title="expr.literal.float.inference-default"><span>[expr<wbr>.literal<wbr>.float<wbr>.inference-default]</span></a>
</div>

<ul>
<li>如果程序上下文对类型的约束不足，则默认为 <code>f64</code> 。</li>
</ul>
<div class="rule" id="r-expr.literal.float.inference-error"><a class="rule-link" href="#r-expr.literal.float.inference-error" title="expr.literal.float.inference-error"><span>[expr<wbr>.literal<wbr>.float<wbr>.inference-error]</span></a>
</div>

<ul>
<li>如果程序上下文对类型的约束过度，则被视为静态类型错误。</li>
</ul>
<p>浮点数字面量表达式的示例:</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>123.0f64;        // 类型 f64
0.1f64;          // 类型 f64
0.1f32;          // 类型 f32
12E+99_f64;      // 类型 f64
5f32;            // 类型 f32
let x: f64 = 2.; // 类型 f64
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.literal.float.result"><a class="rule-link" href="#r-expr.literal.float.result" title="expr.literal.float.result"><span>[expr<wbr>.literal<wbr>.float<wbr>.result]</span></a>
</div>

<p>该表达式的值从 词法单元 的字符串表示中按如下方式确定:</p>
<div class="rule" id="r-expr.literal.float.type-suffix-stripped"><a class="rule-link" href="#r-expr.literal.float.type-suffix-stripped" title="expr.literal.float.type-suffix-stripped"><span>[expr<wbr>.literal<wbr>.float<wbr>.type-suffix-stripped]</span></a>
</div>

<ul>
<li>从字符串中移除任何后缀。</li>
</ul>
<div class="rule" id="r-expr.literal.float.separators-stripped"><a class="rule-link" href="#r-expr.literal.float.separators-stripped" title="expr.literal.float.separators-stripped"><span>[expr<wbr>.literal<wbr>.float<wbr>.separators-stripped]</span></a>
</div>

<ul>
<li>从字符串中移除任何下划线。</li>
</ul>
<div class="rule" id="r-expr.literal.float.value"><a class="rule-link" href="#r-expr.literal.float.value" title="expr.literal.float.value"><span>[expr<wbr>.literal<wbr>.float<wbr>.value]</span></a>
</div>

<ul>
<li>字符串被转换为表达式的类型，就像通过 <a href="../core/primitive.f32.html#method.from_str"><code>f32::from_str</code></a> 或 <a href="../core/primitive.f64.html#method.from_str"><code>f64::from_str</code> </a> 处理一样。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>例如， <code>-1.0</code> 是 <a href="#negation-operators">求负运算符</a> 对字面量表达式 <code>1.0</code> 的应用，而不是单个浮点数字面量表达式。</p>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>inf</code> 和 <code>NaN</code> 不是字面量 词法单元 。可以使用 <a href="../std/primitive.f32.html#associatedconstant.INFINITY"><code>f32::INFINITY</code></a>, <a href="../std/primitive.f64.html#associatedconstant.INFINITY"><code>f64::INFINITY</code></a>, <a href="../std/primitive.f32.html#associatedconstant.NAN"><code>f32::NAN</code></a>, 和 <a href="../std/primitive.f64.html#associatedconstant.NAN"><code>f64::NAN</code></a> 常量来代替字面量表达式。在 <code>rustc</code> 中，大到足以被求值为无穷大的字面量将触发 <code>overflowing_literals</code> lint 检查。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.literal.bool"><a class="rule-link" href="#r-expr.literal.bool" title="expr.literal.bool"><span>[expr<wbr>.literal<wbr>.bool]</span></a>
</div>

<h2 id="布尔字面量表达式"><a class="header" href="#布尔字面量表达式">布尔字面量表达式</a></h2>
<div class="rule" id="r-expr.literal.bool.intro"><a class="rule-link" href="#r-expr.literal.bool.intro" title="expr.literal.bool.intro"><span>[expr<wbr>.literal<wbr>.bool<wbr>.intro]</span></a>
</div>

<p>布尔字面量表达式由关键字 <code>true</code> 或 <code>false</code> 之一组成。</p>
<div class="rule" id="r-expr.literal.bool.result"><a class="rule-link" href="#r-expr.literal.bool.result" title="expr.literal.bool.result"><span>[expr<wbr>.literal<wbr>.bool<wbr>.result]</span></a>
</div>

<p>该表达式的类型是原始 <a href="#布尔类型">布尔类型</a> ，其值为:</p>
<ul>
<li>如果关键字是 <code>true</code> ，则为 true</li>
<li>如果关键字是 <code>false</code> ，则为 false</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr.path"><a class="rule-link" href="#r-expr.path" title="expr.path"><span>[expr<wbr>.path]</span></a>
</div>

<h1 id="路径表达式"><a class="header" href="#路径表达式">路径表达式</a></h1>
<div class="rule" id="r-expr.path.syntax"><a class="rule-link" href="#r-expr.path.syntax" title="expr.path.syntax"><span>[expr<wbr>.path<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-PathExpression" onclick="show_railroad()"><a href="#railroad-PathExpression">PathExpression</a></span> → <br>      <span class="grammar-text"><a href="#grammar-PathInExpression">PathInExpression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-QualifiedPathInExpression">QualifiedPathInExpression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 346px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-PathExpression"><svg class="railroad" viewbox="0 0 346 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-PathExpression">
<text class="comment" x="64" y="25">
PathExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 148 0 h 104 m -49 0 l -5 -5 m 0 10 l 5 -5 m 49 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-PathInExpression">
<g class="nonterminal">
<rect height="22" width="148" x="59" y="42" />
<text x="133" y="58">
PathInExpression</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 252 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 228 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-QualifiedPathInExpression">
<g class="nonterminal">
<rect height="22" width="228" x="59" y="75" />
<text x="173" y="91">
QualifiedPathInExpression</text>
</g>
</a>
</g>
<path d=" M 321 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 311 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.path.intro"><a class="rule-link" href="#r-expr.path.intro" title="expr.path.intro"><span>[expr<wbr>.path<wbr>.intro]</span></a>
</div>

<p>一个在表达式语境中使用的 <a href="#路径">路径</a> 表示一个局部变量或一个 项 。</p>
<div class="rule" id="r-expr.path.place"><a class="rule-link" href="#r-expr.path.place" title="expr.path.place"><span>[expr<wbr>.path<wbr>.place]</span></a>
</div>

<p>解析为局部变量或静态变量的路径表达式是 <a href="#位置表达式和值表达式">位置表达式</a> ；其他路径是 <a href="#位置表达式和值表达式">值表达式</a> 。</p>
<div class="rule" id="r-expr.path.safety"><a class="rule-link" href="#r-expr.path.safety" title="expr.path.safety"><span>[expr<wbr>.path<wbr>.safety]</span></a>
</div>

<p>使用 <a href="#mutable-statics"><code>static mut</code></a> 变量需要一个 <a href="#unsafe-blocks"><code>unsafe</code> 块</a> 。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">mod globals {
</span><span class="boring">    pub static STATIC_VAR: i32 = 5;
</span><span class="boring">    pub static mut STATIC_MUT_VAR: i32 = 7;
</span><span class="boring">}
</span><span class="boring">let local_var = 3;
</span>local_var;
globals::STATIC_VAR;
unsafe { globals::STATIC_MUT_VAR };
let some_constructor = Some::&lt;i32&gt;;
let push_integer = Vec::&lt;i32&gt;::push;
let slice_reverse = &lt;[i32]&gt;::reverse;
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.path.const"><a class="rule-link" href="#r-expr.path.const" title="expr.path.const"><span>[expr<wbr>.path<wbr>.const]</span></a>
</div>

<p>关联常量的求值方式与 <a href="#const-blocks"><code>const</code> 块</a> 相同。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr.block"><a class="rule-link" href="#r-expr.block" title="expr.block"><span>[expr<wbr>.block]</span></a>
</div>

<h1 id="块表达式"><a class="header" href="#块表达式">块表达式</a></h1>
<div class="rule" id="r-expr.block.syntax"><a class="rule-link" href="#r-expr.block.syntax" title="expr.block.syntax"><span>[expr<wbr>.block<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-BlockExpression" onclick="show_railroad()"><a href="#railroad-BlockExpression">BlockExpression</a></span> → <br>    <span class="grammar-literal">{</span> <br>        <span class="grammar-text"><a href="#grammar-InnerAttribute">InnerAttribute</a></span><sup>*</sup> <br>        <span class="grammar-text"><a href="#grammar-Statements">Statements</a></span><sup>?</sup> <br>    <span class="grammar-literal">}</span></p>
<p><span class="grammar-text grammar-production" id="grammar-Statements" onclick="show_railroad()"><a href="#railroad-Statements">Statements</a></span> → <br>      <span class="grammar-text"><a href="#grammar-Statement">Statement</a></span><sup>+</sup> <br>    | <span class="grammar-text"><a href="#grammar-Statement">Statement</a></span><sup>+</sup> <span class="grammar-text"><a href="#grammar-ExpressionWithoutBlock">ExpressionWithoutBlock</a></span> <br>    | <span class="grammar-text"><a href="#grammar-ExpressionWithoutBlock">ExpressionWithoutBlock</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 508px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-BlockExpression"><svg class="railroad" viewbox="0 0 508 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-BlockExpression">
<text class="comment" x="67" y="25">
BlockExpression</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="55" />
<text x="49" y="71">
{</text>
</g>
<g class="optional">
<path d=" M 73 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 97 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-InnerAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="109" y="55" />
<text x="175" y="71">
InnerAttribute</text>
</g>
</a>
</g>
</g>
<g class="optional">
<path d=" M 287 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-Statements">
<g class="nonterminal">
<rect height="22" width="100" x="311" y="55" />
<text x="361" y="71">
Statements</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="445" y="55" />
<text x="459" y="71">
}</text>
</g>
<path d=" M 63 66 h 10" />
<path d=" M 277 66 h 10" />
<path d=" M 435 66 h 10" />
</g>
<path d=" M 483 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 473 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 448px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Statements"><svg class="railroad" viewbox="0 0 448 166" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Statements">
<text class="comment" x="50" y="25">
Statements</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 116 0 h 238 m -116 0 l -5 -5 m 0 10 l 5 -5 m 116 0" />
<g class="sequence">
<g class="repeat">
<path d=" M 59 53 h 12 m 92 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -92 m 49 0 l 5 -5 m 0 10 l -5 -5 m -49 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-Statement">
<g class="nonterminal">
<rect height="22" width="92" x="71" y="42" />
<text x="117" y="58">
Statement</text>
</g>
</a>
</g>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 22 m 354 0 v -22 a 12 12 0 0 1 12 -12" />
<path d=" M 47 87 v 46 m 354 0 v -46" />
<path d=" M 47 87 v 0 a 12 12 0 0 0 12 12 m 330 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="repeat">
<path d=" M 59 99 h 12 m 92 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -92 m 49 0 l 5 -5 m 0 10 l -5 -5 m -49 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-Statement">
<g class="nonterminal">
<rect height="22" width="92" x="71" y="88" />
<text x="117" y="104">
Statement</text>
</g>
</a>
</g>
<a class="link" xlink:href="#railroad-ExpressionWithoutBlock">
<g class="nonterminal">
<rect height="22" width="204" x="185" y="88" />
<text x="287" y="104">
ExpressionWithoutBlock</text>
</g>
</a>
<path d=" M 175 99 h 10" />
</g>
<path d=" M 47 133 v 0 a 12 12 0 0 0 12 12 m 204 0 h 126 m -60 0 l -5 -5 m 0 10 l 5 -5 m 60 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-ExpressionWithoutBlock">
<g class="nonterminal">
<rect height="22" width="204" x="59" y="134" />
<text x="161" y="150">
ExpressionWithoutBlock</text>
</g>
</a>
</g>
<path d=" M 423 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 413 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.block.intro"><a class="rule-link" href="#r-expr.block.intro" title="expr.block.intro"><span>[expr<wbr>.block<wbr>.intro]</span></a>
</div>

<p>一个 <em>块表达式</em> ，或称 <em>块</em> ，是一个控制流表达式，也是 项 和变量声明的匿名命名空间作用域。</p>
<div class="rule" id="r-expr.block.sequential-evaluation"><a class="rule-link" href="#r-expr.block.sequential-evaluation" title="expr.block.sequential-evaluation"><span>[expr<wbr>.block<wbr>.sequential-evaluation]</span></a>
</div>

<p>作为控制流表达式，块会顺序执行其组成的非 项 声明语句，然后执行其最后的可选表达式。</p>
<div class="rule" id="r-expr.block.namespace"><a class="rule-link" href="#r-expr.block.namespace" title="expr.block.namespace"><span>[expr<wbr>.block<wbr>.namespace]</span></a>
</div>

<p>作为匿名命名空间作用域， 项 声明仅在块内部有效，而由 <code>let</code> 语句声明的变量从下一条语句开始到块结束为止在作用域内有效。
有关更多详细信息，请参阅 <a href="#作用域">作用域</a> 章节。</p>
<div class="rule" id="r-expr.block.inner-attributes"><a class="rule-link" href="#r-expr.block.inner-attributes" title="expr.block.inner-attributes"><span>[expr<wbr>.block<wbr>.inner-attributes]</span></a>
</div>

<p>块的 语法格式 为 <code>{</code> ，然后是任何 <a href="#属性-1">内部属性</a> ，接着是任意数量的 <a href="#语句">语句</a> ，然后是一个可选表达式（称为最终操作数），最后是 <code>}</code> 。</p>
<div class="rule" id="r-expr.block.statements"><a class="rule-link" href="#r-expr.block.statements" title="expr.block.statements"><span>[expr<wbr>.block<wbr>.statements]</span></a>
</div>

<p>通常要求语句后跟分号，但有两个例外：</p>
<ol>
<li>项 声明语句不需要后跟分号。</li>
<li>表达式语句通常需要后跟分号，除非其外部表达式是流控制表达式。</li>
</ol>
<div class="rule" id="r-expr.block.null-statement"><a class="rule-link" href="#r-expr.block.null-statement" title="expr.block.null-statement"><span>[expr<wbr>.block<wbr>.null-statement]</span></a>
</div>

<p>此外，允许语句之间存在额外的分号，但这些分号不影响语义。</p>
<div class="rule" id="r-expr.block.evaluation"><a class="rule-link" href="#r-expr.block.evaluation" title="expr.block.evaluation"><span>[expr<wbr>.block<wbr>.evaluation]</span></a>
</div>

<p>在对块表达式求值时，除 项 声明语句外的每个语句都会按顺序执行。</p>
<div class="rule" id="r-expr.block.result"><a class="rule-link" href="#r-expr.block.result" title="expr.block.result"><span>[expr<wbr>.block<wbr>.result]</span></a>
</div>

<p>然后执行最终操作数（如果有）。</p>
<div class="rule" id="r-expr.block.type"><a class="rule-link" href="#r-expr.block.type" title="expr.block.type"><span>[expr<wbr>.block<wbr>.type]</span></a>
</div>

<p>块的类型是最终操作数的类型，如果省略最终操作数，则为 <code>()</code> 。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn fn_call() {}
</span>let _: () = {
    fn_call();
};

let five: i32 = {
    fn_call();
    5
};

assert_eq!(5, five);
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>作为控制流表达式，如果块表达式是表达式语句的外部表达式，则其预期类型为 <code>()</code> ，除非它后面紧跟一个分号。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.block.value"><a class="rule-link" href="#r-expr.block.value" title="expr.block.value"><span>[expr<wbr>.block<wbr>.value]</span></a>
</div>

<p>块始终是 <a href="#位置表达式和值表达式">值表达式</a> ，并在值表达式语境中对最后一个操作数求值。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>如果确实需要，这可以用于强制移动一个值。例如，以下示例在调用 <code>consume_self</code> 时失败，因为 结构体 在块表达式中已从 <code>s</code> 中移出。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Struct;

impl Struct {
    fn consume_self(self) {}
    fn borrow_self(&amp;self) {}
}

fn move_by_block_expression() {
    let s = Struct;

    // 在块表达式中将值从 `s` 中移出。
    (&amp;{ s }).borrow_self();

    // 执行失败，因为 `s` 已被移出。
    s.consume_self();
}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-expr.block.async"><a class="rule-link" href="#r-expr.block.async" title="expr.block.async"><span>[expr<wbr>.block<wbr>.async]</span></a>
</div>

<h2 id="async块"><a class="header" href="#async块"><code>async</code>块</a></h2>
<div class="rule" id="r-expr.block.async.syntax"><a class="rule-link" href="#r-expr.block.async.syntax" title="expr.block.async.syntax"><span>[expr<wbr>.block<wbr>.async<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-AsyncBlockExpression" onclick="show_railroad()"><a href="#railroad-AsyncBlockExpression">AsyncBlockExpression</a></span> → <span class="grammar-literal">async</span> <span class="grammar-literal">move</span><sup>?</sup> <span class="grammar-text"><a href="#grammar-BlockExpression">BlockExpression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 390px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-AsyncBlockExpression"><svg class="railroad" viewbox="0 0 390 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-AsyncBlockExpression">
<text class="comment" x="88" y="25">
AsyncBlockExpression</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="35" y="55" />
<text x="65" y="71">
async</text>
</g>
<g class="optional">
<path d=" M 105 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 52 m -23 0 l -5 -5 m 0 10 l 5 -5 m 23 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="129" y="55" />
<text x="155" y="71">
move</text>
</g>
</g>
<a class="link" xlink:href="#railroad-BlockExpression">
<g class="nonterminal">
<rect height="22" width="140" x="215" y="55" />
<text x="285" y="71">
BlockExpression</text>
</g>
</a>
<path d=" M 95 66 h 10" />
<path d=" M 205 66 h 10" />
</g>
<path d=" M 365 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 355 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.block.async.intro"><a class="rule-link" href="#r-expr.block.async.intro" title="expr.block.async.intro"><span>[expr<wbr>.block<wbr>.async<wbr>.intro]</span></a>
</div>

<p>一个 <em>async 块</em> 是块表达式的一种变体，其求值结果为一个 future。</p>
<div class="rule" id="r-expr.block.async.future-result"><a class="rule-link" href="#r-expr.block.async.future-result" title="expr.block.async.future-result"><span>[expr<wbr>.block<wbr>.async<wbr>.future-result]</span></a>
</div>

<p>块的最终表达式（如果存在）决定了 future 的结果值。</p>
<div class="rule" id="r-expr.block.async.anonymous-type"><a class="rule-link" href="#r-expr.block.async.anonymous-type" title="expr.block.async.anonymous-type"><span>[expr<wbr>.block<wbr>.async<wbr>.anonymous-type]</span></a>
</div>

<p>执行 async 块类似于执行闭包表达式：
它的直接效果是产生并返回一个匿名类型。</p>
<div class="rule" id="r-expr.block.async.future"><a class="rule-link" href="#r-expr.block.async.future" title="expr.block.async.future"><span>[expr<wbr>.block<wbr>.async<wbr>.future]</span></a>
</div>

<p>然而，闭包返回实现了一个或多个 <a href="../core/ops/function/trait.Fn.html"><code>std::ops::Fn</code></a> 特型 的类型，而 async 块返回的类型实现了 <a href="../core/future/future/trait.Future.html"><code>std::future::Future</code></a> 特型 。</p>
<div class="rule" id="r-expr.block.async.layout-unspecified"><a class="rule-link" href="#r-expr.block.async.layout-unspecified" title="expr.block.async.layout-unspecified"><span>[expr<wbr>.block<wbr>.async<wbr>.layout-unspecified]</span></a>
</div>

<p>该类型的实际数据格式未指定。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>rustc 生成的 future 类型大致相当于一个枚举，每个 <code>await</code> 点对应一个变体，每个变体存储从其对应点恢复所需的数据。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.block.async.edition2018"><a class="rule-link" href="#r-expr.block.async.edition2018" title="expr.block.async.edition2018"><span>[expr<wbr>.block<wbr>.async<wbr>.edition2018]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p>async 块仅从 Rust 2018 开始可用。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.block.async.capture"><a class="rule-link" href="#r-expr.block.async.capture" title="expr.block.async.capture"><span>[expr<wbr>.block<wbr>.async<wbr>.capture]</span></a>
</div>

<h3 id="捕获模式"><a class="header" href="#捕获模式">捕获模式</a></h3>
<p>async 块使用与闭包相同的 <a href="#capture-modes">捕获模式</a> 从其环境中捕获变量。
与闭包类似，当写成 <code>async { .. }</code> 时，每个变量的捕获模式将从块的内容中推导出来。
然而， <code>async move { .. }</code> 块会将所有引用的变量移动到生成的 future 中。</p>
<div class="rule" id="r-expr.block.async.context"><a class="rule-link" href="#r-expr.block.async.context" title="expr.block.async.context"><span>[expr<wbr>.block<wbr>.async<wbr>.context]</span></a>
</div>

<h3 id="async语境"><a class="header" href="#async语境">Async语境</a></h3>
<p>由于 async 块构造一个 future，它们定义了一个 <strong>async 语境</strong> ，而该语境又可以包含 <a href="#await表达式">await 表达式</a> 。
Async 语境由 async 块以及 async 函数体建立，后者的语义是根据 async 块定义的。</p>
<div class="rule" id="r-expr.block.async.function"><a class="rule-link" href="#r-expr.block.async.function" title="expr.block.async.function"><span>[expr<wbr>.block<wbr>.async<wbr>.function]</span></a>
</div>

<h3 id="控制流运算符"><a class="header" href="#控制流运算符">控制流运算符</a></h3>
<div class="rule" id="r-expr.block.async.function.intro"><a class="rule-link" href="#r-expr.block.async.function.intro" title="expr.block.async.function.intro"><span>[expr<wbr>.block<wbr>.async<wbr>.function<wbr>.intro]</span></a>
</div>

<p>async 块就像函数边界一样，非常类似于闭包。</p>
<div class="rule" id="r-expr.block.async.function.return-try"><a class="rule-link" href="#r-expr.block.async.function.return-try" title="expr.block.async.function.return-try"><span>[expr<wbr>.block<wbr>.async<wbr>.function<wbr>.return-try]</span></a>
</div>

<p>因此， <code>?</code> 运算符和 <code>return</code> 表达式都影响 future 的输出，而不是外层函数或其他语境。
也就是说，在 async 块内 <code>return &lt;expr&gt;</code> 将返回 <code>&lt;expr&gt;</code> 的结果作为 future 的输出。
同样地，如果 <code>&lt;expr&gt;?</code> 传播一个错误，该错误将作为 future 的结果传播。</p>
<div class="rule" id="r-expr.block.async.function.control-flow"><a class="rule-link" href="#r-expr.block.async.function.control-flow" title="expr.block.async.function.control-flow"><span>[expr<wbr>.block<wbr>.async<wbr>.function<wbr>.control-flow]</span></a>
</div>

<p>最后， <code>break</code> 和 <code>continue</code> 关键字不能用于从 async 块中跳出。
因此，以下代码是非法的：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>loop {
    async move {
        break; // error[E0267]: 在 `async` 块内部使用 `break`
    }
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.block.const"><a class="rule-link" href="#r-expr.block.const" title="expr.block.const"><span>[expr<wbr>.block<wbr>.const]</span></a>
</div>

<h2 id="const块"><a class="header" href="#const块"><code>const</code>块</a></h2>
<div class="rule" id="r-expr.block.const.syntax"><a class="rule-link" href="#r-expr.block.const.syntax" title="expr.block.const.syntax"><span>[expr<wbr>.block<wbr>.const<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ConstBlockExpression" onclick="show_railroad()"><a href="#railroad-ConstBlockExpression">ConstBlockExpression</a></span> → <span class="grammar-literal">const</span> <span class="grammar-text"><a href="#grammar-BlockExpression">BlockExpression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 280px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ConstBlockExpression"><svg class="railroad" viewbox="0 0 280 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ConstBlockExpression">
<text class="comment" x="88" y="25">
ConstBlockExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="35" y="42" />
<text x="65" y="58">
const</text>
</g>
<a class="link" xlink:href="#railroad-BlockExpression">
<g class="nonterminal">
<rect height="22" width="140" x="105" y="42" />
<text x="175" y="58">
BlockExpression</text>
</g>
</a>
<path d=" M 95 53 h 10" />
</g>
<path d=" M 255 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 245 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.block.const.intro"><a class="rule-link" href="#r-expr.block.const.intro" title="expr.block.const.intro"><span>[expr<wbr>.block<wbr>.const<wbr>.intro]</span></a>
</div>

<p>一个 <em>const 块</em> 是块表达式的一种变体，其主体在编译时而非运行时求值。</p>
<div class="rule" id="r-expr.block.const.context"><a class="rule-link" href="#r-expr.block.const.context" title="expr.block.const.context"><span>[expr<wbr>.block<wbr>.const<wbr>.context]</span></a>
</div>

<p>const 块允许你定义一个常量值，而无需定义新的 <a href="#常量项">常量项</a> ，因此它们有时也被称为 <em>内联 const</em> 。
它还支持类型推导，因此不需要指定类型，这与 <a href="#常量项">常量项</a> 不同。</p>
<div class="rule" id="r-expr.block.const.generic-params"><a class="rule-link" href="#r-expr.block.const.generic-params" title="expr.block.const.generic-params"><span>[expr<wbr>.block<wbr>.const<wbr>.generic-params]</span></a>
</div>

<p>const 块能够引用作用域内的泛型参数，这与 <a href="#自由项">自由</a> 常量项不同。
它们被脱糖为在作用域内带有泛型参数的常量项（类似于关联常量，但没有它们与之关联的 特型 或类型）。
例如，这段代码：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo&lt;T&gt;() -&gt; usize {
    const { std::mem::size_of::&lt;T&gt;() + 1 }
}
<span class="boring">}</span></code></pre>
<p>等价于：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo&lt;T&gt;() -&gt; usize {
    {
        struct Const&lt;T&gt;(T);
        impl&lt;T&gt; Const&lt;T&gt; {
            const CONST: usize = std::mem::size_of::&lt;T&gt;() + 1;
        }
        Const::&lt;T&gt;::CONST
    }
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.block.const.evaluation"><a class="rule-link" href="#r-expr.block.const.evaluation" title="expr.block.const.evaluation"><span>[expr<wbr>.block<wbr>.const<wbr>.evaluation]</span></a>
</div>

<p>如果 const 块表达式在运行时执行，则保证会对该常量求值，即使其返回值被忽略：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo&lt;T&gt;() -&gt; usize {
    // 如果这段代码被执行，那么断言肯定已经在编译时求值了。
    const { assert!(std::mem::size_of::&lt;T&gt;() &gt; 0); }
    // 在这里，我们可以编写依赖于类型为非零大小的 unsafe 代码。
    /* ... */
    42
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.block.const.not-executed"><a class="rule-link" href="#r-expr.block.const.not-executed" title="expr.block.const.not-executed"><span>[expr<wbr>.block<wbr>.const<wbr>.not-executed]</span></a>
</div>

<p>如果 const 块表达式不在运行时执行，它可能会也可能不会被求值：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>if false {
    // 程序构建时可能会也可能不会发生 恐慌 。
    const { panic!(); }
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.block.unsafe"><a class="rule-link" href="#r-expr.block.unsafe" title="expr.block.unsafe"><span>[expr<wbr>.block<wbr>.unsafe]</span></a>
</div>

<h2 id="unsafe块"><a class="header" href="#unsafe块"><code>unsafe</code>块</a></h2>
<div class="rule" id="r-expr.block.unsafe.syntax"><a class="rule-link" href="#r-expr.block.unsafe.syntax" title="expr.block.unsafe.syntax"><span>[expr<wbr>.block<wbr>.unsafe<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-UnsafeBlockExpression" onclick="show_railroad()"><a href="#railroad-UnsafeBlockExpression">UnsafeBlockExpression</a></span> → <span class="grammar-literal">unsafe</span> <span class="grammar-text"><a href="#grammar-BlockExpression">BlockExpression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 288px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-UnsafeBlockExpression"><svg class="railroad" viewbox="0 0 288 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-UnsafeBlockExpression">
<text class="comment" x="92" y="25">
UnsafeBlockExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="35" y="42" />
<text x="69" y="58">
unsafe</text>
</g>
<a class="link" xlink:href="#railroad-BlockExpression">
<g class="nonterminal">
<rect height="22" width="140" x="113" y="42" />
<text x="183" y="58">
BlockExpression</text>
</g>
</a>
<path d=" M 103 53 h 10" />
</g>
<path d=" M 263 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 253 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.block.unsafe.intro"><a class="rule-link" href="#r-expr.block.unsafe.intro" title="expr.block.unsafe.intro"><span>[expr<wbr>.block<wbr>.unsafe<wbr>.intro]</span></a>
</div>

<p>_ 有关何时使用 <code>unsafe</code> 的更多信息，请参阅 <a href="#unsafe-blocks-unsafe-">unsafe 块</a> _。</p>
<p>代码块可以加上 <code>unsafe</code> 关键字前缀，以允许 <a href="#不安全性">unsafe 操作</a> 。
示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>unsafe {
    let b = [13u8, 17u8];
    let a = &amp;b[0] as *const u8;
    assert_eq!(*a, 13);
    assert_eq!(*a.offset(1), 17);
}

<span class="boring">unsafe fn an_unsafe_fn() -&gt; i32 { 10 }
</span>let a = unsafe { an_unsafe_fn() };
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.block.label"><a class="rule-link" href="#r-expr.block.label" title="expr.block.label"><span>[expr<wbr>.block<wbr>.label]</span></a>
</div>

<h2 id="标签块表达式"><a class="header" href="#标签块表达式">标签块表达式</a></h2>
<p>标签块表达式在 <a href="#r-expr.loop.block-labels">循环和其他可中断表达式</a> 章节中有文档说明。</p>
<div class="rule" id="r-expr.block.attributes"><a class="rule-link" href="#r-expr.block.attributes" title="expr.block.attributes"><span>[expr<wbr>.block<wbr>.attributes]</span></a>
</div>

<h2 id="块表达式上的属性"><a class="header" href="#块表达式上的属性">块表达式上的属性</a></h2>
<div class="rule" id="r-expr.block.attributes.inner-attributes"><a class="rule-link" href="#r-expr.block.attributes.inner-attributes" title="expr.block.attributes.inner-attributes"><span>[expr<wbr>.block<wbr>.attributes<wbr>.inner-attributes]</span></a>
</div>

<p>在以下情况下，允许在块表达式的左大括号后直接使用 <a href="#属性-1">内部属性</a> ：</p>
<ul>
<li><a href="#函数">函数</a> 和 <a href="#方法">方法</a> 体。</li>
<li>循环体（ <a href="#infinite-loops"><code>loop</code></a> 、 <a href="#predicate-loops"><code>while</code></a> 和 <a href="#iterator-loops"><code>for</code></a> ）。</li>
<li>用作 <a href="#语句">语句</a> 的块表达式。</li>
<li>作为 <a href="#数组和数组索引表达式">数组表达式</a> 、 <a href="#元组和元组索引表达式">元组表达式</a> 、
<a href="#调用表达式">调用表达式</a> 和元组风格 <a href="#结构体表达式">结构体</a> 表达式元素的块表达式。</li>
<li>作为另一个块表达式的尾随表达式的块表达式。</li>
</ul>
<!-- Keep list in sync with expressions.md -->
<div class="rule" id="r-expr.block.attributes.valid"><a class="rule-link" href="#r-expr.block.attributes.valid" title="expr.block.attributes.valid"><span>[expr<wbr>.block<wbr>.attributes<wbr>.valid]</span></a>
</div>

<p>在块表达式上有意义的属性是 <a href="#条件编译"><code>cfg</code></a> 和 <a href="#lint-check-attributes">lint 检查属性</a> 。</p>
<p>例如，此函数在 unix 平台上返回 <code>true</code> ，在其他平台上返回 <code>false</code> 。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn is_unix_platform() -&gt; bool {
    #[cfg(unix)] { true }
    #[cfg(not(unix))] { false }
}
<span class="boring">}</span></code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr.operator"><a class="rule-link" href="#r-expr.operator" title="expr.operator"><span>[expr<wbr>.operator]</span></a>
</div>

<h1 id="运算符表达式"><a class="header" href="#运算符表达式">运算符表达式</a></h1>
<div class="rule" id="r-expr.operator.syntax"><a class="rule-link" href="#r-expr.operator.syntax" title="expr.operator.syntax"><span>[expr<wbr>.operator<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-OperatorExpression" onclick="show_railroad()"><a href="#railroad-OperatorExpression">OperatorExpression</a></span> → <br>      <span class="grammar-text"><a href="#grammar-BorrowExpression">BorrowExpression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-DereferenceExpression">DereferenceExpression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-TryPropagationExpression">TryPropagationExpression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-NegationExpression">NegationExpression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-ArithmeticOrLogicalExpression">ArithmeticOrLogicalExpression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-ComparisonExpression">ComparisonExpression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-LazyBooleanExpression">LazyBooleanExpression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-TypeCastExpression">TypeCastExpression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-AssignmentExpression">AssignmentExpression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-CompoundAssignmentExpression">CompoundAssignmentExpression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 378px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-OperatorExpression"><svg class="railroad" viewbox="0 0 378 371" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-OperatorExpression">
<text class="comment" x="78" y="25">
OperatorExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 148 0 h 136 m -65 0 l -5 -5 m 0 10 l 5 -5 m 65 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-BorrowExpression">
<g class="nonterminal">
<rect height="22" width="148" x="59" y="42" />
<text x="133" y="58">
BorrowExpression</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 284 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 284 0 v -33" />
<path d=" M 47 107 v 33 m 284 0 v -33" />
<path d=" M 47 140 v 33 m 284 0 v -33" />
<path d=" M 47 173 v 33 m 284 0 v -33" />
<path d=" M 47 206 v 33 m 284 0 v -33" />
<path d=" M 47 239 v 33 m 284 0 v -33" />
<path d=" M 47 272 v 33 m 284 0 v -33" />
<path d=" M 47 305 v 33 m 284 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 196 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-DereferenceExpression">
<g class="nonterminal">
<rect height="22" width="196" x="59" y="75" />
<text x="157" y="91">
DereferenceExpression</text>
</g>
</a>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 220 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-TryPropagationExpression">
<g class="nonterminal">
<rect height="22" width="220" x="59" y="108" />
<text x="169" y="124">
TryPropagationExpression</text>
</g>
</a>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 164 0 h 96 m -45 0 l -5 -5 m 0 10 l 5 -5 m 45 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-NegationExpression">
<g class="nonterminal">
<rect height="22" width="164" x="59" y="141" />
<text x="141" y="157">
NegationExpression</text>
</g>
</a>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 260 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ArithmeticOrLogicalExpression">
<g class="nonterminal">
<rect height="22" width="260" x="59" y="174" />
<text x="189" y="190">
ArithmeticOrLogicalExpression</text>
</g>
</a>
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 188 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ComparisonExpression">
<g class="nonterminal">
<rect height="22" width="188" x="59" y="207" />
<text x="153" y="223">
ComparisonExpression</text>
</g>
</a>
</g>
<path d=" M 47 239 v 0 a 12 12 0 0 0 12 12 m 196 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-LazyBooleanExpression">
<g class="nonterminal">
<rect height="22" width="196" x="59" y="240" />
<text x="157" y="256">
LazyBooleanExpression</text>
</g>
</a>
</g>
<path d=" M 47 272 v 0 a 12 12 0 0 0 12 12 m 164 0 h 96 m -45 0 l -5 -5 m 0 10 l 5 -5 m 45 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-TypeCastExpression">
<g class="nonterminal">
<rect height="22" width="164" x="59" y="273" />
<text x="141" y="289">
TypeCastExpression</text>
</g>
</a>
</g>
<path d=" M 47 305 v 0 a 12 12 0 0 0 12 12 m 188 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-AssignmentExpression">
<g class="nonterminal">
<rect height="22" width="188" x="59" y="306" />
<text x="153" y="322">
AssignmentExpression</text>
</g>
</a>
</g>
<path d=" M 47 338 v 0 a 12 12 0 0 0 12 12 m 252 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-CompoundAssignmentExpression">
<g class="nonterminal">
<rect height="22" width="252" x="59" y="339" />
<text x="185" y="355">
CompoundAssignmentExpression</text>
</g>
</a>
</g>
<path d=" M 353 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 343 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.operator.intro"><a class="rule-link" href="#r-expr.operator.intro" title="expr.operator.intro"><span>[expr<wbr>.operator<wbr>.intro]</span></a>
</div>

<p>Rust 语言为内置类型定义了运算符。</p>
<div class="rule" id="r-expr.operator.trait"><a class="rule-link" href="#r-expr.operator.trait" title="expr.operator.trait"><span>[expr<wbr>.operator<wbr>.trait]</span></a>
</div>

<p>下面许多运算符也可以使用 <code>std::ops</code> 或 <code>std::cmp</code> 中的 特型 来重载。</p>
<div class="rule" id="r-expr.operator.int-overflow"><a class="rule-link" href="#r-expr.operator.int-overflow" title="expr.operator.int-overflow"><span>[expr<wbr>.operator<wbr>.int-overflow]</span></a>
</div>

<h2 id="溢出"><a class="header" href="#溢出">溢出</a></h2>
<div class="rule" id="r-expr.operator.int-overflow.intro"><a class="rule-link" href="#r-expr.operator.int-overflow.intro" title="expr.operator.int-overflow.intro"><span>[expr<wbr>.operator<wbr>.int-overflow<wbr>.intro]</span></a>
</div>

<p>在调试模式下编译时，整数运算符在溢出时会产生 恐慌 。
可以使用 <code>-C debug-assertions</code> 和 <code>-C overflow-checks</code> 编译器标志来更直接地控制此行为。
以下情况被视为溢出：</p>
<div class="rule" id="r-expr.operator.int-overflow.binary-arith"><a class="rule-link" href="#r-expr.operator.int-overflow.binary-arith" title="expr.operator.int-overflow.binary-arith"><span>[expr<wbr>.operator<wbr>.int-overflow<wbr>.binary-arith]</span></a>
</div>

<ul>
<li>当 <code>+</code> 、 <code>*</code> 或二元 <code>-</code> 产生的值大于最大值，或小于可存储的最小值时。</li>
</ul>
<div class="rule" id="r-expr.operator.int-overflow.unary-neg"><a class="rule-link" href="#r-expr.operator.int-overflow.unary-neg" title="expr.operator.int-overflow.unary-neg"><span>[expr<wbr>.operator<wbr>.int-overflow<wbr>.unary-neg]</span></a>
</div>

<ul>
<li>对任何有符号整数类型的最小负值应用一元 <code>-</code> ，除非操作数是 <a href="#integer-literal-expressions">字面量表达式</a> （或单独存在于一个或多个 <a href="#分组表达式">分组表达式</a> 中的字面量表达式）。</li>
</ul>
<div class="rule" id="r-expr.operator.int-overflow.div"><a class="rule-link" href="#r-expr.operator.int-overflow.div" title="expr.operator.int-overflow.div"><span>[expr<wbr>.operator<wbr>.int-overflow<wbr>.div]</span></a>
</div>

<ul>
<li>使用 <code>/</code> 或 <code>%</code> ，其中左侧参数是有符号整数类型的最小整数，而右侧参数是 <code>-1</code> 。
由于历史原因，即使禁用了 <code>-C overflow-checks</code> ，也会进行这些检查。</li>
</ul>
<div class="rule" id="r-expr.operator.int-overflow.shift"><a class="rule-link" href="#r-expr.operator.int-overflow.shift" title="expr.operator.int-overflow.shift"><span>[expr<wbr>.operator<wbr>.int-overflow<wbr>.shift]</span></a>
</div>

<ul>
<li>使用 <code>&lt;&lt;</code> 或 <code>&gt;&gt;</code> ，其中右侧参数大于或等于左侧参数类型中的位数，或者是负数。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>一元 <code>-</code> 后的字面量表达式的例外情况意味着诸如 <code>-128_i8</code> 或 <code>let j: i8 = -(128)</code> 之类的形式永远不会导致 恐慌 ，并且具有预期的值 -128。</p>
<p>在这些情况下，字面量表达式已经具有其类型的最小负值（例如， <code>128_i8</code> 的值为 -128），因为整数字面量会根据 <a href="#integer-literal-expressions">整数字面量表达式</a> 中的描述被截断为其类型。</p>
<p>由于补码溢出约定，这些最小负值的取负操作保持原值不变。</p>
<p>在 <code>rustc</code> 中，这些最小负数表达式也会被 <code>overflowing_literals</code> lint 检查忽略。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.operator.borrow"><a class="rule-link" href="#r-expr.operator.borrow" title="expr.operator.borrow"><span>[expr<wbr>.operator<wbr>.borrow]</span></a>
</div>

<h2 id="借用运算符"><a class="header" href="#借用运算符">借用运算符</a></h2>
<div class="rule" id="r-expr.operator.borrow.syntax"><a class="rule-link" href="#r-expr.operator.borrow.syntax" title="expr.operator.borrow.syntax"><span>[expr<wbr>.operator<wbr>.borrow<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-BorrowExpression" onclick="show_railroad()"><a href="#railroad-BorrowExpression">BorrowExpression</a></span> → <br>      ( <span class="grammar-literal">&amp;</span> | <span class="grammar-literal">&amp;&amp;</span> ) <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | ( <span class="grammar-literal">&amp;</span> | <span class="grammar-literal">&amp;&amp;</span> ) <span class="grammar-literal">mut</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | ( <span class="grammar-literal">&amp;</span> | <span class="grammar-literal">&amp;&amp;</span> ) <span class="grammar-literal">raw</span> <span class="grammar-literal">const</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | ( <span class="grammar-literal">&amp;</span> | <span class="grammar-literal">&amp;&amp;</span> ) <span class="grammar-literal">raw</span> <span class="grammar-literal">mut</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 436px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-BorrowExpression"><svg class="railroad" viewbox="0 0 436 305" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-BorrowExpression">
<text class="comment" x="71" y="25">
BorrowExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 194 0 h 148 m -71 0 l -5 -5 m 0 10 l 5 -5 m 71 0" />
<g class="sequence">
<g class="choice">
<path d=" M 59 53 h 24 m 28 0 h 32" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="83" y="42" />
<text x="97" y="58">
&amp;</text>
</g>
<path d=" M 59 53 a 12 12 0 0 1 12 12 v 9 m 60 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 71 74 v 0 a 12 12 0 0 0 12 12 m 36 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="83" y="75" />
<text x="101" y="91">
&amp;&amp;</text>
</g>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="153" y="42" />
<text x="203" y="58">
Expression</text>
</g>
</a>
<path d=" M 143 53 h 10" />
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 42 m 342 0 v -42 a 12 12 0 0 1 12 -12" />
<path d=" M 47 107 v 66 m 0 -30 l -5 -5 m 10 0 l -5 5 m 0 30 m 342 0 v -66 m 0 36 l -5 5 m 10 0 l -5 -5 m 0 -36" />
<path d=" M 47 173 v 66 m 0 -30 l -5 -5 m 10 0 l -5 5 m 0 30 m 342 0 v -66 m 0 36 l -5 5 m 10 0 l -5 -5 m 0 -36" />
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 248 0 h 70 m -32 0 l -5 -5 m 0 10 l 5 -5 m 32 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="choice">
<path d=" M 59 119 h 24 m 28 0 h 32" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="83" y="108" />
<text x="97" y="124">
&amp;</text>
</g>
<path d=" M 59 119 a 12 12 0 0 1 12 12 v 9 m 60 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 71 140 v 0 a 12 12 0 0 0 12 12 m 36 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="83" y="141" />
<text x="101" y="157">
&amp;&amp;</text>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="153" y="108" />
<text x="175" y="124">
mut</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="207" y="108" />
<text x="257" y="124">
Expression</text>
</g>
</a>
<path d=" M 143 119 h 10" />
<path d=" M 197 119 h 10" />
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 318 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="choice">
<path d=" M 59 185 h 24 m 28 0 h 32" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="83" y="174" />
<text x="97" y="190">
&amp;</text>
</g>
<path d=" M 59 185 a 12 12 0 0 1 12 12 v 9 m 60 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 71 206 v 0 a 12 12 0 0 0 12 12 m 36 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="83" y="207" />
<text x="101" y="223">
&amp;&amp;</text>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="153" y="174" />
<text x="175" y="190">
raw</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="207" y="174" />
<text x="237" y="190">
const</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="277" y="174" />
<text x="327" y="190">
Expression</text>
</g>
</a>
<path d=" M 143 185 h 10" />
<path d=" M 197 185 h 10" />
<path d=" M 267 185 h 10" />
</g>
<path d=" M 47 239 v 0 a 12 12 0 0 0 12 12 m 302 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="choice">
<path d=" M 59 251 h 24 m 28 0 h 32" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="83" y="240" />
<text x="97" y="256">
&amp;</text>
</g>
<path d=" M 59 251 a 12 12 0 0 1 12 12 v 9 m 60 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 71 272 v 0 a 12 12 0 0 0 12 12 m 36 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="83" y="273" />
<text x="101" y="289">
&amp;&amp;</text>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="153" y="240" />
<text x="175" y="256">
raw</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="207" y="240" />
<text x="229" y="256">
mut</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="261" y="240" />
<text x="311" y="256">
Expression</text>
</g>
</a>
<path d=" M 143 251 h 10" />
<path d=" M 197 251 h 10" />
<path d=" M 251 251 h 10" />
</g>
</g>
<path d=" M 411 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 401 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.operator.borrow.intro"><a class="rule-link" href="#r-expr.operator.borrow.intro" title="expr.operator.borrow.intro"><span>[expr<wbr>.operator<wbr>.borrow<wbr>.intro]</span></a>
</div>

<p><code>&amp;</code> （共享借用）和 <code>&amp;mut</code> （可变借用）运算符是一元前缀运算符。</p>
<div class="rule" id="r-expr.operator.borrow.result"><a class="rule-link" href="#r-expr.operator.borrow.result" title="expr.operator.borrow.result"><span>[expr<wbr>.operator<wbr>.borrow<wbr>.result]</span></a>
</div>

<p>当应用于 <a href="#位置表达式和值表达式">位置表达式</a> 时，此表达式会产生一个指向该值所引用的位置的引用（指针）。</p>
<div class="rule" id="r-expr.operator.borrow.lifetime"><a class="rule-link" href="#r-expr.operator.borrow.lifetime" title="expr.operator.borrow.lifetime"><span>[expr<wbr>.operator<wbr>.borrow<wbr>.lifetime]</span></a>
</div>

<p>在引用的持续时间内，内存位置也处于借用状态。
对于共享借用（ <code>&amp;</code> ），这意味着该位置不可被修改，但可以被读取或再次共享。
对于可变借用（ <code>&amp;mut</code> ），在借用过期之前，不能以任何方式访问该位置。</p>
<div class="rule" id="r-expr.operator.borrow.mut"><a class="rule-link" href="#r-expr.operator.borrow.mut" title="expr.operator.borrow.mut"><span>[expr<wbr>.operator<wbr>.borrow<wbr>.mut]</span></a>
</div>

<p><code>&amp;mut</code> 在可变位置表达式语境中对其操作数求值。</p>
<div class="rule" id="r-expr.operator.borrow.temporary"><a class="rule-link" href="#r-expr.operator.borrow.temporary" title="expr.operator.borrow.temporary"><span>[expr<wbr>.operator<wbr>.borrow<wbr>.temporary]</span></a>
</div>

<p>如果 <code>&amp;</code> 或 <code>&amp;mut</code> 运算符应用于 <a href="#位置表达式和值表达式">值表达式</a> ，则会创建一个 <a href="#temporaries">临时值</a> 。</p>
<p>这些运算符不能被重载。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{
    // 创建一个值为 7 的临时变量，持续作用域为当前块。
    let shared_reference = &amp;7;
}
let mut array = [-2, 3, 9];
{
    // 在此作用域内可变地借用 `array`。
    // `array` 只能通过 `mutable_reference` 使用。
    let mutable_reference = &amp;mut array;
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.borrow.and-and-syntax"><a class="rule-link" href="#r-expr.borrow.and-and-syntax" title="expr.borrow.and-and-syntax"><span>[expr<wbr>.borrow<wbr>.and-and-syntax]</span></a>
</div>

<p>尽管 <code>&amp;&amp;</code> 是单个 词法单元 （ <a href="#lazy-boolean-operators">惰性 ‘与’ 运算符</a> ），但在借用表达式的语境中使用时，它的作用相当于两次借用：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 含义相同：
let a = &amp;&amp;  10;
let a = &amp; &amp; 10;

// 含义相同：
let a = &amp;&amp;&amp;&amp;  mut 10;
let a = &amp;&amp; &amp;&amp; mut 10;
let a = &amp; &amp; &amp; &amp; mut 10;
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.borrow.raw"><a class="rule-link" href="#r-expr.borrow.raw" title="expr.borrow.raw"><span>[expr<wbr>.borrow<wbr>.raw]</span></a>
</div>

<h3 id="原始借用运算符"><a class="header" href="#原始借用运算符">原始借用运算符</a></h3>
<div class="rule" id="r-expr.borrow.raw.intro"><a class="rule-link" href="#r-expr.borrow.raw.intro" title="expr.borrow.raw.intro"><span>[expr<wbr>.borrow<wbr>.raw<wbr>.intro]</span></a>
</div>

<p><code>&amp;raw const</code> 和 <code>&amp;raw mut</code> 是 <em>原始借用运算符</em> 。</p>
<div class="rule" id="r-expr.borrow.raw.place"><a class="rule-link" href="#r-expr.borrow.raw.place" title="expr.borrow.raw.place"><span>[expr<wbr>.borrow<wbr>.raw<wbr>.place]</span></a>
</div>

<p>这些运算符的操作数表达式在位置表达式语境中求值。</p>
<div class="rule" id="r-expr.borrow.raw.result"><a class="rule-link" href="#r-expr.borrow.raw.result" title="expr.borrow.raw.result"><span>[expr<wbr>.borrow<wbr>.raw<wbr>.result]</span></a>
</div>

<p><code>&amp;raw const expr</code> 随后会创建一个指向给定位置的 <code>*const T</code> 类型的常量原始指针，而 <code>&amp;raw mut expr</code> 会创建一个 <code>*mut T</code> 类型的可变原始指针。</p>
<div class="rule" id="r-expr.borrow.raw.invalid-ref"><a class="rule-link" href="#r-expr.borrow.raw.invalid-ref" title="expr.borrow.raw.invalid-ref"><span>[expr<wbr>.borrow<wbr>.raw<wbr>.invalid-ref]</span></a>
</div>

<p>每当位置表达式可能求得的位置未正确对齐，或者根据其类型未存储有效值，或者创建引用会引入不正确的别名假设时，必须使用原始借用运算符而不是借用运算符。
在这些情况下，使用借用运算符会因创建无效引用而导致 <a href="#被视为未定义的行为">未定义行为</a> ，但仍可以构造原始指针。</p>
<p>以下是通过 <code>packed</code> 结构体 创建指向未对齐位置的原始指针的示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[repr(packed)]
struct Packed {
    f1: u8,
    f2: u16,
}

let packed = Packed { f1: 1, f2: 2 };
// `&amp;packed.f2` 会创建一个未对齐的引用，因此会导致未定义行为！
let raw_f2 = &amp;raw const packed.f2;
assert_eq!(unsafe { raw_f2.read_unaligned() }, 2);
<span class="boring">}</span></code></pre>
<p>以下是创建指向不包含有效值的位置的原始指针的示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::mem::MaybeUninit;

struct Demo {
    field: bool,
}

let mut uninit = MaybeUninit::&lt;Demo&gt;::uninit();
// `&amp;uninit.as_mut().field` 会创建一个对未初始化 `bool` 的引用，
// 因此会导致未定义行为！
let f1_ptr = unsafe { &amp;raw mut (*uninit.as_mut_ptr()).field };
unsafe { f1_ptr.write(true); }
let init = unsafe { uninit.assume_init() };
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.deref"><a class="rule-link" href="#r-expr.deref" title="expr.deref"><span>[expr<wbr>.deref]</span></a>
</div>

<h2 id="解引用运算符"><a class="header" href="#解引用运算符">解引用运算符</a></h2>
<div class="rule" id="r-expr.deref.syntax"><a class="rule-link" href="#r-expr.deref.syntax" title="expr.deref.syntax"><span>[expr<wbr>.deref<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-DereferenceExpression" onclick="show_railroad()"><a href="#railroad-DereferenceExpression">DereferenceExpression</a></span> → <span class="grammar-literal">*</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 208px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-DereferenceExpression"><svg class="railroad" viewbox="0 0 208 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-DereferenceExpression">
<text class="comment" x="92" y="25">
DereferenceExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="42" />
<text x="49" y="58">
*</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="73" y="42" />
<text x="123" y="58">
Expression</text>
</g>
</a>
<path d=" M 63 53 h 10" />
</g>
<path d=" M 183 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 173 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.deref.intro"><a class="rule-link" href="#r-expr.deref.intro" title="expr.deref.intro"><span>[expr<wbr>.deref<wbr>.intro]</span></a>
</div>

<p><code>*</code> （解引用）运算符也是一元前缀运算符。</p>
<div class="rule" id="r-expr.deref.result"><a class="rule-link" href="#r-expr.deref.result" title="expr.deref.result"><span>[expr<wbr>.deref<wbr>.result]</span></a>
</div>

<p>当应用于 <a href="#指针类型">指针</a> 时，它表示指向的位置。</p>
<div class="rule" id="r-expr.deref.mut"><a class="rule-link" href="#r-expr.deref.mut" title="expr.deref.mut"><span>[expr<wbr>.deref<wbr>.mut]</span></a>
</div>

<p>如果表达式的类型是 <code>&amp;mut T</code> 或 <code>*mut T</code> ，并且是局部变量、局部变量的（嵌套）字段或可变 <a href="#位置表达式和值表达式">位置表达式</a> ，则可以对产生的内存位置进行赋值。</p>
<div class="rule" id="r-expr.deref.safety"><a class="rule-link" href="#r-expr.deref.safety" title="expr.deref.safety"><span>[expr<wbr>.deref<wbr>.safety]</span></a>
</div>

<p>对原始指针进行解引用需要 <code>unsafe</code> 。</p>
<div class="rule" id="r-expr.deref.traits"><a class="rule-link" href="#r-expr.deref.traits" title="expr.deref.traits"><span>[expr<wbr>.deref<wbr>.traits]</span></a>
</div>

<p>在 <a href="#mutability">不可变位置表达式语境</a> 中，对于非指针类型， <code>*x</code> 等价于 <code>*std::ops::Deref::deref(&amp;x)</code> ；在可变位置表达式语境中，等价于 <code>*std::ops::DerefMut::deref_mut(&amp;mut x)</code> 。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = &amp;7;
assert_eq!(*x, 7);
let y = &amp;mut 9;
*y = 11;
assert_eq!(*y, 11);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.try"><a class="rule-link" href="#r-expr.try" title="expr.try"><span>[expr<wbr>.try]</span></a>
</div>

<h2 id="try传播表达式"><a class="header" href="#try传播表达式">try传播表达式</a></h2>
<div class="rule" id="r-expr.try.syntax"><a class="rule-link" href="#r-expr.try.syntax" title="expr.try.syntax"><span>[expr<wbr>.try<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-TryPropagationExpression" onclick="show_railroad()"><a href="#railroad-TryPropagationExpression">TryPropagationExpression</a></span> → <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">?</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 208px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TryPropagationExpression"><svg class="railroad" viewbox="0 0 208 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TryPropagationExpression">
<text class="comment" x="102" y="25">
TryPropagationExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="42" />
<text x="85" y="58">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="145" y="42" />
<text x="159" y="58">
?</text>
</g>
<path d=" M 135 53 h 10" />
</g>
<path d=" M 183 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 173 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.try.intro"><a class="rule-link" href="#r-expr.try.intro" title="expr.try.intro"><span>[expr<wbr>.try<wbr>.intro]</span></a>
</div>

<p>try 传播表达式使用内部表达式的值和 <a href="../core/ops/try_trait/trait.Try.html"><code>Try</code></a> 特型 来决定是产生一个值（如果产生，产生什么值），还是向调用者返回一个值（如果返回，返回什么值）。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use std::num::ParseIntError;
</span>fn try_to_parse() -&gt; Result&lt;i32, ParseIntError&gt; {
    let x: i32 = "123".parse()?; // `x` 是 `123`。
    let y: i32 = "24a".parse()?; // 立即返回 `Err()`。
    Ok(x + y)                    // 不运行。
}

let res = try_to_parse();
println!("{res:?}");
<span class="boring">assert!(res.is_err())
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn try_option_some() -&gt; Option&lt;u8&gt; {
    let val = Some(1)?;
    Some(val)
}
assert_eq!(try_option_some(), Some(1));

fn try_option_none() -&gt; Option&lt;u8&gt; {
    let val = None?;
    Some(val)
}
assert_eq!(try_option_none(), None);
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024">use std::ops::ControlFlow;

pub struct TreeNode&lt;T&gt; {
    value: T,
    left: Option&lt;Box&lt;TreeNode&lt;T&gt;&gt;&gt;,
    right: Option&lt;Box&lt;TreeNode&lt;T&gt;&gt;&gt;,
}

impl&lt;T&gt; TreeNode&lt;T&gt; {
    pub fn traverse_inorder&lt;B&gt;(&amp;self, f: &amp;mut impl FnMut(&amp;T) -&gt; ControlFlow&lt;B&gt;) -&gt; ControlFlow&lt;B&gt; {
        if let Some(left) = &amp;self.left {
            left.traverse_inorder(f)?;
        }
        f(&amp;self.value)?;
        if let Some(right) = &amp;self.right {
            right.traverse_inorder(f)?;
        }
        ControlFlow::Continue(())
    }
}
<span class="boring">
</span><span class="boring">fn main() {
</span><span class="boring">    let n = TreeNode {
</span><span class="boring">        value: 1,
</span><span class="boring">        left: Some(Box::new(TreeNode{value: 2, left: None, right: None})),
</span><span class="boring">        right: None,
</span><span class="boring">    };
</span><span class="boring">    let v = n.traverse_inorder(&amp;mut |t| {
</span><span class="boring">        if *t == 2 {
</span><span class="boring">            ControlFlow::Break("found")
</span><span class="boring">        } else {
</span><span class="boring">            ControlFlow::Continue(())
</span><span class="boring">        }
</span><span class="boring">    });
</span><span class="boring">    assert_eq!(v, ControlFlow::Break("found"));
</span><span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><a href="../core/ops/try_trait/trait.Try.html"><code>Try</code></a> 特型 目前不稳定，因此不能为用户类型实现。</p>
<p>try 传播表达式目前大致等价于：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#![ feature(try_trait_v2) ]
</span><span class="boring">fn example() -&gt; Result&lt;(), ()&gt; {
</span><span class="boring">let expr = Ok(());
</span>match core::ops::Try::branch(expr) {
    core::ops::ControlFlow::Continue(val) =&gt; val,
    core::ops::ControlFlow::Break(residual) =&gt;
        return core::ops::FromResidual::from_residual(residual),
}
<span class="boring">Ok(())
</span><span class="boring">}
</span><span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>try 传播运算符有时被称为 <em>问号运算符</em> 、 <em><code>?</code> 运算符</em> 或 <em>try 运算符</em> 。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.try.restricted-types"><a class="rule-link" href="#r-expr.try.restricted-types" title="expr.try.restricted-types"><span>[expr<wbr>.try<wbr>.restricted-types]</span></a>
</div>

<p>try 传播运算符可以应用于具有以下类型的表达式：</p>
<ul>
<li><a href="../core/result/enum.Result.html"><code>Result&lt;T, E&gt;</code></a>
<ul>
<li><code>Result::Ok(val)</code> 求值为 <code>val</code> 。</li>
<li><code>Result::Err(e)</code> 返回 <code>Result::Err(From::from(e))</code> 。</li>
</ul>
</li>
<li><a href="../core/option/enum.Option.html"><code>Option&lt;T&gt;</code></a>
<ul>
<li><code>Option::Some(val)</code> 求值为 <code>val</code> 。</li>
<li><code>Option::None</code> 返回 <code>Option::None</code> 。</li>
</ul>
</li>
<li><a href="../core/ops/control_flow/enum.ControlFlow.html"><code>ControlFlow&lt;B, C&gt;</code></a>
<ul>
<li><code>ControlFlow::Continue(c)</code> 求值为 <code>c</code> 。</li>
<li><code>ControlFlow::Break(b)</code> 返回 <code>ControlFlow::Break(b)</code> 。</li>
</ul>
</li>
<li><a href="../core/task/poll/enum.Poll.html"><code>Poll&lt;Result&lt;T, E&gt;&gt;</code></a>
<ul>
<li><code>Poll::Ready(Ok(val))</code> 求值为 <code>Poll::Ready(val)</code> 。</li>
<li><code>Poll::Ready(Err(e))</code> 返回 <code>Poll::Ready(Err(From::from(e)))</code> 。</li>
<li><code>Poll::Pending</code> 求值为 <code>Poll::Pending</code> 。</li>
</ul>
</li>
<li><a href="../core/task/poll/enum.Poll.html"><code>Poll&lt;Option&lt;Result&lt;T, E&gt;&gt;&gt;</code></a>
<ul>
<li><code>Poll::Ready(Some(Ok(val)))</code> 求值为 <code>Poll::Ready(Some(val))</code> 。</li>
<li><code>Poll::Ready(Some(Err(e)))</code> 返回 <code>Poll::Ready(Some(Err(From::from(e))))</code> 。</li>
<li><code>Poll::Ready(None)</code> 求值为 <code>Poll::Ready(None)</code> 。</li>
<li><code>Poll::Pending</code> 求值为 <code>Poll::Pending</code> 。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-expr.negate"><a class="rule-link" href="#r-expr.negate" title="expr.negate"><span>[expr<wbr>.negate]</span></a>
</div>

<h2 id="求负运算符"><a class="header" href="#求负运算符">求负运算符</a></h2>
<div class="rule" id="r-expr.negate.syntax"><a class="rule-link" href="#r-expr.negate.syntax" title="expr.negate.syntax"><span>[expr<wbr>.negate<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-NegationExpression" onclick="show_railroad()"><a href="#railroad-NegationExpression">NegationExpression</a></span> → <br>      <span class="grammar-literal">-</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-literal">!</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 256px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-NegationExpression"><svg class="railroad" viewbox="0 0 256 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-NegationExpression">
<text class="comment" x="78" y="25">
NegationExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 138 0 h 24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="42" />
<text x="73" y="58">
-</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="97" y="42" />
<text x="147" y="58">
Expression</text>
</g>
</a>
<path d=" M 87 53 h 10" />
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 162 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 138 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="75" />
<text x="73" y="91">
!</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="97" y="75" />
<text x="147" y="91">
Expression</text>
</g>
</a>
<path d=" M 87 86 h 10" />
</g>
</g>
<path d=" M 231 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 221 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.negate.intro"><a class="rule-link" href="#r-expr.negate.intro" title="expr.negate.intro"><span>[expr<wbr>.negate<wbr>.intro]</span></a>
</div>

<p>这是最后两个一元运算符。</p>
<div class="rule" id="r-expr.negate.results"><a class="rule-link" href="#r-expr.negate.results" title="expr.negate.results"><span>[expr<wbr>.negate<wbr>.results]</span></a>
</div>

<p>下表总结了它们在原始类型上的行为，以及用于为其他类型重载这些运算符的 特型 。
请记住，有符号整数始终使用补码表示。
所有这些运算符的操作数都在 <a href="#位置表达式和值表达式">值表达式语境</a> 中求值，因此会被移动或复制。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>符号</th><th>整数</th><th><code>bool</code></th><th>浮点数</th><th>重载特型</th></tr>
</thead>
<tbody>
<tr><td><code>-</code></td><td>取负*</td><td></td><td>取负</td><td><code>std::ops::Neg</code></td></tr>
<tr><td><code>!</code></td><td>按位取反</td><td><a href="#logical-not">逻辑非</a></td><td></td><td><code>std::ops::Not</code></td></tr>
</tbody>
</table>
</div>
<p>* 仅适用于有符号整数类型。</p>
<p>以下是这些运算符的一些示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = 6;
assert_eq!(-x, -6);
assert_eq!(!x, -7);
assert_eq!(true, !false);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.arith-logic"><a class="rule-link" href="#r-expr.arith-logic" title="expr.arith-logic"><span>[expr<wbr>.arith-logic]</span></a>
</div>

<h2 id="算术和逻辑二元运算符"><a class="header" href="#算术和逻辑二元运算符">算术和逻辑二元运算符</a></h2>
<div class="rule" id="r-expr.arith-logic.syntax"><a class="rule-link" href="#r-expr.arith-logic.syntax" title="expr.arith-logic.syntax"><span>[expr<wbr>.arith-logic<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ArithmeticOrLogicalExpression" onclick="show_railroad()"><a href="#railroad-ArithmeticOrLogicalExpression">ArithmeticOrLogicalExpression</a></span> → <br>      <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">+</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">-</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">*</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">/</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">%</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">&amp;</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">|</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">^</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">&lt;&lt;</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">&gt;&gt;</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 374px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ArithmeticOrLogicalExpression"><svg class="railroad" viewbox="0 0 374 371" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ArithmeticOrLogicalExpression">
<text class="comment" x="120" y="25">
ArithmeticOrLogicalExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 248 0 h 32" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="42" />
<text x="109" y="58">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="42" />
<text x="183" y="58">
+</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="207" y="42" />
<text x="257" y="58">
Expression</text>
</g>
</a>
<path d=" M 159 53 h 10" />
<path d=" M 197 53 h 10" />
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 280 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 280 0 v -33" />
<path d=" M 47 107 v 33 m 280 0 v -33" />
<path d=" M 47 140 v 33 m 280 0 v -33" />
<path d=" M 47 173 v 33 m 280 0 v -33" />
<path d=" M 47 206 v 33 m 280 0 v -33" />
<path d=" M 47 239 v 33 m 280 0 v -33" />
<path d=" M 47 272 v 33 m 280 0 v -33" />
<path d=" M 47 305 v 33 m 280 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 248 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="75" />
<text x="109" y="91">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="75" />
<text x="183" y="91">
-</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="207" y="75" />
<text x="257" y="91">
Expression</text>
</g>
</a>
<path d=" M 159 86 h 10" />
<path d=" M 197 86 h 10" />
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 248 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="108" />
<text x="109" y="124">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="108" />
<text x="183" y="124">
*</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="207" y="108" />
<text x="257" y="124">
Expression</text>
</g>
</a>
<path d=" M 159 119 h 10" />
<path d=" M 197 119 h 10" />
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 248 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="141" />
<text x="109" y="157">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="141" />
<text x="183" y="157">
/</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="207" y="141" />
<text x="257" y="157">
Expression</text>
</g>
</a>
<path d=" M 159 152 h 10" />
<path d=" M 197 152 h 10" />
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 248 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="174" />
<text x="109" y="190">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="174" />
<text x="183" y="190">
%</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="207" y="174" />
<text x="257" y="190">
Expression</text>
</g>
</a>
<path d=" M 159 185 h 10" />
<path d=" M 197 185 h 10" />
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 248 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="207" />
<text x="109" y="223">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="207" />
<text x="183" y="223">
&amp;</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="207" y="207" />
<text x="257" y="223">
Expression</text>
</g>
</a>
<path d=" M 159 218 h 10" />
<path d=" M 197 218 h 10" />
</g>
<path d=" M 47 239 v 0 a 12 12 0 0 0 12 12 m 248 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="240" />
<text x="109" y="256">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="240" />
<text x="183" y="256">
|</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="207" y="240" />
<text x="257" y="256">
Expression</text>
</g>
</a>
<path d=" M 159 251 h 10" />
<path d=" M 197 251 h 10" />
</g>
<path d=" M 47 272 v 0 a 12 12 0 0 0 12 12 m 248 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="273" />
<text x="109" y="289">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="273" />
<text x="183" y="289">
^</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="207" y="273" />
<text x="257" y="289">
Expression</text>
</g>
</a>
<path d=" M 159 284 h 10" />
<path d=" M 197 284 h 10" />
</g>
<path d=" M 47 305 v 0 a 12 12 0 0 0 12 12 m 256 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="306" />
<text x="109" y="322">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="169" y="306" />
<text x="187" y="322">
&lt;&lt;</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="215" y="306" />
<text x="265" y="322">
Expression</text>
</g>
</a>
<path d=" M 159 317 h 10" />
<path d=" M 205 317 h 10" />
</g>
<path d=" M 47 338 v 0 a 12 12 0 0 0 12 12 m 256 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="339" />
<text x="109" y="355">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="169" y="339" />
<text x="187" y="355">
&gt;&gt;</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="215" y="339" />
<text x="265" y="355">
Expression</text>
</g>
</a>
<path d=" M 159 350 h 10" />
<path d=" M 205 350 h 10" />
</g>
</g>
<path d=" M 349 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 339 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.arith-logic.intro"><a class="rule-link" href="#r-expr.arith-logic.intro" title="expr.arith-logic.intro"><span>[expr<wbr>.arith-logic<wbr>.intro]</span></a>
</div>

<p>二元运算符表达式都使用中缀记法编写。</p>
<div class="rule" id="r-expr.arith-logic.behavior"><a class="rule-link" href="#r-expr.arith-logic.behavior" title="expr.arith-logic.behavior"><span>[expr<wbr>.arith-logic<wbr>.behavior]</span></a>
</div>

<p>下表总结了算术和逻辑二元运算符在原始类型上的行为，以及用于为其他类型重载这些运算符的 特型 。
请记住，有符号整数始终使用补码表示。
所有这些运算符的操作数都在 <a href="#位置表达式和值表达式">值表达式语境</a> 中求值，因此会被移动或复制。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>符号</th><th>整数</th><th><code>bool</code></th><th>浮点数</th><th>重载特型</th><th>重载复合赋值特型</th></tr>
</thead>
<tbody>
<tr><td><code>+</code></td><td>加法</td><td></td><td>加法</td><td><code>std::ops::Add</code></td><td><code>std::ops::AddAssign</code></td></tr>
<tr><td><code>-</code></td><td>减法</td><td></td><td>减法</td><td><code>std::ops::Sub</code></td><td><code>std::ops::SubAssign</code></td></tr>
<tr><td><code>*</code></td><td>乘法</td><td></td><td>乘法</td><td><code>std::ops::Mul</code></td><td><code>std::ops::MulAssign</code></td></tr>
<tr><td><code>/</code></td><td>除法*†</td><td></td><td>除法</td><td><code>std::ops::Div</code></td><td><code>std::ops::DivAssign</code></td></tr>
<tr><td><code>%</code></td><td>取余**†</td><td></td><td>取余</td><td><code>std::ops::Rem</code></td><td><code>std::ops::RemAssign</code></td></tr>
<tr><td><code>&amp;</code></td><td>按位与</td><td><a href="#logical-and">逻辑与</a></td><td></td><td><code>std::ops::BitAnd</code></td><td><code>std::ops::BitAndAssign</code></td></tr>
<tr><td>`</td><td>`</td><td>按位或</td><td><a href="#logical-or">逻辑或</a></td><td></td><td><code>std::ops::BitOr</code></td></tr>
<tr><td><code>^</code></td><td>按位异或</td><td><a href="#logical-xor">逻辑异或</a></td><td></td><td><code>std::ops::BitXor</code></td><td><code>std::ops::BitXorAssign</code></td></tr>
<tr><td><code>&lt;&lt;</code></td><td>左移</td><td></td><td></td><td><code>std::ops::Shl</code></td><td><code>std::ops::ShlAssign</code></td></tr>
<tr><td><code>&gt;&gt;</code></td><td>右移***</td><td></td><td></td><td><code>std::ops::Shr</code></td><td><code>std::ops::ShrAssign</code></td></tr>
</tbody>
</table>
</div>
<p>* 整数除法向零舍入。</p>
<p>** Rust 使用由 <a href="https://en.wikipedia.org/wiki/Modulo_operation#Variants_of_the_definition">截断除法</a> 定义的余数。给定 <code>remainder = dividend % divisor</code> ，余数将与被除数具有相同的符号。</p>
<p>*** 有符号整数类型为算术右移，无符号整数类型为逻辑右移。</p>
<p>† 对于整数类型，除以零会产生 恐慌 。</p>
<p>以下是正在使用的这些运算符的示例。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>assert_eq!(3 + 6, 9);
assert_eq!(5.5 - 1.25, 4.25);
assert_eq!(-5 * 14, -70);
assert_eq!(14 / 3, 4);
assert_eq!(100 % 7, 2);
assert_eq!(0b1010 &amp; 0b1100, 0b1000);
assert_eq!(0b1010 | 0b1100, 0b1110);
assert_eq!(0b1010 ^ 0b1100, 0b110);
assert_eq!(13 &lt;&lt; 3, 104);
assert_eq!(-10 &gt;&gt; 2, -3);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.cmp"><a class="rule-link" href="#r-expr.cmp" title="expr.cmp"><span>[expr<wbr>.cmp]</span></a>
</div>

<h2 id="比较运算符"><a class="header" href="#比较运算符">比较运算符</a></h2>
<div class="rule" id="r-expr.cmp.syntax"><a class="rule-link" href="#r-expr.cmp.syntax" title="expr.cmp.syntax"><span>[expr<wbr>.cmp<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ComparisonExpression" onclick="show_railroad()"><a href="#railroad-ComparisonExpression">ComparisonExpression</a></span> → <br>      <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">==</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">!=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">&gt;</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">&lt;</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">&gt;=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">&lt;=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 374px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ComparisonExpression"><svg class="railroad" viewbox="0 0 374 239" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ComparisonExpression">
<text class="comment" x="88" y="25">
ComparisonExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 256 0 h 24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="42" />
<text x="109" y="58">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="169" y="42" />
<text x="187" y="58">
==</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="215" y="42" />
<text x="265" y="58">
Expression</text>
</g>
</a>
<path d=" M 159 53 h 10" />
<path d=" M 205 53 h 10" />
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 280 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 280 0 v -33" />
<path d=" M 47 107 v 33 m 280 0 v -33" />
<path d=" M 47 140 v 33 m 280 0 v -33" />
<path d=" M 47 173 v 33 m 280 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 256 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="75" />
<text x="109" y="91">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="169" y="75" />
<text x="187" y="91">
!=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="215" y="75" />
<text x="265" y="91">
Expression</text>
</g>
</a>
<path d=" M 159 86 h 10" />
<path d=" M 205 86 h 10" />
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 248 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="108" />
<text x="109" y="124">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="108" />
<text x="183" y="124">
&gt;</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="207" y="108" />
<text x="257" y="124">
Expression</text>
</g>
</a>
<path d=" M 159 119 h 10" />
<path d=" M 197 119 h 10" />
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 248 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="141" />
<text x="109" y="157">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="141" />
<text x="183" y="157">
&lt;</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="207" y="141" />
<text x="257" y="157">
Expression</text>
</g>
</a>
<path d=" M 159 152 h 10" />
<path d=" M 197 152 h 10" />
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 256 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="174" />
<text x="109" y="190">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="169" y="174" />
<text x="187" y="190">
&gt;=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="215" y="174" />
<text x="265" y="190">
Expression</text>
</g>
</a>
<path d=" M 159 185 h 10" />
<path d=" M 205 185 h 10" />
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 256 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="207" />
<text x="109" y="223">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="169" y="207" />
<text x="187" y="223">
&lt;=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="215" y="207" />
<text x="265" y="223">
Expression</text>
</g>
</a>
<path d=" M 159 218 h 10" />
<path d=" M 205 218 h 10" />
</g>
</g>
<path d=" M 349 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 339 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.cmp.intro"><a class="rule-link" href="#r-expr.cmp.intro" title="expr.cmp.intro"><span>[expr<wbr>.cmp<wbr>.intro]</span></a>
</div>

<p>比较运算符也为原始类型和标准库中的许多类型定义。</p>
<div class="rule" id="r-expr.cmp.paren-chaining"><a class="rule-link" href="#r-expr.cmp.paren-chaining" title="expr.cmp.paren-chaining"><span>[expr<wbr>.cmp<wbr>.paren-chaining]</span></a>
</div>

<p>在链式调用比较运算符时需要括号。例如，表达式 <code>a == b == c</code> 是无效的，可以写成 <code>(a == b) == c</code> 。</p>
<div class="rule" id="r-expr.cmp.trait"><a class="rule-link" href="#r-expr.cmp.trait" title="expr.cmp.trait"><span>[expr<wbr>.cmp<wbr>.trait]</span></a>
</div>

<p>与算术和逻辑运算符不同，重载这些运算符的 特型 被更广泛地用于展示一个类型如何被比较，并且很可能被使用这些 特型 作为界限的函数假设为定义了实际的比较。
标准库中的许多函数和 声明宏 随后可以使用该假设（尽管不能以此来确保安全性）。</p>
<div class="rule" id="r-expr.cmp.place"><a class="rule-link" href="#r-expr.cmp.place" title="expr.cmp.place"><span>[expr<wbr>.cmp<wbr>.place]</span></a>
</div>

<p>与上面的算术和逻辑运算符不同，这些运算符隐式地对其操作数进行共享借用，并在 <a href="#位置表达式和值表达式">位置表达式语境</a> 中对它们求值：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">let a = 1;
</span><span class="boring">let b = 1;
</span>a == b;
// 等价于
::std::cmp::PartialEq::eq(&amp;a, &amp;b);
<span class="boring">}</span></code></pre>
<p>这意味着操作数不需要被移出。</p>
<div class="rule" id="r-expr.cmp.behavior"><a class="rule-link" href="#r-expr.cmp.behavior" title="expr.cmp.behavior"><span>[expr<wbr>.cmp<wbr>.behavior]</span></a>
</div>

<div class="table-wrapper">
<table>
<thead>
<tr><th>符号</th><th>含义</th><th>重载方法</th></tr>
</thead>
<tbody>
<tr><td><code>==</code></td><td>等于</td><td><code>std::cmp::PartialEq::eq</code></td></tr>
<tr><td><code>!=</code></td><td>不等于</td><td><code>std::cmp::PartialEq::ne</code></td></tr>
<tr><td><code>&gt;</code></td><td>大于</td><td><code>std::cmp::PartialOrd::gt</code></td></tr>
<tr><td><code>&lt;</code></td><td>小于</td><td><code>std::cmp::PartialOrd::lt</code></td></tr>
<tr><td><code>&gt;=</code></td><td>大于等于</td><td><code>std::cmp::PartialOrd::ge</code></td></tr>
<tr><td><code>&lt;=</code></td><td>小于等于</td><td><code>std::cmp::PartialOrd::le</code></td></tr>
</tbody>
</table>
</div>
<p>以下是正在使用的比较运算符示例。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>assert!(123 == 123);
assert!(23 != -12);
assert!(12.5 &gt; 12.2);
assert!([1, 2, 3] &lt; [1, 3, 4]);
assert!('A' &lt;= 'B');
assert!("World" &gt;= "Hello");
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.bool-logic"><a class="rule-link" href="#r-expr.bool-logic" title="expr.bool-logic"><span>[expr<wbr>.bool-logic]</span></a>
</div>

<h2 id="惰性布尔运算符"><a class="header" href="#惰性布尔运算符">惰性布尔运算符</a></h2>
<div class="rule" id="r-expr.bool-logic.syntax"><a class="rule-link" href="#r-expr.bool-logic.syntax" title="expr.bool-logic.syntax"><span>[expr<wbr>.bool-logic<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-LazyBooleanExpression" onclick="show_railroad()"><a href="#railroad-LazyBooleanExpression">LazyBooleanExpression</a></span> → <br>      <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">||</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">&amp;&amp;</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 374px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-LazyBooleanExpression"><svg class="railroad" viewbox="0 0 374 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-LazyBooleanExpression">
<text class="comment" x="92" y="25">
LazyBooleanExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 256 0 h 24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="42" />
<text x="109" y="58">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="169" y="42" />
<text x="187" y="58">
||</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="215" y="42" />
<text x="265" y="58">
Expression</text>
</g>
</a>
<path d=" M 159 53 h 10" />
<path d=" M 205 53 h 10" />
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 280 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 256 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="75" />
<text x="109" y="91">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="169" y="75" />
<text x="187" y="91">
&amp;&amp;</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="215" y="75" />
<text x="265" y="91">
Expression</text>
</g>
</a>
<path d=" M 159 86 h 10" />
<path d=" M 205 86 h 10" />
</g>
</g>
<path d=" M 349 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 339 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.bool-logic.intro"><a class="rule-link" href="#r-expr.bool-logic.intro" title="expr.bool-logic.intro"><span>[expr<wbr>.bool-logic<wbr>.intro]</span></a>
</div>

<p>运算符 <code>||</code> 和 <code>&amp;&amp;</code> 可以应用于布尔类型的操作数。
<code>||</code> 运算符表示逻辑‘或’， <code>&amp;&amp;</code> 运算符表示逻辑‘与’。</p>
<div class="rule" id="r-expr.bool-logic.conditional-evaluation"><a class="rule-link" href="#r-expr.bool-logic.conditional-evaluation" title="expr.bool-logic.conditional-evaluation"><span>[expr<wbr>.bool-logic<wbr>.conditional-evaluation]</span></a>
</div>

<p>它们与 <code>|</code> 和 <code>&amp;</code> 的不同之处在于，只有当左侧操作数尚未确定表达式结果时，才会对右侧操作数求值。
也就是说，只有当左侧操作数求值为 <code>false</code> 时， <code>||</code> 才会对其右侧操作数求值；而只有当左侧操作数求值为 <code>true</code> 时， <code>&amp;&amp;</code> 才会对其右侧操作数求值。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = false || true; // true
let y = false &amp;&amp; panic!(); // false, 不会对 `panic!()` 求值
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.as"><a class="rule-link" href="#r-expr.as" title="expr.as"><span>[expr<wbr>.as]</span></a>
</div>

<h2 id="类型转换表达式"><a class="header" href="#类型转换表达式">类型转换表达式</a></h2>
<div class="rule" id="r-expr.as.syntax"><a class="rule-link" href="#r-expr.as.syntax" title="expr.as.syntax"><span>[expr<wbr>.as<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-TypeCastExpression" onclick="show_railroad()"><a href="#railroad-TypeCastExpression">TypeCastExpression</a></span> → <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">as</span> <span class="grammar-text"><a href="#grammar-TypeNoBounds">TypeNoBounds</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 342px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TypeCastExpression"><svg class="railroad" viewbox="0 0 342 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TypeCastExpression">
<text class="comment" x="78" y="25">
TypeCastExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="42" />
<text x="85" y="58">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="145" y="42" />
<text x="163" y="58">
as</text>
</g>
<a class="link" xlink:href="#railroad-TypeNoBounds">
<g class="nonterminal">
<rect height="22" width="116" x="191" y="42" />
<text x="249" y="58">
TypeNoBounds</text>
</g>
</a>
<path d=" M 135 53 h 10" />
<path d=" M 181 53 h 10" />
</g>
<path d=" M 317 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 307 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.as.intro"><a class="rule-link" href="#r-expr.as.intro" title="expr.as.intro"><span>[expr<wbr>.as<wbr>.intro]</span></a>
</div>

<p>类型转换表达式由二元运算符 <code>as</code> 表示。</p>
<div class="rule" id="r-expr.as.result"><a class="rule-link" href="#r-expr.as.result" title="expr.as.result"><span>[expr<wbr>.as<wbr>.result]</span></a>
</div>

<p>执行 <code>as</code> 表达式会将左侧的值转换为右侧的类型。</p>
<p><code>as</code> 表达式的一个示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn sum(values: &amp;[f64]) -&gt; f64 { 0.0 }
</span><span class="boring">fn len(values: &amp;[f64]) -&gt; i32 { 0 }
</span>fn average(values: &amp;[f64]) -&gt; f64 {
    let sum: f64 = sum(values);
    let size: f64 = len(values) as f64;
    sum / size
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.as.coercions"><a class="rule-link" href="#r-expr.as.coercions" title="expr.as.coercions"><span>[expr<wbr>.as<wbr>.coercions]</span></a>
</div>

<p><code>as</code> 可用于显式执行 <a href="#隐式类型转换">类型强制转换</a> ，以及以下额外的转换。
任何既不符合强制转换规则也不符合表中条目的转换都是编译器错误。
这里 <code>*T</code> 表示 <code>*const T</code> 或 <code>*mut T</code> 。 <code>m</code> 代表引用类型中可选的 <code>mut</code> ，以及指针类型中的 <code>mut</code> 或 <code>const</code> 。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th><code>e</code> 的类型</th><th><code>U</code></th><th><code>e as U</code> 执行的转换</th></tr>
</thead>
<tbody>
<tr><td>整数或浮点数类型</td><td>整数或浮点数类型</td><td><a href="#r-expr.as.numeric">数值转换</a></td></tr>
<tr><td>枚举</td><td>整数类型</td><td><a href="#r-expr.as.enum">枚举转换</a></td></tr>
<tr><td><code>bool</code> 或 <code>char</code></td><td>整数类型</td><td><a href="#r-expr.as.bool-char-as-int">原始类型到整数转换</a></td></tr>
<tr><td><code>u8</code></td><td><code>char</code></td><td><a href="#r-expr.as.u8-as-char"><code>u8</code> 到 <code>char</code> 转换</a></td></tr>
<tr><td><code>*T</code></td><td><code>*V</code> <sup class="footnote-reference" id="fr-meta-compat-1"><a href="#footnote-meta-compat">1</a></sup></td><td><a href="#r-expr.as.pointer">指针到指针转换</a></td></tr>
<tr><td><code>*T</code> 当 <code>T: Sized</code></td><td>整数类型</td><td><a href="#r-expr.as.pointer-as-int">指针到地址转换</a></td></tr>
<tr><td>整数类型</td><td><code>*V</code> 当 <code>V: Sized</code></td><td><a href="#r-expr.as.int-as-pointer">地址到指针转换</a></td></tr>
<tr><td><code>&amp;m₁ [T; n]</code></td><td><code>*m₂ T</code> <sup class="footnote-reference" id="fr-lessmut-1"><a href="#footnote-lessmut">2</a></sup></td><td>数组到指针转换</td></tr>
<tr><td><code>*m₁ [T; n]</code></td><td><code>*m₂ T</code> <sup class="footnote-reference" id="fr-lessmut-2"><a href="#footnote-lessmut">2</a></sup></td><td>数组到指针转换</td></tr>
<tr><td><a href="#函数项类型">函数项</a></td><td><a href="#函数指针类型">函数指针</a></td><td>函数项到函数指针转换</td></tr>
<tr><td><a href="#函数项类型">函数项</a></td><td><code>*V</code> 当 <code>V: Sized</code></td><td>函数项到指针转换</td></tr>
<tr><td><a href="#函数项类型">函数项</a></td><td>整数</td><td>函数项到地址转换</td></tr>
<tr><td><a href="#函数指针类型">函数指针</a></td><td><code>*V</code> 当 <code>V: Sized</code></td><td>函数指针到指针转换</td></tr>
<tr><td><a href="#函数指针类型">函数指针</a></td><td>整数</td><td>函数指针到地址转换</td></tr>
<tr><td>闭包 <sup class="footnote-reference" id="fr-no-capture-1"><a href="#footnote-no-capture">3</a></sup></td><td>函数指针</td><td>闭包到函数指针转换</td></tr>
</tbody>
</table>
</div>
<h3 id="语义"><a class="header" href="#语义">语义</a></h3>
<div class="rule" id="r-expr.as.numeric"><a class="rule-link" href="#r-expr.as.numeric" title="expr.as.numeric"><span>[expr<wbr>.as<wbr>.numeric]</span></a>
</div>

<h4 id="数值转换"><a class="header" href="#数值转换">数值转换</a></h4>
<div class="rule" id="r-expr.as.numeric.int-same-size"><a class="rule-link" href="#r-expr.as.numeric.int-same-size" title="expr.as.numeric.int-same-size"><span>[expr<wbr>.as<wbr>.numeric<wbr>.int-same-size]</span></a>
</div>

<ul>
<li>
<p>在两个大小相同的整数之间转换（例如 i32 -&gt; u32）是无操作的（Rust 对固定整数的负值使用补码）</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>assert_eq!(42i8 as u8, 42u8);
assert_eq!(-1i8 as u8, 255u8);
assert_eq!(255u8 as i8, -1i8);
assert_eq!(-1i16 as u16, 65535u16);
<span class="boring">}</span></code></pre>
</li>
</ul>
<div class="rule" id="r-expr.as.numeric.int-truncation"><a class="rule-link" href="#r-expr.as.numeric.int-truncation" title="expr.as.numeric.int-truncation"><span>[expr<wbr>.as<wbr>.numeric<wbr>.int-truncation]</span></a>
</div>

<ul>
<li>
<p>从较大的整数转换为较小的整数（例如 u32 -&gt; u8）将发生截断</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>assert_eq!(42u16 as u8, 42u8);
assert_eq!(1234u16 as u8, 210u8);
assert_eq!(0xabcdu16 as u8, 0xcdu8);

assert_eq!(-42i16 as i8, -42i8);
assert_eq!(1234u16 as i8, -46i8);
assert_eq!(0xabcdi32 as i8, -51i8);
<span class="boring">}</span></code></pre>
</li>
</ul>
<div class="rule" id="r-expr.as.numeric.int-extension"><a class="rule-link" href="#r-expr.as.numeric.int-extension" title="expr.as.numeric.int-extension"><span>[expr<wbr>.as<wbr>.numeric<wbr>.int-extension]</span></a>
</div>

<ul>
<li>
<p>从较小的整数转换为较大的整数（例如 u8 -&gt; u32）将</p>
<ul>
<li>如果源是无符号的，则进行零扩展</li>
<li>如果源是有符号的，则进行符号扩展</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>assert_eq!(42i8 as i16, 42i16);
assert_eq!(-17i8 as i16, -17i16);
assert_eq!(0b1000_1010u8 as u16, 0b0000_0000_1000_1010u16, "零扩展");
assert_eq!(0b0000_1010i8 as i16, 0b0000_0000_0000_1010i16, "符号扩展 0");
assert_eq!(0b1000_1010u8 as i8 as i16, 0b1111_1111_1000_1010u16 as i16, "符号扩展 1");
<span class="boring">}</span></code></pre>
</li>
</ul>
<div class="rule" id="r-expr.as.numeric.float-as-int"><a class="rule-link" href="#r-expr.as.numeric.float-as-int" title="expr.as.numeric.float-as-int"><span>[expr<wbr>.as<wbr>.numeric<wbr>.float-as-int]</span></a>
</div>

<ul>
<li>
<p>从浮点数转换为整数将向零舍入</p>
<ul>
<li><code>NaN</code> 将返回 <code>0</code></li>
<li>大于最大整数值的值（包括 <code>INFINITY</code> ），将饱和为整数类型的最大值。</li>
<li>小于最小整数值的值（包括 <code>NEG_INFINITY</code> ），将饱和为整数类型的最小值。</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>assert_eq!(42.9f32 as i32, 42);
assert_eq!(-42.9f32 as i32, -42);
assert_eq!(42_000_000f32 as i32, 42_000_000);
assert_eq!(std::f32::NAN as i32, 0);
assert_eq!(1_000_000_000_000_000f32 as i32, 0x7fffffffi32);
assert_eq!(std::f32::NEG_INFINITY as i32, -0x80000000i32);
<span class="boring">}</span></code></pre>
</li>
</ul>
<div class="rule" id="r-expr.as.numeric.int-as-float"><a class="rule-link" href="#r-expr.as.numeric.int-as-float" title="expr.as.numeric.int-as-float"><span>[expr<wbr>.as<wbr>.numeric<wbr>.int-as-float]</span></a>
</div>

<ul>
<li>
<p>从整数转换为浮点数将产生最接近的浮点数 *</p>
<ul>
<li>如有必要，根据 <code>roundTiesToEven</code> 模式进行舍入 ***</li>
<li>溢出时，产生（与输入符号相同的）无穷大</li>
<li>注意：在当前的数值类型集中，溢出只能发生在 <code>u128 as f32</code> 且值大于或等于 <code>f32::MAX + (0.5 ULP)</code> 时</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>assert_eq!(1337i32 as f32, 1337f32);
assert_eq!(123_456_789i32 as f32, 123_456_790f32, "已舍入");
assert_eq!(0xffffffff_ffffffff_ffffffff_ffffffff_u128 as f32, std::f32::INFINITY);
<span class="boring">}</span></code></pre>
</li>
</ul>
<div class="rule" id="r-expr.as.numeric.float-widening"><a class="rule-link" href="#r-expr.as.numeric.float-widening" title="expr.as.numeric.float-widening"><span>[expr<wbr>.as<wbr>.numeric<wbr>.float-widening]</span></a>
</div>

<ul>
<li>
<p>从 f32 转换为 f64 是完美的且无损的</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>assert_eq!(1_234.5f32 as f64, 1_234.5f64);
assert_eq!(std::f32::INFINITY as f64, std::f64::INFINITY);
assert!((std::f32::NAN as f64).is_nan());
<span class="boring">}</span></code></pre>
</li>
</ul>
<div class="rule" id="r-expr.as.numeric.float-narrowing"><a class="rule-link" href="#r-expr.as.numeric.float-narrowing" title="expr.as.numeric.float-narrowing"><span>[expr<wbr>.as<wbr>.numeric<wbr>.float-narrowing]</span></a>
</div>

<ul>
<li>
<p>从 f64 转换为 f32 将产生最接近的 f32 **</p>
<ul>
<li>如有必要，根据 <code>roundTiesToEven</code> 模式进行舍入 ***</li>
<li>溢出时，产生（与输入符号相同的）无穷大</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>assert_eq!(1_234.5f64 as f32, 1_234.5f32);
assert_eq!(1_234_567_891.123f64 as f32, 1_234_567_890f32, "已舍入");
assert_eq!(std::f64::INFINITY as f32, std::f32::INFINITY);
assert!((std::f64::NAN as f32).is_nan());
<span class="boring">}</span></code></pre>
</li>
</ul>
<p>* 如果硬件不原生支持具有这种舍入模式和溢出行为的整数到浮点数转换，则这些转换可能会比预期的慢。</p>
<p>** 如果硬件不原生支持具有这种舍入模式和溢出行为的 f64 到 f32 转换，则这些转换可能会比预期的慢。</p>
<p>*** 按照 IEEE 754-2008 §4.3.1 的定义：选择最接近的浮点数，如果在两个浮点数中间，则优先选择最低有效位为偶数的那个。</p>
<div class="rule" id="r-expr.as.enum"><a class="rule-link" href="#r-expr.as.enum" title="expr.as.enum"><span>[expr<wbr>.as<wbr>.enum]</span></a>
</div>

<h4 id="枚举转换"><a class="header" href="#枚举转换">枚举转换</a></h4>
<div class="rule" id="r-expr.as.enum.discriminant"><a class="rule-link" href="#r-expr.as.enum.discriminant" title="expr.as.enum.discriminant"><span>[expr<wbr>.as<wbr>.enum<wbr>.discriminant]</span></a>
</div>

<p>将枚举转换为其判别值，然后根据需要使用数值转换。
转换仅限于以下几种枚举：</p>
<ul>
<li><a href="#unit-only-enum">仅单元项枚举</a></li>
<li><a href="#field-less-enum">无字段枚举</a> 且没有 <a href="#explicit-discriminants">显式判别值</a> ，或者只有单元项变体具有显式判别值</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum Enum { A, B, C }
assert_eq!(Enum::A as i32, 0);
assert_eq!(Enum::B as i32, 1);
assert_eq!(Enum::C as i32, 2);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.as.enum.no-drop"><a class="rule-link" href="#r-expr.as.enum.no-drop" title="expr.as.enum.no-drop"><span>[expr<wbr>.as<wbr>.enum<wbr>.no-drop]</span></a>
</div>

<p>如果枚举实现了 <a href="../core/ops/drop/trait.Drop.html"><code>Drop</code></a> ，则不允许进行转换。</p>
<div class="rule" id="r-expr.as.bool-char-as-int"><a class="rule-link" href="#r-expr.as.bool-char-as-int" title="expr.as.bool-char-as-int"><span>[expr<wbr>.as<wbr>.bool-char-as-int]</span></a>
</div>

<h4 id="原始类型到整数转换"><a class="header" href="#原始类型到整数转换">原始类型到整数转换</a></h4>
<ul>
<li><code>false</code> 转换为 <code>0</code> ， <code>true</code> 转换为 <code>1</code></li>
<li><code>char</code> 转换为码位的值，然后根据需要使用数值转换。</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>assert_eq!(false as i32, 0);
assert_eq!(true as i32, 1);
assert_eq!('A' as i32, 65);
assert_eq!('Ö' as i32, 214);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.as.u8-as-char"><a class="rule-link" href="#r-expr.as.u8-as-char" title="expr.as.u8-as-char"><span>[expr<wbr>.as<wbr>.u8-as-char]</span></a>
</div>

<h4 id="u8-到-char-转换"><a class="header" href="#u8-到-char-转换"><code>u8</code> 到 <code>char</code> 转换</a></h4>
<p>转换为具有相应码位的 <code>char</code> 。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>assert_eq!(65u8 as char, 'A');
assert_eq!(214u8 as char, 'Ö');
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.as.pointer-as-int"><a class="rule-link" href="#r-expr.as.pointer-as-int" title="expr.as.pointer-as-int"><span>[expr<wbr>.as<wbr>.pointer-as-int]</span></a>
</div>

<h4 id="指针到地址转换"><a class="header" href="#指针到地址转换">指针到地址转换</a></h4>
<p>从原始指针转换为整数会产生引用内存的机器地址。
如果整数类型小于指针类型，则地址可能会被截断；使用 <code>usize</code> 可以避免这种情况。</p>
<div class="rule" id="r-expr.as.int-as-pointer"><a class="rule-link" href="#r-expr.as.int-as-pointer" title="expr.as.int-as-pointer"><span>[expr<wbr>.as<wbr>.int-as-pointer]</span></a>
</div>

<h4 id="地址到指针转换"><a class="header" href="#地址到指针转换">地址到指针转换</a></h4>
<p>从整数转换为原始指针会将整数解释为内存地址，并产生一个引用该内存的指针。</p>
<div class="alert alert-warning">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>警告</p>

<p>这与仍处于开发阶段的 Rust 内存模型有关。
从此转换获得的指针即使在位上等于有效指针，也可能会受到额外的限制。
如果不遵循别名规则，对这种指针进行解引用可能会导致 <a href="#被视为未定义的行为">未定义行为</a> 。</p>
</blockquote>
</div>

<p>一个简单的健全地址算术示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut values: [i32; 2] = [1, 2];
let p1: *mut i32 = values.as_mut_ptr();
let first_address = p1 as usize;
let second_address = first_address + 4; // 4 == size_of::&lt;i32&gt;()
let p2 = second_address as *mut i32;
unsafe {
    *p2 += 1;
}
assert_eq!(values[1], 3);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.as.pointer"><a class="rule-link" href="#r-expr.as.pointer" title="expr.as.pointer"><span>[expr<wbr>.as<wbr>.pointer]</span></a>
</div>

<h4 id="指针到指针转换"><a class="header" href="#指针到指针转换">指针到指针转换</a></h4>
<div class="rule" id="r-expr.as.pointer.behavior"><a class="rule-link" href="#r-expr.as.pointer.behavior" title="expr.as.pointer.behavior"><span>[expr<wbr>.as<wbr>.pointer<wbr>.behavior]</span></a>
</div>

<p><code>*const T</code> / <code>*mut T</code> 可以转换为 <code>*const U</code> / <code>*mut U</code> ，具有以下行为：</p>
<div class="rule" id="r-expr.as.pointer.sized"><a class="rule-link" href="#r-expr.as.pointer.sized" title="expr.as.pointer.sized"><span>[expr<wbr>.as<wbr>.pointer<wbr>.sized]</span></a>
</div>

<ul>
<li>如果 <code>T</code> 和 <code>U</code> 都是有大小的，则指针保持不变并返回。</li>
</ul>
<div class="rule" id="r-expr.as.pointer.unsized"><a class="rule-link" href="#r-expr.as.pointer.unsized" title="expr.as.pointer.unsized"><span>[expr<wbr>.as<wbr>.pointer<wbr>.unsized]</span></a>
</div>

<ul>
<li>
<p>如果 <code>T</code> 和 <code>U</code> 都是无大小的，则指针也保持不变并返回。
特别地，元数据会被精确保留。</p>
<p>例如，从 <code>*const [T]</code> 到 <code>*const [U]</code> 的转换会保留元素的数量。
请注意，因此此类转换不一定保留指针引用对象的大小
（例如，将 <code>*const [u16]</code> 转换为 <code>*const [u8]</code> 将产生一个原始指针，它指向的对象大小是原来的一半）。
对于 <code>str</code> 和任何其无大小尾部是切片类型的复合类型（如 <code>struct Foo(i32, [u8])</code> 或 <code>(u64, Foo)</code> ），情况也是如此。</p>
</li>
</ul>
<div class="rule" id="r-expr.as.pointer.discard-metadata"><a class="rule-link" href="#r-expr.as.pointer.discard-metadata" title="expr.as.pointer.discard-metadata"><span>[expr<wbr>.as<wbr>.pointer<wbr>.discard-metadata]</span></a>
</div>

<ul>
<li>如果 <code>T</code> 是无大小的且 <code>U</code> 是有大小的，则转换会丢弃完成宽指针 <code>T</code> 的所有元数据，并产生一个由无大小指针的数据部分组成的细指针 <code>U</code> 。</li>
</ul>
<div class="rule" id="r-expr.assign"><a class="rule-link" href="#r-expr.assign" title="expr.assign"><span>[expr<wbr>.assign]</span></a>
</div>

<h2 id="赋值表达式"><a class="header" href="#赋值表达式">赋值表达式</a></h2>
<div class="rule" id="r-expr.assign.syntax"><a class="rule-link" href="#r-expr.assign.syntax" title="expr.assign.syntax"><span>[expr<wbr>.assign<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-AssignmentExpression" onclick="show_railroad()"><a href="#railroad-AssignmentExpression">AssignmentExpression</a></span> → <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 318px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-AssignmentExpression"><svg class="railroad" viewbox="0 0 318 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-AssignmentExpression">
<text class="comment" x="88" y="25">
AssignmentExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="42" />
<text x="85" y="58">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="145" y="42" />
<text x="159" y="58">
=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="183" y="42" />
<text x="233" y="58">
Expression</text>
</g>
</a>
<path d=" M 135 53 h 10" />
<path d=" M 173 53 h 10" />
</g>
<path d=" M 293 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 283 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.assign.intro"><a class="rule-link" href="#r-expr.assign.intro" title="expr.assign.intro"><span>[expr<wbr>.assign<wbr>.intro]</span></a>
</div>

<p>一个 <em>赋值表达式</em> 将一个值移动到一个指定的位置。</p>
<div class="rule" id="r-expr.assign.assignee"><a class="rule-link" href="#r-expr.assign.assignee" title="expr.assign.assignee"><span>[expr<wbr>.assign<wbr>.assignee]</span></a>
</div>

<p>赋值表达式由一个 <a href="#mutability">可变</a> <a href="#位置表达式和值表达式">赋值目标表达式</a> （即 <em>赋值目标操作数</em> ），后跟一个等号（ <code>=</code> ）和一个 <a href="#位置表达式和值表达式">值表达式</a> （即 <em>被赋值操作数</em> ）组成。</p>
<div class="rule" id="r-expr.assign.behavior-basic"><a class="rule-link" href="#r-expr.assign.behavior-basic" title="expr.assign.behavior-basic"><span>[expr<wbr>.assign<wbr>.behavior-basic]</span></a>
</div>

<p>在其最基本的形式中，赋值目标表达式是一个 <a href="#位置表达式和值表达式">位置表达式</a> ，我们首先讨论这种情况。</p>
<div class="rule" id="r-expr.assign.behavior-destructuring"><a class="rule-link" href="#r-expr.assign.behavior-destructuring" title="expr.assign.behavior-destructuring"><span>[expr<wbr>.assign<wbr>.behavior-destructuring]</span></a>
</div>

<p>解构赋值的更一般情况在下面讨论，但这种情况总是分解为对位置表达式的顺序赋值，这可以被视为更基本的情况。</p>
<div class="rule" id="r-expr.assign.basic"><a class="rule-link" href="#r-expr.assign.basic" title="expr.assign.basic"><span>[expr<wbr>.assign<wbr>.basic]</span></a>
</div>

<h3 id="基本赋值"><a class="header" href="#基本赋值">基本赋值</a></h3>
<div class="rule" id="r-expr.assign.evaluation-order"><a class="rule-link" href="#r-expr.assign.evaluation-order" title="expr.assign.evaluation-order"><span>[expr<wbr>.assign<wbr>.evaluation-order]</span></a>
</div>

<p>求值赋值表达式始于对其操作数求值。
首先对被赋值操作数求值，然后对赋值目标表达式求值。</p>
<div class="rule" id="r-expr.assign.destructuring-order"><a class="rule-link" href="#r-expr.assign.destructuring-order" title="expr.assign.destructuring-order"><span>[expr<wbr>.assign<wbr>.destructuring-order]</span></a>
</div>

<p>对于解构赋值，赋值目标表达式的子表达式按从左到右的顺序求值。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>这与其他表达式不同，因为右侧操作数在左侧操作数之前求值。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.assign.drop-target"><a class="rule-link" href="#r-expr.assign.drop-target" title="expr.assign.drop-target"><span>[expr<wbr>.assign<wbr>.drop-target]</span></a>
</div>

<p>然后它的效果是首先 <a href="#析构函数">释放</a> 赋值位置的值，除非该位置是未初始化的局部变量或局部变量的未初始化字段。</p>
<div class="rule" id="r-expr.assign.behavior"><a class="rule-link" href="#r-expr.assign.behavior" title="expr.assign.behavior"><span>[expr<wbr>.assign<wbr>.behavior]</span></a>
</div>

<p>接着，它要么将分配的值 <a href="#moved-and-copied-types">复制或移动</a> 到赋值位置。</p>
<div class="rule" id="r-expr.assign.result"><a class="rule-link" href="#r-expr.assign.result" title="expr.assign.result"><span>[expr<wbr>.assign<wbr>.result]</span></a>
</div>

<p>赋值表达式总是产生 <a href="#元组类型">单元值</a> 。</p>
<p>示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut x = 0;
let y = 0;
x = y;
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.assign.destructure"><a class="rule-link" href="#r-expr.assign.destructure" title="expr.assign.destructure"><span>[expr<wbr>.assign<wbr>.destructure]</span></a>
</div>

<h3 id="解构赋值"><a class="header" href="#解构赋值">解构赋值</a></h3>
<div class="rule" id="r-expr.assign.destructure.intro"><a class="rule-link" href="#r-expr.assign.destructure.intro" title="expr.assign.destructure.intro"><span>[expr<wbr>.assign<wbr>.destructure<wbr>.intro]</span></a>
</div>

<p>解构赋值是变量声明中解构模式匹配的对应物，允许对复杂值（如元组或结构体）进行赋值。
例如，我们可以交换两个可变变量：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let (mut a, mut b) = (0, 1);
// 使用解构赋值交换 `a` 和 `b`。
(b, a) = (a, b);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.assign.destructure.assignee"><a class="rule-link" href="#r-expr.assign.destructure.assignee" title="expr.assign.destructure.assignee"><span>[expr<wbr>.assign<wbr>.destructure<wbr>.assignee]</span></a>
</div>

<p>与使用 <code>let</code> 的解构声明相反，由于语法歧义，模式不能出现在赋值语句的左侧。
相反，对应于模式的一组表达式被指定为 <a href="#位置表达式和值表达式">赋值目标表达式</a> ，并允许出现在赋值语句的左侧。
赋值目标表达式随后被脱糖为模式匹配，后跟顺序赋值。</p>
<div class="rule" id="r-expr.assign.destructure.irrefutable"><a class="rule-link" href="#r-expr.assign.destructure.irrefutable" title="expr.assign.destructure.irrefutable"><span>[expr<wbr>.assign<wbr>.destructure<wbr>.irrefutable]</span></a>
</div>

<p>脱糖后的模式必须是不可驳回的：特别地，这意味着只有在编译时长度已知的切片模式，以及平凡切片 <code>[..]</code> ，才允许用于解构赋值。</p>
<p>脱糖方法非常直接，通过示例可以最好地说明。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct Struct { x: u32, y: u32 }
</span><span class="boring">let (mut a, mut b) = (0, 0);
</span>(a, b) = (3, 4);

[a, b] = [3, 4];

Struct { x: a, y: b } = Struct { x: 3, y: 4};

// 脱糖为：

{
    let (_a, _b) = (3, 4);
    a = _a;
    b = _b;
}

{
    let [_a, _b] = [3, 4];
    a = _a;
    b = _b;
}

{
    let Struct { x: _a, y: _b } = Struct { x: 3, y: 4};
    a = _a;
    b = _b;
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.assign.destructure.repeat-ident"><a class="rule-link" href="#r-expr.assign.destructure.repeat-ident" title="expr.assign.destructure.repeat-ident"><span>[expr<wbr>.assign<wbr>.destructure<wbr>.repeat-ident]</span></a>
</div>

<p>并不禁止在单个赋值目标表达式中多次使用标识符。</p>
<div class="rule" id="r-expr.assign.destructure.discard-value"><a class="rule-link" href="#r-expr.assign.destructure.discard-value" title="expr.assign.destructure.discard-value"><span>[expr<wbr>.assign<wbr>.destructure<wbr>.discard-value]</span></a>
</div>

<p><a href="#_表达式">下划线表达式</a> 和空 <a href="#范围表达式">范围表达式</a> 可用于忽略某些值，而不绑定它们。</p>
<div class="rule" id="r-expr.assign.destructure.default-binding"><a class="rule-link" href="#r-expr.assign.destructure.default-binding" title="expr.assign.destructure.default-binding"><span>[expr<wbr>.assign<wbr>.destructure<wbr>.default-binding]</span></a>
</div>

<p>请注意，默认绑定模式不适用于脱糖表达式。</p>
<div class="rule" id="r-expr.assign.destructure.tmp-scopes"><a class="rule-link" href="#r-expr.assign.destructure.tmp-scopes" title="expr.assign.destructure.tmp-scopes"><span>[expr<wbr>.assign<wbr>.destructure<wbr>.tmp-scopes]</span></a>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>脱糖限制了解构赋值中被赋值操作数（右侧）的 <a href="#r-destructors.scope.temporary">临时作用域</a> 。</p>
<p>在基本赋值中， <a href="#r-expr.temporary">临时变量</a> 在封闭的临时作用域结束时被释放。在下面，那就是语句。因此，赋值和使用是被允许的。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() {}
</span>fn f&lt;T&gt;(x: T) -&gt; T { x }
let x;
(x = f(&amp;temp()), x); // OK
<span class="boring">}</span></code></pre>
<p>相反，在解构赋值中，临时变量在脱糖后的 <code>let</code> 语句结束时被释放。由于这发生在尝试给 <code>x</code> 赋值之前，如下所示，它将失败。</p>
<pre class="playground"><code class="language-rust compile_fail E0716 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() {}
</span><span class="boring">fn f&lt;T&gt;(x: T) -&gt; T { x }
</span><span class="boring">let x;
</span>[x] = [f(&amp;temp())]; // 错误
<span class="boring">}</span></code></pre>
<p>这被脱糖为：</p>
<pre class="playground"><code class="language-rust compile_fail E0716 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() {}
</span><span class="boring">fn f&lt;T&gt;(x: T) -&gt; T { x }
</span><span class="boring">let x;
</span>{
    let [_x] = [f(&amp;temp())];
    //                     ^
    //      临时变量在这里被释放。
    x = _x; // 错误
}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-expr.assign.destructure.tmp-ext"><a class="rule-link" href="#r-expr.assign.destructure.tmp-ext" title="expr.assign.destructure.tmp-ext"><span>[expr<wbr>.assign<wbr>.destructure<wbr>.tmp-ext]</span></a>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>由于脱糖，解构赋值的被赋值操作数（右侧）是新引入块内的 <a href="#r-destructors.scope.lifetime-extension.exprs">扩展表达式</a> 。</p>
<p>在下面，因为 <a href="#r-destructors.scope.temporary">临时作用域</a> 被扩展到了此引入块的末尾，所以赋值是被允许的。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() {}
</span><span class="boring">let x;
</span>[x] = [&amp;temp()]; // OK
<span class="boring">}</span></code></pre>
<p>这被脱糖为：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() {}
</span><span class="boring">let x;
</span>{ let [_x] = [&amp;temp()]; x = _x; } // OK
<span class="boring">}</span></code></pre>
<p>然而，如果我们尝试使用 <code>x</code> ，即使在同一语句中，也会得到一个错误，因为 <a href="#r-expr.temporary">临时变量</a> 在此引入块的末尾被释放。</p>
<pre class="playground"><code class="language-rust compile_fail E0716 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() {}
</span><span class="boring">let x;
</span>([x] = [&amp;temp()], x); // 错误
<span class="boring">}</span></code></pre>
<p>这被脱糖为：</p>
<pre class="playground"><code class="language-rust compile_fail E0716 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() {}
</span><span class="boring">let x;
</span>(
    {
        let [_x] = [&amp;temp()];
        x = _x;
    }, // &lt;-- 临时变量在这里被释放。
    x, // 错误
);
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-expr.compound-assign"><a class="rule-link" href="#r-expr.compound-assign" title="expr.compound-assign"><span>[expr<wbr>.compound-assign]</span></a>
</div>

<h2 id="复合赋值表达式"><a class="header" href="#复合赋值表达式">复合赋值表达式</a></h2>
<div class="rule" id="r-expr.compound-assign.syntax"><a class="rule-link" href="#r-expr.compound-assign.syntax" title="expr.compound-assign.syntax"><span>[expr<wbr>.compound-assign<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-CompoundAssignmentExpression" onclick="show_railroad()"><a href="#railroad-CompoundAssignmentExpression">CompoundAssignmentExpression</a></span> → <br>      <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">+=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">-=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">*=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">/=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">%=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">&amp;=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">|=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">^=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">&lt;&lt;=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">&gt;&gt;=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 382px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-CompoundAssignmentExpression"><svg class="railroad" viewbox="0 0 382 371" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-CompoundAssignmentExpression">
<text class="comment" x="116" y="25">
CompoundAssignmentExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 256 0 h 32" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="42" />
<text x="109" y="58">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="169" y="42" />
<text x="187" y="58">
+=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="215" y="42" />
<text x="265" y="58">
Expression</text>
</g>
</a>
<path d=" M 159 53 h 10" />
<path d=" M 205 53 h 10" />
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 288 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 288 0 v -33" />
<path d=" M 47 107 v 33 m 288 0 v -33" />
<path d=" M 47 140 v 33 m 288 0 v -33" />
<path d=" M 47 173 v 33 m 288 0 v -33" />
<path d=" M 47 206 v 33 m 288 0 v -33" />
<path d=" M 47 239 v 33 m 288 0 v -33" />
<path d=" M 47 272 v 33 m 288 0 v -33" />
<path d=" M 47 305 v 33 m 288 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 256 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="75" />
<text x="109" y="91">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="169" y="75" />
<text x="187" y="91">
-=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="215" y="75" />
<text x="265" y="91">
Expression</text>
</g>
</a>
<path d=" M 159 86 h 10" />
<path d=" M 205 86 h 10" />
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 256 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="108" />
<text x="109" y="124">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="169" y="108" />
<text x="187" y="124">
*=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="215" y="108" />
<text x="265" y="124">
Expression</text>
</g>
</a>
<path d=" M 159 119 h 10" />
<path d=" M 205 119 h 10" />
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 256 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="141" />
<text x="109" y="157">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="169" y="141" />
<text x="187" y="157">
/=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="215" y="141" />
<text x="265" y="157">
Expression</text>
</g>
</a>
<path d=" M 159 152 h 10" />
<path d=" M 205 152 h 10" />
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 256 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="174" />
<text x="109" y="190">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="169" y="174" />
<text x="187" y="190">
%=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="215" y="174" />
<text x="265" y="190">
Expression</text>
</g>
</a>
<path d=" M 159 185 h 10" />
<path d=" M 205 185 h 10" />
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 256 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="207" />
<text x="109" y="223">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="169" y="207" />
<text x="187" y="223">
&amp;=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="215" y="207" />
<text x="265" y="223">
Expression</text>
</g>
</a>
<path d=" M 159 218 h 10" />
<path d=" M 205 218 h 10" />
</g>
<path d=" M 47 239 v 0 a 12 12 0 0 0 12 12 m 256 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="240" />
<text x="109" y="256">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="169" y="240" />
<text x="187" y="256">
|=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="215" y="240" />
<text x="265" y="256">
Expression</text>
</g>
</a>
<path d=" M 159 251 h 10" />
<path d=" M 205 251 h 10" />
</g>
<path d=" M 47 272 v 0 a 12 12 0 0 0 12 12 m 256 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="273" />
<text x="109" y="289">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="169" y="273" />
<text x="187" y="289">
^=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="215" y="273" />
<text x="265" y="289">
Expression</text>
</g>
</a>
<path d=" M 159 284 h 10" />
<path d=" M 205 284 h 10" />
</g>
<path d=" M 47 305 v 0 a 12 12 0 0 0 12 12 m 264 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="306" />
<text x="109" y="322">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="169" y="306" />
<text x="191" y="322">
&lt;&lt;=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="223" y="306" />
<text x="273" y="322">
Expression</text>
</g>
</a>
<path d=" M 159 317 h 10" />
<path d=" M 213 317 h 10" />
</g>
<path d=" M 47 338 v 0 a 12 12 0 0 0 12 12 m 264 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="339" />
<text x="109" y="355">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="169" y="339" />
<text x="191" y="355">
&gt;&gt;=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="223" y="339" />
<text x="273" y="355">
Expression</text>
</g>
</a>
<path d=" M 159 350 h 10" />
<path d=" M 213 350 h 10" />
</g>
</g>
<path d=" M 357 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 347 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.compound-assign.intro"><a class="rule-link" href="#r-expr.compound-assign.intro" title="expr.compound-assign.intro"><span>[expr<wbr>.compound-assign<wbr>.intro]</span></a>
</div>

<p><em>复合赋值表达式</em> 将算术和逻辑二元运算符与赋值表达式结合在一起。</p>
<p>例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut x = 5;
x += 1;
assert!(x == 6);
<span class="boring">}</span></code></pre>
<p>复合赋值的语法是一个 <a href="#mutability">可变</a> <a href="#位置表达式和值表达式">位置表达式</a> （即 <em>被赋值操作数</em> ），然后是一个由运算符后跟 <code>=</code> 组成的单个 词法单元 （无空格），最后是一个 <a href="#位置表达式和值表达式">值表达式</a> （即 <em>修改操作数</em> ）。</p>
<div class="rule" id="r-expr.compound-assign.place"><a class="rule-link" href="#r-expr.compound-assign.place" title="expr.compound-assign.place"><span>[expr<wbr>.compound-assign<wbr>.place]</span></a>
</div>

<p>与其他位置操作数不同，被赋值的操作数必须是一个位置表达式。</p>
<div class="rule" id="r-expr.compound-assign.no-value"><a class="rule-link" href="#r-expr.compound-assign.no-value" title="expr.compound-assign.no-value"><span>[expr<wbr>.compound-assign<wbr>.no-value]</span></a>
</div>

<p>尝试使用值表达式是编译器错误，而不是将其提升为临时变量。</p>
<div class="rule" id="r-expr.compound-assign.operand-order"><a class="rule-link" href="#r-expr.compound-assign.operand-order" title="expr.compound-assign.operand-order"><span>[expr<wbr>.compound-assign<wbr>.operand-order]</span></a>
</div>

<p>复合赋值表达式的求值得取决于操作数的类型。</p>
<div class="rule" id="r-expr.compound-assign.primitives"><a class="rule-link" href="#r-expr.compound-assign.primitives" title="expr.compound-assign.primitives"><span>[expr<wbr>.compound-assign<wbr>.primitives]</span></a>
</div>

<p>如果在单态化之前已知两个操作数的类型都是原始类型，则首先对右侧求值，接着对左侧求值，然后通过将运算符应用于两侧的值来修改由左侧求值得出的位置。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">use core::{num::Wrapping, ops::AddAssign};
</span><span class="boring">
</span>trait Equate {}
impl&lt;T&gt; Equate for (T, T) {}

fn f1(x: (u8,)) {
    let mut order = vec![];
    // 首先对右侧求值，因为两个操作数都是原始类型。
    { order.push(2); x }.0 += { order.push(1); x }.0;
    assert!(order.is_sorted());
}

fn f2(x: (Wrapping&lt;u8&gt;,)) {
    let mut order = vec![];
    // 首先对左侧求值，因为 `Wrapping&lt;_&gt;` 不是原始类型。
    { order.push(1); x }.0 += { order.push(2); (0u8,) }.0;
    assert!(order.is_sorted());
}

fn f3&lt;T: AddAssign&lt;u8&gt; + Copy&gt;(x: (T,)) where (T, u8): Equate {
    let mut order = vec![];
    // 首先对左侧求值，因为其中一个操作数是泛型参数，
    // 即使该泛型参数由于 where 子句界限可以与原始类型统一。
    { order.push(1); x }.0 += { order.push(2); (0u8,) }.0;
    assert!(order.is_sorted());
}

fn main() {
    f1((0u8,));
    f2((Wrapping(0u8),));
    // 我们提供一个原始类型作为泛型参数，但这不会影响单态化后 `f3` 中的求值顺序。
    f3::&lt;u8&gt;((0u8,));
}</code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>这是不寻常的。在其他地方，从左到右求值是常规。</p>
<p>更多示例请参阅 <a href="https://github.com/rust-lang/rust/blob/1.58.0/src/test/ui/expr/compound-assignment/eval-order.rs">求值顺序测试</a> 。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.compound-assign.trait"><a class="rule-link" href="#r-expr.compound-assign.trait" title="expr.compound-assign.trait"><span>[expr<wbr>.compound-assign<wbr>.trait]</span></a>
</div>

<p>否则，此表达式是使用该运算符对应的 特型 （见 <a href="#r-expr.arith-logic.behavior">expr.arith-logic.behavior</a> ）并以左侧作为 <a href="#r-expr.method.intro">接收者</a> 、右侧作为下一个参数调用其方法的语法糖。</p>
<p>例如，以下两个语句是等价的：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use std::ops::AddAssign;
</span>fn f&lt;T: AddAssign + Copy&gt;(mut x: T, y: T) {
    x += y; // 语句 1。
    x.add_assign(y); // 语句 2。
}
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>令人惊讶的是，将其进一步脱糖为完全限定的方法调用并不等价，因为当通过 <a href="#r-expr.method.candidate-receivers-refs">自动引用</a> 获取指向第一个操作数的可变引用时，存在特殊的借用检查器行为。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use std::ops::AddAssign;
</span>fn f&lt;T: AddAssign + Copy&gt;(mut x: T) {
    // 这里我们将 `x` 同时用作左侧和右侧。因为调用特型方法所需的
    // 左侧可变借用是通过自动引用隐式获取的，所以这是 OK 的。
    x += x; //~ OK
    x.add_assign(x); //~ OK
}
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0503 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use std::ops::AddAssign;
</span>fn f&lt;T: AddAssign + Copy&gt;(mut x: T) {
    // 我们不能将上面的代码脱糖为下面的形式，因为一旦我们为了传递第一个参数
    // 而获取了 `x` 的可变借用，我们就不能在第二个参数中按值传递 `x` ，
    // 因为可变引用仍然有效。
    &lt;T as AddAssign&gt;::add_assign(&amp;mut x, x);
    //~^ 错误：不能使用 `x` 因为它已被可变借用
}
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0503 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use std::ops::AddAssign;
</span>fn f&lt;T: AddAssign + Copy&gt;(mut x: T) {
    // 同上。
    (&amp;mut x).add_assign(x);
    //~^ 错误：不能使用 `x` 因为它已被可变借用
}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-expr.compound-assign.result"><a class="rule-link" href="#r-expr.compound-assign.result" title="expr.compound-assign.result"><span>[expr<wbr>.compound-assign<wbr>.result]</span></a>
</div>

<p>与普通赋值表达式一样，复合赋值表达式总是产生 <a href="#元组类型">单元值</a> 。</p>
<div class="alert alert-warning">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>警告</p>

<p>避免编写依赖于复合赋值中操作数求值顺序的代码，因为它可能是不寻常且令人惊讶的。</p>
</blockquote>
</div>

<hr>
<ol class="footnote-definition">
<li id="footnote-meta-compat">
<p>其中 <code>T</code> 和 <code>V</code> 具有兼容的元数据：</p>
<ul>
<li><code>V: Sized</code> ，或</li>
<li>都是切片元数据（ <code>*[u16]</code> -&gt; <code>*[u8]</code> ， <code>*str</code> -&gt; <code>*(u8, [u32])</code> ），或</li>
<li>都是相同的特型对象元数据，除了删除自动 特型 （ <code>*dyn Debug</code> -&gt; <code>*(u16, dyn Debug)</code> ， <code>*dyn Debug + Send</code> -&gt; <code>*dyn Debug</code> ）
<ul>
<li><strong>注意</strong>：只有当主 特型 将自动 特型 作为超级 特型 时，才允许 <em>增加</em> 自动 特型 （给定 <code>trait T: Send {}</code> ， <code>*dyn T</code> -&gt; <code>*dyn T + Send</code> 是有效的，但 <code>*dyn Debug</code> -&gt; <code>*dyn Debug + Send</code> 则无效）</li>
<li><strong>注意</strong>：泛型（包括生命周期）必须匹配（ <code>*dyn T&lt;'a, A&gt;</code> -&gt; <code>*dyn T&lt;'b, B&gt;</code> 要求 <code>'a = 'b</code> 且 <code>A = B</code> ）</li>
</ul>
</li>
</ul>
 <a href="#fr-meta-compat-1">↩</a></li>
<li id="footnote-lessmut">
<p>仅当 <code>m₁</code> 为 <code>mut</code> 或 <code>m₂</code> 为 <code>const</code> 时。允许将 <code>mut</code> 引用/指针转换为 <code>const</code> 指针。 <a href="#fr-lessmut-1">↩</a> <a href="#fr-lessmut-2">↩2</a></p>
</li>
<li id="footnote-no-capture">
<p>只有不捕获（封闭）任何局部变量的闭包才能转换为函数指针。 <a href="#fr-no-capture-1">↩</a></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr.paren"><a class="rule-link" href="#r-expr.paren" title="expr.paren"><span>[expr<wbr>.paren]</span></a>
</div>

<h1 id="分组表达式"><a class="header" href="#分组表达式">分组表达式</a></h1>
<div class="rule" id="r-expr.paren.syntax"><a class="rule-link" href="#r-expr.paren.syntax" title="expr.paren.syntax"><span>[expr<wbr>.paren<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-GroupedExpression" onclick="show_railroad()"><a href="#railroad-GroupedExpression">GroupedExpression</a></span> → <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">)</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 246px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-GroupedExpression"><svg class="railroad" viewbox="0 0 246 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-GroupedExpression">
<text class="comment" x="74" y="25">
GroupedExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="42" />
<text x="49" y="58">
(</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="73" y="42" />
<text x="123" y="58">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="183" y="42" />
<text x="197" y="58">
)</text>
</g>
<path d=" M 63 53 h 10" />
<path d=" M 173 53 h 10" />
</g>
<path d=" M 221 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 211 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.paren.intro"><a class="rule-link" href="#r-expr.paren.intro" title="expr.paren.intro"><span>[expr<wbr>.paren<wbr>.intro]</span></a>
</div>

<p>一个 <em>括号表达式</em> 包裹单个表达式，求值为该表达式。
括号表达式的 语法格式 是一个 <code>(</code>，然后是一个表达式，称为 <em>被包裹的操作数</em>，接着是一个 <code>)</code>。</p>
<div class="rule" id="r-expr.paren.evaluation"><a class="rule-link" href="#r-expr.paren.evaluation" title="expr.paren.evaluation"><span>[expr<wbr>.paren<wbr>.evaluation]</span></a>
</div>

<p>括号表达式求值为被包裹的操作数的值。</p>
<div class="rule" id="r-expr.paren.place-or-value"><a class="rule-link" href="#r-expr.paren.place-or-value" title="expr.paren.place-or-value"><span>[expr<wbr>.paren<wbr>.place-or-value]</span></a>
</div>

<p>与其他表达式不同，括号表达式既是 <a href="#位置表达式和值表达式">位置表达式和值表达式</a>。
当被包裹的操作数是一个位置表达式时，它就是一个位置表达式；当被包裹的操作数是一个值表达式时，它就是一个值表达式。</p>
<div class="rule" id="r-expr.paren.override-precedence"><a class="rule-link" href="#r-expr.paren.override-precedence" title="expr.paren.override-precedence"><span>[expr<wbr>.paren<wbr>.override-precedence]</span></a>
</div>

<p>括号可用于显式修改表达式中子表达式的优先级顺序。</p>
<p>一个括号表达式的例子：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x: i32 = 2 + 3 * 4; // 未加括号
let y: i32 = (2 + 3) * 4; // 已加括号
assert_eq!(x, 14);
assert_eq!(y, 20);
<span class="boring">}</span></code></pre>
<p>一个必须使用括号的例子是调用 结构体 成员中的函数指针：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct A {
</span><span class="boring">   f: fn() -&gt; &amp;'static str
</span><span class="boring">}
</span><span class="boring">impl A {
</span><span class="boring">   fn f(&amp;self) -&gt; &amp;'static str {
</span><span class="boring">       "The method f"
</span><span class="boring">   }
</span><span class="boring">}
</span><span class="boring">let a = A{f: || "The field f"};
</span><span class="boring">
</span>assert_eq!( a.f (), "The method f");
assert_eq!((a.f)(), "The field f");
<span class="boring">}</span></code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr.array"><a class="rule-link" href="#r-expr.array" title="expr.array"><span>[expr<wbr>.array]</span></a>
</div>

<h1 id="数组和数组索引表达式"><a class="header" href="#数组和数组索引表达式">数组和数组索引表达式</a></h1>
<h2 id="数组表达式"><a class="header" href="#数组表达式">数组表达式</a></h2>
<div class="rule" id="r-expr.array.syntax"><a class="rule-link" href="#r-expr.array.syntax" title="expr.array.syntax"><span>[expr<wbr>.array<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ArrayExpression" onclick="show_railroad()"><a href="#railroad-ArrayExpression">ArrayExpression</a></span> → <span class="grammar-literal">[</span> <span class="grammar-text"><a href="#grammar-ArrayElements">ArrayElements</a></span><sup>?</sup> <span class="grammar-literal">]</span></p>
<p><span class="grammar-text grammar-production" id="grammar-ArrayElements" onclick="show_railroad()"><a href="#railroad-ArrayElements">ArrayElements</a></span> → <br>      <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">;</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 318px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ArrayExpression"><svg class="railroad" viewbox="0 0 318 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ArrayExpression">
<text class="comment" x="67" y="25">
ArrayExpression</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="55" />
<text x="49" y="71">
[</text>
</g>
<g class="optional">
<path d=" M 73 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 124 m -59 0 l -5 -5 m 0 10 l 5 -5 m 59 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-ArrayElements">
<g class="nonterminal">
<rect height="22" width="124" x="97" y="55" />
<text x="159" y="71">
ArrayElements</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="255" y="55" />
<text x="269" y="71">
]</text>
</g>
<path d=" M 63 66 h 10" />
<path d=" M 245 66 h 10" />
</g>
<path d=" M 293 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 283 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 524px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ArrayElements"><svg class="railroad" viewbox="0 0 524 133" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ArrayElements">
<text class="comment" x="60" y="25">
ArrayElements</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 66 h 24 m 406 0 h 24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="55" />
<text x="109" y="71">
Expression</text>
</g>
</a>
<g class="optional">
<path d=" M 169 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 162 m -78 0 l -5 -5 m 0 10 l 5 -5 m 78 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 193 66 h 12 m 138 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -138 m 72 0 l 5 -5 m 0 10 l -5 -5 m -72 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="205" y="55" />
<text x="219" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="243" y="55" />
<text x="293" y="71">
Expression</text>
</g>
</a>
<path d=" M 233 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 389 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="413" y="55" />
<text x="427" y="71">
,</text>
</g>
</g>
<path d=" M 159 66 h 10" />
<path d=" M 379 66 h 10" />
</g>
<path d=" M 35 66 a 12 12 0 0 1 12 12 v 22 m 430 0 v -22 a 12 12 0 0 1 12 -12" />
<path d=" M 47 100 v 0 a 12 12 0 0 0 12 12 m 248 0 h 158 m -76 0 l -5 -5 m 0 10 l 5 -5 m 76 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="101" />
<text x="109" y="117">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="169" y="101" />
<text x="183" y="117">
;</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="207" y="101" />
<text x="257" y="117">
Expression</text>
</g>
</a>
<path d=" M 159 112 h 10" />
<path d=" M 197 112 h 10" />
</g>
</g>
<path d=" M 499 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 489 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.array.constructor"><a class="rule-link" href="#r-expr.array.constructor" title="expr.array.constructor"><span>[expr<wbr>.array<wbr>.constructor]</span></a>
</div>

<p><em>数组表达式</em> 构造 <a href="#数组类型">数组</a>。
数组表达式有两种形式。</p>
<div class="rule" id="r-expr.array.array"><a class="rule-link" href="#r-expr.array.array" title="expr.array.array"><span>[expr<wbr>.array<wbr>.array]</span></a>
</div>

<p>第一种形式列出数组中的每一个值。</p>
<div class="rule" id="r-expr.array.array-syntax"><a class="rule-link" href="#r-expr.array.array-syntax" title="expr.array.array-syntax"><span>[expr<wbr>.array<wbr>.array-syntax]</span></a>
</div>

<p>这种形式的 语法格式 是在方括号中包含一个由逗号分隔的具有统一类型的表达式列表。</p>
<div class="rule" id="r-expr.array.array-behavior"><a class="rule-link" href="#r-expr.array.array-behavior" title="expr.array.array-behavior"><span>[expr<wbr>.array<wbr>.array-behavior]</span></a>
</div>

<p>这会产生一个数组，按编写顺序包含这些值。</p>
<div class="rule" id="r-expr.array.repeat"><a class="rule-link" href="#r-expr.array.repeat" title="expr.array.repeat"><span>[expr<wbr>.array<wbr>.repeat]</span></a>
</div>

<p>第二种形式的 语法格式 是在方括号中包含两个由分号 (<code>;</code>) 分隔的表达式。</p>
<div class="rule" id="r-expr.array.repeat-operand"><a class="rule-link" href="#r-expr.array.repeat-operand" title="expr.array.repeat-operand"><span>[expr<wbr>.array<wbr>.repeat-operand]</span></a>
</div>

<p><code>;</code> 之前的表达式称为 <em>重复操作数</em>。</p>
<div class="rule" id="r-expr.array.length-operand"><a class="rule-link" href="#r-expr.array.length-operand" title="expr.array.length-operand"><span>[expr<wbr>.array<wbr>.length-operand]</span></a>
</div>

<p><code>;</code> 之后的表达式称为 <em>长度操作数</em>。</p>
<div class="rule" id="r-expr.array.length-restriction"><a class="rule-link" href="#r-expr.array.length-restriction" title="expr.array.length-restriction"><span>[expr<wbr>.array<wbr>.length-restriction]</span></a>
</div>

<p>长度操作数必须是一个 <a href="#r-items.generics.const.inferred">推断常量</a> 或者是一个 <code>usize</code> 类型的 <a href="#常量表达式">常量表达式</a>（例如 <a href="#字面量">字面量</a> 或 <a href="#常量项">常量 项</a>）。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>const C: usize = 1;
let _: [u8; C] = [0; 1]; // 字面量。
let _: [u8; C] = [0; C]; // 常量 项。
let _: [u8; C] = [0; _]; // 推断常量。
let _: [u8; C] = [0; (((_)))]; // 推断常量。
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>在数组表达式中，一个 <a href="#r-items.generics.const.inferred">推断常量</a> 被解析为一个 <a href="#grammar-Expression">表达式</a>，但在语义上被视为一种单独的 <a href="#r-items.generics.const.argument">常量 泛型 参数</a>。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.array.repeat-behavior"><a class="rule-link" href="#r-expr.array.repeat-behavior" title="expr.array.repeat-behavior"><span>[expr<wbr>.array<wbr>.repeat-behavior]</span></a>
</div>

<p>这种形式的数组表达式创建一个长度为长度操作数值的数组，其中每个元素都是重复操作数的副本。
也就是说，<code>[a; b]</code> 创建一个包含 <code>b</code> 个 <code>a</code> 的值的副本的数组。</p>
<div class="rule" id="r-expr.array.repeat-copy"><a class="rule-link" href="#r-expr.array.repeat-copy" title="expr.array.repeat-copy"><span>[expr<wbr>.array<wbr>.repeat-copy]</span></a>
</div>

<p>如果长度操作数的值大于 1，则要求重复操作数的类型实现 <a href="#copy"><code>Copy</code></a>、或者是一个 <a href="#r-expr.block.const">常量块表达式</a>、或者是一个指向常量 项 的 <a href="#路径表达式">路径</a>。</p>
<div class="rule" id="r-expr.array.repeat-const-item"><a class="rule-link" href="#r-expr.array.repeat-const-item" title="expr.array.repeat-const-item"><span>[expr<wbr>.array<wbr>.repeat-const-item]</span></a>
</div>

<p>当重复操作数是一个常量块或指向常量 项 的路径时，它将被评估长度操作数指定的次数。</p>
<div class="rule" id="r-expr.array.repeat-evaluation-zero"><a class="rule-link" href="#r-expr.array.repeat-evaluation-zero" title="expr.array.repeat-evaluation-zero"><span>[expr<wbr>.array<wbr>.repeat-evaluation-zero]</span></a>
</div>

<p>如果该值为 <code>0</code>，则常量块或常量 项 根本不会被评估。</p>
<div class="rule" id="r-expr.array.repeat-non-const"><a class="rule-link" href="#r-expr.array.repeat-non-const" title="expr.array.repeat-non-const"><span>[expr<wbr>.array<wbr>.repeat-non-const]</span></a>
</div>

<p>对于既不是常量块也不是指向常量 项 的路径的表达式，它仅被评估一次，然后结果被复制长度操作数的值次。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>[1, 2, 3, 4];
["a", "b", "c", "d"];
[0; 128];              // 包含 128 个零的数组
[0u8, 0u8, 0u8, 0u8,];
[[1, 0, 0], [0, 1, 0], [0, 0, 1]]; // 二维数组
const EMPTY: Vec&lt;i32&gt; = Vec::new();
[EMPTY; 2];
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.array.index"><a class="rule-link" href="#r-expr.array.index" title="expr.array.index"><span>[expr<wbr>.array<wbr>.index]</span></a>
</div>

<h2 id="数组和切片索引表达式"><a class="header" href="#数组和切片索引表达式">数组和切片索引表达式</a></h2>
<div class="rule" id="r-expr.array.index.syntax"><a class="rule-link" href="#r-expr.array.index.syntax" title="expr.array.index.syntax"><span>[expr<wbr>.array<wbr>.index<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-IndexExpression" onclick="show_railroad()"><a href="#railroad-IndexExpression">IndexExpression</a></span> → <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">[</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">]</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 356px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-IndexExpression"><svg class="railroad" viewbox="0 0 356 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-IndexExpression">
<text class="comment" x="67" y="25">
IndexExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="42" />
<text x="85" y="58">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="145" y="42" />
<text x="159" y="58">
[</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="183" y="42" />
<text x="233" y="58">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="293" y="42" />
<text x="307" y="58">
]</text>
</g>
<path d=" M 135 53 h 10" />
<path d=" M 173 53 h 10" />
<path d=" M 283 53 h 10" />
</g>
<path d=" M 331 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 321 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.array.index.array"><a class="rule-link" href="#r-expr.array.index.array" title="expr.array.index.array"><span>[expr<wbr>.array<wbr>.index<wbr>.array]</span></a>
</div>

<p><a href="#数组类型">数组</a> 和 <a href="#切片类型">切片</a> 类型的值可以通过在它们后面编写一个由方括号括起来的 <code>usize</code> 类型表达式（索引）来进行索引。
当数组是可变的时，生成的 <a href="#位置表达式和值表达式">内存位置</a> 可以被赋值。</p>
<div class="rule" id="r-expr.array.index.trait"><a class="rule-link" href="#r-expr.array.index.trait" title="expr.array.index.trait"><span>[expr<wbr>.array<wbr>.index<wbr>.trait]</span></a>
</div>

<p>对于其他类型，索引表达式 <code>a[b]</code> 等同于 <code>*std::ops::Index::index(&amp;a, b)</code>，或者在可变位置表达式上下文中等同于 <code>*std::ops::IndexMut::index_mut(&amp;mut a, b)</code>。
与方法一样，Rust 也会在 <code>a</code> 上重复插入解引用操作以寻找实现。</p>
<div class="rule" id="r-expr.array.index.zero-index"><a class="rule-link" href="#r-expr.array.index.zero-index" title="expr.array.index.zero-index"><span>[expr<wbr>.array<wbr>.index<wbr>.zero-index]</span></a>
</div>

<p>数组和切片的索引是从零开始的。</p>
<div class="rule" id="r-expr.array.index.const"><a class="rule-link" href="#r-expr.array.index.const" title="expr.array.index.const"><span>[expr<wbr>.array<wbr>.index<wbr>.const]</span></a>
</div>

<p>数组访问是一个 <a href="#常量表达式">常量表达式</a>，因此可以使用常量索引值在编译时检查边界。
否则将在运行时执行检查，如果失败，将使线程处于 <a href="#恐慌"> <em>恐慌</em> 状态</a>。</p>
<pre class="playground"><code class="language-rust should_panic edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// lint 默认是 deny。
#![warn(unconditional_panic)]

([1, 2, 3, 4])[2];        // 求值为 3

let b = [[1, 0, 0], [0, 1, 0], [0, 0, 1]];
b[1][2];                  // 多维数组索引

let x = (["a", "b"])[10]; // 警告：索引越界

let n = 10;
let y = (["a", "b"])[n];  // 恐慌

let arr = ["a", "b"];
arr[10];                  // 警告：索引越界
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.array.index.trait-impl"><a class="rule-link" href="#r-expr.array.index.trait-impl" title="expr.array.index.trait-impl"><span>[expr<wbr>.array<wbr>.index<wbr>.trait-impl]</span></a>
</div>

<p>数组索引表达式可以通过实现 <a href="../core/ops/index/trait.Index.html">Index</a> 和 <a href="../core/ops/index/trait.IndexMut.html">IndexMut</a> 特型 来为数组和切片以外的类型实现。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr.tuple"><a class="rule-link" href="#r-expr.tuple" title="expr.tuple"><span>[expr<wbr>.tuple]</span></a>
</div>

<h1 id="元组和元组索引表达式"><a class="header" href="#元组和元组索引表达式">元组和元组索引表达式</a></h1>
<h2 id="元组表达式"><a class="header" href="#元组表达式">元组表达式</a></h2>
<div class="rule" id="r-expr.tuple.syntax"><a class="rule-link" href="#r-expr.tuple.syntax" title="expr.tuple.syntax"><span>[expr<wbr>.tuple<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-TupleExpression" onclick="show_railroad()"><a href="#railroad-TupleExpression">TupleExpression</a></span> → <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-TupleElements">TupleElements</a></span><sup>?</sup> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-TupleElements" onclick="show_railroad()"><a href="#railroad-TupleElements">TupleElements</a></span> → ( <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">,</span> )<sup>+</sup> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span><sup>?</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 318px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TupleExpression"><svg class="railroad" viewbox="0 0 318 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TupleExpression">
<text class="comment" x="67" y="25">
TupleExpression</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="55" />
<text x="49" y="71">
(</text>
</g>
<g class="optional">
<path d=" M 73 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 124 m -59 0 l -5 -5 m 0 10 l 5 -5 m 59 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-TupleElements">
<g class="nonterminal">
<rect height="22" width="124" x="97" y="55" />
<text x="159" y="71">
TupleElements</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="255" y="55" />
<text x="269" y="71">
)</text>
</g>
<path d=" M 63 66 h 10" />
<path d=" M 245 66 h 10" />
</g>
<path d=" M 293 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 283 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 390px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TupleElements"><svg class="railroad" viewbox="0 0 390 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TupleElements">
<text class="comment" x="60" y="25">
TupleElements</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="repeat">
<path d=" M 35 66 h 12 m 138 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -138 m 72 0 l 5 -5 m 0 10 l -5 -5 m -72 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="47" y="55" />
<text x="97" y="71">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="157" y="55" />
<text x="171" y="71">
,</text>
</g>
<path d=" M 147 66 h 10" />
</g>
</g>
<g class="optional">
<path d=" M 207 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="231" y="55" />
<text x="281" y="71">
Expression</text>
</g>
</a>
</g>
<path d=" M 197 66 h 10" />
</g>
<path d=" M 365 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 355 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.tuple.result"><a class="rule-link" href="#r-expr.tuple.result" title="expr.tuple.result"><span>[expr<wbr>.tuple<wbr>.result]</span></a>
</div>

<p>一个  <em>元组表达式</em>  构造 <a href="#元组类型">元组值</a>。</p>
<div class="rule" id="r-expr.tuple.intro"><a class="rule-link" href="#r-expr.tuple.intro" title="expr.tuple.intro"><span>[expr<wbr>.tuple<wbr>.intro]</span></a>
</div>

<p>元组表达式 的 语法格式 是括号括起来的、逗号分隔的表达式列表，称为  <em>元组初始化操作数</em> 。</p>
<div class="rule" id="r-expr.tuple.unary-tuple-restriction"><a class="rule-link" href="#r-expr.tuple.unary-tuple-restriction" title="expr.tuple.unary-tuple-restriction"><span>[expr<wbr>.tuple<wbr>.unary-tuple-restriction]</span></a>
</div>

<p>一元 元组表达式 要求在其 元组初始化操作数 之后加一个逗号，以便与 <a href="#分组表达式">括号表达式</a> 区分开。</p>
<div class="rule" id="r-expr.tuple.value"><a class="rule-link" href="#r-expr.tuple.value" title="expr.tuple.value"><span>[expr<wbr>.tuple<wbr>.value]</span></a>
</div>

<p>元组表达式 是 <a href="#位置表达式和值表达式">值表达式</a>，它求值为新构造的 元组类型 的值。</p>
<div class="rule" id="r-expr.tuple.type"><a class="rule-link" href="#r-expr.tuple.type" title="expr.tuple.type"><span>[expr<wbr>.tuple<wbr>.type]</span></a>
</div>

<p>元组初始化操作数 的数量是构造出的元组的元数。</p>
<div class="rule" id="r-expr.tuple.unit"><a class="rule-link" href="#r-expr.tuple.unit" title="expr.tuple.unit"><span>[expr<wbr>.tuple<wbr>.unit]</span></a>
</div>

<p>没有任何 元组初始化操作数 的 元组表达式 会产生单元元组。</p>
<div class="rule" id="r-expr.tuple.fields"><a class="rule-link" href="#r-expr.tuple.fields" title="expr.tuple.fields"><span>[expr<wbr>.tuple<wbr>.fields]</span></a>
</div>

<p>对于其他 元组表达式，第一个写入的 元组初始化操作数 初始化字段 <code>0</code>，随后的操作数初始化下一个更高的字段。
例如，在 元组表达式 <code>('a', 'b', 'c')</code> 中，<code>'a'</code> 初始化字段 <code>0</code> 的值，<code>'b'</code> 字段 <code>1</code>，而 <code>'c'</code> 字段 <code>2</code>。</p>
<p>元组表达式 及其类型的示例：</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>表达式</th><th>类型</th></tr>
</thead>
<tbody>
<tr><td><code>()</code></td><td><code>()</code> (单元)</td></tr>
<tr><td><code>(0.0, 4.5)</code></td><td><code>(f64, f64)</code></td></tr>
<tr><td><code>("x".to_string(), )</code></td><td><code>(String, )</code></td></tr>
<tr><td><code>("a", 4usize, true)</code></td><td><code>(&amp;'static str, usize, bool)</code></td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-expr.tuple-index"><a class="rule-link" href="#r-expr.tuple-index" title="expr.tuple-index"><span>[expr<wbr>.tuple-index]</span></a>
</div>

<h2 id="元组索引表达式"><a class="header" href="#元组索引表达式">元组索引表达式</a></h2>
<div class="rule" id="r-expr.tuple-index.syntax"><a class="rule-link" href="#r-expr.tuple-index.syntax" title="expr.tuple-index.syntax"><span>[expr<wbr>.tuple-index<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-TupleIndexingExpression" onclick="show_railroad()"><a href="#railroad-TupleIndexingExpression">TupleIndexingExpression</a></span> → <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">.</span> <span class="grammar-text"><a href="#grammar-TUPLE_INDEX">TUPLE_INDEX</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 326px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TupleIndexingExpression"><svg class="railroad" viewbox="0 0 326 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TupleIndexingExpression">
<text class="comment" x="99" y="25">
TupleIndexingExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="42" />
<text x="85" y="58">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="145" y="42" />
<text x="159" y="58">
.</text>
</g>
<a class="link" xlink:href="#railroad-TUPLE_INDEX">
<g class="nonterminal">
<rect height="22" width="108" x="183" y="42" />
<text x="237" y="58">
TUPLE_INDEX</text>
</g>
</a>
<path d=" M 135 53 h 10" />
<path d=" M 173 53 h 10" />
</g>
<path d=" M 301 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 291 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.tuple-index.intro"><a class="rule-link" href="#r-expr.tuple-index.intro" title="expr.tuple-index.intro"><span>[expr<wbr>.tuple-index<wbr>.intro]</span></a>
</div>

<p>一个  <em>元组索引表达式</em>  访问 <a href="#元组类型">元组</a> 和 <a href="#结构体类型">元组结构体</a> 的字段。</p>
<p>元组索引表达式 的 语法格式 是一个表达式（称为  <em>元组操作数</em> ），然后是一个 <code>.</code>，最后是一个元组索引。</p>
<div class="rule" id="r-expr.tuple-index.index-syntax"><a class="rule-link" href="#r-expr.tuple-index.index-syntax" title="expr.tuple-index.index-syntax"><span>[expr<wbr>.tuple-index<wbr>.index-syntax]</span></a>
</div>

<p><em>元组索引</em>  的 语法格式 是一个没有前导零、下划线或后缀的 <a href="#整数字面量">十进制字面量</a>。
例如 <code>0</code> 和 <code>2</code> 是有效的元组索引，但 <code>01</code>、<code>0_</code> 和 <code>0i32</code> 不是。</p>
<div class="rule" id="r-expr.tuple-index.required-type"><a class="rule-link" href="#r-expr.tuple-index.required-type" title="expr.tuple-index.required-type"><span>[expr<wbr>.tuple-index<wbr>.required-type]</span></a>
</div>

<p>元组操作数 的类型必须是 <a href="#元组类型">元组类型</a> 或 <a href="#结构体类型">元组结构体</a>。</p>
<div class="rule" id="r-expr.tuple-index.index-name-operand"><a class="rule-link" href="#r-expr.tuple-index.index-name-operand" title="expr.tuple-index.index-name-operand"><span>[expr<wbr>.tuple-index<wbr>.index-name-operand]</span></a>
</div>

<p>元组索引必须是 元组操作数 类型的一个字段名。</p>
<div class="rule" id="r-expr.tuple-index.result"><a class="rule-link" href="#r-expr.tuple-index.result" title="expr.tuple-index.result"><span>[expr<wbr>.tuple-index<wbr>.result]</span></a>
</div>

<p>元组索引表达式 的求值除了其 元组操作数 的求值之外没有副作用。
作为 <a href="#位置表达式和值表达式">位置表达式</a>，它求值为 元组操作数 中与元组索引同名的字段的位置。</p>
<p>元组索引表达式 示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 索引元组
let pair = ("a string", 2);
assert_eq!(pair.1, 2);

// 索引元组结构体
<span class="boring">struct Point(f32, f32);
</span>let point = Point(1.0, 0.0);
assert_eq!(point.0, 1.0);
assert_eq!(point.1, 0.0);
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>与 <a href="#field-access-expressions">字段访问表达式</a> 不同，元组索引表达式 可以是 <a href="#调用表达式">调用表达式</a> 的函数操作数，因为它不会与方法调用混淆，因为方法名不能是数字。</p>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>尽管数组和切片也有元素，你必须使用 <a href="#array-and-slice-indexing-expressions">数组或切片索引表达式</a> 或 <a href="#slice-patterns">切片模式</a> 来访问它们的元素。</p>
</blockquote>
</div>

<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr.struct"><a class="rule-link" href="#r-expr.struct" title="expr.struct"><span>[expr<wbr>.struct]</span></a>
</div>

<h1 id="结构体表达式"><a class="header" href="#结构体表达式">结构体表达式</a></h1>
<div class="rule" id="r-expr.struct.syntax"><a class="rule-link" href="#r-expr.struct.syntax" title="expr.struct.syntax"><span>[expr<wbr>.struct<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-StructExpression" onclick="show_railroad()"><a href="#railroad-StructExpression">StructExpression</a></span> → <br>    <span class="grammar-text"><a href="#grammar-PathInExpression">PathInExpression</a></span> <span class="grammar-literal">{</span> ( <span class="grammar-text"><a href="#grammar-StructExprFields">StructExprFields</a></span> | <span class="grammar-text"><a href="#grammar-StructBase">StructBase</a></span> )<sup>?</sup> <span class="grammar-literal">}</span></p>
<p><span class="grammar-text grammar-production" id="grammar-StructExprFields" onclick="show_railroad()"><a href="#railroad-StructExprFields">StructExprFields</a></span> → <br>    <span class="grammar-text"><a href="#grammar-StructExprField">StructExprField</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-StructExprField">StructExprField</a></span> )<sup>*</sup> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-StructBase">StructBase</a></span> | <span class="grammar-literal">,</span><sup>?</sup> )</p>
<p><span class="grammar-text grammar-production" id="grammar-StructExprField" onclick="show_railroad()"><a href="#railroad-StructExprField">StructExprField</a></span> → <br>    <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> <br>    ( <br>        <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <br>      | ( <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> | <span class="grammar-text"><a href="#grammar-TUPLE_INDEX">TUPLE_INDEX</a></span> ) <span class="grammar-literal">:</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    )</p>
<p><span class="grammar-text grammar-production" id="grammar-StructBase" onclick="show_railroad()"><a href="#railroad-StructBase">StructBase</a></span> → <span class="grammar-literal">..</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 548px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-StructExpression"><svg class="railroad" viewbox="0 0 548 120" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-StructExpression">
<text class="comment" x="71" y="25">
StructExpression</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-PathInExpression">
<g class="nonterminal">
<rect height="22" width="148" x="35" y="55" />
<text x="109" y="71">
PathInExpression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="193" y="55" />
<text x="207" y="71">
{</text>
</g>
<g class="optional">
<path d=" M 231 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 196 m -95 0 l -5 -5 m 0 10 l 5 -5 m 95 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="choice">
<path d=" M 255 66 h 24 m 148 0 h 24" />
<a class="link" xlink:href="#railroad-StructExprFields">
<g class="nonterminal">
<rect height="22" width="148" x="279" y="55" />
<text x="353" y="71">
StructExprFields</text>
</g>
</a>
<path d=" M 255 66 a 12 12 0 0 1 12 12 v 9 m 172 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 267 87 v 0 a 12 12 0 0 0 12 12 m 100 0 h 48 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-StructBase">
<g class="nonterminal">
<rect height="22" width="100" x="279" y="88" />
<text x="329" y="104">
StructBase</text>
</g>
</a>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="485" y="55" />
<text x="499" y="71">
}</text>
</g>
<path d=" M 183 66 h 10" />
<path d=" M 221 66 h 10" />
<path d=" M 475 66 h 10" />
</g>
<path d=" M 523 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 513 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 666px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-StructExprFields"><svg class="railroad" viewbox="0 0 666 132" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-StructExprFields">
<text class="comment" x="71" y="25">
StructExprFields</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-StructExprField">
<g class="nonterminal">
<rect height="22" width="140" x="35" y="55" />
<text x="105" y="71">
StructExprField</text>
</g>
</a>
<g class="optional">
<path d=" M 185 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 202 m -98 0 l -5 -5 m 0 10 l 5 -5 m 98 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 209 66 h 12 m 178 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -178 m 92 0 l 5 -5 m 0 10 l -5 -5 m -92 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="221" y="55" />
<text x="235" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-StructExprField">
<g class="nonterminal">
<rect height="22" width="140" x="259" y="55" />
<text x="329" y="71">
StructExprField</text>
</g>
</a>
<path d=" M 249 66 h 10" />
</g>
</g>
</g>
<g class="choice">
<path d=" M 445 66 h 24 m 138 0 h 24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="469" y="55" />
<text x="483" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-StructBase">
<g class="nonterminal">
<rect height="22" width="100" x="507" y="55" />
<text x="557" y="71">
StructBase</text>
</g>
</a>
<path d=" M 497 66 h 10" />
</g>
<path d=" M 445 66 a 12 12 0 0 1 12 12 v 9 m 162 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 457 87 v 12 a 12 12 0 0 0 12 12 m 76 0 h 62 m -28 0 l -5 -5 m 0 10 l 5 -5 m 28 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="optional">
<path d=" M 469 111 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="493" y="100" />
<text x="507" y="116">
,</text>
</g>
</g>
</g>
<path d=" M 175 66 h 10" />
<path d=" M 435 66 h 10" />
</g>
<path d=" M 641 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 631 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 636px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-StructExprField"><svg class="railroad" viewbox="0 0 636 153" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-StructExprField">
<text class="comment" x="67" y="25">
StructExprField</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<g class="choice">
<path d=" M 249 66 h 24 m 100 0 h 228 m -111 0 l -5 -5 m 0 10 l 5 -5 m 111 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="273" y="55" />
<text x="323" y="71">
IDENTIFIER</text>
</g>
</a>
</g>
<path d=" M 249 66 a 12 12 0 0 1 12 12 v 9 m 328 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 261 87 v 0 a 12 12 0 0 0 12 12 m 304 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="choice">
<path d=" M 273 99 h 24 m 100 0 h 32" />
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="297" y="88" />
<text x="347" y="104">
IDENTIFIER</text>
</g>
</a>
<path d=" M 273 99 a 12 12 0 0 1 12 12 v 9 m 132 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 285 120 v 0 a 12 12 0 0 0 12 12 m 108 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-TUPLE_INDEX">
<g class="nonterminal">
<rect height="22" width="108" x="297" y="121" />
<text x="351" y="137">
TUPLE_INDEX</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="439" y="88" />
<text x="453" y="104">
:</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="477" y="88" />
<text x="527" y="104">
Expression</text>
</g>
</a>
<path d=" M 429 99 h 10" />
<path d=" M 467 99 h 10" />
</g>
</g>
<path d=" M 239 66 h 10" />
</g>
<path d=" M 611 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 601 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 216px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-StructBase"><svg class="railroad" viewbox="0 0 216 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-StructBase">
<text class="comment" x="50" y="25">
StructBase</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="42" />
<text x="53" y="58">
..</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="81" y="42" />
<text x="131" y="58">
Expression</text>
</g>
</a>
<path d=" M 71 53 h 10" />
</g>
<path d=" M 191 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 181 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.struct.intro"><a class="rule-link" href="#r-expr.struct.intro" title="expr.struct.intro"><span>[expr<wbr>.struct<wbr>.intro]</span></a>
</div>

<p>一个  <em>结构体表达式</em>  创建一个结构体、枚举或联合体值。
它由指向 <a href="#结构体">结构体</a>、<a href="#枚举">枚举变体</a> 或 <a href="#联合体">联合体</a> 项 的路径，以及随后该 项 的字段值组成。</p>
<p>以下是结构体表达式的示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct Point { x: f64, y: f64 }
</span><span class="boring">struct NothingInMe { }
</span><span class="boring">mod game { pub struct User&lt;'a&gt; { pub name: &amp;'a str, pub age: u32, pub score: usize } }
</span><span class="boring">enum Enum { Variant {} }
</span>Point {x: 10.0, y: 20.0};
NothingInMe {};
let u = game::User {name: "Joe", age: 35, score: 100_000};
Enum::Variant {};
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>元组结构体和元组枚举变体通常使用引用 <a href="#r-items.struct.tuple">值命名空间中的构造函数</a> 的 <a href="#r-expr.call">调用表达式</a> 来实例化。这些不同于使用花括号引用类型命名空间中构造函数的结构体表达式。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Position(i32, i32, i32);
Position(0, 0, 0);  // 创建元组结构体的典型方式。
let c = Position;  // `c` 是一个接受 3 个参数的函数。
let pos = c(8, 6, 7);  // 创建一个 `Position` 值。

enum Version { Triple(i32, i32, i32) };
Version::Triple(0, 0, 0);
let f = Version::Triple;
let ver = f(8, 6, 7);
<span class="boring">}</span></code></pre>
<p>调用路径的最后一段不能引用类型别名：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Tr { type T; }
impl&lt;T&gt; Tr for T { type T = T; }

struct Tuple();
enum Enum { Tuple() }

// &lt;Unit as Tr&gt;::T(); // 导致错误 —— `::T` 是一个类型，而不是一个值
&lt;Enum as Tr&gt;::T::Tuple(); // 确定
<span class="boring">}</span></code></pre>
<hr>
<p>单元结构体和单元枚举变体通常使用引用 <a href="#r-items.struct.unit">值命名空间中的常量</a> 的 <a href="#r-expr.path">路径表达式</a> 来实例化。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Gamma;
// Gamma 单元值，引用值命名空间中的常量。
let a = Gamma;
// 与 `a` 完全相同的值，但是使用引用类型命名空间的结构体表达式构造的。
let b = Gamma {};

enum ColorSpace { Oklch }
let c = ColorSpace::Oklch;
let d = ColorSpace::Oklch {};
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-expr.struct.field"><a class="rule-link" href="#r-expr.struct.field" title="expr.struct.field"><span>[expr<wbr>.struct<wbr>.field]</span></a>
</div>

<h2 id="带字段的结构体表达式"><a class="header" href="#带字段的结构体表达式">带字段的结构体表达式</a></h2>
<div class="rule" id="r-expr.struct.field.intro"><a class="rule-link" href="#r-expr.struct.field.intro" title="expr.struct.field.intro"><span>[expr<wbr>.struct<wbr>.field<wbr>.intro]</span></a>
</div>

<p>带有花括号包围字段的结构体表达式允许你以任意顺序指定每个单独字段的值。
字段名与其值之间用冒号分隔。</p>
<div class="rule" id="r-expr.struct.field.union-constraint"><a class="rule-link" href="#r-expr.struct.field.union-constraint" title="expr.struct.field.union-constraint"><span>[expr<wbr>.struct<wbr>.field<wbr>.union-constraint]</span></a>
</div>

<p><a href="#联合体">联合体</a> 类型的值只能使用此语法创建，并且必须指定恰好一个字段。</p>
<div class="rule" id="r-expr.struct.update"><a class="rule-link" href="#r-expr.struct.update" title="expr.struct.update"><span>[expr<wbr>.struct<wbr>.update]</span></a>
</div>

<h2 id="函数式更新语法"><a class="header" href="#函数式更新语法">函数式更新语法</a></h2>
<div class="rule" id="r-expr.struct.update.intro"><a class="rule-link" href="#r-expr.struct.update.intro" title="expr.struct.update.intro"><span>[expr<wbr>.struct<wbr>.update<wbr>.intro]</span></a>
</div>

<p>构造结构体类型值的结构体表达式可以以语法 <code>..</code> 后跟一个表达式结束，以表示函数式更新。</p>
<div class="rule" id="r-expr.struct.update.base-same-type"><a class="rule-link" href="#r-expr.struct.update.base-same-type" title="expr.struct.update.base-same-type"><span>[expr<wbr>.struct<wbr>.update<wbr>.base-same-type]</span></a>
</div>

<p>在 <code>..</code> 之后的表达式（基准）必须具有与正在形成的新结构体类型相同的结构体类型。</p>
<div class="rule" id="r-expr.struct.update.fields"><a class="rule-link" href="#r-expr.struct.update.fields" title="expr.struct.update.fields"><span>[expr<wbr>.struct<wbr>.update<wbr>.fields]</span></a>
</div>

<p>整个表达式使用指定的字段的给定值，并从基准表达式中移动 (move) 或复制 (copy) 剩余的字段。</p>
<div class="rule" id="r-expr.struct.update.visibility-constraint"><a class="rule-link" href="#r-expr.struct.update.visibility-constraint" title="expr.struct.update.visibility-constraint"><span>[expr<wbr>.struct<wbr>.update<wbr>.visibility-constraint]</span></a>
</div>

<p>与所有结构体表达式一样，结构体的所有字段必须是 <a href="#可见性和私有性">可见</a> 的，即使是那些没有明确命名的字段。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct Point3d { x: i32, y: i32, z: i32 }
</span>let mut base = Point3d {x: 1, y: 2, z: 3};
let y_ref = &amp;mut base.y;
Point3d {y: 0, z: 10, .. base}; // 确定，仅访问了 base.x
drop(y_ref);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.struct.brace-restricted-positions"><a class="rule-link" href="#r-expr.struct.brace-restricted-positions" title="expr.struct.brace-restricted-positions"><span>[expr<wbr>.struct<wbr>.brace-restricted-positions]</span></a>
</div>

<p>结构体表达式不能直接用于 <a href="#循环及其他可中断表达式">loop</a> 或 <a href="#if-expressions">if</a> 表达式的头部，也不能用于 <a href="#if-let-patterns">if let</a> 或 <a href="#match表达式">match</a> 表达式的 <a href="#scrutinee">审查对象</a>。
然而，如果结构体表达式位于另一个表达式之内（例如在 <a href="#分组表达式">括号</a> 内），则可以用于这些情况。</p>
<div class="rule" id="r-expr.struct.tuple-field"><a class="rule-link" href="#r-expr.struct.tuple-field" title="expr.struct.tuple-field"><span>[expr<wbr>.struct<wbr>.tuple-field]</span></a>
</div>

<p>字段名可以是十进制整数值，用于指定构造元组结构体的索引。
这可以与基准结构体一起使用，以填充未指定的其余索引：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Color(u8, u8, u8);
let c1 = Color(0, 0, 0);  // 创建元组结构体的典型方式。
let c2 = Color{0: 255, 1: 127, 2: 0};  // 按索引指定字段。
let c3 = Color{1: 0, ..c2};  // 使用基准结构体填充所有其他字段。
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.struct.field.named"><a class="rule-link" href="#r-expr.struct.field.named" title="expr.struct.field.named"><span>[expr<wbr>.struct<wbr>.field<wbr>.named]</span></a>
</div>

<h3 id="结构体字段初始化简写"><a class="header" href="#结构体字段初始化简写">结构体字段初始化简写</a></h3>
<p>当初始化具有命名（但不是编号）字段的数据结构（结构体、枚举、联合体）时，允许将 <code>fieldname</code> 写为 <code>fieldname: fieldname</code> 的简写。
这允许一种更紧凑、重复更少的语法。
例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct Point3d { x: i32, y: i32, z: i32 }
</span><span class="boring">let x = 0;
</span><span class="boring">let y_value = 0;
</span><span class="boring">let z = 0;
</span>Point3d { x: x, y: y_value, z: z };
Point3d { x, y: y_value, z };
<span class="boring">}</span></code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr.call"><a class="rule-link" href="#r-expr.call" title="expr.call"><span>[expr<wbr>.call]</span></a>
</div>

<h1 id="调用表达式"><a class="header" href="#调用表达式">调用表达式</a></h1>
<div class="rule" id="r-expr.call.syntax"><a class="rule-link" href="#r-expr.call.syntax" title="expr.call.syntax"><span>[expr<wbr>.call<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-CallExpression" onclick="show_railroad()"><a href="#railroad-CallExpression">CallExpression</a></span> → <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-CallParams">CallParams</a></span><sup>?</sup> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-CallParams" onclick="show_railroad()"><a href="#railroad-CallParams">CallParams</a></span> → <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 404px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-CallExpression"><svg class="railroad" viewbox="0 0 404 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-CallExpression">
<text class="comment" x="64" y="25">
CallExpression</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="55" />
<text x="85" y="71">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="145" y="55" />
<text x="159" y="71">
(</text>
</g>
<g class="optional">
<path d=" M 183 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-CallParams">
<g class="nonterminal">
<rect height="22" width="100" x="207" y="55" />
<text x="257" y="71">
CallParams</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="341" y="55" />
<text x="355" y="71">
)</text>
</g>
<path d=" M 135 66 h 10" />
<path d=" M 173 66 h 10" />
<path d=" M 331 66 h 10" />
</g>
<path d=" M 379 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 369 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 476px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-CallParams"><svg class="railroad" viewbox="0 0 476 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-CallParams">
<text class="comment" x="50" y="25">
CallParams</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="55" />
<text x="85" y="71">
Expression</text>
</g>
</a>
<g class="optional">
<path d=" M 145 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 162 m -78 0 l -5 -5 m 0 10 l 5 -5 m 78 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 169 66 h 12 m 138 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -138 m 72 0 l 5 -5 m 0 10 l -5 -5 m -72 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="181" y="55" />
<text x="195" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="219" y="55" />
<text x="269" y="71">
Expression</text>
</g>
</a>
<path d=" M 209 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 365 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="389" y="55" />
<text x="403" y="71">
,</text>
</g>
</g>
<path d=" M 135 66 h 10" />
<path d=" M 355 66 h 10" />
</g>
<path d=" M 451 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 441 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.call.intro"><a class="rule-link" href="#r-expr.call.intro" title="expr.call.intro"><span>[expr<wbr>.call<wbr>.intro]</span></a>
</div>

<p>一个  <em>调用表达式</em>  调用一个函数。
调用表达式 的 语法格式 是一个表达式（称为  <em>函数操作数</em> ），后跟一个括号括起来的、逗号分隔的表达式列表（称为  <em>参数操作数</em> ）。</p>
<div class="rule" id="r-expr.call.convergence"><a class="rule-link" href="#r-expr.call.convergence" title="expr.call.convergence"><span>[expr<wbr>.call<wbr>.convergence]</span></a>
</div>

<p>如果函数最终返回，则该表达式完成。</p>
<div class="rule" id="r-expr.call.trait"><a class="rule-link" href="#r-expr.call.trait" title="expr.call.trait"><span>[expr<wbr>.call<wbr>.trait]</span></a>
</div>

<p>对于 <a href="#函数项类型">非函数类型</a>，表达式 <code>f(...)</code> 会根据 函数操作数 使用以下 特型 之一的方法：</p>
<ul>
<li><a href="../core/ops/function/trait.Fn.html"><code>Fn</code></a> 或 <a href="../core/ops/async_function/trait.AsyncFn.html"><code>AsyncFn</code></a> — 共享引用。</li>
<li><a href="../core/ops/function/trait.FnMut.html"><code>FnMut</code></a> 或 <a href="../core/ops/async_function/trait.AsyncFnMut.html"><code>AsyncFnMut</code></a> — 可变引用。</li>
<li><a href="../core/ops/function/trait.FnOnce.html"><code>FnOnce</code></a> 或 <a href="../core/ops/async_function/trait.AsyncFnOnce.html"><code>AsyncFnOnce</code></a> — 值。</li>
</ul>
<div class="rule" id="r-expr.call.autoref-deref"><a class="rule-link" href="#r-expr.call.autoref-deref" title="expr.call.autoref-deref"><span>[expr<wbr>.call<wbr>.autoref-deref]</span></a>
</div>

<p>如果需要，将进行自动借用。
函数操作数 也会根据需要进行 <a href="#automatic-dereferencing">自动解引用</a>。</p>
<p>一些 调用表达式 的示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn add(x: i32, y: i32) -&gt; i32 { 0 }
</span>let three: i32 = add(1i32, 2i32);
let name: &amp;'static str = (|| "Rust")();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.call.desugar"><a class="rule-link" href="#r-expr.call.desugar" title="expr.call.desugar"><span>[expr<wbr>.call<wbr>.desugar]</span></a>
</div>

<h2 id="消除函数调用歧义"><a class="header" href="#消除函数调用歧义">消除函数调用歧义</a></h2>
<div class="rule" id="r-expr.call.desugar.fully-qualified"><a class="rule-link" href="#r-expr.call.desugar.fully-qualified" title="expr.call.desugar.fully-qualified"><span>[expr<wbr>.call<wbr>.desugar<wbr>.fully-qualified]</span></a>
</div>

<p>所有函数调用都是更显式的 <a href="#qualified-paths">完全限定语法</a> 的语法糖。</p>
<div class="rule" id="r-expr.call.desugar.ambiguity"><a class="rule-link" href="#r-expr.call.desugar.ambiguity" title="expr.call.desugar.ambiguity"><span>[expr<wbr>.call<wbr>.desugar<wbr>.ambiguity]</span></a>
</div>

<p>函数调用可能需要完全限定，具体取决于考虑到作用域内 项 时调用的歧义性。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>在过去，术语 “Unambiguous Function Call Syntax”、“Universal Function Call Syntax” 或 “UFCS” 已被用于文档、issue、RFC 和其他社区著作中。然而，这些术语缺乏描述力，并且可能会使手头的问题更加混淆。为了便于搜索，我们在这里提及它们。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.call.desugar.limits"><a class="rule-link" href="#r-expr.call.desugar.limits" title="expr.call.desugar.limits"><span>[expr<wbr>.call<wbr>.desugar<wbr>.limits]</span></a>
</div>

<p>经常会出现几种导致方法或关联函数调用的接收者或指代对象产生歧义的情况。
这些情况可能包括：</p>
<ul>
<li>多个作用域内的 特型 为相同类型定义了同名方法</li>
<li>自动解引用 (Auto-<code>deref</code>) 是不希望的；例如，区分智能指针本身的方法和指针指代对象的方法</li>
<li>不带参数的方法（如 <a href="../core/default/trait.Default.html#tymethod.default"><code>default()</code></a>）并返回类型的属性（如 <a href="../core/mem/fn.size_of.html"><code>size_of()</code></a>）</li>
</ul>
<div class="rule" id="r-expr.call.desugar.explicit-path"><a class="rule-link" href="#r-expr.call.desugar.explicit-path" title="expr.call.desugar.explicit-path"><span>[expr<wbr>.call<wbr>.desugar<wbr>.explicit-path]</span></a>
</div>

<p>为了解决歧义，程序员可以使用更具体的路径、类型或 特型 来引用其所需的方法或函数。</p>
<p>例如，</p>
<pre class="playground"><code class="language-rust edition2024">trait Pretty {
    fn print(&amp;self);
}

trait Ugly {
    fn print(&amp;self);
}

struct Foo;
impl Pretty for Foo {
    fn print(&amp;self) {}
}

struct Bar;
impl Pretty for Bar {
    fn print(&amp;self) {}
}
impl Ugly for Bar {
    fn print(&amp;self) {}
}

fn main() {
    let f = Foo;
    let b = Bar;

    // 我们可以这样做，因为对于 Foo 类型，我们只有一个名为 print 的项
    f.print();
    // 更显式，而且对于 Foo 来说不是必需的
    Foo::print(&amp;f);
    // 如果你不喜欢这种简洁方式的话
    &lt;Foo as Pretty&gt;::print(&amp;f);

    // b.print(); // 错误：发现多个 'print'
    // Bar::print(&amp;b); // 仍然是错误：发现多个 print

    // 因为作用域内的项定义了 print，所以这是必需的
    &lt;Bar as Pretty&gt;::print(&amp;b);
}</code></pre>
<p>有关更多细节和动机，请参阅 <a href="https://github.com/rust-lang/rfcs/blob/master/text/0132-ufcs.md">RFC 132</a>。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr.method"><a class="rule-link" href="#r-expr.method" title="expr.method"><span>[expr<wbr>.method]</span></a>
</div>

<h1 id="方法调用表达式"><a class="header" href="#方法调用表达式">方法调用表达式</a></h1>
<div class="rule" id="r-expr.method.syntax"><a class="rule-link" href="#r-expr.method.syntax" title="expr.method.syntax"><span>[expr<wbr>.method<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-MethodCallExpression" onclick="show_railroad()"><a href="#railroad-MethodCallExpression">MethodCallExpression</a></span> → <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">.</span> <span class="grammar-text"><a href="#grammar-PathExprSegment">PathExprSegment</a></span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-CallParams">CallParams</a></span><sup>?</sup> <span class="grammar-literal">)</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 592px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MethodCallExpression"><svg class="railroad" viewbox="0 0 592 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MethodCallExpression">
<text class="comment" x="88" y="25">
MethodCallExpression</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="55" />
<text x="85" y="71">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="145" y="55" />
<text x="159" y="71">
.</text>
</g>
<a class="link" xlink:href="#railroad-PathExprSegment">
<g class="nonterminal">
<rect height="22" width="140" x="183" y="55" />
<text x="253" y="71">
PathExprSegment</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="333" y="55" />
<text x="347" y="71">
(</text>
</g>
<g class="optional">
<path d=" M 371 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-CallParams">
<g class="nonterminal">
<rect height="22" width="100" x="395" y="55" />
<text x="445" y="71">
CallParams</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="529" y="55" />
<text x="543" y="71">
)</text>
</g>
<path d=" M 135 66 h 10" />
<path d=" M 173 66 h 10" />
<path d=" M 323 66 h 10" />
<path d=" M 361 66 h 10" />
<path d=" M 519 66 h 10" />
</g>
<path d=" M 567 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 557 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.method.intro"><a class="rule-link" href="#r-expr.method.intro" title="expr.method.intro"><span>[expr<wbr>.method<wbr>.intro]</span></a>
</div>

<p>一个 <em>方法调用</em> 由一个表达式（ <em>接收者</em> ）、一个点、一个表达式路径段和一个括号括起来的表达式列表组成。</p>
<div class="rule" id="r-expr.method.target"><a class="rule-link" href="#r-expr.method.target" title="expr.method.target"><span>[expr<wbr>.method<wbr>.target]</span></a>
</div>

<p>方法调用被解析为特定 特型 上的关联 <a href="#方法">方法</a>，如果左侧的准确 <code>self</code> 类型已知，则静态分派到方法；如果左侧表达式是一个间接的 <a href="#特型对象">特型对象</a>。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let pi: Result&lt;f32, _&gt; = "3.14".parse();
let log_pi = pi.unwrap_or(1.0).log(2.72);
<span class="boring">assert!(1.14 &lt; log_pi &amp;&amp; log_pi &lt; 1.15)
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.method.autoref-deref"><a class="rule-link" href="#r-expr.method.autoref-deref" title="expr.method.autoref-deref"><span>[expr<wbr>.method<wbr>.autoref-deref]</span></a>
</div>

<p>在查找方法调用时，接收者可能会被自动解引用或借用，以便调用方法。
这比其他函数需要更复杂的查找过程，因为可能有多个可能的方法可以调用。使用以下程序：</p>
<div class="rule" id="r-expr.method.candidate-receivers"><a class="rule-link" href="#r-expr.method.candidate-receivers" title="expr.method.candidate-receivers"><span>[expr<wbr>.method<wbr>.candidate-receivers]</span></a>
</div>

<p>第一步是构建候选接收者类型列表。
通过重复 <a href="#the-dereference-operator">解引用</a> 接收者表达式的类型来获取这些类型，将遇到的每个类型添加到列表中，最后尝试进行 <a href="#unsized-coercions">不定尺寸强制转换</a>，如果成功则添加结果类型。</p>
<div class="rule" id="r-expr.method.candidate-receivers-refs"><a class="rule-link" href="#r-expr.method.candidate-receivers-refs" title="expr.method.candidate-receivers-refs"><span>[expr<wbr>.method<wbr>.candidate-receivers-refs]</span></a>
</div>

<p>然后，对于每个候选 <code>T</code>，紧接着 <code>T</code> 之后将 <code>&amp;T</code> 和 <code>&amp;mut T</code> 添加到列表中。</p>
<p>例如，如果接收者的类型为 <code>Box&lt;[i32;2]&gt;</code>，那么候选类型将是 <code>Box&lt;[i32;2]&gt;</code>、<code>&amp;Box&lt;[i32;2]&gt;</code>、<code>&amp;mut Box&lt;[i32;2]&gt;</code>、<code>[i32; 2]</code>（通过解引用）、<code>&amp;[i32; 2]</code>、<code>&amp;mut [i32; 2]</code>、<code>[i32]</code>（通过不定尺寸强制转换）、<code>&amp;[i32]</code>，以及最后的 <code>&amp;mut [i32]</code>。</p>
<div class="rule" id="r-expr.method.candidate-search"><a class="rule-link" href="#r-expr.method.candidate-search" title="expr.method.candidate-search"><span>[expr<wbr>.method<wbr>.candidate-search]</span></a>
</div>

<p>然后，对于每个候选类型 <code>T</code>，在以下位置搜索具有该类型接收者的 <a href="#可见性和私有性">可见</a> 方法：</p>
<ol>
<li><code>T</code> 的固有方法（直接在 <code>T</code> 上实现的方法）。</li>
<li>由 <code>T</code> 实现的任何 <a href="#可见性和私有性">可见</a> 特型 提供的方法。
如果 <code>T</code> 是类型参数，则首先查找由 <code>T</code> 上的 特型 约束提供的方法。
然后查找作用域内所有剩余的方法。</li>
</ol>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>查找按顺序对每个类型进行，这偶尔会导致令人惊讶的结果。下面的代码将打印 “In trait impl!”，因为首先查找 <code>&amp;self</code> 方法，在找到结构体的 <code>&amp;mut self</code> 方法之前就找到了 特型 方法。</p>
<pre class="playground"><code class="language-rust edition2024">struct Foo {}

trait Bar {
  fn bar(&amp;self);
}

impl Foo {
  fn bar(&amp;mut self) {
    println!("In struct impl!")
  }
}

impl Bar for Foo {
  fn bar(&amp;self) {
    println!("In trait impl!")
  }
}

fn main() {
  let mut f = Foo{};
  f.bar();
}</code></pre>
</blockquote>
</div>

<div class="rule" id="r-expr.method.ambiguous-target"><a class="rule-link" href="#r-expr.method.ambiguous-target" title="expr.method.ambiguous-target"><span>[expr<wbr>.method<wbr>.ambiguous-target]</span></a>
</div>

<p>如果这导致多个可能的候选者，则是一个错误，必须将接收者 <a href="#disambiguating-function-calls">转换</a> 为适当的接收者类型以进行方法调用。</p>
<div class="rule" id="r-expr.method.receiver-constraints"><a class="rule-link" href="#r-expr.method.receiver-constraints" title="expr.method.receiver-constraints"><span>[expr<wbr>.method<wbr>.receiver-constraints]</span></a>
</div>

<p>此过程不考虑接收者的可变性或生命周期，也不考虑方法是否为 <code>unsafe</code>。
一旦查找到方法，如果由于这些原因之一（或多个）而无法调用，结果将是编译器错误。</p>
<div class="rule" id="r-expr.method.ambiguous-search"><a class="rule-link" href="#r-expr.method.ambiguous-search" title="expr.method.ambiguous-search"><span>[expr<wbr>.method<wbr>.ambiguous-search]</span></a>
</div>

<p>如果到达某一步存在多个可能的方法，例如泛型方法或 特型 被视为相同，则这是一个编译器错误。
这些情况需要使用 <a href="#disambiguating-function-calls">消除歧义的函数调用语法</a> 进行方法和函数调用。</p>
<div class="rule" id="r-expr.method.edition2021"><a class="rule-link" href="#r-expr.method.edition2021" title="expr.method.edition2021"><span>[expr<wbr>.method<wbr>.edition2021]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2021</span> 版次差异</p>

<p>在 2021 版次之前，在搜索可见方法期间，如果候选接收者类型是 <a href="#数组类型">数组类型</a>，则会忽略标准库 <a href="../core/iter/traits/collect/trait.IntoIterator.html"><code>IntoIterator</code></a> 特型 提供的方法。</p>
<p>为此目的使用的 版次 由代表方法名的 词法单元 决定。</p>
<p>此特殊情况将来可能会被删除。</p>
</blockquote>
</div>

<div class="alert alert-warning">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>警告</p>

<p>对于 <a href="#特型对象">特型对象</a>，如果存在与 特型 方法同名的固有方法，则在尝试在方法调用表达式中调用该方法时会给出编译器错误。
相反，你可以使用 <a href="#disambiguating-function-calls">消除歧义的函数调用语法</a> 来调用该方法，在这种情况下，它调用的是 特型 方法，而不是固有方法。
没有办法调用固有方法。
只要不在 特型对象 上定义与 特型 方法同名的固有方法就没事。</p>
</blockquote>
</div>

<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr.field"><a class="rule-link" href="#r-expr.field" title="expr.field"><span>[expr<wbr>.field]</span></a>
</div>

<h1 id="字段访问表达式"><a class="header" href="#字段访问表达式">字段访问表达式</a></h1>
<div class="rule" id="r-expr.field.syntax"><a class="rule-link" href="#r-expr.field.syntax" title="expr.field.syntax"><span>[expr<wbr>.field<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-FieldExpression" onclick="show_railroad()"><a href="#railroad-FieldExpression">FieldExpression</a></span> → <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">.</span> <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 318px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-FieldExpression"><svg class="railroad" viewbox="0 0 318 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-FieldExpression">
<text class="comment" x="67" y="25">
FieldExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="42" />
<text x="85" y="58">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="145" y="42" />
<text x="159" y="58">
.</text>
</g>
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="183" y="42" />
<text x="233" y="58">
IDENTIFIER</text>
</g>
</a>
<path d=" M 135 53 h 10" />
<path d=" M 173 53 h 10" />
</g>
<path d=" M 293 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 283 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.field.intro"><a class="rule-link" href="#r-expr.field.intro" title="expr.field.intro"><span>[expr<wbr>.field<wbr>.intro]</span></a>
</div>

<p>一个 <em>字段表达式</em> 是一个 <a href="#位置表达式和值表达式">位置表达式</a>，它求值为 <a href="#结构体">结构体</a> 或 <a href="#联合体">联合体</a> 的字段位置。</p>
<div class="rule" id="r-expr.field.mut"><a class="rule-link" href="#r-expr.field.mut" title="expr.field.mut"><span>[expr<wbr>.field<wbr>.mut]</span></a>
</div>

<p>当操作数是 <a href="#mutability">可变的</a> 时，字段表达式也是可变的。</p>
<div class="rule" id="r-expr.field.form"><a class="rule-link" href="#r-expr.field.form" title="expr.field.form"><span>[expr<wbr>.field<wbr>.form]</span></a>
</div>

<p>字段表达式的 语法格式 是一个表达式，称为 <em>容器操作数</em>，然后是一个 <code>.</code>，最后是一个 <a href="#标识符">标识符</a>。</p>
<div class="rule" id="r-expr.field.not-method-call"><a class="rule-link" href="#r-expr.field.not-method-call" title="expr.field.not-method-call"><span>[expr<wbr>.field<wbr>.not-method-call]</span></a>
</div>

<p>字段表达式不能后面跟着圆括号括起来的逗号分隔的表达式列表，因为那会被解析为 <a href="#方法调用表达式">方法调用表达式</a>。
也就是说，它们不能作为 <a href="#调用表达式">调用表达式</a> 的函数操作数。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>将字段表达式包装在 <a href="#分组表达式">括号表达式</a> 中以便在调用表达式中使用。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct HoldsCallable&lt;F: Fn()&gt; { callable: F }
</span>let holds_callable = HoldsCallable { callable: || () };

// 无效：解析为调用名为 "callable" 的方法
// holds_callable.callable();

// 有效
(holds_callable.callable)();
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<p>示例：</p>
<!-- ignore: needs lots of support code -->
<pre><code class="language-rust ignore">mystruct.myfield;
foo().x;
(Struct {a: 10, b: 20}).a;
(mystruct.function_field)() // 包含字段表达式的调用表达式</code></pre>
<div class="rule" id="r-expr.field.autoref-deref"><a class="rule-link" href="#r-expr.field.autoref-deref" title="expr.field.autoref-deref"><span>[expr<wbr>.field<wbr>.autoref-deref]</span></a>
</div>

<h2 id="自动解引用"><a class="header" href="#自动解引用">自动解引用</a></h2>
<p>如果容器操作数的类型实现了 <a href="#deref-and-derefmut"><code>Deref</code></a> 或 <a href="#deref-and-derefmut"><code>DerefMut</code></a>（取决于操作数是否 <a href="#mutability">可变的</a>），它会被 <em>自动解引用</em> 尽可能多次，以使字段访问成为可能。
这个过程简称为 <em>autoderef</em> 。</p>
<div class="rule" id="r-expr.field.borrow"><a class="rule-link" href="#r-expr.field.borrow" title="expr.field.borrow"><span>[expr<wbr>.field<wbr>.borrow]</span></a>
</div>

<h2 id="借用"><a class="header" href="#借用">借用</a></h2>
<p>结构体的字段或对结构体的引用在借用时被视为独立的实体。
如果结构体没有实现 <a href="#drop"><code>Drop</code></a> 且存储在局部变量中，这也适用于将其各个字段移出。
如果自动解引用是通过除 <a href="#boxt"><code>Box</code></a> 以外的用户定义类型进行的，则此规则也不适用。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct A { f1: String, f2: String, f3: String }
let mut x: A;
<span class="boring">x = A {
</span><span class="boring">    f1: "f1".to_string(),
</span><span class="boring">    f2: "f2".to_string(),
</span><span class="boring">    f3: "f3".to_string()
</span><span class="boring">};
</span>let a: &amp;mut String = &amp;mut x.f1; // x.f1 被可变借用
let b: &amp;String = &amp;x.f2;         // x.f2 被不可变借用
let c: &amp;String = &amp;x.f2;         // 可以再次借用
let d: String = x.f3;           // 移出 x.f3
<span class="boring">}</span></code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr.closure"><a class="rule-link" href="#r-expr.closure" title="expr.closure"><span>[expr<wbr>.closure]</span></a>
</div>

<h1 id="闭包表达式"><a class="header" href="#闭包表达式">闭包表达式</a></h1>
<div class="rule" id="r-expr.closure.syntax"><a class="rule-link" href="#r-expr.closure.syntax" title="expr.closure.syntax"><span>[expr<wbr>.closure<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ClosureExpression" onclick="show_railroad()"><a href="#railroad-ClosureExpression">ClosureExpression</a></span> → <br>    <span class="grammar-literal">async</span><sup>?</sup>​<sup class="footnote-reference" id="fr-cl-async-edition-1"><a href="#footnote-cl-async-edition">1</a></sup> <br>    <span class="grammar-literal">move</span><sup>?</sup> <br>    ( <span class="grammar-literal">||</span> | <span class="grammar-literal">|</span> <span class="grammar-text"><a href="#grammar-ClosureParameters">ClosureParameters</a></span><sup>?</sup> <span class="grammar-literal">|</span> ) <br>    ( <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> | <span class="grammar-literal">-&gt;</span> <span class="grammar-text"><a href="#grammar-TypeNoBounds">TypeNoBounds</a></span> <span class="grammar-text"><a href="#grammar-BlockExpression">BlockExpression</a></span> )</p>
<p><span class="grammar-text grammar-production" id="grammar-ClosureParameters" onclick="show_railroad()"><a href="#railroad-ClosureParameters">ClosureParameters</a></span> → <span class="grammar-text"><a href="#grammar-ClosureParam">ClosureParam</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-ClosureParam">ClosureParam</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-ClosureParam" onclick="show_railroad()"><a href="#railroad-ClosureParam">ClosureParam</a></span> → <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> <span class="grammar-text"><a href="#grammar-PatternNoTopAlt">PatternNoTopAlt</a></span> ( <span class="grammar-literal">:</span> <span class="grammar-text"><a href="#grammar-Type">Type</a></span> )<sup>?</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 466px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ClosureExpression"><svg class="railroad" viewbox="0 0 466 320" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ClosureExpression">
<text class="comment" x="74" y="25">
ClosureExpression</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="stack">
<path d=" M 35 66 h 12" />
<path d=" M 155 66 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 h -108 m 57 0 l 5 -5 m 0 10 l -5 -5 m -57 0 a 12 12 0 0 0 -12 12 v 12 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="optional">
<path d=" M 47 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 60 m -27 0 l -5 -5 m 0 10 l 5 -5 m 27 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="71" y="55" />
<text x="101" y="71">
async</text>
</g>
</g>
</g>
<path d=" M 147 126 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 h -100 m 53 0 l 5 -5 m 0 10 l -5 -5 m -53 0 a 12 12 0 0 0 -12 12 v 0 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="optional">
<path d=" M 47 126 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 52 m -23 0 l -5 -5 m 0 10 l 5 -5 m 23 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="71" y="115" />
<text x="97" y="131">
move</text>
</g>
</g>
</g>
<path d=" M 375 174 a 12 12 0 0 1 12 12 v 44 a 12 12 0 0 1 -12 12 h -328 m 167 0 l 5 -5 m 0 10 l -5 -5 m -167 0 a 12 12 0 0 0 -12 12 v 0 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="choice">
<path d=" M 47 174 h 24 m 36 0 h 268 m -131 0 l -5 -5 m 0 10 l 5 -5 m 131 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="71" y="163" />
<text x="89" y="179">
||</text>
</g>
<path d=" M 47 174 a 12 12 0 0 1 12 12 v 9 m 304 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 59 195 v 12 a 12 12 0 0 0 12 12 m 280 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="71" y="208" />
<text x="85" y="224">
|</text>
</g>
<g class="optional">
<path d=" M 109 219 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-ClosureParameters">
<g class="nonterminal">
<rect height="22" width="156" x="133" y="208" />
<text x="211" y="224">
ClosureParameters</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="323" y="208" />
<text x="337" y="224">
|</text>
</g>
<path d=" M 99 219 h 10" />
<path d=" M 313 219 h 10" />
</g>
</g>
</g>
<path d=" M 407 266 h 0 a 12 12 0 0 0 12 -12 v -176 m 0 91 l -5 5 m 10 0 l -5 -5 m 0 -91 a 12 12 0 0 1 12 -12" />
<g class="sequence">
<g class="choice">
<path d=" M 47 266 h 24 m 100 0 h 236 m -115 0 l -5 -5 m 0 10 l 5 -5 m 115 0" />
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="71" y="255" />
<text x="121" y="271">
Expression</text>
</g>
</a>
<path d=" M 47 266 a 12 12 0 0 1 12 12 v 9 m 336 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 59 287 v 0 a 12 12 0 0 0 12 12 m 312 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="71" y="288" />
<text x="89" y="304">
-&gt;</text>
</g>
<a class="link" xlink:href="#railroad-TypeNoBounds">
<g class="nonterminal">
<rect height="22" width="116" x="117" y="288" />
<text x="175" y="304">
TypeNoBounds</text>
</g>
</a>
<a class="link" xlink:href="#railroad-BlockExpression">
<g class="nonterminal">
<rect height="22" width="140" x="243" y="288" />
<text x="313" y="304">
BlockExpression</text>
</g>
</a>
<path d=" M 107 299 h 10" />
<path d=" M 233 299 h 10" />
</g>
</g>
</g>
</g>
<path d=" M 441 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 431 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 508px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ClosureParameters"><svg class="railroad" viewbox="0 0 508 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ClosureParameters">
<text class="comment" x="74" y="25">
ClosureParameters</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ClosureParam">
<g class="nonterminal">
<rect height="22" width="116" x="35" y="55" />
<text x="93" y="71">
ClosureParam</text>
</g>
</a>
<g class="optional">
<path d=" M 161 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 178 m -86 0 l -5 -5 m 0 10 l 5 -5 m 86 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 185 66 h 12 m 154 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -154 m 80 0 l 5 -5 m 0 10 l -5 -5 m -80 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="197" y="55" />
<text x="211" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-ClosureParam">
<g class="nonterminal">
<rect height="22" width="116" x="235" y="55" />
<text x="293" y="71">
ClosureParam</text>
</g>
</a>
<path d=" M 225 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 397 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="421" y="55" />
<text x="435" y="71">
,</text>
</g>
</g>
<path d=" M 151 66 h 10" />
<path d=" M 387 66 h 10" />
</g>
<path d=" M 483 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 473 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 572px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ClosureParam"><svg class="railroad" viewbox="0 0 572 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ClosureParam">
<text class="comment" x="57" y="25">
ClosureParam</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<a class="link" xlink:href="#railroad-PatternNoTopAlt">
<g class="nonterminal">
<rect height="22" width="140" x="249" y="55" />
<text x="319" y="71">
PatternNoTopAlt</text>
</g>
</a>
<g class="optional">
<path d=" M 399 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 90 m -42 0 l -5 -5 m 0 10 l 5 -5 m 42 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="423" y="55" />
<text x="437" y="71">
:</text>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="461" y="55" />
<text x="487" y="71">
Type</text>
</g>
</a>
<path d=" M 451 66 h 10" />
</g>
</g>
<path d=" M 239 66 h 10" />
<path d=" M 389 66 h 10" />
</g>
<path d=" M 547 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 537 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.closure.intro"><a class="rule-link" href="#r-expr.closure.intro" title="expr.closure.intro"><span>[expr<wbr>.closure<wbr>.intro]</span></a>
</div>

<p>一个 <em>闭包表达式</em> ，也称为 lambda 表达式或 lambda，定义了一个 <a href="#闭包类型">闭包类型</a> 并求值为该类型的一个值。
闭包表达式的 语法格式 是一个可选的 <code>async</code> 关键字，一个可选的 <code>move</code> 关键字，然后是由管道符号（<code>|</code>）分隔的逗号分隔的 <a href="#模式">模式</a> 列表（称为 <em>闭包参数</em> ），每个参数后面可以可选地跟着 <code>:</code> 和一个类型，然后是一个可选的 <code>-&gt;</code> 和一个类型（称为 <em>返回类型</em> ），最后是一个表达式（称为 <em>闭包体操作数</em> ）。</p>
<div class="rule" id="r-expr.closure.param-type"><a class="rule-link" href="#r-expr.closure.param-type" title="expr.closure.param-type"><span>[expr<wbr>.closure<wbr>.param-type]</span></a>
</div>

<p>每个模式后的可选类型是该模式的类型标注。</p>
<div class="rule" id="r-expr.closure.explicit-type-body"><a class="rule-link" href="#r-expr.closure.explicit-type-body" title="expr.closure.explicit-type-body"><span>[expr<wbr>.closure<wbr>.explicit-type-body]</span></a>
</div>

<p>如果有返回类型，闭包体必须是一个 <a href="#块表达式">块</a>。</p>
<div class="rule" id="r-expr.closure.parameter-restriction"><a class="rule-link" href="#r-expr.closure.parameter-restriction" title="expr.closure.parameter-restriction"><span>[expr<wbr>.closure<wbr>.parameter-restriction]</span></a>
</div>

<p>闭包表达式表示一个函数，它将参数列表映射到参数之后的表达式上。
就像 <a href="#let-statements"><code>let</code> 绑定</a> 一样，闭包参数是不可反驳的 <a href="#模式">模式</a>，其类型标注是可选的，如果未给出，将从上下文中推导。</p>
<div class="rule" id="r-expr.closure.unique-type"><a class="rule-link" href="#r-expr.closure.unique-type" title="expr.closure.unique-type"><span>[expr<wbr>.closure<wbr>.unique-type]</span></a>
</div>

<p>每个闭包表达式都有一个唯一的、匿名的类型。</p>
<div class="rule" id="r-expr.closure.captures"><a class="rule-link" href="#r-expr.closure.captures" title="expr.closure.captures"><span>[expr<wbr>.closure<wbr>.captures]</span></a>
</div>

<p>重要的是，闭包表达式会 <em>捕获其环境</em> ，而普通的 <a href="#函数">函数定义</a> 则不会。</p>
<div class="rule" id="r-expr.closure.capture-inference"><a class="rule-link" href="#r-expr.closure.capture-inference" title="expr.closure.capture-inference"><span>[expr<wbr>.closure<wbr>.capture-inference]</span></a>
</div>

<p>如果没有 <code>move</code> 关键字，闭包表达式会 <a href="#capture-modes">推导它如何从其环境中捕获每个变量</a>，优先通过共享引用进行捕获，从而实际上借用了闭包体内提到的所有外部变量。</p>
<div class="rule" id="r-expr.closure.capture-mut-ref"><a class="rule-link" href="#r-expr.closure.capture-mut-ref" title="expr.closure.capture-mut-ref"><span>[expr<wbr>.closure<wbr>.capture-mut-ref]</span></a>
</div>

<p>如果需要，编译器将推导应该采用可变引用，或者应该从环境中移动或复制值（取决于它们的类型）。</p>
<div class="rule" id="r-expr.closure.capture-move"><a class="rule-link" href="#r-expr.closure.capture-move" title="expr.closure.capture-move"><span>[expr<wbr>.closure<wbr>.capture-move]</span></a>
</div>

<p>通过在闭包前加上 <code>move</code> 关键字，可以强制闭包通过复制或移动值来捕获其环境。
这通常用于确保闭包的生命周期是 <code>'static</code>。</p>
<div class="rule" id="r-expr.closure.trait-impl"><a class="rule-link" href="#r-expr.closure.trait-impl" title="expr.closure.trait-impl"><span>[expr<wbr>.closure<wbr>.trait-impl]</span></a>
</div>

<h2 id="闭包特型实现"><a class="header" href="#闭包特型实现">闭包特型实现</a></h2>
<p>闭包类型实现哪些特型取决于变量如何被捕获、被捕获变量的类型以及 <code>async</code> 的存在。
有关闭包如何以及何时实现 <code>Fn</code>、<code>FnMut</code> 和 <code>FnOnce</code>，请参见 <a href="#call-traits-and-coercions">调用特型与强转</a> 章节。
如果每个被捕获变量的类型也都实现了该特型，则闭包类型就会实现 <a href="#send"><code>Send</code></a> 和 <a href="#sync"><code>Sync</code></a>。</p>
<div class="rule" id="r-expr.closure.async"><a class="rule-link" href="#r-expr.closure.async" title="expr.closure.async"><span>[expr<wbr>.closure<wbr>.async]</span></a>
</div>

<h2 id="async闭包"><a class="header" href="#async闭包">Async闭包</a></h2>
<div class="rule" id="r-expr.closure.async.intro"><a class="rule-link" href="#r-expr.closure.async.intro" title="expr.closure.async.intro"><span>[expr<wbr>.closure<wbr>.async<wbr>.intro]</span></a>
</div>

<p>带有 <code>async</code> 关键字标记的闭包表示它们是异步的，其方式类似于 <a href="#r-items.fn.async">异步函数</a>。</p>
<div class="rule" id="r-expr.closure.async.future"><a class="rule-link" href="#r-expr.closure.async.future" title="expr.closure.async.future"><span>[expr<wbr>.closure<wbr>.async<wbr>.future]</span></a>
</div>

<p>调用 Async 闭包不会执行任何工作，而是求值为一个实现了 <a href="../core/future/future/trait.Future.html"><code>Future</code></a> 的值，该值对应于闭包体的计算。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>async fn takes_async_callback(f: impl AsyncFn(u64)) {
    f(0).await;
    f(1).await;
}

async fn example() {
    takes_async_callback(async |i| {
        core::future::ready(i).await;
        println!("done with {i}.");
    }).await;
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.closure.async.edition2018"><a class="rule-link" href="#r-expr.closure.async.edition2018" title="expr.closure.async.edition2018"><span>[expr<wbr>.closure<wbr>.async<wbr>.edition2018]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p>Async 闭包仅从 Rust 2018 版次开始可用。</p>
</blockquote>
</div>

<h2 id="示例-3"><a class="header" href="#示例-3">示例</a></h2>
<p>在此示例中，我们定义了一个函数 <code>ten_times</code>，它接受一个高阶函数参数，然后我们使用闭包表达式作为参数来调用它，随后是一个从其环境移动值的闭包表达式。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn ten_times&lt;F&gt;(f: F) where F: Fn(i32) {
    for index in 0..10 {
        f(index);
    }
}

ten_times(|j| println!("hello, {}", j));
// 带有类型标注
ten_times(|j: i32| -&gt; () { println!("hello, {}", j) });

let word = "konnichiwa".to_owned();
ten_times(move |j| println!("{}, {}", word, j));
<span class="boring">}</span></code></pre>
<h2 id="闭包参数上的属性"><a class="header" href="#闭包参数上的属性">闭包参数上的属性</a></h2>
<div class="rule" id="r-expr.closure.param-attributes"><a class="rule-link" href="#r-expr.closure.param-attributes" title="expr.closure.param-attributes"><span>[expr<wbr>.closure<wbr>.param-attributes]</span></a>
</div>

<p>闭包参数上的属性遵循与 <a href="#attributes-on-function-parameters">普通函数参数</a> 相同的规则和限制。</p>
<hr>
<ol class="footnote-definition">
<li id="footnote-cl-async-edition">
<p><code>async</code> 限定符在 2015 版次中不允许使用。 <a href="#fr-cl-async-edition-1">↩</a></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr.loop"><a class="rule-link" href="#r-expr.loop" title="expr.loop"><span>[expr<wbr>.loop]</span></a>
</div>

<h1 id="循环及其他可中断表达式"><a class="header" href="#循环及其他可中断表达式">循环及其他可中断表达式</a></h1>
<div class="rule" id="r-expr.loop.syntax"><a class="rule-link" href="#r-expr.loop.syntax" title="expr.loop.syntax"><span>[expr<wbr>.loop<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-LoopExpression" onclick="show_railroad()"><a href="#railroad-LoopExpression">LoopExpression</a></span> → <br>    <span class="grammar-text"><a href="#grammar-LoopLabel">LoopLabel</a></span><sup>?</sup> ( <br>        <span class="grammar-text"><a href="#grammar-InfiniteLoopExpression">InfiniteLoopExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-PredicateLoopExpression">PredicateLoopExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-IteratorLoopExpression">IteratorLoopExpression</a></span> <br>      | <span class="grammar-text"><a href="#grammar-LabelBlockExpression">LabelBlockExpression</a></span> <br>    )</p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 480px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-LoopExpression"><svg class="railroad" viewbox="0 0 480 186" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-LoopExpression">
<text class="comment" x="64" y="25">
LoopExpression</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 92 m -43 0 l -5 -5 m 0 10 l 5 -5 m 43 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-LoopLabel">
<g class="nonterminal">
<rect height="22" width="92" x="59" y="55" />
<text x="105" y="71">
LoopLabel</text>
</g>
</a>
</g>
<g class="choice">
<path d=" M 185 66 h 24 m 204 0 h 32" />
<g class="sequence">
<a class="link" xlink:href="#railroad-InfiniteLoopExpression">
<g class="nonterminal">
<rect height="22" width="204" x="209" y="55" />
<text x="311" y="71">
InfiniteLoopExpression</text>
</g>
</a>
</g>
<path d=" M 185 66 a 12 12 0 0 1 12 12 v 9 m 236 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 197 87 v 33 m 236 0 v -33" />
<path d=" M 197 120 v 33 m 236 0 v -33" />
<path d=" M 197 87 v 0 a 12 12 0 0 0 12 12 m 212 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-PredicateLoopExpression">
<g class="nonterminal">
<rect height="22" width="212" x="209" y="88" />
<text x="315" y="104">
PredicateLoopExpression</text>
</g>
</a>
</g>
<path d=" M 197 120 v 0 a 12 12 0 0 0 12 12 m 204 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IteratorLoopExpression">
<g class="nonterminal">
<rect height="22" width="204" x="209" y="121" />
<text x="311" y="137">
IteratorLoopExpression</text>
</g>
</a>
</g>
<path d=" M 197 153 v 0 a 12 12 0 0 0 12 12 m 188 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-LabelBlockExpression">
<g class="nonterminal">
<rect height="22" width="188" x="209" y="154" />
<text x="303" y="170">
LabelBlockExpression</text>
</g>
</a>
</g>
</g>
<path d=" M 175 66 h 10" />
</g>
<path d=" M 455 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 445 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.loop.intro"><a class="rule-link" href="#r-expr.loop.intro" title="expr.loop.intro"><span>[expr<wbr>.loop<wbr>.intro]</span></a>
</div>

<p>Rust 支持四种循环表达式：</p>
<ul>
<li><a href="#infinite-loops"><code>loop</code> 表达式</a> 表示一个无限循环。</li>
<li><a href="#predicate-loops"><code>while</code> 表达式</a> 循环直到谓词为假。</li>
<li><a href="#iterator-loops"><code>for</code> 表达式</a> 从迭代器中提取值，循环直到迭代器为空。</li>
<li><a href="#r-expr.loop.block-labels">标签块表达式</a> 正好运行一次，但允许使用 <code>break</code> 提前退出。</li>
</ul>
<div class="rule" id="r-expr.loop.break-label"><a class="rule-link" href="#r-expr.loop.break-label" title="expr.loop.break-label"><span>[expr<wbr>.loop<wbr>.break-label]</span></a>
</div>

<p>所有四种类型的循环都支持 <a href="#break-expressions"><code>break</code> 表达式</a> 和 <a href="#loop-labels">标签</a>。</p>
<div class="rule" id="r-expr.loop.continue-label"><a class="rule-link" href="#r-expr.loop.continue-label" title="expr.loop.continue-label"><span>[expr<wbr>.loop<wbr>.continue-label]</span></a>
</div>

<p>除标签块表达式外，所有表达式都支持 <a href="#continue-expressions"><code>continue</code> 表达式</a>。</p>
<div class="rule" id="r-expr.loop.explicit-result"><a class="rule-link" href="#r-expr.loop.explicit-result" title="expr.loop.explicit-result"><span>[expr<wbr>.loop<wbr>.explicit-result]</span></a>
</div>

<p>只有 <code>loop</code> 和标签块表达式支持 <a href="#break-and-loop-values">求值为非平凡值</a>。</p>
<div class="rule" id="r-expr.loop.infinite"><a class="rule-link" href="#r-expr.loop.infinite" title="expr.loop.infinite"><span>[expr<wbr>.loop<wbr>.infinite]</span></a>
</div>

<h2 id="无限循环"><a class="header" href="#无限循环">无限循环</a></h2>
<div class="rule" id="r-expr.loop.infinite.syntax"><a class="rule-link" href="#r-expr.loop.infinite.syntax" title="expr.loop.infinite.syntax"><span>[expr<wbr>.loop<wbr>.infinite<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-InfiniteLoopExpression" onclick="show_railroad()"><a href="#railroad-InfiniteLoopExpression">InfiniteLoopExpression</a></span> → <span class="grammar-literal">loop</span> <span class="grammar-text"><a href="#grammar-BlockExpression">BlockExpression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 272px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-InfiniteLoopExpression"><svg class="railroad" viewbox="0 0 272 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-InfiniteLoopExpression">
<text class="comment" x="95" y="25">
InfiniteLoopExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="35" y="42" />
<text x="61" y="58">
loop</text>
</g>
<a class="link" xlink:href="#railroad-BlockExpression">
<g class="nonterminal">
<rect height="22" width="140" x="97" y="42" />
<text x="167" y="58">
BlockExpression</text>
</g>
</a>
<path d=" M 87 53 h 10" />
</g>
<path d=" M 247 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 237 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.loop.infinite.intro"><a class="rule-link" href="#r-expr.loop.infinite.intro" title="expr.loop.infinite.intro"><span>[expr<wbr>.loop<wbr>.infinite<wbr>.intro]</span></a>
</div>

<p><code>loop</code> 表达式连续重复执行其主体：
<code>loop { println!("I live."); }</code>。</p>
<div class="rule" id="r-expr.loop.infinite.diverging"><a class="rule-link" href="#r-expr.loop.infinite.diverging" title="expr.loop.infinite.diverging"><span>[expr<wbr>.loop<wbr>.infinite<wbr>.diverging]</span></a>
</div>

<p>没有关联 <code>break</code> 表达式的 <code>loop</code> 表达式是发散的，其类型为 <a href="#never类型"><code>!</code></a>。</p>
<div class="rule" id="r-expr.loop.infinite.break"><a class="rule-link" href="#r-expr.loop.infinite.break" title="expr.loop.infinite.break"><span>[expr<wbr>.loop<wbr>.infinite<wbr>.break]</span></a>
</div>

<p>包含关联 <a href="#break-expressions"><code>break</code> 表达式</a> 的 <code>loop</code> 表达式可能会终止，并且其类型必须与 <code>break</code> 表达式的值兼容。</p>
<div class="rule" id="r-expr.loop.while"><a class="rule-link" href="#r-expr.loop.while" title="expr.loop.while"><span>[expr<wbr>.loop<wbr>.while]</span></a>
</div>

<h2 id="谓词循环"><a class="header" href="#谓词循环">谓词循环</a></h2>
<div class="rule" id="r-expr.loop.while.grammar"><a class="rule-link" href="#r-expr.loop.while.grammar" title="expr.loop.while.grammar"><span>[expr<wbr>.loop<wbr>.while<wbr>.grammar]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-PredicateLoopExpression" onclick="show_railroad()"><a href="#railroad-PredicateLoopExpression">PredicateLoopExpression</a></span> → <span class="grammar-literal">while</span> <span class="grammar-text"><a href="#grammar-Conditions">Conditions</a></span> <span class="grammar-text"><a href="#grammar-BlockExpression">BlockExpression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 390px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-PredicateLoopExpression"><svg class="railroad" viewbox="0 0 390 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-PredicateLoopExpression">
<text class="comment" x="99" y="25">
PredicateLoopExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="35" y="42" />
<text x="65" y="58">
while</text>
</g>
<a class="link" xlink:href="#railroad-Conditions">
<g class="nonterminal">
<rect height="22" width="100" x="105" y="42" />
<text x="155" y="58">
Conditions</text>
</g>
</a>
<a class="link" xlink:href="#railroad-BlockExpression">
<g class="nonterminal">
<rect height="22" width="140" x="215" y="42" />
<text x="285" y="58">
BlockExpression</text>
</g>
</a>
<path d=" M 95 53 h 10" />
<path d=" M 205 53 h 10" />
</g>
<path d=" M 365 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 355 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.loop.while.intro"><a class="rule-link" href="#r-expr.loop.while.intro" title="expr.loop.while.intro"><span>[expr<wbr>.loop<wbr>.while<wbr>.intro]</span></a>
</div>

<p><code>while</code> 循环表达式允许在条件集保持为真的情况下重复求值一个块。</p>
<div class="rule" id="r-expr.loop.while.syntax"><a class="rule-link" href="#r-expr.loop.while.syntax" title="expr.loop.while.syntax"><span>[expr<wbr>.loop<wbr>.while<wbr>.syntax]</span></a>
</div>

<p><code>while</code> 表达式的 语法格式 是一个或多个由 <code>&amp;&amp;</code> 分隔的条件操作数序列，后跟一个 <a href="#grammar-BlockExpression">块表达式</a>。</p>
<div class="rule" id="r-expr.loop.while.condition"><a class="rule-link" href="#r-expr.loop.while.condition" title="expr.loop.while.condition"><span>[expr<wbr>.loop<wbr>.while<wbr>.condition]</span></a>
</div>

<p>条件操作数必须是具有 <a href="#布尔类型">布尔类型</a> 的 <a href="#grammar-Expression">表达式</a> 或条件 <code>let</code> 匹配。
如果所有条件操作数求值结果均为 <code>true</code>，且所有 <code>let</code> 模式都成功匹配其 <a href="#scrutinee">待匹配值</a>，则执行循环体块。</p>
<div class="rule" id="r-expr.loop.while.repeat"><a class="rule-link" href="#r-expr.loop.while.repeat" title="expr.loop.while.repeat"><span>[expr<wbr>.loop<wbr>.while<wbr>.repeat]</span></a>
</div>

<p>在循环体成功执行后，会重新求值条件操作数，以确定是否应再次执行主体。</p>
<div class="rule" id="r-expr.loop.while.exit"><a class="rule-link" href="#r-expr.loop.while.exit" title="expr.loop.while.exit"><span>[expr<wbr>.loop<wbr>.while<wbr>.exit]</span></a>
</div>

<p>如果任何条件操作数求值为 <code>false</code> 或任何 <code>let</code> 模式未匹配其待匹配值，则不执行主体，并在 <code>while</code> 表达式之后继续执行。</p>
<div class="rule" id="r-expr.loop.while.eval"><a class="rule-link" href="#r-expr.loop.while.eval" title="expr.loop.while.eval"><span>[expr<wbr>.loop<wbr>.while<wbr>.eval]</span></a>
</div>

<p>一个 <code>while</code> 表达式求值为 <code>()</code>。</p>
<p>示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut i = 0;

while i &lt; 10 {
    println!("hello");
    i = i + 1;
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.loop.while.let"><a class="rule-link" href="#r-expr.loop.while.let" title="expr.loop.while.let"><span>[expr<wbr>.loop<wbr>.while<wbr>.let]</span></a>
</div>

<h3 id="while-let模式"><a class="header" href="#while-let模式"><code>while let</code>模式</a></h3>
<div class="rule" id="r-expr.loop.while.let.intro"><a class="rule-link" href="#r-expr.loop.while.let.intro" title="expr.loop.while.let.intro"><span>[expr<wbr>.loop<wbr>.while<wbr>.let<wbr>.intro]</span></a>
</div>

<p><code>while</code> 条件中的 <code>let</code> 模式允许在模式匹配成功时将新变量绑定到作用域中。
以下示例演示了使用 <code>let</code> 模式进行的绑定：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut x = vec![1, 2, 3];

while let Some(y) = x.pop() {
    println!("y = {}", y);
}

while let _ = 5 {
    // 不可反驳模式总是为真
    println!("Irrefutable patterns are always true");
    break;
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.loop.while.let.desugar"><a class="rule-link" href="#r-expr.loop.while.let.desugar" title="expr.loop.while.let.desugar"><span>[expr<wbr>.loop<wbr>.while<wbr>.let<wbr>.desugar]</span></a>
</div>

<p><code>while let</code> 循环等效于包含 <a href="#match表达式"><code>match</code> 表达式</a> 的 <code>loop</code> 表达式，如下所示。</p>
<!-- ignore: expansion example -->
<pre><code class="language-rust ignore">'label: while let PATS = EXPR {
    /* 循环体 */
}</code></pre>
<p>等效于</p>
<!-- ignore: expansion example -->
<pre><code class="language-rust ignore">'label: loop {
    match EXPR {
        PATS =&gt; { /* 循环体 */ },
        _ =&gt; break,
    }
}</code></pre>
<div class="rule" id="r-expr.loop.while.let.or-pattern"><a class="rule-link" href="#r-expr.loop.while.let.or-pattern" title="expr.loop.while.let.or-pattern"><span>[expr<wbr>.loop<wbr>.while<wbr>.let<wbr>.or-pattern]</span></a>
</div>

<p>可以使用 <code>|</code> 运算符指定多个模式。这与 <code>match</code> 表达式中的 <code>|</code> 具有相同的语义：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut vals = vec![2, 3, 1, 2, 2];
while let Some(v @ 1) | Some(v @ 2) = vals.pop() {
    // 打印 2, 2, 然后是 1
    println!("{}", v);
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.loop.while.chains"><a class="rule-link" href="#r-expr.loop.while.chains" title="expr.loop.while.chains"><span>[expr<wbr>.loop<wbr>.while<wbr>.chains]</span></a>
</div>

<h3 id="while条件链"><a class="header" href="#while条件链"><code>while</code>条件链</a></h3>
<div class="rule" id="r-expr.loop.while.chains.intro"><a class="rule-link" href="#r-expr.loop.while.chains.intro" title="expr.loop.while.chains.intro"><span>[expr<wbr>.loop<wbr>.while<wbr>.chains<wbr>.intro]</span></a>
</div>

<p>多个条件操作数可以用 <code>&amp;&amp;</code> 分隔。这些与 <a href="#chains-of-conditions"><code>if</code> 条件链</a> 具有相同的语义和限制。</p>
<p>以下是一个链接多个表达式的示例，混合了 <code>let</code> 绑定和布尔表达式，并且表达式能够引用之前表达式中的模式绑定：</p>
<pre class="playground"><code class="language-rust edition2024">fn main() {
    let outer_opt = Some(Some(1i32));

    while let Some(inner_opt) = outer_opt
        &amp;&amp; let Some(number) = inner_opt
        &amp;&amp; number == 1
    {
        println!("Peek a boo");
        break;
    }
}</code></pre>
<div class="rule" id="r-expr.loop.for"><a class="rule-link" href="#r-expr.loop.for" title="expr.loop.for"><span>[expr<wbr>.loop<wbr>.for]</span></a>
</div>

<h2 id="迭代器循环"><a class="header" href="#迭代器循环">迭代器循环</a></h2>
<div class="rule" id="r-expr.loop.for.syntax"><a class="rule-link" href="#r-expr.loop.for.syntax" title="expr.loop.for.syntax"><span>[expr<wbr>.loop<wbr>.for<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-IteratorLoopExpression" onclick="show_railroad()"><a href="#railroad-IteratorLoopExpression">IteratorLoopExpression</a></span> → <br>    <span class="grammar-literal">for</span> <span class="grammar-text"><a href="#grammar-Pattern">Pattern</a></span> <span class="grammar-literal">in</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span><sub class="grammar-text">except <a href="#grammar-StructExpression">StructExpression</a></sub> <span class="grammar-text"><a href="#grammar-BlockExpression">BlockExpression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 600px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-IteratorLoopExpression"><svg class="railroad" viewbox="0 0 600 118" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-IteratorLoopExpression">
<text class="comment" x="95" y="25">
IteratorLoopExpression</text>
</a>
<g class="sequence">
<path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="78" />
<text x="57" y="94">
for</text>
</g>
<a class="link" xlink:href="#railroad-Pattern">
<g class="nonterminal">
<rect height="22" width="76" x="89" y="78" />
<text x="127" y="94">
Pattern</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="175" y="78" />
<text x="193" y="94">
in</text>
</g>
<g class="labeledbox">
<rect height="66" width="194" x="221" y="42" />
<path d=" M 221 89 h 8 m 100 0 h 86 m -40 0 l -5 -5 m 0 10 l 5 -5 m 40 0" />
<text class="comment" x="318" y="65">
except StructExpression</text>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="229" y="78" />
<text x="279" y="94">
Expression</text>
</g>
</a>
</g>
<a class="link" xlink:href="#railroad-BlockExpression">
<g class="nonterminal">
<rect height="22" width="140" x="425" y="78" />
<text x="495" y="94">
BlockExpression</text>
</g>
</a>
<path d=" M 79 89 h 10" />
<path d=" M 165 89 h 10" />
<path d=" M 211 89 h 10" />
<path d=" M 415 89 h 10" />
</g>
<path d=" M 575 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 89 h 10" />
<path d=" M 565 89 h 10" />
</g>
</g>
</svg>
</div>

</div>

<!-- TODO: The exception above isn't accurate, see https://github.com/rust-lang/reference/issues/569 -->
<div class="rule" id="r-expr.loop.for.intro"><a class="rule-link" href="#r-expr.loop.for.intro" title="expr.loop.for.intro"><span>[expr<wbr>.loop<wbr>.for<wbr>.intro]</span></a>
</div>

<p>一个 <code>for</code> 表达式是一个用于循环遍历由 <code>std::iter::IntoIterator</code> 实现提供的元素的语法结构。</p>
<div class="rule" id="r-expr.loop.for.condition"><a class="rule-link" href="#r-expr.loop.for.condition" title="expr.loop.for.condition"><span>[expr<wbr>.loop<wbr>.for<wbr>.condition]</span></a>
</div>

<p>如果迭代器产生一个值，该值将与不可反驳模式匹配，执行循环体，然后控制流返回到 <code>for</code> 循环头部。
如果迭代器为空，则 <code>for</code> 表达式完成。</p>
<p>数组内容的 <code>for</code> 循环示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let v = &amp;["apples", "cake", "coffee"];

for text in v {
    println!("I like {}.", text);
}
<span class="boring">}</span></code></pre>
<p>一系列整数上的 <code>for</code> 循环示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut sum = 0;
for n in 1..11 {
    sum += n;
}
assert_eq!(sum, 55);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.loop.for.desugar"><a class="rule-link" href="#r-expr.loop.for.desugar" title="expr.loop.for.desugar"><span>[expr<wbr>.loop<wbr>.for<wbr>.desugar]</span></a>
</div>

<p><code>for</code> 循环等效于包含 <a href="#match表达式"><code>match</code> 表达式</a> 的 <code>loop</code> 表达式，如下所示：</p>
<!-- ignore: expansion example -->
<pre><code class="language-rust ignore">'label: for PATTERN in iter_expr {
    /* 循环体 */
}</code></pre>
<p>等效于</p>
<!-- ignore: expansion example -->
<pre><code class="language-rust ignore">{
    let result = match IntoIterator::into_iter(iter_expr) {
        mut iter =&gt; 'label: loop {
            let mut next;
            match Iterator::next(&amp;mut iter) {
                Option::Some(val) =&gt; next = val,
                Option::None =&gt; break,
            };
            let PATTERN = next;
            let () = { /* 循环体 */ };
        },
    };
    result
}</code></pre>
<div class="rule" id="r-expr.loop.for.lang-items"><a class="rule-link" href="#r-expr.loop.for.lang-items" title="expr.loop.for.lang-items"><span>[expr<wbr>.loop<wbr>.for<wbr>.lang-items]</span></a>
</div>

<p>这里的 <code>IntoIterator</code>、<code>Iterator</code> 和 <code>Option</code> 始终是标准库 项 ，而不是当前作用域中解析为这些名称的任何内容。</p>
<p>变量名 <code>next</code>、<code>iter</code> 和 <code>val</code> 仅用于说明，它们实际上没有用户可以键入的名称。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>外部 <code>match</code> 用于确保 <code>iter_expr</code> 中的任何 <a href="#temporaries">临时值</a> 在循环结束前不会被丢弃。<code>next</code> 在被赋值前声明，是因为这通常能让类型推导更准确。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.loop.label"><a class="rule-link" href="#r-expr.loop.label" title="expr.loop.label"><span>[expr<wbr>.loop<wbr>.label]</span></a>
</div>

<h2 id="循环标签"><a class="header" href="#循环标签">循环标签</a></h2>
<div class="rule" id="r-expr.loop.label.syntax"><a class="rule-link" href="#r-expr.loop.label.syntax" title="expr.loop.label.syntax"><span>[expr<wbr>.loop<wbr>.label<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-LoopLabel" onclick="show_railroad()"><a href="#railroad-LoopLabel">LoopLabel</a></span> → <span class="grammar-text"><a href="#grammar-LIFETIME_OR_LABEL">LIFETIME_OR_LABEL</a></span> <span class="grammar-literal">:</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 264px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-LoopLabel"><svg class="railroad" viewbox="0 0 264 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-LoopLabel">
<text class="comment" x="46" y="25">
LoopLabel</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-LIFETIME_OR_LABEL">
<g class="nonterminal">
<rect height="22" width="156" x="35" y="42" />
<text x="113" y="58">
LIFETIME_OR_LABEL</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="201" y="42" />
<text x="215" y="58">
:</text>
</g>
<path d=" M 191 53 h 10" />
</g>
<path d=" M 239 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 229 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.loop.label.intro"><a class="rule-link" href="#r-expr.loop.label.intro" title="expr.loop.label.intro"><span>[expr<wbr>.loop<wbr>.label<wbr>.intro]</span></a>
</div>

<p>循环表达式可以可选地带有一个 <em>标签</em>。标签写在循环表达式之前的生命周期，例如 <code>'foo: loop { break 'foo; }</code>、<code>'bar: while false {}</code>、<code>'humbug: for _ in 0..0 {}</code>。</p>
<div class="rule" id="r-expr.loop.label.control-flow"><a class="rule-link" href="#r-expr.loop.label.control-flow" title="expr.loop.label.control-flow"><span>[expr<wbr>.loop<wbr>.label<wbr>.control-flow]</span></a>
</div>

<p>如果存在标签，则嵌套在该循环内的带标签 <code>break</code> 和 <code>continue</code> 表达式可以退出该循环或返回到其头部。
参见 <a href="#break-expressions">break 表达式</a> 和 <a href="#continue-expressions">continue 表达式</a>。</p>
<div class="rule" id="r-expr.loop.label.ref"><a class="rule-link" href="#r-expr.loop.label.ref" title="expr.loop.label.ref"><span>[expr<wbr>.loop<wbr>.label<wbr>.ref]</span></a>
</div>

<p>标签遵循局部变量的 卫生性 和 遮蔽 规则。例如，这段代码将打印 “outer loop”：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>'a: loop {
    'a: loop {
        break 'a;
    }
    print!("outer loop");
    break 'a;
}
<span class="boring">}</span></code></pre>
<p><code>'_</code> 不是有效的循环标签。</p>
<div class="rule" id="r-expr.loop.break"><a class="rule-link" href="#r-expr.loop.break" title="expr.loop.break"><span>[expr<wbr>.loop<wbr>.break]</span></a>
</div>

<h2 id="break表达式"><a class="header" href="#break表达式"><code>break</code>表达式</a></h2>
<div class="rule" id="r-expr.loop.break.syntax"><a class="rule-link" href="#r-expr.loop.break.syntax" title="expr.loop.break.syntax"><span>[expr<wbr>.loop<wbr>.break<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-BreakExpression" onclick="show_railroad()"><a href="#railroad-BreakExpression">BreakExpression</a></span> → <span class="grammar-literal">break</span> <span class="grammar-text"><a href="#grammar-LIFETIME_OR_LABEL">LIFETIME_OR_LABEL</a></span><sup>?</sup> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span><sup>?</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 502px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-BreakExpression"><svg class="railroad" viewbox="0 0 502 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-BreakExpression">
<text class="comment" x="67" y="25">
BreakExpression</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="35" y="55" />
<text x="65" y="71">
break</text>
</g>
<g class="optional">
<path d=" M 105 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-LIFETIME_OR_LABEL">
<g class="nonterminal">
<rect height="22" width="156" x="129" y="55" />
<text x="207" y="71">
LIFETIME_OR_LABEL</text>
</g>
</a>
</g>
<g class="optional">
<path d=" M 319 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="343" y="55" />
<text x="393" y="71">
Expression</text>
</g>
</a>
</g>
<path d=" M 95 66 h 10" />
<path d=" M 309 66 h 10" />
</g>
<path d=" M 477 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 467 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.loop.break.intro"><a class="rule-link" href="#r-expr.loop.break.intro" title="expr.loop.break.intro"><span>[expr<wbr>.loop<wbr>.break<wbr>.intro]</span></a>
</div>

<p>当遇到 <code>break</code> 时，关联的循环体执行将立即终止，例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut last = 0;
for x in 1..100 {
    if x &gt; 12 {
        break;
    }
    last = x;
}
assert_eq!(last, 12);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.loop.break.label"><a class="rule-link" href="#r-expr.loop.break.label" title="expr.loop.break.label"><span>[expr<wbr>.loop<wbr>.break<wbr>.label]</span></a>
</div>

<p><code>break</code> 表达式通常与包围该 <code>break</code> 表达式的最内层 <code>loop</code>、<code>for</code> 或 <code>while</code> 循环相关联，
但可以使用 <a href="#loop-labels">标签</a> 来指定受影响的是哪个外层循环。
示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>'outer: loop {
    while true {
        break 'outer;
    }
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.loop.break.value"><a class="rule-link" href="#r-expr.loop.break.value" title="expr.loop.break.value"><span>[expr<wbr>.loop<wbr>.break<wbr>.value]</span></a>
</div>

<p><code>break</code> 表达式仅允许在循环体中使用，并具有 <code>break</code>、<code>break 'label</code> 或（<a href="#break-and-loop-values">见下文</a>）<code>break EXPR</code> 或 <code>break 'label EXPR</code> 形式之一。</p>
<div class="rule" id="r-expr.loop.block-labels"><a class="rule-link" href="#r-expr.loop.block-labels" title="expr.loop.block-labels"><span>[expr<wbr>.loop<wbr>.block-labels]</span></a>
</div>

<h2 id="标签块表达式-1"><a class="header" href="#标签块表达式-1">标签块表达式</a></h2>
<div class="rule" id="r-expr.loop.block-labels.syntax"><a class="rule-link" href="#r-expr.loop.block-labels.syntax" title="expr.loop.block-labels.syntax"><span>[expr<wbr>.loop<wbr>.block-labels<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-LabelBlockExpression" onclick="show_railroad()"><a href="#railroad-LabelBlockExpression">LabelBlockExpression</a></span> → <span class="grammar-text"><a href="#grammar-BlockExpression">BlockExpression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 210px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-LabelBlockExpression"><svg class="railroad" viewbox="0 0 210 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-LabelBlockExpression">
<text class="comment" x="88" y="25">
LabelBlockExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<a class="link" xlink:href="#railroad-BlockExpression">
<g class="nonterminal">
<rect height="22" width="140" x="35" y="42" />
<text x="105" y="58">
BlockExpression</text>
</g>
</a>
<path d=" M 185 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 175 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.loop.block-labels.intro"><a class="rule-link" href="#r-expr.loop.block-labels.intro" title="expr.loop.block-labels.intro"><span>[expr<wbr>.loop<wbr>.block-labels<wbr>.intro]</span></a>
</div>

<p>标签块表达式与块表达式完全一样，除了它们允许在块内使用 <code>break</code> 表达式。</p>
<div class="rule" id="r-expr.loop.block-labels.break"><a class="rule-link" href="#r-expr.loop.block-labels.break" title="expr.loop.block-labels.break"><span>[expr<wbr>.loop<wbr>.block-labels<wbr>.break]</span></a>
</div>

<p>与循环不同，标签块表达式中的 <code>break</code> 表达式 <em>必须</em> 带有标签（即标签不是可选的）。</p>
<div class="rule" id="r-expr.loop.block-labels.label-required"><a class="rule-link" href="#r-expr.loop.block-labels.label-required" title="expr.loop.block-labels.label-required"><span>[expr<wbr>.loop<wbr>.block-labels<wbr>.label-required]</span></a>
</div>

<p>类似地，标签块表达式 <em>必须</em> 以标签开头。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn do_thing() {}
</span><span class="boring">fn condition_not_met() -&gt; bool { true }
</span><span class="boring">fn do_next_thing() {}
</span><span class="boring">fn do_last_thing() {}
</span>let result = 'block: {
    do_thing();
    if condition_not_met() {
        break 'block 1;
    }
    do_next_thing();
    if condition_not_met() {
        break 'block 2;
    }
    do_last_thing();
    3
};
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.loop.continue"><a class="rule-link" href="#r-expr.loop.continue" title="expr.loop.continue"><span>[expr<wbr>.loop<wbr>.continue]</span></a>
</div>

<h2 id="continue表达式"><a class="header" href="#continue表达式"><code>continue</code>表达式</a></h2>
<div class="rule" id="r-expr.loop.continue.syntax"><a class="rule-link" href="#r-expr.loop.continue.syntax" title="expr.loop.continue.syntax"><span>[expr<wbr>.loop<wbr>.continue<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ContinueExpression" onclick="show_railroad()"><a href="#railroad-ContinueExpression">ContinueExpression</a></span> → <span class="grammar-literal">continue</span> <span class="grammar-text"><a href="#grammar-LIFETIME_OR_LABEL">LIFETIME_OR_LABEL</a></span><sup>?</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 368px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ContinueExpression"><svg class="railroad" viewbox="0 0 368 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ContinueExpression">
<text class="comment" x="78" y="25">
ContinueExpression</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="84" x="35" y="55" />
<text x="77" y="71">
continue</text>
</g>
<g class="optional">
<path d=" M 129 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-LIFETIME_OR_LABEL">
<g class="nonterminal">
<rect height="22" width="156" x="153" y="55" />
<text x="231" y="71">
LIFETIME_OR_LABEL</text>
</g>
</a>
</g>
<path d=" M 119 66 h 10" />
</g>
<path d=" M 343 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 333 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.loop.continue.intro"><a class="rule-link" href="#r-expr.loop.continue.intro" title="expr.loop.continue.intro"><span>[expr<wbr>.loop<wbr>.continue<wbr>.intro]</span></a>
</div>

<p>当遇到 <code>continue</code> 时，关联循环体的当前迭代将立即终止，将控制权返回给循环 <em>头部</em>。</p>
<div class="rule" id="r-expr.loop.continue.while"><a class="rule-link" href="#r-expr.loop.continue.while" title="expr.loop.continue.while"><span>[expr<wbr>.loop<wbr>.continue<wbr>.while]</span></a>
</div>

<p>在 <code>while</code> 循环的情况下，头部是控制循环的条件操作数。</p>
<div class="rule" id="r-expr.loop.continue.for"><a class="rule-link" href="#r-expr.loop.continue.for" title="expr.loop.continue.for"><span>[expr<wbr>.loop<wbr>.continue<wbr>.for]</span></a>
</div>

<p>在 <code>for</code> 循环的情况下，头部是控制循环的调用表达式。</p>
<div class="rule" id="r-expr.loop.continue.label"><a class="rule-link" href="#r-expr.loop.continue.label" title="expr.loop.continue.label"><span>[expr<wbr>.loop<wbr>.continue<wbr>.label]</span></a>
</div>

<p>与 <code>break</code> 一样，<code>continue</code> 通常与最内层包围的循环相关联，但 <code>continue 'label</code> 可用于指定受影响的循环。</p>
<div class="rule" id="r-expr.loop.continue.in-loop-only"><a class="rule-link" href="#r-expr.loop.continue.in-loop-only" title="expr.loop.continue.in-loop-only"><span>[expr<wbr>.loop<wbr>.continue<wbr>.in-loop-only]</span></a>
</div>

<p><code>continue</code> 表达式仅允许在循环体中使用。</p>
<div class="rule" id="r-expr.loop.break-value"><a class="rule-link" href="#r-expr.loop.break-value" title="expr.loop.break-value"><span>[expr<wbr>.loop<wbr>.break-value]</span></a>
</div>

<h2 id="break和循环值"><a class="header" href="#break和循环值"><code>break</code>和循环值</a></h2>
<div class="rule" id="r-expr.loop.break-value.intro"><a class="rule-link" href="#r-expr.loop.break-value.intro" title="expr.loop.break-value.intro"><span>[expr<wbr>.loop<wbr>.break-value<wbr>.intro]</span></a>
</div>

<p>当与 <code>loop</code> 关联时，break 表达式可用于通过 <code>break EXPR</code> 或 <code>break 'label EXPR</code> 形式从该循环返回一个值，其中 <code>EXPR</code> 是一个结果将从 <code>loop</code> 返回的表达式。
例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let (mut a, mut b) = (1, 1);
let result = loop {
    if b &gt; 10 {
        break b;
    }
    let c = a + b;
    a = b;
    b = c;
};
// 斐波那契数列中第一个大于 10 的数字：
assert_eq!(result, 13);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.loop.break-value.loop"><a class="rule-link" href="#r-expr.loop.break-value.loop" title="expr.loop.break-value.loop"><span>[expr<wbr>.loop<wbr>.break-value<wbr>.loop]</span></a>
</div>

<p>在 <code>loop</code> 有关联 <code>break</code> 的情况下，它不被认为是发散的，并且 <code>loop</code> 必须具有与每个 <code>break</code> 表达式兼容的类型。
没有表达式的 <code>break</code> 被认为等同于带有表达式 <code>()</code> 的 <code>break</code>。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr.range"><a class="rule-link" href="#r-expr.range" title="expr.range"><span>[expr<wbr>.range]</span></a>
</div>

<h1 id="范围表达式"><a class="header" href="#范围表达式">范围表达式</a></h1>
<div class="rule" id="r-expr.range.syntax"><a class="rule-link" href="#r-expr.range.syntax" title="expr.range.syntax"><span>[expr<wbr>.range<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-RangeExpression" onclick="show_railroad()"><a href="#railroad-RangeExpression">RangeExpression</a></span> → <br>      <span class="grammar-text"><a href="#grammar-RangeExpr">RangeExpr</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RangeFromExpr">RangeFromExpr</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RangeToExpr">RangeToExpr</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RangeFullExpr">RangeFullExpr</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RangeInclusiveExpr">RangeInclusiveExpr</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RangeToInclusiveExpr">RangeToInclusiveExpr</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-RangeExpr" onclick="show_railroad()"><a href="#railroad-RangeExpr">RangeExpr</a></span> → <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">..</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-RangeFromExpr" onclick="show_railroad()"><a href="#railroad-RangeFromExpr">RangeFromExpr</a></span> → <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">..</span></p>
<p><span class="grammar-text grammar-production" id="grammar-RangeToExpr" onclick="show_railroad()"><a href="#railroad-RangeToExpr">RangeToExpr</a></span> → <span class="grammar-literal">..</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-RangeFullExpr" onclick="show_railroad()"><a href="#railroad-RangeFullExpr">RangeFullExpr</a></span> → <span class="grammar-literal">..</span></p>
<p><span class="grammar-text grammar-production" id="grammar-RangeInclusiveExpr" onclick="show_railroad()"><a href="#railroad-RangeInclusiveExpr">RangeInclusiveExpr</a></span> → <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">..=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-RangeToInclusiveExpr" onclick="show_railroad()"><a href="#railroad-RangeToInclusiveExpr">RangeToInclusiveExpr</a></span> → <span class="grammar-literal">..=</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 306px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RangeExpression"><svg class="railroad" viewbox="0 0 306 239" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RangeExpression">
<text class="comment" x="67" y="25">
RangeExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 92 0 h 120 m -57 0 l -5 -5 m 0 10 l 5 -5 m 57 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RangeExpr">
<g class="nonterminal">
<rect height="22" width="92" x="59" y="42" />
<text x="105" y="58">
RangeExpr</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 212 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 212 0 v -33" />
<path d=" M 47 107 v 33 m 212 0 v -33" />
<path d=" M 47 140 v 33 m 212 0 v -33" />
<path d=" M 47 173 v 33 m 212 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 124 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RangeFromExpr">
<g class="nonterminal">
<rect height="22" width="124" x="59" y="75" />
<text x="121" y="91">
RangeFromExpr</text>
</g>
</a>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 108 0 h 80 m -37 0 l -5 -5 m 0 10 l 5 -5 m 37 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RangeToExpr">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="108" />
<text x="113" y="124">
RangeToExpr</text>
</g>
</a>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 124 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RangeFullExpr">
<g class="nonterminal">
<rect height="22" width="124" x="59" y="141" />
<text x="121" y="157">
RangeFullExpr</text>
</g>
</a>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 164 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RangeInclusiveExpr">
<g class="nonterminal">
<rect height="22" width="164" x="59" y="174" />
<text x="141" y="190">
RangeInclusiveExpr</text>
</g>
</a>
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 188 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-RangeToInclusiveExpr">
<g class="nonterminal">
<rect height="22" width="188" x="59" y="207" />
<text x="153" y="223">
RangeToInclusiveExpr</text>
</g>
</a>
</g>
<path d=" M 281 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 271 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 326px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RangeExpr"><svg class="railroad" viewbox="0 0 326 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RangeExpr">
<text class="comment" x="46" y="25">
RangeExpr</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="42" />
<text x="85" y="58">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="145" y="42" />
<text x="163" y="58">
..</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="191" y="42" />
<text x="241" y="58">
Expression</text>
</g>
</a>
<path d=" M 135 53 h 10" />
<path d=" M 181 53 h 10" />
</g>
<path d=" M 301 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 291 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 216px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RangeFromExpr"><svg class="railroad" viewbox="0 0 216 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RangeFromExpr">
<text class="comment" x="60" y="25">
RangeFromExpr</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="42" />
<text x="85" y="58">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="145" y="42" />
<text x="163" y="58">
..</text>
</g>
<path d=" M 135 53 h 10" />
</g>
<path d=" M 191 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 181 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 216px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RangeToExpr"><svg class="railroad" viewbox="0 0 216 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RangeToExpr">
<text class="comment" x="53" y="25">
RangeToExpr</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="42" />
<text x="53" y="58">
..</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="81" y="42" />
<text x="131" y="58">
Expression</text>
</g>
</a>
<path d=" M 71 53 h 10" />
</g>
<path d=" M 191 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 181 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 121px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RangeFullExpr"><svg class="railroad" viewbox="0 0 121 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RangeFullExpr">
<text class="comment" x="60" y="25">
RangeFullExpr</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="42" />
<text x="53" y="58">
..</text>
</g>
<path d=" M 81 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 71 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 334px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RangeInclusiveExpr"><svg class="railroad" viewbox="0 0 334 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RangeInclusiveExpr">
<text class="comment" x="78" y="25">
RangeInclusiveExpr</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="42" />
<text x="85" y="58">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="145" y="42" />
<text x="167" y="58">
..=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="199" y="42" />
<text x="249" y="58">
Expression</text>
</g>
</a>
<path d=" M 135 53 h 10" />
<path d=" M 189 53 h 10" />
</g>
<path d=" M 309 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 299 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 224px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RangeToInclusiveExpr"><svg class="railroad" viewbox="0 0 224 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RangeToInclusiveExpr">
<text class="comment" x="88" y="25">
RangeToInclusiveExpr</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="42" />
<text x="57" y="58">
..=</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="89" y="42" />
<text x="139" y="58">
Expression</text>
</g>
</a>
<path d=" M 79 53 h 10" />
</g>
<path d=" M 199 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 189 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.range.behavior"><a class="rule-link" href="#r-expr.range.behavior" title="expr.range.behavior"><span>[expr<wbr>.range<wbr>.behavior]</span></a>
</div>

<p><code>..</code> 和 <code>..=</code> 运算符将根据下表构造 <code>std::ops::Range</code> (或 <code>core::ops::Range</code>) 变体之一的对象：</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>产生式</th><th>语法格式</th><th>类型</th><th>范围</th></tr>
</thead>
<tbody>
<tr><td><a href="#grammar-RangeExpr">范围表达式</a></td><td>start<code>..</code>end</td><td><a href="../core/ops/range/struct.Range.html">std::ops::Range</a></td><td>start ≤ x &lt; end</td></tr>
<tr><td><a href="#grammar-RangeFromExpr">左闭范围表达式</a></td><td>start<code>..</code></td><td><a href="../core/ops/range/struct.RangeFrom.html">std::ops::RangeFrom</a></td><td>start ≤ x</td></tr>
<tr><td><a href="#grammar-RangeToExpr">右开范围表达式</a></td><td><code>..</code>end</td><td><a href="../core/ops/range/struct.RangeTo.html">std::ops::RangeTo</a></td><td>x &lt; end</td></tr>
<tr><td><a href="#grammar-RangeFullExpr">全范围表达式</a></td><td><code>..</code></td><td><a href="../core/ops/range/struct.RangeFull.html">std::ops::RangeFull</a></td><td>-</td></tr>
<tr><td><a href="#grammar-RangeInclusiveExpr">闭范围表达式</a></td><td>start<code>..=</code>end</td><td><a href="../core/ops/range/struct.RangeInclusive.html">std::ops::RangeInclusive</a></td><td>start ≤ x ≤ end</td></tr>
<tr><td><a href="#grammar-RangeToInclusiveExpr">右闭范围表达式</a></td><td><code>..=</code>end</td><td><a href="../core/ops/range/struct.RangeToInclusive.html">std::ops::RangeToInclusive</a></td><td>x ≤ end</td></tr>
</tbody>
</table>
</div>
<p>示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>1..2;   // std::ops::Range
3..;    // std::ops::RangeFrom
..4;    // std::ops::RangeTo
..;     // std::ops::RangeFull
5..=6;  // std::ops::RangeInclusive
..=7;   // std::ops::RangeToInclusive
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.range.equivalence"><a class="rule-link" href="#r-expr.range.equivalence" title="expr.range.equivalence"><span>[expr<wbr>.range<wbr>.equivalence]</span></a>
</div>

<p>以下表达式是等价的。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = std::ops::Range {start: 0, end: 10};
let y = 0..10;

assert_eq!(x, y);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.range.for"><a class="rule-link" href="#r-expr.range.for" title="expr.range.for"><span>[expr<wbr>.range<wbr>.for]</span></a>
</div>

<p>范围可以用于 <code>for</code> 循环：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>for i in 1..11 {
    println!("{}", i);
}
<span class="boring">}</span></code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr.if"><a class="rule-link" href="#r-expr.if" title="expr.if"><span>[expr<wbr>.if]</span></a>
</div>

<h1 id="if表达式"><a class="header" href="#if表达式"><code>if</code>表达式</a></h1>
<div class="rule" id="r-expr.if.syntax"><a class="rule-link" href="#r-expr.if.syntax" title="expr.if.syntax"><span>[expr<wbr>.if<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-IfExpression" onclick="show_railroad()"><a href="#railroad-IfExpression">IfExpression</a></span> → <br>    <span class="grammar-literal">if</span> <span class="grammar-text"><a href="#grammar-Conditions">Conditions</a></span> <span class="grammar-text"><a href="#grammar-BlockExpression">BlockExpression</a></span> <br>    ( <span class="grammar-literal">else</span> ( <span class="grammar-text"><a href="#grammar-BlockExpression">BlockExpression</a></span> | <span class="grammar-text"><a href="#grammar-IfExpression">IfExpression</a></span> ) )<sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-Conditions" onclick="show_railroad()"><a href="#railroad-Conditions">Conditions</a></span> → <br>      <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span><sub class="grammar-text">except <a href="#grammar-StructExpression">StructExpression</a></sub> <br>    | <span class="grammar-text"><a href="#grammar-LetChain">LetChain</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-LetChain" onclick="show_railroad()"><a href="#railroad-LetChain">LetChain</a></span> → <span class="grammar-text"><a href="#grammar-LetChainCondition">LetChainCondition</a></span> ( <span class="grammar-literal">&amp;&amp;</span> <span class="grammar-text"><a href="#grammar-LetChainCondition">LetChainCondition</a></span> )<sup>*</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-LetChainCondition" onclick="show_railroad()"><a href="#railroad-LetChainCondition">LetChainCondition</a></span> → <br>      <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span><sub class="grammar-text">except <a href="#grammar-ExcludedConditions">ExcludedConditions</a></sub> <br>    | <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> <span class="grammar-literal">let</span> <span class="grammar-text"><a href="#grammar-Pattern">Pattern</a></span> <span class="grammar-literal">=</span> <span class="grammar-text"><a href="#grammar-Scrutinee">Scrutinee</a></span><sub class="grammar-text">except <a href="#grammar-ExcludedConditions">ExcludedConditions</a></sub></p>
<p><span class="grammar-text grammar-production" id="grammar-ExcludedConditions" onclick="show_railroad()"><a href="#railroad-ExcludedConditions">ExcludedConditions</a></span> → <br>      <span class="grammar-text"><a href="#grammar-StructExpression">StructExpression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-LazyBooleanExpression">LazyBooleanExpression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RangeExpr">RangeExpr</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RangeFromExpr">RangeFromExpr</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RangeInclusiveExpr">RangeInclusiveExpr</a></span> <br>    | <span class="grammar-text"><a href="#grammar-AssignmentExpression">AssignmentExpression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-CompoundAssignmentExpression">CompoundAssignmentExpression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 674px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-IfExpression"><svg class="railroad" viewbox="0 0 674 120" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-IfExpression">
<text class="comment" x="57" y="25">
IfExpression</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="55" />
<text x="53" y="71">
if</text>
</g>
<a class="link" xlink:href="#railroad-Conditions">
<g class="nonterminal">
<rect height="22" width="100" x="81" y="55" />
<text x="131" y="71">
Conditions</text>
</g>
</a>
<a class="link" xlink:href="#railroad-BlockExpression">
<g class="nonterminal">
<rect height="22" width="140" x="191" y="55" />
<text x="261" y="71">
BlockExpression</text>
</g>
</a>
<g class="optional">
<path d=" M 341 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 250 m -122 0 l -5 -5 m 0 10 l 5 -5 m 122 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="365" y="55" />
<text x="391" y="71">
else</text>
</g>
<g class="choice">
<path d=" M 427 66 h 24 m 140 0 h 24" />
<a class="link" xlink:href="#railroad-BlockExpression">
<g class="nonterminal">
<rect height="22" width="140" x="451" y="55" />
<text x="521" y="71">
BlockExpression</text>
</g>
</a>
<path d=" M 427 66 a 12 12 0 0 1 12 12 v 9 m 164 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 439 87 v 0 a 12 12 0 0 0 12 12 m 116 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-IfExpression">
<g class="nonterminal">
<rect height="22" width="116" x="451" y="88" />
<text x="509" y="104">
IfExpression</text>
</g>
</a>
</g>
<path d=" M 417 66 h 10" />
</g>
</g>
<path d=" M 71 66 h 10" />
<path d=" M 181 66 h 10" />
<path d=" M 331 66 h 10" />
</g>
<path d=" M 649 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 639 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 312px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Conditions"><svg class="railroad" viewbox="0 0 312 151" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Conditions">
<text class="comment" x="50" y="25">
Conditions</text>
</a>
<g class="sequence">
<path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 89 h 24 m 194 0 h 24" />
<g class="sequence">
<g class="labeledbox">
<rect height="66" width="194" x="59" y="42" />
<path d=" M 59 89 h 8 m 100 0 h 86 m -40 0 l -5 -5 m 0 10 l 5 -5 m 40 0" />
<text class="comment" x="156" y="65">
except StructExpression</text>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="67" y="78" />
<text x="117" y="94">
Expression</text>
</g>
</a>
</g>
</g>
<path d=" M 35 89 a 12 12 0 0 1 12 12 v 17 m 218 0 v -17 a 12 12 0 0 1 12 -12" />
<path d=" M 47 118 v 0 a 12 12 0 0 0 12 12 m 84 0 h 110 m -52 0 l -5 -5 m 0 10 l 5 -5 m 52 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-LetChain">
<g class="nonterminal">
<rect height="22" width="84" x="59" y="119" />
<text x="101" y="135">
LetChain</text>
</g>
</a>
</g>
<path d=" M 287 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 89 h 10" />
<path d=" M 277 89 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 510px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-LetChain"><svg class="railroad" viewbox="0 0 510 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-LetChain">
<text class="comment" x="43" y="25">
LetChain</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-LetChainCondition">
<g class="nonterminal">
<rect height="22" width="156" x="35" y="55" />
<text x="113" y="71">
LetChainCondition</text>
</g>
</a>
<g class="optional">
<path d=" M 201 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 226 m -110 0 l -5 -5 m 0 10 l 5 -5 m 110 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 225 66 h 12 m 202 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -202 m 104 0 l 5 -5 m 0 10 l -5 -5 m -104 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="237" y="55" />
<text x="255" y="71">
&amp;&amp;</text>
</g>
<a class="link" xlink:href="#railroad-LetChainCondition">
<g class="nonterminal">
<rect height="22" width="156" x="283" y="55" />
<text x="361" y="71">
LetChainCondition</text>
</g>
</a>
<path d=" M 273 66 h 10" />
</g>
</g>
</g>
<path d=" M 191 66 h 10" />
</g>
<path d=" M 485 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 475 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 718px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-LetChainCondition"><svg class="railroad" viewbox="0 0 718 199" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-LetChainCondition">
<text class="comment" x="74" y="25">
LetChainCondition</text>
</a>
<g class="sequence">
<path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 89 h 24 m 208 0 h 416 m -205 0 l -5 -5 m 0 10 l 5 -5 m 205 0" />
<g class="sequence">
<g class="labeledbox">
<rect height="66" width="208" x="59" y="42" />
<path d=" M 59 89 h 8 m 100 0 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0" />
<text class="comment" x="163" y="65">
except ExcludedConditions</text>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="67" y="78" />
<text x="117" y="94">
Expression</text>
</g>
</a>
</g>
</g>
<path d=" M 35 89 a 12 12 0 0 1 12 12 v 17 m 624 0 v -17 a 12 12 0 0 1 12 -12" />
<path d=" M 47 118 v 35 a 12 12 0 0 0 12 12 m 600 0 h 0 a 12 12 0 0 0 12 -12 v -35" />
<g class="sequence">
<g class="optional">
<path d=" M 59 165 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 83 165 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="95" y="154" />
<text x="161" y="170">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="273" y="154" />
<text x="295" y="170">
let</text>
</g>
<a class="link" xlink:href="#railroad-Pattern">
<g class="nonterminal">
<rect height="22" width="76" x="327" y="154" />
<text x="365" y="170">
Pattern</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="413" y="154" />
<text x="427" y="170">
=</text>
</g>
<g class="labeledbox">
<rect height="66" width="208" x="451" y="118" />
<path d=" M 451 165 h 8 m 92 0 h 108 m -51 0 l -5 -5 m 0 10 l 5 -5 m 51 0" />
<text class="comment" x="555" y="141">
except ExcludedConditions</text>
<a class="link" xlink:href="#railroad-Scrutinee">
<g class="nonterminal">
<rect height="22" width="92" x="459" y="154" />
<text x="505" y="170">
Scrutinee</text>
</g>
</a>
</g>
<path d=" M 263 165 h 10" />
<path d=" M 317 165 h 10" />
<path d=" M 403 165 h 10" />
<path d=" M 441 165 h 10" />
</g>
</g>
<path d=" M 693 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 89 h 10" />
<path d=" M 683 89 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 370px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ExcludedConditions"><svg class="railroad" viewbox="0 0 370 272" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ExcludedConditions">
<text class="comment" x="78" y="25">
ExcludedConditions</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 148 0 h 128 m -61 0 l -5 -5 m 0 10 l 5 -5 m 61 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-StructExpression">
<g class="nonterminal">
<rect height="22" width="148" x="59" y="42" />
<text x="133" y="58">
StructExpression</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 276 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 276 0 v -33" />
<path d=" M 47 107 v 33 m 276 0 v -33" />
<path d=" M 47 140 v 33 m 276 0 v -33" />
<path d=" M 47 173 v 33 m 276 0 v -33" />
<path d=" M 47 206 v 33 m 276 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 196 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-LazyBooleanExpression">
<g class="nonterminal">
<rect height="22" width="196" x="59" y="75" />
<text x="157" y="91">
LazyBooleanExpression</text>
</g>
</a>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 92 0 h 160 m -77 0 l -5 -5 m 0 10 l 5 -5 m 77 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RangeExpr">
<g class="nonterminal">
<rect height="22" width="92" x="59" y="108" />
<text x="105" y="124">
RangeExpr</text>
</g>
</a>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 124 0 h 128 m -61 0 l -5 -5 m 0 10 l 5 -5 m 61 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RangeFromExpr">
<g class="nonterminal">
<rect height="22" width="124" x="59" y="141" />
<text x="121" y="157">
RangeFromExpr</text>
</g>
</a>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 164 0 h 88 m -41 0 l -5 -5 m 0 10 l 5 -5 m 41 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RangeInclusiveExpr">
<g class="nonterminal">
<rect height="22" width="164" x="59" y="174" />
<text x="141" y="190">
RangeInclusiveExpr</text>
</g>
</a>
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 188 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-AssignmentExpression">
<g class="nonterminal">
<rect height="22" width="188" x="59" y="207" />
<text x="153" y="223">
AssignmentExpression</text>
</g>
</a>
</g>
<path d=" M 47 239 v 0 a 12 12 0 0 0 12 12 m 252 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-CompoundAssignmentExpression">
<g class="nonterminal">
<rect height="22" width="252" x="59" y="240" />
<text x="185" y="256">
CompoundAssignmentExpression</text>
</g>
</a>
</g>
<path d=" M 345 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 335 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<!-- TODO: The struct exception above needs clarification, see https://github.com/rust-lang/reference/issues/1808
     The chain grammar could use some work, see https://github.com/rust-lang/reference/issues/1811
-->
<div class="rule" id="r-expr.if.intro"><a class="rule-link" href="#r-expr.if.intro" title="expr.if.intro"><span>[expr<wbr>.if<wbr>.intro]</span></a>
</div>

<p><code>if</code> 表达式的 语法格式 是一个或多个由 <code>&amp;&amp;</code> 分隔的条件操作数序列，后跟一个结果块、任意数量的 <code>else if</code> 条件和块，以及一个可选的尾随 <code>else</code> 块。</p>
<div class="rule" id="r-expr.if.condition"><a class="rule-link" href="#r-expr.if.condition" title="expr.if.condition"><span>[expr<wbr>.if<wbr>.condition]</span></a>
</div>

<p>条件操作数必须是具有 <a href="#布尔类型">布尔类型</a> 的 <a href="#grammar-Expression">表达式</a> 或条件 <code>let</code> 匹配。</p>
<div class="rule" id="r-expr.if.condition-true"><a class="rule-link" href="#r-expr.if.condition-true" title="expr.if.condition-true"><span>[expr<wbr>.if<wbr>.condition-true]</span></a>
</div>

<p>如果所有条件操作数求值结果均为 <code>true</code>，且所有 <code>let</code> 模式都成功匹配其 <a href="#scrutinee">待匹配值</a>，则执行结果块，并跳过任何后续的 <code>else if</code> 或 <code>else</code> 块。</p>
<div class="rule" id="r-expr.if.else-if"><a class="rule-link" href="#r-expr.if.else-if" title="expr.if.else-if"><span>[expr<wbr>.if<wbr>.else-if]</span></a>
</div>

<p>如果任何条件操作数求值为 <code>false</code> 或任何 <code>let</code> 模式未匹配其待匹配值，则跳过结果块，并对任何后续的 <code>else if</code> 条件求值。</p>
<div class="rule" id="r-expr.if.else"><a class="rule-link" href="#r-expr.if.else" title="expr.if.else"><span>[expr<wbr>.if<wbr>.else]</span></a>
</div>

<p>如果所有 <code>if</code> 和 <code>else if</code> 条件求值结果均为 <code>false</code> ，则执行任何 <code>else</code> 块。</p>
<div class="rule" id="r-expr.if.result"><a class="rule-link" href="#r-expr.if.result" title="expr.if.result"><span>[expr<wbr>.if<wbr>.result]</span></a>
</div>

<p>一个 <code>if</code> 表达式求值为所执行块的相同值，如果没有块被执行，则求值为 <code>()</code>。</p>
<div class="rule" id="r-expr.if.type"><a class="rule-link" href="#r-expr.if.type" title="expr.if.type"><span>[expr<wbr>.if<wbr>.type]</span></a>
</div>

<p>在一个 <code>if</code> 表达式中，所有情况下的类型必须相同。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">let x = 3;
</span>if x == 4 {
    println!("x is four");
} else if x == 3 {
    println!("x is three");
} else {
    println!("x is something else");
}

// `if` 可以用作表达式。
let y = if 12 * 15 &gt; 150 {
    "Bigger"
} else {
    "Smaller"
};
assert_eq!(y, "Bigger");
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.if.let"><a class="rule-link" href="#r-expr.if.let" title="expr.if.let"><span>[expr<wbr>.if<wbr>.let]</span></a>
</div>

<h2 id="if-let模式"><a class="header" href="#if-let模式"><code>if let</code>模式</a></h2>
<div class="rule" id="r-expr.if.let.intro"><a class="rule-link" href="#r-expr.if.let.intro" title="expr.if.let.intro"><span>[expr<wbr>.if<wbr>.let<wbr>.intro]</span></a>
</div>

<p><code>if</code> 条件中的 <code>let</code> 模式允许在模式匹配成功时将新变量绑定到作用域中。</p>
<p>以下示例演示了使用 <code>let</code> 模式进行的绑定：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let dish = ("Ham", "Eggs");

// 此主体将被跳过，因为模式被反驳了。
if let ("Bacon", b) = dish {
    println!("Bacon is served with {}", b);
} else {
    // 改为对该块求值。
    println!("No bacon will be served");
}

// 此主体将执行。
if let ("Ham", b) = dish {
    println!("Ham is served with {}", b);
}

if let _ = 5 {
    println!("Irrefutable patterns are always true");
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.if.let.or-pattern"><a class="rule-link" href="#r-expr.if.let.or-pattern" title="expr.if.let.or-pattern"><span>[expr<wbr>.if<wbr>.let<wbr>.or-pattern]</span></a>
</div>

<p>可以使用 <code>|</code> 运算符指定多个模式。这与 <a href="#match表达式"><code>match</code> 表达式</a> 中的 <code>|</code> 具有相同的语义：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum E {
    X(u8),
    Y(u8),
    Z(u8),
}
let v = E::Y(12);
if let E::X(n) | E::Y(n) = v {
    assert_eq!(n, 12);
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.if.chains"><a class="rule-link" href="#r-expr.if.chains" title="expr.if.chains"><span>[expr<wbr>.if<wbr>.chains]</span></a>
</div>

<h2 id="条件链"><a class="header" href="#条件链">条件链</a></h2>
<div class="rule" id="r-expr.if.chains.intro"><a class="rule-link" href="#r-expr.if.chains.intro" title="expr.if.chains.intro"><span>[expr<wbr>.if<wbr>.chains<wbr>.intro]</span></a>
</div>

<p>多个条件操作数可以用 <code>&amp;&amp;</code> 分隔。</p>
<div class="rule" id="r-expr.if.chains.order"><a class="rule-link" href="#r-expr.if.chains.order" title="expr.if.chains.order"><span>[expr<wbr>.if<wbr>.chains<wbr>.order]</span></a>
</div>

<p>类似于 <code>&amp;&amp;</code> <a href="#grammar-LazyBooleanExpression">惰性布尔表达式</a>，每个操作数从左到右求值，直到某个操作数求值为 <code>false</code> 或 <code>let</code> 匹配失败，此时后续操作数将不再求值。</p>
<div class="rule" id="r-expr.if.chains.bindings"><a class="rule-link" href="#r-expr.if.chains.bindings" title="expr.if.chains.bindings"><span>[expr<wbr>.if<wbr>.chains<wbr>.bindings]</span></a>
</div>

<p>每个模式的绑定都会被放入作用域中，以便后续的条件操作数和结果块使用。</p>
<p>以下是一个链接多个表达式的示例，混合了 <code>let</code> 绑定和布尔表达式，并且表达式能够引用之前表达式中的模式绑定：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn single() {
    let outer_opt = Some(Some(1i32));

    if let Some(inner_opt) = outer_opt
        &amp;&amp; let Some(number) = inner_opt
        &amp;&amp; number == 1
    {
        println!("Peek a boo");
    }
}
<span class="boring">}</span></code></pre>
<p>在不使用条件链的情况下，上述代码等效于：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn nested() {
    let outer_opt = Some(Some(1i32));

    if let Some(inner_opt) = outer_opt {
        if let Some(number) = inner_opt {
            if number == 1 {
                println!("Peek a boo");
            }
        }
    }
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.if.chains.or"><a class="rule-link" href="#r-expr.if.chains.or" title="expr.if.chains.or"><span>[expr<wbr>.if<wbr>.chains<wbr>.or]</span></a>
</div>

<p>如果任何条件操作数是 <code>let</code> 模式，由于与 <code>let</code> 待匹配值存在歧义和优先级关系，任何条件操作数都不能是 <code>||</code> <a href="#r-expr.bool-logic">惰性布尔运算符表达式</a>。如果需要 <code>||</code> 表达式，可以使用括号。例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">let foo = Some(123);
</span><span class="boring">let condition1 = true;
</span><span class="boring">let condition2 = false;
</span>// 此处需要括号。
if let Some(x) = foo &amp;&amp; (condition1 || condition2) { /*...*/ }
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.if.edition2024"><a class="rule-link" href="#r-expr.if.edition2024" title="expr.if.edition2024"><span>[expr<wbr>.if<wbr>.edition2024]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2024</span> 版次差异</p>

<p>在 2024 版次之前，不支持 let 链。也就是说，<code>if</code> 表达式中不允许使用 <a href="#grammar-LetChain">LetChain</a> 语法。</p>
</blockquote>
</div>

<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr.match"><a class="rule-link" href="#r-expr.match" title="expr.match"><span>[expr<wbr>.match]</span></a>
</div>

<h1 id="match表达式"><a class="header" href="#match表达式"><code>match</code>表达式</a></h1>
<div class="rule" id="r-expr.match.syntax"><a class="rule-link" href="#r-expr.match.syntax" title="expr.match.syntax"><span>[expr<wbr>.match<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-MatchExpression" onclick="show_railroad()"><a href="#railroad-MatchExpression">MatchExpression</a></span> → <br>    <span class="grammar-literal">match</span> <span class="grammar-text"><a href="#grammar-Scrutinee">Scrutinee</a></span> <span class="grammar-literal">{</span> <br>        <span class="grammar-text"><a href="#grammar-InnerAttribute">InnerAttribute</a></span><sup>*</sup> <br>        <span class="grammar-text"><a href="#grammar-MatchArms">MatchArms</a></span><sup>?</sup> <br>    <span class="grammar-literal">}</span></p>
<p><span class="grammar-text grammar-production" id="grammar-Scrutinee" onclick="show_railroad()"><a href="#railroad-Scrutinee">Scrutinee</a></span> → <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span><sub class="grammar-text">except <a href="#grammar-StructExpression">StructExpression</a></sub></p>
<p><span class="grammar-text grammar-production" id="grammar-MatchArms" onclick="show_railroad()"><a href="#railroad-MatchArms">MatchArms</a></span> → <br>    ( <span class="grammar-text"><a href="#grammar-MatchArm">MatchArm</a></span> <span class="grammar-literal">=&gt;</span> ( <span class="grammar-text"><a href="#grammar-ExpressionWithoutBlock">ExpressionWithoutBlock</a></span> <span class="grammar-literal">,</span> | <span class="grammar-text"><a href="#grammar-ExpressionWithBlock">ExpressionWithBlock</a></span> <span class="grammar-literal">,</span><sup>?</sup> ) )<sup>*</sup> <br>    <span class="grammar-text"><a href="#grammar-MatchArm">MatchArm</a></span> <span class="grammar-literal">=&gt;</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">,</span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-MatchArm" onclick="show_railroad()"><a href="#railroad-MatchArm">MatchArm</a></span> → <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> <span class="grammar-text"><a href="#grammar-Pattern">Pattern</a></span> <span class="grammar-text"><a href="#grammar-MatchArmGuard">MatchArmGuard</a></span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-MatchArmGuard" onclick="show_railroad()"><a href="#railroad-MatchArmGuard">MatchArmGuard</a></span> → <span class="grammar-literal">if</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 672px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MatchExpression"><svg class="railroad" viewbox="0 0 672 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MatchExpression">
<text class="comment" x="67" y="25">
MatchExpression</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="35" y="55" />
<text x="65" y="71">
match</text>
</g>
<a class="link" xlink:href="#railroad-Scrutinee">
<g class="nonterminal">
<rect height="22" width="92" x="105" y="55" />
<text x="151" y="71">
Scrutinee</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="207" y="55" />
<text x="221" y="71">
{</text>
</g>
<g class="optional">
<path d=" M 245 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 269 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-InnerAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="281" y="55" />
<text x="347" y="71">
InnerAttribute</text>
</g>
</a>
</g>
</g>
<g class="optional">
<path d=" M 459 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 92 m -43 0 l -5 -5 m 0 10 l 5 -5 m 43 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-MatchArms">
<g class="nonterminal">
<rect height="22" width="92" x="483" y="55" />
<text x="529" y="71">
MatchArms</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="609" y="55" />
<text x="623" y="71">
}</text>
</g>
<path d=" M 95 66 h 10" />
<path d=" M 197 66 h 10" />
<path d=" M 235 66 h 10" />
<path d=" M 449 66 h 10" />
<path d=" M 599 66 h 10" />
</g>
<path d=" M 647 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 637 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 264px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Scrutinee"><svg class="railroad" viewbox="0 0 264 118" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Scrutinee">
<text class="comment" x="46" y="25">
Scrutinee</text>
</a>
<g class="sequence">
<path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="labeledbox">
<rect height="66" width="194" x="35" y="42" />
<path d=" M 35 89 h 8 m 100 0 h 86 m -40 0 l -5 -5 m 0 10 l 5 -5 m 40 0" />
<text class="comment" x="132" y="65">
except StructExpression</text>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="43" y="78" />
<text x="93" y="94">
Expression</text>
</g>
</a>
</g>
<path d=" M 239 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 89 h 10" />
<path d=" M 229 89 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 636px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MatchArms"><svg class="railroad" viewbox="0 0 636 201" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MatchArms">
<text class="comment" x="46" y="25">
MatchArms</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="stack">
<path d=" M 35 66 h 12" />
<path d=" M 565 66 a 12 12 0 0 1 12 12 v 54 m 0 -24 l -5 -5 m 10 0 l -5 5 m 0 24 a 12 12 0 0 1 -12 12 h -518 m 262 0 l 5 -5 m 0 10 l -5 -5 m -262 0 a 12 12 0 0 0 -12 12 v 12 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="optional">
<path d=" M 47 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 470 m -232 0 l -5 -5 m 0 10 l 5 -5 m 232 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 71 66 h 12 m 446 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 42 a 12 12 0 0 1 -12 12 m 0 0 h -446 m 226 0 l 5 -5 m 0 10 l -5 -5 m -226 0 a 12 12 0 0 1 -12 -12 v -42 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<a class="link" xlink:href="#railroad-MatchArm">
<g class="nonterminal">
<rect height="22" width="84" x="83" y="55" />
<text x="125" y="71">
MatchArm</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="177" y="55" />
<text x="195" y="71">
=&gt;</text>
</g>
<g class="choice">
<path d=" M 223 66 h 24 m 242 0 h 40" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ExpressionWithoutBlock">
<g class="nonterminal">
<rect height="22" width="204" x="247" y="55" />
<text x="349" y="71">
ExpressionWithoutBlock</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="461" y="55" />
<text x="475" y="71">
,</text>
</g>
<path d=" M 451 66 h 10" />
</g>
<path d=" M 223 66 a 12 12 0 0 1 12 12 v 9 m 282 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 235 87 v 12 a 12 12 0 0 0 12 12 m 258 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ExpressionWithBlock">
<g class="nonterminal">
<rect height="22" width="172" x="247" y="100" />
<text x="333" y="116">
ExpressionWithBlock</text>
</g>
</a>
<g class="optional">
<path d=" M 429 111 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="453" y="100" />
<text x="467" y="116">
,</text>
</g>
</g>
<path d=" M 419 111 h 10" />
</g>
</g>
<path d=" M 167 66 h 10" />
<path d=" M 213 66 h 10" />
</g>
</g>
</g>
</g>
<path d=" M 373 180 h 204 m -99 0 l -5 -5 m 0 10 l 5 -5 m 99 0 a 12 12 0 0 0 12 -12 v -90 m 0 48 l -5 5 m 10 0 l -5 -5 m 0 -48 a 12 12 0 0 1 12 -12" />
<g class="sequence">
<a class="link" xlink:href="#railroad-MatchArm">
<g class="nonterminal">
<rect height="22" width="84" x="47" y="169" />
<text x="89" y="185">
MatchArm</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="141" y="169" />
<text x="159" y="185">
=&gt;</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="187" y="169" />
<text x="237" y="185">
Expression</text>
</g>
</a>
<g class="optional">
<path d=" M 297 180 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="321" y="169" />
<text x="335" y="185">
,</text>
</g>
</g>
<path d=" M 131 180 h 10" />
<path d=" M 177 180 h 10" />
<path d=" M 287 180 h 10" />
</g>
</g>
<path d=" M 611 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 601 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 542px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MatchArm"><svg class="railroad" viewbox="0 0 542 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MatchArm">
<text class="comment" x="43" y="25">
MatchArm</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<a class="link" xlink:href="#railroad-Pattern">
<g class="nonterminal">
<rect height="22" width="76" x="249" y="55" />
<text x="287" y="71">
Pattern</text>
</g>
</a>
<g class="optional">
<path d=" M 335 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 124 m -59 0 l -5 -5 m 0 10 l 5 -5 m 59 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-MatchArmGuard">
<g class="nonterminal">
<rect height="22" width="124" x="359" y="55" />
<text x="421" y="71">
MatchArmGuard</text>
</g>
</a>
</g>
<path d=" M 239 66 h 10" />
<path d=" M 325 66 h 10" />
</g>
<path d=" M 517 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 507 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 216px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MatchArmGuard"><svg class="railroad" viewbox="0 0 216 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MatchArmGuard">
<text class="comment" x="60" y="25">
MatchArmGuard</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="42" />
<text x="53" y="58">
if</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="81" y="42" />
<text x="131" y="58">
Expression</text>
</g>
</a>
<path d=" M 71 53 h 10" />
</g>
<path d=" M 191 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 181 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<!-- TODO: The exception above isn't accurate, see https://github.com/rust-lang/reference/issues/569 -->
<div class="rule" id="r-expr.match.intro"><a class="rule-link" href="#r-expr.match.intro" title="expr.match.intro"><span>[expr<wbr>.match<wbr>.intro]</span></a>
</div>

<p>一个  <em><code>match</code> 表达式</em> 根据模式进行分支。
发生的精确匹配形式取决于 <a href="#模式">模式</a>。</p>
<div class="rule" id="r-expr.match.scrutinee"><a class="rule-link" href="#r-expr.match.scrutinee" title="expr.match.scrutinee"><span>[expr<wbr>.match<wbr>.scrutinee]</span></a>
</div>

<p>一个 <code>match</code> 表达式有一个  <em><a href="#scrutinee">待匹配值</a> 表达式</em> ，它是要与模式进行比较的值。</p>
<div class="rule" id="r-expr.match.scrutinee-constraint"><a class="rule-link" href="#r-expr.match.scrutinee-constraint" title="expr.match.scrutinee-constraint"><span>[expr<wbr>.match<wbr>.scrutinee-constraint]</span></a>
</div>

<p>待匹配值表达式和模式必须具有相同的类型。</p>
<div class="rule" id="r-expr.match.scrutinee-behavior"><a class="rule-link" href="#r-expr.match.scrutinee-behavior" title="expr.match.scrutinee-behavior"><span>[expr<wbr>.match<wbr>.scrutinee-behavior]</span></a>
</div>

<p><code>match</code> 的行为根据待匹配值表达式是 <a href="#位置表达式和值表达式">位置表达式或值表达式</a> 而有所不同。</p>
<div class="rule" id="r-expr.match.scrutinee-value"><a class="rule-link" href="#r-expr.match.scrutinee-value" title="expr.match.scrutinee-value"><span>[expr<wbr>.match<wbr>.scrutinee-value]</span></a>
</div>

<p>如果待匹配值表达式是一个 <a href="#位置表达式和值表达式">值表达式</a>，它首先被求值为一个临时位置，并将结果值按顺序与各个臂中的模式进行比较，直到找到匹配项。
第一个具有匹配模式的臂被选为 <code>match</code> 的分支目标，由该模式绑定的任何变量都会赋值给该臂所在块中的局部变量，然后控制流进入该块。</p>
<div class="rule" id="r-expr.match.scrutinee-place"><a class="rule-link" href="#r-expr.match.scrutinee-place" title="expr.match.scrutinee-place"><span>[expr<wbr>.match<wbr>.scrutinee-place]</span></a>
</div>

<p>当待匹配值表达式是一个 <a href="#位置表达式和值表达式">位置表达式</a> 时，匹配不会分配临时位置；
然而，按值绑定可能会从内存位置进行复制或移动。
在可能的情况下，首选对位置表达式进行匹配，因为这些匹配的生命周期继承自位置表达式的生命周期，而不是被限制在匹配内部。</p>
<p><code>match</code> 表达式的一个示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = 1;

match x {
    1 =&gt; println!("one"),
    2 =&gt; println!("two"),
    3 =&gt; println!("three"),
    4 =&gt; println!("four"),
    5 =&gt; println!("five"),
    _ =&gt; println!("something else"),
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-expr.match.pattern-vars"><a class="rule-link" href="#r-expr.match.pattern-vars" title="expr.match.pattern-vars"><span>[expr<wbr>.match<wbr>.pattern-vars]</span></a>
</div>

<p>在模式内绑定的变量的作用域仅限于匹配守卫和该臂的表达式。</p>
<div class="rule" id="r-expr.match.pattern-var-binding"><a class="rule-link" href="#r-expr.match.pattern-var-binding" title="expr.match.pattern-var-binding"><span>[expr<wbr>.match<wbr>.pattern-var-binding]</span></a>
</div>

<p><a href="#binding-modes">绑定模式</a> （移动、复制或引用）取决于模式。</p>
<div class="rule" id="r-expr.match.or-pattern"><a class="rule-link" href="#r-expr.match.or-pattern" title="expr.match.or-pattern"><span>[expr<wbr>.match<wbr>.or-pattern]</span></a>
</div>

<p>多个匹配模式可以用 <code>|</code> 运算符连接。
每个模式将按从左到右的顺序进行测试，直到找到成功的匹配。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = 9;
let message = match x {
    0 | 1  =&gt; "not many",
    2 ..= 9 =&gt; "a few",
    _      =&gt; "lots"
};

assert_eq!(message, "a few");

// 演示模式匹配顺序。
struct S(i32, i32);

match S(1, 2) {
    S(z @ 1, _) | S(_, z @ 2) =&gt; assert_eq!(z, 1),
    _ =&gt; panic!(),
}
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>2..=9</code> 是一个 <a href="#range-patterns">范围模式</a> ，而不是一个 <a href="#范围表达式">范围表达式</a>。因此，只有范围模式支持的那些类型的范围才能在匹配臂中使用。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.match.or-patterns-restriction"><a class="rule-link" href="#r-expr.match.or-patterns-restriction" title="expr.match.or-patterns-restriction"><span>[expr<wbr>.match<wbr>.or-patterns-restriction]</span></a>
</div>

<p>在每个由 <code>|</code> 分隔的模式中的每个绑定必须出现在该臂的所有模式中。</p>
<div class="rule" id="r-expr.match.binding-restriction"><a class="rule-link" href="#r-expr.match.binding-restriction" title="expr.match.binding-restriction"><span>[expr<wbr>.match<wbr>.binding-restriction]</span></a>
</div>

<p>具有相同名称的每个绑定必须具有相同的类型，并具有相同的绑定模式。</p>
<div class="rule" id="r-expr.match.guard"><a class="rule-link" href="#r-expr.match.guard" title="expr.match.guard"><span>[expr<wbr>.match<wbr>.guard]</span></a>
</div>

<h2 id="匹配臂守卫"><a class="header" href="#匹配臂守卫">匹配臂守卫</a></h2>
<div class="rule" id="r-expr.match.guard.intro"><a class="rule-link" href="#r-expr.match.guard.intro" title="expr.match.guard.intro"><span>[expr<wbr>.match<wbr>.guard<wbr>.intro]</span></a>
</div>

<p>匹配臂可以接受  <em>匹配臂守卫</em>  以进一步细化匹配情况的准则。</p>
<div class="rule" id="r-expr.match.guard.type"><a class="rule-link" href="#r-expr.match.guard.type" title="expr.match.guard.type"><span>[expr<wbr>.match<wbr>.guard<wbr>.type]</span></a>
</div>

<p>模式守卫出现在模式之后，由 <code>if</code> 关键字后跟一个 <code>bool</code> 类型的表达式组成。</p>
<div class="rule" id="r-expr.match.guard.behavior"><a class="rule-link" href="#r-expr.match.guard.behavior" title="expr.match.guard.behavior"><span>[expr<wbr>.match<wbr>.guard<wbr>.behavior]</span></a>
</div>

<p>当模式匹配成功时，将执行模式守卫表达式。
如果表达式求值为真，则模式匹配成功。</p>
<div class="rule" id="r-expr.match.guard.next"><a class="rule-link" href="#r-expr.match.guard.next" title="expr.match.guard.next"><span>[expr<wbr>.match<wbr>.guard<wbr>.next]</span></a>
</div>

<p>否则，将测试下一个模式，包括同一臂中由 <code>|</code> 运算符连接的其他匹配。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">let maybe_digit = Some(0);
</span><span class="boring">fn process_digit(i: i32) { }
</span><span class="boring">fn process_other(i: i32) { }
</span>let message = match maybe_digit {
    Some(x) if x &lt; 10 =&gt; process_digit(x),
    Some(x) =&gt; process_other(x),
    None =&gt; panic!(),
};
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>使用 <code>|</code> 运算符进行多次匹配可能会导致模式守卫及其产生的副作用执行多次。例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use std::cell::Cell;
</span>let i : Cell&lt;i32&gt; = Cell::new(0);
match 1 {
    1 | _ if { i.set(i.get() + 1); false } =&gt; {}
    _ =&gt; {}
}
assert_eq!(i.get(), 2);
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-expr.match.guard.bound-variables"><a class="rule-link" href="#r-expr.match.guard.bound-variables" title="expr.match.guard.bound-variables"><span>[expr<wbr>.match<wbr>.guard<wbr>.bound-variables]</span></a>
</div>

<p>模式守卫可以引用它们所跟随的模式中绑定的变量。</p>
<div class="rule" id="r-expr.match.guard.shared-ref"><a class="rule-link" href="#r-expr.match.guard.shared-ref" title="expr.match.guard.shared-ref"><span>[expr<wbr>.match<wbr>.guard<wbr>.shared-ref]</span></a>
</div>

<p>在求值守卫之前，会对变量匹配的待匹配值部分进行共享引用。
在求值守卫期间，访问该变量时将使用此共享引用。</p>
<div class="rule" id="r-expr.match.guard.value"><a class="rule-link" href="#r-expr.match.guard.value" title="expr.match.guard.value"><span>[expr<wbr>.match<wbr>.guard<wbr>.value]</span></a>
</div>

<p>只有当守卫求值为真时，值才会从待匹配值移动或复制到变量中。
这允许在守卫内部使用共享借用，而不会在守卫匹配失败的情况下从待匹配值中移出。</p>
<div class="rule" id="r-expr.match.guard.no-mutation"><a class="rule-link" href="#r-expr.match.guard.no-mutation" title="expr.match.guard.no-mutation"><span>[expr<wbr>.match<wbr>.guard<wbr>.no-mutation]</span></a>
</div>

<p>此外，通过在求值守卫时持有共享引用，还可以防止在守卫内部进行修改。</p>
<div class="rule" id="r-expr.match.attributes"><a class="rule-link" href="#r-expr.match.attributes" title="expr.match.attributes"><span>[expr<wbr>.match<wbr>.attributes]</span></a>
</div>

<h2 id="匹配臂上的属性"><a class="header" href="#匹配臂上的属性">匹配臂上的属性</a></h2>
<div class="rule" id="r-expr.match.attributes.outer"><a class="rule-link" href="#r-expr.match.attributes.outer" title="expr.match.attributes.outer"><span>[expr<wbr>.match<wbr>.attributes<wbr>.outer]</span></a>
</div>

<p>匹配臂上允许使用外部属性。
在匹配臂上有意义的属性只有 <a href="#条件编译"><code>cfg</code></a> 和 <a href="#lint-check-attributes">lint 检查属性</a>。</p>
<div class="rule" id="r-expr.match.attributes.inner"><a class="rule-link" href="#r-expr.match.attributes.inner" title="expr.match.attributes.inner"><span>[expr<wbr>.match<wbr>.attributes<wbr>.inner]</span></a>
</div>

<p><a href="#属性-1">内部属性</a> 被允许直接放在匹配表达式的左大括号之后，其所在的表达式上下文与 <a href="#attributes-on-block-expressions">块表达式上的属性</a> 相同。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr.return"><a class="rule-link" href="#r-expr.return" title="expr.return"><span>[expr<wbr>.return]</span></a>
</div>

<h1 id="return表达式"><a class="header" href="#return表达式"><code>return</code>表达式</a></h1>
<div class="rule" id="r-expr.return.syntax"><a class="rule-link" href="#r-expr.return.syntax" title="expr.return.syntax"><span>[expr<wbr>.return<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ReturnExpression" onclick="show_railroad()"><a href="#railroad-ReturnExpression">ReturnExpression</a></span> → <span class="grammar-literal">return</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span><sup>?</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 296px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ReturnExpression"><svg class="railroad" viewbox="0 0 296 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ReturnExpression">
<text class="comment" x="71" y="25">
ReturnExpression</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="35" y="55" />
<text x="69" y="71">
return</text>
</g>
<g class="optional">
<path d=" M 113 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="137" y="55" />
<text x="187" y="71">
Expression</text>
</g>
</a>
</g>
<path d=" M 103 66 h 10" />
</g>
<path d=" M 271 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 261 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.return.intro"><a class="rule-link" href="#r-expr.return.intro" title="expr.return.intro"><span>[expr<wbr>.return<wbr>.intro]</span></a>
</div>

<p><code>return</code> 表达式由关键字 <code>return</code> 表示。</p>
<div class="rule" id="r-expr.return.behavior"><a class="rule-link" href="#r-expr.return.behavior" title="expr.return.behavior"><span>[expr<wbr>.return<wbr>.behavior]</span></a>
</div>

<p>求值 <code>return</code> 表达式会将其参数移动到当前函数调用的指定输出位置，销毁当前函数的活动帧，并将控制权转移给调用者帧。</p>
<p>一个 <code>return</code> 表达式的示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn max(a: i32, b: i32) -&gt; i32 {
    if a &gt; b {
        return a;
    }
    return b;
}
<span class="boring">}</span></code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr.await"><a class="rule-link" href="#r-expr.await" title="expr.await"><span>[expr<wbr>.await]</span></a>
</div>

<h1 id="await表达式"><a class="header" href="#await表达式"><code>await</code>表达式</a></h1>
<div class="rule" id="r-expr.await.syntax"><a class="rule-link" href="#r-expr.await.syntax" title="expr.await.syntax"><span>[expr<wbr>.await<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-AwaitExpression" onclick="show_railroad()"><a href="#railroad-AwaitExpression">AwaitExpression</a></span> → <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">.</span> <span class="grammar-literal">await</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 278px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-AwaitExpression"><svg class="railroad" viewbox="0 0 278 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-AwaitExpression">
<text class="comment" x="67" y="25">
AwaitExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="42" />
<text x="85" y="58">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="145" y="42" />
<text x="159" y="58">
.</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="183" y="42" />
<text x="213" y="58">
await</text>
</g>
<path d=" M 135 53 h 10" />
<path d=" M 173 53 h 10" />
</g>
<path d=" M 253 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 243 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.await.intro"><a class="rule-link" href="#r-expr.await.intro" title="expr.await.intro"><span>[expr<wbr>.await<wbr>.intro]</span></a>
</div>

<p><code>await</code> 表达式是一种语法结构，用于挂起由 <code>std::future::IntoFuture</code> 的实现提供的计算，直到给定的 future 准备好产生一个值。</p>
<div class="rule" id="r-expr.await.construct"><a class="rule-link" href="#r-expr.await.construct" title="expr.await.construct"><span>[expr<wbr>.await<wbr>.construct]</span></a>
</div>

<p><code>await</code> 表达式的 语法格式 是一个具有实现了 <a href="../core/future/into_future/trait.IntoFuture.html"><code>IntoFuture</code></a> 特型的类型的表达式（称为 <em>future 操作数</em>），后跟 词法单元 <code>.</code>，然后是 <code>await</code> 关键字。</p>
<div class="rule" id="r-expr.await.allowed-positions"><a class="rule-link" href="#r-expr.await.allowed-positions" title="expr.await.allowed-positions"><span>[expr<wbr>.await<wbr>.allowed-positions]</span></a>
</div>

<p><code>await</code> 表达式仅在 <a href="#async-context">异步上下文</a>（如 <a href="#async-functions"><code>async fn</code></a>、<a href="#async-closures"><code>async</code> 闭包</a> 或 <a href="#async-blocks"><code>async</code> 块</a>）中合法。</p>
<div class="rule" id="r-expr.await.effects"><a class="rule-link" href="#r-expr.await.effects" title="expr.await.effects"><span>[expr<wbr>.await<wbr>.effects]</span></a>
</div>

<p>更具体地说，一个 <code>await</code> 表达式具有以下效果。</p>
<ol>
<li>通过在 future 操作数上调用 <a href="../core/future/into_future/trait.IntoFuture.html#tymethod.into_future"><code>IntoFuture::into_future</code></a> 来创建一个 future。</li>
<li>将该 future 求值为一个 <a href="../core/future/future/trait.Future.html">future</a> <code>tmp</code>；</li>
<li>使用 <a href="../core/pin/struct.Pin.html#method.new_unchecked"><code>Pin::new_unchecked</code></a> 固定 <code>tmp</code>；</li>
<li>然后通过调用 <a href="../core/future/future/trait.Future.html#tymethod.poll"><code>Future::poll</code></a> 方法并向其传递当前 <a href="#task-context">任务上下文</a> 来轮询此固定的 future；</li>
<li>如果对 <code>poll</code> 的调用返回 <a href="../core/task/poll/enum.Poll.html#variant.Pending"><code>Poll::Pending</code></a>，则 future 返回 <code>Poll::Pending</code>，并挂起其状态，以便当周围的异步上下文被重新轮询时，执行返回到步骤 3；</li>
<li>否则对 <code>poll</code> 的调用必须返回 <a href="../core/task/poll/enum.Poll.html#variant.Ready"><code>Poll::Ready</code></a>，在这种情况下，<a href="../core/task/poll/enum.Poll.html#variant.Ready"><code>Poll::Ready</code></a> 变体中包含的值将用作 <code>await</code> 表达式本身的结果。</li>
</ol>
<div class="rule" id="r-expr.await.edition2018"><a class="rule-link" href="#r-expr.await.edition2018" title="expr.await.edition2018"><span>[expr<wbr>.await<wbr>.edition2018]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p><code>await</code> 表达式仅从 Rust 2018 版次开始提供。</p>
</blockquote>
</div>

<div class="rule" id="r-expr.await.task"><a class="rule-link" href="#r-expr.await.task" title="expr.await.task"><span>[expr<wbr>.await<wbr>.task]</span></a>
</div>

<h2 id="任务上下文"><a class="header" href="#任务上下文">任务上下文</a></h2>
<p>任务上下文是指当异步上下文本身被轮询时提供给当前 <a href="#async-context">异步上下文</a> 的 <a href="../core/task/wake/struct.Context.html"><code>Context</code></a>。由于 <code>await</code> 表达式仅在异步上下文中合法，因此必须存在某种可用的任务上下文。</p>
<div class="rule" id="r-expr.await.desugar"><a class="rule-link" href="#r-expr.await.desugar" title="expr.await.desugar"><span>[expr<wbr>.await<wbr>.desugar]</span></a>
</div>

<h2 id="近似脱糖"><a class="header" href="#近似脱糖">近似脱糖</a></h2>
<p>实际上，<code>await</code> 表达式大致等效于以下非规范性的脱糖：</p>
<!-- ignore: example expansion -->
<pre><code class="language-rust ignore">match operand.into_future() {
    mut pinned =&gt; loop {
        let mut pin = unsafe { Pin::new_unchecked(&amp;mut pinned) };
        match Pin::future::poll(Pin::borrow(&amp;mut pin), &amp;mut current_context) {
            Poll::Ready(r) =&gt; break r,
            Poll::Pending =&gt; yield Poll::Pending,
        }
    }
}</code></pre>
<p>其中 <code>yield</code> 伪代码返回 <code>Poll::Pending</code>，并且在重新调用时从该点恢复执行。变量 <code>current_context</code> 是指从异步环境中获取的上下文。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-expr.placeholder"><a class="rule-link" href="#r-expr.placeholder" title="expr.placeholder"><span>[expr<wbr>.placeholder]</span></a>
</div>

<h1 id="_表达式"><a class="header" href="#_表达式"><code>_</code>表达式</a></h1>
<div class="rule" id="r-expr.placeholder.syntax"><a class="rule-link" href="#r-expr.placeholder.syntax" title="expr.placeholder.syntax"><span>[expr<wbr>.placeholder<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-UnderscoreExpression" onclick="show_railroad()"><a href="#railroad-UnderscoreExpression">UnderscoreExpression</a></span> → <span class="grammar-literal">_</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 177px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-UnderscoreExpression"><svg class="railroad" viewbox="0 0 177 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-UnderscoreExpression">
<text class="comment" x="88" y="25">
UnderscoreExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="42" />
<text x="49" y="58">
_</text>
</g>
<path d=" M 73 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 63 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-expr.placeholder.intro"><a class="rule-link" href="#r-expr.placeholder.intro" title="expr.placeholder.intro"><span>[expr<wbr>.placeholder<wbr>.intro]</span></a>
</div>

<p>下划线表达式由符号 <code>_</code> 表示，用于在解构赋值中表示占位符。</p>
<div class="rule" id="r-expr.placeholder.lhs-assignment-only"><a class="rule-link" href="#r-expr.placeholder.lhs-assignment-only" title="expr.placeholder.lhs-assignment-only"><span>[expr<wbr>.placeholder<wbr>.lhs-assignment-only]</span></a>
</div>

<p>它们只能出现在赋值语句的左侧。</p>
<div class="rule" id="r-expr.placeholder.pattern"><a class="rule-link" href="#r-expr.placeholder.pattern" title="expr.placeholder.pattern"><span>[expr<wbr>.placeholder<wbr>.pattern]</span></a>
</div>

<p>请注意，这与 <a href="#wildcard-pattern">通配符模式</a> 不同。</p>
<p><code>_</code> 表达式的示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let p = (1, 2);
let mut a = 0;
(_, a) = p;

struct Position {
    x: u32,
    y: u32,
}

Position { x: a, y: _ } = Position{ x: 2, y: 3 };

// 未使用的结果，赋值给 `_` 用于声明意图并消除警告
_ = 2 + 2;
// 触发 unused_must_use 警告
// 2 + 2;

// 在 let 绑定中使用通配符模式的等效技术
let _ = 2 + 2;
<span class="boring">}</span></code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-patterns"><a class="rule-link" href="#r-patterns" title="patterns"><span>[patterns]</span></a>
</div>

<h1 id="模式"><a class="header" href="#模式">模式</a></h1>
<div class="rule" id="r-patterns.syntax"><a class="rule-link" href="#r-patterns.syntax" title="patterns.syntax"><span>[patterns<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-Pattern" onclick="show_railroad()"><a href="#railroad-Pattern">Pattern</a></span> → <span class="grammar-literal">|</span><sup>?</sup> <span class="grammar-text"><a href="#grammar-PatternNoTopAlt">PatternNoTopAlt</a></span> ( <span class="grammar-literal">|</span> <span class="grammar-text"><a href="#grammar-PatternNoTopAlt">PatternNoTopAlt</a></span> )<sup>*</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-PatternNoTopAlt" onclick="show_railroad()"><a href="#railroad-PatternNoTopAlt">PatternNoTopAlt</a></span> → <br>      <span class="grammar-text"><a href="#grammar-PatternWithoutRange">PatternWithoutRange</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RangePattern">RangePattern</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-PatternWithoutRange" onclick="show_railroad()"><a href="#railroad-PatternWithoutRange">PatternWithoutRange</a></span> → <br>      <span class="grammar-text"><a href="#grammar-LiteralPattern">LiteralPattern</a></span> <br>    | <span class="grammar-text"><a href="#grammar-IdentifierPattern">IdentifierPattern</a></span> <br>    | <span class="grammar-text"><a href="#grammar-WildcardPattern">WildcardPattern</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RestPattern">RestPattern</a></span> <br>    | <span class="grammar-text"><a href="#grammar-ReferencePattern">ReferencePattern</a></span> <br>    | <span class="grammar-text"><a href="#grammar-StructPattern">StructPattern</a></span> <br>    | <span class="grammar-text"><a href="#grammar-TupleStructPattern">TupleStructPattern</a></span> <br>    | <span class="grammar-text"><a href="#grammar-TuplePattern">TuplePattern</a></span> <br>    | <span class="grammar-text"><a href="#grammar-GroupedPattern">GroupedPattern</a></span> <br>    | <span class="grammar-text"><a href="#grammar-SlicePattern">SlicePattern</a></span> <br>    | <span class="grammar-text"><a href="#grammar-PathPattern">PathPattern</a></span> <br>    | <span class="grammar-text"><a href="#grammar-MacroInvocation">MacroInvocation</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 556px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Pattern"><svg class="railroad" viewbox="0 0 556 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Pattern">
<text class="comment" x="39" y="25">
Pattern</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="55" />
<text x="73" y="71">
|</text>
</g>
</g>
<a class="link" xlink:href="#railroad-PatternNoTopAlt">
<g class="nonterminal">
<rect height="22" width="140" x="121" y="55" />
<text x="191" y="71">
PatternNoTopAlt</text>
</g>
</a>
<g class="optional">
<path d=" M 271 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 202 m -98 0 l -5 -5 m 0 10 l 5 -5 m 98 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 295 66 h 12 m 178 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -178 m 92 0 l 5 -5 m 0 10 l -5 -5 m -92 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="307" y="55" />
<text x="321" y="71">
|</text>
</g>
<a class="link" xlink:href="#railroad-PatternNoTopAlt">
<g class="nonterminal">
<rect height="22" width="140" x="345" y="55" />
<text x="415" y="71">
PatternNoTopAlt</text>
</g>
</a>
<path d=" M 335 66 h 10" />
</g>
</g>
</g>
<path d=" M 111 66 h 10" />
<path d=" M 261 66 h 10" />
</g>
<path d=" M 531 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 521 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 290px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-PatternNoTopAlt"><svg class="railroad" viewbox="0 0 290 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-PatternNoTopAlt">
<text class="comment" x="67" y="25">
PatternNoTopAlt</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 172 0 h 24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-PatternWithoutRange">
<g class="nonterminal">
<rect height="22" width="172" x="59" y="42" />
<text x="145" y="58">
PatternWithoutRange</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 196 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 116 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-RangePattern">
<g class="nonterminal">
<rect height="22" width="116" x="59" y="75" />
<text x="117" y="91">
RangePattern</text>
</g>
</a>
</g>
<path d=" M 265 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 255 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 282px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-PatternWithoutRange"><svg class="railroad" viewbox="0 0 282 437" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-PatternWithoutRange">
<text class="comment" x="81" y="25">
PatternWithoutRange</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 132 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-LiteralPattern">
<g class="nonterminal">
<rect height="22" width="132" x="59" y="42" />
<text x="125" y="58">
LiteralPattern</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 188 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 188 0 v -33" />
<path d=" M 47 107 v 33 m 188 0 v -33" />
<path d=" M 47 140 v 33 m 188 0 v -33" />
<path d=" M 47 173 v 33 m 188 0 v -33" />
<path d=" M 47 206 v 33 m 188 0 v -33" />
<path d=" M 47 239 v 33 m 188 0 v -33" />
<path d=" M 47 272 v 33 m 188 0 v -33" />
<path d=" M 47 305 v 33 m 188 0 v -33" />
<path d=" M 47 338 v 33 m 188 0 v -33" />
<path d=" M 47 371 v 33 m 188 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 156 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IdentifierPattern">
<g class="nonterminal">
<rect height="22" width="156" x="59" y="75" />
<text x="137" y="91">
IdentifierPattern</text>
</g>
</a>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 140 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-WildcardPattern">
<g class="nonterminal">
<rect height="22" width="140" x="59" y="108" />
<text x="129" y="124">
WildcardPattern</text>
</g>
</a>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 108 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RestPattern">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="141" />
<text x="113" y="157">
RestPattern</text>
</g>
</a>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 148 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ReferencePattern">
<g class="nonterminal">
<rect height="22" width="148" x="59" y="174" />
<text x="133" y="190">
ReferencePattern</text>
</g>
</a>
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 124 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-StructPattern">
<g class="nonterminal">
<rect height="22" width="124" x="59" y="207" />
<text x="121" y="223">
StructPattern</text>
</g>
</a>
</g>
<path d=" M 47 239 v 0 a 12 12 0 0 0 12 12 m 164 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-TupleStructPattern">
<g class="nonterminal">
<rect height="22" width="164" x="59" y="240" />
<text x="141" y="256">
TupleStructPattern</text>
</g>
</a>
</g>
<path d=" M 47 272 v 0 a 12 12 0 0 0 12 12 m 116 0 h 48 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-TuplePattern">
<g class="nonterminal">
<rect height="22" width="116" x="59" y="273" />
<text x="117" y="289">
TuplePattern</text>
</g>
</a>
</g>
<path d=" M 47 305 v 0 a 12 12 0 0 0 12 12 m 132 0 h 32 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-GroupedPattern">
<g class="nonterminal">
<rect height="22" width="132" x="59" y="306" />
<text x="125" y="322">
GroupedPattern</text>
</g>
</a>
</g>
<path d=" M 47 338 v 0 a 12 12 0 0 0 12 12 m 116 0 h 48 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-SlicePattern">
<g class="nonterminal">
<rect height="22" width="116" x="59" y="339" />
<text x="117" y="355">
SlicePattern</text>
</g>
</a>
</g>
<path d=" M 47 371 v 0 a 12 12 0 0 0 12 12 m 108 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-PathPattern">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="372" />
<text x="113" y="388">
PathPattern</text>
</g>
</a>
</g>
<path d=" M 47 404 v 0 a 12 12 0 0 0 12 12 m 140 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-MacroInvocation">
<g class="nonterminal">
<rect height="22" width="140" x="59" y="405" />
<text x="129" y="421">
MacroInvocation</text>
</g>
</a>
</g>
<path d=" M 257 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 247 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-patterns.intro"><a class="rule-link" href="#r-patterns.intro" title="patterns.intro"><span>[patterns<wbr>.intro]</span></a>
</div>

<p>模式用于根据结构匹配值，并可选地将变量绑定到这些结构内部的值。
它们也用于变量声明以及函数和闭包的参数。</p>
<p>下面示例中的模式做了四件事：</p>
<ul>
<li>测试 <code>person</code> 是否有名为 <code>car</code> 的字段且填充了内容。</li>
<li>测试该人的 <code>age</code> 字段是否在 13 到 19 之间，并将其值绑定到 <code>person_age</code> 变量。</li>
<li>将指向 <code>name</code> 字段的引用绑定到变量 <code>person_name</code>。</li>
<li>忽略 <code>person</code> 的其余字段。
其余字段可以具有任何值，且不绑定到任何变量。</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct Car;
</span><span class="boring">struct Computer;
</span><span class="boring">struct Person {
</span><span class="boring">    name: String,
</span><span class="boring">    car: Option&lt;Car&gt;,
</span><span class="boring">    computer: Option&lt;Computer&gt;,
</span><span class="boring">    age: u8,
</span><span class="boring">}
</span><span class="boring">let person = Person {
</span><span class="boring">    name: String::from("John"),
</span><span class="boring">    car: Some(Car),
</span><span class="boring">    computer: None,
</span><span class="boring">    age: 15,
</span><span class="boring">};
</span>if let
    Person {
        car: Some(_),
        age: person_age @ 13..=19,
        name: ref person_name,
        ..
    } = person
{
    println!("{} has a car and is {} years old.", person_name, person_age);
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.usage"><a class="rule-link" href="#r-patterns.usage" title="patterns.usage"><span>[patterns<wbr>.usage]</span></a>
</div>

<p>模式用于：</p>
<div class="rule" id="r-patterns.let"><a class="rule-link" href="#r-patterns.let" title="patterns.let"><span>[patterns<wbr>.let]</span></a>
</div>

<ul>
<li><a href="#let-statements"><code>let</code> 声明</a></li>
</ul>
<div class="rule" id="r-patterns.param"><a class="rule-link" href="#r-patterns.param" title="patterns.param"><span>[patterns<wbr>.param]</span></a>
</div>

<ul>
<li><a href="#函数">函数</a> 和 <a href="#闭包表达式">闭包</a> 参数</li>
</ul>
<div class="rule" id="r-patterns.match"><a class="rule-link" href="#r-patterns.match" title="patterns.match"><span>[patterns<wbr>.match]</span></a>
</div>

<ul>
<li><a href="#match表达式"><code>match</code> 表达式</a></li>
</ul>
<div class="rule" id="r-patterns.if-let"><a class="rule-link" href="#r-patterns.if-let" title="patterns.if-let"><span>[patterns<wbr>.if-let]</span></a>
</div>

<ul>
<li><a href="#if表达式"><code>if let</code> 表达式</a></li>
</ul>
<div class="rule" id="r-patterns.while-let"><a class="rule-link" href="#r-patterns.while-let" title="patterns.while-let"><span>[patterns<wbr>.while-let]</span></a>
</div>

<ul>
<li><a href="#while-let-patterns"><code>while let</code> 表达式</a></li>
</ul>
<div class="rule" id="r-patterns.for"><a class="rule-link" href="#r-patterns.for" title="patterns.for"><span>[patterns<wbr>.for]</span></a>
</div>

<ul>
<li><a href="#iterator-loops"><code>for</code> 表达式</a></li>
</ul>
<div class="rule" id="r-patterns.destructure"><a class="rule-link" href="#r-patterns.destructure" title="patterns.destructure"><span>[patterns<wbr>.destructure]</span></a>
</div>

<h2 id="解构"><a class="header" href="#解构">解构</a></h2>
<div class="rule" id="r-patterns.destructure.intro"><a class="rule-link" href="#r-patterns.destructure.intro" title="patterns.destructure.intro"><span>[patterns<wbr>.destructure<wbr>.intro]</span></a>
</div>

<p>模式可以用来 <em>解构</em> <a href="#结构体">结构体</a> 、 <a href="#枚举">枚举</a> 和 <a href="#元组类型">元组</a> 。
解构将一个值分解为其组成部分。
使用的 语法格式 与创建此类值时几乎相同。</p>
<div class="rule" id="r-patterns.destructure.wildcard"><a class="rule-link" href="#r-patterns.destructure.wildcard" title="patterns.destructure.wildcard"><span>[patterns<wbr>.destructure<wbr>.wildcard]</span></a>
</div>

<p>在 <a href="#scrutinee">被匹配</a> 表达式具有 结构体 、 枚举 或 元组 类型的模式中， <a href="#wildcard-pattern">通配符模式</a> (<code>_</code>) 代表 <em>单个</em> 数据字段，而 <a href="#grammar-StructPatternEtCetera">等等</a> 或 <a href="#r-patterns.rest">剩余模式</a> (<code>..</code>) 代表特定变体的 <em>所有</em> 剩余字段。</p>
<div class="rule" id="r-patterns.destructure.named-field-shorthand"><a class="rule-link" href="#r-patterns.destructure.named-field-shorthand" title="patterns.destructure.named-field-shorthand"><span>[patterns<wbr>.destructure<wbr>.named-field-shorthand]</span></a>
</div>

<p>当解构具有命名（但未编号）字段的数据结构时，允许将 <code>fieldname</code> 简写为 <code>fieldname: fieldname</code> 。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">enum Message {
</span><span class="boring">    Quit,
</span><span class="boring">    WriteString(String),
</span><span class="boring">    Move { x: i32, y: i32 },
</span><span class="boring">    ChangeColor(u8, u8, u8),
</span><span class="boring">}
</span><span class="boring">let message = Message::Quit;
</span>match message {
    Message::Quit =&gt; println!("Quit"),
    Message::WriteString(write) =&gt; println!("{}", &amp;write),
    Message::Move{ x, y: 0 } =&gt; println!("move {} horizontally", x),
    Message::Move{ .. } =&gt; println!("other move"),
    Message::ChangeColor { 0: red, 1: green, 2: _ } =&gt; {
        println!("color change, red: {}, green: {}", red, green);
    }
};
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.refutable"><a class="rule-link" href="#r-patterns.refutable" title="patterns.refutable"><span>[patterns<wbr>.refutable]</span></a>
</div>

<h2 id="可反驳性"><a class="header" href="#可反驳性">可反驳性</a></h2>
<p>当一个模式有可能不与其匹配的值相匹配时，该模式被称为是 <em>可反驳的</em> 。
另一方面， <em>不可反驳的</em> 模式总是匹配它们所针对的值。
示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let (x, y) = (1, 2);               // "(x, y)" 是一个不可反驳的模式

if let (a, 3) = (1, 2) {           // "(a, 3)" 是可反驳的，且不会匹配
    panic!("Shouldn't reach here");
} else if let (a, 4) = (3, 4) {    // "(a, 4)" 是可反驳的，且会匹配
    println!("Matched ({}, 4)", a);
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.literal"><a class="rule-link" href="#r-patterns.literal" title="patterns.literal"><span>[patterns<wbr>.literal]</span></a>
</div>

<h2 id="字面量模式"><a class="header" href="#字面量模式">字面量模式</a></h2>
<div class="rule" id="r-patterns.literal.syntax"><a class="rule-link" href="#r-patterns.literal.syntax" title="patterns.literal.syntax"><span>[patterns<wbr>.literal<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-LiteralPattern" onclick="show_railroad()"><a href="#railroad-LiteralPattern">LiteralPattern</a></span> → <span class="grammar-literal">-</span><sup>?</sup> <span class="grammar-text"><a href="#grammar-LiteralExpression">LiteralExpression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 312px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-LiteralPattern"><svg class="railroad" viewbox="0 0 312 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-LiteralPattern">
<text class="comment" x="64" y="25">
LiteralPattern</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="55" />
<text x="73" y="71">
-</text>
</g>
</g>
<a class="link" xlink:href="#railroad-LiteralExpression">
<g class="nonterminal">
<rect height="22" width="156" x="121" y="55" />
<text x="199" y="71">
LiteralExpression</text>
</g>
</a>
<path d=" M 111 66 h 10" />
</g>
<path d=" M 287 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 277 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-patterns.literal.intro"><a class="rule-link" href="#r-patterns.literal.intro" title="patterns.literal.intro"><span>[patterns<wbr>.literal<wbr>.intro]</span></a>
</div>

<p><em>字面量模式</em> 匹配的值与字面量创建的值完全相同。由于负数不是 <a href="#字面量表达式">字面量</a> ，模式中的字面量可以前缀一个可选的减号，其作用类似于取反运算符。</p>
<div class="alert alert-warning">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>警告</p>

<p>C string and raw C string literals are accepted in literal patterns, but <code>&amp;CStr</code> doesn’t implement structural equality (<code>#[derive(Eq, PartialEq)]</code>) and therefore any such <code>match</code> on a <code>&amp;CStr</code> will be rejected with a type error.</p>
</blockquote>
</div>

<div class="rule" id="r-patterns.literal.refutable"><a class="rule-link" href="#r-patterns.literal.refutable" title="patterns.literal.refutable"><span>[patterns<wbr>.literal<wbr>.refutable]</span></a>
</div>

<p>字面量模式始终是可反驳的。</p>
<p>示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>for i in -2..5 {
    match i {
        -1 =&gt; println!("It's minus one"),
        1 =&gt; println!("It's a one"),
        2|4 =&gt; println!("It's either a two or a four"),
        _ =&gt; println!("Matched none of the arms"),
    }
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.ident"><a class="rule-link" href="#r-patterns.ident" title="patterns.ident"><span>[patterns<wbr>.ident]</span></a>
</div>

<h2 id="标识符模式"><a class="header" href="#标识符模式">标识符模式</a></h2>
<div class="rule" id="r-patterns.ident.syntax"><a class="rule-link" href="#r-patterns.ident.syntax" title="patterns.ident.syntax"><span>[patterns<wbr>.ident<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-IdentifierPattern" onclick="show_railroad()"><a href="#railroad-IdentifierPattern">IdentifierPattern</a></span> → <span class="grammar-literal">ref</span><sup>?</sup> <span class="grammar-literal">mut</span><sup>?</sup> <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> ( <span class="grammar-literal">@</span> <span class="grammar-text"><a href="#grammar-PatternNoTopAlt">PatternNoTopAlt</a></span> )<sup>?</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 610px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-IdentifierPattern"><svg class="railroad" viewbox="0 0 610 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-IdentifierPattern">
<text class="comment" x="74" y="25">
IdentifierPattern</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 44 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="55" />
<text x="81" y="71">
ref</text>
</g>
</g>
<g class="optional">
<path d=" M 137 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 44 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="161" y="55" />
<text x="183" y="71">
mut</text>
</g>
</g>
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="239" y="55" />
<text x="289" y="71">
IDENTIFIER</text>
</g>
</a>
<g class="optional">
<path d=" M 349 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 178 m -86 0 l -5 -5 m 0 10 l 5 -5 m 86 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="373" y="55" />
<text x="387" y="71">
@</text>
</g>
<a class="link" xlink:href="#railroad-PatternNoTopAlt">
<g class="nonterminal">
<rect height="22" width="140" x="411" y="55" />
<text x="481" y="71">
PatternNoTopAlt</text>
</g>
</a>
<path d=" M 401 66 h 10" />
</g>
</g>
<path d=" M 127 66 h 10" />
<path d=" M 229 66 h 10" />
<path d=" M 339 66 h 10" />
</g>
<path d=" M 585 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 575 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-patterns.ident.intro"><a class="rule-link" href="#r-patterns.ident.intro" title="patterns.ident.intro"><span>[patterns<wbr>.ident<wbr>.intro]</span></a>
</div>

<p>标识符模式将它们匹配的值绑定到 <a href="#r-names.namespaces.kinds">值命名空间</a> 中的变量。</p>
<div class="rule" id="r-patterns.ident.unique"><a class="rule-link" href="#r-patterns.ident.unique" title="patterns.ident.unique"><span>[patterns<wbr>.ident<wbr>.unique]</span></a>
</div>

<p>标识符在模式中必须是唯一的。</p>
<div class="rule" id="r-patterns.ident.scope"><a class="rule-link" href="#r-patterns.ident.scope" title="patterns.ident.scope"><span>[patterns<wbr>.ident<wbr>.scope]</span></a>
</div>

<p>该变量将遮蔽作用域中同名的任何变量。
新绑定的 <a href="#作用域">作用域</a> 取决于使用模式的上下文（例如 <code>let</code> 绑定或 <code>match</code> 臂）。</p>
<div class="rule" id="r-patterns.ident.bare"><a class="rule-link" href="#r-patterns.ident.bare" title="patterns.ident.bare"><span>[patterns<wbr>.ident<wbr>.bare]</span></a>
</div>

<p>仅由标识符（可能带有 <code>mut</code> ）组成的模式匹配任何值并将其绑定到该标识符。
这是变量声明以及函数和闭包参数中最常用的模式。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut variable = 10;
fn sum(x: i32, y: i32) -&gt; i32 {
<span class="boring">   x + y
</span><span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.ident.scrutinized"><a class="rule-link" href="#r-patterns.ident.scrutinized" title="patterns.ident.scrutinized"><span>[patterns<wbr>.ident<wbr>.scrutinized]</span></a>
</div>

<p>要将模式匹配的值绑定到变量，请使用 <code>variable @ subpattern</code> 语法格式。
例如，下面将值 2 绑定到 <code>e</code> （不是整个范围：这里的范围是一个范围子模式）。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = 2;

match x {
    e @ 1 ..= 5 =&gt; println!("got a range element {}", e),
    _ =&gt; println!("anything"),
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.ident.move"><a class="rule-link" href="#r-patterns.ident.move" title="patterns.ident.move"><span>[patterns<wbr>.ident<wbr>.move]</span></a>
</div>

<p>默认情况下，标识符模式根据被匹配值是否实现了 <a href="../core/marker/trait.Copy.html">Copy</a> ，将变量绑定到被匹配值的副本或从中移动。</p>
<div class="rule" id="r-patterns.ident.ref"><a class="rule-link" href="#r-patterns.ident.ref" title="patterns.ident.ref"><span>[patterns<wbr>.ident<wbr>.ref]</span></a>
</div>

<p>这可以通过使用 <code>ref</code> 关键字更改为绑定到引用，或者使用 <code>ref mut</code> 更改为可变引用。例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">let a = Some(10);
</span>match a {
    None =&gt; (),
    Some(value) =&gt; (),
}

match a {
    None =&gt; (),
    Some(ref value) =&gt; (),
}
<span class="boring">}</span></code></pre>
<p>在第一个 match 表达式中，值被复制（或移动）。
在第二个 match 中，指向相同内存位置的引用被绑定到变量值。
需要此语法格式是因为在解构子模式中， <code>&amp;</code> 运算符不能应用于值的字段。
例如，以下内容无效：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct Person {
</span><span class="boring">   name: String,
</span><span class="boring">   age: u8,
</span><span class="boring">}
</span><span class="boring">let value = Person { name: String::from("John"), age: 23 };
</span>if let Person { name: &amp;person_name, age: 18..=150 } = value { }
<span class="boring">}</span></code></pre>
<p>为了使其有效，请编写以下内容：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct Person {
</span><span class="boring">   name: String,
</span><span class="boring">   age: u8,
</span><span class="boring">}
</span><span class="boring">let value = Person { name: String::from("John"), age: 23 };
</span>if let Person { name: ref person_name, age: 18..=150 } = value { }
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.ident.ref-ignored"><a class="rule-link" href="#r-patterns.ident.ref-ignored" title="patterns.ident.ref-ignored"><span>[patterns<wbr>.ident<wbr>.ref-ignored]</span></a>
</div>

<p>因此， <code>ref</code> 不是被匹配的对象。
它的目的完全是为了使匹配的绑定成为引用，而不是潜在地复制或移动匹配的内容。</p>
<div class="rule" id="r-patterns.ident.precedent"><a class="rule-link" href="#r-patterns.ident.precedent" title="patterns.ident.precedent"><span>[patterns<wbr>.ident<wbr>.precedent]</span></a>
</div>

<p><a href="#path-patterns">路径模式</a> 优先于标识符模式。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>When a pattern is a single-segment identifier, the grammar is ambiguous whether it means an <a href="#grammar-IdentifierPattern">IdentifierPattern</a> or a <a href="#grammar-PathPattern">PathPattern</a>. This ambiguity can only be resolved after <a href="#名称解析">name resolution</a>.</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>const EXPECTED_VALUE: u8 = 42;
//    ^^^^^^^^^^^^^^ 此常量在作用域内会影响下面模式的处理方式。
//                   patterns below are treated.

fn check_value(x: u8) -&gt; Result&lt;u8, u8&gt; {
    match x {
        EXPECTED_VALUE =&gt; Ok(x),
    //  ^^^^^^^^^^^^^^ 被解析为解析为常量 `42` 的 `PathPattern` 。
    //                 the constant `42`.
        other_value =&gt; Err(x),
    //  ^^^^^^^^^^^ 被解析为 `IdentifierPattern` 。
    }
}

// If `EXPECTED_VALUE` were treated as an `IdentifierPattern` above,
// that pattern would always match, making the function always return
// `Ok(_) regardless of the input.
assert_eq!(check_value(42), Ok(42));
assert_eq!(check_value(43), Err(43));
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-patterns.ident.constraint"><a class="rule-link" href="#r-patterns.ident.constraint" title="patterns.ident.constraint"><span>[patterns<wbr>.ident<wbr>.constraint]</span></a>
</div>

<p>如果指定了 <code>ref</code> 或 <code>ref mut</code> 且标识符遮蔽了常量，则这是一个错误。</p>
<div class="rule" id="r-patterns.ident.refutable"><a class="rule-link" href="#r-patterns.ident.refutable" title="patterns.ident.refutable"><span>[patterns<wbr>.ident<wbr>.refutable]</span></a>
</div>

<p>如果 <code>@</code> 子模式是不可反驳的或者没有指定子模式，则标识符模式是不可反驳的。</p>
<div class="rule" id="r-patterns.ident.binding"><a class="rule-link" href="#r-patterns.ident.binding" title="patterns.ident.binding"><span>[patterns<wbr>.ident<wbr>.binding]</span></a>
</div>

<h3 id="绑定模式"><a class="header" href="#绑定模式">绑定模式</a></h3>
<div class="rule" id="r-patterns.ident.binding.intro"><a class="rule-link" href="#r-patterns.ident.binding.intro" title="patterns.ident.binding.intro"><span>[patterns<wbr>.ident<wbr>.binding<wbr>.intro]</span></a>
</div>

<p>为了提供更好的易用性，模式以不同的 <em>绑定模式</em> 运行，以便更轻松地将引用绑定到值。
当非引用模式匹配引用值时，它将自动被视为 <code>ref</code> 或 <code>ref mut</code> 绑定。
示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x: &amp;Option&lt;i32&gt; = &amp;Some(3);
if let Some(y) = x {
    // y 被转换为 `ref y` 且其类型为 &amp;i32
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.ident.binding.non-reference"><a class="rule-link" href="#r-patterns.ident.binding.non-reference" title="patterns.ident.binding.non-reference"><span>[patterns<wbr>.ident<wbr>.binding<wbr>.non-reference]</span></a>
</div>

<p><em>非引用模式</em> 包括除绑定、 <a href="#wildcard-pattern">通配符模式</a> (<code>_</code>) 、引用类型的 <a href="#path-patterns"><code>const</code> 模式</a> 以及 <a href="#reference-patterns">引用模式</a> 之外的所有模式。</p>
<div class="rule" id="r-patterns.ident.binding.default-mode"><a class="rule-link" href="#r-patterns.ident.binding.default-mode" title="patterns.ident.binding.default-mode"><span>[patterns<wbr>.ident<wbr>.binding<wbr>.default-mode]</span></a>
</div>

<p>如果绑定模式没有显式具有 <code>ref</code> 、 <code>ref mut</code> 或 <code>mut</code> ，那么它使用 <em>默认绑定模式</em> 来确定变量如何绑定。</p>
<div class="rule" id="r-patterns.ident.binding.move"><a class="rule-link" href="#r-patterns.ident.binding.move" title="patterns.ident.binding.move"><span>[patterns<wbr>.ident<wbr>.binding<wbr>.move]</span></a>
</div>

<p>默认绑定模式以使用移动语义的 “move” 模式开始。</p>
<div class="rule" id="r-patterns.ident.binding.top-down"><a class="rule-link" href="#r-patterns.ident.binding.top-down" title="patterns.ident.binding.top-down"><span>[patterns<wbr>.ident<wbr>.binding<wbr>.top-down]</span></a>
</div>

<p>匹配模式时，编译器从模式外部开始并向内工作。</p>
<div class="rule" id="r-patterns.ident.binding.auto-deref"><a class="rule-link" href="#r-patterns.ident.binding.auto-deref" title="patterns.ident.binding.auto-deref"><span>[patterns<wbr>.ident<wbr>.binding<wbr>.auto-deref]</span></a>
</div>

<p>每当使用非引用模式匹配引用时，它会自动解引用该值并更新默认绑定模式。</p>
<div class="rule" id="r-patterns.ident.binding.ref"><a class="rule-link" href="#r-patterns.ident.binding.ref" title="patterns.ident.binding.ref"><span>[patterns<wbr>.ident<wbr>.binding<wbr>.ref]</span></a>
</div>

<p>引用将默认绑定模式设置为 <code>ref</code> 。</p>
<div class="rule" id="r-patterns.ident.binding.ref-mut"><a class="rule-link" href="#r-patterns.ident.binding.ref-mut" title="patterns.ident.binding.ref-mut"><span>[patterns<wbr>.ident<wbr>.binding<wbr>.ref-mut]</span></a>
</div>

<p>可变引用将模式设置为 <code>ref mut</code> ，除非模式已经是 <code>ref</code> ，在这种情况下它保持为 <code>ref</code> 。</p>
<div class="rule" id="r-patterns.ident.binding.nested-references"><a class="rule-link" href="#r-patterns.ident.binding.nested-references" title="patterns.ident.binding.nested-references"><span>[patterns<wbr>.ident<wbr>.binding<wbr>.nested-references]</span></a>
</div>

<p>如果自动解引用的值仍然是引用，则对其进行解引用并重复此过程。</p>
<div class="rule" id="r-patterns.ident.binding.mode-limitations-binding"><a class="rule-link" href="#r-patterns.ident.binding.mode-limitations-binding" title="patterns.ident.binding.mode-limitations-binding"><span>[patterns<wbr>.ident<wbr>.binding<wbr>.mode-limitations-binding]</span></a>
</div>

<p>只有当默认绑定模式为 “move” 时，绑定模式才可以显式指定 <code>ref</code> 或 <code>ref mut</code> 绑定模式，或者使用 <code>mut</code> 指定可变性。例如，这些是不被接受的：</p>
<pre class="playground"><code class="language-rust edition2024 compile_fail"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let [mut x] = &amp;[()]; //~ ERROR
let [ref x] = &amp;[()]; //~ ERROR
let [ref mut x] = &amp;mut [()]; //~ ERROR
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.ident.binding.mode-limitations.edition2024"><a class="rule-link" href="#r-patterns.ident.binding.mode-limitations.edition2024" title="patterns.ident.binding.mode-limitations.edition2024"><span>[patterns<wbr>.ident<wbr>.binding<wbr>.mode-limitations<wbr>.edition2024]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2024</span> 版次差异</p>

<p>Before the 2024 edition, bindings could explicitly specify a <code>ref</code> or <code>ref mut</code> binding mode even when the default binding mode was not “move”, and they could specify mutability on such bindings with <code>mut</code>. In these editions, specifying <code>mut</code> on a binding set the binding mode to “move” regardless of the current default binding mode.</p>
</blockquote>
</div>

<div class="rule" id="r-patterns.ident.binding.mode-limitations-reference"><a class="rule-link" href="#r-patterns.ident.binding.mode-limitations-reference" title="patterns.ident.binding.mode-limitations-reference"><span>[patterns<wbr>.ident<wbr>.binding<wbr>.mode-limitations-reference]</span></a>
</div>

<p>类似地，引用模式仅在默认绑定模式为 “move” 时出现。例如，这是不被接受的：</p>
<pre class="playground"><code class="language-rust edition2024 compile_fail"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let [&amp;x] = &amp;[&amp;()]; //~ ERROR
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.ident.binding.mode-limitations-reference.edition2024"><a class="rule-link" href="#r-patterns.ident.binding.mode-limitations-reference.edition2024" title="patterns.ident.binding.mode-limitations-reference.edition2024"><span>[patterns<wbr>.ident<wbr>.binding<wbr>.mode-limitations-reference<wbr>.edition2024]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2024</span> 版次差异</p>

<p>Before the 2024 edition, reference patterns could appear even when the default binding mode was not “move”, and had both the effect of matching against the scrutinee and of causing the default binding mode to be reset to “move”.</p>
</blockquote>
</div>

<div class="rule" id="r-patterns.ident.binding.mixed"><a class="rule-link" href="#r-patterns.ident.binding.mixed" title="patterns.ident.binding.mixed"><span>[patterns<wbr>.ident<wbr>.binding<wbr>.mixed]</span></a>
</div>

<p>移动绑定和引用绑定可以混合在同一个模式中。
这样做会导致绑定到的对象发生部分移动，之后该对象将无法使用。
这仅在类型不可复制时适用。</p>
<p>在下面的示例中， <code>name</code> 从 <code>person</code> 中移出。
尝试将 <code>person</code> 作为一个整体使用或使用 <code>person.name</code> 会因为 <em>部分移动</em> 而导致错误。</p>
<p>示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct Person {
</span><span class="boring">   name: String,
</span><span class="boring">   age: u8,
</span><span class="boring">}
</span><span class="boring">let person = Person{ name: String::from("John"), age: 23 };
</span>// `name` 从 person 中移出且 `age` 被引用
let Person { name, ref age } = person;
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.wildcard"><a class="rule-link" href="#r-patterns.wildcard" title="patterns.wildcard"><span>[patterns<wbr>.wildcard]</span></a>
</div>

<h2 id="通配符模式"><a class="header" href="#通配符模式">通配符模式</a></h2>
<div class="rule" id="r-patterns.wildcard.syntax"><a class="rule-link" href="#r-patterns.wildcard.syntax" title="patterns.wildcard.syntax"><span>[patterns<wbr>.wildcard<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-WildcardPattern" onclick="show_railroad()"><a href="#railroad-WildcardPattern">WildcardPattern</a></span> → <span class="grammar-literal">_</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 135px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-WildcardPattern"><svg class="railroad" viewbox="0 0 135 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-WildcardPattern">
<text class="comment" x="67" y="25">
WildcardPattern</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="42" />
<text x="49" y="58">
_</text>
</g>
<path d=" M 73 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 63 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-patterns.wildcard.intro"><a class="rule-link" href="#r-patterns.wildcard.intro" title="patterns.wildcard.intro"><span>[patterns<wbr>.wildcard<wbr>.intro]</span></a>
</div>

<p><em>通配符模式</em> （下划线符号）匹配任何值。
它用于在值无关紧要时忽略它们。</p>
<div class="rule" id="r-patterns.wildcard.struct-matcher"><a class="rule-link" href="#r-patterns.wildcard.struct-matcher" title="patterns.wildcard.struct-matcher"><span>[patterns<wbr>.wildcard<wbr>.struct-matcher]</span></a>
</div>

<p>在其他模式内部，它匹配单个数据字段（与匹配剩余字段的 <code>..</code> 相反）。</p>
<div class="rule" id="r-patterns.wildcard.no-binding"><a class="rule-link" href="#r-patterns.wildcard.no-binding" title="patterns.wildcard.no-binding"><span>[patterns<wbr>.wildcard<wbr>.no-binding]</span></a>
</div>

<p>与标识符模式不同，它不会复制、移动或借用它匹配的值。</p>
<p>示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">let x = 20;
</span>let (a, _) = (10, x);   // x 始终被 _ 匹配
<span class="boring">assert_eq!(a, 10);
</span>
// 忽略一个函数/闭包参数
let real_part = |a: f64, _: f64| { a };

// 忽略 结构体 中的一个字段
<span class="boring">struct RGBA {
</span><span class="boring">   r: f32,
</span><span class="boring">   g: f32,
</span><span class="boring">   b: f32,
</span><span class="boring">   a: f32,
</span><span class="boring">}
</span><span class="boring">let color = RGBA{r: 0.4, g: 0.1, b: 0.9, a: 0.5};
</span>let RGBA{r: red, g: green, b: blue, a: _} = color;
<span class="boring">assert_eq!(color.r, red);
</span><span class="boring">assert_eq!(color.g, green);
</span><span class="boring">assert_eq!(color.b, blue);
</span>
// 接受任何 Some，无论其值为何
<span class="boring">let x = Some(10);
</span>if let Some(_) = x {}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.wildcard.refutable"><a class="rule-link" href="#r-patterns.wildcard.refutable" title="patterns.wildcard.refutable"><span>[patterns<wbr>.wildcard<wbr>.refutable]</span></a>
</div>

<p>通配符模式始终是不可反驳的。</p>
<div class="rule" id="r-patterns.rest"><a class="rule-link" href="#r-patterns.rest" title="patterns.rest"><span>[patterns<wbr>.rest]</span></a>
</div>

<h2 id="剩余模式"><a class="header" href="#剩余模式">剩余模式</a></h2>
<div class="rule" id="r-patterns.rest.syntax"><a class="rule-link" href="#r-patterns.rest.syntax" title="patterns.rest.syntax"><span>[patterns<wbr>.rest<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-RestPattern" onclick="show_railroad()"><a href="#railroad-RestPattern">RestPattern</a></span> → <span class="grammar-literal">..</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 107px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RestPattern"><svg class="railroad" viewbox="0 0 107 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RestPattern">
<text class="comment" x="53" y="25">
RestPattern</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="42" />
<text x="53" y="58">
..</text>
</g>
<path d=" M 81 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 71 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-patterns.rest.intro"><a class="rule-link" href="#r-patterns.rest.intro" title="patterns.rest.intro"><span>[patterns<wbr>.rest<wbr>.intro]</span></a>
</div>

<p><em>剩余模式</em> （ <code>..</code> 词法单元）充当变长模式，匹配前后尚未匹配的零个或多个元素。</p>
<div class="rule" id="r-patterns.rest.allowed-patterns"><a class="rule-link" href="#r-patterns.rest.allowed-patterns" title="patterns.rest.allowed-patterns"><span>[patterns<wbr>.rest<wbr>.allowed-patterns]</span></a>
</div>

<p>它只能用于 <a href="#tuple-patterns">元组</a> 、 <a href="#tuple-struct-patterns">元组结构体</a> 和 <a href="#slice-patterns">切片</a> 模式，并且只能作为这些模式中的元素之一出现一次。
仅对于 <a href="#slice-patterns">切片模式</a> ，它也允许在 <a href="#identifier-patterns">标识符模式</a> 中使用。</p>
<div class="rule" id="r-patterns.rest.refutable"><a class="rule-link" href="#r-patterns.rest.refutable" title="patterns.rest.refutable"><span>[patterns<wbr>.rest<wbr>.refutable]</span></a>
</div>

<p>剩余模式始终是不可反驳的。</p>
<p>示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">let words = vec!["a", "b", "c"];
</span><span class="boring">let slice = &amp;words[..];
</span>match slice {
    [] =&gt; println!("slice is empty"),
    [one] =&gt; println!("single element {}", one),
    [head, tail @ ..] =&gt; println!("head={} tail={:?}", head, tail),
}

match slice {
    // 忽略除最后一个元素（必须是 "!"）之外的所有内容。
    [.., "!"] =&gt; println!("!!!"),

    // `start` 是除最后一个元素（必须是 "z"）之外的所有内容的切片。
    [start @ .., "z"] =&gt; println!("starts with: {:?}", start),

    // `end` 是除第一个元素（必须是 "a"）之外的所有内容的切片。
    ["a", end @ ..] =&gt; println!("ends with: {:?}", end),

    // 'whole' 是整个切片且 `last` 是最后一个元素
    whole @ [.., last] =&gt; println!("the last element of {:?} is {}", whole, last),

    rest =&gt; println!("{:?}", rest),
}

if let [.., penultimate, _] = slice {
    println!("next to last is {}", penultimate);
}

<span class="boring">let tuple = (1, 2, 3, 4, 5);
</span>// 剩余模式也可用于元组和元组
// 结构体模式。
match tuple {
    (1, .., y, z) =&gt; println!("y={} z={}", y, z),
    (.., 5) =&gt; println!("tail must be 5"),
    (..) =&gt; println!("matches everything else"),
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.range"><a class="rule-link" href="#r-patterns.range" title="patterns.range"><span>[patterns<wbr>.range]</span></a>
</div>

<h2 id="范围模式"><a class="header" href="#范围模式">范围模式</a></h2>
<div class="rule" id="r-patterns.range.syntax"><a class="rule-link" href="#r-patterns.range.syntax" title="patterns.range.syntax"><span>[patterns<wbr>.range<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-RangePattern" onclick="show_railroad()"><a href="#railroad-RangePattern">RangePattern</a></span> → <br>      <span class="grammar-text"><a href="#grammar-RangeExclusivePattern">RangeExclusivePattern</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RangeInclusivePattern">RangeInclusivePattern</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RangeFromPattern">RangeFromPattern</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RangeToExclusivePattern">RangeToExclusivePattern</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RangeToInclusivePattern">RangeToInclusivePattern</a></span> <br>    | <span class="grammar-text"><a href="#grammar-ObsoleteRangePattern">ObsoleteRangePattern</a></span>​<sup class="footnote-reference" id="fr-obsolete-range-edition-1"><a href="#footnote-obsolete-range-edition">1</a></sup></p>
<p><span class="grammar-text grammar-production" id="grammar-RangeExclusivePattern" onclick="show_railroad()"><a href="#railroad-RangeExclusivePattern">RangeExclusivePattern</a></span> → <br>      <span class="grammar-text"><a href="#grammar-RangePatternBound">RangePatternBound</a></span> <span class="grammar-literal">..</span> <span class="grammar-text"><a href="#grammar-RangePatternBound">RangePatternBound</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-RangeInclusivePattern" onclick="show_railroad()"><a href="#railroad-RangeInclusivePattern">RangeInclusivePattern</a></span> → <br>      <span class="grammar-text"><a href="#grammar-RangePatternBound">RangePatternBound</a></span> <span class="grammar-literal">..=</span> <span class="grammar-text"><a href="#grammar-RangePatternBound">RangePatternBound</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-RangeFromPattern" onclick="show_railroad()"><a href="#railroad-RangeFromPattern">RangeFromPattern</a></span> → <br>      <span class="grammar-text"><a href="#grammar-RangePatternBound">RangePatternBound</a></span> <span class="grammar-literal">..</span></p>
<p><span class="grammar-text grammar-production" id="grammar-RangeToExclusivePattern" onclick="show_railroad()"><a href="#railroad-RangeToExclusivePattern">RangeToExclusivePattern</a></span> → <br>      <span class="grammar-literal">..</span> <span class="grammar-text"><a href="#grammar-RangePatternBound">RangePatternBound</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-RangeToInclusivePattern" onclick="show_railroad()"><a href="#railroad-RangeToInclusivePattern">RangeToInclusivePattern</a></span> → <br>      <span class="grammar-literal">..=</span> <span class="grammar-text"><a href="#grammar-RangePatternBound">RangePatternBound</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-ObsoleteRangePattern" onclick="show_railroad()"><a href="#railroad-ObsoleteRangePattern">ObsoleteRangePattern</a></span> → <br>    <span class="grammar-text"><a href="#grammar-RangePatternBound">RangePatternBound</a></span> <span class="grammar-literal">...</span> <span class="grammar-text"><a href="#grammar-RangePatternBound">RangePatternBound</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-RangePatternBound" onclick="show_railroad()"><a href="#railroad-RangePatternBound">RangePatternBound</a></span> → <br>      <span class="grammar-text"><a href="#grammar-LiteralPattern">LiteralPattern</a></span> <br>    | <span class="grammar-text"><a href="#grammar-PathExpression">PathExpression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 330px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RangePattern"><svg class="railroad" viewbox="0 0 330 239" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RangePattern">
<text class="comment" x="57" y="25">
RangePattern</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 196 0 h 40" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RangeExclusivePattern">
<g class="nonterminal">
<rect height="22" width="196" x="59" y="42" />
<text x="157" y="58">
RangeExclusivePattern</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 236 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 236 0 v -33" />
<path d=" M 47 107 v 33 m 236 0 v -33" />
<path d=" M 47 140 v 33 m 236 0 v -33" />
<path d=" M 47 173 v 33 m 236 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 196 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RangeInclusivePattern">
<g class="nonterminal">
<rect height="22" width="196" x="59" y="75" />
<text x="157" y="91">
RangeInclusivePattern</text>
</g>
</a>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 148 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RangeFromPattern">
<g class="nonterminal">
<rect height="22" width="148" x="59" y="108" />
<text x="133" y="124">
RangeFromPattern</text>
</g>
</a>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 212 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RangeToExclusivePattern">
<g class="nonterminal">
<rect height="22" width="212" x="59" y="141" />
<text x="165" y="157">
RangeToExclusivePattern</text>
</g>
</a>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 212 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RangeToInclusivePattern">
<g class="nonterminal">
<rect height="22" width="212" x="59" y="174" />
<text x="165" y="190">
RangeToInclusivePattern</text>
</g>
</a>
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 188 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-ObsoleteRangePattern">
<g class="nonterminal">
<rect height="22" width="188" x="59" y="207" />
<text x="153" y="223">
ObsoleteRangePattern</text>
</g>
</a>
</g>
<path d=" M 305 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 295 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 438px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RangeExclusivePattern"><svg class="railroad" viewbox="0 0 438 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RangeExclusivePattern">
<text class="comment" x="92" y="25">
RangeExclusivePattern</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RangePatternBound">
<g class="nonterminal">
<rect height="22" width="156" x="35" y="42" />
<text x="113" y="58">
RangePatternBound</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="201" y="42" />
<text x="219" y="58">
..</text>
</g>
<a class="link" xlink:href="#railroad-RangePatternBound">
<g class="nonterminal">
<rect height="22" width="156" x="247" y="42" />
<text x="325" y="58">
RangePatternBound</text>
</g>
</a>
<path d=" M 191 53 h 10" />
<path d=" M 237 53 h 10" />
</g>
<path d=" M 413 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 403 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 446px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RangeInclusivePattern"><svg class="railroad" viewbox="0 0 446 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RangeInclusivePattern">
<text class="comment" x="92" y="25">
RangeInclusivePattern</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RangePatternBound">
<g class="nonterminal">
<rect height="22" width="156" x="35" y="42" />
<text x="113" y="58">
RangePatternBound</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="201" y="42" />
<text x="223" y="58">
..=</text>
</g>
<a class="link" xlink:href="#railroad-RangePatternBound">
<g class="nonterminal">
<rect height="22" width="156" x="255" y="42" />
<text x="333" y="58">
RangePatternBound</text>
</g>
</a>
<path d=" M 191 53 h 10" />
<path d=" M 245 53 h 10" />
</g>
<path d=" M 421 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 411 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 272px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RangeFromPattern"><svg class="railroad" viewbox="0 0 272 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RangeFromPattern">
<text class="comment" x="71" y="25">
RangeFromPattern</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RangePatternBound">
<g class="nonterminal">
<rect height="22" width="156" x="35" y="42" />
<text x="113" y="58">
RangePatternBound</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="201" y="42" />
<text x="219" y="58">
..</text>
</g>
<path d=" M 191 53 h 10" />
</g>
<path d=" M 247 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 237 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 272px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RangeToExclusivePattern"><svg class="railroad" viewbox="0 0 272 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RangeToExclusivePattern">
<text class="comment" x="99" y="25">
RangeToExclusivePattern</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="42" />
<text x="53" y="58">
..</text>
</g>
<a class="link" xlink:href="#railroad-RangePatternBound">
<g class="nonterminal">
<rect height="22" width="156" x="81" y="42" />
<text x="159" y="58">
RangePatternBound</text>
</g>
</a>
<path d=" M 71 53 h 10" />
</g>
<path d=" M 247 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 237 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 280px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RangeToInclusivePattern"><svg class="railroad" viewbox="0 0 280 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RangeToInclusivePattern">
<text class="comment" x="99" y="25">
RangeToInclusivePattern</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="42" />
<text x="57" y="58">
..=</text>
</g>
<a class="link" xlink:href="#railroad-RangePatternBound">
<g class="nonterminal">
<rect height="22" width="156" x="89" y="42" />
<text x="167" y="58">
RangePatternBound</text>
</g>
</a>
<path d=" M 79 53 h 10" />
</g>
<path d=" M 255 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 245 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 446px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ObsoleteRangePattern"><svg class="railroad" viewbox="0 0 446 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ObsoleteRangePattern">
<text class="comment" x="88" y="25">
ObsoleteRangePattern</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RangePatternBound">
<g class="nonterminal">
<rect height="22" width="156" x="35" y="42" />
<text x="113" y="58">
RangePatternBound</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="201" y="42" />
<text x="223" y="58">
...</text>
</g>
<a class="link" xlink:href="#railroad-RangePatternBound">
<g class="nonterminal">
<rect height="22" width="156" x="255" y="42" />
<text x="333" y="58">
RangePatternBound</text>
</g>
</a>
<path d=" M 191 53 h 10" />
<path d=" M 245 53 h 10" />
</g>
<path d=" M 421 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 411 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 250px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RangePatternBound"><svg class="railroad" viewbox="0 0 250 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RangePatternBound">
<text class="comment" x="74" y="25">
RangePatternBound</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 132 0 h 24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-LiteralPattern">
<g class="nonterminal">
<rect height="22" width="132" x="59" y="42" />
<text x="125" y="58">
LiteralPattern</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 156 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 132 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-PathExpression">
<g class="nonterminal">
<rect height="22" width="132" x="59" y="75" />
<text x="125" y="91">
PathExpression</text>
</g>
</a>
</g>
<path d=" M 225 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 215 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-patterns.range.intro"><a class="rule-link" href="#r-patterns.range.intro" title="patterns.range.intro"><span>[patterns<wbr>.range<wbr>.intro]</span></a>
</div>

<p><em>范围模式</em> 匹配由其边界定义的范围内的标量值。
它们包含一个 <em>符号</em> （ <code>..</code> 或 <code>..=</code> ）和一侧或两侧的边界。</p>
<p>符号左侧的边界称为 <em>下边界</em> 。
右侧的边界称为 <em>上边界</em> 。</p>
<div class="rule" id="r-patterns.range.exclusive"><a class="rule-link" href="#r-patterns.range.exclusive" title="patterns.range.exclusive"><span>[patterns<wbr>.range<wbr>.exclusive]</span></a>
</div>

<p><em>排他性范围模式</em> 匹配从下边界到（但不包括）上边界的所有值。
它写为下边界，后跟 <code>..</code> ，再后跟上边界。</p>
<p>例如，模式 <code>'m'..'p'</code> 将仅匹配 <code>'m'</code> 、 <code>'n'</code> 和 <code>'o'</code> ，特别 <strong>不</strong> 包括 <code>'p'</code> 。</p>
<div class="rule" id="r-patterns.range.inclusive"><a class="rule-link" href="#r-patterns.range.inclusive" title="patterns.range.inclusive"><span>[patterns<wbr>.range<wbr>.inclusive]</span></a>
</div>

<p><em>包含性范围模式</em> 匹配从下边界到并包括上边界的所有值。
它写为下边界，后跟 <code>..=</code> ，再后跟上边界。</p>
<p>例如，模式 <code>'m'..='p'</code> 将仅匹配值 <code>'m'</code> 、 <code>'n'</code> 、 <code>'o'</code> 和 <code>'p'</code> 。</p>
<div class="rule" id="r-patterns.range.from"><a class="rule-link" href="#r-patterns.range.from" title="patterns.range.from"><span>[patterns<wbr>.range<wbr>.from]</span></a>
</div>

<p><em>起点范围模式</em> 匹配大于或等于下边界的所有值。
它写为下边界，后跟 <code>..</code> 。</p>
<p>例如， <code>1..</code> 将匹配任何大于或等于 1 的整数，如 1、9 或 9001，或者 9007199254740991（如果它具有适当的大小），但不匹配 0，对于有符号整数也不匹配负数。</p>
<div class="rule" id="r-patterns.range.to-exclusive"><a class="rule-link" href="#r-patterns.range.to-exclusive" title="patterns.range.to-exclusive"><span>[patterns<wbr>.range<wbr>.to-exclusive]</span></a>
</div>

<p><em>终点排他性范围模式</em> 匹配所有小于上边界的值。
它写为 <code>..</code> 后跟上边界。</p>
<p>例如， <code>..10</code> 将匹配任何小于 10 的整数，如 9、1、0，对于有符号整数类型，还匹配所有负值。</p>
<div class="rule" id="r-patterns.range.to-inclusive"><a class="rule-link" href="#r-patterns.range.to-inclusive" title="patterns.range.to-inclusive"><span>[patterns<wbr>.range<wbr>.to-inclusive]</span></a>
</div>

<p><em>终点包含性范围模式</em> 匹配所有小于或等于上边界的值。
它写为 <code>..=</code> 后跟上边界。</p>
<p>例如， <code>..=10</code> 将匹配任何小于或等于 10 的整数，如 10、1、0，对于有符号整数类型，还匹配所有负值。</p>
<div class="rule" id="r-patterns.range.constraint-nonempty"><a class="rule-link" href="#r-patterns.range.constraint-nonempty" title="patterns.range.constraint-nonempty"><span>[patterns<wbr>.range<wbr>.constraint-nonempty]</span></a>
</div>

<p>范围模式必须非空；它必须至少跨越其类型可能值集中的一个值。换句话说：</p>
<ul>
<li>在 <code>a..=b</code> 中，必须满足 a ≤ b。例如，出现范围模式 <code>10..=0</code> 是一个错误，但允许 <code>10..=10</code> 。</li>
<li>在 <code>a..b</code> 中，必须满足 a &lt; b。例如，出现范围模式 <code>10..0</code> 或 <code>10..10</code> 是一个错误。</li>
<li>在 <code>..b</code> 中，b 必须不是其类型的最小值。例如，出现范围模式 <code>..-128i8</code> 或 <code>..f64::NEG_INFINITY</code> 是一个错误。</li>
</ul>
<div class="rule" id="r-patterns.range.bound"><a class="rule-link" href="#r-patterns.range.bound" title="patterns.range.bound"><span>[patterns<wbr>.range<wbr>.bound]</span></a>
</div>

<p>边界写为以下之一：</p>
<ul>
<li>字符、字节、整数或浮点数字面量。</li>
<li>一个 <code>-</code> 后跟整数或浮点数字面量。</li>
<li>一个 <a href="#路径表达式">路径</a> 。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>We syntactically accept more than this for a <em><a href="#grammar-RangePatternBound">RangePatternBound</a></em>. We later reject the other things semantically.</p>
</blockquote>
</div>

<div class="rule" id="r-patterns.range.constraint-bound-path"><a class="rule-link" href="#r-patterns.range.constraint-bound-path" title="patterns.range.constraint-bound-path"><span>[patterns<wbr>.range<wbr>.constraint-bound-path]</span></a>
</div>

<p>如果边界写为路径，则在宏解析后，该路径必须解析为 <code>char</code> 类型、整数类型或浮点类型的常量项。</p>
<div class="rule" id="r-patterns.range.type"><a class="rule-link" href="#r-patterns.range.type" title="patterns.range.type"><span>[patterns<wbr>.range<wbr>.type]</span></a>
</div>

<p>范围模式匹配其上边界和下边界的类型，这两者必须是同一类型。</p>
<div class="rule" id="r-patterns.range.path-value"><a class="rule-link" href="#r-patterns.range.path-value" title="patterns.range.path-value"><span>[patterns<wbr>.range<wbr>.path-value]</span></a>
</div>

<p>如果边界是一个 <a href="#路径表达式">路径</a> ，则边界匹配该类型，并具有路径解析到的 <a href="#常量项">常量</a> 的值。</p>
<div class="rule" id="r-patterns.range.literal-value"><a class="rule-link" href="#r-patterns.range.literal-value" title="patterns.range.literal-value"><span>[patterns<wbr>.range<wbr>.literal-value]</span></a>
</div>

<p>如果边界是一个字面量，则边界匹配该类型，并具有相应 <a href="#字面量表达式">字面量表达式</a> 的值。</p>
<div class="rule" id="r-patterns.range.negation"><a class="rule-link" href="#r-patterns.range.negation" title="patterns.range.negation"><span>[patterns<wbr>.range<wbr>.negation]</span></a>
</div>

<p>如果边界是一个前面带有 <code>-</code> 的字面量，则边界匹配与相应 <a href="#字面量表达式">字面量表达式</a> 相同的类型，并具有对相应字面量表达式的值进行 <a href="#negation-operators">取反</a> 后的值。</p>
<div class="rule" id="r-patterns.range.float-restriction"><a class="rule-link" href="#r-patterns.range.float-restriction" title="patterns.range.float-restriction"><span>[patterns<wbr>.range<wbr>.float-restriction]</span></a>
</div>

<p>对于浮点范围模式，常量不能是 <code>NaN</code> 。</p>
<p>示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">let c = 'f';
</span>let valid_variable = match c {
    'a'..='z' =&gt; true,
    'A'..='Z' =&gt; true,
    'α'..='ω' =&gt; true,
    _ =&gt; false,
};

<span class="boring">let ph = 10;
</span>println!("{}", match ph {
    0..7 =&gt; "acid",
    7 =&gt; "neutral",
    8..=14 =&gt; "base",
    _ =&gt; unreachable!(),
});

<span class="boring">let uint: u32 = 5;
</span>match uint {
    0 =&gt; "zero!",
    1.. =&gt; "positive number!",
};

// 使用指向常量的路径：
<span class="boring">const TROPOSPHERE_MIN : u8 = 6;
</span><span class="boring">const TROPOSPHERE_MAX : u8 = 20;
</span><span class="boring">
</span><span class="boring">const STRATOSPHERE_MIN : u8 = TROPOSPHERE_MAX + 1;
</span><span class="boring">const STRATOSPHERE_MAX : u8 = 50;
</span><span class="boring">
</span><span class="boring">const MESOSPHERE_MIN : u8 = STRATOSPHERE_MAX + 1;
</span><span class="boring">const MESOSPHERE_MAX : u8 = 85;
</span><span class="boring">
</span><span class="boring">let altitude = 70;
</span><span class="boring">
</span>println!("{}", match altitude {
    TROPOSPHERE_MIN..=TROPOSPHERE_MAX =&gt; "troposphere",
    STRATOSPHERE_MIN..=STRATOSPHERE_MAX =&gt; "stratosphere",
    MESOSPHERE_MIN..=MESOSPHERE_MAX =&gt; "mesosphere",
    _ =&gt; "outer space, maybe",
});

<span class="boring">pub mod binary {
</span><span class="boring">    pub const MEGA : u64 = 1024*1024;
</span><span class="boring">    pub const GIGA : u64 = 1024*1024*1024;
</span><span class="boring">}
</span><span class="boring">let n_items = 20_832_425;
</span><span class="boring">let bytes_per_item = 12;
</span>if let size @ binary::MEGA..=binary::GIGA = n_items * bytes_per_item {
    println!("It fits and occupies {} bytes", size);
}

<span class="boring">trait MaxValue {
</span><span class="boring">    const MAX: u64;
</span><span class="boring">}
</span><span class="boring">impl MaxValue for u8 {
</span><span class="boring">    const MAX: u64 = (1 &lt;&lt; 8) - 1;
</span><span class="boring">}
</span><span class="boring">impl MaxValue for u16 {
</span><span class="boring">    const MAX: u64 = (1 &lt;&lt; 16) - 1;
</span><span class="boring">}
</span><span class="boring">impl MaxValue for u32 {
</span><span class="boring">    const MAX: u64 = (1 &lt;&lt; 32) - 1;
</span><span class="boring">}
</span>// 使用限定路径：
println!("{}", match 0xfacade {
    0 ..= &lt;u8 as MaxValue&gt;::MAX =&gt; "fits in a u8",
    0 ..= &lt;u16 as MaxValue&gt;::MAX =&gt; "fits in a u16",
    0 ..= &lt;u32 as MaxValue&gt;::MAX =&gt; "fits in a u32",
    _ =&gt; "too big",
});
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.range.refutable"><a class="rule-link" href="#r-patterns.range.refutable" title="patterns.range.refutable"><span>[patterns<wbr>.range<wbr>.refutable]</span></a>
</div>

<p>当固定宽度整数和 <code>char</code> 类型的范围模式跨越一个类型的所有可能值集时，它们是不可反驳的。
例如， <code>0u8..=255u8</code> 是不可反驳的。</p>
<div class="rule" id="r-patterns.range.refutable-integer"><a class="rule-link" href="#r-patterns.range.refutable-integer" title="patterns.range.refutable-integer"><span>[patterns<wbr>.range<wbr>.refutable-integer]</span></a>
</div>

<p>整数类型的值范围是从其最小值到最大值的闭区间。</p>
<div class="rule" id="r-patterns.range.refutable-char"><a class="rule-link" href="#r-patterns.range.refutable-char" title="patterns.range.refutable-char"><span>[patterns<wbr>.range<wbr>.refutable-char]</span></a>
</div>

<p><code>char</code> 类型的值范围恰好是那些包含所有 Unicode 标量值的范围： <code>'\u{0000}'..='\u{D7FF}'</code> 和 <code>'\u{E000}'..='\u{10FFFF}'</code> 。</p>
<div class="rule" id="r-patterns.range.constraint-slice"><a class="rule-link" href="#r-patterns.range.constraint-slice" title="patterns.range.constraint-slice"><span>[patterns<wbr>.range<wbr>.constraint-slice]</span></a>
</div>

<p><a href="#grammar-RangeFromPattern">RangeFromPattern</a> 不能用作 <a href="#slice-patterns">切片模式</a> 中子模式的顶层模式。
例如，模式 <code>[1.., _]</code> 不是一个有效的模式。</p>
<div class="rule" id="r-patterns.range.edition2021"><a class="rule-link" href="#r-patterns.range.edition2021" title="patterns.range.edition2021"><span>[patterns<wbr>.range<wbr>.edition2021]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2021</span> 版次差异</p>

<p>Before the 2021 edition, range patterns with both a lower and upper bound may also be written using <code>...</code> in place of <code>..=</code>, with the same meaning.</p>
</blockquote>
</div>

<div class="rule" id="r-patterns.ref"><a class="rule-link" href="#r-patterns.ref" title="patterns.ref"><span>[patterns<wbr>.ref]</span></a>
</div>

<h2 id="引用模式"><a class="header" href="#引用模式">引用模式</a></h2>
<div class="rule" id="r-patterns.ref.syntax"><a class="rule-link" href="#r-patterns.ref.syntax" title="patterns.ref.syntax"><span>[patterns<wbr>.ref<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ReferencePattern" onclick="show_railroad()"><a href="#railroad-ReferencePattern">ReferencePattern</a></span> → ( <span class="grammar-literal">&amp;</span> | <span class="grammar-literal">&amp;&amp;</span> ) <span class="grammar-literal">mut</span><sup>?</sup> <span class="grammar-text"><a href="#grammar-PatternWithoutRange">PatternWithoutRange</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 438px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ReferencePattern"><svg class="railroad" viewbox="0 0 438 120" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ReferencePattern">
<text class="comment" x="71" y="25">
ReferencePattern</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="choice">
<path d=" M 35 66 h 24 m 28 0 h 32" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="55" />
<text x="73" y="71">
&amp;</text>
</g>
<path d=" M 35 66 a 12 12 0 0 1 12 12 v 9 m 60 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 87 v 0 a 12 12 0 0 0 12 12 m 36 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="88" />
<text x="77" y="104">
&amp;&amp;</text>
</g>
</g>
<g class="optional">
<path d=" M 129 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 44 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="153" y="55" />
<text x="175" y="71">
mut</text>
</g>
</g>
<a class="link" xlink:href="#railroad-PatternWithoutRange">
<g class="nonterminal">
<rect height="22" width="172" x="231" y="55" />
<text x="317" y="71">
PatternWithoutRange</text>
</g>
</a>
<path d=" M 119 66 h 10" />
<path d=" M 221 66 h 10" />
</g>
<path d=" M 413 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 403 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-patterns.ref.intro"><a class="rule-link" href="#r-patterns.ref.intro" title="patterns.ref.intro"><span>[patterns<wbr>.ref<wbr>.intro]</span></a>
</div>

<p>引用模式对正在匹配的指针进行解引用，从而借用它们。</p>
<p>例如，在 <code>x: &amp;i32</code> 上的这两个 match 是等价的：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let int_reference = &amp;3;

let a = match *int_reference { 0 =&gt; "zero", _ =&gt; "some" };
let b = match int_reference { &amp;0 =&gt; "zero", _ =&gt; "some" };

assert_eq!(a, b);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.ref.ref-ref"><a class="rule-link" href="#r-patterns.ref.ref-ref" title="patterns.ref.ref-ref"><span>[patterns<wbr>.ref<wbr>.ref-ref]</span></a>
</div>

<p>引用模式的语法产生式必须匹配 词法单元 <code>&amp;&amp;</code> 才能匹配引用的引用，因为它本身就是一个 词法单元 ，而不是两个 <code>&amp;</code> 词法单元 。</p>
<div class="rule" id="r-patterns.ref.mut"><a class="rule-link" href="#r-patterns.ref.mut" title="patterns.ref.mut"><span>[patterns<wbr>.ref<wbr>.mut]</span></a>
</div>

<p>添加 <code>mut</code> 关键字会解引用一个可变引用。可变性必须与引用的可变性匹配。</p>
<div class="rule" id="r-patterns.ref.refutable"><a class="rule-link" href="#r-patterns.ref.refutable" title="patterns.ref.refutable"><span>[patterns<wbr>.ref<wbr>.refutable]</span></a>
</div>

<p>引用模式始终是不可反驳的。</p>
<div class="rule" id="r-patterns.struct"><a class="rule-link" href="#r-patterns.struct" title="patterns.struct"><span>[patterns<wbr>.struct]</span></a>
</div>

<h2 id="结构体模式"><a class="header" href="#结构体模式">结构体模式</a></h2>
<div class="rule" id="r-patterns.struct.syntax"><a class="rule-link" href="#r-patterns.struct.syntax" title="patterns.struct.syntax"><span>[patterns<wbr>.struct<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-StructPattern" onclick="show_railroad()"><a href="#railroad-StructPattern">StructPattern</a></span> → <br>    <span class="grammar-text"><a href="#grammar-PathInExpression">PathInExpression</a></span> <span class="grammar-literal">{</span> <br>        <span class="grammar-text"><a href="#grammar-StructPatternElements">StructPatternElements</a></span><sup>?</sup> <br>    <span class="grammar-literal">}</span></p>
<p><span class="grammar-text grammar-production" id="grammar-StructPatternElements" onclick="show_railroad()"><a href="#railroad-StructPatternElements">StructPatternElements</a></span> → <br>      <span class="grammar-text"><a href="#grammar-StructPatternFields">StructPatternFields</a></span> ( <span class="grammar-literal">,</span> | <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-StructPatternEtCetera">StructPatternEtCetera</a></span> )<sup>?</sup> <br>    | <span class="grammar-text"><a href="#grammar-StructPatternEtCetera">StructPatternEtCetera</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-StructPatternFields" onclick="show_railroad()"><a href="#railroad-StructPatternFields">StructPatternFields</a></span> → <br>    <span class="grammar-text"><a href="#grammar-StructPatternField">StructPatternField</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-StructPatternField">StructPatternField</a></span> )<sup>*</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-StructPatternField" onclick="show_railroad()"><a href="#railroad-StructPatternField">StructPatternField</a></span> → <br>    <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> <br>    ( <br>        <span class="grammar-text"><a href="#grammar-TUPLE_INDEX">TUPLE_INDEX</a></span> <span class="grammar-literal">:</span> <span class="grammar-text"><a href="#grammar-Pattern">Pattern</a></span> <br>      | <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-literal">:</span> <span class="grammar-text"><a href="#grammar-Pattern">Pattern</a></span> <br>      | <span class="grammar-literal">ref</span><sup>?</sup> <span class="grammar-literal">mut</span><sup>?</sup> <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <br>    )</p>
<p><span class="grammar-text grammar-production" id="grammar-StructPatternEtCetera" onclick="show_railroad()"><a href="#railroad-StructPatternEtCetera">StructPatternEtCetera</a></span> → <span class="grammar-literal">..</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 548px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-StructPattern"><svg class="railroad" viewbox="0 0 548 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-StructPattern">
<text class="comment" x="60" y="25">
StructPattern</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-PathInExpression">
<g class="nonterminal">
<rect height="22" width="148" x="35" y="55" />
<text x="109" y="71">
PathInExpression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="193" y="55" />
<text x="207" y="71">
{</text>
</g>
<g class="optional">
<path d=" M 231 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 196 m -95 0 l -5 -5 m 0 10 l 5 -5 m 95 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-StructPatternElements">
<g class="nonterminal">
<rect height="22" width="196" x="255" y="55" />
<text x="353" y="71">
StructPatternElements</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="485" y="55" />
<text x="499" y="71">
}</text>
</g>
<path d=" M 183 66 h 10" />
<path d=" M 221 66 h 10" />
<path d=" M 475 66 h 10" />
</g>
<path d=" M 523 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 513 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 630px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-StructPatternElements"><svg class="railroad" viewbox="0 0 630 153" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-StructPatternElements">
<text class="comment" x="92" y="25">
StructPatternElements</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 66 h 24 m 512 0 h 24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-StructPatternFields">
<g class="nonterminal">
<rect height="22" width="172" x="59" y="55" />
<text x="145" y="71">
StructPatternFields</text>
</g>
</a>
<g class="optional">
<path d=" M 241 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 282 m -138 0 l -5 -5 m 0 10 l 5 -5 m 138 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="choice">
<path d=" M 265 66 h 24 m 28 0 h 230 m -112 0 l -5 -5 m 0 10 l 5 -5 m 112 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="289" y="55" />
<text x="303" y="71">
,</text>
</g>
<path d=" M 265 66 a 12 12 0 0 1 12 12 v 9 m 258 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 277 87 v 0 a 12 12 0 0 0 12 12 m 234 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="289" y="88" />
<text x="303" y="104">
,</text>
</g>
<a class="link" xlink:href="#railroad-StructPatternEtCetera">
<g class="nonterminal">
<rect height="22" width="196" x="327" y="88" />
<text x="425" y="104">
StructPatternEtCetera</text>
</g>
</a>
<path d=" M 317 99 h 10" />
</g>
</g>
</g>
<path d=" M 231 66 h 10" />
</g>
<path d=" M 35 66 a 12 12 0 0 1 12 12 v 42 m 536 0 v -42 a 12 12 0 0 1 12 -12" />
<path d=" M 47 120 v 0 a 12 12 0 0 0 12 12 m 196 0 h 316 m -155 0 l -5 -5 m 0 10 l 5 -5 m 155 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-StructPatternEtCetera">
<g class="nonterminal">
<rect height="22" width="196" x="59" y="121" />
<text x="157" y="137">
StructPatternEtCetera</text>
</g>
</a>
</g>
<path d=" M 605 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 595 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 518px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-StructPatternFields"><svg class="railroad" viewbox="0 0 518 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-StructPatternFields">
<text class="comment" x="81" y="25">
StructPatternFields</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-StructPatternField">
<g class="nonterminal">
<rect height="22" width="164" x="35" y="55" />
<text x="117" y="71">
StructPatternField</text>
</g>
</a>
<g class="optional">
<path d=" M 209 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 226 m -110 0 l -5 -5 m 0 10 l 5 -5 m 110 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 233 66 h 12 m 202 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -202 m 104 0 l 5 -5 m 0 10 l -5 -5 m -104 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="245" y="55" />
<text x="259" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-StructPatternField">
<g class="nonterminal">
<rect height="22" width="164" x="283" y="55" />
<text x="365" y="71">
StructPatternField</text>
</g>
</a>
<path d=" M 273 66 h 10" />
</g>
</g>
</g>
<path d=" M 199 66 h 10" />
</g>
<path d=" M 493 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 483 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 636px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-StructPatternField"><svg class="railroad" viewbox="0 0 636 165" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-StructPatternField">
<text class="comment" x="78" y="25">
StructPatternField</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<g class="choice">
<path d=" M 249 66 h 24 m 232 0 h 96 m -45 0 l -5 -5 m 0 10 l 5 -5 m 45 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-TUPLE_INDEX">
<g class="nonterminal">
<rect height="22" width="108" x="273" y="55" />
<text x="327" y="71">
TUPLE_INDEX</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="391" y="55" />
<text x="405" y="71">
:</text>
</g>
<a class="link" xlink:href="#railroad-Pattern">
<g class="nonterminal">
<rect height="22" width="76" x="429" y="55" />
<text x="467" y="71">
Pattern</text>
</g>
</a>
<path d=" M 381 66 h 10" />
<path d=" M 419 66 h 10" />
</g>
<path d=" M 249 66 a 12 12 0 0 1 12 12 v 9 m 328 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 261 87 v 33 m 328 0 v -33" />
<path d=" M 261 87 v 0 a 12 12 0 0 0 12 12 m 224 0 h 80 m -37 0 l -5 -5 m 0 10 l 5 -5 m 37 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="273" y="88" />
<text x="323" y="104">
IDENTIFIER</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="383" y="88" />
<text x="397" y="104">
:</text>
</g>
<a class="link" xlink:href="#railroad-Pattern">
<g class="nonterminal">
<rect height="22" width="76" x="421" y="88" />
<text x="459" y="104">
Pattern</text>
</g>
</a>
<path d=" M 373 99 h 10" />
<path d=" M 411 99 h 10" />
</g>
<path d=" M 261 120 v 12 a 12 12 0 0 0 12 12 m 304 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="optional">
<path d=" M 273 144 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 44 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="297" y="133" />
<text x="319" y="149">
ref</text>
</g>
</g>
<g class="optional">
<path d=" M 375 144 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 44 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="399" y="133" />
<text x="421" y="149">
mut</text>
</g>
</g>
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="477" y="133" />
<text x="527" y="149">
IDENTIFIER</text>
</g>
</a>
<path d=" M 365 144 h 10" />
<path d=" M 467 144 h 10" />
</g>
</g>
<path d=" M 239 66 h 10" />
</g>
<path d=" M 611 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 601 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 184px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-StructPatternEtCetera"><svg class="railroad" viewbox="0 0 184 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-StructPatternEtCetera">
<text class="comment" x="92" y="25">
StructPatternEtCetera</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="42" />
<text x="53" y="58">
..</text>
</g>
<path d=" M 81 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 71 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-patterns.struct.intro"><a class="rule-link" href="#r-patterns.struct.intro" title="patterns.struct.intro"><span>[patterns<wbr>.struct<wbr>.intro]</span></a>
</div>

<p>结构体模式匹配 结构体 、 枚举 和 联合体 值，这些值需满足其子模式定义的所有准则。
它们也用于 <a href="#destructuring">解构</a> 一个 结构体 、 枚举 或 联合体 值。</p>
<div class="rule" id="r-patterns.struct.ignore-rest"><a class="rule-link" href="#r-patterns.struct.ignore-rest" title="patterns.struct.ignore-rest"><span>[patterns<wbr>.struct<wbr>.ignore-rest]</span></a>
</div>

<p>在 结构体 模式中，字段通过名称、索引（在元组结构体的情况下）引用，或者使用 <code>..</code> 忽略：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct Point {
</span><span class="boring">    x: u32,
</span><span class="boring">    y: u32,
</span><span class="boring">}
</span><span class="boring">let s = Point {x: 1, y: 1};
</span><span class="boring">
</span>match s {
    Point {x: 10, y: 20} =&gt; (),
    Point {y: 10, x: 20} =&gt; (),    // 顺序无关紧要
    Point {x: 10, ..} =&gt; (),
    Point {..} =&gt; (),
}

<span class="boring">struct PointTuple (
</span><span class="boring">    u32,
</span><span class="boring">    u32,
</span><span class="boring">);
</span><span class="boring">let t = PointTuple(1, 2);
</span><span class="boring">
</span>match t {
    PointTuple {0: 10, 1: 20} =&gt; (),
    PointTuple {1: 10, 0: 20} =&gt; (),   // 顺序无关紧要
    PointTuple {0: 10, ..} =&gt; (),
    PointTuple {..} =&gt; (),
}

<span class="boring">enum Message {
</span><span class="boring">    Quit,
</span><span class="boring">    Move { x: i32, y: i32 },
</span><span class="boring">}
</span><span class="boring">let m = Message::Quit;
</span><span class="boring">
</span>match m {
    Message::Quit =&gt; (),
    Message::Move {x: 10, y: 20} =&gt; (),
    Message::Move {..} =&gt; (),
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.struct.constraint-struct"><a class="rule-link" href="#r-patterns.struct.constraint-struct" title="patterns.struct.constraint-struct"><span>[patterns<wbr>.struct<wbr>.constraint-struct]</span></a>
</div>

<p>如果不使用 <code>..</code> ，则用于匹配 结构体 的 结构体 模式需要指定所有字段：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct Struct {
</span><span class="boring">   a: i32,
</span><span class="boring">   b: char,
</span><span class="boring">   c: bool,
</span><span class="boring">}
</span><span class="boring">let mut struct_value = Struct{a: 10, b: 'X', c: false};
</span><span class="boring">
</span>match struct_value {
    Struct{a: 10, b: 'X', c: false} =&gt; (),
    Struct{a: 10, b: 'X', ref c} =&gt; (),
    Struct{a: 10, b: 'X', ref mut c} =&gt; (),
    Struct{a: 10, b: 'X', c: _} =&gt; (),
    Struct{a: _, b: _, c: _} =&gt; (),
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.struct.constraint-union"><a class="rule-link" href="#r-patterns.struct.constraint-union" title="patterns.struct.constraint-union"><span>[patterns<wbr>.struct<wbr>.constraint-union]</span></a>
</div>

<p>用于匹配 联合体 的 结构体 模式必须恰好指定一个字段（参见 <a href="#pattern-matching-on-unions">在联合体上进行模式匹配</a> ）。</p>
<div class="rule" id="r-patterns.struct.binding-shorthand"><a class="rule-link" href="#r-patterns.struct.binding-shorthand" title="patterns.struct.binding-shorthand"><span>[patterns<wbr>.struct<wbr>.binding-shorthand]</span></a>
</div>

<p><a href="#grammar-IDENTIFIER">IDENTIFIER</a> 语法格式匹配任何值，并将其绑定到与给定字段同名的变量。它是 <code>fieldname: fieldname</code> 的简写。 <code>ref</code> 和 <code>mut</code> 限定符可以包含在内，其行为如 <a href="#r-patterns.ident.ref">patterns.ident.ref</a> 中所述。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct Struct {
</span><span class="boring">   a: i32,
</span><span class="boring">   b: char,
</span><span class="boring">   c: bool,
</span><span class="boring">}
</span><span class="boring">let struct_value = Struct{a: 10, b: 'X', c: false};
</span><span class="boring">
</span>let Struct { a, b, c } = struct_value;
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.struct.refutable"><a class="rule-link" href="#r-patterns.struct.refutable" title="patterns.struct.refutable"><span>[patterns<wbr>.struct<wbr>.refutable]</span></a>
</div>

<p>如果 <a href="#grammar-PathInExpression">PathInExpression</a> 解析为具有多个变体的枚举构造函数，或者其子模式之一是可反驳的，则 结构体 模式是可反驳的。</p>
<div class="rule" id="r-patterns.struct.namespace"><a class="rule-link" href="#r-patterns.struct.namespace" title="patterns.struct.namespace"><span>[patterns<wbr>.struct<wbr>.namespace]</span></a>
</div>

<p>结构体 模式根据从 <a href="#r-names.namespaces.kinds">类型命名空间</a> 中的 <a href="#grammar-PathInExpression">PathInExpression</a> 解析出的 结构体 、 联合体 或枚举变体进行匹配。有关更多详细信息，请参见 <a href="#r-patterns.tuple-struct.namespace">patterns.tuple-struct.namespace</a> 。</p>
<div class="rule" id="r-patterns.tuple-struct"><a class="rule-link" href="#r-patterns.tuple-struct" title="patterns.tuple-struct"><span>[patterns<wbr>.tuple-struct]</span></a>
</div>

<h2 id="元组结构体模式"><a class="header" href="#元组结构体模式">元组结构体模式</a></h2>
<div class="rule" id="r-patterns.tuple-struct.syntax"><a class="rule-link" href="#r-patterns.tuple-struct.syntax" title="patterns.tuple-struct.syntax"><span>[patterns<wbr>.tuple-struct<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-TupleStructPattern" onclick="show_railroad()"><a href="#railroad-TupleStructPattern">TupleStructPattern</a></span> → <span class="grammar-text"><a href="#grammar-PathInExpression">PathInExpression</a></span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-TupleStructItems">TupleStructItems</a></span><sup>?</sup> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-TupleStructItems" onclick="show_railroad()"><a href="#railroad-TupleStructItems">TupleStructItems</a></span> → <span class="grammar-text"><a href="#grammar-Pattern">Pattern</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-Pattern">Pattern</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 500px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TupleStructPattern"><svg class="railroad" viewbox="0 0 500 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TupleStructPattern">
<text class="comment" x="78" y="25">
TupleStructPattern</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-PathInExpression">
<g class="nonterminal">
<rect height="22" width="148" x="35" y="55" />
<text x="109" y="71">
PathInExpression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="193" y="55" />
<text x="207" y="71">
(</text>
</g>
<g class="optional">
<path d=" M 231 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 148 m -71 0 l -5 -5 m 0 10 l 5 -5 m 71 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-TupleStructItems">
<g class="nonterminal">
<rect height="22" width="148" x="255" y="55" />
<text x="329" y="71">
TupleStructItems</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="437" y="55" />
<text x="451" y="71">
)</text>
</g>
<path d=" M 183 66 h 10" />
<path d=" M 221 66 h 10" />
<path d=" M 427 66 h 10" />
</g>
<path d=" M 475 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 465 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 428px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TupleStructItems"><svg class="railroad" viewbox="0 0 428 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TupleStructItems">
<text class="comment" x="71" y="25">
TupleStructItems</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Pattern">
<g class="nonterminal">
<rect height="22" width="76" x="35" y="55" />
<text x="73" y="71">
Pattern</text>
</g>
</a>
<g class="optional">
<path d=" M 121 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 138 m -66 0 l -5 -5 m 0 10 l 5 -5 m 66 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 145 66 h 12 m 114 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -114 m 60 0 l 5 -5 m 0 10 l -5 -5 m -60 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="157" y="55" />
<text x="171" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-Pattern">
<g class="nonterminal">
<rect height="22" width="76" x="195" y="55" />
<text x="233" y="71">
Pattern</text>
</g>
</a>
<path d=" M 185 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 317 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="341" y="55" />
<text x="355" y="71">
,</text>
</g>
</g>
<path d=" M 111 66 h 10" />
<path d=" M 307 66 h 10" />
</g>
<path d=" M 403 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 393 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-patterns.tuple-struct.intro"><a class="rule-link" href="#r-patterns.tuple-struct.intro" title="patterns.tuple-struct.intro"><span>[patterns<wbr>.tuple-struct<wbr>.intro]</span></a>
</div>

<p>元组结构体模式匹配元组结构体和枚举值，这些值需满足其子模式定义的所有准则。
它们也用于 <a href="#destructuring">解构</a> 元组结构体或枚举值。</p>
<div class="rule" id="r-patterns.tuple-struct.refutable"><a class="rule-link" href="#r-patterns.tuple-struct.refutable" title="patterns.tuple-struct.refutable"><span>[patterns<wbr>.tuple-struct<wbr>.refutable]</span></a>
</div>

<p>如果 <a href="#grammar-PathInExpression">PathInExpression</a> 解析为具有多个变体的枚举构造函数，或者其子模式之一是可反驳的，则元组结构体模式是可反驳的。</p>
<div class="rule" id="r-patterns.tuple-struct.namespace"><a class="rule-link" href="#r-patterns.tuple-struct.namespace" title="patterns.tuple-struct.namespace"><span>[patterns<wbr>.tuple-struct<wbr>.namespace]</span></a>
</div>

<p>元组结构体模式根据从 <a href="#r-names.namespaces.kinds">值命名空间</a> 中的 <a href="#grammar-PathInExpression">PathInExpression</a> 解析出的元组结构体或 <a href="#r-items.enum.tuple-expr">类元组枚举变体</a> 进行匹配。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>Conversely, a struct pattern for a tuple struct or <a href="#r-items.enum.tuple-expr">tuple-like enum variant</a>, e.g. <code>S { 0: _ }</code>, matches against the tuple struct or variant whose constructor is resolved in the <a href="#r-names.namespaces.kinds">type namespace</a>.</p>
<pre class="playground"><code class="language-rust no_run edition2024">enum E1 { V(u16) }
enum E2 { V(u32) }

// 只从类型命名空间导入 `E1::V`。
mod _0 {
    const V: () = (); // 用于命名空间掩蔽。
    pub(super) use super::E1::*;
}
use _0::*;

// 只从值命名空间导入 `E2::V`。
mod _1 {
    struct V {} // 用于命名空间掩蔽。
    pub(super) use super::E2::*;
}
use _1::*;

fn f() {
    // 此结构体模式根据在类型命名空间中
    // 找到其构造函数的类元组枚举变体
    // 进行匹配。
    let V { 0: ..=u16::MAX } = (loop {}) else { loop {} };
    // 此元组结构体模式根据在值命名空间中
    // 找到其构造函数的类元组枚举变体
    // 进行匹配。
    let V(..=u32::MAX) = (loop {}) else { loop {} };
}
<span class="boring">// 在函数中使用 super 的奇怪行为所必需的。
</span><span class="boring">fn main() {}</span></code></pre>
<p>The Lang team has made certain decisions, such as in <a href="https://github.com/rust-lang/rust/pull/138458">PR #138458</a>, that raise questions about the desirability of using the value namespace in this way for patterns, as described in <a href="https://github.com/rust-lang/rust/pull/140593#issuecomment-2972338457">PR #140593</a>. It might be prudent to not intentionally rely on this nuance in your code.</p>
</blockquote>
</div>

<div class="rule" id="r-patterns.tuple"><a class="rule-link" href="#r-patterns.tuple" title="patterns.tuple"><span>[patterns<wbr>.tuple]</span></a>
</div>

<h2 id="元组模式"><a class="header" href="#元组模式">元组模式</a></h2>
<div class="rule" id="r-patterns.tuple.syntax"><a class="rule-link" href="#r-patterns.tuple.syntax" title="patterns.tuple.syntax"><span>[patterns<wbr>.tuple<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-TuplePattern" onclick="show_railroad()"><a href="#railroad-TuplePattern">TuplePattern</a></span> → <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-TuplePatternItems">TuplePatternItems</a></span><sup>?</sup> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-TuplePatternItems" onclick="show_railroad()"><a href="#railroad-TuplePatternItems">TuplePatternItems</a></span> → <br>      <span class="grammar-text"><a href="#grammar-Pattern">Pattern</a></span> <span class="grammar-literal">,</span> <br>    | <span class="grammar-text"><a href="#grammar-RestPattern">RestPattern</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Pattern">Pattern</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-Pattern">Pattern</a></span> )<sup>+</sup> <span class="grammar-literal">,</span><sup>?</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 350px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TuplePattern"><svg class="railroad" viewbox="0 0 350 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TuplePattern">
<text class="comment" x="57" y="25">
TuplePattern</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="55" />
<text x="49" y="71">
(</text>
</g>
<g class="optional">
<path d=" M 73 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-TuplePatternItems">
<g class="nonterminal">
<rect height="22" width="156" x="97" y="55" />
<text x="175" y="71">
TuplePatternItems</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="287" y="55" />
<text x="301" y="71">
)</text>
</g>
<path d=" M 63 66 h 10" />
<path d=" M 277 66 h 10" />
</g>
<path d=" M 325 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 315 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 428px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TuplePatternItems"><svg class="railroad" viewbox="0 0 428 165" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TuplePatternItems">
<text class="comment" x="74" y="25">
TuplePatternItems</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 114 0 h 220 m -107 0 l -5 -5 m 0 10 l 5 -5 m 107 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Pattern">
<g class="nonterminal">
<rect height="22" width="76" x="59" y="42" />
<text x="97" y="58">
Pattern</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="145" y="42" />
<text x="159" y="58">
,</text>
</g>
<path d=" M 135 53 h 10" />
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 334 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 334 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 108 0 h 202 m -98 0 l -5 -5 m 0 10 l 5 -5 m 98 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RestPattern">
<g class="nonterminal">
<rect height="22" width="108" x="59" y="75" />
<text x="113" y="91">
RestPattern</text>
</g>
</a>
</g>
<path d=" M 47 107 v 12 a 12 12 0 0 0 12 12 m 310 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Pattern">
<g class="nonterminal">
<rect height="22" width="76" x="59" y="120" />
<text x="97" y="136">
Pattern</text>
</g>
</a>
<g class="repeat">
<path d=" M 145 131 h 12 m 114 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -114 m 60 0 l 5 -5 m 0 10 l -5 -5 m -60 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="157" y="120" />
<text x="171" y="136">
,</text>
</g>
<a class="link" xlink:href="#railroad-Pattern">
<g class="nonterminal">
<rect height="22" width="76" x="195" y="120" />
<text x="233" y="136">
Pattern</text>
</g>
</a>
<path d=" M 185 131 h 10" />
</g>
</g>
<g class="optional">
<path d=" M 293 131 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="317" y="120" />
<text x="331" y="136">
,</text>
</g>
</g>
<path d=" M 135 131 h 10" />
<path d=" M 283 131 h 10" />
</g>
</g>
<path d=" M 403 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 393 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-patterns.tuple.intro"><a class="rule-link" href="#r-patterns.tuple.intro" title="patterns.tuple.intro"><span>[patterns<wbr>.tuple<wbr>.intro]</span></a>
</div>

<p>元组模式匹配满足其子模式定义的所有准则的元组值。
它们也用于 <a href="#destructuring">解构</a> 元组。</p>
<div class="rule" id="r-patterns.tuple.rest-syntax"><a class="rule-link" href="#r-patterns.tuple.rest-syntax" title="patterns.tuple.rest-syntax"><span>[patterns<wbr>.tuple<wbr>.rest-syntax]</span></a>
</div>

<p>带有单个 <a href="#grammar-RestPattern">RestPattern</a> 的形式 <code>(..)</code> 是一种特殊形式，不需要逗号，并且匹配任何大小的元组。</p>
<div class="rule" id="r-patterns.tuple.refutable"><a class="rule-link" href="#r-patterns.tuple.refutable" title="patterns.tuple.refutable"><span>[patterns<wbr>.tuple<wbr>.refutable]</span></a>
</div>

<p>当元组模式的一个子模式是可反驳的时，该元组模式是可反驳的。</p>
<p>使用元组模式的示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let pair = (10, "ten");
let (a, b) = pair;

assert_eq!(a, 10);
assert_eq!(b, "ten");
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.paren"><a class="rule-link" href="#r-patterns.paren" title="patterns.paren"><span>[patterns<wbr>.paren]</span></a>
</div>

<h2 id="分组模式"><a class="header" href="#分组模式">分组模式</a></h2>
<div class="rule" id="r-patterns.paren.syntax"><a class="rule-link" href="#r-patterns.paren.syntax" title="patterns.paren.syntax"><span>[patterns<wbr>.paren<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-GroupedPattern" onclick="show_railroad()"><a href="#railroad-GroupedPattern">GroupedPattern</a></span> → <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-Pattern">Pattern</a></span> <span class="grammar-literal">)</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 222px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-GroupedPattern"><svg class="railroad" viewbox="0 0 222 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-GroupedPattern">
<text class="comment" x="64" y="25">
GroupedPattern</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="42" />
<text x="49" y="58">
(</text>
</g>
<a class="link" xlink:href="#railroad-Pattern">
<g class="nonterminal">
<rect height="22" width="76" x="73" y="42" />
<text x="111" y="58">
Pattern</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="159" y="42" />
<text x="173" y="58">
)</text>
</g>
<path d=" M 63 53 h 10" />
<path d=" M 149 53 h 10" />
</g>
<path d=" M 197 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 187 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-patterns.paren.intro"><a class="rule-link" href="#r-patterns.paren.intro" title="patterns.paren.intro"><span>[patterns<wbr>.paren<wbr>.intro]</span></a>
</div>

<p>将模式括在括号中可用于显式控制复合模式的优先级。
例如，紧邻范围模式的引用模式（如 <code>&amp;0..=5</code> ）具有歧义且不被允许，但可以用括号表示。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let int_reference = &amp;3;
match int_reference {
    &amp;(0..=5) =&gt; (),
    _ =&gt; (),
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.slice"><a class="rule-link" href="#r-patterns.slice" title="patterns.slice"><span>[patterns<wbr>.slice]</span></a>
</div>

<h2 id="切片模式"><a class="header" href="#切片模式">切片模式</a></h2>
<div class="rule" id="r-patterns.slice.syntax"><a class="rule-link" href="#r-patterns.slice.syntax" title="patterns.slice.syntax"><span>[patterns<wbr>.slice<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-SlicePattern" onclick="show_railroad()"><a href="#railroad-SlicePattern">SlicePattern</a></span> → <span class="grammar-literal">[</span> <span class="grammar-text"><a href="#grammar-SlicePatternItems">SlicePatternItems</a></span><sup>?</sup> <span class="grammar-literal">]</span></p>
<p><span class="grammar-text grammar-production" id="grammar-SlicePatternItems" onclick="show_railroad()"><a href="#railroad-SlicePatternItems">SlicePatternItems</a></span> → <span class="grammar-text"><a href="#grammar-Pattern">Pattern</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-Pattern">Pattern</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 350px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-SlicePattern"><svg class="railroad" viewbox="0 0 350 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-SlicePattern">
<text class="comment" x="57" y="25">
SlicePattern</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="55" />
<text x="49" y="71">
[</text>
</g>
<g class="optional">
<path d=" M 73 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-SlicePatternItems">
<g class="nonterminal">
<rect height="22" width="156" x="97" y="55" />
<text x="175" y="71">
SlicePatternItems</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="287" y="55" />
<text x="301" y="71">
]</text>
</g>
<path d=" M 63 66 h 10" />
<path d=" M 277 66 h 10" />
</g>
<path d=" M 325 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 315 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 428px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-SlicePatternItems"><svg class="railroad" viewbox="0 0 428 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-SlicePatternItems">
<text class="comment" x="74" y="25">
SlicePatternItems</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Pattern">
<g class="nonterminal">
<rect height="22" width="76" x="35" y="55" />
<text x="73" y="71">
Pattern</text>
</g>
</a>
<g class="optional">
<path d=" M 121 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 138 m -66 0 l -5 -5 m 0 10 l 5 -5 m 66 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 145 66 h 12 m 114 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -114 m 60 0 l 5 -5 m 0 10 l -5 -5 m -60 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="157" y="55" />
<text x="171" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-Pattern">
<g class="nonterminal">
<rect height="22" width="76" x="195" y="55" />
<text x="233" y="71">
Pattern</text>
</g>
</a>
<path d=" M 185 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 317 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="341" y="55" />
<text x="355" y="71">
,</text>
</g>
</g>
<path d=" M 111 66 h 10" />
<path d=" M 307 66 h 10" />
</g>
<path d=" M 403 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 393 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-patterns.slice.intro"><a class="rule-link" href="#r-patterns.slice.intro" title="patterns.slice.intro"><span>[patterns<wbr>.slice<wbr>.intro]</span></a>
</div>

<p>切片模式既可以匹配固定大小的数组，也可以匹配动态大小的切片。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 固定大小
let arr = [1, 2, 3];
match arr {
    [1, _, _] =&gt; "starts with one",
    [a, b, c] =&gt; "starts with something else",
};
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 动态大小
let v = vec![1, 2, 3];
match v[..] {
    [a, b] =&gt; { /* 此臂不适用，因为长度不匹配 */ }
    [a, b, c] =&gt; { /* 此臂将适用 */ }
    _ =&gt; { /* 此通配符是必需的，因为长度在静态时是未知的 */ }
};
<span class="boring">}</span></code></pre>
<div class="rule" id="r-patterns.slice.refutable-array"><a class="rule-link" href="#r-patterns.slice.refutable-array" title="patterns.slice.refutable-array"><span>[patterns<wbr>.slice<wbr>.refutable-array]</span></a>
</div>

<p>匹配数组时，只要每个元素都是不可反驳的，切片模式就是不可反驳的。</p>
<div class="rule" id="r-patterns.slice.refutable-slice"><a class="rule-link" href="#r-patterns.slice.refutable-slice" title="patterns.slice.refutable-slice"><span>[patterns<wbr>.slice<wbr>.refutable-slice]</span></a>
</div>

<p>匹配切片时，只有在具有单个 <code>..</code> <a href="#r-patterns.rest">剩余模式</a> 或以 <code>..</code> 剩余模式作为子模式的 <a href="#identifier-patterns">标识符模式</a> 的形式下，它才是不可反驳的。</p>
<div class="rule" id="r-patterns.slice.restriction"><a class="rule-link" href="#r-patterns.slice.restriction" title="patterns.slice.restriction"><span>[patterns<wbr>.slice<wbr>.restriction]</span></a>
</div>

<p>在切片内，没有下边界和上边界的范围模式必须括在括号中（如 <code>(a..)</code> ），以澄清其目的是匹配单个切片元素。
具有下边界和上边界的范围模式（如 <code>a..=b</code> ）不需要括在括号中。</p>
<div class="rule" id="r-patterns.path"><a class="rule-link" href="#r-patterns.path" title="patterns.path"><span>[patterns<wbr>.path]</span></a>
</div>

<h2 id="路径模式"><a class="header" href="#路径模式">路径模式</a></h2>
<div class="rule" id="r-patterns.path.syntax"><a class="rule-link" href="#r-patterns.path.syntax" title="patterns.path.syntax"><span>[patterns<wbr>.path<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-PathPattern" onclick="show_railroad()"><a href="#railroad-PathPattern">PathPattern</a></span> → <span class="grammar-text"><a href="#grammar-PathExpression">PathExpression</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 202px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-PathPattern"><svg class="railroad" viewbox="0 0 202 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-PathPattern">
<text class="comment" x="53" y="25">
PathPattern</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<a class="link" xlink:href="#railroad-PathExpression">
<g class="nonterminal">
<rect height="22" width="132" x="35" y="42" />
<text x="101" y="58">
PathExpression</text>
</g>
</a>
<path d=" M 177 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 167 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-patterns.path.intro"><a class="rule-link" href="#r-patterns.path.intro" title="patterns.path.intro"><span>[patterns<wbr>.path<wbr>.intro]</span></a>
</div>

<p><em>路径模式</em> 是指常量值、或者没有字段的 结构体 或枚举变体的模式。</p>
<div class="rule" id="r-patterns.path.unqualified"><a class="rule-link" href="#r-patterns.path.unqualified" title="patterns.path.unqualified"><span>[patterns<wbr>.path<wbr>.unqualified]</span></a>
</div>

<p>未限定路径模式可以引用：</p>
<ul>
<li>枚举变体</li>
<li>结构体</li>
<li>常量</li>
<li>关联常量</li>
</ul>
<div class="rule" id="r-patterns.path.qualified"><a class="rule-link" href="#r-patterns.path.qualified" title="patterns.path.qualified"><span>[patterns<wbr>.path<wbr>.qualified]</span></a>
</div>

<p>限定路径模式只能引用关联常量。</p>
<div class="rule" id="r-patterns.path.refutable"><a class="rule-link" href="#r-patterns.path.refutable" title="patterns.path.refutable"><span>[patterns<wbr>.path<wbr>.refutable]</span></a>
</div>

<p>当路径模式引用 结构体 或只有一个变体的枚举变体，或者引用其类型不可反驳的常量时，它们是不可反驳的。
当它们引用可反驳的常量或具有多个变体的枚举变体时，它们是可反驳的。</p>
<div class="rule" id="r-patterns.const"><a class="rule-link" href="#r-patterns.const" title="patterns.const"><span>[patterns<wbr>.const]</span></a>
</div>

<h3 id="常量模式"><a class="header" href="#常量模式">常量模式</a></h3>
<div class="rule" id="r-patterns.const.partial-eq"><a class="rule-link" href="#r-patterns.const.partial-eq" title="patterns.const.partial-eq"><span>[patterns<wbr>.const<wbr>.partial-eq]</span></a>
</div>

<p>当 <code>T</code> 类型的常量 <code>C</code> 用作模式时，我们首先检查 <code>T: PartialEq</code> 。</p>
<div class="rule" id="r-patterns.const.structural-equality"><a class="rule-link" href="#r-patterns.const.structural-equality" title="patterns.const.structural-equality"><span>[patterns<wbr>.const<wbr>.structural-equality]</span></a>
</div>

<p>此外，我们要求 <code>C</code> 的值 <em>具有（递归）结构相等性</em> ，其递归定义如下：</p>
<div class="rule" id="r-patterns.const.primitive"><a class="rule-link" href="#r-patterns.const.primitive" title="patterns.const.primitive"><span>[patterns<wbr>.const<wbr>.primitive]</span></a>
</div>

<ul>
<li>整数以及 <code>str</code> 、 <code>bool</code> 和 <code>char</code> 值始终具有结构相等性。</li>
</ul>
<div class="rule" id="r-patterns.const.builtin-aggregate"><a class="rule-link" href="#r-patterns.const.builtin-aggregate" title="patterns.const.builtin-aggregate"><span>[patterns<wbr>.const<wbr>.builtin-aggregate]</span></a>
</div>

<ul>
<li>如果元组、数组和切片的所有字段/元素都具有结构相等性，则它们具有结构相等性。
（特别是， <code>()</code> 和 <code>[]</code> 始终具有结构相等性。）</li>
</ul>
<div class="rule" id="r-patterns.const.ref"><a class="rule-link" href="#r-patterns.const.ref" title="patterns.const.ref"><span>[patterns<wbr>.const<wbr>.ref]</span></a>
</div>

<ul>
<li>如果引用指向的值具有结构相等性，则该引用具有结构相等性。</li>
</ul>
<div class="rule" id="r-patterns.const.aggregate"><a class="rule-link" href="#r-patterns.const.aggregate" title="patterns.const.aggregate"><span>[patterns<wbr>.const<wbr>.aggregate]</span></a>
</div>

<ul>
<li>如果 结构体 或 枚举 类型的值其 <code>PartialEq</code> 实例是通过 <code>#[derive(PartialEq)]</code> 派生的，并且所有字段（对于枚举：活跃变体的字段）都具有结构相等性，则该值具有结构相等性。</li>
</ul>
<div class="rule" id="r-patterns.const.pointer"><a class="rule-link" href="#r-patterns.const.pointer" title="patterns.const.pointer"><span>[patterns<wbr>.const<wbr>.pointer]</span></a>
</div>

<ul>
<li>如果原始指针被定义为常量整数（然后进行转换/变形），则它具有结构相等性。</li>
</ul>
<div class="rule" id="r-patterns.const.float"><a class="rule-link" href="#r-patterns.const.float" title="patterns.const.float"><span>[patterns<wbr>.const<wbr>.float]</span></a>
</div>

<ul>
<li>如果浮点值不是 <code>NaN</code> ，则它具有结构相等性。</li>
</ul>
<div class="rule" id="r-patterns.const.exhaustive"><a class="rule-link" href="#r-patterns.const.exhaustive" title="patterns.const.exhaustive"><span>[patterns<wbr>.const<wbr>.exhaustive]</span></a>
</div>

<ul>
<li>其他任何东西都不具有结构相等性。</li>
</ul>
<div class="rule" id="r-patterns.const.generic"><a class="rule-link" href="#r-patterns.const.generic" title="patterns.const.generic"><span>[patterns<wbr>.const<wbr>.generic]</span></a>
</div>

<p>特别地， <code>C</code> 的值必须在模式构建时（即预单态化阶段）已知。
这意味着涉及 泛型 参数的关联常量不能用作模式。</p>
<div class="rule" id="r-patterns.const.immutable"><a class="rule-link" href="#r-patterns.const.immutable" title="patterns.const.immutable"><span>[patterns<wbr>.const<wbr>.immutable]</span></a>
</div>

<p><code>C</code> 的值不能包含对可变静态变量（ <code>static mut</code> 项 或内部可变 <code>static</code> 项）或 <code>extern</code> 静态变量的任何引用。</p>
<div class="rule" id="r-patterns.const.translation"><a class="rule-link" href="#r-patterns.const.translation" title="patterns.const.translation"><span>[patterns<wbr>.const<wbr>.translation]</span></a>
</div>

<p>在确保满足所有条件后，常量值将被转换为模式，其行为现在完全就像直接编写了该模式一样。
特别是，它完全参与穷尽性检查。
（对于原始指针，常量是编写此类模式的唯一方法。对于这些类型，只有 <code>_</code> 被认为是穷尽的。）</p>
<div class="rule" id="r-patterns.or"><a class="rule-link" href="#r-patterns.or" title="patterns.or"><span>[patterns<wbr>.or]</span></a>
</div>

<h2 id="或模式"><a class="header" href="#或模式">或模式</a></h2>
<p><em>或模式</em> 是匹配两个或多个子模式之一的模式（例如 <code>A | B | C</code> ）。
它们可以任意嵌套。
从 语法格式 上讲，或模式允许出现在允许其他模式出现的任何地方（由 <a href="#grammar-Pattern">Pattern</a> 产生式表示），但 <code>let</code> 绑定以及函数和闭包参数（由 <a href="#grammar-PatternNoTopAlt">PatternNoTopAlt</a> 产生式表示）除外。</p>
<div class="rule" id="r-patterns.constraints"><a class="rule-link" href="#r-patterns.constraints" title="patterns.constraints"><span>[patterns<wbr>.constraints]</span></a>
</div>

<h3 id="静态语义"><a class="header" href="#静态语义">静态语义</a></h3>
<div class="rule" id="r-patterns.constraints.pattern"><a class="rule-link" href="#r-patterns.constraints.pattern" title="patterns.constraints.pattern"><span>[patterns<wbr>.constraints<wbr>.pattern]</span></a>
</div>

<ol>
<li>
<p>给定某种深度的模式 <code>p | q</code> （对于任意模式 <code>p</code> 和 <code>q</code> ），如果满足以下条件，则认为该模式是格式不良的：</p>
<ul>
<li>为 <code>p</code> 推断出的类型与为 <code>q</code> 推断出的类型不统一，或者</li>
<li><code>p</code> 和 <code>q</code> 中没有引入相同的绑定集，或者</li>
<li><code>p</code> 和 <code>q</code> 中具有相同名称的任何两个绑定的类型在类型或绑定模式方面不统一。</li>
</ul>
<p>在上述所有实例中，类型的统一都是精确的，且隐式 <a href="#隐式类型转换">类型强制转换</a> 不适用。</p>
</li>
</ol>
<div class="rule" id="r-patterns.constraints.match-type-check"><a class="rule-link" href="#r-patterns.constraints.match-type-check" title="patterns.constraints.match-type-check"><span>[patterns<wbr>.constraints<wbr>.match-type-check]</span></a>
</div>

<ol start="2">
<li>在对表达式 <code>match e_s { a_1 =&gt; e_1, ... a_n =&gt; e_n }</code> 进行类型检查时，对于包含 <code>p_i | q_i</code> 形式模式的每个 match 臂 <code>a_i</code> ，如果在其存在的深度 <code>d</code> 处， <code>e_s</code> 在深度 <code>d</code> 处的片段类型与 <code>p_i | q_i</code> 不统一，则模式 <code>p_i | q_i</code> 被认为是格式不良的。</li>
</ol>
<div class="rule" id="r-patterns.constraints.exhaustiveness-or-pattern"><a class="rule-link" href="#r-patterns.constraints.exhaustiveness-or-pattern" title="patterns.constraints.exhaustiveness-or-pattern"><span>[patterns<wbr>.constraints<wbr>.exhaustiveness-or-pattern]</span></a>
</div>

<ol start="3">
<li>
<p>关于穷尽性检查，模式 <code>p | q</code> 被视为同时覆盖了 <code>p</code> 和 <code>q</code> 。
对于某些构造函数 <code>c(x, ..)</code> ，分配律适用，使得 <code>c(p | q, ..rest)</code> 覆盖的值集与 <code>c(p, ..rest) | c(q, ..rest)</code> 覆盖的值集相同。
这可以递归应用，直到除了存在于顶层的模式之外，不再有 <code>p | q</code> 形式的嵌套模式。</p>
<p>请注意，这里的 “构造函数” 指的不是元组结构体模式，而是指任何乘积类型的模式。
这包括枚举变体、元组结构体、具有命名字段的 结构体 、数组、元组和切片。</p>
</li>
</ol>
<div class="rule" id="r-patterns.behavior"><a class="rule-link" href="#r-patterns.behavior" title="patterns.behavior"><span>[patterns<wbr>.behavior]</span></a>
</div>

<h3 id="动态语义"><a class="header" href="#动态语义">动态语义</a></h3>
<div class="rule" id="r-patterns.behavior.nested-or-patterns"><a class="rule-link" href="#r-patterns.behavior.nested-or-patterns" title="patterns.behavior.nested-or-patterns"><span>[patterns<wbr>.behavior<wbr>.nested-or-patterns]</span></a>
</div>

<ol>
<li>在深度 <code>d</code> 处，将 <a href="#scrutinee">被匹配</a> 表达式 <code>e_s</code> 与模式 <code>c(p | q, ..rest)</code> 进行模式匹配的动态语义（其中 <code>c</code> 是某种构造函数， <code>p</code> 和 <code>q</code> 是任意模式， <code>rest</code> 是 <code>c</code> 中可选的任何剩余潜在因子）被定义为与 <code>c(p, ..rest) | c(q, ..rest)</code> 的动态语义相同。</li>
</ol>
<div class="rule" id="r-patterns.precedence"><a class="rule-link" href="#r-patterns.precedence" title="patterns.precedence"><span>[patterns<wbr>.precedence]</span></a>
</div>

<h3 id="与其他无定界模式的优先级"><a class="header" href="#与其他无定界模式的优先级">与其他无定界模式的优先级</a></h3>
<p>正如本章其他地方所示，有几种类型的模式在 语法格式 上是无定界的，包括标识符模式、引用模式和或模式。
或模式始终具有最低优先级。
这允许我们为将来可能出现的类型注记（type ascription）特性预留 语法格式 空间，并减少歧义。
例如， <code>x @ A(..) | B(..)</code> 将导致错误，即 <code>x</code> 未在所有模式中绑定。
<code>&amp;A(x) | B(x)</code> 将导致不同子模式中 <code>x</code> 之间的类型不匹配。</p>
<hr>
<ol class="footnote-definition">
<li id="footnote-obsolete-range-edition">
<p><a href="#grammar-ObsoleteRangePattern">ObsoleteRangePattern</a>  语法格式 在 2021 版次中已被移除。 <a href="#fr-obsolete-range-edition-1">↩</a></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="类型系统"><a class="header" href="#类型系统">类型系统</a></h1>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type"><a class="rule-link" href="#r-type" title="type"><span>[type]</span></a>
</div>

<h1 id="类型"><a class="header" href="#类型">类型</a></h1>
<div class="rule" id="r-type.intro"><a class="rule-link" href="#r-type.intro" title="type.intro"><span>[type<wbr>.intro]</span></a>
</div>

<p>Rust 程序中的每个变量、 项 和值都有一个类型。 <em>值</em> 的 <em>类型</em> 定义了对持有它的内存的解释以及可以对该值执行的操作。</p>
<div class="rule" id="r-type.builtin"><a class="rule-link" href="#r-type.builtin" title="type.builtin"><span>[type<wbr>.builtin]</span></a>
</div>

<p>内置类型紧密地集成到语言中，其方式非常复杂，无法在用户定义类型中模拟。</p>
<div class="rule" id="r-type.user-defined"><a class="rule-link" href="#r-type.user-defined" title="type.user-defined"><span>[type<wbr>.user-defined]</span></a>
</div>

<p>用户定义类型的能力有限。</p>
<div class="rule" id="r-type.kinds"><a class="rule-link" href="#r-type.kinds" title="type.kinds"><span>[type<wbr>.kinds]</span></a>
</div>

<p>类型列表如下：</p>
<ul>
<li>原语类型：
<ul>
<li><a href="#布尔类型">布尔型</a> — <code>bool</code></li>
<li><a href="#数值类型">数值型</a> — 整数和浮点数</li>
<li><a href="#文本类型">文本型</a> — <code>char</code> 和 <code>str</code></li>
<li><a href="#never类型">Never</a> — <code>!</code> — 一种没有值的类型</li>
</ul>
</li>
<li>序列类型：
<ul>
<li><a href="#元组类型">元组</a></li>
<li><a href="#数组类型">数组</a></li>
<li><a href="#切片类型">切片</a></li>
</ul>
</li>
<li>用户定义类型：
<ul>
<li><a href="#结构体类型">结构体</a></li>
<li><a href="#枚举类型">枚举</a></li>
<li><a href="#联合体类型">联合体</a></li>
</ul>
</li>
<li>函数类型：
<ul>
<li><a href="#函数项类型">函数</a></li>
<li><a href="#闭包类型">闭包</a></li>
</ul>
</li>
<li>指针类型：
<ul>
<li><a href="#shared-references-">引用</a></li>
<li><a href="#raw-pointers-const-and-mut">裸指针</a></li>
<li><a href="#函数指针类型">函数指针</a></li>
</ul>
</li>
<li>特型类型：
<ul>
<li><a href="#特型对象">特型对象</a></li>
<li><a href="#impl-trait">impl 特型</a></li>
</ul>
</li>
</ul>
<div class="rule" id="r-type.name"><a class="rule-link" href="#r-type.name" title="type.name"><span>[type<wbr>.name]</span></a>
</div>

<h2 id="类型表达式"><a class="header" href="#类型表达式">类型表达式</a></h2>
<div class="rule" id="r-type.name.syntax"><a class="rule-link" href="#r-type.name.syntax" title="type.name.syntax"><span>[type<wbr>.name<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-Type" onclick="show_railroad()"><a href="#railroad-Type">Type</a></span> → <br>      <span class="grammar-text"><a href="#grammar-TypeNoBounds">TypeNoBounds</a></span> <br>    | <span class="grammar-text"><a href="#grammar-ImplTraitType">ImplTraitType</a></span> <br>    | <span class="grammar-text"><a href="#grammar-TraitObjectType">TraitObjectType</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-TypeNoBounds" onclick="show_railroad()"><a href="#railroad-TypeNoBounds">TypeNoBounds</a></span> → <br>      <span class="grammar-text"><a href="#grammar-ParenthesizedType">ParenthesizedType</a></span> <br>    | <span class="grammar-text"><a href="#grammar-ImplTraitTypeOneBound">ImplTraitTypeOneBound</a></span> <br>    | <span class="grammar-text"><a href="#grammar-TraitObjectTypeOneBound">TraitObjectTypeOneBound</a></span> <br>    | <span class="grammar-text"><a href="#grammar-TypePath">TypePath</a></span> <br>    | <span class="grammar-text"><a href="#grammar-TupleType">TupleType</a></span> <br>    | <span class="grammar-text"><a href="#grammar-NeverType">NeverType</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RawPointerType">RawPointerType</a></span> <br>    | <span class="grammar-text"><a href="#grammar-ReferenceType">ReferenceType</a></span> <br>    | <span class="grammar-text"><a href="#grammar-ArrayType">ArrayType</a></span> <br>    | <span class="grammar-text"><a href="#grammar-SliceType">SliceType</a></span> <br>    | <span class="grammar-text"><a href="#grammar-InferredType">InferredType</a></span> <br>    | <span class="grammar-text"><a href="#grammar-QualifiedPathInType">QualifiedPathInType</a></span> <br>    | <span class="grammar-text"><a href="#grammar-BareFunctionType">BareFunctionType</a></span> <br>    | <span class="grammar-text"><a href="#grammar-MacroInvocation">MacroInvocation</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 258px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Type"><svg class="railroad" viewbox="0 0 258 140" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Type">
<text class="comment" x="29" y="25">
Type</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 116 0 h 48" />
<g class="sequence">
<a class="link" xlink:href="#railroad-TypeNoBounds">
<g class="nonterminal">
<rect height="22" width="116" x="59" y="42" />
<text x="117" y="58">
TypeNoBounds</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 164 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 164 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 124 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ImplTraitType">
<g class="nonterminal">
<rect height="22" width="124" x="59" y="75" />
<text x="121" y="91">
ImplTraitType</text>
</g>
</a>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 140 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-TraitObjectType">
<g class="nonterminal">
<rect height="22" width="140" x="59" y="108" />
<text x="129" y="124">
TraitObjectType</text>
</g>
</a>
</g>
<path d=" M 233 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 223 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 330px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TypeNoBounds"><svg class="railroad" viewbox="0 0 330 503" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TypeNoBounds">
<text class="comment" x="57" y="25">
TypeNoBounds</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 156 0 h 80 m -37 0 l -5 -5 m 0 10 l 5 -5 m 37 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ParenthesizedType">
<g class="nonterminal">
<rect height="22" width="156" x="59" y="42" />
<text x="137" y="58">
ParenthesizedType</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 236 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 236 0 v -33" />
<path d=" M 47 107 v 33 m 236 0 v -33" />
<path d=" M 47 140 v 33 m 236 0 v -33" />
<path d=" M 47 173 v 33 m 236 0 v -33" />
<path d=" M 47 206 v 33 m 236 0 v -33" />
<path d=" M 47 239 v 33 m 236 0 v -33" />
<path d=" M 47 272 v 33 m 236 0 v -33" />
<path d=" M 47 305 v 33 m 236 0 v -33" />
<path d=" M 47 338 v 33 m 236 0 v -33" />
<path d=" M 47 371 v 33 m 236 0 v -33" />
<path d=" M 47 404 v 33 m 236 0 v -33" />
<path d=" M 47 437 v 33 m 236 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 196 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ImplTraitTypeOneBound">
<g class="nonterminal">
<rect height="22" width="196" x="59" y="75" />
<text x="157" y="91">
ImplTraitTypeOneBound</text>
</g>
</a>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 212 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-TraitObjectTypeOneBound">
<g class="nonterminal">
<rect height="22" width="212" x="59" y="108" />
<text x="165" y="124">
TraitObjectTypeOneBound</text>
</g>
</a>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 84 0 h 128 m -61 0 l -5 -5 m 0 10 l 5 -5 m 61 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-TypePath">
<g class="nonterminal">
<rect height="22" width="84" x="59" y="141" />
<text x="101" y="157">
TypePath</text>
</g>
</a>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 92 0 h 120 m -57 0 l -5 -5 m 0 10 l 5 -5 m 57 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-TupleType">
<g class="nonterminal">
<rect height="22" width="92" x="59" y="174" />
<text x="105" y="190">
TupleType</text>
</g>
</a>
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 92 0 h 120 m -57 0 l -5 -5 m 0 10 l 5 -5 m 57 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-NeverType">
<g class="nonterminal">
<rect height="22" width="92" x="59" y="207" />
<text x="105" y="223">
NeverType</text>
</g>
</a>
</g>
<path d=" M 47 239 v 0 a 12 12 0 0 0 12 12 m 132 0 h 80 m -37 0 l -5 -5 m 0 10 l 5 -5 m 37 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-RawPointerType">
<g class="nonterminal">
<rect height="22" width="132" x="59" y="240" />
<text x="125" y="256">
RawPointerType</text>
</g>
</a>
</g>
<path d=" M 47 272 v 0 a 12 12 0 0 0 12 12 m 124 0 h 88 m -41 0 l -5 -5 m 0 10 l 5 -5 m 41 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ReferenceType">
<g class="nonterminal">
<rect height="22" width="124" x="59" y="273" />
<text x="121" y="289">
ReferenceType</text>
</g>
</a>
</g>
<path d=" M 47 305 v 0 a 12 12 0 0 0 12 12 m 92 0 h 120 m -57 0 l -5 -5 m 0 10 l 5 -5 m 57 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ArrayType">
<g class="nonterminal">
<rect height="22" width="92" x="59" y="306" />
<text x="105" y="322">
ArrayType</text>
</g>
</a>
</g>
<path d=" M 47 338 v 0 a 12 12 0 0 0 12 12 m 92 0 h 120 m -57 0 l -5 -5 m 0 10 l 5 -5 m 57 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-SliceType">
<g class="nonterminal">
<rect height="22" width="92" x="59" y="339" />
<text x="105" y="355">
SliceType</text>
</g>
</a>
</g>
<path d=" M 47 371 v 0 a 12 12 0 0 0 12 12 m 116 0 h 96 m -45 0 l -5 -5 m 0 10 l 5 -5 m 45 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-InferredType">
<g class="nonterminal">
<rect height="22" width="116" x="59" y="372" />
<text x="117" y="388">
InferredType</text>
</g>
</a>
</g>
<path d=" M 47 404 v 0 a 12 12 0 0 0 12 12 m 172 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-QualifiedPathInType">
<g class="nonterminal">
<rect height="22" width="172" x="59" y="405" />
<text x="145" y="421">
QualifiedPathInType</text>
</g>
</a>
</g>
<path d=" M 47 437 v 0 a 12 12 0 0 0 12 12 m 148 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-BareFunctionType">
<g class="nonterminal">
<rect height="22" width="148" x="59" y="438" />
<text x="133" y="454">
BareFunctionType</text>
</g>
</a>
</g>
<path d=" M 47 470 v 0 a 12 12 0 0 0 12 12 m 140 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-MacroInvocation">
<g class="nonterminal">
<rect height="22" width="140" x="59" y="471" />
<text x="129" y="487">
MacroInvocation</text>
</g>
</a>
</g>
<path d=" M 305 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 295 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-type.name.intro"><a class="rule-link" href="#r-type.name.intro" title="type.name.intro"><span>[type<wbr>.name<wbr>.intro]</span></a>
</div>

<p>上面 <a href="#r-type">类型</a> 语法格式规则中定义的 <em>类型表达式</em> 是引用类型的语法格式。它可以引用：</p>
<div class="rule" id="r-type.name.sequence"><a class="rule-link" href="#r-type.name.sequence" title="type.name.sequence"><span>[type<wbr>.name<wbr>.sequence]</span></a>
</div>

<ul>
<li>序列类型（ <a href="#元组类型">元组</a>、 <a href="#数组类型">数组</a>、 <a href="#切片类型">切片</a> ）。</li>
</ul>
<div class="rule" id="r-type.name.path"><a class="rule-link" href="#r-type.name.path" title="type.name.path"><span>[type<wbr>.name<wbr>.path]</span></a>
</div>

<ul>
<li><a href="#paths-in-types">类型路径</a> 可以引用：
<ul>
<li>原语类型（ <a href="#布尔类型">布尔型</a>、 <a href="#数值类型">数值型</a>、 <a href="#文本类型">文本型</a> ）。</li>
<li>指向 <a href="#项">项</a> 的路径（ <a href="#结构体类型">结构体</a>、 <a href="#枚举类型">枚举</a>、 <a href="#联合体类型">联合体</a>、 <a href="#类型别名">类型别名</a>、 <a href="#特型对象">特型</a> ）。</li>
<li><a href="#self-1"><code>Self</code> 路径</a> ，其中 <code>Self</code> 是实现类型。</li>
<li>泛型 <a href="#类型参数">类型参数</a> 。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-type.name.pointer"><a class="rule-link" href="#r-type.name.pointer" title="type.name.pointer"><span>[type<wbr>.name<wbr>.pointer]</span></a>
</div>

<ul>
<li>指针类型（ <a href="#shared-references-">引用</a>、 <a href="#raw-pointers-const-and-mut">裸指针</a>、 <a href="#函数指针类型">函数指针</a> ）。</li>
</ul>
<div class="rule" id="r-type.name.inference"><a class="rule-link" href="#r-type.name.inference" title="type.name.inference"><span>[type<wbr>.name<wbr>.inference]</span></a>
</div>

<ul>
<li><a href="#推断类型">推断类型</a> ，它要求编译器确定类型。</li>
</ul>
<div class="rule" id="r-type.name.grouped"><a class="rule-link" href="#r-type.name.grouped" title="type.name.grouped"><span>[type<wbr>.name<wbr>.grouped]</span></a>
</div>

<ul>
<li>用于消除歧义的 <a href="#parenthesized-types">括号</a> 。</li>
</ul>
<div class="rule" id="r-type.name.trait"><a class="rule-link" href="#r-type.name.trait" title="type.name.trait"><span>[type<wbr>.name<wbr>.trait]</span></a>
</div>

<ul>
<li>特型类型： <a href="#特型对象">特型对象</a> 和 <a href="#impl-trait">impl 特型</a> 。</li>
</ul>
<div class="rule" id="r-type.name.never"><a class="rule-link" href="#r-type.name.never" title="type.name.never"><span>[type<wbr>.name<wbr>.never]</span></a>
</div>

<ul>
<li><a href="#never类型">never</a> 类型。</li>
</ul>
<div class="rule" id="r-type.name.macro-expansion"><a class="rule-link" href="#r-type.name.macro-expansion" title="type.name.macro-expansion"><span>[type<wbr>.name<wbr>.macro-expansion]</span></a>
</div>

<ul>
<li>展开为类型表达式的 <a href="#宏">宏</a> 。</li>
</ul>
<div class="rule" id="r-type.name.parenthesized"><a class="rule-link" href="#r-type.name.parenthesized" title="type.name.parenthesized"><span>[type<wbr>.name<wbr>.parenthesized]</span></a>
</div>

<h3 id="括号类型"><a class="header" href="#括号类型">括号类型</a></h3>
<div class="rule" id="r-type.name.parenthesized.syntax"><a class="rule-link" href="#r-type.name.parenthesized.syntax" title="type.name.parenthesized.syntax"><span>[type<wbr>.name<wbr>.parenthesized<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ParenthesizedType" onclick="show_railroad()"><a href="#railroad-ParenthesizedType">ParenthesizedType</a></span> → <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-Type">Type</a></span> <span class="grammar-literal">)</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 198px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ParenthesizedType"><svg class="railroad" viewbox="0 0 198 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ParenthesizedType">
<text class="comment" x="74" y="25">
ParenthesizedType</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="42" />
<text x="49" y="58">
(</text>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="73" y="42" />
<text x="99" y="58">
Type</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="135" y="42" />
<text x="149" y="58">
)</text>
</g>
<path d=" M 63 53 h 10" />
<path d=" M 125 53 h 10" />
</g>
<path d=" M 173 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 163 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-type.name.parenthesized.intro"><a class="rule-link" href="#r-type.name.parenthesized.intro" title="type.name.parenthesized.intro"><span>[type<wbr>.name<wbr>.parenthesized<wbr>.intro]</span></a>
</div>

<p>在某些情况下，类型的组合可能会产生歧义。在类型周围使用括号以避免歧义。例如， <a href="#shared-references-">引用类型</a> 中用于 <a href="#特型和生命周期界限">特型边界</a> 的 <code>+</code> 运算符不清楚边界应用于何处，因此需要使用括号。需要这种消除歧义的语法格式规则使用 <a href="#grammar-TypeNoBounds">TypeNoBounds</a> 规则而不是 <a href="#grammar-Type">类型</a> 。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use std::any::Any;
</span>type T&lt;'a&gt; = &amp;'a (dyn Any + Send);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.recursive"><a class="rule-link" href="#r-type.recursive" title="type.recursive"><span>[type<wbr>.recursive]</span></a>
</div>

<h2 id="递归类型"><a class="header" href="#递归类型">递归类型</a></h2>
<div class="rule" id="r-type.recursive.intro"><a class="rule-link" href="#r-type.recursive.intro" title="type.recursive.intro"><span>[type<wbr>.recursive<wbr>.intro]</span></a>
</div>

<p>标称类型 —— <a href="#结构体类型">结构体</a> 、 <a href="#枚举类型">枚举</a> 和 <a href="#联合体类型">联合体</a> —— 可能是递归的。也就是说，每个 <code>enum</code> 变体或 <code>struct</code> 或 <code>union</code> 字段可以直接或间接地引用包围它的 <code>enum</code> 或 <code>struct</code> 类型本身。</p>
<div class="rule" id="r-type.recursive.constraint"><a class="rule-link" href="#r-type.recursive.constraint" title="type.recursive.constraint"><span>[type<wbr>.recursive<wbr>.constraint]</span></a>
</div>

<p>这种递归有限制：</p>
<ul>
<li>递归类型必须在递归中包含一个标称类型（不只是 <a href="#类型别名">类型别名</a> ，或者其他结构化类型，如 <a href="#数组类型">数组</a> 或 <a href="#元组类型">元组</a> ）。因此 <code>type Rec = &amp;'static [Rec]</code> 是不允许的。</li>
<li>递归类型的大小必须是有限的；换句话说，类型的递归字段必须是 <a href="#指针类型">指针类型</a> 。</li>
</ul>
<p>一个 <em>递归</em> 类型及其使用的示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum List&lt;T&gt; {
    Nil,
    Cons(T, Box&lt;List&lt;T&gt;&gt;)
}

let a: List&lt;i32&gt; = List::Cons(7, Box::new(List::Cons(13, Box::new(List::Nil))));
<span class="boring">}</span></code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type.bool"><a class="rule-link" href="#r-type.bool" title="type.bool"><span>[type<wbr>.bool]</span></a>
</div>

<h1 id="布尔类型"><a class="header" href="#布尔类型">布尔类型</a></h1>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let b: bool = true;
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.bool.intro"><a class="rule-link" href="#r-type.bool.intro" title="type.bool.intro"><span>[type<wbr>.bool<wbr>.intro]</span></a>
</div>

<ul>
<li>布尔类型 * 或 * bool * 是一种原始数据类型，可以取两个值之一，称为 * true * 和 * false * 。</li>
</ul>
<div class="rule" id="r-type.bool.literal"><a class="rule-link" href="#r-type.bool.literal" title="type.bool.literal"><span>[type<wbr>.bool<wbr>.literal]</span></a>
</div>

<p>该类型的值可以使用 <a href="#字面量表达式">字面量表达式</a> 创建，使用对应于同名值的关键字 <code>true</code> 和 <code>false</code> 。</p>
<div class="rule" id="r-type.bool.namespace"><a class="rule-link" href="#r-type.bool.namespace" title="type.bool.namespace"><span>[type<wbr>.bool<wbr>.namespace]</span></a>
</div>

<p>该类型是 <a href="#language-prelude">语言预导入</a> 的一部分， <a href="#名称">名称</a> 为 <code>bool</code> 。</p>
<div class="rule" id="r-type.bool.layout"><a class="rule-link" href="#r-type.bool.layout" title="type.bool.layout"><span>[type<wbr>.bool<wbr>.layout]</span></a>
</div>

<p>布尔类型的对象其 <a href="#size-and-alignment">大小和对齐</a> 均为 1 。</p>
<div class="rule" id="r-type.bool.repr"><a class="rule-link" href="#r-type.bool.repr" title="type.bool.repr"><span>[type<wbr>.bool<wbr>.repr]</span></a>
</div>

<p>值 false 的位模式为 <code>0x00</code> ，值 true 的位模式为 <code>0x01</code> 。布尔类型的对象具有任何其他位模式都是 <a href="#被视为未定义的行为">未定义行为</a> 。</p>
<div class="rule" id="r-type.bool.usage"><a class="rule-link" href="#r-type.bool.usage" title="type.bool.usage"><span>[type<wbr>.bool<wbr>.usage]</span></a>
</div>

<p>布尔类型是各种 <a href="#表达式">表达式</a> 中许多操作数的类型：</p>
<div class="rule" id="r-type.bool.usage-condition"><a class="rule-link" href="#r-type.bool.usage-condition" title="type.bool.usage-condition"><span>[type<wbr>.bool<wbr>.usage-condition]</span></a>
</div>

<ul>
<li><a href="#if-expressions">if 表达式</a> 和 <a href="#predicate-loops">while 表达式</a> 中的条件操作数</li>
</ul>
<div class="rule" id="r-type.bool.usage-lazy-operator"><a class="rule-link" href="#r-type.bool.usage-lazy-operator" title="type.bool.usage-lazy-operator"><span>[type<wbr>.bool<wbr>.usage-lazy-operator]</span></a>
</div>

<ul>
<li><a href="#lazy-boolean-operators">惰性布尔运算符表达式</a> 中的操作数</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>布尔类型的作用类似于但不是 <a href="#枚举类型">枚举类型</a> 。在实践中，这主要意味着构造函数不与类型相关联 (例如 <code>bool::true</code>) 。</p>
</blockquote>
</div>

<div class="rule" id="r-type.bool.traits"><a class="rule-link" href="#r-type.bool.traits" title="type.bool.traits"><span>[type<wbr>.bool<wbr>.traits]</span></a>
</div>

<p>与所有原始类型一样，布尔类型 <a href="#实现">实现</a> 了 <a href="#特型">特型</a> <a href="#clone"><code>Clone</code></a>、 <a href="#copy"><code>Copy</code></a>、 <a href="#sized-1"><code>Sized</code></a>、 <a href="#send"><code>Send</code></a> 和 <a href="#sync"><code>Sync</code></a> 。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>有关库操作，请参阅 <a href="../std/primitive.bool.html">标准库文档</a> 。</p>
</blockquote>
</div>

<div class="rule" id="r-type.bool.expr"><a class="rule-link" href="#r-type.bool.expr" title="type.bool.expr"><span>[type<wbr>.bool<wbr>.expr]</span></a>
</div>

<h2 id="布尔值的运算"><a class="header" href="#布尔值的运算">布尔值的运算</a></h2>
<p>当对布尔类型的操作数使用某些运算符表达式时，它们按照 <a href="https://en.wikipedia.org/wiki/Boolean_algebra">布尔逻辑</a> 的规则进行求值。</p>
<div class="rule" id="r-type.bool.expr.not"><a class="rule-link" href="#r-type.bool.expr.not" title="type.bool.expr.not"><span>[type<wbr>.bool<wbr>.expr<wbr>.not]</span></a>
</div>

<h3 id="逻辑非"><a class="header" href="#逻辑非">逻辑非</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th><code>b</code></th><th><a href="#negation-operators"><code>!b</code></a></th></tr>
</thead>
<tbody>
<tr><td><code>true</code></td><td><code>false</code></td></tr>
<tr><td><code>false</code></td><td><code>true</code></td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-type.bool.expr.or"><a class="rule-link" href="#r-type.bool.expr.or" title="type.bool.expr.or"><span>[type<wbr>.bool<wbr>.expr<wbr>.or]</span></a>
</div>

<h3 id="逻辑或"><a class="header" href="#逻辑或">逻辑或</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th><code>a</code></th><th><code>b</code></th><th><a href="#arithmetic-and-logical-binary-operators"><code>a | b</code></a></th></tr>
</thead>
<tbody>
<tr><td><code>true</code></td><td><code>true</code></td><td><code>true</code></td></tr>
<tr><td><code>true</code></td><td><code>false</code></td><td><code>true</code></td></tr>
<tr><td><code>false</code></td><td><code>true</code></td><td><code>true</code></td></tr>
<tr><td><code>false</code></td><td><code>false</code></td><td><code>false</code></td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-type.bool.expr.and"><a class="rule-link" href="#r-type.bool.expr.and" title="type.bool.expr.and"><span>[type<wbr>.bool<wbr>.expr<wbr>.and]</span></a>
</div>

<h3 id="逻辑与"><a class="header" href="#逻辑与">逻辑与</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th><code>a</code></th><th><code>b</code></th><th><a href="#arithmetic-and-logical-binary-operators"><code>a &amp; b</code></a></th></tr>
</thead>
<tbody>
<tr><td><code>true</code></td><td><code>true</code></td><td><code>true</code></td></tr>
<tr><td><code>true</code></td><td>`false“</td><td><code>false</code></td></tr>
<tr><td><code>false</code></td><td><code>true</code></td><td><code>false</code></td></tr>
<tr><td><code>false</code></td><td><code>false</code></td><td><code>false</code></td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-type.bool.expr.xor"><a class="rule-link" href="#r-type.bool.expr.xor" title="type.bool.expr.xor"><span>[type<wbr>.bool<wbr>.expr<wbr>.xor]</span></a>
</div>

<h3 id="逻辑异或"><a class="header" href="#逻辑异或">逻辑异或</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th><code>a</code></th><th><code>b</code></th><th><a href="#arithmetic-and-logical-binary-operators"><code>a ^ b</code></a></th></tr>
</thead>
<tbody>
<tr><td><code>true</code></td><td><code>true</code></td><td><code>false</code></td></tr>
<tr><td><code>true</code></td><td><code>false</code></td><td><code>true</code></td></tr>
<tr><td><code>false</code></td><td><code>true</code></td><td><code>true</code></td></tr>
<tr><td><code>false</code></td><td><code>false</code></td><td><code>false</code></td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-type.bool.expr.cmp"><a class="rule-link" href="#r-type.bool.expr.cmp" title="type.bool.expr.cmp"><span>[type<wbr>.bool<wbr>.expr<wbr>.cmp]</span></a>
</div>

<h3 id="比较"><a class="header" href="#比较">比较</a></h3>
<div class="rule" id="r-type.bool.expr.cmp.eq"><a class="rule-link" href="#r-type.bool.expr.cmp.eq" title="type.bool.expr.cmp.eq"><span>[type<wbr>.bool<wbr>.expr<wbr>.cmp<wbr>.eq]</span></a>
</div>

<div class="table-wrapper">
<table>
<thead>
<tr><th><code>a</code></th><th><code>b</code></th><th><a href="#comparison-operators"><code>a == b</code></a></th></tr>
</thead>
<tbody>
<tr><td><code>true</code></td><td><code>true</code></td><td><code>true</code></td></tr>
<tr><td><code>true</code></td><td><code>false</code></td><td><code>false</code></td></tr>
<tr><td><code>false</code></td><td><code>true</code></td><td><code>false</code></td></tr>
<tr><td><code>false</code></td><td><code>false</code></td><td><code>true</code></td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-type.bool.expr.cmp.greater"><a class="rule-link" href="#r-type.bool.expr.cmp.greater" title="type.bool.expr.cmp.greater"><span>[type<wbr>.bool<wbr>.expr<wbr>.cmp<wbr>.greater]</span></a>
</div>

<div class="table-wrapper">
<table>
<thead>
<tr><th><code>a</code></th><th><code>b</code></th><th><a href="#comparison-operators"><code>a &gt; b</code></a></th></tr>
</thead>
<tbody>
<tr><td><code>true</code></td><td><code>true</code></td><td><code>false</code></td></tr>
<tr><td><code>true</code></td><td><code>false</code></td><td><code>true</code></td></tr>
<tr><td><code>false</code></td><td><code>true</code></td><td><code>false</code></td></tr>
<tr><td><code>false</code></td><td><code>false</code></td><td><code>false</code></td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-type.bool.expr.cmp.not-eq"><a class="rule-link" href="#r-type.bool.expr.cmp.not-eq" title="type.bool.expr.cmp.not-eq"><span>[type<wbr>.bool<wbr>.expr<wbr>.cmp<wbr>.not-eq]</span></a>
</div>

<ul>
<li><code>a != b</code> 与 <code>!(a == b)</code> 相同</li>
</ul>
<div class="rule" id="r-type.bool.expr.cmp.greater-eq"><a class="rule-link" href="#r-type.bool.expr.cmp.greater-eq" title="type.bool.expr.cmp.greater-eq"><span>[type<wbr>.bool<wbr>.expr<wbr>.cmp<wbr>.greater-eq]</span></a>
</div>

<ul>
<li><code>a &gt;= b</code> 与 <code>a == b | a &gt; b</code> 相同</li>
</ul>
<div class="rule" id="r-type.bool.expr.cmp.less"><a class="rule-link" href="#r-type.bool.expr.cmp.less" title="type.bool.expr.cmp.less"><span>[type<wbr>.bool<wbr>.expr<wbr>.cmp<wbr>.less]</span></a>
</div>

<ul>
<li><code>a &lt; b</code> 与 <code>!(a &gt;= b)</code> 相同</li>
</ul>
<div class="rule" id="r-type.bool.expr.cmp.less-eq"><a class="rule-link" href="#r-type.bool.expr.cmp.less-eq" title="type.bool.expr.cmp.less-eq"><span>[type<wbr>.bool<wbr>.expr<wbr>.cmp<wbr>.less-eq]</span></a>
</div>

<ul>
<li><code>a &lt;= b</code> 与 <code>a == b | a &lt; b</code> 相同</li>
</ul>
<div class="rule" id="r-type.bool.validity"><a class="rule-link" href="#r-type.bool.validity" title="type.bool.validity"><span>[type<wbr>.bool<wbr>.validity]</span></a>
</div>

<h2 id="位有效性"><a class="header" href="#位有效性">位有效性</a></h2>
<p><code>bool</code> 的单个字节保证被初始化 (换句话说， <code>transmute::&lt;bool, u8&gt;(...)</code> 总是健全的 – 但由于某些位模式是无效的 <code>bool</code> ，其反向操作并不总是健全的) 。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type.numeric"><a class="rule-link" href="#r-type.numeric" title="type.numeric"><span>[type<wbr>.numeric]</span></a>
</div>

<h1 id="数值类型"><a class="header" href="#数值类型">数值类型</a></h1>
<div class="rule" id="r-type.numeric.int"><a class="rule-link" href="#r-type.numeric.int" title="type.numeric.int"><span>[type<wbr>.numeric<wbr>.int]</span></a>
</div>

<h2 id="整数类型"><a class="header" href="#整数类型">整数类型</a></h2>
<div class="rule" id="r-type.numeric.int.unsigned"><a class="rule-link" href="#r-type.numeric.int.unsigned" title="type.numeric.int.unsigned"><span>[type<wbr>.numeric<wbr>.int<wbr>.unsigned]</span></a>
</div>

<p>无符号整数类型包括：</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>类型</th><th>最小值</th><th>最大值</th></tr>
</thead>
<tbody>
<tr><td><code>u8</code></td><td>0</td><td>2<sup>8</sup>-1</td></tr>
<tr><td><code>u16</code></td><td>0</td><td>2<sup>16</sup>-1</td></tr>
<tr><td><code>u32</code></td><td>0</td><td>2<sup>32</sup>-1</td></tr>
<tr><td><code>u64</code></td><td>0</td><td>2<sup>64</sup>-1</td></tr>
<tr><td><code>u128</code></td><td>0</td><td>2<sup>128</sup>-1</td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-type.numeric.int.signed"><a class="rule-link" href="#r-type.numeric.int.signed" title="type.numeric.int.signed"><span>[type<wbr>.numeric<wbr>.int<wbr>.signed]</span></a>
</div>

<p>有符号补码整数类型包括：</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>类型</th><th>最小值</th><th>最大值</th></tr>
</thead>
<tbody>
<tr><td><code>i8</code></td><td>-(2<sup>7</sup>)</td><td>2<sup>7</sup>-1</td></tr>
<tr><td><code>i16</code></td><td>-(2<sup>15</sup>)</td><td>2<sup>15</sup>-1</td></tr>
<tr><td><code>i32</code></td><td>-(2<sup>31</sup>)</td><td>2<sup>31</sup>-1</td></tr>
<tr><td><code>i64</code></td><td>-(2<sup>63</sup>)</td><td>2<sup>63</sup>-1</td></tr>
<tr><td><code>i128</code></td><td>-(2<sup>127</sup>)</td><td>2<sup>127</sup>-1</td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-type.numeric.float"><a class="rule-link" href="#r-type.numeric.float" title="type.numeric.float"><span>[type<wbr>.numeric<wbr>.float]</span></a>
</div>

<h2 id="浮点类型"><a class="header" href="#浮点类型">浮点类型</a></h2>
<p>IEEE 754-2008 “binary32” 和 “binary64” 浮点类型分别是 <code>f32</code> 和 <code>f64</code>。</p>
<div class="rule" id="r-type.numeric.int.size"><a class="rule-link" href="#r-type.numeric.int.size" title="type.numeric.int.size"><span>[type<wbr>.numeric<wbr>.int<wbr>.size]</span></a>
</div>

<h2 id="平台相关整数类型"><a class="header" href="#平台相关整数类型">平台相关整数类型</a></h2>
<div class="rule" id="r-type.numeric.int.size.usize"><a class="rule-link" href="#r-type.numeric.int.size.usize" title="type.numeric.int.size.usize"><span>[type<wbr>.numeric<wbr>.int<wbr>.size<wbr>.usize]</span></a>
</div>

<p><code>usize</code> 类型是一个无符号整数类型，其位数与平台的指针类型相同。它可以表示进程中的每个内存地址。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>虽然 <code>usize</code> 可以表示每个 * 地址 * ，但将 * 指针 * 转换为 <code>usize</code> 并不一定是可逆的操作。
有关更多信息，请参阅 <a href="#type-cast-expressions">类型转换表达式</a>、 <a href="../core/ptr/index.html"><code>std::ptr</code></a> 以及特别是 <a href="../core/ptr/index.html#provenance">来源</a> 的文档。</p>
</blockquote>
</div>

<div class="rule" id="r-type.numeric.int.size.isize"><a class="rule-link" href="#r-type.numeric.int.size.isize" title="type.numeric.int.size.isize"><span>[type<wbr>.numeric<wbr>.int<wbr>.size<wbr>.isize]</span></a>
</div>

<p><code>isize</code> 类型是一个有符号补码整数类型，其位数与平台的指针类型相同。对象和数组大小的理论上限是最大 <code>isize</code> 值。这确保了 <code>isize</code> 可用于计算对象或数组中指针之间的差值，并且可以寻址对象内的每个字节以及末尾之后的一个字节。</p>
<div class="rule" id="r-type.numeric.int.size.minimum"><a class="rule-link" href="#r-type.numeric.int.size.minimum" title="type.numeric.int.size.minimum"><span>[type<wbr>.numeric<wbr>.int<wbr>.size<wbr>.minimum]</span></a>
</div>

<p><code>usize</code> 和 <code>isize</code> 至少为 16 位宽。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>许多 Rust 代码可能会假设指针、 <code>usize</code> 和 <code>isize</code> 要么是 32 位要么是 64 位。因此，对 16 位指针的支持是有限的，并且可能需要库的显式关注和确认才能支持。</p>
</blockquote>
</div>

<div class="rule" id="r-type.numeric.validity"><a class="rule-link" href="#r-type.numeric.validity" title="type.numeric.validity"><span>[type<wbr>.numeric<wbr>.validity]</span></a>
</div>

<h2 id="位有效性-1"><a class="header" href="#位有效性-1">位有效性</a></h2>
<p>对于每个数值类型 <code>T</code> ， <code>T</code> 的位有效性等同于 <code>[u8; size_of::&lt;T&gt;()]</code> 的位有效性。未初始化的字节不是有效的 <code>u8</code> 。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type.text"><a class="rule-link" href="#r-type.text" title="type.text"><span>[type<wbr>.text]</span></a>
</div>

<h1 id="文本类型"><a class="header" href="#文本类型">文本类型</a></h1>
<div class="rule" id="r-type.text.intro"><a class="rule-link" href="#r-type.text.intro" title="type.text.intro"><span>[type<wbr>.text<wbr>.intro]</span></a>
</div>

<p><code>char</code> 和 <code>str</code> 类型保存文本数据。</p>
<div class="rule" id="r-type.text.char-value"><a class="rule-link" href="#r-type.text.char-value" title="type.text.char-value"><span>[type<wbr>.text<wbr>.char-value]</span></a>
</div>

<p><code>char</code> 类型的值是一个 <a href="http://www.unicode.org/glossary/#unicode_scalar_value">Unicode 标量值</a> （即不是代理对（surrogate）的码位），表示为 0x0000 到 0xD7FF 或 0xE000 到 0x10FFFF 范围内的 32 位无符号字。</p>
<div class="rule" id="r-type.text.char-precondition"><a class="rule-link" href="#r-type.text.char-precondition" title="type.text.char-precondition"><span>[type<wbr>.text<wbr>.char-precondition]</span></a>
</div>

<p>创建一个超出此范围的 <code>char</code> 会立即导致 <a href="#被视为未定义的行为">未定义行为</a> 。 <code>[char]</code> 实际上是一个长度为 1 的 UCS-4 / UTF-32 字符串。</p>
<div class="rule" id="r-type.text.str-value"><a class="rule-link" href="#r-type.text.str-value" title="type.text.str-value"><span>[type<wbr>.text<wbr>.str-value]</span></a>
</div>

<p><code>str</code> 类型的值的表示方式与 <code>[u8]</code> 相同，即 8 位无符号字节的切片。然而，Rust 标准库对 <code>str</code> 做了额外的假设：在 <code>str</code> 上操作的方法假定并确保其中的数据是有效的 UTF-8。使用非 UTF-8 缓冲区调用 <code>str</code> 方法可能会在现在或将来导致 <a href="#被视为未定义的行为">未定义行为</a> 。</p>
<div class="rule" id="r-type.text.str-unsized"><a class="rule-link" href="#r-type.text.str-unsized" title="type.text.str-unsized"><span>[type<wbr>.text<wbr>.str-unsized]</span></a>
</div>

<p>由于 <code>str</code> 是 <a href="#动态大小类型">动态大小类型</a> ，它只能通过指针类型实例化，例如 <code>&amp;str</code> 。 <code>&amp;str</code> 的布局与 <code>&amp;[u8]</code> 的布局相同。</p>
<div class="rule" id="r-type.text.layout"><a class="rule-link" href="#r-type.text.layout" title="type.text.layout"><span>[type<wbr>.text<wbr>.layout]</span></a>
</div>

<h2 id="布局和位有效性"><a class="header" href="#布局和位有效性">布局和位有效性</a></h2>
<div class="rule" id="r-type.layout.char-layout"><a class="rule-link" href="#r-type.layout.char-layout" title="type.layout.char-layout"><span>[type<wbr>.layout<wbr>.char-layout]</span></a>
</div>

<p><code>char</code> 在所有平台上保证具有与 <code>u32</code> 相同的大小和对齐。</p>
<div class="rule" id="r-type.layout.char-validity"><a class="rule-link" href="#r-type.layout.char-validity" title="type.layout.char-validity"><span>[type<wbr>.layout<wbr>.char-validity]</span></a>
</div>

<p><code>char</code> 的每个字节都保证被初始化（换句话说， <code>transmute::&lt;char, [u8; size_of::&lt;char&gt;()]&gt;(...)</code> 总是健全的——但由于某些位模式是无效的 <code>char</code> ，反向操作并不总是健全的）。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type.never"><a class="rule-link" href="#r-type.never" title="type.never"><span>[type<wbr>.never]</span></a>
</div>

<h1 id="never类型"><a class="header" href="#never类型">Never类型</a></h1>
<div class="rule" id="r-type.never.syntax"><a class="rule-link" href="#r-type.never.syntax" title="type.never.syntax"><span>[type<wbr>.never<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-NeverType" onclick="show_railroad()"><a href="#railroad-NeverType">NeverType</a></span> → <span class="grammar-literal">!</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 98px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-NeverType"><svg class="railroad" viewbox="0 0 98 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-NeverType">
<text class="comment" x="46" y="25">
NeverType</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="42" />
<text x="49" y="58">
!</text>
</g>
<path d=" M 73 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 63 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-type.never.intro"><a class="rule-link" href="#r-type.never.intro" title="type.never.intro"><span>[type<wbr>.never<wbr>.intro]</span></a>
</div>

<p>never type <code>!</code> 是一种没有值的类型，表示永远不会完成的计算结果。</p>
<div class="rule" id="r-type.never.coercion"><a class="rule-link" href="#r-type.never.coercion" title="type.never.coercion"><span>[type<wbr>.never<wbr>.coercion]</span></a>
</div>

<p><code>!</code> 类型的表达式可以 隐式类型转换 为任何其他类型。</p>
<div class="rule" id="r-type.never.constraint"><a class="rule-link" href="#r-type.never.constraint" title="type.never.constraint"><span>[type<wbr>.never<wbr>.constraint]</span></a>
</div>

<p><code>!</code> 类型目前 <strong>只能</strong> 出现在函数返回类型中，表示这是一个永远不会返回的发散函数。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo() -&gt; ! {
    panic!("This call never returns.");
}
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>unsafe extern "C" {
    pub safe fn no_return_extern_func() -&gt; !;
}
<span class="boring">}</span></code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type.tuple"><a class="rule-link" href="#r-type.tuple" title="type.tuple"><span>[type<wbr>.tuple]</span></a>
</div>

<h1 id="元组类型"><a class="header" href="#元组类型">元组类型</a></h1>
<div class="rule" id="r-type.tuple.syntax"><a class="rule-link" href="#r-type.tuple.syntax" title="type.tuple.syntax"><span>[type<wbr>.tuple<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-TupleType" onclick="show_railroad()"><a href="#railroad-TupleType">TupleType</a></span> → <br>      <span class="grammar-literal">(</span> <span class="grammar-literal">)</span> <br>    | <span class="grammar-literal">(</span> ( <span class="grammar-text"><a href="#grammar-Type">Type</a></span> <span class="grammar-literal">,</span> )<sup>+</sup> <span class="grammar-text"><a href="#grammar-Type">Type</a></span><sup>?</sup> <span class="grammar-literal">)</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 418px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TupleType"><svg class="railroad" viewbox="0 0 418 132" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TupleType">
<text class="comment" x="46" y="25">
TupleType</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 66 0 h 258 m -126 0 l -5 -5 m 0 10 l 5 -5 m 126 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="42" />
<text x="73" y="58">
(</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="97" y="42" />
<text x="111" y="58">
)</text>
</g>
<path d=" M 87 53 h 10" />
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 324 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 12 a 12 12 0 0 0 12 12 m 300 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="87" />
<text x="73" y="103">
(</text>
</g>
<g class="repeat">
<path d=" M 97 98 h 12 m 90 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -90 m 48 0 l 5 -5 m 0 10 l -5 -5 m -48 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="109" y="87" />
<text x="135" y="103">
Type</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="171" y="87" />
<text x="185" y="103">
,</text>
</g>
<path d=" M 161 98 h 10" />
</g>
</g>
<g class="optional">
<path d=" M 221 98 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 52 m -23 0 l -5 -5 m 0 10 l 5 -5 m 23 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="245" y="87" />
<text x="271" y="103">
Type</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="331" y="87" />
<text x="345" y="103">
)</text>
</g>
<path d=" M 87 98 h 10" />
<path d=" M 211 98 h 10" />
<path d=" M 321 98 h 10" />
</g>
</g>
<path d=" M 393 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 383 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-type.tuple.intro"><a class="rule-link" href="#r-type.tuple.intro" title="type.tuple.intro"><span>[type<wbr>.tuple<wbr>.intro]</span></a>
</div>

<p><em>元组类型</em> 是一系列用于存放其它类型的异构列表的 结构化类型 <sup class="footnote-reference" id="fr-1-1"><a href="#footnote-1">1</a></sup>。</p>
<p>元组类型的语法是一个括号括起来的、逗号分隔的类型列表。</p>
<div class="rule" id="r-type.tuple.restriction"><a class="rule-link" href="#r-type.tuple.restriction" title="type.tuple.restriction"><span>[type<wbr>.tuple<wbr>.restriction]</span></a>
</div>

<p>一元元组要求在其元素类型后加一个逗号，以便与 <a href="#parenthesized-types">括号括起来的类型</a> 区分开来。</p>
<div class="rule" id="r-type.tuple.field-number"><a class="rule-link" href="#r-type.tuple.field-number" title="type.tuple.field-number"><span>[type<wbr>.tuple<wbr>.field-number]</span></a>
</div>

<p>元组类型的字段数量等于类型列表的长度。此字段数量决定了元组的 <em>元数</em> 。具有 <code>n</code> 个字段的元组被称为 <em>n 元元组</em> 。例如，具有 2 个字段的元组是 2 元元组。</p>
<div class="rule" id="r-type.tuple.field-name"><a class="rule-link" href="#r-type.tuple.field-name" title="type.tuple.field-name"><span>[type<wbr>.tuple<wbr>.field-name]</span></a>
</div>

<p>元组的字段使用与其在类型列表中的位置匹配的递增数字名称命名。第一个字段是 <code>0</code> 。第二个字段是 <code>1</code> 。依此类推。每个字段的类型是元组类型列表中相同位置的类型。</p>
<div class="rule" id="r-type.tuple.unit"><a class="rule-link" href="#r-type.tuple.unit" title="type.tuple.unit"><span>[type<wbr>.tuple<wbr>.unit]</span></a>
</div>

<p>由于便利和历史原因，没有字段的元组类型 ( <code>()</code> ) 通常被称为 <em>unit</em> 或 <em>unit 类型</em> 。它的唯一值也被称为 <em>unit</em> 或 <em>unit 值</em> 。</p>
<p>一些元组类型的示例：</p>
<ul>
<li><code>()</code> (unit)</li>
<li><code>(i32,)</code> (一元元组)</li>
<li><code>(f64, f64)</code></li>
<li><code>(String, i32)</code></li>
<li><code>(i32, String)</code> (与上一个示例不同的类型)</li>
<li><code>(i32, f64, Vec&lt;String&gt;, Option&lt;bool&gt;)</code></li>
</ul>
<div class="rule" id="r-type.tuple.constructor"><a class="rule-link" href="#r-type.tuple.constructor" title="type.tuple.constructor"><span>[type<wbr>.tuple<wbr>.constructor]</span></a>
</div>

<p>此类型的值是使用 <a href="#tuple-expressions">元组表达式</a> 构造的。此外，如果没有其他有意义的值可以求值，各种表达式都将产生 unit 值。</p>
<div class="rule" id="r-type.tuple.access"><a class="rule-link" href="#r-type.tuple.access" title="type.tuple.access"><span>[type<wbr>.tuple<wbr>.access]</span></a>
</div>

<p>元组字段可以通过 <a href="#tuple-indexing-expressions">元组索引表达式</a> 或 <a href="#tuple-patterns">模式匹配</a> 来访问。</p>
<hr>
<ol class="footnote-definition">
<li id="footnote-1">
<p>如果 结构化类型 的内部类型等效，则它们始终等效。对于元组的标称版本，请参阅 <a href="#结构体类型">元组结构体</a> 。 <a href="#fr-1-1">↩</a></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type.array"><a class="rule-link" href="#r-type.array" title="type.array"><span>[type<wbr>.array]</span></a>
</div>

<h1 id="数组类型"><a class="header" href="#数组类型">数组类型</a></h1>
<div class="rule" id="r-type.array.syntax"><a class="rule-link" href="#r-type.array.syntax" title="type.array.syntax"><span>[type<wbr>.array<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ArrayType" onclick="show_railroad()"><a href="#railroad-ArrayType">ArrayType</a></span> → <span class="grammar-literal">[</span> <span class="grammar-text"><a href="#grammar-Type">Type</a></span> <span class="grammar-literal">;</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">]</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 346px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ArrayType"><svg class="railroad" viewbox="0 0 346 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ArrayType">
<text class="comment" x="46" y="25">
ArrayType</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="42" />
<text x="49" y="58">
[</text>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="73" y="42" />
<text x="99" y="58">
Type</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="135" y="42" />
<text x="149" y="58">
;</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="173" y="42" />
<text x="223" y="58">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="283" y="42" />
<text x="297" y="58">
]</text>
</g>
<path d=" M 63 53 h 10" />
<path d=" M 125 53 h 10" />
<path d=" M 163 53 h 10" />
<path d=" M 273 53 h 10" />
</g>
<path d=" M 321 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 311 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-type.array.intro"><a class="rule-link" href="#r-type.array.intro" title="type.array.intro"><span>[type<wbr>.array<wbr>.intro]</span></a>
</div>

<p>数组是 <code>T</code> 类型的 <code>N</code> 个元素的固定大小序列。数组类型写为 <code>[T; N]</code> 。</p>
<div class="rule" id="r-type.array.constraint"><a class="rule-link" href="#r-type.array.constraint" title="type.array.constraint"><span>[type<wbr>.array<wbr>.constraint]</span></a>
</div>

<p>大小是一个计算结果为 <a href="#machine-dependent-integer-types"><code>usize</code></a> 的 <a href="#常量表达式">常量表达式</a> 。</p>
<p>示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 栈分配的数组
let array: [i32; 3] = [1, 2, 3];

// 堆分配的数组，隐式类型转换 为切片
let boxed_array: Box&lt;[i32]&gt; = Box::new([1, 2, 3]);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.array.index"><a class="rule-link" href="#r-type.array.index" title="type.array.index"><span>[type<wbr>.array<wbr>.index]</span></a>
</div>

<p>数组的所有元素总是被初始化的，并且在安全方法和运算符中访问数组总是会进行边界检查。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><a href="../alloc/vec/struct.Vec.html"><code>Vec&lt;T&gt;</code></a> 标准库类型提供了一种堆分配的可调大小数组类型。</p>
</blockquote>
</div>

<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type.slice"><a class="rule-link" href="#r-type.slice" title="type.slice"><span>[type<wbr>.slice]</span></a>
</div>

<h1 id="切片类型"><a class="header" href="#切片类型">切片类型</a></h1>
<div class="rule" id="r-type.slice.syntax"><a class="rule-link" href="#r-type.slice.syntax" title="type.slice.syntax"><span>[type<wbr>.slice<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-SliceType" onclick="show_railroad()"><a href="#railroad-SliceType">SliceType</a></span> → <span class="grammar-literal">[</span> <span class="grammar-text"><a href="#grammar-Type">Type</a></span> <span class="grammar-literal">]</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 198px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-SliceType"><svg class="railroad" viewbox="0 0 198 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-SliceType">
<text class="comment" x="46" y="25">
SliceType</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="42" />
<text x="49" y="58">
[</text>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="73" y="42" />
<text x="99" y="58">
Type</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="135" y="42" />
<text x="149" y="58">
]</text>
</g>
<path d=" M 63 53 h 10" />
<path d=" M 125 53 h 10" />
</g>
<path d=" M 173 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 163 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-type.slice.intro"><a class="rule-link" href="#r-type.slice.intro" title="type.slice.intro"><span>[type<wbr>.slice<wbr>.intro]</span></a>
</div>

<p>切片是一种 <a href="#动态大小类型">动态大小类型</a> ，表示一个 T 类型元素序列的 ‘视图’ 。切片类型写作 <code>[T]</code> 。</p>
<div class="rule" id="r-type.slice.unsized"><a class="rule-link" href="#r-type.slice.unsized" title="type.slice.unsized"><span>[type<wbr>.slice<wbr>.unsized]</span></a>
</div>

<p>切片类型通常通过指针类型使用。例如：</p>
<ul>
<li><code>&amp;[T]</code>: 一个 ‘共享切片’ ，通常只被称为 ‘切片’ 。它不拥有它指向的数据；它借用它。</li>
<li><code>&amp;mut [T]</code>: 一个 ‘可变切片’ 。它可变地借用它指向的数据。</li>
<li><code>Box&lt;[T]&gt;</code>: 一个 ‘装箱切片’</li>
</ul>
<p>示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 一个堆分配的数组， 隐式类型转换 为切片
let boxed_array: Box&lt;[i32]&gt; = Box::new([1, 2, 3]);

// 一个指向数组的 (共享) 切片
let slice: &amp;[i32] = &amp;boxed_array[..];
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.slice.safe"><a class="rule-link" href="#r-type.slice.safe" title="type.slice.safe"><span>[type<wbr>.slice<wbr>.safe]</span></a>
</div>

<p>切片的所有元素总是被初始化的，并且在安全方法和运算符中访问切片总是会进行边界检查。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type.struct"><a class="rule-link" href="#r-type.struct" title="type.struct"><span>[type<wbr>.struct]</span></a>
</div>

<h1 id="结构体类型"><a class="header" href="#结构体类型">结构体类型</a></h1>
<div class="rule" id="r-type.struct.intro"><a class="rule-link" href="#r-type.struct.intro" title="type.struct.intro"><span>[type<wbr>.struct<wbr>.intro]</span></a>
</div>

<p>一个 结构体  <em>类型</em> 是其他类型的异构乘积，被称为该类型的 <em>字段</em> 。<sup class="footnote-reference" id="fr-structtype-1"><a href="#footnote-structtype">1</a></sup></p>
<div class="rule" id="r-type.struct.constructor"><a class="rule-link" href="#r-type.struct.constructor" title="type.struct.constructor"><span>[type<wbr>.struct<wbr>.constructor]</span></a>
</div>

<p>结构体 的新实例可以通过 <a href="#结构体表达式">结构体表达式</a> 构造。</p>
<div class="rule" id="r-type.struct.layout"><a class="rule-link" href="#r-type.struct.layout" title="type.struct.layout"><span>[type<wbr>.struct<wbr>.layout]</span></a>
</div>

<p>默认情况下， 结构体 的内存布局是未定义的，以便允许编译器进行诸如字段重排之类的优化，但它可以通过 <a href="#representations"><code>repr</code> 属性</a> 固定。在任何一种情况下，字段都可以在相应的 结构体  <em>表达式</em> 中以任何顺序给出；生成的 结构体 值将始终具有相同的内存布局。</p>
<div class="rule" id="r-type.struct.field-visibility"><a class="rule-link" href="#r-type.struct.field-visibility" title="type.struct.field-visibility"><span>[type<wbr>.struct<wbr>.field-visibility]</span></a>
</div>

<p>结构体 的字段可以用 <a href="#可见性和私有性">可见性修饰符</a> 限定，以允许在模块外部访问 结构体 中的数据。</p>
<div class="rule" id="r-type.struct.tuple"><a class="rule-link" href="#r-type.struct.tuple" title="type.struct.tuple"><span>[type<wbr>.struct<wbr>.tuple]</span></a>
</div>

<p>一个  <em>元组结构体</em> 类型就像 结构体 类型一样，除了字段是匿名的。</p>
<div class="rule" id="r-type.struct.unit"><a class="rule-link" href="#r-type.struct.unit" title="type.struct.unit"><span>[type<wbr>.struct<wbr>.unit]</span></a>
</div>

<p>一个  <em>类单元结构体</em> 类型就像 结构体 类型一样，除了它没有字段。通过关联的 <a href="#结构体表达式">结构体表达式</a> 构造的一个值是这种类型中唯一的值。</p>
<hr>
<ol class="footnote-definition">
<li id="footnote-structtype">
<p>结构体 类型类似于 C 中的 结构体 类型、ML 系列的 <em>记录</em> 类型或 Lisp 系列的 <em>结构体</em> 类型。 <a href="#fr-structtype-1">↩</a></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type.enum"><a class="rule-link" href="#r-type.enum" title="type.enum"><span>[type<wbr>.enum]</span></a>
</div>

<h1 id="枚举类型"><a class="header" href="#枚举类型">枚举类型</a></h1>
<div class="rule" id="r-type.enum.intro"><a class="rule-link" href="#r-type.enum.intro" title="type.enum.intro"><span>[type<wbr>.enum<wbr>.intro]</span></a>
</div>

<p>一个 <em>枚举类型</em> 是一种标称的、异构的离散联合类型，由 <a href="#枚举"><code>enum</code> 项</a> 的名称表示。<sup class="footnote-reference" id="fr-enumtype-1"><a href="#footnote-enumtype">1</a></sup></p>
<div class="rule" id="r-type.enum.declaration"><a class="rule-link" href="#r-type.enum.declaration" title="type.enum.declaration"><span>[type<wbr>.enum<wbr>.declaration]</span></a>
</div>

<p>一个 <a href="#枚举"><code>enum</code> 项</a> 声明了该类型以及若干 <em>变体</em> ，每个变体都有独立的名称，并且具有 结构体 、元组结构体或类单元结构体的 语法格式 。</p>
<div class="rule" id="r-type.enum.constructor"><a class="rule-link" href="#r-type.enum.constructor" title="type.enum.constructor"><span>[type<wbr>.enum<wbr>.constructor]</span></a>
</div>

<p><code>enum</code> 的新实例可以通过 <a href="#结构体表达式">结构体表达式</a> 构造。</p>
<div class="rule" id="r-type.enum.value"><a class="rule-link" href="#r-type.enum.value" title="type.enum.value"><span>[type<wbr>.enum<wbr>.value]</span></a>
</div>

<p>任何 <code>enum</code> 值消耗的内存与其对应的 <code>enum</code> 类型中最大的 变体 一样多，外加存储判别式所需的大小。</p>
<div class="rule" id="r-type.enum.name"><a class="rule-link" href="#r-type.enum.name" title="type.enum.name"><span>[type<wbr>.enum<wbr>.name]</span></a>
</div>

<p>枚举类型不能作为类型在 <em>结构上</em> 被表示，而必须通过对 <a href="#枚举"><code>enum</code> 项</a> 的命名引用来表示。</p>
<hr>
<ol class="footnote-definition">
<li id="footnote-enumtype">
<p><code>enum</code> 类型类似于 Haskell 中的 <code>data</code> 构造函数声明，或 Limbo 中的 <em>pick ADT</em> 。 <a href="#fr-enumtype-1">↩</a></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type.union"><a class="rule-link" href="#r-type.union" title="type.union"><span>[type<wbr>.union]</span></a>
</div>

<h1 id="联合体类型"><a class="header" href="#联合体类型">联合体类型</a></h1>
<div class="rule" id="r-type.union.intro"><a class="rule-link" href="#r-type.union.intro" title="type.union.intro"><span>[type<wbr>.union<wbr>.intro]</span></a>
</div>

<p>一个 <em>联合体 类型</em> 是一种标称的、异构的类 C 联合体，由 <a href="#联合体"><code>union</code> 项</a> 的名称表示。</p>
<div class="rule" id="r-type.union.access"><a class="rule-link" href="#r-type.union.access" title="type.union.access"><span>[type<wbr>.union<wbr>.access]</span></a>
</div>

<p>联合体 没有 “active field” 的概念。相反，每次对 联合体 的访问都会将 联合体 内容的一部分转录为被访问字段的类型。</p>
<div class="rule" id="r-type.union.safety"><a class="rule-link" href="#r-type.union.safety" title="type.union.safety"><span>[type<wbr>.union<wbr>.safety]</span></a>
</div>

<p>由于转录可能导致意外或未定义的行为，因此从 联合体 字段中读取数据需要 <code>unsafe</code> 。</p>
<div class="rule" id="r-type.union.constraint"><a class="rule-link" href="#r-type.union.constraint" title="type.union.constraint"><span>[type<wbr>.union<wbr>.constraint]</span></a>
</div>

<p>联合体 字段类型也被限制为类型的一个子集，以确保它们永远不需要丢弃。有关更多详细信息，请参阅 <a href="#联合体">项</a> 文档。</p>
<div class="rule" id="r-type.union.layout"><a class="rule-link" href="#r-type.union.layout" title="type.union.layout"><span>[type<wbr>.union<wbr>.layout]</span></a>
</div>

<p>默认情况下， <code>union</code> 的内存布局是未定义的（特别是，字段 <em>不</em> 一定要在偏移量 0 处），但 <code>#[repr(...)]</code> 属性可以用来固定布局。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type.fn-item"><a class="rule-link" href="#r-type.fn-item" title="type.fn-item"><span>[type<wbr>.fn-item]</span></a>
</div>

<h1 id="函数项类型"><a class="header" href="#函数项类型">函数项类型</a></h1>
<div class="rule" id="r-type.fn-item.intro"><a class="rule-link" href="#r-type.fn-item.intro" title="type.fn-item.intro"><span>[type<wbr>.fn-item<wbr>.intro]</span></a>
</div>

<p>当引用时，函数 项 ，或者类元组 结构体 或枚举 变体 的构造函数，会产生其  <em>函数项类型</em>  的一个零大小值。</p>
<div class="rule" id="r-type.fn-item.unique"><a class="rule-link" href="#r-type.fn-item.unique" title="type.fn-item.unique"><span>[type<wbr>.fn-item<wbr>.unique]</span></a>
</div>

<p>该类型明确标识了函数 —— 它的名称、它的类型参数以及它的早绑定生命周期参数（但不包括它的晚绑定生命周期参数，后者仅在调用函数时分配） —— 因此该值不需要包含实际的函数指针，并且在调用函数时不需要间接寻址。</p>
<div class="rule" id="r-type.fn-item.name"><a class="rule-link" href="#r-type.fn-item.name" title="type.fn-item.name"><span>[type<wbr>.fn-item<wbr>.name]</span></a>
</div>

<p>没有直接引用函数项类型的 语法格式 ，但编译器在错误消息中会将该类型显示为类似于 <code>fn(u32) -&gt; i32 {fn_name}</code> 的内容。</p>
<p>由于函数项类型明确标识了函数，不同函数的 项 类型 —— 不同的 项 ，或具有不同 泛型 的相同 项  —— 是不同的，将它们混合会产生类型错误：</p>
<pre class="playground"><code class="language-rust compile_fail E0308 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo&lt;T&gt;() { }
let x = &amp;mut foo::&lt;i32&gt;;
*x = foo::&lt;u32&gt;; //~ 错误：类型不匹配
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.fn-item.coercion"><a class="rule-link" href="#r-type.fn-item.coercion" title="type.fn-item.coercion"><span>[type<wbr>.fn-item<wbr>.coercion]</span></a>
</div>

<p>然而，存在从函数项到具有相同签名的 <a href="#函数指针类型">函数指针</a> 的 <a href="#隐式类型转换">隐式类型转换</a>，这不仅在直接预期函数指针的情况下使用函数项时触发，而且在具有相同签名的不同函数项类型出现在同一个 <code>if</code> 或 <code>match</code> 的不同分支中时也会触发：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">let want_i32 = false;
</span><span class="boring">fn foo&lt;T&gt;() { }
</span>
// 这里 `foo_ptr_1` 具有函数指针类型 `fn()`
let foo_ptr_1: fn() = foo::&lt;i32&gt;;

// ... `foo_ptr_2` 也是如此 —— 这通过了类型检查。
let foo_ptr_2 = if want_i32 {
    foo::&lt;i32&gt;
} else {
    foo::&lt;u32&gt;
};
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.fn-item.traits"><a class="rule-link" href="#r-type.fn-item.traits" title="type.fn-item.traits"><span>[type<wbr>.fn-item<wbr>.traits]</span></a>
</div>

<p>所有函数项都实现 <a href="#copy"><code>Copy</code></a>、<a href="#clone"><code>Clone</code></a>、<a href="#send"><code>Send</code></a> 和 <a href="#sync"><code>Sync</code></a>。</p>
<p><a href="../core/ops/function/trait.Fn.html"><code>Fn</code></a>、<a href="../core/ops/function/trait.FnMut.html"><code>FnMut</code></a> 和 <a href="../core/ops/function/trait.FnOnce.html"><code>FnOnce</code></a> 都会被实现，除非函数具有以下任何一种情况：</p>
<ul>
<li><a href="#r-unsafe.fn"><code>unsafe</code></a> 限定符</li>
<li><a href="#r-attributes.codegen.target_feature"><code>target_feature</code> 属性</a></li>
<li>除 <code>"Rust"</code> 以外的 <a href="#r-items.fn.extern">ABI</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type.closure"><a class="rule-link" href="#r-type.closure" title="type.closure"><span>[type<wbr>.closure]</span></a>
</div>

<h1 id="闭包类型"><a class="header" href="#闭包类型">闭包类型</a></h1>
<div class="rule" id="r-type.closure.intro"><a class="rule-link" href="#r-type.closure.intro" title="type.closure.intro"><span>[type<wbr>.closure<wbr>.intro]</span></a>
</div>

<p><a href="#闭包表达式">闭包表达式</a> 产生一个具有唯一的、匿名的且无法写出的类型的闭包值。
一个闭包类型大约等同于一个包含捕获值的结构体。
例如，以下闭包：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug)]
struct Point { x: i32, y: i32 }
struct Rectangle { left_top: Point, right_bottom: Point }

fn f&lt;F : FnOnce() -&gt; String&gt; (g: F) {
    println!("{}", g());
}

let mut rect = Rectangle {
    left_top: Point { x: 1, y: 1 },
    right_bottom: Point { x: 0, y: 0 }
};

let c = || {
    rect.left_top.x += 1;
    rect.right_bottom.x += 1;
    format!("{:?}", rect.left_top)
};
f(c); // 打印 "Point { x: 2, y: 1 }"。
<span class="boring">}</span></code></pre>
<p>生成一个大致如下的闭包类型：</p>
<!-- ignore: simplified -->
<pre><code class="language-rust ignore">// 注意：这并非准确的转换方式，仅用于说明。

struct Closure&lt;'a&gt; {
    left_top : &amp;'a mut Point,
    right_bottom_x : &amp;'a mut i32,
}

impl&lt;'a&gt; FnOnce&lt;()&gt; for Closure&lt;'a&gt; {
    type Output = String;
    extern "rust-call" fn call_once(self, args: ()) -&gt; String {
        self.left_top.x += 1;
        *self.right_bottom_x += 1;
        format!("{:?}", self.left_top)
    }
}</code></pre>
<p>使得对 <code>f</code> 的调用就像这样：</p>
<!-- ignore: continuation of above -->
<pre><code class="language-rust ignore">f(Closure{ left_top: &amp;mut rect.left_top, right_bottom_x: &amp;mut rect.right_bottom.x });</code></pre>
<div class="rule" id="r-type.closure.capture"><a class="rule-link" href="#r-type.closure.capture" title="type.closure.capture"><span>[type<wbr>.closure<wbr>.capture]</span></a>
</div>

<h2 id="捕获模式-1"><a class="header" href="#捕获模式-1">捕获模式</a></h2>
<div class="rule" id="r-type.closure.capture.intro"><a class="rule-link" href="#r-type.closure.capture.intro" title="type.closure.capture.intro"><span>[type<wbr>.closure<wbr>.capture<wbr>.intro]</span></a>
</div>

<p>一个 <em>捕获模式</em> 决定了环境中的 <a href="#位置表达式和值表达式">位置表达式</a> 是如何被借用或移动到闭包中的。
捕获模式有：</p>
<ol>
<li>不可变借用 (<code>ImmBorrow</code>) — 位置表达式作为 <a href="#references--and-mut">共享引用</a> 被捕获。</li>
<li>唯一不可变借用 (<code>UniqueImmBorrow</code>) — 类似于不可变借用，但必须是唯一的，如 <a href="#unique-immutable-borrows-in-captures">下文</a> 所述。</li>
<li>可变借用 (<code>MutBorrow</code>) — 位置表达式作为 <a href="#mutable-references-mut">可变引用</a> 被捕获。</li>
<li>移动 (<code>ByValue</code>) — 位置表达式通过 <a href="#moved-and-copied-types">移动值</a> 到闭包中而被捕获。</li>
</ol>
<div class="rule" id="r-type.closure.capture.precedence"><a class="rule-link" href="#r-type.closure.capture.precedence" title="type.closure.capture.precedence"><span>[type<wbr>.closure<wbr>.capture<wbr>.precedence]</span></a>
</div>

<p>来自环境的位置表达式按与捕获值在闭包体内的使用方式相兼容的第一种模式进行捕获。
该模式不受闭包周围代码的影响，例如相关变量或字段的生命周期，或者闭包本身的生命周期。</p>
<div class="rule" id="r-type.closure.capture.copy"><a class="rule-link" href="#r-type.closure.capture.copy" title="type.closure.capture.copy"><span>[type<wbr>.closure<wbr>.capture<wbr>.copy]</span></a>
</div>

<h3 id="copy值"><a class="header" href="#copy值"><code>Copy</code>值</a></h3>
<p>实现了 <a href="#copy"><code>Copy</code></a> 的值如果被移动到闭包中，将以 <code>ImmBorrow</code> 模式捕获。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = [0; 1024];
let c = || {
    let y = x; // x 通过 ImmBorrow 捕获
};
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.async.input"><a class="rule-link" href="#r-type.closure.async.input" title="type.closure.async.input"><span>[type<wbr>.closure<wbr>.async<wbr>.input]</span></a>
</div>

<h3 id="异步输入捕获"><a class="header" href="#异步输入捕获">异步输入捕获</a></h3>
<p>异步闭包总是捕获所有输入参数，无论它们是否在闭包体中使用。</p>
<h2 id="捕获精度"><a class="header" href="#捕获精度">捕获精度</a></h2>
<div class="rule" id="r-type.closure.capture.precision.capture-path"><a class="rule-link" href="#r-type.closure.capture.precision.capture-path" title="type.closure.capture.precision.capture-path"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.capture-path]</span></a>
</div>

<p>一个 <em>捕获路径</em> 是一个序列，起始于环境中的变量，后跟该变量的零个或多个位置投影。</p>
<div class="rule" id="r-type.closure.capture.precision.place-projection"><a class="rule-link" href="#r-type.closure.capture.precision.place-projection" title="type.closure.capture.precision.place-projection"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.place-projection]</span></a>
</div>

<p>一个 <em>位置投影</em> 是对变量应用的 <a href="#字段访问表达式">字段访问</a>、<a href="#tuple-indexing-expressions">元组索引</a>、<a href="#the-dereference-operator">解引用</a>（以及自动解引用）、<a href="#array-and-slice-indexing-expressions">数组或切片索引</a> 表达式或 <a href="#r-patterns.destructure">模式解构</a>。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>在 <code>rustc</code> 中，模式解构会被脱糖为一系列解引用以及字段或元素访问。</p>
</blockquote>
</div>

<div class="rule" id="r-type.closure.capture.precision.intro"><a class="rule-link" href="#r-type.closure.capture.precision.intro" title="type.closure.capture.precision.intro"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.intro]</span></a>
</div>

<p>闭包借用或移动捕获路径，该路径可能会根据下述规则被截断。</p>
<p>例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct SomeStruct {
    f1: (i32, i32),
}
let s = SomeStruct { f1: (1, 2) };

let c = || {
    let x = s.f1.1; // s.f1.1 通过 ImmBorrow 捕获
};
c();
<span class="boring">}</span></code></pre>
<p>这里的捕获路径是局部变量 <code>s</code> ，后跟一个字段访问 <code>.f1</code> ，然后是一个元组索引 <code>.1</code> 。
这个闭包捕获了 <code>s.f1.1</code> 的不可变借用。</p>
<div class="rule" id="r-type.closure.capture.precision.shared-prefix"><a class="rule-link" href="#r-type.closure.capture.precision.shared-prefix" title="type.closure.capture.precision.shared-prefix"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.shared-prefix]</span></a>
</div>

<h3 id="共享前缀"><a class="header" href="#共享前缀">共享前缀</a></h3>
<p>在捕获路径及其祖先路径都被闭包捕获的情况下，祖先路径以两者中最高的捕获模式捕获， <code>CaptureMode = max(AncestorCaptureMode, DescendantCaptureMode)</code> ，使用严格弱序：</p>
<p><code>ImmBorrow &lt; UniqueImmBorrow &lt; MutBorrow &lt; ByValue</code></p>
<p>注意这可能需要递归应用。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 在这个例子中，有三个具有共享祖先的不同捕获路径：
<span class="boring">fn move_value&lt;T&gt;(_: T){}
</span>let s = String::from("S");
let t = (s, String::from("T"));
let mut u = (t, String::from("U"));

let c = || {
    println!("{:?}", u); // u 通过 ImmBorrow 捕获
    u.1.truncate(0); // u.0 通过 MutBorrow 捕获
    move_value(u.0.0); // u.0.0 通过 ByValue 捕获
};
c();
<span class="boring">}</span></code></pre>
<p>总的来说，这个闭包将通过 <code>ByValue</code> 捕获 <code>u</code> 。</p>
<div class="rule" id="r-type.closure.capture.precision.dereference-shared"><a class="rule-link" href="#r-type.closure.capture.precision.dereference-shared" title="type.closure.capture.precision.dereference-shared"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.dereference-shared]</span></a>
</div>

<h3 id="最右侧共享引用解引用截断"><a class="header" href="#最右侧共享引用解引用截断">最右侧共享引用解引用截断</a></h3>
<p>如果解引用应用于共享引用，捕获路径将在捕获路径中最右侧的解引用处截断。</p>
<p>允许这种截断是因为通过共享引用读取的字段将始终通过共享引用或副本读取。
当额外的精度在借用检查的角度下没有任何益处时，这有助于减小捕获的大小。</p>
<p>之所以是 <em>最右侧</em> 解引用，是为了帮助避免产生比必要生命周期更短的生命周期。
考虑以下示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Int(i32);
struct B&lt;'a&gt;(&amp;'a i32);

struct MyStruct&lt;'a&gt; {
   a: &amp;'static Int,
   b: B&lt;'a&gt;,
}

fn foo&lt;'a, 'b&gt;(m: &amp;'a MyStruct&lt;'b&gt;) -&gt; impl FnMut() + 'static {
    let c = || drop(&amp;m.a.0);
    c
}
<span class="boring">}</span></code></pre>
<p>如果要捕获 <code>m</code> ，那么闭包将不再能比 <code>'static</code> 存活得更久，因为 <code>m</code> 被限制在 <code>'a</code> 。相反，它通过 <code>ImmBorrow</code> 捕获 <code>(*(*m).a)</code> 。</p>
<div class="rule" id="r-type.closure.capture.precision.wildcard"><a class="rule-link" href="#r-type.closure.capture.precision.wildcard" title="type.closure.capture.precision.wildcard"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.wildcard]</span></a>
</div>

<h3 id="通配符模式绑定"><a class="header" href="#通配符模式绑定">通配符模式绑定</a></h3>
<div class="rule" id="r-type.closure.capture.precision.wildcard.reads"><a class="rule-link" href="#r-type.closure.capture.precision.wildcard.reads" title="type.closure.capture.precision.wildcard.reads"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.wildcard<wbr>.reads]</span></a>
</div>

<p>闭包仅捕获需要读取的数据。使用 <a href="#wildcard-pattern">通配符模式</a> 绑定一个值不会读取该值，因此该位置不会被捕获。</p>
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S; // 一个非 `Copy` 类型。
let x = S;
let c = || {
    let _ = x;  // 不捕获 `x`。
};
let c = || match x {
    _ =&gt; (), // 不捕获 `x`。
};
x; // OK： `x` 可以在这里被移动。
c();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.capture.precision.wildcard.destructuring"><a class="rule-link" href="#r-type.closure.capture.precision.wildcard.destructuring" title="type.closure.capture.precision.wildcard.destructuring"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.wildcard<wbr>.destructuring]</span></a>
</div>

<p>解构元组、结构体和单 变体 枚举本身不会导致读取或位置被捕获。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>来自其他 crate 的带有 <a href="#r-attributes.type-system.non_exhaustive"><code>#[non_exhaustive]</code></a> 标记的枚举总是被视为具有多个 变体 。参见 <em><a href="#r-type.closure.capture.precision.discriminants.non_exhaustive">type.closure.capture.precision.discriminants.non_exhaustive</a></em>。</p>
</blockquote>
</div>

<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S; // 一个非 `Copy` 类型。

// 解构元组不会导致读取或捕获。
let x = (S,);
let c = || {
    let (..) = x; // 不捕获 `x`。
};
x; // OK： `x` 可以在这里被移动。
c();

// 解构类单元结构体不会导致读取或捕获。
let x = S;
let c = || {
    let S = x; // 不捕获 `x`。
};
x; // OK： `x` 可以在这里被移动。
c();

// 解构结构体不会导致读取或捕获。
struct W&lt;T&gt;(T);
let x = W(S);
let c = || {
    let W(..) = x; // 不捕获 `x`。
};
x; // OK： `x` 可以在这里被移动。
c();

// 解构单变体枚举不会导致读取或捕获。
enum E&lt;T&gt; { V(T) }
let x = E::V(S);
let c = || {
    let E::V(..) = x; // 不捕获 `x`。
};
x; // OK： `x` 可以在这里被移动。
c();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.capture.precision.wildcard.fields"><a class="rule-link" href="#r-type.closure.capture.precision.wildcard.fields" title="type.closure.capture.precision.wildcard.fields"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.wildcard<wbr>.fields]</span></a>
</div>

<p>与 <a href="#grammar-RestPattern">RestPattern</a> (<code>..</code>) 或 <a href="#grammar-StructPatternEtCetera">StructPatternEtCetera</a> (也是 <code>..</code>) 匹配的字段不会被读取，且这些字段不会被捕获。</p>
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S; // 一个非 `Copy` 类型。
let x = (S, S);
let c = || {
    let (x0, ..) = x;  // 通过 `ByValue` 捕获 `x.0`。
};
// 只有第一个元组字段被闭包捕获。
x.1; // OK： `x.1` 可以在这里被移动。
c();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.capture.precision.wildcard.array-slice"><a class="rule-link" href="#r-type.closure.capture.precision.wildcard.array-slice" title="type.closure.capture.precision.wildcard.array-slice"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.wildcard<wbr>.array-slice]</span></a>
</div>

<p>不支持对数组和切片的部分捕获；即使使用通配符模式匹配、索引或子切片，整个切片或数组也总是会被捕获。</p>
<pre class="playground"><code class="language-rust compile_fail E0382 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S; // 一个非 `Copy` 类型。
let mut x = [S, S];
let c = || {
    let [x0, _] = x; // 通过 `ByValue` 捕获全部 `x`。
};
let _ = &amp;mut x[1]; // 错误：借用了已移动的值。
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.capture.precision.wildcard.initialized"><a class="rule-link" href="#r-type.closure.capture.precision.wildcard.initialized" title="type.closure.capture.precision.wildcard.initialized"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.wildcard<wbr>.initialized]</span></a>
</div>

<p>与通配符匹配的值仍必须已初始化。</p>
<pre class="playground"><code class="language-rust compile_fail E0381 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x: u8;
let c = || {
    let _ = x; // 错误：绑定 `x` 未初始化。
};
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.capture.precision.discriminants"><a class="rule-link" href="#r-type.closure.capture.precision.discriminants" title="type.closure.capture.precision.discriminants"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.discriminants]</span></a>
</div>

<h3 id="为读取判别式而捕获"><a class="header" href="#为读取判别式而捕获">为读取判别式而捕获</a></h3>
<div class="rule" id="r-type.closure.capture.precision.discriminants.reads"><a class="rule-link" href="#r-type.closure.capture.precision.discriminants.reads" title="type.closure.capture.precision.discriminants.reads"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.discriminants<wbr>.reads]</span></a>
</div>

<p>如果模式匹配读取了判别式，则包含该判别式的位置将通过 <code>ImmBorrow</code> 被捕获。</p>
<div class="rule" id="r-type.closure.capture.precision.discriminants.multiple-variant"><a class="rule-link" href="#r-type.closure.capture.precision.discriminants.multiple-variant" title="type.closure.capture.precision.discriminants.multiple-variant"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.discriminants<wbr>.multiple-variant]</span></a>
</div>

<p>与具有多于一个 变体 的枚举的 变体 进行匹配会读取判别式，从而通过 <code>ImmBorrow</code> 捕获该位置。</p>
<pre class="playground"><code class="language-rust compile_fail E0502 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S; // 一个非 `Copy` 类型。
let mut x = (Some(S), S);
let c = || match x {
    (None, _) =&gt; (),
//   ^^^^
// 此模式需要读取判别式，这导致 `x.0` 被 `ImmBorrow` 捕获。
    _ =&gt; (),
};
let _ = &amp;mut x.0; // 错误：不能将 `x.0` 借用为可变。
//           ^^^
// 闭包仍然存活，所以 `x.0` 在这里仍然被不可变借用。
c();
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct S; // 一个非 `Copy` 类型。
</span><span class="boring">let x = (Some(S), S);
</span>let c = || match x { // 通过 `ImmBorrow` 捕获 `x.0`。
    (None, _) =&gt; (),
    _ =&gt; (),
};
// 尽管 `x.0` 因判别式读取而被捕获，但 `x.1` 未被捕获。
x.1; // OK： `x.1` 可以在这里被移动。
c();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.capture.precision.discriminants.single-variant"><a class="rule-link" href="#r-type.closure.capture.precision.discriminants.single-variant" title="type.closure.capture.precision.discriminants.single-variant"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.discriminants<wbr>.single-variant]</span></a>
</div>

<p>与单 变体 枚举的唯一 变体 进行匹配不会读取判别式，也不会捕获该位置。</p>
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum E&lt;T&gt; { V(T) } // 一个单变体枚举。
let x = E::V(());
let c = || {
    let E::V(_) = x; // 不捕获 `x`。
};
x; // OK： `x` 可以在这里被移动。
c();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.capture.precision.discriminants.non_exhaustive"><a class="rule-link" href="#r-type.closure.capture.precision.discriminants.non_exhaustive" title="type.closure.capture.precision.discriminants.non_exhaustive"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.discriminants<wbr>.non_exhaustive]</span></a>
</div>

<p>如果 <a href="#r-attributes.type-system.non_exhaustive"><code>#[non_exhaustive]</code></a> 应用于在外部 crate 中定义的枚举，则出于决定是否发生读取的目的，该枚举被视为具有多个 变体 ，即使它实际上只有一个 变体 。</p>
<div class="rule" id="r-type.closure.capture.precision.discriminants.uninhabited-variants"><a class="rule-link" href="#r-type.closure.capture.precision.discriminants.uninhabited-variants" title="type.closure.capture.precision.discriminants.uninhabited-variants"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.discriminants<wbr>.uninhabited-variants]</span></a>
</div>

<p>即使除被匹配的 变体 外的所有 变体 都是未入驻的，使得模式 <a href="#r-patterns.refutable">不可驳回</a>，如果本来会读取判别式，则判别式仍会被读取。</p>
<pre class="playground"><code class="language-rust compile_fail E0502 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>enum Empty {}
let mut x = Ok::&lt;_, Empty&gt;(42);
let c = || {
    let Ok(_) = x; // 通过 `ImmBorrow` 捕获 `x`。
};
let _ = &amp;mut x; // 错误：不能将 `x` 借用为可变。
c();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.capture.precision.range-patterns"><a class="rule-link" href="#r-type.closure.capture.precision.range-patterns" title="type.closure.capture.precision.range-patterns"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.range-patterns]</span></a>
</div>

<h3 id="捕获与范围模式"><a class="header" href="#捕获与范围模式">捕获与范围模式</a></h3>
<div class="rule" id="r-type.closure.capture.precision.range-patterns.reads"><a class="rule-link" href="#r-type.closure.capture.precision.range-patterns.reads" title="type.closure.capture.precision.range-patterns.reads"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.range-patterns<wbr>.reads]</span></a>
</div>

<p>与 <a href="#r-patterns.range">范围模式</a> 进行匹配会读取被匹配的位置，即使范围包含了该类型的所有可能值，并会通过 <code>ImmBorrow</code> 捕获该位置。</p>
<pre class="playground"><code class="language-rust compile_fail E0502 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut x = 0u8;
let c = || {
    let 0..=u8::MAX = x; // 通过 `ImmBorrow` 捕获 `x`。
};
let _ = &amp;mut x; // 错误：不能将 `x` 借用为可变。
c();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.capture.precision.slice-patterns"><a class="rule-link" href="#r-type.closure.capture.precision.slice-patterns" title="type.closure.capture.precision.slice-patterns"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.slice-patterns]</span></a>
</div>

<h3 id="捕获与切片模式"><a class="header" href="#捕获与切片模式">捕获与切片模式</a></h3>
<div class="rule" id="r-type.closure.capture.precision.slice-patterns.slices"><a class="rule-link" href="#r-type.closure.capture.precision.slice-patterns.slices" title="type.closure.capture.precision.slice-patterns.slices"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.slice-patterns<wbr>.slices]</span></a>
</div>

<p>将切片与除仅包含单个 <a href="#r-patterns.rest">剩余模式</a>（即 <code>[..]</code> ）以外的 <a href="#r-patterns.slice">切片模式</a> 进行匹配，将被视为对切片长度的读取，并通过 <code>ImmBorrow</code> 捕获切片。</p>
<pre class="playground"><code class="language-rust compile_fail E0502 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x: &amp;mut [u8] = &amp;mut [];
let c = || match x { // 通过 `ImmBorrow` 捕获 `*x`。
    &amp;mut [] =&gt; (),
//       ^^
// 这匹配一个长度恰好为零的切片。为了知道被检查对象是否匹配，
// 必须读取长度，从而导致切片被捕获。
    _ =&gt; (),
};
let _ = &amp;mut *x; // 错误：不能将 `*x` 借用为可变。
c();
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x: &amp;mut [u8] = &amp;mut [];
let c = || match x { // 不捕获 `*x`。
    [..] =&gt; (),
//   ^^ 剩余模式。
};
let _ = &amp;mut *x; // OK： `*x` 可以在这里被借用。
c();
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>也许令人惊讶的是，尽管长度包含在切片的（宽） <em>指针</em> 中，但被视为读取并被捕获的是 <em>被指物</em> （切片）的位置。</p>
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn f&lt;'l: 's, 's&gt;(x: &amp;'s mut &amp;'l [u8]) -&gt; impl Fn() + 'l {
    // 闭包存活时间超过 `'l`，因为它捕获了 `**x`。如果
    // 它捕获的是 `*x`，它将存活得不够长，
    // 无法满足 `impl Fn() + 'l` 界限。
    || match *x { // 通过 `ImmBorrow` 捕获 `**x`。
        &amp;[] =&gt; (),
        _ =&gt; (),
    }
}
<span class="boring">}</span></code></pre>
<p>这样，该行为与在被检查对象中解引用到切片是一致的。</p>
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn f&lt;'l: 's, 's&gt;(x: &amp;'s mut &amp;'l [u8]) -&gt; impl Fn() + 'l {
    || match **x { // 通过 `ImmBorrow` 捕获 `**x`。
        [] =&gt; (),
        _ =&gt; (),
    }
}
<span class="boring">}</span></code></pre>
<p>有关详细信息，请参见 <a href="https://github.com/rust-lang/rust/pull/138961">Rust PR #138961</a>。</p>
</blockquote>
</div>

<div class="rule" id="r-type.closure.capture.precision.slice-patterns.arrays"><a class="rule-link" href="#r-type.closure.capture.precision.slice-patterns.arrays" title="type.closure.capture.precision.slice-patterns.arrays"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.slice-patterns<wbr>.arrays]</span></a>
</div>

<p>由于数组的长度由其类型固定，因此将数组与切片模式匹配本身不会捕获该位置。</p>
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x: [u8; 1] = [0];
let c = || match x { // 不捕获 `x`。
    [_] =&gt; (), // 长度是固定的。
};
x; // OK： `x` 可以在这里被移动。
c();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.capture.precision.move-dereference"><a class="rule-link" href="#r-type.closure.capture.precision.move-dereference" title="type.closure.capture.precision.move-dereference"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.move-dereference]</span></a>
</div>

<h3 id="在移动语境中捕获引用"><a class="header" href="#在移动语境中捕获引用">在移动语境中捕获引用</a></h3>
<p>由于不允许从引用中移出字段， <code>move</code> 闭包将仅捕获捕获路径的前缀，该前缀一直延伸到但不包括引用的第一次解引用。
引用本身将被移动到闭包中。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct T(String, String);

let mut t = T(String::from("foo"), String::from("bar"));
let t_mut_ref = &amp;mut t;
let mut c = move || {
    t_mut_ref.0.push_str("123"); // 通过 ByValue 捕获 `t_mut_ref`
};
c();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.capture.precision.raw-pointer-dereference"><a class="rule-link" href="#r-type.closure.capture.precision.raw-pointer-dereference" title="type.closure.capture.precision.raw-pointer-dereference"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.raw-pointer-dereference]</span></a>
</div>

<h3 id="裸指针解引用"><a class="header" href="#裸指针解引用">裸指针解引用</a></h3>
<p>由于解引用裸指针是 <code>unsafe</code> 的，闭包将仅捕获捕获路径的前缀，该前缀一直延伸到但不包括裸指针的第一次解引用。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct T(String, String);

let t = T(String::from("foo"), String::from("bar"));
let t_ptr = &amp;t as *const T;

let c = || unsafe {
    println!("{}", (*t_ptr).0); // 通过 ImmBorrow 捕获 `t_ptr`
};
c();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.capture.precision.union"><a class="rule-link" href="#r-type.closure.capture.precision.union" title="type.closure.capture.precision.union"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.union]</span></a>
</div>

<h3 id="联合体-字段"><a class="header" href="#联合体-字段">联合体 字段</a></h3>
<p>由于访问 联合体 字段是 <code>unsafe</code> 的，闭包将仅捕获捕获路径的前缀，该前缀一直延伸到 联合体 本身。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>union U {
    a: (i32, i32),
    b: bool,
}
let u = U { a: (123, 456) };

let c = || {
    let x = unsafe { u.a.0 }; // 通过 ByValue 捕获 `u`
};
c();

// 这也包括写入字段。
let mut u = U { a: (123, 456) };

let mut c = || {
    u.b = true; // 通过 MutBorrow 捕获 `u`
};
c();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.capture.precision.unaligned"><a class="rule-link" href="#r-type.closure.capture.precision.unaligned" title="type.closure.capture.precision.unaligned"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.unaligned]</span></a>
</div>

<h3 id="对未对齐struct的引用"><a class="header" href="#对未对齐struct的引用">对未对齐<code>struct</code>的引用</a></h3>
<p>由于创建对结构体中未对齐字段的引用是 <a href="#被视为未定义的行为">未定义行为</a> ，
闭包将仅捕获捕获路径的前缀，该前缀一直延伸到但不包括对使用 <a href="#the-alignment-modifiers"> <code>packed</code> 表示</a> 的结构体的第一次字段访问。
这包括所有字段，甚至是那些已对齐的字段，以防止将来结构体中的任何字段发生更改时产生兼容性问题。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[repr(packed)]
struct T(i32, i32);

let t = T(2, 5);
let c = || {
    let a = t.0; // 通过 ImmBorrow 捕获 `t`
};
// 从 `t` 中复制是可以的。
let (a, b) = (t.0, t.1);
c();
<span class="boring">}</span></code></pre>
<p>类似地，获取未对齐字段的地址也会捕获整个结构体：</p>
<pre class="playground"><code class="language-rust compile_fail E0505 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[repr(packed)]
struct T(String, String);

let mut t = T(String::new(), String::new());
let c = || {
    let a = std::ptr::addr_of!(t.1); // 通过 ImmBorrow 捕获 `t`
};
let a = t.0; // 错误：无法移出 `t.0` ，因为它已被借用
c();
<span class="boring">}</span></code></pre>
<p>但如果它不是 packed 的，上述代码就可以工作，因为它能精确地捕获字段：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct T(String, String);

let mut t = T(String::new(), String::new());
let c = || {
    let a = std::ptr::addr_of!(t.1); // 通过 ImmBorrow 捕获 `t.1`
};
// 这里的移动是允许的。
let a = t.0;
c();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.capture.precision.box-deref"><a class="rule-link" href="#r-type.closure.capture.precision.box-deref" title="type.closure.capture.precision.box-deref"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.box-deref]</span></a>
</div>

<h3 id="box与其他deref实现"><a class="header" href="#box与其他deref实现"><code>Box</code>与其他<code>Deref</code>实现</a></h3>
<p><a href="#boxt"><code>Box</code></a> 的 <a href="#deref-and-derefmut"><code>Deref</code></a> 特型 实现与其他 <code>Deref</code> 实现受到的待遇不同，因为它被视为一个特殊的实体。</p>
<p>例如，让我们看看涉及 <code>Rc</code> 和 <code>Box</code> 的例子。 <code>*rc</code> 被脱糖为对 <code>Rc</code> 上定义的特型方法 <code>deref</code> 的调用，但由于 <code>*box</code> 受到不同待遇，因此可以对 <code>Box</code> 的内容进行精确捕获。</p>
<div class="rule" id="r-type.closure.capture.precision.box-non-move.not-moved"><a class="rule-link" href="#r-type.closure.capture.precision.box-non-move.not-moved" title="type.closure.capture.precision.box-non-move.not-moved"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.box-non-move<wbr>.not-moved]</span></a>
</div>

<h4 id="具有非move闭包的box"><a class="header" href="#具有非move闭包的box">具有非<code>move</code>闭包的<code>Box</code></a></h4>
<p>在非 <code>move</code> 闭包中，如果 <code>Box</code> 的内容没有被移动到闭包体中，则 <code>Box</code> 的内容会被精确捕获。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S(String);

let b = Box::new(S(String::new()));
let c_box = || {
    let x = &amp;(*b).0; // 通过 ImmBorrow 捕获 `(*b).0`
};
c_box();

// 将 `Box` 与另一个实现了 Deref 的类型进行对比：
let r = std::rc::Rc::new(S(String::new()));
let c_rc = || {
    let x = &amp;(*r).0; // 通过 ImmBorrow 捕获 `r`
};
c_rc();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.capture.precision.box-non-move.moved"><a class="rule-link" href="#r-type.closure.capture.precision.box-non-move.moved" title="type.closure.capture.precision.box-non-move.moved"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.box-non-move<wbr>.moved]</span></a>
</div>

<p>然而，如果 <code>Box</code> 的内容被移动到闭包中，那么该 box 会被整体捕获。这样做是为了尽量减少需要移动到闭包中的数据量。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 这与上面的例子相同，除了闭包
// 移动值而不是获取其引用。

struct S(String);

let b = Box::new(S(String::new()));
let c_box = || {
    let x = (*b).0; // 通过 ByValue 捕获 `b`
};
c_box();
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.capture.precision.box-move.read"><a class="rule-link" href="#r-type.closure.capture.precision.box-move.read" title="type.closure.capture.precision.box-move.read"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.box-move<wbr>.read]</span></a>
</div>

<h4 id="具有move闭包的box"><a class="header" href="#具有move闭包的box">具有move闭包的<code>Box</code></a></h4>
<p>类似于在非 <code>move</code> 闭包中移动 <code>Box</code> 的内容，在 <code>move</code> 闭包中读取 <code>Box</code> 的内容将整体捕获 <code>Box</code> 。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S(i32);

let b = Box::new(S(10));
let c_box = move || {
    let x = (*b).0; // 通过 ByValue 捕获 `b`
};
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.unique-immutable"><a class="rule-link" href="#r-type.closure.unique-immutable" title="type.closure.unique-immutable"><span>[type<wbr>.closure<wbr>.unique-immutable]</span></a>
</div>

<h2 id="捕获中的唯一不可变借用"><a class="header" href="#捕获中的唯一不可变借用">捕获中的唯一不可变借用</a></h2>
<p>捕获可以通过一种称为 <em>唯一不可变借用</em> 的特殊借用发生，这种借用在语言的其他地方无法使用，也无法显式写出。它发生在修改可变引用的引用物时，如下例所示：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut b = false;
let x = &amp;mut b;
let mut c = || {
    // x 的一个 ImmBorrow 和一个 MutBorrow。
    let a = &amp;x;
    *x = true; // `x` 通过 UniqueImmBorrow 捕获
};
// 下面这行是一个错误：
// let y = &amp;x;
c();
// 然而，下面这样是可以的。
let z = &amp;x;
<span class="boring">}</span></code></pre>
<p>在这种情况下，由于 <code>x</code> 不是 <code>mut</code> ，所以无法以可变方式借用 <code>x</code> 。但与此同时，不可变地借用 <code>x</code> 会使赋值操作非法，因为 <code>&amp; &amp;mut</code> 引用可能不是唯一的，因此无法安全地用于修改值。所以使用了唯一不可变借用：它不可变地借用 <code>x</code> ，但像可变借用一样，它必须是唯一的。</p>
<p>在上面的示例中，取消对 <code>y</code> 的声明的注释将产生错误，因为它会违反闭包对 <code>x</code> 借用的唯一性； z 的声明是有效的，因为闭包的生命周期在块结束时已过期，释放了借用。</p>
<div class="rule" id="r-type.closure.call"><a class="rule-link" href="#r-type.closure.call" title="type.closure.call"><span>[type<wbr>.closure<wbr>.call]</span></a>
</div>

<h2 id="调用特型与隐式类型转换"><a class="header" href="#调用特型与隐式类型转换">调用特型与隐式类型转换</a></h2>
<div class="rule" id="r-type.closure.call.intro"><a class="rule-link" href="#r-type.closure.call.intro" title="type.closure.call.intro"><span>[type<wbr>.closure<wbr>.call<wbr>.intro]</span></a>
</div>

<p>闭包类型都实现了 <a href="../core/ops/function/trait.FnOnce.html"><code>FnOnce</code></a> ，表示它们可以通过消耗闭包的所有权来调用一次。此外，一些闭包还实现了更具体的调用 特型 ：</p>
<div class="rule" id="r-type.closure.call.fn-mut"><a class="rule-link" href="#r-type.closure.call.fn-mut" title="type.closure.call.fn-mut"><span>[type<wbr>.closure<wbr>.call<wbr>.fn-mut]</span></a>
</div>

<ul>
<li>不从任何捕获变量中移出的闭包实现了 <a href="../core/ops/function/trait.FnMut.html"><code>FnMut</code></a> ，表示它可以通过可变引用调用。</li>
</ul>
<div class="rule" id="r-type.closure.call.fn"><a class="rule-link" href="#r-type.closure.call.fn" title="type.closure.call.fn"><span>[type<wbr>.closure<wbr>.call<wbr>.fn]</span></a>
</div>

<ul>
<li>不修改或从任何捕获变量中移出的闭包实现了 <a href="../core/ops/function/trait.Fn.html"><code>Fn</code></a> ，表示它可以通过共享引用调用。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>move</code> 闭包仍可能实现 <a href="../core/ops/function/trait.Fn.html"><code>Fn</code></a> 或 <a href="../core/ops/function/trait.FnMut.html"><code>FnMut</code></a> ，即使它们通过移动捕获变量。这是因为由闭包类型实现的 特型 是由闭包对捕获值的操作决定的，而不是由它如何捕获它们决定的。</p>
</blockquote>
</div>

<div class="rule" id="r-type.closure.non-capturing"><a class="rule-link" href="#r-type.closure.non-capturing" title="type.closure.non-capturing"><span>[type<wbr>.closure<wbr>.non-capturing]</span></a>
</div>

<p><em>非捕获闭包</em> 是不从其环境中捕获任何内容的闭包。非异步、非捕获的闭包可以被 隐式类型转换 为具有匹配签名的函数指针（例如， <code>fn()</code> ）。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let add = |x, y| x + y;

let mut x = add(5,7);

type Binop = fn(i32, i32) -&gt; i32;
let bo: Binop = add;
x = bo(5,7);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.async.traits"><a class="rule-link" href="#r-type.closure.async.traits" title="type.closure.async.traits"><span>[type<wbr>.closure<wbr>.async<wbr>.traits]</span></a>
</div>

<h3 id="异步闭包特型"><a class="header" href="#异步闭包特型">异步闭包特型</a></h3>
<div class="rule" id="r-type.closure.async.traits.fn-family"><a class="rule-link" href="#r-type.closure.async.traits.fn-family" title="type.closure.async.traits.fn-family"><span>[type<wbr>.closure<wbr>.async<wbr>.traits<wbr>.fn-family]</span></a>
</div>

<p>异步闭包在是否实现 <a href="../core/ops/function/trait.FnMut.html"><code>FnMut</code></a> 或 <a href="../core/ops/function/trait.Fn.html"><code>Fn</code></a> 方面有进一步的限制。</p>
<p>异步闭包返回的 <a href="../core/future/future/trait.Future.html"><code>Future</code></a> 具有与闭包类似的捕获特性。它根据位置表达式的使用方式从异步闭包中捕获它们。如果异步闭包具有以下任一属性，则称其向其 <a href="../core/future/future/trait.Future.html"><code>Future</code></a> <em>借出 (lending)</em> ：</p>
<ul>
<li><code>Future</code> 包含一个可变捕获。</li>
<li>异步闭包通过值捕获，除非该值是通过解引用投影访问的。</li>
</ul>
<p>如果异步闭包向其 <code>Future</code> 借出，则 <em>不</em> 实现 <a href="../core/ops/function/trait.FnMut.html"><code>FnMut</code></a> 和 <a href="../core/ops/function/trait.Fn.html"><code>Fn</code></a> 。 <a href="../core/ops/function/trait.FnOnce.html"><code>FnOnce</code></a> 始终会被实现。</p>
<blockquote>
<p><strong>示例</strong>：可变捕获的第一种情况可以通过以下方式说明：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn takes_callback&lt;Fut: Future&gt;(c: impl FnMut() -&gt; Fut) {}

fn f() {
    let mut x = 1i32;
    let c = async || {
        x = 2;  // x 通过 MutBorrow 捕获
    };
    takes_callback(c);  // 错误：异步闭包未实现 `FnMut`
}
<span class="boring">}</span></code></pre>
<p>普通值捕获的第二种情况可以通过以下方式说明：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn takes_callback&lt;Fut: Future&gt;(c: impl Fn() -&gt; Fut) {}

fn f() {
    let x = &amp;1i32;
    let c = async move || {
        let a = x + 2;  // x 通过 ByValue 捕获
    };
    takes_callback(c);  // 错误：异步闭包未实现 `Fn`
}
<span class="boring">}</span></code></pre>
<p>第二种情况的例外可以通过使用解引用来说明，这确实允许实现 <code>Fn</code> 和 <code>FnMut</code> ：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn takes_callback&lt;Fut: Future&gt;(c: impl Fn() -&gt; Fut) {}

fn f() {
    let x = &amp;1i32;
    let c = async move || {
        let a = *x + 2;
    };
    takes_callback(c);  // OK：实现了 `Fn`
}
<span class="boring">}</span></code></pre>
</blockquote>
<div class="rule" id="r-type.closure.async.traits.async-family"><a class="rule-link" href="#r-type.closure.async.traits.async-family" title="type.closure.async.traits.async-family"><span>[type<wbr>.closure<wbr>.async<wbr>.traits<wbr>.async-family]</span></a>
</div>

<p>异步闭包实现 <a href="../core/ops/async_function/trait.AsyncFn.html"><code>AsyncFn</code></a> 、 <a href="../core/ops/async_function/trait.AsyncFnMut.html"><code>AsyncFnMut</code></a> 和 <a href="../core/ops/async_function/trait.AsyncFnOnce.html"><code>AsyncFnOnce</code></a> 的方式，与普通闭包实现 <a href="../core/ops/function/trait.Fn.html"><code>Fn</code></a> 、 <a href="../core/ops/function/trait.FnMut.html"><code>FnMut</code></a> 和 <a href="../core/ops/function/trait.FnOnce.html"><code>FnOnce</code></a> 的方式类似；也就是说，取决于其体中对捕获变量的使用。</p>
<div class="rule" id="r-type.closure.traits"><a class="rule-link" href="#r-type.closure.traits" title="type.closure.traits"><span>[type<wbr>.closure<wbr>.traits]</span></a>
</div>

<h3 id="其他特型"><a class="header" href="#其他特型">其他特型</a></h3>
<div class="rule" id="r-type.closure.traits.intro"><a class="rule-link" href="#r-type.closure.traits.intro" title="type.closure.traits.intro"><span>[type<wbr>.closure<wbr>.traits<wbr>.intro]</span></a>
</div>

<p>所有闭包类型都实现 <a href="#sized-1"><code>Sized</code></a> 。此外，如果闭包存储的捕获类型允许，闭包类型还会实现以下 特型 ：</p>
<ul>
<li><a href="#clone"><code>Clone</code></a></li>
<li><a href="#copy"><code>Copy</code></a></li>
<li><a href="#sync"><code>Sync</code></a></li>
<li><a href="#send"><code>Send</code></a></li>
</ul>
<div class="rule" id="r-type.closure.traits.behavior"><a class="rule-link" href="#r-type.closure.traits.behavior" title="type.closure.traits.behavior"><span>[type<wbr>.closure<wbr>.traits<wbr>.behavior]</span></a>
</div>

<p><a href="#send"><code>Send</code></a> 和 <a href="#sync"><code>Sync</code></a> 的规则与普通结构体类型的规则一致，而 <a href="#clone"><code>Clone</code></a> 和 <a href="#copy"><code>Copy</code></a> 的行为就像是 <a href="#派生">派生</a> 的。对于 <a href="#clone"><code>Clone</code></a> ，捕获值的克隆顺序未指定。</p>
<p>由于捕获通常是通过引用进行的，因此会产生以下一般规则：</p>
<ul>
<li>如果所有捕获的值都是 <a href="#sync"><code>Sync</code></a> ，则闭包是 <a href="#sync"><code>Sync</code></a> 。</li>
<li>如果所有通过非唯一不可变引用捕获的值都是 <a href="#sync"><code>Sync</code></a> ，且所有通过唯一不可变或可变引用、复制或移动捕获的值都是 <a href="#send"><code>Send</code></a> ，则闭包是 <a href="#send"><code>Send</code></a> 。</li>
<li>如果闭包未通过唯一不可变或可变引用捕获任何值，且它通过复制或移动捕获的所有值分别实现了 <a href="#clone"><code>Clone</code></a> 或 <a href="#copy"><code>Copy</code></a> ，则闭包是 <a href="#clone"><code>Clone</code></a> 或 <a href="#copy"><code>Copy</code></a> 。</li>
</ul>
<div class="rule" id="r-type.closure.drop-order"><a class="rule-link" href="#r-type.closure.drop-order" title="type.closure.drop-order"><span>[type<wbr>.closure<wbr>.drop-order]</span></a>
</div>

<h2 id="丢弃顺序"><a class="header" href="#丢弃顺序">丢弃顺序</a></h2>
<p>如果闭包通过值捕获复合类型（如结构体、元组和枚举）的一个字段，则该字段的生命周期现在将与闭包绑定。因此，复合类型的互不相交字段可能会在不同时间被丢弃。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{
    let tuple =
      (String::from("foo"), String::from("bar")); // --+
    { //                                               |
        let c = || { // ----------------------------+  |
            // tuple.0 被捕获到闭包中                |  |
            drop(tuple.0); //                       |  |
        }; //                                       |  |
    } // 'c' 和 'tuple.0' 在这里被丢弃 -------------+  |
} // tuple.1 在这里被丢弃 -----------------------------+
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.closure.capture.precision.edition2018.entirety"><a class="rule-link" href="#r-type.closure.capture.precision.edition2018.entirety" title="type.closure.capture.precision.edition2018.entirety"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.edition2018<wbr>.entirety]</span></a>
</div>

<h2 id="2018版次及更早版本"><a class="header" href="#2018版次及更早版本">2018版次及更早版本</a></h2>
<h3 id="闭包类型差异"><a class="header" href="#闭包类型差异">闭包类型差异</a></h3>
<p>在2018版次及更早版本中，闭包总是整体捕获变量，而没有精确的捕获路径。这意味着对于 <a href="#closure-types">闭包类型</a> 章节中使用的示例，生成的闭包类型将如下所示：</p>
<!-- ignore: simplified -->
<pre><code class="language-rust ignore">struct Closure&lt;'a&gt; {
    rect : &amp;'a mut Rectangle,
}

impl&lt;'a&gt; FnOnce&lt;()&gt; for Closure&lt;'a&gt; {
    type Output = String;
    extern "rust-call" fn call_once(self, args: ()) -&gt; String {
        self.rect.left_top.x += 1;
        self.rect.right_bottom.x += 1;
        format!("{:?}", self.rect.left_top)
    }
}</code></pre>
<p>并且对 <code>f</code> 的调用将如下工作：</p>
<!-- ignore: continuation of above -->
<pre><code class="language-rust ignore">f(Closure { rect: rect });</code></pre>
<div class="rule" id="r-type.closure.capture.precision.edition2018.composite"><a class="rule-link" href="#r-type.closure.capture.precision.edition2018.composite" title="type.closure.capture.precision.edition2018.composite"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.edition2018<wbr>.composite]</span></a>
</div>

<h3 id="捕获精度差异"><a class="header" href="#捕获精度差异">捕获精度差异</a></h3>
<p>复合类型（如结构体、元组和枚举）总是被整体捕获，而不是按单个字段捕获。因此，可能需要借用到局部变量中以便捕获单个字段：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use std::collections::HashSet;
</span><span class="boring">
</span>struct SetVec {
    set: HashSet&lt;u32&gt;,
    vec: Vec&lt;u32&gt;
}

impl SetVec {
    fn populate(&amp;mut self) {
        let vec = &amp;mut self.vec;
        self.set.iter().for_each(|&amp;n| {
            vec.push(n);
        })
    }
}
<span class="boring">}</span></code></pre>
<p>相反，如果闭包直接使用 <code>self.vec</code> ，那么它将尝试通过可变引用捕获 <code>self</code> 。但由于 <code>self.set</code> 已经被借用用于迭代，代码将无法编译。</p>
<div class="rule" id="r-type.closure.capture.precision.edition2018.move"><a class="rule-link" href="#r-type.closure.capture.precision.edition2018.move" title="type.closure.capture.precision.edition2018.move"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.edition2018<wbr>.move]</span></a>
</div>

<p>如果使用了 <code>move</code> 关键字，那么所有的捕获都是通过移动进行的，或者对于 <code>Copy</code> 类型通过复制进行，无论借用是否可行。 <code>move</code> 关键字通常用于允许闭包存活时间超过捕获的值，例如闭包被返回或用于派生新线程的情况。</p>
<div class="rule" id="r-type.closure.capture.precision.edition2018.wildcard"><a class="rule-link" href="#r-type.closure.capture.precision.edition2018.wildcard" title="type.closure.capture.precision.edition2018.wildcard"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.edition2018<wbr>.wildcard]</span></a>
</div>

<p>无论数据是否会被闭包读取（即在通配符模式的情况下），如果在闭包内提到了闭包外定义的变量，该变量都将被整体捕获。</p>
<div class="rule" id="r-type.closure.capture.precision.edition2018.drop-order"><a class="rule-link" href="#r-type.closure.capture.precision.edition2018.drop-order" title="type.closure.capture.precision.edition2018.drop-order"><span>[type<wbr>.closure<wbr>.capture<wbr>.precision<wbr>.edition2018<wbr>.drop-order]</span></a>
</div>

<h3 id="丢弃顺序差异"><a class="header" href="#丢弃顺序差异">丢弃顺序差异</a></h3>
<p>由于复合类型是被整体捕获的，因此通过值捕获其中一种复合类型的闭包将在闭包被丢弃的同时丢弃整个捕获的变量。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>{
    let tuple =
      (String::from("foo"), String::from("bar"));
    {
        let c = || { // --------------------------+
            // tuple 被捕获到闭包中                  |
            drop(tuple.0); //                     |
        }; //                                     |
    } // 'c' 和 'tuple' 在这里被丢弃 --------------+
}
<span class="boring">}</span></code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type.pointer"><a class="rule-link" href="#r-type.pointer" title="type.pointer"><span>[type<wbr>.pointer]</span></a>
</div>

<h1 id="指针类型"><a class="header" href="#指针类型">指针类型</a></h1>
<div class="rule" id="r-type.pointer.intro"><a class="rule-link" href="#r-type.pointer.intro" title="type.pointer.intro"><span>[type<wbr>.pointer<wbr>.intro]</span></a>
</div>

<p>所有指针都是显式的一等值。
它们可以被移动或复制，存储进数据 结构体 中，并从函数中返回。</p>
<div class="rule" id="r-type.pointer.reference"><a class="rule-link" href="#r-type.pointer.reference" title="type.pointer.reference"><span>[type<wbr>.pointer<wbr>.reference]</span></a>
</div>

<h2 id="引用--和-mut"><a class="header" href="#引用--和-mut">引用 (<code>&amp;</code> 和 <code>&amp;mut</code>)</a></h2>
<div class="rule" id="r-type.pointer.reference.syntax"><a class="rule-link" href="#r-type.pointer.reference.syntax" title="type.pointer.reference.syntax"><span>[type<wbr>.pointer<wbr>.reference<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ReferenceType" onclick="show_railroad()"><a href="#railroad-ReferenceType">ReferenceType</a></span> → <span class="grammar-literal">&amp;</span> <span class="grammar-text"><a href="#grammar-Lifetime">Lifetime</a></span><sup>?</sup> <span class="grammar-literal">mut</span><sup>?</sup> <span class="grammar-text"><a href="#grammar-TypeNoBounds">TypeNoBounds</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 468px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ReferenceType"><svg class="railroad" viewbox="0 0 468 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ReferenceType">
<text class="comment" x="60" y="25">
ReferenceType</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="55" />
<text x="49" y="71">
&amp;</text>
</g>
<g class="optional">
<path d=" M 73 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 84 m -39 0 l -5 -5 m 0 10 l 5 -5 m 39 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-Lifetime">
<g class="nonterminal">
<rect height="22" width="84" x="97" y="55" />
<text x="139" y="71">
Lifetime</text>
</g>
</a>
</g>
<g class="optional">
<path d=" M 215 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 44 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="239" y="55" />
<text x="261" y="71">
mut</text>
</g>
</g>
<a class="link" xlink:href="#railroad-TypeNoBounds">
<g class="nonterminal">
<rect height="22" width="116" x="317" y="55" />
<text x="375" y="71">
TypeNoBounds</text>
</g>
</a>
<path d=" M 63 66 h 10" />
<path d=" M 205 66 h 10" />
<path d=" M 307 66 h 10" />
</g>
<path d=" M 443 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 433 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-type.pointer.reference.shared"><a class="rule-link" href="#r-type.pointer.reference.shared" title="type.pointer.reference.shared"><span>[type<wbr>.pointer<wbr>.reference<wbr>.shared]</span></a>
</div>

<h3 id="共享引用-"><a class="header" href="#共享引用-">共享引用 (<code>&amp;</code>)</a></h3>
<div class="rule" id="r-type.pointer.reference.shared.intro"><a class="rule-link" href="#r-type.pointer.reference.shared.intro" title="type.pointer.reference.shared.intro"><span>[type<wbr>.pointer<wbr>.reference<wbr>.shared<wbr>.intro]</span></a>
</div>

<p>共享引用指向由其他值拥有的内存。</p>
<div class="rule" id="r-type.pointer.reference.shared.constraint-mutation"><a class="rule-link" href="#r-type.pointer.reference.shared.constraint-mutation" title="type.pointer.reference.shared.constraint-mutation"><span>[type<wbr>.pointer<wbr>.reference<wbr>.shared<wbr>.constraint-mutation]</span></a>
</div>

<p>当创建一个值的共享引用时，它会阻止该值的直接修改。
<a href="#内部可变性">内部可变性</a> 在某些情况下为此提供了例外。
顾名思义，一个值可以存在任意数量的共享引用。
共享引用类型写为 <code>&amp;type</code> ，或者在需要指定显式生命周期时写为 <code>&amp;'a type</code> 。</p>
<div class="rule" id="r-type.pointer.reference.shared.copy"><a class="rule-link" href="#r-type.pointer.reference.shared.copy" title="type.pointer.reference.shared.copy"><span>[type<wbr>.pointer<wbr>.reference<wbr>.shared<wbr>.copy]</span></a>
</div>

<p>复制引用是一个 “浅层” 操作：
它只涉及复制指针本身，也就是说，指针是 <code>Copy</code> 的。
释放引用对它所指向的值没有影响，但引用一个 <a href="#temporaries">临时值</a> 会在引用本身的作用域内使其保持存活。</p>
<div class="rule" id="r-type.pointer.reference.mut"><a class="rule-link" href="#r-type.pointer.reference.mut" title="type.pointer.reference.mut"><span>[type<wbr>.pointer<wbr>.reference<wbr>.mut]</span></a>
</div>

<h3 id="可变引用-mut"><a class="header" href="#可变引用-mut">可变引用 (<code>&amp;mut</code>)</a></h3>
<div class="rule" id="r-type.pointer.reference.mut.intro"><a class="rule-link" href="#r-type.pointer.reference.mut.intro" title="type.pointer.reference.mut.intro"><span>[type<wbr>.pointer<wbr>.reference<wbr>.mut<wbr>.intro]</span></a>
</div>

<p>可变引用指向由其他值拥有的内存。
可变引用类型写为 <code>&amp;mut type</code> 或 <code>&amp;'a mut type</code> 。</p>
<div class="rule" id="r-type.pointer.reference.mut.copy"><a class="rule-link" href="#r-type.pointer.reference.mut.copy" title="type.pointer.reference.mut.copy"><span>[type<wbr>.pointer<wbr>.reference<wbr>.mut<wbr>.copy]</span></a>
</div>

<p>可变引用（尚未被借用的）是访问其指向的值的唯一方式，因此它不是 <code>Copy</code> 的。</p>
<div class="rule" id="r-type.pointer.raw"><a class="rule-link" href="#r-type.pointer.raw" title="type.pointer.raw"><span>[type<wbr>.pointer<wbr>.raw]</span></a>
</div>

<h2 id="裸指针-const-和-mut"><a class="header" href="#裸指针-const-和-mut">裸指针 (<code>*const</code> 和 <code>*mut</code>)</a></h2>
<div class="rule" id="r-type.pointer.raw.syntax"><a class="rule-link" href="#r-type.pointer.raw.syntax" title="type.pointer.raw.syntax"><span>[type<wbr>.pointer<wbr>.raw<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-RawPointerType" onclick="show_railroad()"><a href="#railroad-RawPointerType">RawPointerType</a></span> → <span class="grammar-literal">*</span> ( <span class="grammar-literal">mut</span> | <span class="grammar-literal">const</span> ) <span class="grammar-text"><a href="#grammar-TypeNoBounds">TypeNoBounds</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 342px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RawPointerType"><svg class="railroad" viewbox="0 0 342 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RawPointerType">
<text class="comment" x="64" y="25">
RawPointerType</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="42" />
<text x="49" y="58">
*</text>
</g>
<g class="choice">
<path d=" M 73 53 h 24 m 44 0 h 40" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="97" y="42" />
<text x="119" y="58">
mut</text>
</g>
<path d=" M 73 53 a 12 12 0 0 1 12 12 v 9 m 84 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 85 74 v 0 a 12 12 0 0 0 12 12 m 60 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="97" y="75" />
<text x="127" y="91">
const</text>
</g>
</g>
<a class="link" xlink:href="#railroad-TypeNoBounds">
<g class="nonterminal">
<rect height="22" width="116" x="191" y="42" />
<text x="249" y="58">
TypeNoBounds</text>
</g>
</a>
<path d=" M 63 53 h 10" />
<path d=" M 181 53 h 10" />
</g>
<path d=" M 317 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 307 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-type.pointer.raw.intro"><a class="rule-link" href="#r-type.pointer.raw.intro" title="type.pointer.raw.intro"><span>[type<wbr>.pointer<wbr>.raw<wbr>.intro]</span></a>
</div>

<p>裸指针是没有安全或存活性保证的指针。
裸指针写为 <code>*const T</code> 或 <code>*mut T</code> 。
例如 <code>*const i32</code> 表示一个指向 32 位整数的裸指针。</p>
<div class="rule" id="r-type.pointer.raw.copy"><a class="rule-link" href="#r-type.pointer.raw.copy" title="type.pointer.raw.copy"><span>[type<wbr>.pointer<wbr>.raw<wbr>.copy]</span></a>
</div>

<p>复制或丢弃裸指针对任何其他值的生命周期都没有影响。</p>
<div class="rule" id="r-type.pointer.raw.safety"><a class="rule-link" href="#r-type.pointer.raw.safety" title="type.pointer.raw.safety"><span>[type<wbr>.pointer<wbr>.raw<wbr>.safety]</span></a>
</div>

<p>解引用裸指针是一个 <a href="#不安全性"><code>unsafe</code> 操作</a> 。</p>
<p>这也可以通过重借用 (<code>&amp;*</code> 或 <code>&amp;mut *</code> ) 来将裸指针转换为引用。
通常不鼓励使用裸指针；
它们的存在是为了支持与外部代码的互操作性，以及编写性能关键型或底层函数。</p>
<div class="rule" id="r-type.pointer.raw.cmp"><a class="rule-link" href="#r-type.pointer.raw.cmp" title="type.pointer.raw.cmp"><span>[type<wbr>.pointer<wbr>.raw<wbr>.cmp]</span></a>
</div>

<p>比较裸指针时，是按它们的地址进行比较，而不是按它们指向的内容进行比较。
在将裸指针与 <a href="#动态大小类型">动态大小类型</a> 进行比较时，它们的附加数据也会被比较。</p>
<div class="rule" id="r-type.pointer.raw.constructor"><a class="rule-link" href="#r-type.pointer.raw.constructor" title="type.pointer.raw.constructor"><span>[type<wbr>.pointer<wbr>.raw<wbr>.constructor]</span></a>
</div>

<p>裸指针可以使用 <code>&amp;raw const</code> 直接创建为 <code>*const</code> 指针，使用 <code>&amp;raw mut</code> 直接创建为 <code>*mut</code> 指针。</p>
<div class="rule" id="r-type.pointer.smart"><a class="rule-link" href="#r-type.pointer.smart" title="type.pointer.smart"><span>[type<wbr>.pointer<wbr>.smart]</span></a>
</div>

<h2 id="智能指针"><a class="header" href="#智能指针">智能指针</a></h2>
<p>标准库包含除引用和裸指针之外的其他 “智能指针” 类型。</p>
<div class="rule" id="r-type.pointer.validity"><a class="rule-link" href="#r-type.pointer.validity" title="type.pointer.validity"><span>[type<wbr>.pointer<wbr>.validity]</span></a>
</div>

<h2 id="位有效性-2"><a class="header" href="#位有效性-2">位有效性</a></h2>
<div class="rule" id="r-type.pointer.validity.pointer-fragment"><a class="rule-link" href="#r-type.pointer.validity.pointer-fragment" title="type.pointer.validity.pointer-fragment"><span>[type<wbr>.pointer<wbr>.validity<wbr>.pointer-fragment]</span></a>
</div>

<p>尽管在大多数平台上生成的机器代码中，指针和引用与 <code>usize</code> 相似，
但目前尚未确定将引用或指针类型转换为非指针类型的语义。
因此，将指针或引用类型 <code>P</code> 转换为 <code>[u8; size_of::&lt;P&gt;()]</code> 可能是不合法的。</p>
<div class="rule" id="r-type.pointer.validity.raw"><a class="rule-link" href="#r-type.pointer.validity.raw" title="type.pointer.validity.raw"><span>[type<wbr>.pointer<wbr>.validity<wbr>.raw]</span></a>
</div>

<p>对于瘦裸指针（即针对 <code>T: Sized</code> 的 <code>P = *const T</code> 或 <code>P = *mut T</code> ），
反向（从整数或整数数组转换为 <code>P</code> ）始终是有效的。
然而，通过这种转换产生的指针可能无法被解引用（即使 <code>T</code> 的大小为零也不行）。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type.fn-pointer"><a class="rule-link" href="#r-type.fn-pointer" title="type.fn-pointer"><span>[type<wbr>.fn-pointer]</span></a>
</div>

<h1 id="函数指针类型"><a class="header" href="#函数指针类型">函数指针类型</a></h1>
<div class="rule" id="r-type.fn-pointer.syntax"><a class="rule-link" href="#r-type.fn-pointer.syntax" title="type.fn-pointer.syntax"><span>[type<wbr>.fn-pointer<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-BareFunctionType" onclick="show_railroad()"><a href="#railroad-BareFunctionType">BareFunctionType</a></span> → <br>    <span class="grammar-text"><a href="#grammar-ForLifetimes">ForLifetimes</a></span><sup>?</sup> <span class="grammar-text"><a href="#grammar-FunctionTypeQualifiers">FunctionTypeQualifiers</a></span> <span class="grammar-literal">fn</span> <br>       <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-FunctionParametersMaybeNamedVariadic">FunctionParametersMaybeNamedVariadic</a></span><sup>?</sup> <span class="grammar-literal">)</span> <span class="grammar-text"><a href="#grammar-BareFunctionReturnType">BareFunctionReturnType</a></span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-FunctionTypeQualifiers" onclick="show_railroad()"><a href="#railroad-FunctionTypeQualifiers">FunctionTypeQualifiers</a></span> → <span class="grammar-literal">unsafe</span><sup>?</sup> ( <span class="grammar-literal">extern</span> <span class="grammar-text"><a href="#grammar-Abi">Abi</a></span><sup>?</sup> )<sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-BareFunctionReturnType" onclick="show_railroad()"><a href="#railroad-BareFunctionReturnType">BareFunctionReturnType</a></span> → <span class="grammar-literal">-&gt;</span> <span class="grammar-text"><a href="#grammar-TypeNoBounds">TypeNoBounds</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-FunctionParametersMaybeNamedVariadic" onclick="show_railroad()"><a href="#railroad-FunctionParametersMaybeNamedVariadic">FunctionParametersMaybeNamedVariadic</a></span> → <br>    <span class="grammar-text"><a href="#grammar-MaybeNamedFunctionParameters">MaybeNamedFunctionParameters</a></span> | <span class="grammar-text"><a href="#grammar-MaybeNamedFunctionParametersVariadic">MaybeNamedFunctionParametersVariadic</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-MaybeNamedFunctionParameters" onclick="show_railroad()"><a href="#railroad-MaybeNamedFunctionParameters">MaybeNamedFunctionParameters</a></span> → <br>    <span class="grammar-text"><a href="#grammar-MaybeNamedParam">MaybeNamedParam</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-MaybeNamedParam">MaybeNamedParam</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-MaybeNamedParam" onclick="show_railroad()"><a href="#railroad-MaybeNamedParam">MaybeNamedParam</a></span> → <br>    <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> ( ( <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> | <span class="grammar-literal">_</span> ) <span class="grammar-literal">:</span> )<sup>?</sup> <span class="grammar-text"><a href="#grammar-Type">Type</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-MaybeNamedFunctionParametersVariadic" onclick="show_railroad()"><a href="#railroad-MaybeNamedFunctionParametersVariadic">MaybeNamedFunctionParametersVariadic</a></span> → <br>    ( <span class="grammar-text"><a href="#grammar-MaybeNamedParam">MaybeNamedParam</a></span> <span class="grammar-literal">,</span> )<sup>*</sup> <span class="grammar-text"><a href="#grammar-MaybeNamedParam">MaybeNamedParam</a></span> <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> <span class="grammar-literal">...</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 808px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-BareFunctionType"><svg class="railroad" viewbox="0 0 808 147" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-BareFunctionType">
<text class="comment" x="71" y="25">
BareFunctionType</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="stack">
<path d=" M 35 66 h 12" />
<path d=" M 471 66 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 h -424 m 215 0 l 5 -5 m 0 10 l -5 -5 m -215 0 a 12 12 0 0 0 -12 12 v 12 v 0 a 12 12 0 0 0 12 12 h 0" />
<g class="sequence">
<g class="optional">
<path d=" M 47 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 116 m -55 0 l -5 -5 m 0 10 l 5 -5 m 55 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-ForLifetimes">
<g class="nonterminal">
<rect height="22" width="116" x="71" y="55" />
<text x="129" y="71">
ForLifetimes</text>
</g>
</a>
</g>
<a class="link" xlink:href="#railroad-FunctionTypeQualifiers">
<g class="nonterminal">
<rect height="22" width="204" x="221" y="55" />
<text x="323" y="71">
FunctionTypeQualifiers</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="435" y="55" />
<text x="453" y="71">
fn</text>
</g>
<path d=" M 211 66 h 10" />
<path d=" M 425 66 h 10" />
</g>
<path d=" M 749 126 h 0 a 12 12 0 0 0 12 -12 v -36 a 12 12 0 0 1 12 -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="47" y="115" />
<text x="61" y="131">
(</text>
</g>
<g class="optional">
<path d=" M 85 126 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 316 m -155 0 l -5 -5 m 0 10 l 5 -5 m 155 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-FunctionParametersMaybeNamedVariadic">
<g class="nonterminal">
<rect height="22" width="316" x="109" y="115" />
<text x="267" y="131">
FunctionParametersMaybeNamedVariadic</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="459" y="115" />
<text x="473" y="131">
)</text>
</g>
<g class="optional">
<path d=" M 497 126 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 204 m -99 0 l -5 -5 m 0 10 l 5 -5 m 99 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-BareFunctionReturnType">
<g class="nonterminal">
<rect height="22" width="204" x="521" y="115" />
<text x="623" y="131">
BareFunctionReturnType</text>
</g>
</a>
</g>
<path d=" M 75 126 h 10" />
<path d=" M 449 126 h 10" />
<path d=" M 487 126 h 10" />
</g>
</g>
<path d=" M 783 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 773 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 414px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-FunctionTypeQualifiers"><svg class="railroad" viewbox="0 0 414 99" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-FunctionTypeQualifiers">
<text class="comment" x="95" y="25">
FunctionTypeQualifiers</text>
</a>
<g class="sequence">
<path d=" M 10 78 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 68 m -31 0 l -5 -5 m 0 10 l 5 -5 m 31 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="67" />
<text x="93" y="83">
unsafe</text>
</g>
</g>
<g class="optional">
<path d=" M 161 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -12 a 12 12 0 0 1 12 -12 h 170 m -82 0 l -5 -5 m 0 10 l 5 -5 m 82 0 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="185" y="67" />
<text x="219" y="83">
extern</text>
</g>
<g class="optional">
<path d=" M 263 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 44 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-Abi">
<g class="nonterminal">
<rect height="22" width="44" x="287" y="67" />
<text x="309" y="83">
Abi</text>
</g>
</a>
</g>
<path d=" M 253 78 h 10" />
</g>
</g>
<path d=" M 151 78 h 10" />
</g>
<path d=" M 389 78 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 78 h 10" />
<path d=" M 379 78 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 232px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-BareFunctionReturnType"><svg class="railroad" viewbox="0 0 232 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-BareFunctionReturnType">
<text class="comment" x="95" y="25">
BareFunctionReturnType</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="35" y="42" />
<text x="53" y="58">
-&gt;</text>
</g>
<a class="link" xlink:href="#railroad-TypeNoBounds">
<g class="nonterminal">
<rect height="22" width="116" x="81" y="42" />
<text x="139" y="58">
TypeNoBounds</text>
</g>
</a>
<path d=" M 71 53 h 10" />
</g>
<path d=" M 207 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 197 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 434px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-FunctionParametersMaybeNamedVariadic"><svg class="railroad" viewbox="0 0 434 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-FunctionParametersMaybeNamedVariadic">
<text class="comment" x="144" y="25">
FunctionParametersMaybeNamedVariadic</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 252 0 h 88 m -41 0 l -5 -5 m 0 10 l 5 -5 m 41 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-MaybeNamedFunctionParameters">
<g class="nonterminal">
<rect height="22" width="252" x="59" y="42" />
<text x="185" y="58">
MaybeNamedFunctionParameters</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 340 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 316 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-MaybeNamedFunctionParametersVariadic">
<g class="nonterminal">
<rect height="22" width="316" x="59" y="75" />
<text x="217" y="91">
MaybeNamedFunctionParametersVariadic</text>
</g>
</a>
</g>
<path d=" M 409 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 399 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 556px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MaybeNamedFunctionParameters"><svg class="railroad" viewbox="0 0 556 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MaybeNamedFunctionParameters">
<text class="comment" x="116" y="25">
MaybeNamedFunctionParameters</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-MaybeNamedParam">
<g class="nonterminal">
<rect height="22" width="140" x="35" y="55" />
<text x="105" y="71">
MaybeNamedParam</text>
</g>
</a>
<g class="optional">
<path d=" M 185 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 202 m -98 0 l -5 -5 m 0 10 l 5 -5 m 98 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 209 66 h 12 m 178 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -178 m 92 0 l 5 -5 m 0 10 l -5 -5 m -92 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="221" y="55" />
<text x="235" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-MaybeNamedParam">
<g class="nonterminal">
<rect height="22" width="140" x="259" y="55" />
<text x="329" y="71">
MaybeNamedParam</text>
</g>
</a>
<path d=" M 249 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 445 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="469" y="55" />
<text x="483" y="71">
,</text>
</g>
</g>
<path d=" M 175 66 h 10" />
<path d=" M 435 66 h 10" />
</g>
<path d=" M 531 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 521 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 580px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MaybeNamedParam"><svg class="railroad" viewbox="0 0 580 120" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MaybeNamedParam">
<text class="comment" x="67" y="25">
MaybeNamedParam</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<g class="optional">
<path d=" M 249 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 186 m -90 0 l -5 -5 m 0 10 l 5 -5 m 90 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="choice">
<path d=" M 273 66 h 24 m 100 0 h 24" />
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="297" y="55" />
<text x="347" y="71">
IDENTIFIER</text>
</g>
</a>
<path d=" M 273 66 a 12 12 0 0 1 12 12 v 9 m 124 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 285 87 v 0 a 12 12 0 0 0 12 12 m 28 0 h 72 m -33 0 l -5 -5 m 0 10 l 5 -5 m 33 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="297" y="88" />
<text x="311" y="104">
_</text>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="431" y="55" />
<text x="445" y="71">
:</text>
</g>
<path d=" M 421 66 h 10" />
</g>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="493" y="55" />
<text x="519" y="71">
Type</text>
</g>
</a>
<path d=" M 239 66 h 10" />
<path d=" M 483 66 h 10" />
</g>
<path d=" M 555 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 545 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 776px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MaybeNamedFunctionParametersVariadic"><svg class="railroad" viewbox="0 0 776 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-MaybeNamedFunctionParametersVariadic">
<text class="comment" x="144" y="25">
MaybeNamedFunctionParametersVariadic</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 202 m -98 0 l -5 -5 m 0 10 l 5 -5 m 98 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 178 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -178 m 92 0 l 5 -5 m 0 10 l -5 -5 m -92 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<a class="link" xlink:href="#railroad-MaybeNamedParam">
<g class="nonterminal">
<rect height="22" width="140" x="71" y="55" />
<text x="141" y="71">
MaybeNamedParam</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="221" y="55" />
<text x="235" y="71">
,</text>
</g>
<path d=" M 211 66 h 10" />
</g>
</g>
</g>
<a class="link" xlink:href="#railroad-MaybeNamedParam">
<g class="nonterminal">
<rect height="22" width="140" x="295" y="55" />
<text x="365" y="71">
MaybeNamedParam</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="445" y="55" />
<text x="459" y="71">
,</text>
</g>
<g class="optional">
<path d=" M 483 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 507 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="519" y="55" />
<text x="585" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="697" y="55" />
<text x="719" y="71">
...</text>
</g>
<path d=" M 285 66 h 10" />
<path d=" M 435 66 h 10" />
<path d=" M 473 66 h 10" />
<path d=" M 687 66 h 10" />
</g>
<path d=" M 751 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 741 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-type.fn-pointer.intro"><a class="rule-link" href="#r-type.fn-pointer.intro" title="type.fn-pointer.intro"><span>[type<wbr>.fn-pointer<wbr>.intro]</span></a>
</div>

<p>一个函数指针类型，使用 <code>fn</code> 关键字编写，指向一个在编译时身份不一定确定的函数。</p>
<p>一个将 <code>Binop</code> 定义为函数指针类型的示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn add(x: i32, y: i32) -&gt; i32 {
    x + y
}

let mut x = add(5,7);

type Binop = fn(i32, i32) -&gt; i32;
let bo: Binop = add;
x = bo(5,7);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.fn-pointer.coercion"><a class="rule-link" href="#r-type.fn-pointer.coercion" title="type.fn-pointer.coercion"><span>[type<wbr>.fn-pointer<wbr>.coercion]</span></a>
</div>

<p>函数指针可以通过来自 <a href="#函数项类型">函数项</a> 以及非捕获、非异步的 <a href="#闭包类型">闭包</a> 的 <a href="types/type-coercions.html">隐式类型转换</a> 来创建。</p>
<div class="rule" id="r-type.fn-pointer.qualifiers"><a class="rule-link" href="#r-type.fn-pointer.qualifiers" title="type.fn-pointer.qualifiers"><span>[type<wbr>.fn-pointer<wbr>.qualifiers]</span></a>
</div>

<p><code>unsafe</code> 限定符表示该类型的值是一个 <a href="#unsafe-关键字">不安全函数</a> ，而 <code>extern</code> 限定符表示它是一个 <a href="#extern-function-qualifier">外部函数</a> 。</p>
<div class="rule" id="r-type.fn-pointer.constraint-variadic"><a class="rule-link" href="#r-type.fn-pointer.constraint-variadic" title="type.fn-pointer.constraint-variadic"><span>[type<wbr>.fn-pointer<wbr>.constraint-variadic]</span></a>
</div>

<p>要使函数成为变长参数函数，其 <code>extern</code> ABI 必须是 <a href="#r-items.extern.variadic.conventions">items.extern.variadic.conventions</a> 中列出的之一。</p>
<div class="rule" id="r-type.fn-pointer.attributes"><a class="rule-link" href="#r-type.fn-pointer.attributes" title="type.fn-pointer.attributes"><span>[type<wbr>.fn-pointer<wbr>.attributes]</span></a>
</div>

<h2 id="函数指针参数上的属性"><a class="header" href="#函数指针参数上的属性">函数指针参数上的属性</a></h2>
<p>函数指针参数上的属性遵循与 <a href="#attributes-on-function-parameters">常规函数参数</a> 相同的规则和限制。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type.trait-object"><a class="rule-link" href="#r-type.trait-object" title="type.trait-object"><span>[type<wbr>.trait-object]</span></a>
</div>

<h1 id="特型对象"><a class="header" href="#特型对象">特型对象</a></h1>
<div class="rule" id="r-type.trait-object.syntax"><a class="rule-link" href="#r-type.trait-object.syntax" title="type.trait-object.syntax"><span>[type<wbr>.trait-object<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-TraitObjectType" onclick="show_railroad()"><a href="#railroad-TraitObjectType">TraitObjectType</a></span> → <span class="grammar-literal">dyn</span><sup>?</sup> <span class="grammar-text"><a href="#grammar-TypeParamBounds">TypeParamBounds</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-TraitObjectTypeOneBound" onclick="show_railroad()"><a href="#railroad-TraitObjectTypeOneBound">TraitObjectTypeOneBound</a></span> → <span class="grammar-literal">dyn</span><sup>?</sup> <span class="grammar-text"><a href="#grammar-TraitBound">TraitBound</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 312px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TraitObjectType"><svg class="railroad" viewbox="0 0 312 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TraitObjectType">
<text class="comment" x="67" y="25">
TraitObjectType</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 44 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="55" />
<text x="81" y="71">
dyn</text>
</g>
</g>
<a class="link" xlink:href="#railroad-TypeParamBounds">
<g class="nonterminal">
<rect height="22" width="140" x="137" y="55" />
<text x="207" y="71">
TypeParamBounds</text>
</g>
</a>
<path d=" M 127 66 h 10" />
</g>
<path d=" M 287 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 277 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 272px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TraitObjectTypeOneBound"><svg class="railroad" viewbox="0 0 272 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TraitObjectTypeOneBound">
<text class="comment" x="99" y="25">
TraitObjectTypeOneBound</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 44 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="55" />
<text x="81" y="71">
dyn</text>
</g>
</g>
<a class="link" xlink:href="#railroad-TraitBound">
<g class="nonterminal">
<rect height="22" width="100" x="137" y="55" />
<text x="187" y="71">
TraitBound</text>
</g>
</a>
<path d=" M 127 66 h 10" />
</g>
<path d=" M 247 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 237 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-type.trait-object.intro"><a class="rule-link" href="#r-type.trait-object.intro" title="type.trait-object.intro"><span>[type<wbr>.trait-object<wbr>.intro]</span></a>
</div>

<p>一个 <em>特型对象</em> 是实现了的一组特型的另一种类型的不透明值。这组特型由一个 <a href="#dyn兼容性">dyn 兼容</a> 的 <em>基础特型</em> 加上任意数量的 <a href="#auto-traits">自动特型</a> 组成。</p>
<div class="rule" id="r-type.trait-object.impls"><a class="rule-link" href="#r-type.trait-object.impls" title="type.trait-object.impls"><span>[type<wbr>.trait-object<wbr>.impls]</span></a>
</div>

<p>特型对象实现了基础特型、其自动特型以及基础特型的任何 <a href="#supertraits">超特型</a> 。</p>
<div class="rule" id="r-type.trait-object.name"><a class="rule-link" href="#r-type.trait-object.name" title="type.trait-object.name"><span>[type<wbr>.trait-object<wbr>.name]</span></a>
</div>

<p>特型对象写作关键字 <code>dyn</code> 后跟一组特型界限，但对特型界限有以下限制。</p>
<div class="rule" id="r-type.trait-object.constraint"><a class="rule-link" href="#r-type.trait-object.constraint" title="type.trait-object.constraint"><span>[type<wbr>.trait-object<wbr>.constraint]</span></a>
</div>

<p>非自动特型不得超过一个，生命周期不得超过一个，且不允许退出界限（例如 <code>?Sized</code> ）。此外，特型路径可以用括号括起来。</p>
<p>例如，给定一个特型 <code>Trait</code> ，以下都是特型对象：</p>
<ul>
<li><code>dyn Trait</code></li>
<li><code>dyn Trait + Send</code></li>
<li><code>dyn Trait + Send + Sync</code></li>
<li><code>dyn Trait + 'static</code></li>
<li><code>dyn Trait + Send + 'static</code></li>
<li><code>dyn Trait +</code></li>
<li><code>dyn 'static + Trait</code>.</li>
<li><code>dyn (Trait)</code></li>
</ul>
<div class="rule" id="r-type.trait-object.syntax-edition2021"><a class="rule-link" href="#r-type.trait-object.syntax-edition2021" title="type.trait-object.syntax-edition2021"><span>[type<wbr>.trait-object<wbr>.syntax-edition2021]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2021</span> 版次差异</p>

<p>在 2021 版次 之前， <code>dyn</code> 关键字可以省略。</p>
</blockquote>
</div>

<div class="rule" id="r-type.trait-object.syntax-edition2018"><a class="rule-link" href="#r-type.trait-object.syntax-edition2018" title="type.trait-object.syntax-edition2018"><span>[type<wbr>.trait-object<wbr>.syntax-edition2018]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p>在 2015 版次 中，如果特型对象的第一个界限是以 <code>::</code> 开头的路径，那么 <code>dyn</code> 将被视为路径的一部分。可以将第一个路径放在括号中来解决这个问题。因此，如果你想要一个具有 <code>::your_module::Trait</code> 特型的特型对象，你应该写成 <code>dyn (::your_module::Trait)</code> 。</p>
<p>从 2018 版次 开始， <code>dyn</code> 是一个真正的关键字，不允许出现在路径中，因此括号不是必需的。</p>
</blockquote>
</div>

<div class="rule" id="r-type.trait-object.alias"><a class="rule-link" href="#r-type.trait-object.alias" title="type.trait-object.alias"><span>[type<wbr>.trait-object<wbr>.alias]</span></a>
</div>

<p>如果基础特型互为别名，且自动特型集合相同，生命周期界限也相同，则两个特型对象类型互为别名。例如， <code>dyn Trait + Send + UnwindSafe</code> 与 <code>dyn Trait + UnwindSafe + Send</code> 相同。</p>
<div class="rule" id="r-type.trait-object.unsized"><a class="rule-link" href="#r-type.trait-object.unsized" title="type.trait-object.unsized"><span>[type<wbr>.trait-object<wbr>.unsized]</span></a>
</div>

<p>由于值属于哪种具体类型是不透明的，特型对象是 <a href="#动态大小类型">动态大小类型</a> 。像所有 <abbr title="dynamically sized types">DST</abbr> 一样，特型对象在某种类型的指针后面使用；例如 <code>&amp;dyn SomeTrait</code> 或 <code>Box&lt;dyn SomeTrait&gt;</code> 。特型对象指针的每个实例包括：</p>
<ul>
<li>一个指向实现了 <code>SomeTrait</code> 的类型 <code>T</code> 实例的指针</li>
<li>一个 <em>虚方法表</em> ，通常简称为 <em>vtable</em> ，其中包含 <code>T</code> 针对 <code>SomeTrait</code> 及其 <a href="#supertraits">超特型</a> 的每个方法的实现指针（即函数指针）。</li>
</ul>
<p>特型对象的目的是允许方法的 “后期绑定” 。在特型对象上调用方法会导致运行时的虚拟分派：即从特型对象 vtable 中加载函数指针并间接调用。每个 vtable 条目的实际实现可以因对象而异。</p>
<p>一个特型对象的例子：</p>
<pre class="playground"><code class="language-rust edition2024">trait Printable {
    fn stringify(&amp;self) -&gt; String;
}

impl Printable for i32 {
    fn stringify(&amp;self) -&gt; String { self.to_string() }
}

fn print(a: Box&lt;dyn Printable&gt;) {
    println!("{}", a.stringify());
}

fn main() {
    print(Box::new(10) as Box&lt;dyn Printable&gt;);
}</code></pre>
<p>在这个例子中，特型 <code>Printable</code> 在 <code>print</code> 的类型签名和 <code>main</code> 中的类型转换表达式中都作为特型对象出现。</p>
<div class="rule" id="r-type.trait-object.lifetime-bounds"><a class="rule-link" href="#r-type.trait-object.lifetime-bounds" title="type.trait-object.lifetime-bounds"><span>[type<wbr>.trait-object<wbr>.lifetime-bounds]</span></a>
</div>

<h2 id="特型对象生命周期界限"><a class="header" href="#特型对象生命周期界限">特型对象生命周期界限</a></h2>
<p>由于特型对象可以包含引用，这些引用的生命周期需要作为特型对象的一部分来表达。该生命周期写为 <code>Trait + 'a</code> 。有一些 <a href="#default-trait-object-lifetimes">默认值</a> 允许通常以合理的选择推断此生命周期。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type.impl-trait"><a class="rule-link" href="#r-type.impl-trait" title="type.impl-trait"><span>[type<wbr>.impl-trait]</span></a>
</div>

<h1 id="impl-trait"><a class="header" href="#impl-trait">Impl trait</a></h1>
<div class="rule" id="r-type.impl-trait.syntax"><a class="rule-link" href="#r-type.impl-trait.syntax" title="type.impl-trait.syntax"><span>[type<wbr>.impl-trait<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ImplTraitType" onclick="show_railroad()"><a href="#railroad-ImplTraitType">ImplTraitType</a></span> → <span class="grammar-literal">impl</span> <span class="grammar-text"><a href="#grammar-TypeParamBounds">TypeParamBounds</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-ImplTraitTypeOneBound" onclick="show_railroad()"><a href="#railroad-ImplTraitTypeOneBound">ImplTraitTypeOneBound</a></span> → <span class="grammar-literal">impl</span> <span class="grammar-text"><a href="#grammar-TraitBound">TraitBound</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 272px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ImplTraitType"><svg class="railroad" viewbox="0 0 272 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ImplTraitType">
<text class="comment" x="60" y="25">
ImplTraitType</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="35" y="42" />
<text x="61" y="58">
impl</text>
</g>
<a class="link" xlink:href="#railroad-TypeParamBounds">
<g class="nonterminal">
<rect height="22" width="140" x="97" y="42" />
<text x="167" y="58">
TypeParamBounds</text>
</g>
</a>
<path d=" M 87 53 h 10" />
</g>
<path d=" M 247 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 237 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 232px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ImplTraitTypeOneBound"><svg class="railroad" viewbox="0 0 232 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ImplTraitTypeOneBound">
<text class="comment" x="92" y="25">
ImplTraitTypeOneBound</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="35" y="42" />
<text x="61" y="58">
impl</text>
</g>
<a class="link" xlink:href="#railroad-TraitBound">
<g class="nonterminal">
<rect height="22" width="100" x="97" y="42" />
<text x="147" y="58">
TraitBound</text>
</g>
</a>
<path d=" M 87 53 h 10" />
</g>
<path d=" M 207 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 197 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-type.impl-trait.intro"><a class="rule-link" href="#r-type.impl-trait.intro" title="type.impl-trait.intro"><span>[type<wbr>.impl-trait<wbr>.intro]</span></a>
</div>

<p><code>impl Trait</code> 提供了指定实现了特定特型的未命名但具体类型的方法。
它可以出现在两类地方：参数位置（在这里它可以作为函数的匿名泛型参数）和返回位置（在这里它可以作为抽象返回类型）。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Trait {}
<span class="boring">impl Trait for () {}
</span>
// 参数位置：匿名类型参数
fn foo(arg: impl Trait) {
}

// 返回位置：抽象返回类型
fn bar() -&gt; impl Trait {
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.impl-trait.param"><a class="rule-link" href="#r-type.impl-trait.param" title="type.impl-trait.param"><span>[type<wbr>.impl-trait<wbr>.param]</span></a>
</div>

<h2 id="匿名类型参数"><a class="header" href="#匿名类型参数">匿名类型参数</a></h2>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>这通常被称为 “参数位置的 impl Trait” 。（术语 “parameter” 在这里更准确，但 “参数位置的 impl Trait” 是该特性开发期间使用的措辞，并且在实现的某些部分中仍然保留。）</p>
</blockquote>
</div>

<div class="rule" id="r-type.impl-trait.param.intro"><a class="rule-link" href="#r-type.impl-trait.param.intro" title="type.impl-trait.param.intro"><span>[type<wbr>.impl-trait<wbr>.param<wbr>.intro]</span></a>
</div>

<p>函数可以使用 <code>impl</code> 后跟一组特型界限来声明一个具有匿名类型的参数。
调用者必须提供一个满足匿名类型参数所声明的界限的类型，并且函数只能使用通过匿名类型参数的特型界限可用的方法。</p>
<p>例如，这两种形式几乎是等价的：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait Trait {}

// 泛型类型参数
fn with_generic_type&lt;T: Trait&gt;(arg: T) {
}

// 参数位置的 impl Trait
fn with_impl_trait(arg: impl Trait) {
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.impl-trait.param.generic"><a class="rule-link" href="#r-type.impl-trait.param.generic" title="type.impl-trait.param.generic"><span>[type<wbr>.impl-trait<wbr>.param<wbr>.generic]</span></a>
</div>

<p>也就是说，参数位置的 <code>impl Trait</code> 是类似于 <code>&lt;T: Trait&gt;</code> 的泛型类型参数的语法糖，只是该类型是匿名的，并且不会出现在 <a href="#grammar-GenericParams">GenericParams</a> 列表中。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>对于函数参数，泛型类型参数和 <code>impl Trait</code> 并不完全等价。对于像 <code>&lt;T: Trait&gt;</code> 这样的泛型参数，调用者可以选择在调用处使用 <a href="#grammar-GenericArgs">GenericArgs</a> 显式指定 <code>T</code> 的泛型参数，例如 <code>foo::&lt;usize&gt;(1)</code> 。将参数从其中一种形式更改为另一种形式可能会对函数的调用者构成破坏性变更，因为这改变了泛型参数的数量。</p>
</blockquote>
</div>

<div class="rule" id="r-type.impl-trait.return"><a class="rule-link" href="#r-type.impl-trait.return" title="type.impl-trait.return"><span>[type<wbr>.impl-trait<wbr>.return]</span></a>
</div>

<h2 id="抽象返回类型"><a class="header" href="#抽象返回类型">抽象返回类型</a></h2>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>这通常被称为 “返回位置的 impl Trait” 。</p>
</blockquote>
</div>

<div class="rule" id="r-type.impl-trait.return.intro"><a class="rule-link" href="#r-type.impl-trait.return.intro" title="type.impl-trait.return.intro"><span>[type<wbr>.impl-trait<wbr>.return<wbr>.intro]</span></a>
</div>

<p>函数可以使用 <code>impl Trait</code> 来返回一个抽象返回类型。
这些类型代表另一个具体类型，调用者只能使用由指定的 <code>Trait</code> 声明的方法。</p>
<div class="rule" id="r-type.impl-trait.return.constraint-body"><a class="rule-link" href="#r-type.impl-trait.return.constraint-body" title="type.impl-trait.return.constraint-body"><span>[type<wbr>.impl-trait<wbr>.return<wbr>.constraint-body]</span></a>
</div>

<p>函数中每个可能的返回值必须解析为相同的具体类型。</p>
<p>返回位置的 <code>impl Trait</code> 允许函数返回一个非装箱（unboxed）的抽象类型。
这在 <a href="#闭包类型">闭包</a> 和迭代器中特别有用。
例如，闭包具有唯一的、不可写的类型。
以前，从函数返回闭包的唯一方法是使用 <a href="#特型对象">特型对象</a> ：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn returns_closure() -&gt; Box&lt;dyn Fn(i32) -&gt; i32&gt; {
    Box::new(|x| x + 1)
}
<span class="boring">}</span></code></pre>
<p>这可能会因堆分配和动态分派而产生性能损失。
当时无法完全指定闭包的类型，只能使用 <code>Fn</code> 特型。
这意味着特型对象是必需的。
然而，通过 <code>impl Trait</code> ，可以更简单地编写：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn returns_closure() -&gt; impl Fn(i32) -&gt; i32 {
    |x| x + 1
}
<span class="boring">}</span></code></pre>
<p>这也避免了使用装箱特型对象的缺点。</p>
<p>类似地，迭代器的具体类型可能会变得非常复杂，包含链中所有先前迭代器的类型。
返回 <code>impl Iterator</code> 意味着函数只将其返回类型暴露为 <code>Iterator</code> 特型界限，而不是显式指定涉及的所有其他迭代器类型。</p>
<div class="rule" id="r-type.impl-trait.return-in-trait"><a class="rule-link" href="#r-type.impl-trait.return-in-trait" title="type.impl-trait.return-in-trait"><span>[type<wbr>.impl-trait<wbr>.return-in-trait]</span></a>
</div>

<h2 id="特型和特型实现中的返回位置-impl-trait"><a class="header" href="#特型和特型实现中的返回位置-impl-trait">特型和特型实现中的返回位置 <code>impl Trait</code></a></h2>
<div class="rule" id="r-type.impl-trait.return-in-trait.intro"><a class="rule-link" href="#r-type.impl-trait.return-in-trait.intro" title="type.impl-trait.return-in-trait.intro"><span>[type<wbr>.impl-trait<wbr>.return-in-trait<wbr>.intro]</span></a>
</div>

<p>特型中的函数也可以使用 <code>impl Trait</code> 作为匿名关联类型的语法。</p>
<div class="rule" id="r-type.impl-trait.return-in-trait.desugaring"><a class="rule-link" href="#r-type.impl-trait.return-in-trait.desugaring" title="type.impl-trait.return-in-trait.desugaring"><span>[type<wbr>.impl-trait<wbr>.return-in-trait<wbr>.desugaring]</span></a>
</div>

<p>特型中关联函数的返回类型里的每个 <code>impl Trait</code> 都会被脱糖为一个匿名的关联类型。出现在实现函数的签名中的返回类型用于确定该关联类型的值。</p>
<div class="rule" id="r-type.impl-trait.generic-captures"><a class="rule-link" href="#r-type.impl-trait.generic-captures" title="type.impl-trait.generic-captures"><span>[type<wbr>.impl-trait<wbr>.generic-captures]</span></a>
</div>

<h2 id="捕获"><a class="header" href="#捕获">捕获</a></h2>
<p>每个返回位置的 <code>impl Trait</code> 抽象类型背后都有一些隐藏的具体类型。为了让这个具体类型使用泛型参数，该泛型参数必须被抽象类型 <em>捕获</em> 。</p>
<div class="rule" id="r-type.impl-trait.generic-capture.auto"><a class="rule-link" href="#r-type.impl-trait.generic-capture.auto" title="type.impl-trait.generic-capture.auto"><span>[type<wbr>.impl-trait<wbr>.generic-capture<wbr>.auto]</span></a>
</div>

<h2 id="自动捕获"><a class="header" href="#自动捕获">自动捕获</a></h2>
<div class="rule" id="r-type.impl-trait.generic-capture.auto.intro"><a class="rule-link" href="#r-type.impl-trait.generic-capture.auto.intro" title="type.impl-trait.generic-capture.auto.intro"><span>[type<wbr>.impl-trait<wbr>.generic-capture<wbr>.auto<wbr>.intro]</span></a>
</div>

<p>返回位置的 <code>impl Trait</code> 抽象类型会自动捕获所有作用域内的泛型参数，包括泛型类型、常量和生命周期参数（包括高阶参数）。</p>
<div class="rule" id="r-type.impl-trait.generic-capture.edition2024"><a class="rule-link" href="#r-type.impl-trait.generic-capture.edition2024" title="type.impl-trait.generic-capture.edition2024"><span>[type<wbr>.impl-trait<wbr>.generic-capture<wbr>.edition2024]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2024</span> 版次差异</p>

<p>在 2024 版次 之前，在自由函数以及固有实现的关联函数和方法上，未出现在抽象返回类型界限中的泛型生命周期参数不会被自动捕获。</p>
</blockquote>
</div>

<div class="rule" id="r-type.impl-trait.generic-capture.precise"><a class="rule-link" href="#r-type.impl-trait.generic-capture.precise" title="type.impl-trait.generic-capture.precise"><span>[type<wbr>.impl-trait<wbr>.generic-capture<wbr>.precise]</span></a>
</div>

<h2 id="精确捕获"><a class="header" href="#精确捕获">精确捕获</a></h2>
<div class="rule" id="r-type.impl-trait.generic-capture.precise.use"><a class="rule-link" href="#r-type.impl-trait.generic-capture.precise.use" title="type.impl-trait.generic-capture.precise.use"><span>[type<wbr>.impl-trait<wbr>.generic-capture<wbr>.precise<wbr>.use]</span></a>
</div>

<p>由返回位置 <code>impl Trait</code> 抽象类型捕获的泛型参数集合可以通过 <a href="#use-bounds"><code>use&lt;..&gt;</code> 界限</a> 进行显式控制。如果存在，则仅捕获 <code>use&lt;..&gt;</code> 界限中列出的泛型参数。例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn capture&lt;'a, 'b, T&gt;(x: &amp;'a (), y: T) -&gt; impl Sized + use&lt;'a, T&gt; {
  //                                      ~~~~~~~~~~~~~~~~~~~~~~~
  //                                     仅捕获 `'a` 和 `T` 。
  (x, y)
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-type.impl-trait.generic-capture.precise.constraint-single"><a class="rule-link" href="#r-type.impl-trait.generic-capture.precise.constraint-single" title="type.impl-trait.generic-capture.precise.constraint-single"><span>[type<wbr>.impl-trait<wbr>.generic-capture<wbr>.precise<wbr>.constraint-single]</span></a>
</div>

<p>目前，界限列表中只能出现一个 <code>use&lt;..&gt;</code> 界限，必须包含所有作用域内的类型和常量泛型参数，并且必须包含出现在抽象类型其他界限中的所有生命周期参数。</p>
<div class="rule" id="r-type.impl-trait.generic-capture.precise.constraint-lifetime"><a class="rule-link" href="#r-type.impl-trait.generic-capture.precise.constraint-lifetime" title="type.impl-trait.generic-capture.precise.constraint-lifetime"><span>[type<wbr>.impl-trait<wbr>.generic-capture<wbr>.precise<wbr>.constraint-lifetime]</span></a>
</div>

<p>在 <code>use&lt;..&gt;</code> 界限内，任何存在的生命周期参数必须出现在所有类型和常量泛型参数之前，并且如果省略生命周期 (<code>'_</code>) 被允许出现在 <code>impl Trait</code> 返回类型中，则它可以存在。</p>
<div class="rule" id="r-type.impl-trait.generic-capture.precise.constraint-param-impl-trait"><a class="rule-link" href="#r-type.impl-trait.generic-capture.precise.constraint-param-impl-trait" title="type.impl-trait.generic-capture.precise.constraint-param-impl-trait"><span>[type<wbr>.impl-trait<wbr>.generic-capture<wbr>.precise<wbr>.constraint-param-impl-trait]</span></a>
</div>

<p>因为所有作用域内的类型参数都必须按名称包含，所以 <code>use&lt;..&gt;</code> 界限不能用于使用了参数位置 <code>impl Trait</code> 的项的签名中，因为这些项的作用域内有匿名类型参数。</p>
<div class="rule" id="r-type.impl-trait.generic-capture.precise.constraint-in-trait"><a class="rule-link" href="#r-type.impl-trait.generic-capture.precise.constraint-in-trait" title="type.impl-trait.generic-capture.precise.constraint-in-trait"><span>[type<wbr>.impl-trait<wbr>.generic-capture<wbr>.precise<wbr>.constraint-in-trait]</span></a>
</div>

<p>特型定义中关联函数中存在的任何 <code>use&lt;..&gt;</code> 界限必须包含特型的所有泛型参数，包括特型隐式的 <code>Self</code> 泛型类型参数。</p>
<h2 id="泛型和返回位置-impl-trait-之间的区别"><a class="header" href="#泛型和返回位置-impl-trait-之间的区别">泛型和返回位置 <code>impl Trait</code> 之间的区别</a></h2>
<p>在参数位置， <code>impl Trait</code> 在语义上与泛型类型参数非常相似。
然而，两者在返回位置有显著区别。
使用 <code>impl Trait</code> ，与泛型类型参数不同，函数选择返回类型，而调用者不能选择返回类型。</p>
<p>函数：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">trait Trait {}
</span>fn foo&lt;T: Trait&gt;() -&gt; T {
    // ...
<span class="boring">panic!()
</span>}
<span class="boring">}</span></code></pre>
<p>允许调用者确定返回类型 <code>T</code> ，并且函数返回该类型。</p>
<p>函数：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">trait Trait {}
</span><span class="boring">impl Trait for () {}
</span>fn foo() -&gt; impl Trait {
    // ...
}
<span class="boring">}</span></code></pre>
<p>不允许调用者确定返回类型。
相反，函数选择返回类型，但只承诺它将实现 <code>Trait</code> 。</p>
<div class="rule" id="r-type.impl-trait.constraint"><a class="rule-link" href="#r-type.impl-trait.constraint" title="type.impl-trait.constraint"><span>[type<wbr>.impl-trait<wbr>.constraint]</span></a>
</div>

<h2 id="限制-4"><a class="header" href="#限制-4">限制</a></h2>
<p><code>impl Trait</code> 只能作为非 <code>extern</code> 函数的参数或返回类型出现。
它不能作为 <code>let</code> 绑定的类型、字段类型，或出现在类型别名中。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type.generic"><a class="rule-link" href="#r-type.generic" title="type.generic"><span>[type<wbr>.generic]</span></a>
</div>

<h1 id="类型参数"><a class="header" href="#类型参数">类型参数</a></h1>
<p>在具有类型参数声明的 项 的主体内，其类型参数的名称就是类型：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn to_vec&lt;A: Clone&gt;(xs: &amp;[A]) -&gt; Vec&lt;A&gt; {
    if xs.is_empty() {
        return vec![];
    }
    let first: A = xs[0].clone();
    let mut rest: Vec&lt;A&gt; = to_vec(&amp;xs[1..]);
    rest.insert(0, first);
    rest
}
<span class="boring">}</span></code></pre>
<p>这里， <code>first</code> 的类型为 <code>A</code> ，引用了 <code>to_vec</code> 的 <code>A</code> 类型参数；而 <code>rest</code> 的类型为 <code>Vec&lt;A&gt;</code> ，这是一个元素类型为 <code>A</code> 的向量。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-type.inferred"><a class="rule-link" href="#r-type.inferred" title="type.inferred"><span>[type<wbr>.inferred]</span></a>
</div>

<h1 id="推断类型"><a class="header" href="#推断类型">推断类型</a></h1>
<div class="rule" id="r-type.inferred.syntax"><a class="rule-link" href="#r-type.inferred.syntax" title="type.inferred.syntax"><span>[type<wbr>.inferred<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-InferredType" onclick="show_railroad()"><a href="#railroad-InferredType">InferredType</a></span> → <span class="grammar-literal">_</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 114px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-InferredType"><svg class="railroad" viewbox="0 0 114 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-InferredType">
<text class="comment" x="57" y="25">
InferredType</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="42" />
<text x="49" y="58">
_</text>
</g>
<path d=" M 73 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 63 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-type.inferred.intro"><a class="rule-link" href="#r-type.inferred.intro" title="type.inferred.intro"><span>[type<wbr>.inferred<wbr>.intro]</span></a>
</div>

<p>推断类型 要求 编译器 根据可用的周边信息尽可能地推断类型。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>推断类型 常用于 泛型 参数：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x: Vec&lt;_&gt; = (0..10).collect();
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-type.inferred.constraint"><a class="rule-link" href="#r-type.inferred.constraint" title="type.inferred.constraint"><span>[type<wbr>.inferred<wbr>.constraint]</span></a>
</div>

<p>推断类型 不能用于 项 签名。</p>
<!--
  这里还需要说什么？
  我所知的唯一文档是 https://rustc-dev-guide.rust-lang.org/type-inference.html
  应该在某个地方更广泛地讨论 类型推断。
-->
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-dynamic-sized"><a class="rule-link" href="#r-dynamic-sized" title="dynamic-sized"><span>[dynamic-sized]</span></a>
</div>

<h1 id="动态大小类型"><a class="header" href="#动态大小类型">动态大小类型</a></h1>
<div class="rule" id="r-dynamic-sized.intro"><a class="rule-link" href="#r-dynamic-sized.intro" title="dynamic-sized.intro"><span>[dynamic-sized<wbr>.intro]</span></a>
</div>

<p>大多数类型在编译时具有固定的大小，并实现了 <a href="#sized-1"><code>Sized</code></a> 特型。大小仅在运行时已知的类型被称为 <em>动态大小类型</em> (<em>DST</em>) ，或者非正式地称为不定长类型。 <a href="#切片类型">切片</a>、 <a href="#特型对象">特型对象</a> 和 <a href="#文本类型">str</a> 是 <abbr title="dynamically sized types">DST</abbr> 的示例。</p>
<div class="rule" id="r-dynamic-sized.restriction"><a class="rule-link" href="#r-dynamic-sized.restriction" title="dynamic-sized.restriction"><span>[dynamic-sized<wbr>.restriction]</span></a>
</div>

<p>这类类型只能在某些情况下使用：</p>
<div class="rule" id="r-dynamic-sized.pointer-types"><a class="rule-link" href="#r-dynamic-sized.pointer-types" title="dynamic-sized.pointer-types"><span>[dynamic-sized<wbr>.pointer-types]</span></a>
</div>

<ul>
<li>指向 <abbr title="dynamically sized types">DST</abbr> 的 <a href="#指针类型">指针类型</a> 是定长的，但其大小是定长类型指针的两倍
<ul>
<li>指向切片和 <code>str</code> 的指针还存储了元素的数量。</li>
<li>指向特型对象的指针还存储了一个指向 vtable 的指针。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-dynamic-sized.question-sized"><a class="rule-link" href="#r-dynamic-sized.question-sized" title="dynamic-sized.question-sized"><span>[dynamic-sized<wbr>.question-sized]</span></a>
</div>

<ul>
<li><abbr title="dynamically sized types">DST</abbr> 可以作为具有特殊 <code>?Sized</code> 边界的泛型类型参数的类型参数提供。当相应的关联类型声明具有 <code>?Sized</code> 边界时，它们也可以用于关联类型定义。默认情况下，任何类型参数或关联类型都具有 <code>Sized</code> 边界，除非使用 <code>?Sized</code> 将其放宽。</li>
</ul>
<div class="rule" id="r-dynamic-sized.trait-impl"><a class="rule-link" href="#r-dynamic-sized.trait-impl" title="dynamic-sized.trait-impl"><span>[dynamic-sized<wbr>.trait-impl]</span></a>
</div>

<ul>
<li>可以为 <abbr title="dynamically sized types">DST</abbr> 实现特型。与泛型类型参数不同，在特型定义中 <code>Self: ?Sized</code> 是默认的。</li>
</ul>
<div class="rule" id="r-dynamic-sized.struct-field"><a class="rule-link" href="#r-dynamic-sized.struct-field" title="dynamic-sized.struct-field"><span>[dynamic-sized<wbr>.struct-field]</span></a>
</div>

<ul>
<li>结构体可以将 <abbr title="dynamically sized type">DST</abbr> 作为其最后一个字段；这使得结构体本身也成为一个 <abbr title="dynamically sized type">DST</abbr> 。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><a href="#变量">变量</a>、 函数参数、 <a href="#常量项">常量</a> 项 和 <a href="#静态项">静态</a> 项 必须是 <code>Sized</code> 的。</p>
</blockquote>
</div>

<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-layout"><a class="rule-link" href="#r-layout" title="layout"><span>[layout]</span></a>
</div>

<h1 id="类型布局"><a class="header" href="#类型布局">类型布局</a></h1>
<div class="rule" id="r-layout.intro"><a class="rule-link" href="#r-layout.intro" title="layout.intro"><span>[layout<wbr>.intro]</span></a>
</div>

<p>类型的布局是其大小、对齐方式以及其字段的相对偏移量。对于枚举，判别式如何布局和解释也是类型布局的一部分。</p>
<div class="rule" id="r-layout.guarantees"><a class="rule-link" href="#r-layout.guarantees" title="layout.guarantees"><span>[layout<wbr>.guarantees]</span></a>
</div>

<p>类型布局可能会在每次编译时发生变化。我们不打算准确记录具体的操作，而只记录目前所保证的内容。</p>
<p>请注意，即使布局相同的类型在跨函数边界传递的方式上仍可能有所不同。关于类型的函数调用 ABI 兼容性，请参阅 <a href="../core/primitive.fn.html#abi-compatibility">此处</a>。</p>
<div class="rule" id="r-layout.properties"><a class="rule-link" href="#r-layout.properties" title="layout.properties"><span>[layout<wbr>.properties]</span></a>
</div>

<h2 id="大小和对齐"><a class="header" href="#大小和对齐">大小和对齐</a></h2>
<p>所有值都有对齐方式和大小。</p>
<div class="rule" id="r-layout.properties.align"><a class="rule-link" href="#r-layout.properties.align" title="layout.properties.align"><span>[layout<wbr>.properties<wbr>.align]</span></a>
</div>

<p>值的 <em>对齐方式</em> 指明了存储该值时哪些地址是有效的。对齐方式为 <code>n</code> 的值必须存储在 <code>n</code> 的倍数的地址上。例如，对齐方式为 2 的值必须存储在偶数地址上，而对齐方式为 1 的值可以存储在任何地址上。对齐方式以字节为单位，且必须至少为 1，并且始终是 2 的幂。值的对齐方式可以通过 <a href="../core/mem/fn.align_of_val.html"><code>align_of_val</code></a> 函数检查。</p>
<div class="rule" id="r-layout.properties.size"><a class="rule-link" href="#r-layout.properties.size" title="layout.properties.size"><span>[layout<wbr>.properties<wbr>.size]</span></a>
</div>

<p>值的 <em>大小</em> 是具有该 项 类型的数组中连续元素之间的字节偏移量，包括对齐填充。值的大小始终是其对齐方式的倍数。请注意，某些类型是零大小的；0 被认为是任何对齐方式的倍数（例如，在某些平台上，类型 <code>[u16; 0]</code> 的大小为 0，对齐方式为 2）。值的大小可以通过 <a href="../core/mem/fn.size_of_val.html"><code>size_of_val</code></a> 函数检查。</p>
<div class="rule" id="r-layout.properties.sized"><a class="rule-link" href="#r-layout.properties.sized" title="layout.properties.sized"><span>[layout<wbr>.properties<wbr>.sized]</span></a>
</div>

<p>如果某种类型的所有值都具有相同的大小和对齐方式，且两者在编译时都是已知的，则该类型实现了 <a href="../core/marker/trait.Sized.html"><code>Sized</code></a> 特型，并且可以通过 <a href="../core/mem/fn.size_of.html"><code>size_of</code></a> 和 <a href="../core/mem/fn.align_of.html"><code>align_of</code></a> 函数进行检查。不是 <a href="../core/marker/trait.Sized.html"><code>Sized</code></a> 的类型被称为 <a href="#动态大小类型">动态大小类型</a> 。由于 <code>Sized</code> 类型的所有值都共享相同的大小和对齐方式，因此我们分别将这些共享值称为类型的大小和类型的对齐方式。</p>
<div class="rule" id="r-layout.primitive"><a class="rule-link" href="#r-layout.primitive" title="layout.primitive"><span>[layout<wbr>.primitive]</span></a>
</div>

<h2 id="原语数据布局"><a class="header" href="#原语数据布局">原语数据布局</a></h2>
<div class="rule" id="r-layout.primitive.size"><a class="rule-link" href="#r-layout.primitive.size" title="layout.primitive.size"><span>[layout<wbr>.primitive<wbr>.size]</span></a>
</div>

<p>大多数原语的大小如下表所示。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>类型</th><th><code>size_of::&lt;Type&gt;()</code></th></tr>
</thead>
<tbody>
<tr><td><code>bool</code></td><td>1</td></tr>
<tr><td><code>u8</code> / <code>i8</code></td><td>1</td></tr>
<tr><td><code>u16</code> / <code>i16</code></td><td>2</td></tr>
<tr><td><code>u32</code> / <code>i32</code></td><td>4</td></tr>
<tr><td><code>u64</code> / <code>i64</code></td><td>8</td></tr>
<tr><td><code>u128</code> / <code>i128</code></td><td>16</td></tr>
<tr><td><code>usize</code> / <code>isize</code></td><td>见下文</td></tr>
<tr><td><code>f32</code></td><td>4</td></tr>
<tr><td><code>f64</code></td><td>8</td></tr>
<tr><td><code>char</code></td><td>4</td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-layout.primitive.size-int"><a class="rule-link" href="#r-layout.primitive.size-int" title="layout.primitive.size-int"><span>[layout<wbr>.primitive<wbr>.size-int]</span></a>
</div>

<p><code>usize</code> 和 <code>isize</code> 的大小足以包含目标平台上的每个地址。例如，在 32 位目标上，这是 4 字节，而在 64 位目标上，这是 8 字节。</p>
<div class="rule" id="r-layout.primitive.align"><a class="rule-link" href="#r-layout.primitive.align" title="layout.primitive.align"><span>[layout<wbr>.primitive<wbr>.align]</span></a>
</div>

<p>原语的对齐方式取决于平台。
在大多数情况下，它们的对齐方式等于它们的大小，但可能会更小。
特别地，<code>i128</code> 和 <code>u128</code> 通常对齐到 4 或 8 字节，尽管它们的大小是 16；在许多 32 位平台上，<code>i64</code>、 <code>u64</code> 和 <code>f64</code> 仅对齐到 4 字节，而不是 8 字节。</p>
<div class="rule" id="r-layout.pointer"><a class="rule-link" href="#r-layout.pointer" title="layout.pointer"><span>[layout<wbr>.pointer]</span></a>
</div>

<h2 id="指针和引用布局"><a class="header" href="#指针和引用布局">指针和引用布局</a></h2>
<div class="rule" id="r-layout.pointer.intro"><a class="rule-link" href="#r-layout.pointer.intro" title="layout.pointer.intro"><span>[layout<wbr>.pointer<wbr>.intro]</span></a>
</div>

<p>指针和引用具有相同的布局。指针或引用的可变性不会改变布局。</p>
<div class="rule" id="r-layout.pointer.thin"><a class="rule-link" href="#r-layout.pointer.thin" title="layout.pointer.thin"><span>[layout<wbr>.pointer<wbr>.thin]</span></a>
</div>

<p>指向定长类型的指针具有与 <code>usize</code> 相同的大小和对齐方式。</p>
<div class="rule" id="r-layout.pointer.unsized"><a class="rule-link" href="#r-layout.pointer.unsized" title="layout.pointer.unsized"><span>[layout<wbr>.pointer<wbr>.unsized]</span></a>
</div>

<p>指向不定长类型的指针是定长的。其大小和对齐方式保证至少等于指针的大小和对齐方式。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>尽管你不应该依赖这一点，但目前所有指向 <abbr title="Dynamically Sized Types">DST</abbr> 的指针的大小都是 <code>usize</code> 大小的两倍，并且具有相同的对齐方式。</p>
</blockquote>
</div>

<div class="rule" id="r-layout.array"><a class="rule-link" href="#r-layout.array" title="layout.array"><span>[layout<wbr>.array]</span></a>
</div>

<h2 id="数组布局"><a class="header" href="#数组布局">数组布局</a></h2>
<p>数组 <code>[T; N]</code> 的大小为 <code>size_of::&lt;T&gt;() * N</code> ，并且具有与 <code>T</code> 相同的对齐方式。数组的布局使得数组中从零开始的第 <code>n</code> 个元素相对于数组起始位置的偏移量为 <code>n * size_of::&lt;T&gt;()</code> 字节。</p>
<div class="rule" id="r-layout.slice"><a class="rule-link" href="#r-layout.slice" title="layout.slice"><span>[layout<wbr>.slice]</span></a>
</div>

<h2 id="切片布局"><a class="header" href="#切片布局">切片布局</a></h2>
<p>切片与其切取的数组部分具有相同的布局。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>这是关于原始 <code>[T]</code> 类型的，而不是指向切片的指针（ <code>&amp;[T]</code> 、 <code>Box&lt;[T]&gt;</code> 等）。</p>
</blockquote>
</div>

<div class="rule" id="r-layout.str"><a class="rule-link" href="#r-layout.str" title="layout.str"><span>[layout<wbr>.str]</span></a>
</div>

<h2 id="str布局"><a class="header" href="#str布局"><code>str</code>布局</a></h2>
<p>字符串切片是字符的 UTF-8 表示，其布局与 <code>[u8]</code> 类型的切片相同。引用 <code>&amp;str</code> 与引用 <code>&amp;[u8]</code> 具有相同的布局。</p>
<div class="rule" id="r-layout.tuple"><a class="rule-link" href="#r-layout.tuple" title="layout.tuple"><span>[layout<wbr>.tuple]</span></a>
</div>

<h2 id="元组布局"><a class="header" href="#元组布局">元组布局</a></h2>
<div class="rule" id="r-layout.tuple.general"><a class="rule-link" href="#r-layout.tuple.general" title="layout.tuple.general"><span>[layout<wbr>.tuple<wbr>.general]</span></a>
</div>

<p>元组根据 <a href="#rust表示法"><code>Rust</code> 表示法</a> 进行布局。</p>
<div class="rule" id="r-layout.tuple.unit"><a class="rule-link" href="#r-layout.tuple.unit" title="layout.tuple.unit"><span>[layout<wbr>.tuple<wbr>.unit]</span></a>
</div>

<p>此处的例外是单元元组（ <code>()</code> ），它作为零大小类型，保证大小为 0，对齐方式为 1。</p>
<div class="rule" id="r-layout.trait-object"><a class="rule-link" href="#r-layout.trait-object" title="layout.trait-object"><span>[layout<wbr>.trait-object]</span></a>
</div>

<h2 id="特型对象布局"><a class="header" href="#特型对象布局">特型对象布局</a></h2>
<p>特型对象与该特型对象所属的值具有相同的布局。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>这是关于原始特型对象类型的，而不是指向特型对象的指针（ <code>&amp;dyn Trait</code> 、 <code>Box&lt;dyn Trait&gt;</code> 等）。</p>
</blockquote>
</div>

<div class="rule" id="r-layout.closure"><a class="rule-link" href="#r-layout.closure" title="layout.closure"><span>[layout<wbr>.closure]</span></a>
</div>

<h2 id="闭包布局"><a class="header" href="#闭包布局">闭包布局</a></h2>
<p>闭包没有布局保证。</p>
<div class="rule" id="r-layout.repr"><a class="rule-link" href="#r-layout.repr" title="layout.repr"><span>[layout<wbr>.repr]</span></a>
</div>

<h2 id="表示法"><a class="header" href="#表示法">表示法</a></h2>
<div class="rule" id="r-layout.repr.intro"><a class="rule-link" href="#r-layout.repr.intro" title="layout.repr.intro"><span>[layout<wbr>.repr<wbr>.intro]</span></a>
</div>

<p>所有用户定义的复合类型（ 结构体 、 枚举 和 联合体 ）都有一个 <em>表示法</em> ，用于指定该类型的布局。</p>
<div class="rule" id="r-layout.repr.kinds"><a class="rule-link" href="#r-layout.repr.kinds" title="layout.repr.kinds"><span>[layout<wbr>.repr<wbr>.kinds]</span></a>
</div>

<p>类型可能的表示法有：</p>
<ul>
<li><a href="#rust表示法"><code>Rust</code></a> （默认）</li>
<li><a href="#c表示法"><code>C</code></a></li>
<li><a href="#原语表示法">原语表示法</a></li>
<li><a href="#transparent表示法"><code>transparent</code></a></li>
</ul>
<div class="rule" id="r-layout.repr.attribute"><a class="rule-link" href="#r-layout.repr.attribute" title="layout.repr.attribute"><span>[layout<wbr>.repr<wbr>.attribute]</span></a>
</div>

<p>可以通过对其应用 <code>repr</code> 属性来更改类型的表示法。以下示例显示了一个具有 <code>C</code> 表示法的结构体。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[repr(C)]
struct ThreeInts {
    first: i16,
    second: i8,
    third: i32
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-layout.repr.align-packed"><a class="rule-link" href="#r-layout.repr.align-packed" title="layout.repr.align-packed"><span>[layout<wbr>.repr<wbr>.align-packed]</span></a>
</div>

<p>可以使用 <code>align</code> 和 <code>packed</code> 修饰符分别提高或降低对齐方式。它们会修改属性中指定的表示法。如果没有指定表示法，则修改默认表示法。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 默认表示法，对齐方式降至 2。
#[repr(packed(2))]
struct PackedStruct {
    first: i16,
    second: i8,
    third: i32
}

// C 表示法，对齐方式升至 8
#[repr(C, align(8))]
struct AlignedStruct {
    first: i16,
    second: i8,
    third: i32
}
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>由于表示法是 项 上的属性，因此表示法不依赖于泛型参数。具有相同名称的任何两个类型都具有相同的表示法。例如，<code>Foo&lt;Bar&gt;</code> 和 <code>Foo&lt;Baz&gt;</code> 都具有相同的表示法。</p>
</blockquote>
</div>

<div class="rule" id="r-layout.repr.inter-field"><a class="rule-link" href="#r-layout.repr.inter-field" title="layout.repr.inter-field"><span>[layout<wbr>.repr<wbr>.inter-field]</span></a>
</div>

<p>类型的表示法可以改变字段之间的填充，但不会改变字段本身的布局。例如，一个具有 <code>C</code> 表示法且包含具有 <code>Rust</code> 表示法的结构体 <code>Inner</code> 的结构体，其内部 <code>Inner</code> 的布局不会改变。</p>
<p><a id="the-default-representation"></a></p>
<div class="rule" id="r-layout.repr.rust"><a class="rule-link" href="#r-layout.repr.rust" title="layout.repr.rust"><span>[layout<wbr>.repr<wbr>.rust]</span></a>
</div>

<h3 id="rust表示法"><a class="header" href="#rust表示法"><code>Rust</code>表示法</a></h3>
<div class="rule" id="r-layout.repr.rust.intro"><a class="rule-link" href="#r-layout.repr.rust.intro" title="layout.repr.rust.intro"><span>[layout<wbr>.repr<wbr>.rust<wbr>.intro]</span></a>
</div>

<p><code>Rust</code> 表示法是没有 <code>repr</code> 属性的标称类型的默认表示法。通过 <code>repr</code> 属性显式使用此表示法与完全省略该属性的效果保证相同。</p>
<div class="rule" id="r-layout.repr.rust.layout"><a class="rule-link" href="#r-layout.repr.rust.layout" title="layout.repr.rust.layout"><span>[layout<wbr>.repr<wbr>.rust<wbr>.layout]</span></a>
</div>

<p>此表示法做出的唯一数据布局保证是那些为了健全性所必需的。它们是：</p>
<ol>
<li>字段正确对齐。</li>
<li>字段不重叠。</li>
<li>类型的对齐方式至少是其字段的最大对齐方式。</li>
</ol>
<div class="rule" id="r-layout.repr.rust.alignment"><a class="rule-link" href="#r-layout.repr.rust.alignment" title="layout.repr.rust.alignment"><span>[layout<wbr>.repr<wbr>.rust<wbr>.alignment]</span></a>
</div>

<p>正式地说，第一个保证意味着任何字段的偏移量都可以被该字段的对齐方式整除。</p>
<div class="rule" id="r-layout.repr.rust.field-storage"><a class="rule-link" href="#r-layout.repr.rust.field-storage" title="layout.repr.rust.field-storage"><span>[layout<wbr>.repr<wbr>.rust<wbr>.field-storage]</span></a>
</div>

<p>第二个保证意味着字段可以按序排列，使得任何字段的偏移量加上大小小于或等于排序中下一个字段的偏移量。该顺序不必与类型声明中指定字段的顺序相同。</p>
<p>请注意，第二个保证并不意味着字段具有不同的地址：零大小类型可能与同一结构体中的其他字段具有相同的地址。</p>
<div class="rule" id="r-layout.repr.rust.unspecified"><a class="rule-link" href="#r-layout.repr.rust.unspecified" title="layout.repr.rust.unspecified"><span>[layout<wbr>.repr<wbr>.rust<wbr>.unspecified]</span></a>
</div>

<p>此表示法没有做出其他数据布局保证。</p>
<div class="rule" id="r-layout.repr.c"><a class="rule-link" href="#r-layout.repr.c" title="layout.repr.c"><span>[layout<wbr>.repr<wbr>.c]</span></a>
</div>

<h3 id="c表示法"><a class="header" href="#c表示法"><code>C</code>表示法</a></h3>
<div class="rule" id="r-layout.repr.c.intro"><a class="rule-link" href="#r-layout.repr.c.intro" title="layout.repr.c.intro"><span>[layout<wbr>.repr<wbr>.c<wbr>.intro]</span></a>
</div>

<p><code>C</code> 表示法是为双重目的而设计的。一个目的是创建可与 C 语言互操作的类型。第二个目的是创建可以安全地执行依赖于数据布局的操作的类型，例如将值重新解释为不同的类型。</p>
<p>由于这种双重目的，可能会创建一些对于与 C 编程语言交互没有用处的类型。</p>
<div class="rule" id="r-layout.repr.c.constraint"><a class="rule-link" href="#r-layout.repr.c.constraint" title="layout.repr.c.constraint"><span>[layout<wbr>.repr<wbr>.c<wbr>.constraint]</span></a>
</div>

<p>此表示法可以应用于结构体、联合体和枚举。例外是 <a href="#zero-variant-enums">零变体枚举</a> ，对其使用 <code>C</code> 表示法会导致错误。</p>
<div class="rule" id="r-layout.repr.c.struct"><a class="rule-link" href="#r-layout.repr.c.struct" title="layout.repr.c.struct"><span>[layout<wbr>.repr<wbr>.c<wbr>.struct]</span></a>
</div>

<h4 id="reprc结构体"><a class="header" href="#reprc结构体"><code>#[repr(C)]</code>结构体</a></h4>
<div class="rule" id="r-layout.repr.c.struct.align"><a class="rule-link" href="#r-layout.repr.c.struct.align" title="layout.repr.c.struct.align"><span>[layout<wbr>.repr<wbr>.c<wbr>.struct<wbr>.align]</span></a>
</div>

<p>结构体的对齐方式是其中对齐程度最高的字段的对齐方式。</p>
<div class="rule" id="r-layout.repr.c.struct.size-field-offset"><a class="rule-link" href="#r-layout.repr.c.struct.size-field-offset" title="layout.repr.c.struct.size-field-offset"><span>[layout<wbr>.repr<wbr>.c<wbr>.struct<wbr>.size-field-offset]</span></a>
</div>

<p>字段的大小和偏移量由以下算法确定。</p>
<p>从 0 字节的当前偏移量开始。</p>
<p>对于结构体中按声明顺序排列的每个字段，首先确定该字段的大小和对齐方式。如果当前偏移量不是该字段对齐方式的倍数，则在当前偏移量中添加填充字节，直到它是该字段对齐方式的倍数。该字段的偏移量就是当前的偏移量。然后将当前偏移量增加该字段的大小。</p>
<p>最后，结构体的大小是当前偏移量向上舍入到结构体对齐方式的最近倍数。</p>
<p>这是用伪代码描述的该算法。</p>
<!-- ignore: pseudocode -->
<pre><code class="language-rust ignore">/// 返回在 `offset` 之后需要的填充量，以确保后续地址将对齐到 `alignment`。
fn padding_needed_for(offset: usize, alignment: usize) -&gt; usize {
    let misalignment = offset % alignment;
    if misalignment &gt; 0 {
        // 向上舍入到 `alignment` 的下一个倍数
        alignment - misalignment
    } else {
        // 已经是 `alignment` 的倍数
        0
    }
}

struct.alignment = struct.fields().map(|field| field.alignment).max();

let current_offset = 0;

for field in struct.fields_in_declaration_order() {
    // 增加当前偏移量，使其成为该字段对齐方式的倍数。
    // 对于第一个字段，这始终为零。
    // 跳过的字节被称为填充字节。
    current_offset += padding_needed_for(current_offset, field.alignment);

    struct[field].offset = current_offset;

    current_offset += field.size;
}

struct.size = current_offset + padding_needed_for(current_offset, struct.alignment);</code></pre>
<div class="alert alert-warning">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>警告</p>

<p>为了清晰起见，此伪代码使用了一种忽略溢出问题的朴素算法。要在实际代码中执行内存布局计算，请使用 <a href="../core/alloc/layout/struct.Layout.html"><code>Layout</code></a> 。</p>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>此算法可以生成零大小的结构体。在 C 语言中，像 <code>struct Foo { }</code> 这样的空结构体声明是非法的。然而，gcc 和 clang 都支持启用此类结构体的选项，并将其大小指定为零。相比之下，C++ 给空结构体的大小为 1，除非它们是被继承的，或者是具有 <code>[[no_unique_address]]</code> 属性的字段，在这种情况下它们不会增加结构体的总体大小。</p>
</blockquote>
</div>

<div class="rule" id="r-layout.repr.c.union"><a class="rule-link" href="#r-layout.repr.c.union" title="layout.repr.c.union"><span>[layout<wbr>.repr<wbr>.c<wbr>.union]</span></a>
</div>

<h4 id="reprc联合体"><a class="header" href="#reprc联合体"><code>#[repr(C)]</code>联合体</a></h4>
<div class="rule" id="r-layout.repr.c.union.intro"><a class="rule-link" href="#r-layout.repr.c.union.intro" title="layout.repr.c.union.intro"><span>[layout<wbr>.repr<wbr>.c<wbr>.union<wbr>.intro]</span></a>
</div>

<p>使用 <code>#[repr(C)]</code> 声明的联合体将具有与目标平台 C 语言中等效的 C 联合体声明相同的大小和对齐方式。</p>
<div class="rule" id="r-layout.repr.c.union.size-align"><a class="rule-link" href="#r-layout.repr.c.union.size-align" title="layout.repr.c.union.size-align"><span>[layout<wbr>.repr<wbr>.c<wbr>.union<wbr>.size-align]</span></a>
</div>

<p>联合体的大小为其所有字段的最大大小向上舍入到其对齐方式的结果，其对齐方式为其所有字段的最大对齐方式。这些最大值可能来自不同的字段。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[repr(C)]
union Union {
    f1: u16,
    f2: [u8; 4],
}

assert_eq!(std::mem::size_of::&lt;Union&gt;(), 4);  // 来自 f2
assert_eq!(std::mem::align_of::&lt;Union&gt;(), 2); // 来自 f1

#[repr(C)]
union SizeRoundedUp {
   a: u32,
   b: [u16; 3],
}

assert_eq!(std::mem::size_of::&lt;SizeRoundedUp&gt;(), 8);  // 来自 b 的大小为 6，
                                                      // 根据 a 的对齐方式
                                                      // 向上舍入为 8。
assert_eq!(std::mem::align_of::&lt;SizeRoundedUp&gt;(), 4); // 来自 a
<span class="boring">}</span></code></pre>
<div class="rule" id="r-layout.repr.c.enum"><a class="rule-link" href="#r-layout.repr.c.enum" title="layout.repr.c.enum"><span>[layout<wbr>.repr<wbr>.c<wbr>.enum]</span></a>
</div>

<h4 id="reprc无字段枚举"><a class="header" href="#reprc无字段枚举"><code>#[repr(C)]</code>无字段枚举</a></h4>
<p>对于 <a href="#field-less-enum">无字段枚举</a> ， <code>C</code> 表示法具有目标平台 C ABI 的默认 <code>enum</code> 大小和对齐方式。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>C 中的枚举表示法是实现定义的，所以这实际上是一个“最佳猜测”。特别地，当感兴趣的 C 代码使用某些标志编译时，这可能是不正确的。</p>
</blockquote>
</div>

<div class="alert alert-warning">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>警告</p>

<p>C 语言中的 <code>enum</code> 与使用此表示法的 Rust <a href="#field-less-enum">无字段枚举</a> 之间存在关键区别。C 中的 <code>enum</code> 大多是一个 <code>typedef</code> 加上一些命名常量；换句话说， <code>enum</code> 类型的一个对象可以持有任何整数值。例如，在 <code>C</code> 中这常用于位标志。相比之下，Rust 的 <a href="#field-less-enum">无字段枚举</a> 只能合法地持有判别式的值，其他任何值都是 <a href="#被视为未定义的行为">未定义行为</a> 。因此，在 FFI 中使用无字段枚举来建模 C 的 <code>enum</code> 通常是错误的。</p>
</blockquote>
</div>

<div class="rule" id="r-layout.repr.c.adt"><a class="rule-link" href="#r-layout.repr.c.adt" title="layout.repr.c.adt"><span>[layout<wbr>.repr<wbr>.c<wbr>.adt]</span></a>
</div>

<h4 id="reprc带字段枚举"><a class="header" href="#reprc带字段枚举"><code>#[repr(C)]</code>带字段枚举</a></h4>
<p>带字段的 <code>repr(C)</code> 枚举的表示法是具有两个字段的 <code>repr(C)</code> 结构体，在 C 中也称为“标签联合”：</p>
<div class="rule" id="r-layout.repr.c.adt.tag"><a class="rule-link" href="#r-layout.repr.c.adt.tag" title="layout.repr.c.adt.tag"><span>[layout<wbr>.repr<wbr>.c<wbr>.adt<wbr>.tag]</span></a>
</div>

<ul>
<li>删除所有字段的枚举的 <code>repr(C)</code> 版本（“标签”）</li>
</ul>
<div class="rule" id="r-layout.repr.c.adt.fields"><a class="rule-link" href="#r-layout.repr.c.adt.fields" title="layout.repr.c.adt.fields"><span>[layout<wbr>.repr<wbr>.c<wbr>.adt<wbr>.fields]</span></a>
</div>

<ul>
<li>每个具有字段的变体的字段对应的 <code>repr(C)</code> 结构体的 <code>repr(C)</code> 联合体（“有效负载”）</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>由于 <code>repr(C)</code> 结构体和联合体的表示方式，如果一个变体只有一个字段，直接将该字段放入联合体或将其包装在结构体中没有区别；因此，任何希望操作此类 <code>enum</code> 表示法的系统都可以使用对他们来说更方便或更一致的形式。</p>
</blockquote>
</div>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 此 Enum 与 ... 具有相同的表示法
#[repr(C)]
enum MyEnum {
    A(u32),
    B(f32, u64),
    C { x: u32, y: u8 },
    D,
 }

// ... 此结构体。
#[repr(C)]
struct MyEnumRepr {
    tag: MyEnumDiscriminant,
    payload: MyEnumFields,
}

// 这是判别式枚举。
#[repr(C)]
enum MyEnumDiscriminant { A, B, C, D }

// 这是变体联合体。
#[repr(C)]
union MyEnumFields {
    A: MyAFields,
    B: MyBFields,
    C: MyCFields,
    D: MyDFields,
}

#[repr(C)]
#[derive(Copy, Clone)]
struct MyAFields(u32);

#[repr(C)]
#[derive(Copy, Clone)]
struct MyBFields(f32, u64);

#[repr(C)]
#[derive(Copy, Clone)]
struct MyCFields { x: u32, y: u8 }

// 此结构体可以省略（它是一个零大小类型），并且它必须存在于
// C/C++ 头文件中。
#[repr(C)]
#[derive(Copy, Clone)]
struct MyDFields;
<span class="boring">}</span></code></pre>
<div class="rule" id="r-layout.repr.primitive"><a class="rule-link" href="#r-layout.repr.primitive" title="layout.repr.primitive"><span>[layout<wbr>.repr<wbr>.primitive]</span></a>
</div>

<h3 id="原语表示法"><a class="header" href="#原语表示法">原语表示法</a></h3>
<div class="rule" id="r-layout.repr.primitive.intro"><a class="rule-link" href="#r-layout.repr.primitive.intro" title="layout.repr.primitive.intro"><span>[layout<wbr>.repr<wbr>.primitive<wbr>.intro]</span></a>
</div>

<p><em>原语表示法</em> 是与原语整数类型同名的表示法。即： <code>u8</code> 、 <code>u16</code> 、 <code>u32</code> 、 <code>u64</code> 、 <code>u128</code> 、 <code>usize</code> 、 <code>i8</code> 、 <code>i16</code> 、 <code>i32</code> 、 <code>i64</code> 、 <code>i128</code> 和 <code>isize</code> 。</p>
<div class="rule" id="r-layout.repr.primitive.constraint"><a class="rule-link" href="#r-layout.repr.primitive.constraint" title="layout.repr.primitive.constraint"><span>[layout<wbr>.repr<wbr>.primitive<wbr>.constraint]</span></a>
</div>

<p>原语表示法只能应用于枚举，并且根据枚举是否有字段而具有不同的行为。对于 <a href="#zero-variant-enums">零变体枚举</a> ，使用原语表示法是错误的。将两个原语表示法结合在一起是错误的。</p>
<div class="rule" id="r-layout.repr.primitive.enum"><a class="rule-link" href="#r-layout.repr.primitive.enum" title="layout.repr.primitive.enum"><span>[layout<wbr>.repr<wbr>.primitive<wbr>.enum]</span></a>
</div>

<h4 id="无字段枚举的原语表示法"><a class="header" href="#无字段枚举的原语表示法">无字段枚举的原语表示法</a></h4>
<p>对于 <a href="#field-less-enum">无字段枚举</a> ，原语表示法将大小和对齐方式设置为与同名原语类型相同。例如，具有 <code>u8</code> 表示法的无字段枚举只能具有 0 到 255（含）之间的判别式。</p>
<div class="rule" id="r-layout.repr.primitive.adt"><a class="rule-link" href="#r-layout.repr.primitive.adt" title="layout.repr.primitive.adt"><span>[layout<wbr>.repr<wbr>.primitive<wbr>.adt]</span></a>
</div>

<h4 id="带字段枚举的原语表示法"><a class="header" href="#带字段枚举的原语表示法">带字段枚举的原语表示法</a></h4>
<p>原语表示法枚举的表示法是每个带字段变体的 <code>repr(C)</code> 结构体的 <code>repr(C)</code> 联合体。联合体中每个结构体的第一个字段是删除所有字段的枚举的原语表示法版本（“标签”），其余字段是该变体的字段。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>如果标签在联合体中被赋予了自己的成员，这种表示法不会改变，只要这能让你的操作更清晰（尽管为了遵循 C++ 标准，标签成员应该包装在一个 <code>struct</code> 中）。</p>
</blockquote>
</div>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 此 enum 与 ... 具有相同的表示法
#[repr(u8)]
enum MyEnum {
    A(u32),
    B(f32, u64),
    C { x: u32, y: u8 },
    D,
 }

// ... 此联合体。
#[repr(C)]
union MyEnumRepr {
    A: MyVariantA,
    B: MyVariantB,
    C: MyVariantC,
    D: MyVariantD,
}

// 这是判别式枚举。
#[repr(u8)]
#[derive(Copy, Clone)]
enum MyEnumDiscriminant { A, B, C, D }

#[repr(C)]
#[derive(Clone, Copy)]
struct MyVariantA(MyEnumDiscriminant, u32);

#[repr(C)]
#[derive(Clone, Copy)]
struct MyVariantB(MyEnumDiscriminant, f32, u64);

#[repr(C)]
#[derive(Clone, Copy)]
struct MyVariantC { tag: MyEnumDiscriminant, x: u32, y: u8 }

#[repr(C)]
#[derive(Clone, Copy)]
struct MyVariantD(MyEnumDiscriminant);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-layout.repr.primitive-c"><a class="rule-link" href="#r-layout.repr.primitive-c" title="layout.repr.primitive-c"><span>[layout<wbr>.repr<wbr>.primitive-c]</span></a>
</div>

<h4 id="将带字段枚举的原语表示法与reprc结合"><a class="header" href="#将带字段枚举的原语表示法与reprc结合">将带字段枚举的原语表示法与<code>#[repr(C)]</code>结合</a></h4>
<p>对于带字段的枚举，也可以将 <code>repr(C)</code> 和原语表示法结合使用（例如 <code>repr(C, u8)</code> ）。这会通过将判别式枚举的表示法更改为所选原语来修改 <a href="#reprc-enums-with-fields"><code>repr(C)</code></a> 。因此，如果你选择了 <code>u8</code> 表示法，则判别式枚举的大小和对齐方式将为 1 字节。</p>
<p><a href="#reprc-enums-with-fields">前面</a> 示例中的判别式枚举随后变为：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[repr(C, u8)] // 添加了 `u8`
enum MyEnum {
    A(u32),
    B(f32, u64),
    C { x: u32, y: u8 },
    D,
 }

// ...

#[repr(u8)] // 所以这里使用 `u8` 代替 `C`
enum MyEnumDiscriminant { A, B, C, D }

// ...
<span class="boring">}</span></code></pre>
<p>例如，对于 <code>repr(C, u8)</code> 枚举，不可能有 257 个唯一的判别式（“标签”），而仅具有 <code>repr(C)</code> 属性的相同枚举编译时不会有任何问题。</p>
<p>除了 <code>repr(C)</code> 之外，使用原语表示法还可以改变枚举的大小（相对于 <code>repr(C)</code> 形式）：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[repr(C)]
enum EnumC {
    Variant0(u8),
    Variant1,
}

#[repr(C, u8)]
enum Enum8 {
    Variant0(u8),
    Variant1,
}

#[repr(C, u16)]
enum Enum16 {
    Variant0(u8),
    Variant1,
}

// C 表示法的大小取决于平台
assert_eq!(std::mem::size_of::&lt;EnumC&gt;(), 8);
// 在 Enum8::Variant0 中，判别式占一个字节，值占一个字节
assert_eq!(std::mem::size_of::&lt;Enum8&gt;(), 2);
// 在 Enum16::Variant0 中，判别式占两个字节，值占一个字节，
// 加上一个字节的填充。
assert_eq!(std::mem::size_of::&lt;Enum16&gt;(), 4);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-layout.repr.alignment"><a class="rule-link" href="#r-layout.repr.alignment" title="layout.repr.alignment"><span>[layout<wbr>.repr<wbr>.alignment]</span></a>
</div>

<h3 id="对齐修饰符"><a class="header" href="#对齐修饰符">对齐修饰符</a></h3>
<div class="rule" id="r-layout.repr.alignment.intro"><a class="rule-link" href="#r-layout.repr.alignment.intro" title="layout.repr.alignment.intro"><span>[layout<wbr>.repr<wbr>.alignment<wbr>.intro]</span></a>
</div>

<p><code>align</code> 和 <code>packed</code> 修饰符可以分别用于提高或降低 结构体 和 联合体 的对齐方式。 <code>packed</code> 还可以改变字段之间的填充（尽管它不会改变任何字段内部的填充）。 <code>align</code> 和 <code>packed</code> 本身不提供有关结构体布局或枚举变体布局中字段顺序的保证，尽管它们可以与确实提供此类保证的表示法（如 <code>C</code> ）结合使用。</p>
<div class="rule" id="r-layout.repr.alignment.constraint-alignment"><a class="rule-link" href="#r-layout.repr.alignment.constraint-alignment" title="layout.repr.alignment.constraint-alignment"><span>[layout<wbr>.repr<wbr>.alignment<wbr>.constraint-alignment]</span></a>
</div>

<p>对齐方式被指定为一个整数参数，形式为 <code>#[repr(align(x))]</code> 或 <code>#[repr(packed(x))]</code> 。对齐值必须是 1 到 2<sup>29</sup> 之间的 2 的幂。对于 <code>packed</code> ，如果没有给出值，如 <code>#[repr(packed)]</code> ，则值为 1。</p>
<div class="rule" id="r-layout.repr.alignment.align"><a class="rule-link" href="#r-layout.repr.alignment.align" title="layout.repr.alignment.align"><span>[layout<wbr>.repr<wbr>.alignment<wbr>.align]</span></a>
</div>

<p>对于 <code>align</code> ，如果指定的对齐方式小于没有 <code>align</code> 修饰符的类型的对齐方式，则对齐方式不受影响。</p>
<div class="rule" id="r-layout.repr.alignment.packed"><a class="rule-link" href="#r-layout.repr.alignment.packed" title="layout.repr.alignment.packed"><span>[layout<wbr>.repr<wbr>.alignment<wbr>.packed]</span></a>
</div>

<p>对于 <code>packed</code> ，如果指定的对齐方式大于没有 <code>packed</code> 修饰符的类型的对齐方式，则对齐方式和布局不受影响。</p>
<div class="rule" id="r-layout.repr.alignment.packed-fields"><a class="rule-link" href="#r-layout.repr.alignment.packed-fields" title="layout.repr.alignment.packed-fields"><span>[layout<wbr>.repr<wbr>.alignment<wbr>.packed-fields]</span></a>
</div>

<p>为了定位字段，每个字段的对齐方式是指定对齐方式和该字段类型对齐方式中的较小者。</p>
<div class="rule" id="r-layout.repr.alignment.packed-padding"><a class="rule-link" href="#r-layout.repr.alignment.packed-padding" title="layout.repr.alignment.packed-padding"><span>[layout<wbr>.repr<wbr>.alignment<wbr>.packed-padding]</span></a>
</div>

<p>字段间填充保证是满足每个字段（可能已改变的）对齐方式所需的最小值（尽管请注意， <code>packed</code> 本身不提供有关字段排序的任何保证）。这些规则的一个重要结果是，具有 <code>#[repr(packed(1))]</code> （或 <code>#[repr(packed)]</code> ）的类型将没有字段间填充。</p>
<div class="rule" id="r-layout.repr.alignment.constraint-exclusive"><a class="rule-link" href="#r-layout.repr.alignment.constraint-exclusive" title="layout.repr.alignment.constraint-exclusive"><span>[layout<wbr>.repr<wbr>.alignment<wbr>.constraint-exclusive]</span></a>
</div>

<p><code>align</code> 和 <code>packed</code> 修饰符不能应用于同一类型，并且 <code>packed</code> 类型不能传递性地包含另一个 <code>align</code> 过的类型。 <code>align</code> 和 <code>packed</code> 只能应用于 <a href="#rust表示法"><code>Rust</code></a> 和 <a href="#c表示法"><code>C</code></a> 表示法。</p>
<div class="rule" id="r-layout.repr.alignment.enum"><a class="rule-link" href="#r-layout.repr.alignment.enum" title="layout.repr.alignment.enum"><span>[layout<wbr>.repr<wbr>.alignment<wbr>.enum]</span></a>
</div>

<p><code>align</code> 修饰符也可以应用于 <code>enum</code> 。
应用时，对 <code>enum</code> 对齐方式的影响与该 <code>enum</code> 被包装在具有相同 <code>align</code> 修饰符的新类型 <code>struct</code> 中相同。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>不允许对非对齐字段进行引用，因为这是 <a href="#被视为未定义的行为">未定义行为</a> 。当字段由于对齐修饰符而非对齐时，请考虑使用以下选项来进行引用和解引用：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[repr(packed)]
struct Packed {
    f1: u8,
    f2: u16,
}
let mut e = Packed { f1: 1, f2: 2 };
// 不要创建对字段的引用，而是将值复制到局部变量中。
let x = e.f2;
// 或者在像 `println!` 这样创建引用的情况下，使用大括号将其更改为值的副本。
println!("{}", {e.f2});
// 或者如果你需要一个指针，使用用于读取和写入的非对齐方法，
// 而不是直接解构指针。
let ptr: *const u16 = &amp;raw const e.f2;
let value = unsafe { ptr.read_unaligned() };
let mut_ptr: *mut u16 = &amp;raw mut e.f2;
unsafe { mut_ptr.write_unaligned(3) }
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-layout.repr.transparent"><a class="rule-link" href="#r-layout.repr.transparent" title="layout.repr.transparent"><span>[layout<wbr>.repr<wbr>.transparent]</span></a>
</div>

<h3 id="transparent表示法"><a class="header" href="#transparent表示法"><code>transparent</code>表示法</a></h3>
<div class="rule" id="r-layout.repr.transparent.constraint-field"><a class="rule-link" href="#r-layout.repr.transparent.constraint-field" title="layout.repr.transparent.constraint-field"><span>[layout<wbr>.repr<wbr>.transparent<wbr>.constraint-field]</span></a>
</div>

<p><code>transparent</code> 表示法只能用于 <a href="#结构体">结构体</a> 或具有单个变体的 <a href="#枚举">枚举</a> ，该变体具有：</p>
<ul>
<li>任意数量的大小为 0 且对齐方式为 1 的字段（例如 <a href="#phantomdatat"><code>PhantomData&lt;T&gt;</code></a> ），以及</li>
<li>至多一个其他字段。</li>
</ul>
<div class="rule" id="r-layout.repr.transparent.layout-abi"><a class="rule-link" href="#r-layout.repr.transparent.layout-abi" title="layout.repr.transparent.layout-abi"><span>[layout<wbr>.repr<wbr>.transparent<wbr>.layout-abi]</span></a>
</div>

<p>具有此表示法的结构体和枚举具有与唯一的非大小 0 非对齐 1 字段（如果存在）相同的布局和 ABI，否则为单元布局。</p>
<p>这与 <code>C</code> 表示法不同，因为具有 <code>C</code> 表示法的结构体始终具有 <code>C</code> <code>struct</code> 的 ABI，而具有 <code>transparent</code> 表示法且具有原语字段的结构体将具有该原语字段的 ABI。</p>
<div class="rule" id="r-layout.repr.transparent.constraint-exclusive"><a class="rule-link" href="#r-layout.repr.transparent.constraint-exclusive" title="layout.repr.transparent.constraint-exclusive"><span>[layout<wbr>.repr<wbr>.transparent<wbr>.constraint-exclusive]</span></a>
</div>

<p>由于这种表示法将类型布局委托给另一种类型，因此它不能与任何其他表示法一起使用。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-interior-mut"><a class="rule-link" href="#r-interior-mut" title="interior-mut"><span>[interior-mut]</span></a>
</div>

<h1 id="内部可变性"><a class="header" href="#内部可变性">内部可变性</a></h1>
<div class="rule" id="r-interior-mut.intro"><a class="rule-link" href="#r-interior-mut.intro" title="interior-mut.intro"><span>[interior-mut<wbr>.intro]</span></a>
</div>

<p>有时一个类型在拥有多个别名时需要被修改。在 Rust 中，这是通过一种被称为 <em>内部可变性</em> 的模式实现的。</p>
<div class="rule" id="r-interior-mut.shared-ref"><a class="rule-link" href="#r-interior-mut.shared-ref" title="interior-mut.shared-ref"><span>[interior-mut<wbr>.shared-ref]</span></a>
</div>

<p>如果一个类型的内部状态可以通过指向它的 <a href="#shared-references-">共享引用</a> 来改变，那么该类型就具有内部可变性。</p>
<div class="rule" id="r-interior-mut.no-constraint"><a class="rule-link" href="#r-interior-mut.no-constraint" title="interior-mut.no-constraint"><span>[interior-mut<wbr>.no-constraint]</span></a>
</div>

<p>这违背了通常的 <a href="#被视为未定义的行为">要求</a> ，即共享引用指向的值不能被修改。</p>
<div class="rule" id="r-interior-mut.unsafe-cell"><a class="rule-link" href="#r-interior-mut.unsafe-cell" title="interior-mut.unsafe-cell"><span>[interior-mut<wbr>.unsafe-cell]</span></a>
</div>

<p><a href="../core/cell/struct.UnsafeCell.html"><code>std::cell::UnsafeCell&lt;T&gt;</code></a> 类型是唯一允许禁用此要求的方式。当 <code>UnsafeCell&lt;T&gt;</code> 被不可变地起别名时，修改它包含的 <code>T</code> ，或者获取它的一个可变引用，仍然是安全的。</p>
<div class="rule" id="r-interior-mut.mut-unsafe-cell"><a class="rule-link" href="#r-interior-mut.mut-unsafe-cell" title="interior-mut.mut-unsafe-cell"><span>[interior-mut<wbr>.mut-unsafe-cell]</span></a>
</div>

<p>与所有其他类型一样，拥有多个 <code>&amp;mut UnsafeCell&lt;T&gt;</code> 别名是未定义行为。</p>
<div class="rule" id="r-interior-mut.abstraction"><a class="rule-link" href="#r-interior-mut.abstraction" title="interior-mut.abstraction"><span>[interior-mut<wbr>.abstraction]</span></a>
</div>

<p>其他具有内部可变性的类型可以通过使用 <code>UnsafeCell&lt;T&gt;</code> 作为字段来创建。标准库提供了多种提供安全内部可变性 API 的类型。</p>
<div class="rule" id="r-interior-mut.ref-cell"><a class="rule-link" href="#r-interior-mut.ref-cell" title="interior-mut.ref-cell"><span>[interior-mut<wbr>.ref-cell]</span></a>
</div>

<p>例如， <a href="../core/cell/struct.RefCell.html"><code>std::cell::RefCell&lt;T&gt;</code></a> 使用运行时借用检查来确保围绕多个引用的通常规则。</p>
<div class="rule" id="r-interior-mut.atomic"><a class="rule-link" href="#r-interior-mut.atomic" title="interior-mut.atomic"><span>[interior-mut<wbr>.atomic]</span></a>
</div>

<p><a href="../core/sync/atomic/index.html"><code>std::sync::atomic</code></a> 模块包含了一些包装值的类型，这些值只能通过原子操作访问，从而允许该值在线程间共享和修改。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-subtype"><a class="rule-link" href="#r-subtype" title="subtype"><span>[subtype]</span></a>
</div>

<h1 id="子类型和变型"><a class="header" href="#子类型和变型">子类型和变型</a></h1>
<div class="rule" id="r-subtype.intro"><a class="rule-link" href="#r-subtype.intro" title="subtype.intro"><span>[subtype<wbr>.intro]</span></a>
</div>

<p>子类型是隐式的，可以发生在类型检查或推断的任何阶段。</p>
<div class="rule" id="r-subtype.kinds"><a class="rule-link" href="#r-subtype.kinds" title="subtype.kinds"><span>[subtype<wbr>.kinds]</span></a>
</div>

<p>子类型仅限于两种情况：关于生命周期的变型，以及具有高阶生命周期的类型之间。如果我们从类型中擦除生命周期，那么唯一的子类型关系将仅源于类型相等。</p>
<p>考虑以下示例：字符串字面量始终具有 <code>'static</code> 生命周期。尽管如此，我们仍可以将 <code>s</code> 赋值给 <code>t</code>：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn bar&lt;'a&gt;() {
    let s: &amp;'static str = "hi";
    let t: &amp;'a str = s;
}
<span class="boring">}</span></code></pre>
<p>由于 <code>'static</code> 的存活时间长于生命周期参数 <code>'a</code>，因此 <code>&amp;'static str</code> 是 <code>&amp;'a str</code> 的子类型。</p>
<div class="rule" id="r-subtype.higher-ranked"><a class="rule-link" href="#r-subtype.higher-ranked" title="subtype.higher-ranked"><span>[subtype<wbr>.higher-ranked]</span></a>
</div>

<p><a href="../nomicon/hrtb.html">高阶</a> <a href="#函数指针类型">函数指针</a> 和 <a href="#特型对象">特型对象</a> 具有另一种子类型关系。它们是那些通过替换高阶生命周期而得到的类型的子类型。一些示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 这里 'a 被替换为 'static
let subtype: &amp;(for&lt;'a&gt; fn(&amp;'a i32) -&gt; &amp;'a i32) = &amp;((|x| x) as fn(&amp;_) -&gt; &amp;_);
let supertype: &amp;(fn(&amp;'static i32) -&gt; &amp;'static i32) = subtype;

// 这对特型对象的作用类似
let subtype: &amp;(dyn for&lt;'a&gt; Fn(&amp;'a i32) -&gt; &amp;'a i32) = &amp;|x| x;
let supertype: &amp;(dyn Fn(&amp;'static i32) -&gt; &amp;'static i32) = subtype;

// 我们也可以将一个高阶生命周期替换为另一个
let subtype: &amp;(for&lt;'a, 'b&gt; fn(&amp;'a i32, &amp;'b i32)) = &amp;((|x, y| {}) as fn(&amp;_, &amp;_));
let supertype: &amp;for&lt;'c&gt; fn(&amp;'c i32, &amp;'c i32) = subtype;
<span class="boring">}</span></code></pre>
<div class="rule" id="r-subtyping.variance"><a class="rule-link" href="#r-subtyping.variance" title="subtyping.variance"><span>[subtyping<wbr>.variance]</span></a>
</div>

<h2 id="变型"><a class="header" href="#变型">变型</a></h2>
<div class="rule" id="r-subtyping.variance.intro"><a class="rule-link" href="#r-subtyping.variance.intro" title="subtyping.variance.intro"><span>[subtyping<wbr>.variance<wbr>.intro]</span></a>
</div>

<p>变型是泛型类型相对于其参数所具有的属性。泛型类型在参数上的 <em>变型</em> 是指参数的子类型关系如何影响类型的子类型关系。</p>
<div class="rule" id="r-subtyping.variance.covariant"><a class="rule-link" href="#r-subtyping.variance.covariant" title="subtyping.variance.covariant"><span>[subtyping<wbr>.variance<wbr>.covariant]</span></a>
</div>

<ul>
<li>如果 <code>T</code> 是 <code>U</code> 的子类型意味着 <code>F&lt;T&gt;</code> 是 <code>F&lt;U&gt;</code> 的子类型，则 <code>F&lt;T&gt;</code> 在 <code>T</code> 上是 <em>协变</em> 的（子类型关系“透传”）</li>
</ul>
<div class="rule" id="r-subtyping.variance.contravariant"><a class="rule-link" href="#r-subtyping.variance.contravariant" title="subtyping.variance.contravariant"><span>[subtyping<wbr>.variance<wbr>.contravariant]</span></a>
</div>

<ul>
<li>如果 <code>T</code> 是 <code>U</code> 的子类型意味着 <code>F&lt;U&gt;</code> 是 <code>F&lt;T&gt;</code> 的子类型，则 <code>F&lt;T&gt;</code> 在 <code>T</code> 上是 <em>逆变</em> 的</li>
</ul>
<div class="rule" id="r-subtyping.variance.invariant"><a class="rule-link" href="#r-subtyping.variance.invariant" title="subtyping.variance.invariant"><span>[subtyping<wbr>.variance<wbr>.invariant]</span></a>
</div>

<ul>
<li>否则， <code>F&lt;T&gt;</code> 在 <code>T</code> 上是 <em>不变</em> 的（无法推导出子类型关系）</li>
</ul>
<div class="rule" id="r-subtyping.variance.builtin-types"><a class="rule-link" href="#r-subtyping.variance.builtin-types" title="subtyping.variance.builtin-types"><span>[subtyping<wbr>.variance<wbr>.builtin-types]</span></a>
</div>

<p>类型的变型自动确定如下</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>类型</th><th><code>'a</code> 的变型</th><th><code>T</code> 的变型</th></tr>
</thead>
<tbody>
<tr><td><code>&amp;'a T</code></td><td>协变</td><td>协变</td></tr>
<tr><td><code>&amp;'a mut T</code></td><td>协变</td><td>不变</td></tr>
<tr><td><code>*const T</code></td><td></td><td>协变</td></tr>
<tr><td><code>*mut T</code></td><td></td><td>不变</td></tr>
<tr><td><code>[T]</code> 和 <code>[T; n]</code></td><td></td><td>协变</td></tr>
<tr><td><code>fn() -&gt; T</code></td><td></td><td>协变</td></tr>
<tr><td><code>fn(T) -&gt; ()</code></td><td></td><td>逆变</td></tr>
<tr><td><code>std::cell::UnsafeCell&lt;T&gt;</code></td><td></td><td>不变</td></tr>
<tr><td><code>std::marker::PhantomData&lt;T&gt;</code></td><td></td><td>协变</td></tr>
<tr><td><code>dyn 特型&lt;T&gt; + 'a</code></td><td>协变</td><td>不变</td></tr>
</tbody>
</table>
</div>
<div class="rule" id="r-subtyping.variance.user-composite-types"><a class="rule-link" href="#r-subtyping.variance.user-composite-types" title="subtyping.variance.user-composite-types"><span>[subtyping<wbr>.variance<wbr>.user-composite-types]</span></a>
</div>

<p>其他 <code>struct</code> 、 <code>enum</code> 和 <code>union</code> 类型的变型是通过查看其字段类型的变型来确定的。如果参数被用于具有不同变型的位置，那么该参数就是不变的。例如，以下结构体在 <code>'a</code> 和 <code>T</code> 上是协变的，在 <code>'b</code> 、 <code>'c</code> 和 <code>U</code> 上是不变的。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::cell::UnsafeCell;
struct Variance&lt;'a, 'b, 'c, T, U: 'a&gt; {
    x: &amp;'a U,               // 这使得 Variance 在 'a 上是协变的，并且本会
                            // 使其在 U 上也是协变的，但 U 在后面被用到了
    y: *const T,            // 在 T 上协变
    z: UnsafeCell&lt;&amp;'b f64&gt;, // 在 'b 上不变
    w: *mut U,              // 在 U 上不变，使得整个结构体变为不变

    f: fn(&amp;'c ()) -&gt; &amp;'c () // 既是协变也是逆变，使得 'c 在结构体中是不变的。
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-subtyping.variance.builtin-composite-types"><a class="rule-link" href="#r-subtyping.variance.builtin-composite-types" title="subtyping.variance.builtin-composite-types"><span>[subtyping<wbr>.variance<wbr>.builtin-composite-types]</span></a>
</div>

<p>当在 <code>struct</code> 、 <code>enum</code> 或 <code>union</code> 之外使用时，参数的变型是在每个位置分别检查的。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use std::cell::UnsafeCell;
</span>fn generic_tuple&lt;'short, 'long: 'short&gt;(
    // 'long 在元组内部同时用于协变和不变的位置。
    x: (&amp;'long u32, UnsafeCell&lt;&amp;'long u32&gt;),
) {
    // 由于这些位置的变型是分别计算的，
    // 我们可以自由地缩小协变位置上的 'long。
    let _: (&amp;'short u32, UnsafeCell&lt;&amp;'long u32&gt;) = x;
}

fn takes_fn_ptr&lt;'short, 'middle: 'short&gt;(
    // 'middle 同时用于协变和逆变的位置。
    f: fn(&amp;'middle ()) -&gt; &amp;'middle (),
) {
    // 由于这些位置的变型是分别计算的，
    // 我们可以自由地缩小协变位置上的 'middle
    // 并扩大逆变位置上的 'middle。
    let _: fn(&amp;'static ()) -&gt; &amp;'short () = f;
}
<span class="boring">}</span></code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-bound"><a class="rule-link" href="#r-bound" title="bound"><span>[bound]</span></a>
</div>

<h1 id="特型和生命周期界限"><a class="header" href="#特型和生命周期界限">特型和生命周期界限</a></h1>
<div class="rule" id="r-bound.syntax"><a class="rule-link" href="#r-bound.syntax" title="bound.syntax"><span>[bound<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-TypeParamBounds" onclick="show_railroad()"><a href="#railroad-TypeParamBounds">TypeParamBounds</a></span> → <span class="grammar-text"><a href="#grammar-TypeParamBound">TypeParamBound</a></span> ( <span class="grammar-literal">+</span> <span class="grammar-text"><a href="#grammar-TypeParamBound">TypeParamBound</a></span> )<sup>*</sup> <span class="grammar-literal">+</span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-TypeParamBound" onclick="show_railroad()"><a href="#railroad-TypeParamBound">TypeParamBound</a></span> → <span class="grammar-text"><a href="#grammar-Lifetime">Lifetime</a></span> | <span class="grammar-text"><a href="#grammar-TraitBound">TraitBound</a></span> | <span class="grammar-text"><a href="#grammar-UseBound">UseBound</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-TraitBound" onclick="show_railroad()"><a href="#railroad-TraitBound">TraitBound</a></span> → <br>      ( <span class="grammar-literal">?</span> | <span class="grammar-text"><a href="#grammar-ForLifetimes">ForLifetimes</a></span> )<sup>?</sup> <span class="grammar-text"><a href="#grammar-TypePath">TypePath</a></span> <br>    | <span class="grammar-literal">(</span> ( <span class="grammar-literal">?</span> | <span class="grammar-text"><a href="#grammar-ForLifetimes">ForLifetimes</a></span> )<sup>?</sup> <span class="grammar-text"><a href="#grammar-TypePath">TypePath</a></span> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-LifetimeBounds" onclick="show_railroad()"><a href="#railroad-LifetimeBounds">LifetimeBounds</a></span> → ( <span class="grammar-text"><a href="#grammar-Lifetime">Lifetime</a></span> <span class="grammar-literal">+</span> )<sup>*</sup> <span class="grammar-text"><a href="#grammar-Lifetime">Lifetime</a></span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-Lifetime" onclick="show_railroad()"><a href="#railroad-Lifetime">Lifetime</a></span> → <br>      <span class="grammar-text"><a href="#grammar-LIFETIME_OR_LABEL">LIFETIME_OR_LABEL</a></span> <br>    | <span class="grammar-literal">'static</span> <br>    | <span class="grammar-literal">'_</span></p>
<p><span class="grammar-text grammar-production" id="grammar-UseBound" onclick="show_railroad()"><a href="#railroad-UseBound">UseBound</a></span> → <span class="grammar-literal">use</span> <span class="grammar-text"><a href="#grammar-UseBoundGenericArgs">UseBoundGenericArgs</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-UseBoundGenericArgs" onclick="show_railroad()"><a href="#railroad-UseBoundGenericArgs">UseBoundGenericArgs</a></span> → <br>      <span class="grammar-literal">&lt;</span> <span class="grammar-literal">&gt;</span> <br>    | <span class="grammar-literal">&lt;</span> ( <span class="grammar-text"><a href="#grammar-UseBoundGenericArg">UseBoundGenericArg</a></span> <span class="grammar-literal">,</span> )<sup>*</sup> <span class="grammar-text"><a href="#grammar-UseBoundGenericArg">UseBoundGenericArg</a></span> <span class="grammar-literal">,</span><sup>?</sup> <span class="grammar-literal">&gt;</span></p>
<p><span class="grammar-text grammar-production" id="grammar-UseBoundGenericArg" onclick="show_railroad()"><a href="#railroad-UseBoundGenericArg">UseBoundGenericArg</a></span> → <br>      <span class="grammar-text"><a href="#grammar-Lifetime">Lifetime</a></span> <br>    | <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <br>    | <span class="grammar-literal">Self</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 540px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TypeParamBounds"><svg class="railroad" viewbox="0 0 540 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TypeParamBounds">
<text class="comment" x="67" y="25">
TypeParamBounds</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-TypeParamBound">
<g class="nonterminal">
<rect height="22" width="132" x="35" y="55" />
<text x="101" y="71">
TypeParamBound</text>
</g>
</a>
<g class="optional">
<path d=" M 177 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 194 m -94 0 l -5 -5 m 0 10 l 5 -5 m 94 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 201 66 h 12 m 170 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -170 m 88 0 l 5 -5 m 0 10 l -5 -5 m -88 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="213" y="55" />
<text x="227" y="71">
+</text>
</g>
<a class="link" xlink:href="#railroad-TypeParamBound">
<g class="nonterminal">
<rect height="22" width="132" x="251" y="55" />
<text x="317" y="71">
TypeParamBound</text>
</g>
</a>
<path d=" M 241 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 429 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="453" y="55" />
<text x="467" y="71">
+</text>
</g>
</g>
<path d=" M 167 66 h 10" />
<path d=" M 419 66 h 10" />
</g>
<path d=" M 515 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 505 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 218px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TypeParamBound"><svg class="railroad" viewbox="0 0 218 140" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TypeParamBound">
<text class="comment" x="64" y="25">
TypeParamBound</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 84 0 h 40" />
<a class="link" xlink:href="#railroad-Lifetime">
<g class="nonterminal">
<rect height="22" width="84" x="59" y="42" />
<text x="101" y="58">
Lifetime</text>
</g>
</a>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 124 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 124 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 100 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-TraitBound">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="75" />
<text x="109" y="91">
TraitBound</text>
</g>
</a>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 84 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-UseBound">
<g class="nonterminal">
<rect height="22" width="84" x="59" y="108" />
<text x="101" y="124">
UseBound</text>
</g>
</a>
</g>
<path d=" M 193 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 183 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 500px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TraitBound"><svg class="railroad" viewbox="0 0 500 198" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TraitBound">
<text class="comment" x="50" y="25">
TraitBound</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 66 h 24 m 306 0 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0" />
<g class="sequence">
<g class="optional">
<path d=" M 59 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 164 m -79 0 l -5 -5 m 0 10 l 5 -5 m 79 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="choice">
<path d=" M 83 66 h 24 m 28 0 h 112 m -53 0 l -5 -5 m 0 10 l 5 -5 m 53 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="107" y="55" />
<text x="121" y="71">
?</text>
</g>
<path d=" M 83 66 a 12 12 0 0 1 12 12 v 9 m 140 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 95 87 v 0 a 12 12 0 0 0 12 12 m 116 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-ForLifetimes">
<g class="nonterminal">
<rect height="22" width="116" x="107" y="88" />
<text x="165" y="104">
ForLifetimes</text>
</g>
</a>
</g>
</g>
<a class="link" xlink:href="#railroad-TypePath">
<g class="nonterminal">
<rect height="22" width="84" x="281" y="55" />
<text x="323" y="71">
TypePath</text>
</g>
</a>
<path d=" M 271 66 h 10" />
</g>
<path d=" M 35 66 a 12 12 0 0 1 12 12 v 42 m 406 0 v -42 a 12 12 0 0 1 12 -12" />
<path d=" M 47 120 v 12 a 12 12 0 0 0 12 12 m 382 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="133" />
<text x="73" y="149">
(</text>
</g>
<g class="optional">
<path d=" M 97 144 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 164 m -79 0 l -5 -5 m 0 10 l 5 -5 m 79 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="choice">
<path d=" M 121 144 h 24 m 28 0 h 112 m -53 0 l -5 -5 m 0 10 l 5 -5 m 53 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="145" y="133" />
<text x="159" y="149">
?</text>
</g>
<path d=" M 121 144 a 12 12 0 0 1 12 12 v 9 m 140 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 133 165 v 0 a 12 12 0 0 0 12 12 m 116 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-ForLifetimes">
<g class="nonterminal">
<rect height="22" width="116" x="145" y="166" />
<text x="203" y="182">
ForLifetimes</text>
</g>
</a>
</g>
</g>
<a class="link" xlink:href="#railroad-TypePath">
<g class="nonterminal">
<rect height="22" width="84" x="319" y="133" />
<text x="361" y="149">
TypePath</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="413" y="133" />
<text x="427" y="149">
)</text>
</g>
<path d=" M 87 144 h 10" />
<path d=" M 309 144 h 10" />
<path d=" M 403 144 h 10" />
</g>
</g>
<path d=" M 475 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 465 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 406px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-LifetimeBounds"><svg class="railroad" viewbox="0 0 406 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-LifetimeBounds">
<text class="comment" x="64" y="25">
LifetimeBounds</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 146 m -70 0 l -5 -5 m 0 10 l 5 -5 m 70 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 122 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -122 m 64 0 l 5 -5 m 0 10 l -5 -5 m -64 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<a class="link" xlink:href="#railroad-Lifetime">
<g class="nonterminal">
<rect height="22" width="84" x="71" y="55" />
<text x="113" y="71">
Lifetime</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="165" y="55" />
<text x="179" y="71">
+</text>
</g>
<path d=" M 155 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 239 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 84 m -39 0 l -5 -5 m 0 10 l 5 -5 m 39 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-Lifetime">
<g class="nonterminal">
<rect height="22" width="84" x="263" y="55" />
<text x="305" y="71">
Lifetime</text>
</g>
</a>
</g>
<path d=" M 229 66 h 10" />
</g>
<path d=" M 381 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 371 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 274px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Lifetime"><svg class="railroad" viewbox="0 0 274 140" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Lifetime">
<text class="comment" x="43" y="25">
Lifetime</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 156 0 h 24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-LIFETIME_OR_LABEL">
<g class="nonterminal">
<rect height="22" width="156" x="59" y="42" />
<text x="137" y="58">
LIFETIME_OR_LABEL</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 180 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 180 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 76 0 h 80 m -37 0 l -5 -5 m 0 10 l 5 -5 m 37 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="76" x="59" y="75" />
<text x="97" y="91">
'static</text>
</g>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 36 0 h 120 m -57 0 l -5 -5 m 0 10 l 5 -5 m 57 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="108" />
<text x="77" y="124">
'_</text>
</g>
</g>
<path d=" M 249 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 239 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 296px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-UseBound"><svg class="railroad" viewbox="0 0 296 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-UseBound">
<text class="comment" x="43" y="25">
UseBound</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="42" />
<text x="57" y="58">
use</text>
</g>
<a class="link" xlink:href="#railroad-UseBoundGenericArgs">
<g class="nonterminal">
<rect height="22" width="172" x="89" y="42" />
<text x="175" y="58">
UseBoundGenericArgs</text>
</g>
</a>
<path d=" M 79 53 h 10" />
</g>
<path d=" M 271 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 261 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 728px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-UseBoundGenericArgs"><svg class="railroad" viewbox="0 0 728 132" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-UseBoundGenericArgs">
<text class="comment" x="81" y="25">
UseBoundGenericArgs</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 66 0 h 568 m -281 0 l -5 -5 m 0 10 l 5 -5 m 281 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="42" />
<text x="73" y="58">
&lt;</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="97" y="42" />
<text x="111" y="58">
&gt;</text>
</g>
<path d=" M 87 53 h 10" />
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 634 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 12 a 12 12 0 0 0 12 12 m 610 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="87" />
<text x="73" y="103">
&lt;</text>
</g>
<g class="optional">
<path d=" M 97 98 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 226 m -110 0 l -5 -5 m 0 10 l 5 -5 m 110 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 121 98 h 12 m 202 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -202 m 104 0 l 5 -5 m 0 10 l -5 -5 m -104 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<a class="link" xlink:href="#railroad-UseBoundGenericArg">
<g class="nonterminal">
<rect height="22" width="164" x="133" y="87" />
<text x="215" y="103">
UseBoundGenericArg</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="307" y="87" />
<text x="321" y="103">
,</text>
</g>
<path d=" M 297 98 h 10" />
</g>
</g>
</g>
<a class="link" xlink:href="#railroad-UseBoundGenericArg">
<g class="nonterminal">
<rect height="22" width="164" x="381" y="87" />
<text x="463" y="103">
UseBoundGenericArg</text>
</g>
</a>
<g class="optional">
<path d=" M 555 98 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="579" y="87" />
<text x="593" y="103">
,</text>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="641" y="87" />
<text x="655" y="103">
&gt;</text>
</g>
<path d=" M 87 98 h 10" />
<path d=" M 371 98 h 10" />
<path d=" M 545 98 h 10" />
<path d=" M 631 98 h 10" />
</g>
</g>
<path d=" M 703 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 693 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 218px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-UseBoundGenericArg"><svg class="railroad" viewbox="0 0 218 140" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-UseBoundGenericArg">
<text class="comment" x="78" y="25">
UseBoundGenericArg</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 84 0 h 40" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Lifetime">
<g class="nonterminal">
<rect height="22" width="84" x="59" y="42" />
<text x="101" y="58">
Lifetime</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 124 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 124 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 100 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="75" />
<text x="109" y="91">
IDENTIFIER</text>
</g>
</a>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 52 0 h 48 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="108" />
<text x="85" y="124">
Self</text>
</g>
</g>
<path d=" M 193 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 183 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-bound.intro"><a class="rule-link" href="#r-bound.intro" title="bound.intro"><span>[bound<wbr>.intro]</span></a>
</div>

<p><code>[特型][Trait]</code> 和生命周期界限为 <code>[泛型项][generic]</code> 提供了一种限制哪些类型和生命周期可以用作其参数的方法。可以在 <code>[where 子句][where clause]</code> 中的任何类型上提供界限。对于某些常见情况，也有较短的形式：</p>
<ul>
<li>在声明 <code>[泛型参数][generic]</code> 后编写的界限：<code>fn f&lt;A: Copy&gt;() {}</code> 与 <code>fn f&lt;A&gt;() where A: Copy {}</code> 相同。</li>
<li>在特型声明中作为 <code>[父特型][supertraits]</code> ：<code>trait Circle : Shape {}</code> 等同于 <code>trait Circle where Self : Shape {}</code> 。</li>
<li>在特型声明中作为 <code>[关联类型][associated types]</code> 上的界限：<code>trait A { type B: Copy; }</code> 等同于 <code>trait A where Self::B: Copy { type B; }</code> 。</li>
</ul>
<div class="rule" id="r-bound.satisfaction"><a class="rule-link" href="#r-bound.satisfaction" title="bound.satisfaction"><span>[bound<wbr>.satisfaction]</span></a>
</div>

<p>使用 项 时必须满足其上的界限。在对泛型 项 进行类型检查和借用检查时，界限可用于确定某个类型是否实现了某个特型。例如，给定 <code>Ty: Trait</code></p>
<ul>
<li>在泛型函数的函数体中，可以在 <code>Ty</code> 值上调用来自 <code>Trait</code> 的方法。同样，也可以使用 <code>Trait</code> 上的关联常量。</li>
<li>可以使用来自 <code>Trait</code> 的关联类型。</li>
<li>具有 <code>T: Trait</code> 界限的泛型函数和类型可以使用 <code>Ty</code> 作为 <code>T</code> 。</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">type Surface = i32;
</span>trait Shape {
    fn draw(&amp;self, surface: Surface);
    fn name() -&gt; &amp;'static str;
}

fn draw_twice&lt;T: Shape&gt;(surface: Surface, sh: T) {
    sh.draw(surface);           // 可以调用方法，因为 T: Shape
    sh.draw(surface);
}

fn copy_and_draw_twice&lt;T: Copy&gt;(surface: Surface, sh: T) where T: Shape {
    let shape_copy = sh;        // 不会移动 sh，因为 T: Copy
    draw_twice(surface, sh);    // 可以使用泛型函数，因为 T: Shape
}

struct Figure&lt;S: Shape&gt;(S, S);

fn name_figure&lt;U: Shape&gt;(
    figure: Figure&lt;U&gt;,          // 类型 Figure&lt;U&gt; 是良构的，因为 U: Shape
) {
    println!(
        "Figure of two {}",
        U::name(),              // 可以使用关联函数
    );
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-bound.trivial"><a class="rule-link" href="#r-bound.trivial" title="bound.trivial"><span>[bound<wbr>.trivial]</span></a>
</div>

<p>不使用 项 的参数或 <code>[高阶生命周期][higher-ranked lifetimes]</code> 的界限会在定义 项 时进行检查。此类界限若为假则是错误的。</p>
<div class="rule" id="r-bound.special"><a class="rule-link" href="#r-bound.special" title="bound.special"><span>[bound<wbr>.special]</span></a>
</div>

<p>在使用 项 时，还会检查某些泛型类型的 <code>[</code>Copy<code>]</code> 、 <code>[</code>Clone<code>]</code> 和 <code>[</code>Sized<code>]</code> 界限，即使该使用并未提供具体类型。在可变引用、 <code>[特型对象][trait object]</code> 或 <code>[切片][slice]</code> 上将 <code>Copy</code> 或 <code>Clone</code> 作为界限是错误的。在特型对象或切片上将 <code>Sized</code> 作为界限是错误的。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct A&lt;'a, T&gt;
where
    i32: Default,           // 允许，但没用
    i32: Iterator,          // 错误：`i32` 不是迭代器
    &amp;'a mut T: Copy,        // （使用时）错误：特型界限未满足
    [T]: Sized,             // （使用时）错误：大小在编译时无法确定
{
    f: &amp;'a T,
}
struct UsesA&lt;'a, T&gt;(A&lt;'a, T&gt;);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-bound.trait-object"><a class="rule-link" href="#r-bound.trait-object" title="bound.trait-object"><span>[bound<wbr>.trait-object]</span></a>
</div>

<p>特型和生命周期界限也用于命名 <code>[特型对象][trait objects]</code> 。</p>
<div class="rule" id="r-bound.sized"><a class="rule-link" href="#r-bound.sized" title="bound.sized"><span>[bound<wbr>.sized]</span></a>
</div>

<h2 id="sized"><a class="header" href="#sized"><code>?Sized</code></a></h2>
<p><code>?</code> 仅用于放宽针对 <code>[类型参数][type parameters]</code> 或 <code>[关联类型][associated types]</code> 的隐式 <code>[</code>Sized<code>]</code> 特型界限。 <code>?Sized</code> 不可用作其他类型的界限。</p>
<div class="rule" id="r-bound.lifetime"><a class="rule-link" href="#r-bound.lifetime" title="bound.lifetime"><span>[bound<wbr>.lifetime]</span></a>
</div>

<h2 id="生命周期界限"><a class="header" href="#生命周期界限">生命周期界限</a></h2>
<div class="rule" id="r-bound.lifetime.intro"><a class="rule-link" href="#r-bound.lifetime.intro" title="bound.lifetime.intro"><span>[bound<wbr>.lifetime<wbr>.intro]</span></a>
</div>

<p>生命周期界限可以应用于类型或其他生命周期。</p>
<div class="rule" id="r-bound.lifetime.outlive-lifetime"><a class="rule-link" href="#r-bound.lifetime.outlive-lifetime" title="bound.lifetime.outlive-lifetime"><span>[bound<wbr>.lifetime<wbr>.outlive-lifetime]</span></a>
</div>

<p>界限 <code>'a: 'b</code> 通常读作 <code>'a</code> <em>长于</em> <code>'b</code> 。 <code>'a: 'b</code> 表示 <code>'a</code> 的持续时间至少与 <code>'b</code> 一样长，因此只要 <code>&amp;'b ()</code> 有效，引用 <code>&amp;'a ()</code> 就是有效的。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn f&lt;'a, 'b&gt;(x: &amp;'a i32, mut y: &amp;'b i32) where 'a: 'b {
    y = x;                      // &amp;'a i32 是 &amp;'b i32 的子类型，因为 'a: 'b
    let r: &amp;'b &amp;'a i32 = &amp;&amp;0;   // &amp;'b &amp;'a i32 是良构的，因为 'a: 'b
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-bound.lifetime.outlive-type"><a class="rule-link" href="#r-bound.lifetime.outlive-type" title="bound.lifetime.outlive-type"><span>[bound<wbr>.lifetime<wbr>.outlive-type]</span></a>
</div>

<p><code>T: 'a</code> 表示 <code>T</code> 的所有生命周期参数都 <em>长于</em> <code>'a</code> 。例如，如果 <code>'a</code> 是一个不受约束的生命周期参数，则 <code>i32: 'static</code> 和 <code>&amp;'static str: 'a</code> 被满足，但 <code>Vec&lt;&amp;'a ()&gt;: 'static</code> 不满足。</p>
<div class="rule" id="r-bound.higher-ranked"><a class="rule-link" href="#r-bound.higher-ranked" title="bound.higher-ranked"><span>[bound<wbr>.higher-ranked]</span></a>
</div>

<h2 id="高阶特型界限"><a class="header" href="#高阶特型界限">高阶特型界限</a></h2>
<div class="rule" id="r-bound.higher-ranked.syntax"><a class="rule-link" href="#r-bound.higher-ranked.syntax" title="bound.higher-ranked.syntax"><span>[bound<wbr>.higher-ranked<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ForLifetimes" onclick="show_railroad()"><a href="#railroad-ForLifetimes">ForLifetimes</a></span> → <span class="grammar-literal">for</span> <span class="grammar-text"><a href="#grammar-GenericParams">GenericParams</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 248px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ForLifetimes"><svg class="railroad" viewbox="0 0 248 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ForLifetimes">
<text class="comment" x="57" y="25">
ForLifetimes</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="35" y="42" />
<text x="57" y="58">
for</text>
</g>
<a class="link" xlink:href="#railroad-GenericParams">
<g class="nonterminal">
<rect height="22" width="124" x="89" y="42" />
<text x="151" y="58">
GenericParams</text>
</g>
</a>
<path d=" M 79 53 h 10" />
</g>
<path d=" M 223 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 213 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-bound.higher-ranked.intro"><a class="rule-link" href="#r-bound.higher-ranked.intro" title="bound.higher-ranked.intro"><span>[bound<wbr>.higher-ranked<wbr>.intro]</span></a>
</div>

<p>特型界限可以是生命周期上的 <em>高阶</em> 界限。这些界限指定了 <em>对于所有</em> 生命周期都成立的界限。例如，像 <code>for&lt;'a&gt; &amp;'a T: PartialEq&lt;i32&gt;</code> 这样的界限需要类似如下的实现</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct T;
</span>impl&lt;'a&gt; PartialEq&lt;i32&gt; for &amp;'a T {
    // ...
<span class="boring">   fn eq(&amp;self, other: &amp;i32) -&gt; bool {true}
</span>}
<span class="boring">}</span></code></pre>
<p>并可用于将具有任何生命周期的 <code>&amp;'a T</code> 与 <code>i32</code> 进行比较。</p>
<p>此处只能使用高阶界限，因为引用的生命周期比函数上任何可能的生命周期参数都要短：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn call_on_ref_zero&lt;F&gt;(f: F) where for&lt;'a&gt; F: Fn(&amp;'a i32) {
    let zero = 0;
    f(&amp;zero);
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-bound.higher-ranked.trait"><a class="rule-link" href="#r-bound.higher-ranked.trait" title="bound.higher-ranked.trait"><span>[bound<wbr>.higher-ranked<wbr>.trait]</span></a>
</div>

<p>高阶生命周期也可以紧接在特型之前指定：唯一的区别是生命周期参数的 <a href="#higher-ranked-trait-bound-scopes">作用域</a> ，它仅延伸到后续特型的末尾，而不是整个界限。此函数等同于上一个函数。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn call_on_ref_zero&lt;F&gt;(f: F) where F: for&lt;'a&gt; Fn(&amp;'a i32) {
    let zero = 0;
    f(&amp;zero);
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-bound.implied"><a class="rule-link" href="#r-bound.implied" title="bound.implied"><span>[bound<wbr>.implied]</span></a>
</div>

<h2 id="隐含界限"><a class="header" href="#隐含界限">隐含界限</a></h2>
<div class="rule" id="r-bound.implied.intro"><a class="rule-link" href="#r-bound.implied.intro" title="bound.implied.intro"><span>[bound<wbr>.implied<wbr>.intro]</span></a>
</div>

<p>类型为良构所需的生命周期界限有时会被推断出来。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn requires_t_outlives_a&lt;'a, T&gt;(x: &amp;'a T) {}
<span class="boring">}</span></code></pre>
<p>要求类型参数 <code>T</code> <em>长于</em> <code>'a</code> ，以便 <code>&amp;'a T</code> 类型是良构的。这是被推断出来的，因为函数签名包含类型 <code>&amp;'a T</code> ，该类型仅在 <code>T: 'a</code> 成立时才有效。</p>
<div class="rule" id="r-bound.implied.context"><a class="rule-link" href="#r-bound.implied.context" title="bound.implied.context"><span>[bound<wbr>.implied<wbr>.context]</span></a>
</div>

<p>隐含界限会被添加到函数的所有参数和输出中。在 <code>requires_t_outlives_a</code> 内部，即使没有显式指定，也可以假设 <code>T: 'a</code> 成立：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn requires_t_outlives_a_not_implied&lt;'a, T: 'a&gt;() {}

fn requires_t_outlives_a&lt;'a, T&gt;(x: &amp;'a T) {
    // 这可以编译，因为 `T: 'a` 是由
    // 引用类型 `&amp;'a T` 隐含的。
    requires_t_outlives_a_not_implied::&lt;'a, T&gt;();
}
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0309 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn requires_t_outlives_a_not_implied&lt;'a, T: 'a&gt;() {}
</span>fn not_implied&lt;'a, T&gt;() {
    // 这会报错，因为 `T: 'a` 不是由
    // 函数签名隐含的。
    requires_t_outlives_a_not_implied::&lt;'a, T&gt;();
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-bound.implied.trait"><a class="rule-link" href="#r-bound.implied.trait" title="bound.implied.trait"><span>[bound<wbr>.implied<wbr>.trait]</span></a>
</div>

<p>只有生命周期界限是隐含的，特型界限仍必须显式添加。因此，以下示例会导致错误：</p>
<pre class="playground"><code class="language-rust compile_fail E0277 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::fmt::Debug;
struct IsDebug&lt;T: Debug&gt;(T);
// 错误[E0277]：`T` 未实现 `Debug`
fn doesnt_specify_t_debug&lt;T&gt;(x: IsDebug&lt;T&gt;) {}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-bound.implied.def"><a class="rule-link" href="#r-bound.implied.def" title="bound.implied.def"><span>[bound<wbr>.implied<wbr>.def]</span></a>
</div>

<p>对于任何类型的类型定义和 impl 块，也会推断出生命周期界限：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Struct&lt;'a, T&gt; {
    // 这要求 `T: 'a` 是良构的，
    // 由编译器推断。
    field: &amp;'a T,
}

enum Enum&lt;'a, T&gt; {
    // 这要求 `T: 'a` 是良构的，
    // 由编译器推断。
    //
    // 注意，即使仅使用
    // `Enum::OtherVariant`，也要求 `T: 'a`。
    SomeVariant(&amp;'a T),
    OtherVariant,
}

trait Trait&lt;'a, T: 'a&gt; {}

// 这会报错，因为 `T: 'a` 未由 impl 标题中的任何类型隐含。
//     impl&lt;'a, T&gt; Trait&lt;'a, T&gt; for () {}

// 这可以编译，因为 `T: 'a` 是由 self 类型 `&amp;'a T` 隐含的。
impl&lt;'a, T&gt; Trait&lt;'a, T&gt; for &amp;'a T {}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-bound.use"><a class="rule-link" href="#r-bound.use" title="bound.use"><span>[bound<wbr>.use]</span></a>
</div>

<h2 id="使用界限"><a class="header" href="#使用界限">使用界限</a></h2>
<p>某些界限列表可能包含 <code>use&lt;..&gt;</code> 界限，以控制哪些泛型参数会被 <code>impl Trait</code> <a href="#abstract-return-types">抽象返回类型</a> 捕获。有关更多详细信息，请参阅 <a href="#precise-capturing">精确捕获</a> 。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-coerce"><a class="rule-link" href="#r-coerce" title="coerce"><span>[coerce]</span></a>
</div>

<h1 id="隐式类型转换"><a class="header" href="#隐式类型转换">隐式类型转换</a></h1>
<div class="rule" id="r-coerce.intro"><a class="rule-link" href="#r-coerce.intro" title="coerce.intro"><span>[coerce<wbr>.intro]</span></a>
</div>

<p><strong>隐式类型转换</strong> 是改变值类型的隐式操作。它们在特定位置自动发生，并且对实际进行转换的类型有严格限制。</p>
<div class="rule" id="r-coerce.as"><a class="rule-link" href="#r-coerce.as" title="coerce.as"><span>[coerce<wbr>.as]</span></a>
</div>

<p>任何允许隐式转换的转换也可以通过 <a href="#type-cast-expressions">类型转换运算符</a> <code>as</code> 显式执行。</p>
<p>隐式转换最初在 <a href="https://github.com/rust-lang/rfcs/blob/master/text/0401-coercions.md">RFC 401</a> 中定义，并在 <a href="https://github.com/rust-lang/rfcs/blob/master/text/1558-closure-to-fn-coercion.md">RFC 1558</a> 中得到扩展。</p>
<div class="rule" id="r-coerce.site"><a class="rule-link" href="#r-coerce.site" title="coerce.site"><span>[coerce<wbr>.site]</span></a>
</div>

<h2 id="转换点"><a class="header" href="#转换点">转换点</a></h2>
<div class="rule" id="r-coerce.site.intro"><a class="rule-link" href="#r-coerce.site.intro" title="coerce.site.intro"><span>[coerce<wbr>.site<wbr>.intro]</span></a>
</div>

<p>隐式转换只能发生在程序中的某些转换点；这些位置通常是所需类型明确或可以通过从明确类型传播（无需类型推断）导出的地方。可能的转换点有：</p>
<div class="rule" id="r-coerce.site.let"><a class="rule-link" href="#r-coerce.site.let" title="coerce.site.let"><span>[coerce<wbr>.site<wbr>.let]</span></a>
</div>

<ul>
<li>
<p>给出显式类型的 <code>let</code> 语句。</p>
<p>例如，在以下代码中， <code>&amp;mut 42</code> 被隐式转换为 <code>&amp;i8</code> 类型：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let _: &amp;i8 = &amp;mut 42;
<span class="boring">}</span></code></pre>
</li>
</ul>
<div class="rule" id="r-coerce.site.value"><a class="rule-link" href="#r-coerce.site.value" title="coerce.site.value"><span>[coerce<wbr>.site<wbr>.value]</span></a>
</div>

<ul>
<li><code>static</code> 和 <code>const</code> 项 声明（类似于 <code>let</code> 语句）。</li>
</ul>
<div class="rule" id="r-coerce.site.argument"><a class="rule-link" href="#r-coerce.site.argument" title="coerce.site.argument"><span>[coerce<wbr>.site<wbr>.argument]</span></a>
</div>

<ul>
<li>
<p>函数调用的参数</p>
<p>被转换的值是实际参数，它被转换为正式参数的类型。</p>
<p>例如，在以下代码中， <code>&amp;mut 42</code> 被隐式转换为 <code>&amp;i8</code> 类型：</p>
<pre class="playground"><code class="language-rust edition2024">fn bar(_: &amp;i8) { }

fn main() {
    bar(&amp;mut 42);
}</code></pre>
<p>对于方法调用，接收者（ <code>self</code> 参数）类型的转换方式不同，详情请参阅 <a href="#方法调用表达式">方法调用表达式</a> 的文档。</p>
</li>
</ul>
<div class="rule" id="r-coerce.site.constructor"><a class="rule-link" href="#r-coerce.site.constructor" title="coerce.site.constructor"><span>[coerce<wbr>.site<wbr>.constructor]</span></a>
</div>

<ul>
<li>
<p>结构体、 联合体 或 枚举 变体 字段的实例化</p>
<p>例如，在以下代码中， <code>&amp;mut 42</code> 被隐式转换为 <code>&amp;i8</code> 类型：</p>
<pre class="playground"><code class="language-rust edition2024">struct Foo&lt;'a&gt; { x: &amp;'a i8 }

fn main() {
    Foo { x: &amp;mut 42 };
}</code></pre>
</li>
</ul>
<div class="rule" id="r-coerce.site.return"><a class="rule-link" href="#r-coerce.site.return" title="coerce.site.return"><span>[coerce<wbr>.site<wbr>.return]</span></a>
</div>

<ul>
<li>
<p>函数结果——如果代码块不是以分号结尾，则为代码块的最后一行，或者是 <code>return</code> 语句中的任何表达式</p>
<p>例如，在以下代码中， <code>x</code> 被隐式转换为 <code>&amp;dyn Display</code> 类型：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::fmt::Display;
fn foo(x: &amp;u32) -&gt; &amp;dyn Display {
    x
}
<span class="boring">}</span></code></pre>
</li>
</ul>
<div class="rule" id="r-coerce.site.subexpr"><a class="rule-link" href="#r-coerce.site.subexpr" title="coerce.site.subexpr"><span>[coerce<wbr>.site<wbr>.subexpr]</span></a>
</div>

<p>如果这些转换点中的表达式是一个转换传播表达式，那么该表达式中相关的子表达式也是转换点。传播从这些新的转换点递归进行。传播表达式及其相关的子表达式包括：</p>
<div class="rule" id="r-coerce.site.array"><a class="rule-link" href="#r-coerce.site.array" title="coerce.site.array"><span>[coerce<wbr>.site<wbr>.array]</span></a>
</div>

<ul>
<li>数组字面量，其中数组类型为 <code>[U; n]</code> 。数组字面量中的每个子表达式都是转换为 <code>U</code> 类型的转换点。</li>
</ul>
<div class="rule" id="r-coerce.site.repeat"><a class="rule-link" href="#r-coerce.site.repeat" title="coerce.site.repeat"><span>[coerce<wbr>.site<wbr>.repeat]</span></a>
</div>

<ul>
<li>具有重复语法格式的数组字面量，其中数组类型为 <code>[U; n]</code> 。重复的子表达式是转换为 <code>U</code> 类型的转换点。</li>
</ul>
<div class="rule" id="r-coerce.site.tuple"><a class="rule-link" href="#r-coerce.site.tuple" title="coerce.site.tuple"><span>[coerce<wbr>.site<wbr>.tuple]</span></a>
</div>

<ul>
<li>元组，元组本身是转换为类型 <code>(U_0, U_1, ..., U_n)</code> 的转换点。每个子表达式都是对应类型的转换点，例如，第 0 个子表达式是转换为 <code>U_0</code> 类型的转换点。</li>
</ul>
<div class="rule" id="r-coerce.site.parenthesis"><a class="rule-link" href="#r-coerce.site.parenthesis" title="coerce.site.parenthesis"><span>[coerce<wbr>.site<wbr>.parenthesis]</span></a>
</div>

<ul>
<li>括号子表达式（ <code>(e)</code> ）：如果表达式具有类型 <code>U</code> ，则子表达式是转换为 <code>U</code> 的转换点。</li>
</ul>
<div class="rule" id="r-coerce.site.block"><a class="rule-link" href="#r-coerce.site.block" title="coerce.site.block"><span>[coerce<wbr>.site<wbr>.block]</span></a>
</div>

<ul>
<li>代码块：如果代码块具有类型 <code>U</code> ，则代码块中的最后一个表达式（如果不是以分号结尾）是转换为 <code>U</code> 的转换点。这包括属于控制流语句（如 <code>if</code> / <code>else</code> ）一部分的代码块，前提是该代码块具有已知类型。</li>
</ul>
<div class="rule" id="r-coerce.types"><a class="rule-link" href="#r-coerce.types" title="coerce.types"><span>[coerce<wbr>.types]</span></a>
</div>

<h2 id="转换类型"><a class="header" href="#转换类型">转换类型</a></h2>
<p>允许在以下类型之间进行隐式转换：</p>
<div class="rule" id="r-coerce.types.reflexive"><a class="rule-link" href="#r-coerce.types.reflexive" title="coerce.types.reflexive"><span>[coerce<wbr>.types<wbr>.reflexive]</span></a>
</div>

<ul>
<li>如果 <code>T</code> 是 <code>U</code> 的 <a href="#子类型和变型">子类型</a> ，则 <code>T</code> 到 <code>U</code> （ <em>自反情况</em> ）</li>
</ul>
<div class="rule" id="r-coerce.types.transitive"><a class="rule-link" href="#r-coerce.types.transitive" title="coerce.types.transitive"><span>[coerce<wbr>.types<wbr>.transitive]</span></a>
</div>

<ul>
<li>
<p><code>T_1</code> 到 <code>T_3</code> ，其中 <code>T_1</code> 可隐式转换为 <code>T_2</code> 且 <code>T_2</code> 可隐式转换为 <code>T_3</code> （ <em>传递情况</em> ）</p>
<p>请注意，这尚未得到完全支持。</p>
</li>
</ul>
<div class="rule" id="r-coerce.types.mut-reborrow"><a class="rule-link" href="#r-coerce.types.mut-reborrow" title="coerce.types.mut-reborrow"><span>[coerce<wbr>.types<wbr>.mut-reborrow]</span></a>
</div>

<ul>
<li><code>&amp;mut T</code> 到 <code>&amp;T</code></li>
</ul>
<div class="rule" id="r-coerce.types.mut-pointer"><a class="rule-link" href="#r-coerce.types.mut-pointer" title="coerce.types.mut-pointer"><span>[coerce<wbr>.types<wbr>.mut-pointer]</span></a>
</div>

<ul>
<li><code>*mut T</code> 到 <code>*const T</code></li>
</ul>
<div class="rule" id="r-coerce.types.ref-to-pointer"><a class="rule-link" href="#r-coerce.types.ref-to-pointer" title="coerce.types.ref-to-pointer"><span>[coerce<wbr>.types<wbr>.ref-to-pointer]</span></a>
</div>

<ul>
<li><code>&amp;T</code> 到 <code>*const T</code></li>
</ul>
<div class="rule" id="r-coerce.types.mut-to-pointer"><a class="rule-link" href="#r-coerce.types.mut-to-pointer" title="coerce.types.mut-to-pointer"><span>[coerce<wbr>.types<wbr>.mut-to-pointer]</span></a>
</div>

<ul>
<li><code>&amp;mut T</code> 到 <code>*mut T</code></li>
</ul>
<div class="rule" id="r-coerce.types.deref"><a class="rule-link" href="#r-coerce.types.deref" title="coerce.types.deref"><span>[coerce<wbr>.types<wbr>.deref]</span></a>
</div>

<ul>
<li>
<p>如果 <code>T</code> 实现了 <code>Deref&lt;Target = U&gt;</code> ，则 <code>&amp;T</code> 或 <code>&amp;mut T</code> 到 <code>&amp;U</code> 。例如：</p>
<pre class="playground"><code class="language-rust edition2024">use std::ops::Deref;

struct CharContainer {
    value: char,
}

impl Deref for CharContainer {
    type Target = char;

    fn deref&lt;'a&gt;(&amp;'a self) -&gt; &amp;'a char {
        &amp;self.value
    }
}

fn foo(arg: &amp;char) {}

fn main() {
    let x = &amp;mut CharContainer { value: 'y' };
    foo(x); // &amp;mut CharContainer 被隐式转换为 &amp;char。
}</code></pre>
</li>
</ul>
<div class="rule" id="r-coerce.types.deref-mut"><a class="rule-link" href="#r-coerce.types.deref-mut" title="coerce.types.deref-mut"><span>[coerce<wbr>.types<wbr>.deref-mut]</span></a>
</div>

<ul>
<li>如果 <code>T</code> 实现了 <code>DerefMut&lt;Target = U&gt;</code> ，则 <code>&amp;mut T</code> 到 <code>&amp;mut U</code> 。</li>
</ul>
<div class="rule" id="r-coerce.types.unsize"><a class="rule-link" href="#r-coerce.types.unsize" title="coerce.types.unsize"><span>[coerce<wbr>.types<wbr>.unsize]</span></a>
</div>

<ul>
<li>
<p>TyCtor( <code>T</code> ) 到 TyCtor( <code>U</code> )，其中 TyCtor( <code>T</code> ) 是以下之一</p>
<ul>
<li><code>&amp;T</code></li>
<li><code>&amp;mut T</code></li>
<li><code>*const T</code></li>
<li><code>*mut T</code></li>
<li><code>Box&lt;T&gt;</code></li>
</ul>
<p>并且可以通过 <a href="#unsized-coercions">非定长转换</a> 从 <code>T</code> 获得 <code>U</code> 。</p>
  <!--In the future, coerce_inner will be recursively extended to tuples and
  structs. In addition, coercions from subtraits to supertraits will be
  added. See [RFC 401] for more details.-->
</li>
</ul>
<div class="rule" id="r-coerce.types.fn"><a class="rule-link" href="#r-coerce.types.fn" title="coerce.types.fn"><span>[coerce<wbr>.types<wbr>.fn]</span></a>
</div>

<ul>
<li>函数 项 类型到 <code>fn</code> 指针</li>
</ul>
<div class="rule" id="r-coerce.types.closure"><a class="rule-link" href="#r-coerce.types.closure" title="coerce.types.closure"><span>[coerce<wbr>.types<wbr>.closure]</span></a>
</div>

<ul>
<li>非捕获闭包到 <code>fn</code> 指针</li>
</ul>
<div class="rule" id="r-coerce.types.never"><a class="rule-link" href="#r-coerce.types.never" title="coerce.types.never"><span>[coerce<wbr>.types<wbr>.never]</span></a>
</div>

<ul>
<li><code>!</code> 到任何 <code>T</code></li>
</ul>
<div class="rule" id="r-coerce.unsize"><a class="rule-link" href="#r-coerce.unsize" title="coerce.unsize"><span>[coerce<wbr>.unsize]</span></a>
</div>

<h3 id="非定长转换"><a class="header" href="#非定长转换">非定长转换</a></h3>
<div class="rule" id="r-coerce.unsize.intro"><a class="rule-link" href="#r-coerce.unsize.intro" title="coerce.unsize.intro"><span>[coerce<wbr>.unsize<wbr>.intro]</span></a>
</div>

<p>以下转换被称为 <code>非定长转换</code> ，因为它们与将类型转换为非定长类型有关，并且在上述其他转换不允许的少数情况下是允许的。它们仍然可以发生在隐式转换可以发生的任何其他地方。</p>
<div class="rule" id="r-coerce.unsize.trait"><a class="rule-link" href="#r-coerce.unsize.trait" title="coerce.unsize.trait"><span>[coerce<wbr>.unsize<wbr>.trait]</span></a>
</div>

<p>两个 特型 <a href="../core/marker/trait.Unsize.html"><code>Unsize</code></a> 和 <a href="../core/ops/unsize/trait.CoerceUnsized.html"><code>CoerceUnsized</code></a> 被用于协助此过程并将其公开给库使用。以下转换是内置的，如果 <code>T</code> 可以通过其中之一隐式转换为 <code>U</code> ，则将提供 <code>T</code> 对 <code>Unsize&lt;U&gt;</code> 的实现：</p>
<div class="rule" id="r-coerce.unsize.slice"><a class="rule-link" href="#r-coerce.unsize.slice" title="coerce.unsize.slice"><span>[coerce<wbr>.unsize<wbr>.slice]</span></a>
</div>

<ul>
<li><code>[T; n]</code> 到 <code>[T]</code> 。</li>
</ul>
<div class="rule" id="r-coerce.unsize.trait-object"><a class="rule-link" href="#r-coerce.unsize.trait-object" title="coerce.unsize.trait-object"><span>[coerce<wbr>.unsize<wbr>.trait-object]</span></a>
</div>

<ul>
<li><code>T</code> 到 <code>dyn U</code> ，当 <code>T</code> 实现 <code>U + Sized</code> ，且 <code>U</code> 是 <a href="#dyn兼容性">dyn 兼容</a> 的。</li>
</ul>
<div class="rule" id="r-coerce.unsize.trait-upcast"><a class="rule-link" href="#r-coerce.unsize.trait-upcast" title="coerce.unsize.trait-upcast"><span>[coerce<wbr>.unsize<wbr>.trait-upcast]</span></a>
</div>

<ul>
<li><code>dyn T</code> 到 <code>dyn U</code> ，当 <code>U</code> 是 <code>T</code> 的 <a href="#supertraits">父特型</a> 之一时。
<ul>
<li>这允许丢弃自动特型，即允许 <code>dyn T + Auto</code> 到 <code>dyn U</code> 。</li>
<li>如果主特型将自动特型作为父特型，则允许添加自动特型，即给定 <code>trait T: U + Send {}</code> ，允许 <code>dyn T</code> 到 <code>dyn T + Send</code> 或到 <code>dyn U + Send</code> 的隐式转换。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-coerce.unsized.composite"><a class="rule-link" href="#r-coerce.unsized.composite" title="coerce.unsized.composite"><span>[coerce<wbr>.unsized<wbr>.composite]</span></a>
</div>

<ul>
<li><code>Foo&lt;..., T, ...&gt;</code> 到 <code>Foo&lt;..., U, ...&gt;</code> ，当：
<ul>
<li><code>Foo</code> 是一个 结构体 。</li>
<li><code>T</code> 实现了 <code>Unsize&lt;U&gt;</code> 。</li>
<li><code>Foo</code> 的最后一个字段具有涉及 <code>T</code> 的类型。</li>
<li>如果该字段的类型为 <code>Bar&lt;T&gt;</code> ，则 <code>Bar&lt;T&gt;</code> 实现了 <code>Unsize&lt;Bar&lt;U&gt;&gt;</code> 。</li>
<li><code>T</code> 不是任何其他字段类型的一部分。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-coerce.unsized.pointer"><a class="rule-link" href="#r-coerce.unsized.pointer" title="coerce.unsized.pointer"><span>[coerce<wbr>.unsized<wbr>.pointer]</span></a>
</div>

<p>此外，当 <code>T</code> 实现了 <code>Unsize&lt;U&gt;</code> 或 <code>CoerceUnsized&lt;Foo&lt;U&gt;&gt;</code> 时，类型 <code>Foo&lt;T&gt;</code> 可以实现 <code>CoerceUnsized&lt;Foo&lt;U&gt;&gt;</code> 。这允许它提供到 <code>Foo&lt;U&gt;</code> 的非定长转换。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>虽然非定长转换的定义及其实现已经稳定，但特型本身尚未稳定，因此不能在稳定版 Rust 中直接使用。</p>
</blockquote>
</div>

<div class="rule" id="r-coerce.least-upper-bound"><a class="rule-link" href="#r-coerce.least-upper-bound" title="coerce.least-upper-bound"><span>[coerce<wbr>.least-upper-bound]</span></a>
</div>

<h2 id="最小上界转换"><a class="header" href="#最小上界转换">最小上界转换</a></h2>
<div class="rule" id="r-coerce.least-upper-bound.intro"><a class="rule-link" href="#r-coerce.least-upper-bound.intro" title="coerce.least-upper-bound.intro"><span>[coerce<wbr>.least-upper-bound<wbr>.intro]</span></a>
</div>

<p>在某些语境中，编译器必须将多个类型一起进行隐式转换，以尝试找到最通用的类型。这被称为 “最小上界” （LUB）转换。LUB 转换仅在以下情况下使用：</p>
<ul>
<li>寻找一系列 <code>if</code> 分支的共同类型。</li>
<li>寻找一系列 <code>match</code> 臂的共同类型。</li>
<li>寻找数组元素的共同类型。</li>
<li>寻找具有多个返回语句的闭包的返回类型。</li>
<li>检查具有多个返回语句的函数的返回类型。</li>
</ul>
<div class="rule" id="r-coerce.least-upper-bound.target"><a class="rule-link" href="#r-coerce.least-upper-bound.target" title="coerce.least-upper-bound.target"><span>[coerce<wbr>.least-upper-bound<wbr>.target]</span></a>
</div>

<p>在每种情况下，都有一组类型 <code>T0..Tn</code> 需要相互转换为某个目标类型 <code>T_t</code> ，该类型在开始时是未知的。</p>
<div class="rule" id="r-coerce.least-upper-bound.computation"><a class="rule-link" href="#r-coerce.least-upper-bound.computation" title="coerce.least-upper-bound.computation"><span>[coerce<wbr>.least-upper-bound<wbr>.computation]</span></a>
</div>

<p>计算 LUB 转换是迭代进行的。目标类型 <code>T_t</code> 最初为类型 <code>T0</code> 。对于每个新类型 <code>Ti</code> ，我们考虑：</p>
<div class="rule" id="r-coerce.least-upper-bound.computation-identity"><a class="rule-link" href="#r-coerce.least-upper-bound.computation-identity" title="coerce.least-upper-bound.computation-identity"><span>[coerce<wbr>.least-upper-bound<wbr>.computation-identity]</span></a>
</div>

<ul>
<li>如果 <code>Ti</code> 可以隐式转换为当前目标类型 <code>T_t</code> ，则不作更改。</li>
</ul>
<div class="rule" id="r-coerce.least-upper-bound.computation-replace"><a class="rule-link" href="#r-coerce.least-upper-bound.computation-replace" title="coerce.least-upper-bound.computation-replace"><span>[coerce<wbr>.least-upper-bound<wbr>.computation-replace]</span></a>
</div>

<ul>
<li>否则，检查 <code>T_t</code> 是否可以隐式转换为 <code>Ti</code> ；如果是，则将 <code>T_t</code> 更改为 <code>Ti</code> 。（此检查还取决于迄今为止考虑的所有源表达式是否都具有隐式转换。）</li>
</ul>
<div class="rule" id="r-coerce.least-upper-bound.computation-unify"><a class="rule-link" href="#r-coerce.least-upper-bound.computation-unify" title="coerce.least-upper-bound.computation-unify"><span>[coerce<wbr>.least-upper-bound<wbr>.computation-unify]</span></a>
</div>

<ul>
<li>如果都不是，尝试计算 <code>T_t</code> 和 <code>Ti</code> 的共同超类型，这将成为新的目标类型。</li>
</ul>
<h3 id="示例-4"><a class="header" href="#示例-4">示例：</a></h3>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">let (a, b, c) = (0, 1, 2);
</span>// 对于 if 分支
let bar = if true {
    a
} else if false {
    b
} else {
    c
};

// 对于 match 臂
let baw = match 42 {
    0 =&gt; a,
    1 =&gt; b,
    _ =&gt; c,
};

// 对于数组元素
let bax = [a, b, c];

// 对于具有多个返回语句的闭包
let clo = || {
    if true {
        a
    } else if false {
        b
    } else {
        c
    }
};
let baz = clo();

// 对于具有多个返回语句的函数的类型检查
fn foo() -&gt; i32 {
    let (a, b, c) = (0, 1, 2);
    match 42 {
        0 =&gt; a,
        1 =&gt; b,
        _ =&gt; c,
    }
}
<span class="boring">}</span></code></pre>
<p>在这些示例中， <code>ba*</code> 的类型是通过 LUB 转换找到的。并且编译器在处理函数 <code>foo</code> 时会检查 <code>a</code> 、 <code>b</code> 、 <code>c</code> 的 LUB 转换结果是否为 <code>i32</code> 。</p>
<h3 id="警告"><a class="header" href="#警告">警告</a></h3>
<p>这种描述显然是非正式的。更精确的描述预计将作为更精确地规范 Rust 类型检查器总体工作的一部分来推进。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-destructors"><a class="rule-link" href="#r-destructors" title="destructors"><span>[destructors]</span></a>
</div>

<h1 id="析构函数"><a class="header" href="#析构函数">析构函数</a></h1>
<div class="rule" id="r-destructors.intro"><a class="rule-link" href="#r-destructors.intro" title="destructors.intro"><span>[destructors<wbr>.intro]</span></a>
</div>

<p>当一个 <a href="#initialized">已初始化</a> <a href="#变量">变量</a> 或 <a href="#temporaries">临时变量</a> 离开 <a href="#drop-scopes">作用域</a> 时，其 <em>析构函数</em> 会被运行，或者说它被 <em>销毁(dropped)</em>。 <a href="#assignment-expressions">赋值</a> 也会运行其左侧操作数（如果已初始化）的析构函数。如果一个变量已被部分初始化，则仅销毁其已初始化的字段。</p>
<div class="rule" id="r-destructors.operation"><a class="rule-link" href="#r-destructors.operation" title="destructors.operation"><span>[destructors<wbr>.operation]</span></a>
</div>

<p>类型 <code>T</code> 的析构函数由以下部分组成：</p>
<ol>
<li>如果 <code>T: Drop</code>，则调用 <a href="../core/ops/drop/trait.Drop.html#tymethod.drop"><code>&lt;T as core::ops::Drop&gt;::drop</code></a></li>
<li>递归运行其所有字段的析构函数。
<ul>
<li><a href="#结构体类型">结构体</a> 的字段按声明顺序销毁。</li>
<li>活跃 <a href="#枚举类型">枚举变体</a> 的字段按声明顺序销毁。</li>
<li><a href="#元组类型">元组</a> 的字段按顺序销毁。</li>
<li><a href="#数组类型">数组</a> 或拥有所有权的 <a href="#切片类型">切片</a> 的元素从第一个元素到最后一个元素依次销毁。</li>
<li><a href="#闭包类型">闭包</a> 通过移动(move)捕获的变量按未指定的顺序销毁。</li>
<li><a href="#特型对象">特型对象</a> 运行底层类型的析构函数。</li>
<li>其他类型不会导致进一步的销毁操作。</li>
</ul>
</li>
</ol>
<div class="rule" id="r-destructors.drop_in_place"><a class="rule-link" href="#r-destructors.drop_in_place" title="destructors.drop_in_place"><span>[destructors<wbr>.drop_in_place]</span></a>
</div>

<p>如果必须手动运行析构函数（例如在实现自己的智能指针时），可以使用 <a href="../core/ptr/fn.drop_in_place.html"><code>core::ptr::drop_in_place</code></a> 。</p>
<p>一些示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct PrintOnDrop(&amp;'static str);

impl Drop for PrintOnDrop {
    fn drop(&amp;mut self) {
        println!("{}", self.0);
    }
}

let mut overwritten = PrintOnDrop("drops when overwritten");
overwritten = PrintOnDrop("drops when scope ends"); // 覆盖时销毁

let tuple = (PrintOnDrop("Tuple first"), PrintOnDrop("Tuple second"));

let moved;
// 赋值时不运行析构函数。
moved = PrintOnDrop("Drops when moved");
// 现在销毁，但之后变为未初始化状态。
moved;

// 未初始化不会销毁。
let uninitialized: PrintOnDrop;

// 部分移动后，仅销毁剩余字段。
let mut partial_move = (PrintOnDrop("first"), PrintOnDrop("forgotten"));
// 执行部分移动，仅保留 `partial_move.0` 为初始化状态。
core::mem::forget(partial_move.1);
// 当 partial_move 的作用域结束时，仅销毁第一个字段。
<span class="boring">}</span></code></pre>
<div class="rule" id="r-destructors.scope"><a class="rule-link" href="#r-destructors.scope" title="destructors.scope"><span>[destructors<wbr>.scope]</span></a>
</div>

<h2 id="销毁作用域"><a class="header" href="#销毁作用域">销毁作用域</a></h2>
<div class="rule" id="r-destructors.scope.intro"><a class="rule-link" href="#r-destructors.scope.intro" title="destructors.scope.intro"><span>[destructors<wbr>.scope<wbr>.intro]</span></a>
</div>

<p>每个变量或临时变量都与一个 <em>销毁作用域</em> 相关联。当控制流离开销毁作用域时，与该作用域相关的所有变量都将按声明（对于变量）或创建（对于临时变量）的逆序进行销毁。</p>
<div class="rule" id="r-destructors.scope.desugaring"><a class="rule-link" href="#r-destructors.scope.desugaring" title="destructors.scope.desugaring"><span>[destructors<wbr>.scope<wbr>.desugaring]</span></a>
</div>

<p>可以通过使用 <a href="#match表达式"><code>match</code></a> 、 <a href="#infinite-loops"><code>loop</code></a> 和 <code>break</code> 将 <a href="#iterator-loops"><code>for</code></a> 、 <a href="#if-expressions"><code>if</code></a> 和 <a href="#predicate-loops"><code>while</code></a> 表达式替换为等效表达式来确定销毁作用域。</p>
<div class="rule" id="r-destructors.scope.operators"><a class="rule-link" href="#r-destructors.scope.operators" title="destructors.scope.operators"><span>[destructors<wbr>.scope<wbr>.operators]</span></a>
</div>

<p>重载运算符与内置运算符不作区分，且不考虑 <a href="#binding-modes">绑定模式</a> 。</p>
<div class="rule" id="r-destructors.scope.list"><a class="rule-link" href="#r-destructors.scope.list" title="destructors.scope.list"><span>[destructors<wbr>.scope<wbr>.list]</span></a>
</div>

<p>给定一个函数或闭包，存在以下销毁作用域：</p>
<div class="rule" id="r-destructors.scope.function"><a class="rule-link" href="#r-destructors.scope.function" title="destructors.scope.function"><span>[destructors<wbr>.scope<wbr>.function]</span></a>
</div>

<ul>
<li>整个函数</li>
</ul>
<div class="rule" id="r-destructors.scope.statement"><a class="rule-link" href="#r-destructors.scope.statement" title="destructors.scope.statement"><span>[destructors<wbr>.scope<wbr>.statement]</span></a>
</div>

<ul>
<li>每个 <a href="#语句">语句</a></li>
</ul>
<div class="rule" id="r-destructors.scope.expression"><a class="rule-link" href="#r-destructors.scope.expression" title="destructors.scope.expression"><span>[destructors<wbr>.scope<wbr>.expression]</span></a>
</div>

<ul>
<li>每个 <a href="#表达式">表达式</a></li>
</ul>
<div class="rule" id="r-destructors.scope.block"><a class="rule-link" href="#r-destructors.scope.block" title="destructors.scope.block"><span>[destructors<wbr>.scope<wbr>.block]</span></a>
</div>

<ul>
<li>每个块，包括函数体
<ul>
<li>在 <a href="#块表达式">块表达式</a> 的情况下，块的作用域和表达式的作用域是同一个作用域。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-destructors.scope.match-arm"><a class="rule-link" href="#r-destructors.scope.match-arm" title="destructors.scope.match-arm"><span>[destructors<wbr>.scope<wbr>.match-arm]</span></a>
</div>

<ul>
<li><code>match</code> 表达式的每个分支(arm)</li>
</ul>
<div class="rule" id="r-destructors.scope.nesting"><a class="rule-link" href="#r-destructors.scope.nesting" title="destructors.scope.nesting"><span>[destructors<wbr>.scope<wbr>.nesting]</span></a>
</div>

<p>销毁作用域按如下方式相互嵌套。当同时离开多个作用域时（例如从函数返回时），变量按从内向外的顺序销毁。</p>
<div class="rule" id="r-destructors.scope.nesting.function"><a class="rule-link" href="#r-destructors.scope.nesting.function" title="destructors.scope.nesting.function"><span>[destructors<wbr>.scope<wbr>.nesting<wbr>.function]</span></a>
</div>

<ul>
<li>整个函数作用域是最外层作用域。</li>
</ul>
<div class="rule" id="r-destructors.scope.nesting.function-body"><a class="rule-link" href="#r-destructors.scope.nesting.function-body" title="destructors.scope.nesting.function-body"><span>[destructors<wbr>.scope<wbr>.nesting<wbr>.function-body]</span></a>
</div>

<ul>
<li>函数体块包含在整个函数的作用域内。</li>
</ul>
<div class="rule" id="r-destructors.scope.nesting.expr-statement"><a class="rule-link" href="#r-destructors.scope.nesting.expr-statement" title="destructors.scope.nesting.expr-statement"><span>[destructors<wbr>.scope<wbr>.nesting<wbr>.expr-statement]</span></a>
</div>

<ul>
<li>表达式语句中表达式的父作用域是该语句的作用域。</li>
</ul>
<div class="rule" id="r-destructors.scope.nesting.let-initializer"><a class="rule-link" href="#r-destructors.scope.nesting.let-initializer" title="destructors.scope.nesting.let-initializer"><span>[destructors<wbr>.scope<wbr>.nesting<wbr>.let-initializer]</span></a>
</div>

<ul>
<li><a href="#let-statements"><code>let</code> 语句</a> 的初始化器的父作用域是该 <code>let</code> 语句的作用域。</li>
</ul>
<div class="rule" id="r-destructors.scope.nesting.statement"><a class="rule-link" href="#r-destructors.scope.nesting.statement" title="destructors.scope.nesting.statement"><span>[destructors<wbr>.scope<wbr>.nesting<wbr>.statement]</span></a>
</div>

<ul>
<li>语句作用域的父作用域是包含该语句的块的作用域。</li>
</ul>
<div class="rule" id="r-destructors.scope.nesting.match-guard"><a class="rule-link" href="#r-destructors.scope.nesting.match-guard" title="destructors.scope.nesting.match-guard"><span>[destructors<wbr>.scope<wbr>.nesting<wbr>.match-guard]</span></a>
</div>

<ul>
<li><code>match</code> 守卫(guard)表达式的父作用域是该守卫所属分支的作用域。</li>
</ul>
<div class="rule" id="r-destructors.scope.nesting.match-arm"><a class="rule-link" href="#r-destructors.scope.nesting.match-arm" title="destructors.scope.nesting.match-arm"><span>[destructors<wbr>.scope<wbr>.nesting<wbr>.match-arm]</span></a>
</div>

<ul>
<li><code>match</code> 表达式中 <code>=&gt;</code> 之后表达式的父作用域是该表达式所属分支的作用域。</li>
</ul>
<div class="rule" id="r-destructors.scope.nesting.match"><a class="rule-link" href="#r-destructors.scope.nesting.match" title="destructors.scope.nesting.match"><span>[destructors<wbr>.scope<wbr>.nesting<wbr>.match]</span></a>
</div>

<ul>
<li>分支作用域的父作用域是该分支所属 <code>match</code> 表达式的作用域。</li>
</ul>
<div class="rule" id="r-destructors.scope.nesting.other"><a class="rule-link" href="#r-destructors.scope.nesting.other" title="destructors.scope.nesting.other"><span>[destructors<wbr>.scope<wbr>.nesting<wbr>.other]</span></a>
</div>

<ul>
<li>所有其他作用域的父作用域是直接包围它们的表达式的作用域。</li>
</ul>
<div class="rule" id="r-destructors.scope.params"><a class="rule-link" href="#r-destructors.scope.params" title="destructors.scope.params"><span>[destructors<wbr>.scope<wbr>.params]</span></a>
</div>

<h3 id="函数参数的作用域"><a class="header" href="#函数参数的作用域">函数参数的作用域</a></h3>
<p>所有函数参数都在整个函数体的作用域内，因此在评估函数时最后被销毁。每个实际的函数参数都在该参数模式中引入的任何绑定之后被销毁。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct PrintOnDrop(&amp;'static str);
</span><span class="boring">impl Drop for PrintOnDrop {
</span><span class="boring">    fn drop(&amp;mut self) {
</span><span class="boring">        println!("drop({})", self.0);
</span><span class="boring">    }
</span><span class="boring">}
</span>// 先销毁 `y`，然后是第二个参数，接着是 `x`，最后是第一个参数
fn patterns_in_parameters(
    (x, _): (PrintOnDrop, PrintOnDrop),
    (_, y): (PrintOnDrop, PrintOnDrop),
) {}

// 销毁顺序是 3 2 0 1
patterns_in_parameters(
    (PrintOnDrop("0"), PrintOnDrop("1")),
    (PrintOnDrop("2"), PrintOnDrop("3")),
);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-destructors.scope.bindings"><a class="rule-link" href="#r-destructors.scope.bindings" title="destructors.scope.bindings"><span>[destructors<wbr>.scope<wbr>.bindings]</span></a>
</div>

<h3 id="局部变量的作用域"><a class="header" href="#局部变量的作用域">局部变量的作用域</a></h3>
<div class="rule" id="r-destructors.scope.bindings.intro"><a class="rule-link" href="#r-destructors.scope.bindings.intro" title="destructors.scope.bindings.intro"><span>[destructors<wbr>.scope<wbr>.bindings<wbr>.intro]</span></a>
</div>

<p>在 <code>let</code> 语句中声明的局部变量与包含该 <code>let</code> 语句的块的作用域相关联。在 <code>match</code> 表达式中声明的局部变量与它们所声明的 <code>match</code> 分支作用域相关联。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct PrintOnDrop(&amp;'static str);
</span><span class="boring">impl Drop for PrintOnDrop {
</span><span class="boring">    fn drop(&amp;mut self) {
</span><span class="boring">        println!("drop({})", self.0);
</span><span class="boring">    }
</span><span class="boring">}
</span>let declared_first = PrintOnDrop("Dropped last in outer scope");
{
    let declared_in_block = PrintOnDrop("Dropped in inner scope");
}
let declared_last = PrintOnDrop("Dropped first in outer scope");
<span class="boring">}</span></code></pre>
<div class="rule" id="r-destructors.scope.bindings.patterns"><a class="rule-link" href="#r-destructors.scope.bindings.patterns" title="destructors.scope.bindings.patterns"><span>[destructors<wbr>.scope<wbr>.bindings<wbr>.patterns]</span></a>
</div>

<p>模式中的变量按模式内声明顺序的逆序销毁。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct PrintOnDrop(&amp;'static str);
</span><span class="boring">impl Drop for PrintOnDrop {
</span><span class="boring">    fn drop(&amp;mut self) {
</span><span class="boring">        println!("drop({})", self.0);
</span><span class="boring">    }
</span><span class="boring">}
</span>let (declared_first, declared_last) = (
    PrintOnDrop("Dropped last"),
    PrintOnDrop("Dropped first"),
);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-destructors.scope.bindings.or-patterns"><a class="rule-link" href="#r-destructors.scope.bindings.or-patterns" title="destructors.scope.bindings.or-patterns"><span>[destructors<wbr>.scope<wbr>.bindings<wbr>.or-patterns]</span></a>
</div>

<p>出于销毁顺序的目的， <a href="#or-patterns">或模式</a> 按第一个子模式给出的顺序声明绑定。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct PrintOnDrop(&amp;'static str);
</span><span class="boring">impl Drop for PrintOnDrop {
</span><span class="boring">    fn drop(&amp;mut self) {
</span><span class="boring">        println!("drop({})", self.0);
</span><span class="boring">    }
</span><span class="boring">}
</span>// 先销毁 `x` 后销毁 `y`。
fn or_pattern_drop_order&lt;T&gt;(
    (Ok([x, y]) | Err([y, x])): Result&lt;[T; 2], [T; 2]&gt;
//   ^^^^^^^^^^   ^^^^^^^^^^^ 这是第二个子模式。
//   |
//   这是第一个子模式。
//
//   在第一个子模式中，`x` 在 `y` 之前声明。由于它是
//   第一个子模式，即使匹配的是第二个子模式（其中绑定的声明顺序相反），
//   也会使用该顺序。
) {}

// 这里我们匹配第一个子模式，销毁按第一个子模式中的声明顺序发生。
or_pattern_drop_order(Ok([
    PrintOnDrop("Declared first, dropped last"),
    PrintOnDrop("Declared last, dropped first"),
]));

// 这里我们匹配第二个子模式，销毁仍按第一个子模式中的声明顺序发生。
or_pattern_drop_order(Err([
    PrintOnDrop("Declared last, dropped first"),
    PrintOnDrop("Declared first, dropped last"),
]));
<span class="boring">}</span></code></pre>
<div class="rule" id="r-destructors.scope.temporary"><a class="rule-link" href="#r-destructors.scope.temporary" title="destructors.scope.temporary"><span>[destructors<wbr>.scope<wbr>.temporary]</span></a>
</div>

<h3 id="临时作用域"><a class="header" href="#临时作用域">临时作用域</a></h3>
<div class="rule" id="r-destructors.scope.temporary.intro"><a class="rule-link" href="#r-destructors.scope.temporary.intro" title="destructors.scope.temporary.intro"><span>[destructors<wbr>.scope<wbr>.temporary<wbr>.intro]</span></a>
</div>

<p>表达式的 <em>临时作用域</em> 是指当表达式用于 <a href="#位置表达式和值表达式">位置上下文</a> 时，用于持有该表达式结果的临时变量的作用域，除非该表达式被 <a href="#constant-promotion">提升</a> 。</p>
<div class="rule" id="r-destructors.scope.temporary.enclosing"><a class="rule-link" href="#r-destructors.scope.temporary.enclosing" title="destructors.scope.temporary.enclosing"><span>[destructors<wbr>.scope<wbr>.temporary<wbr>.enclosing]</span></a>
</div>

<p>除生命周期延长外，表达式的临时作用域是包含该表达式的最小作用域，且为以下之一：</p>
<ul>
<li>整个函数。</li>
<li>一个语句。</li>
<li><a href="#if-expressions"><code>if</code></a> 、 <a href="#predicate-loops"><code>while</code></a> 或 <a href="#infinite-loops"><code>loop</code></a> 表达式的体部。</li>
<li><code>if</code> 表达式的 <code>else</code> 块。</li>
<li><code>if</code> 或 <code>while</code> 表达式中非模式匹配的条件表达式，或 <code>match</code> 守卫。</li>
<li>match 分支的体表达式。</li>
<li><a href="#lazy-boolean-operators">惰性布尔表达式</a> 的每个操作数。</li>
<li><a href="#if-expressions"><code>if</code></a> 的模式匹配条件及随后的体部 (<a href="#r-destructors.scope.temporary.edition2024">destructors.scope.temporary.edition2024</a>)。</li>
<li><a href="#predicate-loops"><code>while</code></a> 的模式匹配条件和循环体。</li>
<li>块的尾随表达式的整体 (<a href="#r-destructors.scope.temporary.edition2024">destructors.scope.temporary.edition2024</a>)。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>match</code> 表达式的 <a href="#scrutinee">受查表达式</a> 不是临时作用域，因此受查表达式中的临时变量可以在 <code>match</code> 表达式之后销毁。例如， <code>match 1 { ref mut z =&gt; z };</code> 中 <code>1</code> 的临时变量存活到语句结束。</p>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><a href="#r-expr.assign.destructure">解构赋值</a> 的脱糖限制了其赋值操作数（右侧值）的临时作用域。有关详细信息，请参阅 <a href="#r-expr.assign.destructure.tmp-scopes">expr.assign.destructure.tmp-scopes</a> 。</p>
</blockquote>
</div>

<div class="rule" id="r-destructors.scope.temporary.edition2024"><a class="rule-link" href="#r-destructors.scope.temporary.edition2024" title="destructors.scope.temporary.edition2024"><span>[destructors<wbr>.scope<wbr>.temporary<wbr>.edition2024]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2024</span> 版次差异</p>

<p>2024 版次增加了两条新的临时作用域收窄规则： <code>if let</code> 临时变量在 <code>else</code> 块之前销毁，块的尾随表达式的临时变量在尾随表达式评估后立即销毁。</p>
</blockquote>
</div>

<p>一些示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#![allow(irrefutable_let_patterns)]
</span><span class="boring">struct PrintOnDrop(&amp;'static str);
</span><span class="boring">impl Drop for PrintOnDrop {
</span><span class="boring">    fn drop(&amp;mut self) {
</span><span class="boring">        println!("drop({})", self.0);
</span><span class="boring">    }
</span><span class="boring">}
</span>let local_var = PrintOnDrop("local var");

// 一旦条件评估完毕就会被销毁
if PrintOnDrop("If condition").0 == "If condition" {
    // 在块结束时销毁
    PrintOnDrop("If body").0
} else {
    unreachable!()
};

if let "if let scrutinee" = PrintOnDrop("if let scrutinee").0 {
    PrintOnDrop("if let consequent").0
    // `if let consequent` 在此处销毁
}
// `if let scrutinee` 在此处销毁
else {
    PrintOnDrop("if let else").0
    // `if let else` 在此处销毁
};

while let x = PrintOnDrop("while let scrutinee").0 {
    PrintOnDrop("while let loop body").0;
    break;
    // `while let loop body` 在此处销毁。
    // `while let scrutinee` 在此处销毁。
}

// 在第一个 || 之前销毁
(PrintOnDrop("first operand").0 == ""
// 在 ) 之前销毁
|| PrintOnDrop("second operand").0 == "")
// 在 ; 之前销毁
|| PrintOnDrop("third operand").0 == "";

// 受查表达式在函数结束时、局部变量之前销毁
// （因为这是函数体块的尾随表达式）。
match PrintOnDrop("Matched value in final expression") {
    // 一旦条件评估完毕就会被销毁
    _ if PrintOnDrop("guard condition").0 == "" =&gt; (),
    _ =&gt; (),
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-destructors.scope.operands"><a class="rule-link" href="#r-destructors.scope.operands" title="destructors.scope.operands"><span>[destructors<wbr>.scope<wbr>.operands]</span></a>
</div>

<h3 id="操作数"><a class="header" href="#操作数">操作数</a></h3>
<p>在评估表达式的其他操作数时，也会创建临时变量来持有该表达式的操作数结果。这些临时变量与具有该操作数的表达式的作用域相关联。由于一旦表达式评估完毕，临时变量就会被移走，因此销毁它们没有影响，除非表达式的一个操作数跳出了表达式、返回或发生了 <a href="#恐慌">恐慌</a> 。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct PrintOnDrop(&amp;'static str);
</span><span class="boring">impl Drop for PrintOnDrop {
</span><span class="boring">    fn drop(&amp;mut self) {
</span><span class="boring">        println!("drop({})", self.0);
</span><span class="boring">    }
</span><span class="boring">}
</span>loop {
    // 元组表达式未完成评估，因此操作数按逆序销毁
    (
        PrintOnDrop("Outer tuple first"),
        PrintOnDrop("Outer tuple second"),
        (
            PrintOnDrop("Inner tuple first"),
            PrintOnDrop("Inner tuple second"),
            break,
        ),
        PrintOnDrop("Never created"),
    );
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-destructors.scope.const-promotion"><a class="rule-link" href="#r-destructors.scope.const-promotion" title="destructors.scope.const-promotion"><span>[destructors<wbr>.scope<wbr>.const-promotion]</span></a>
</div>

<h3 id="常量提升"><a class="header" href="#常量提升">常量提升</a></h3>
<p>当一个值表达式可以写在常量中并被借用，且该借用可以在表达式最初编写的地方被解引用而不会改变运行时行为时，就会发生将该表达式提升到 <code>'static</code> 槽位的操作。也就是说，被提升的表达式可以在编译时评估，且结果值不包含 <a href="#内部可变性">内部可变性</a> 或 <a href="#析构函数">析构函数</a> （这些属性尽可能根据值来确定，例如 <code>&amp;None</code> 始终具有类型 <code>&amp;'static Option&lt;_&gt;</code> ，因为它不包含任何被禁止的内容）。</p>
<div class="rule" id="r-destructors.scope.lifetime-extension"><a class="rule-link" href="#r-destructors.scope.lifetime-extension" title="destructors.scope.lifetime-extension"><span>[destructors<wbr>.scope<wbr>.lifetime-extension]</span></a>
</div>

<h3 id="临时生命周期延长"><a class="header" href="#临时生命周期延长">临时生命周期延长</a></h3>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>临时生命周期延长的具体规则可能会发生变化。此处仅描述当前行为。</p>
</blockquote>
</div>

<div class="rule" id="r-destructors.scope.lifetime-extension.let"><a class="rule-link" href="#r-destructors.scope.lifetime-extension.let" title="destructors.scope.lifetime-extension.let"><span>[destructors<wbr>.scope<wbr>.lifetime-extension<wbr>.let]</span></a>
</div>

<p>在 <code>let</code> 语句中，表达式的临时作用域有时会 <em>延长</em> 到包含该 <code>let</code> 语句的块的作用域。根据某些语法规则，当通常的临时作用域太小时会执行此操作。例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = &amp;mut 0;
// 通常临时变量现在已经被销毁了，但 `0` 的临时变量
// 存活到块结束。
println!("{}", x);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-destructors.scope.lifetime-extension.static"><a class="rule-link" href="#r-destructors.scope.lifetime-extension.static" title="destructors.scope.lifetime-extension.static"><span>[destructors<wbr>.scope<wbr>.lifetime-extension<wbr>.static]</span></a>
</div>

<p>生命周期延长也适用于 <code>static</code> 和 <code>const</code> 项 ，这使得临时变量存活到程序结束。例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>const C: &amp;Vec&lt;i32&gt; = &amp;Vec::new();
// 通常这将是一个悬空引用，因为 `Vec` 仅存在于 `C` 的
// 初始化表达式内部，但这里的借用被延长了生命周期，
// 因此它实际上具有 `'static` 生命周期。
println!("{:?}", C);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-destructors.scope.lifetime-extension.sub-expressions"><a class="rule-link" href="#r-destructors.scope.lifetime-extension.sub-expressions" title="destructors.scope.lifetime-extension.sub-expressions"><span>[destructors<wbr>.scope<wbr>.lifetime-extension<wbr>.sub-expressions]</span></a>
</div>

<p>如果 <a href="#r-expr.operator.borrow">借用</a> 、 <a href="#the-dereference-operator">解引用表达式</a> 、 <a href="#字段访问表达式">字段表达式</a> 或 <a href="#tuple-indexing-expressions">元组索引表达式</a> 具有延长的临时作用域，则其操作数也具有。如果 <a href="#array-and-slice-indexing-expressions">索引表达式</a> 具有延长的临时作用域，则被索引的表达式也具有延长的临时作用域。</p>
<div class="rule" id="r-destructors.scope.lifetime-extension.patterns"><a class="rule-link" href="#r-destructors.scope.lifetime-extension.patterns" title="destructors.scope.lifetime-extension.patterns"><span>[destructors<wbr>.scope<wbr>.lifetime-extension<wbr>.patterns]</span></a>
</div>

<h4 id="基于模式的延长"><a class="header" href="#基于模式的延长">基于模式的延长</a></h4>
<div class="rule" id="r-destructors.scope.lifetime-extension.patterns.extending"><a class="rule-link" href="#r-destructors.scope.lifetime-extension.patterns.extending" title="destructors.scope.lifetime-extension.patterns.extending"><span>[destructors<wbr>.scope<wbr>.lifetime-extension<wbr>.patterns<wbr>.extending]</span></a>
</div>

<p>一个 <em>延长模式</em> 是以下之一：</p>
<ul>
<li>
<p>通过引用或可变引用绑定的 <a href="#identifier-patterns">标识符模式</a> 。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() {}
</span>let ref x = temp(); // 通过引用绑定。
<span class="boring">x;
</span>let ref mut x = temp(); // 通过可变引用绑定。
<span class="boring">x;
</span><span class="boring">}</span></code></pre>
</li>
<li>
<p><a href="#struct-patterns">结构体模式</a> 、 <a href="#tuple-patterns">元组模式</a> 、 <a href="#tuple-struct-patterns">元组结构体模式</a> 、 <a href="#slice-patterns">切片模式</a> 或 <a href="#or-patterns">或模式</a> ，其中至少一个直接子模式是延长模式。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use core::sync::atomic::{AtomicU64, Ordering::Relaxed};
</span><span class="boring">static X: AtomicU64 = AtomicU64::new(0);
</span>struct W&lt;T&gt;(T);
<span class="boring">impl&lt;T&gt; Drop for W&lt;T&gt; { fn drop(&amp;mut self) { X.fetch_add(1, Relaxed); } }
</span>let W { 0: ref x } = W(()); // 结构体模式。
<span class="boring">x;
</span>let W(ref x) = W(()); // 元组结构体模式。
<span class="boring">x;
</span>let (W(ref x),) = (W(()),); // 元组模式。
<span class="boring">x;
</span>let [W(ref x), ..] = [W(())]; // 切片模式。
<span class="boring">x;
</span>let (Ok(W(ref x)) | Err(&amp;ref x)) = Ok(W(())); // 或模式。
<span class="boring">x;
</span>//
// 以上所有临时变量在这里仍然存活。
<span class="boring">assert_eq!(0, X.load(Relaxed));
</span><span class="boring">}</span></code></pre>
</li>
</ul>
<p>因此 <code>ref x</code> 、 <code>V(ref x)</code> 和 <code>[ref x, y]</code> 都是延长模式，但 <code>x</code> 、 <code>&amp;ref x</code> 和 <code>&amp;(ref x,)</code> 则不是。</p>
<div class="rule" id="r-destructors.scope.lifetime-extension.patterns.let"><a class="rule-link" href="#r-destructors.scope.lifetime-extension.patterns.let" title="destructors.scope.lifetime-extension.patterns.let"><span>[destructors<wbr>.scope<wbr>.lifetime-extension<wbr>.patterns<wbr>.let]</span></a>
</div>

<p>如果 <code>let</code> 语句中的模式是延长模式，则初始化器表达式的临时作用域将被延长。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() {}
</span>// 这是一个延长模式，因此临时作用域被延长。
let ref x = *&amp;temp(); // 正常
<span class="boring">x;
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0716 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() {}
</span>// 这既不是延长模式也不是延长表达式，
// 因此临时变量在分号处销毁。
let &amp;ref x = *&amp;&amp;temp(); // 错误
<span class="boring">x;
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() {}
</span>// 这不是延长模式，但它是一个延长表达式，
// 因此临时变量存活超过了 `let` 语句。
let &amp;ref x = &amp;*&amp;temp(); // 正常
<span class="boring">x;
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-destructors.scope.lifetime-extension.exprs"><a class="rule-link" href="#r-destructors.scope.lifetime-extension.exprs" title="destructors.scope.lifetime-extension.exprs"><span>[destructors<wbr>.scope<wbr>.lifetime-extension<wbr>.exprs]</span></a>
</div>

<h4 id="基于表达式的延长"><a class="header" href="#基于表达式的延长">基于表达式的延长</a></h4>
<div class="rule" id="r-destructors.scope.lifetime-extension.exprs.extending"><a class="rule-link" href="#r-destructors.scope.lifetime-extension.exprs.extending" title="destructors.scope.lifetime-extension.exprs.extending"><span>[destructors<wbr>.scope<wbr>.lifetime-extension<wbr>.exprs<wbr>.extending]</span></a>
</div>

<p>对于带有初始化器的 let 语句， <em>延长表达式</em> 是以下表达式之一：</p>
<ul>
<li>初始化器表达式。</li>
<li>延长 <a href="#r-expr.operator.borrow">借用</a> 表达式的操作数。</li>
<li>延长 <a href="#r-expr.super-macros">超级宏调用</a> 表达式的 <a href="#r-expr.super-macros">超级操作数</a> 。</li>
<li>延长 <a href="#array-expressions">数组表达式</a> 、 <a href="#type-cast-expressions">转换表达式</a> 、 <a href="#结构体表达式">大括号结构体表达式</a> 或 <a href="#tuple-expressions">元组表达式</a> 的操作数。</li>
<li>延长 <a href="#r-type.struct.tuple">元组结构体</a> 或 <a href="#r-type.enum.declaration">元组枚举变体</a> 构造器表达式的参数。</li>
<li>延长 <a href="#块表达式">块表达式</a> 的最终表达式（异步块表达式 <a href="#r-expr.block.async">async block expression</a> 除外）。</li>
<li>延长 <a href="#if-expressions"><code>if</code></a> 表达式的 <code>consequent</code> 、 <code>else if</code> 或 <code>else</code> 块的最终表达式。</li>
<li>延长 <a href="#match表达式"><code>match</code></a> 表达式的分支表达式。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><a href="#r-expr.assign.destructure">解构赋值</a> 的脱糖使其赋值操作数（右侧值）成为新引入块内的延长表达式。有关详细信息，请参阅 <a href="#r-expr.assign.destructure.tmp-ext">expr.assign.destructure.tmp-ext</a> 。</p>
</blockquote>
</div>

<p>因此 <code>&amp;mut 0</code> 、 <code>(&amp;1, &amp;mut 2)</code> 和 <code>Some(&amp;mut 3)</code> 中的借用表达式都是延长表达式。而 <code>&amp;0 + &amp;1</code> 和 <code>f(&amp;mut 0)</code> 中的借用则不是。</p>
<div class="rule" id="r-destructors.scope.lifetime-extension.exprs.borrows"><a class="rule-link" href="#r-destructors.scope.lifetime-extension.exprs.borrows" title="destructors.scope.lifetime-extension.exprs.borrows"><span>[destructors<wbr>.scope<wbr>.lifetime-extension<wbr>.exprs<wbr>.borrows]</span></a>
</div>

<p>延长 <a href="#r-expr.operator.borrow">借用</a> 表达式的操作数其 <a href="#r-destructors.scope.temporary">临时作用域</a> 被 <a href="#r-destructors.scope.lifetime-extension">延长</a> 。</p>
<div class="rule" id="r-destructors.scope.lifetime-extension.exprs.super-macros"><a class="rule-link" href="#r-destructors.scope.lifetime-extension.exprs.super-macros" title="destructors.scope.lifetime-extension.exprs.super-macros"><span>[destructors<wbr>.scope<wbr>.lifetime-extension<wbr>.exprs<wbr>.super-macros]</span></a>
</div>

<p>延长 <a href="#r-expr.super-macros">超级宏调用</a> 表达式的 <a href="#r-expr.super-macros">超级临时变量</a> 其 <a href="#r-destructors.scope.temporary">作用域</a> 被 <a href="#r-destructors.scope.lifetime-extension">延长</a> 。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 不将延长 <a href="#数组类型">数组</a> 表达式的 <a href="#r-expr.array.repeat-operand">数组重复操作数</a> 视为延长表达式。是否应该这样做是一个悬而未决的问题。</p>
<p>有关详细信息，请参阅 <a href="https://github.com/rust-lang/rust/issues/146092">Rust issue #146092</a> 。</p>
</blockquote>
</div>

<h4 id="示例-5"><a class="header" href="#示例-5">示例</a></h4>
<p>以下是表达式具有延长临时作用域的一些示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use core::pin::pin;
</span><span class="boring">use core::sync::atomic::{AtomicU64, Ordering::Relaxed};
</span><span class="boring">static X: AtomicU64 = AtomicU64::new(0);
</span><span class="boring">#[derive(Debug)] struct S;
</span><span class="boring">impl Drop for S { fn drop(&amp;mut self) { X.fetch_add(1, Relaxed); } }
</span><span class="boring">const fn temp() -&gt; S { S }
</span>let x = &amp;temp(); // 借用的操作数。
<span class="boring">x;
</span>let x = &amp;raw const *&amp;temp(); // 原生借用的操作数。
<span class="boring">assert_eq!(X.load(Relaxed), 0);
</span>let x = &amp;temp() as &amp;dyn Send; // 转换的操作数。
<span class="boring">x;
</span>let x = (&amp;*&amp;temp(),); // 元组构造器的操作数。
<span class="boring">x;
</span>struct W&lt;T&gt;(T);
let x = W(&amp;temp()); // 元组结构体构造器的参数。
<span class="boring">x;
</span>let x = Some(&amp;temp()); // 元组枚举变体构造器的参数。
<span class="boring">x;
</span>let x = { [Some(&amp;temp())] }; // 块的最终表达式。
<span class="boring">x;
</span>let x = const { &amp;temp() }; // `const` 块的最终表达式。
<span class="boring">x;
</span>let x = unsafe { &amp;temp() }; // `unsafe` 块的最终表达式。
<span class="boring">x;
</span>let x = if true { &amp;temp() } else { &amp;temp() };
//              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
//           `if`/`else` 块的最终表达式。
<span class="boring">x;
</span>let x = match () { _ =&gt; &amp;temp() }; // `match` 分支表达式。
<span class="boring">x;
</span>let x = pin!(temp()); // 超级宏调用表达式的超级操作数。
<span class="boring">x;
</span>let x = pin!({ &amp;mut temp() }); // 同上。
<span class="boring">x;
</span>let x = format_args!("{:?}", temp()); // 同上。
<span class="boring">x;
</span>//
// 以上所有临时变量在这里仍然存活。
<span class="boring">assert_eq!(0, X.load(Relaxed));
</span><span class="boring">}</span></code></pre>
<p>以下是表达式不具有延长临时作用域的一些示例：</p>
<pre class="playground"><code class="language-rust compile_fail E0716 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() {}
</span>// 函数调用的参数不是延长表达式。临时变量在分号处销毁。
let x = core::convert::identity(&amp;temp()); // 错误
<span class="boring">x;
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0716 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() {}
</span><span class="boring">trait Use { fn use_temp(&amp;self) -&gt; &amp;Self { self } }
</span><span class="boring">impl Use for () {}
</span>// 方法调用的接收者不是延长表达式。
let x = (&amp;temp()).use_temp(); // 错误
<span class="boring">x;
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0716 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() {}
</span>// match 表达式的受查表达式不是延长表达式。
let x = match &amp;temp() { x =&gt; x }; // 错误
<span class="boring">x;
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0515 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() {}
</span>// `async` 块的最终表达式不是延长表达式。
let x = async { &amp;temp() }; // 错误
<span class="boring">x;
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0515 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() {}
</span>// 闭包的最终表达式不是延长表达式。
let x = || &amp;temp(); // 错误
<span class="boring">x;
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0716 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() {}
</span>// 循环 break 的操作数不是延长表达式。
let x = loop { break &amp;temp() }; // 错误
<span class="boring">x;
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0716 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() {}
</span>// 带有标签的 break 的操作数不是延长表达式。
let x = 'a: { break 'a &amp;temp() }; // 错误
<span class="boring">x;
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024 compile_fail E0716"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use core::pin::pin;
</span><span class="boring">fn temp() {}
</span>// 仅当调用是延长表达式时，`pin!` 的参数才是延长表达式。
// 由于它不是，内部块不是延长表达式，因此其尾随表达式中的
// 临时变量会立即销毁。
pin!({ &amp;temp() }); // 错误
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024 compile_fail E0716"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn temp() {}
</span>// 同上。
format_args!("{:?}", { &amp;temp() }); // 错误
<span class="boring">}</span></code></pre>
<div class="rule" id="r-destructors.forget"><a class="rule-link" href="#r-destructors.forget" title="destructors.forget"><span>[destructors<wbr>.forget]</span></a>
</div>

<h2 id="不运行析构函数"><a class="header" href="#不运行析构函数">不运行析构函数</a></h2>
<div class="rule" id="r-destructors.manually-suppressing"><a class="rule-link" href="#r-destructors.manually-suppressing" title="destructors.manually-suppressing"><span>[destructors<wbr>.manually-suppressing]</span></a>
</div>

<h3 id="手动抑制析构函数"><a class="header" href="#手动抑制析构函数">手动抑制析构函数</a></h3>
<p><a href="../core/mem/fn.forget.html"><code>core::mem::forget</code></a> 可用于防止运行变量的析构函数，而 <a href="../core/mem/manually_drop/struct.ManuallyDrop.html"><code>core::mem::ManuallyDrop</code></a> 提供了一个包装器来防止变量或字段被自动销毁。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>通过 <a href="../core/mem/fn.forget.html"><code>core::mem::forget</code></a> 或其他手段防止析构函数运行是安全的，即使它的类型不是 <code>'static</code> 。除了本文档定义的保证运行析构函数的地方外，为了健全性，类型 <em>不可</em> 安全地依赖于析构函数的运行。</p>
</blockquote>
</div>

<div class="rule" id="r-destructors.process-termination"><a class="rule-link" href="#r-destructors.process-termination" title="destructors.process-termination"><span>[destructors<wbr>.process-termination]</span></a>
</div>

<h3 id="无需展开的进程终止"><a class="header" href="#无需展开的进程终止">无需展开的进程终止</a></h3>
<p>有一些方法可以在不进行 <a href="#unwinding">展开</a> 的情况下终止进程，在这种情况下将不运行析构函数。</p>
<p>标准库提供了 <a href="../std/process/fn.exit.html"><code>std::process::exit</code></a> 和 <a href="../std/process/fn.abort.html"><code>std::process::abort</code></a> 来显式执行此操作。此外，如果 <a href="#r-panic.panic_handler.std">恐慌处理器</a> 设置为 <code>abort</code> ，发生恐慌时将始终终止进程而不运行析构函数。</p>
<p>还有一个需要注意的情况：当恐慌达到 <a href="#unwinding">非展开 ABI 边界</a> 时，要么不运行任何析构函数，要么运行直到该 ABI 边界为止的所有析构函数。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-lifetime-elision"><a class="rule-link" href="#r-lifetime-elision" title="lifetime-elision"><span>[lifetime-elision]</span></a>
</div>

<h1 id="生命周期省略"><a class="header" href="#生命周期省略">生命周期省略</a></h1>
<p>Rust 有一些规则允许在编译器可以推断出合理的默认选择的各种地方省略生命周期。</p>
<div class="rule" id="r-lifetime-elision.function"><a class="rule-link" href="#r-lifetime-elision.function" title="lifetime-elision.function"><span>[lifetime-elision<wbr>.function]</span></a>
</div>

<h2 id="函数中的生命周期省略"><a class="header" href="#函数中的生命周期省略">函数中的生命周期省略</a></h2>
<div class="rule" id="r-lifetime-elision.function.intro"><a class="rule-link" href="#r-lifetime-elision.function.intro" title="lifetime-elision.function.intro"><span>[lifetime-elision<wbr>.function<wbr>.intro]</span></a>
</div>

<p>为了使常用模式更符合人机工程学，生命周期参数可以在 <a href="#函数项类型">函数项</a> 、 <a href="#函数指针类型">函数指针</a> 和 <a href="#闭包类型">闭包特型</a> 签名中被 <em>省略</em> 。以下规则用于为省略的生命周期推断生命周期参数。</p>
<div class="rule" id="r-lifetime-elision.function.lifetimes-not-inferred"><a class="rule-link" href="#r-lifetime-elision.function.lifetimes-not-inferred" title="lifetime-elision.function.lifetimes-not-inferred"><span>[lifetime-elision<wbr>.function<wbr>.lifetimes-not-inferred]</span></a>
</div>

<p>省略无法推断的生命周期参数是错误的。</p>
<div class="rule" id="r-lifetime-elision.function.explicit-placeholder"><a class="rule-link" href="#r-lifetime-elision.function.explicit-placeholder" title="lifetime-elision.function.explicit-placeholder"><span>[lifetime-elision<wbr>.function<wbr>.explicit-placeholder]</span></a>
</div>

<p>占位符生命周期 <code>'_</code> 也可以用于以相同方式推断生命周期。对于路径中的生命周期，首选使用 <code>'_</code> 。</p>
<div class="rule" id="r-lifetime-elision.function.only-functions"><a class="rule-link" href="#r-lifetime-elision.function.only-functions" title="lifetime-elision.function.only-functions"><span>[lifetime-elision<wbr>.function<wbr>.only-functions]</span></a>
</div>

<p>特型对象生命周期遵循不同的规则，将在 <a href="#default-trait-object-lifetimes">下文</a> 讨论。</p>
<div class="rule" id="r-lifetime-elision.function.implicit-lifetime-parameters"><a class="rule-link" href="#r-lifetime-elision.function.implicit-lifetime-parameters" title="lifetime-elision.function.implicit-lifetime-parameters"><span>[lifetime-elision<wbr>.function<wbr>.implicit-lifetime-parameters]</span></a>
</div>

<ul>
<li>参数中每个省略的生命周期都成为一个独特的生命周期参数。</li>
</ul>
<div class="rule" id="r-lifetime-elision.function.output-lifetime"><a class="rule-link" href="#r-lifetime-elision.function.output-lifetime" title="lifetime-elision.function.output-lifetime"><span>[lifetime-elision<wbr>.function<wbr>.output-lifetime]</span></a>
</div>

<ul>
<li>如果参数中恰好使用了一个生命周期（无论是否省略），则该生命周期将分配给 <em>所有</em> 省略的输出生命周期。</li>
</ul>
<div class="rule" id="r-lifetime-elision.function.receiver-lifetime"><a class="rule-link" href="#r-lifetime-elision.function.receiver-lifetime" title="lifetime-elision.function.receiver-lifetime"><span>[lifetime-elision<wbr>.function<wbr>.receiver-lifetime]</span></a>
</div>

<p>在方法签名中还有另一条规则</p>
<ul>
<li>如果接收者的类型是 <code>&amp;Self</code> 或 <code>&amp;mut Self</code> ，那么指向 <code>Self</code> 的引用的生命周期将被分配给所有省略的输出生命周期参数。</li>
</ul>
<p>例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">trait T {}
</span><span class="boring">trait ToCStr {}
</span><span class="boring">struct Thing&lt;'a&gt; {f: &amp;'a i32}
</span><span class="boring">struct Command;
</span><span class="boring">
</span><span class="boring">trait Example {
</span>fn print1(s: &amp;str);                                   // 省略
fn print2(s: &amp;'_ str);                                // 同样省略
fn print3&lt;'a&gt;(s: &amp;'a str);                            // 展开

fn debug1(lvl: usize, s: &amp;str);                       // 省略
fn debug2&lt;'a&gt;(lvl: usize, s: &amp;'a str);                // 展开

fn substr1(s: &amp;str, until: usize) -&gt; &amp;str;            // 省略
fn substr2&lt;'a&gt;(s: &amp;'a str, until: usize) -&gt; &amp;'a str;  // 展开

fn get_mut1(&amp;mut self) -&gt; &amp;mut dyn T;                 // 省略
fn get_mut2&lt;'a&gt;(&amp;'a mut self) -&gt; &amp;'a mut dyn T;       // 展开

fn args1&lt;T: ToCStr&gt;(&amp;mut self, args: &amp;[T]) -&gt; &amp;mut Command;                  // 省略
fn args2&lt;'a, 'b, T: ToCStr&gt;(&amp;'a mut self, args: &amp;'b [T]) -&gt; &amp;'a mut Command; // 展开

fn other_args1&lt;'a&gt;(arg: &amp;str) -&gt; &amp;'a str;             // 省略
fn other_args2&lt;'a, 'b&gt;(arg: &amp;'b str) -&gt; &amp;'a str;      // 展开

fn new1(buf: &amp;mut [u8]) -&gt; Thing&lt;'_&gt;;                 // 省略 - 推荐做法
fn new2(buf: &amp;mut [u8]) -&gt; Thing;                     // 省略
fn new3&lt;'a&gt;(buf: &amp;'a mut [u8]) -&gt; Thing&lt;'a&gt;;          // 展开
<span class="boring">}
</span>
type FunPtr1 = fn(&amp;str) -&gt; &amp;str;                      // 省略
type FunPtr2 = for&lt;'a&gt; fn(&amp;'a str) -&gt; &amp;'a str;        // 展开

type FunTrait1 = dyn Fn(&amp;str) -&gt; &amp;str;                // 省略
type FunTrait2 = dyn for&lt;'a&gt; Fn(&amp;'a str) -&gt; &amp;'a str;  // 展开
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 以下示例展示了不允许省略生命周期参数的情况。

<span class="boring">trait Example {
</span>// 无法推断，因为没有可供推断的参数。
fn get_str() -&gt; &amp;str;                                 // 非法

// 无法推断，无法确定是从第一个还是第二个参数借用的。
fn frob(s: &amp;str, t: &amp;str) -&gt; &amp;str;                    // 非法
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-lifetime-elision.trait-object"><a class="rule-link" href="#r-lifetime-elision.trait-object" title="lifetime-elision.trait-object"><span>[lifetime-elision<wbr>.trait-object]</span></a>
</div>

<h2 id="默认特型对象生命周期"><a class="header" href="#默认特型对象生命周期">默认特型对象生命周期</a></h2>
<div class="rule" id="r-lifetime-elision.trait-object.intro"><a class="rule-link" href="#r-lifetime-elision.trait-object.intro" title="lifetime-elision.trait-object.intro"><span>[lifetime-elision<wbr>.trait-object<wbr>.intro]</span></a>
</div>

<p><a href="#特型对象">特型对象</a> 所持有的引用的假设生命周期被称为其 <em>默认对象生命周期界限</em> 。这些在 <a href="https://github.com/rust-lang/rfcs/blob/master/text/0599-default-object-bound.md">RFC 599</a> 中定义，并在 <a href="https://github.com/rust-lang/rfcs/blob/master/text/1156-adjust-default-object-bounds.md">RFC 1156</a> 中进行了修正。</p>
<div class="rule" id="r-lifetime-elision.trait-object.explicit-bound"><a class="rule-link" href="#r-lifetime-elision.trait-object.explicit-bound" title="lifetime-elision.trait-object.explicit-bound"><span>[lifetime-elision<wbr>.trait-object<wbr>.explicit-bound]</span></a>
</div>

<p>当生命周期界限被完全省略时，将使用这些默认对象生命周期界限，而不是上面定义的生命周期参数省略规则。</p>
<div class="rule" id="r-lifetime-elision.trait-object.explicit-placeholder"><a class="rule-link" href="#r-lifetime-elision.trait-object.explicit-placeholder" title="lifetime-elision.trait-object.explicit-placeholder"><span>[lifetime-elision<wbr>.trait-object<wbr>.explicit-placeholder]</span></a>
</div>

<p>如果使用 <code>'_</code> 作为生命周期界限，那么该界限遵循通常的省略规则。</p>
<div class="rule" id="r-lifetime-elision.trait-object.containing-type"><a class="rule-link" href="#r-lifetime-elision.trait-object.containing-type" title="lifetime-elision.trait-object.containing-type"><span>[lifetime-elision<wbr>.trait-object<wbr>.containing-type]</span></a>
</div>

<p>如果特型对象被用作泛型类型的类型参数，那么首先使用包含类型来尝试推断界限。</p>
<div class="rule" id="r-lifetime-elision.trait-object.containing-type-unique"><a class="rule-link" href="#r-lifetime-elision.trait-object.containing-type-unique" title="lifetime-elision.trait-object.containing-type-unique"><span>[lifetime-elision<wbr>.trait-object<wbr>.containing-type-unique]</span></a>
</div>

<ul>
<li>如果来自包含类型的界限是唯一的，那么它就是默认值</li>
</ul>
<div class="rule" id="r-lifetime-elision.trait-object.containing-type-explicit"><a class="rule-link" href="#r-lifetime-elision.trait-object.containing-type-explicit" title="lifetime-elision.trait-object.containing-type-explicit"><span>[lifetime-elision<wbr>.trait-object<wbr>.containing-type-explicit]</span></a>
</div>

<ul>
<li>如果来自包含类型的界限不止一个，则必须指定显式界限</li>
</ul>
<div class="rule" id="r-lifetime-elision.trait-object.trait-bounds"><a class="rule-link" href="#r-lifetime-elision.trait-object.trait-bounds" title="lifetime-elision.trait-object.trait-bounds"><span>[lifetime-elision<wbr>.trait-object<wbr>.trait-bounds]</span></a>
</div>

<p>如果这两条规则都不适用，则使用特型上的界限：</p>
<div class="rule" id="r-lifetime-elision.trait-object.trait-unique"><a class="rule-link" href="#r-lifetime-elision.trait-object.trait-unique" title="lifetime-elision.trait-object.trait-unique"><span>[lifetime-elision<wbr>.trait-object<wbr>.trait-unique]</span></a>
</div>

<ul>
<li>如果特型定义时带有一个单一的生命周期 <em>界限</em> ，则使用该界限。</li>
</ul>
<div class="rule" id="r-lifetime-elision.trait-object.static-lifetime"><a class="rule-link" href="#r-lifetime-elision.trait-object.static-lifetime" title="lifetime-elision.trait-object.static-lifetime"><span>[lifetime-elision<wbr>.trait-object<wbr>.static-lifetime]</span></a>
</div>

<ul>
<li>如果任何生命周期界限使用了 <code>'static</code> ，则使用 <code>'static</code> 。</li>
</ul>
<div class="rule" id="r-lifetime-elision.trait-object.default"><a class="rule-link" href="#r-lifetime-elision.trait-object.default" title="lifetime-elision.trait-object.default"><span>[lifetime-elision<wbr>.trait-object<wbr>.default]</span></a>
</div>

<ul>
<li>如果特型没有生命周期界限，那么在表达式中生命周期会被推断，在表达式之外则是 <code>'static</code> 。</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 对于以下特型...
trait Foo { }

// 这两者是相同的，因为 Box&lt;T&gt; 对 T 没有生命周期界限
type T1 = Box&lt;dyn Foo&gt;;
type T2 = Box&lt;dyn Foo + 'static&gt;;

// ...这些也是：
impl dyn Foo {}
impl dyn Foo + 'static {}

// ...这些也是，因为 &amp;'a T 要求 T: 'a
type T3&lt;'a&gt; = &amp;'a dyn Foo;
type T4&lt;'a&gt; = &amp;'a (dyn Foo + 'a);

// std::cell::Ref&lt;'a, T&gt; 也要求 T: 'a，所以这些是相同的
type T5&lt;'a&gt; = std::cell::Ref&lt;'a, dyn Foo&gt;;
type T6&lt;'a&gt; = std::cell::Ref&lt;'a, dyn Foo + 'a&gt;;
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 这是一个错误的例子。
<span class="boring">trait Foo { }
</span>struct TwoBounds&lt;'a, 'b, T: ?Sized + 'a + 'b&gt; {
    f1: &amp;'a i32,
    f2: &amp;'b i32,
    f3: T,
}
type T7&lt;'a, 'b&gt; = TwoBounds&lt;'a, 'b, dyn Foo&gt;;
//                                  ^^^^^^^
// 错误：无法从上下文中推断出此对象类型的生命周期界限
<span class="boring">}</span></code></pre>
<div class="rule" id="r-lifetime-elision.trait-object.innermost-type"><a class="rule-link" href="#r-lifetime-elision.trait-object.innermost-type" title="lifetime-elision.trait-object.innermost-type"><span>[lifetime-elision<wbr>.trait-object<wbr>.innermost-type]</span></a>
</div>

<p>请注意，最内层的对象设置了界限，因此 <code>&amp;'a Box&lt;dyn Foo&gt;</code> 仍然是 <code>&amp;'a Box&lt;dyn Foo + 'static&gt;</code> 。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 对于以下特型...
trait Bar&lt;'a&gt;: 'a { }

// ...这两者是相同的：
type T1&lt;'a&gt; = Box&lt;dyn Bar&lt;'a&gt;&gt;;
type T2&lt;'a&gt; = Box&lt;dyn Bar&lt;'a&gt; + 'a&gt;;

// ...这些也是：
impl&lt;'a&gt; dyn Bar&lt;'a&gt; {}
impl&lt;'a&gt; dyn Bar&lt;'a&gt; + 'a {}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-lifetime-elision.const-static"><a class="rule-link" href="#r-lifetime-elision.const-static" title="lifetime-elision.const-static"><span>[lifetime-elision<wbr>.const-static]</span></a>
</div>

<h2 id="const和-static省略"><a class="header" href="#const和-static省略"><code>const</code>和 <code>static</code>省略</a></h2>
<div class="rule" id="r-lifetime-elision.const-static.implicit-static"><a class="rule-link" href="#r-lifetime-elision.const-static.implicit-static" title="lifetime-elision.const-static.implicit-static"><span>[lifetime-elision<wbr>.const-static<wbr>.implicit-static]</span></a>
</div>

<p>引用类型的 <a href="#常量项">常量</a> 和 <a href="#静态项">静态</a> 声明除非指定了显式生命周期，否则都具有 <em>隐式</em> <code>'static</code> 生命周期。因此，上面涉及 <code>'static</code> 的常量声明可以在不写生命周期的情况下编写。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// STRING: &amp;'static str
const STRING: &amp;str = "bitstring";

struct BitsNStrings&lt;'a&gt; {
    mybits: [u32; 2],
    mystring: &amp;'a str,
}

// BITS_N_STRINGS: BitsNStrings&lt;'static&gt;
const BITS_N_STRINGS: BitsNStrings&lt;'_&gt; = BitsNStrings {
    mybits: [1, 2],
    mystring: STRING,
};
<span class="boring">}</span></code></pre>
<div class="rule" id="r-lifetime-elision.const-static.fn-references"><a class="rule-link" href="#r-lifetime-elision.const-static.fn-references" title="lifetime-elision.const-static.fn-references"><span>[lifetime-elision<wbr>.const-static<wbr>.fn-references]</span></a>
</div>

<p>请注意，如果 <code>static</code> 或 <code>const</code> 项 包含函数或闭包引用，而这些引用本身又包含引用，编译器将首先尝试标准的省略规则。如果无法通过通常规则解析生命周期，则会报错。例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct Foo;
</span><span class="boring">struct Bar;
</span><span class="boring">struct Baz;
</span><span class="boring">fn somefunc(a: &amp;Foo, b: &amp;Bar, c: &amp;Baz) -&gt; usize {42}
</span>// 解析为 `for&lt;'a&gt; fn(&amp;'a str) -&gt; &amp;'a str`。
const RESOLVED_SINGLE: fn(&amp;str) -&gt; &amp;str = |x| x;

// 解析为 `for&lt;'a, 'b, 'c&gt; Fn(&amp;'a Foo, &amp;'b Bar, &amp;'c Baz) -&gt; usize`。
const RESOLVED_MULTIPLE: &amp;dyn Fn(&amp;Foo, &amp;Bar, &amp;Baz) -&gt; usize = &amp;somefunc;
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">struct Foo;
</span><span class="boring">struct Bar;
</span><span class="boring">struct Baz;
</span><span class="boring">fn somefunc&lt;'a,'b&gt;(a: &amp;'a Foo, b: &amp;'b Bar) -&gt; &amp;'a Baz {unimplemented!()}
</span>// 没有足够的信息来确定返回引用的生命周期界限
// 与参数生命周期的关系，因此这是一个错误。
const RESOLVED_STATIC: &amp;dyn Fn(&amp;Foo, &amp;Bar) -&gt; &amp;Baz = &amp;somefunc;
//                                            ^
// 此函数的返回类型包含一个借用值，但签名
// 没有说明它是从参数 1 还是参数 2 借用的
<span class="boring">}</span></code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-lang-types"><a class="rule-link" href="#r-lang-types" title="lang-types"><span>[lang-types]</span></a>
</div>

<h1 id="特殊类型和特型"><a class="header" href="#特殊类型和特型">特殊类型和特型</a></h1>
<div class="rule" id="r-lang-types.intro"><a class="rule-link" href="#r-lang-types.intro" title="lang-types.intro"><span>[lang-types<wbr>.intro]</span></a>
</div>

<p><a href="../std/index.html">标准库</a> 中存在的某些类型和 特型 是 Rust 编译器所熟知的。本章记录了这些类型和 特型 的特殊 特性 。</p>
<div class="rule" id="r-lang-types.box"><a class="rule-link" href="#r-lang-types.box" title="lang-types.box"><span>[lang-types<wbr>.box]</span></a>
</div>

<h2 id="boxt"><a class="header" href="#boxt"><code>Box&lt;T&gt;</code></a></h2>
<div class="rule" id="r-lang-types.box.intro"><a class="rule-link" href="#r-lang-types.box.intro" title="lang-types.box.intro"><span>[lang-types<wbr>.box<wbr>.intro]</span></a>
</div>

<p><a href="../alloc/boxed/struct.Box.html"><code>Box&lt;T&gt;</code></a> 具有一些 Rust 目前不允许用户定义类型使用的特殊 特性 。</p>
<div class="rule" id="r-lang-types.box.deref"><a class="rule-link" href="#r-lang-types.box.deref" title="lang-types.box.deref"><span>[lang-types<wbr>.box<wbr>.deref]</span></a>
</div>

<ul>
<li><code>Box&lt;T&gt;</code> 的 <a href="#the-dereference-operator">解引用运算符</a> 会产生一个可以被移出的位置。这意味着 <code>*</code> 运算符和  <code>Box&lt;T&gt;</code> 的析构函数是内置在语言中的。</li>
</ul>
<div class="rule" id="r-lang-types.box.receiver"><a class="rule-link" href="#r-lang-types.box.receiver" title="lang-types.box.receiver"><span>[lang-types<wbr>.box<wbr>.receiver]</span></a>
</div>

<ul>
<li><a href="#associated-functions-and-methods">方法</a> 可以接收 <code>Box&lt;Self&gt;</code> 作为接收者。</li>
</ul>
<div class="rule" id="r-lang-types.box.fundamental"><a class="rule-link" href="#r-lang-types.box.fundamental" title="lang-types.box.fundamental"><span>[lang-types<wbr>.box<wbr>.fundamental]</span></a>
</div>

<ul>
<li>在与 <code>T</code> 相同的 crate 中，可以为 <code>Box&lt;T&gt;</code> 实现某个 特型 ，而 <a href="#trait-implementation-coherence">孤儿规则</a> 会阻止其他 泛型 类型这样做。</li>
</ul>
<!-- Editor Note: This is nowhere close to an exhaustive list -->
<div class="rule" id="r-lang-types.rc"><a class="rule-link" href="#r-lang-types.rc" title="lang-types.rc"><span>[lang-types<wbr>.rc]</span></a>
</div>

<h2 id="rct"><a class="header" href="#rct"><code>Rc&lt;T&gt;</code></a></h2>
<div class="rule" id="r-lang-types.rc.receiver"><a class="rule-link" href="#r-lang-types.rc.receiver" title="lang-types.rc.receiver"><span>[lang-types<wbr>.rc<wbr>.receiver]</span></a>
</div>

<p><a href="#associated-functions-and-methods">方法</a> 可以接收 <a href="../alloc/rc/struct.Rc.html"><code>Rc&lt;Self&gt;</code></a> 作为接收者。</p>
<div class="rule" id="r-lang-types.arc"><a class="rule-link" href="#r-lang-types.arc" title="lang-types.arc"><span>[lang-types<wbr>.arc]</span></a>
</div>

<h2 id="arct"><a class="header" href="#arct"><code>Arc&lt;T&gt;</code></a></h2>
<div class="rule" id="r-lang-types.arc.receiver"><a class="rule-link" href="#r-lang-types.arc.receiver" title="lang-types.arc.receiver"><span>[lang-types<wbr>.arc<wbr>.receiver]</span></a>
</div>

<p><a href="#associated-functions-and-methods">方法</a> 可以接收 <a href="../alloc/sync/struct.Arc.html"><code>Arc&lt;Self&gt;</code></a> 作为接收者。</p>
<div class="rule" id="r-lang-types.pin"><a class="rule-link" href="#r-lang-types.pin" title="lang-types.pin"><span>[lang-types<wbr>.pin]</span></a>
</div>

<h2 id="pinp"><a class="header" href="#pinp"><code>Pin&lt;P&gt;</code></a></h2>
<div class="rule" id="r-lang-types.pin.receiver"><a class="rule-link" href="#r-lang-types.pin.receiver" title="lang-types.pin.receiver"><span>[lang-types<wbr>.pin<wbr>.receiver]</span></a>
</div>

<p><a href="#associated-functions-and-methods">方法</a> 可以接收 <a href="../core/pin/struct.Pin.html"><code>Pin&lt;P&gt;</code></a> 作为接收者。</p>
<div class="rule" id="r-lang-types.unsafe-cell"><a class="rule-link" href="#r-lang-types.unsafe-cell" title="lang-types.unsafe-cell"><span>[lang-types<wbr>.unsafe-cell]</span></a>
</div>

<h2 id="unsafecellt"><a class="header" href="#unsafecellt"><code>UnsafeCell&lt;T&gt;</code></a></h2>
<div class="rule" id="r-lang-types.unsafe-cell.interior-mut"><a class="rule-link" href="#r-lang-types.unsafe-cell.interior-mut" title="lang-types.unsafe-cell.interior-mut"><span>[lang-types<wbr>.unsafe-cell<wbr>.interior-mut]</span></a>
</div>

<p><a href="../core/cell/struct.UnsafeCell.html"><code>std::cell::UnsafeCell&lt;T&gt;</code></a> 用于 <a href="#内部可变性">内部可变性</a> 。它确保编译器不会对这些类型执行错误的优化。</p>
<div class="rule" id="r-lang-types.unsafe-cell.read-only-alloc"><a class="rule-link" href="#r-lang-types.unsafe-cell.read-only-alloc" title="lang-types.unsafe-cell.read-only-alloc"><span>[lang-types<wbr>.unsafe-cell<wbr>.read-only-alloc]</span></a>
</div>

<p>它还确保具有内部可变性类型的 <a href="#静态项"><code>static</code> 项</a> 不会被放置在标记为只读的内存中。</p>
<div class="rule" id="r-lang-types.phantom-data"><a class="rule-link" href="#r-lang-types.phantom-data" title="lang-types.phantom-data"><span>[lang-types<wbr>.phantom-data]</span></a>
</div>

<h2 id="phantomdatat"><a class="header" href="#phantomdatat"><code>PhantomData&lt;T&gt;</code></a></h2>
<p><a href="../core/marker/struct.PhantomData.html"><code>std::marker::PhantomData&lt;T&gt;</code></a> 是一种零大小、最小对齐的类型，为了 <a href="#variance">型变</a> 、 <a href="../nomicon/dropck.html">析构检查</a> 和 <a href="#auto-traits">自动特型</a> 的目的，它被视为拥有一个 <code>T</code> 。</p>
<div class="rule" id="r-lang-types.ops"><a class="rule-link" href="#r-lang-types.ops" title="lang-types.ops"><span>[lang-types<wbr>.ops]</span></a>
</div>

<h2 id="运算符特型"><a class="header" href="#运算符特型">运算符特型</a></h2>
<p><a href="../core/ops/index.html"><code>std::ops</code></a> 和 <a href="../core/cmp/index.html"><code>std::cmp</code></a> 中的 特型 用于重载 <a href="#运算符表达式">运算符</a> 、 <a href="#array-and-slice-indexing-expressions">索引表达式</a> 和 <a href="#调用表达式">调用表达式</a> 。</p>
<div class="rule" id="r-lang-types.deref"><a class="rule-link" href="#r-lang-types.deref" title="lang-types.deref"><span>[lang-types<wbr>.deref]</span></a>
</div>

<h2 id="deref和derefmut"><a class="header" href="#deref和derefmut"><code>Deref</code>和<code>DerefMut</code></a></h2>
<p>除了重载一元 <code>*</code> 运算符外， <a href="../core/ops/deref/trait.Deref.html"><code>Deref</code></a> 和 <a href="../core/ops/deref/trait.DerefMut.html"><code>DerefMut</code></a> 还用于 <a href="#方法调用表达式">方法解析</a> 和 <a href="#coercion-types">解引用强转</a> 。</p>
<div class="rule" id="r-lang-types.drop"><a class="rule-link" href="#r-lang-types.drop" title="lang-types.drop"><span>[lang-types<wbr>.drop]</span></a>
</div>

<h2 id="drop"><a class="header" href="#drop"><code>Drop</code></a></h2>
<p><a href="../core/ops/drop/trait.Drop.html"><code>Drop</code></a> 特型 提供了一个 <a href="#析构函数">析构函数</a> ，每当该类型的值要被销毁时就会运行。</p>
<div class="rule" id="r-lang-types.copy"><a class="rule-link" href="#r-lang-types.copy" title="lang-types.copy"><span>[lang-types<wbr>.copy]</span></a>
</div>

<h2 id="copy"><a class="header" href="#copy"><code>Copy</code></a></h2>
<div class="rule" id="r-lang-types.copy.intro"><a class="rule-link" href="#r-lang-types.copy.intro" title="lang-types.copy.intro"><span>[lang-types<wbr>.copy<wbr>.intro]</span></a>
</div>

<p><a href="../core/marker/trait.Copy.html"><code>Copy</code></a> 特型 会改变实现它的类型的语义。</p>
<div class="rule" id="r-lang-types.copy.behavior"><a class="rule-link" href="#r-lang-types.copy.behavior" title="lang-types.copy.behavior"><span>[lang-types<wbr>.copy<wbr>.behavior]</span></a>
</div>

<p>类型实现 <code>Copy</code> 的值在赋值时会被复制而不是移动。</p>
<div class="rule" id="r-lang-types.copy.constraint"><a class="rule-link" href="#r-lang-types.copy.constraint" title="lang-types.copy.constraint"><span>[lang-types<wbr>.copy<wbr>.constraint]</span></a>
</div>

<p><code>Copy</code> 只能为未实现 <code>Drop</code> 且其字段均为 <code>Copy</code> 的类型实现。对于枚举，这意味着所有变体的所有字段都必须是 <code>Copy</code> 。对于 联合体 ，这意味着所有变体都必须是 <code>Copy</code> 。</p>
<div class="rule" id="r-lang-types.copy.builtin-types"><a class="rule-link" href="#r-lang-types.copy.builtin-types" title="lang-types.copy.builtin-types"><span>[lang-types<wbr>.copy<wbr>.builtin-types]</span></a>
</div>

<p><code>Copy</code> 由编译器为以下内容实现：</p>
<div class="rule" id="r-lang-types.copy.tuple"><a class="rule-link" href="#r-lang-types.copy.tuple" title="lang-types.copy.tuple"><span>[lang-types<wbr>.copy<wbr>.tuple]</span></a>
</div>

<ul>
<li><code>Copy</code> 类型的 <a href="#元组类型">元组</a></li>
</ul>
<div class="rule" id="r-lang-types.copy.fn-pointer"><a class="rule-link" href="#r-lang-types.copy.fn-pointer" title="lang-types.copy.fn-pointer"><span>[lang-types<wbr>.copy<wbr>.fn-pointer]</span></a>
</div>

<ul>
<li><a href="#函数指针类型">函数指针</a></li>
</ul>
<div class="rule" id="r-lang-types.copy.fn-item"><a class="rule-link" href="#r-lang-types.copy.fn-item" title="lang-types.copy.fn-item"><span>[lang-types<wbr>.copy<wbr>.fn-item]</span></a>
</div>

<ul>
<li><a href="#函数项类型">函数项</a></li>
</ul>
<div class="rule" id="r-lang-types.copy.closure"><a class="rule-link" href="#r-lang-types.copy.closure" title="lang-types.copy.closure"><span>[lang-types<wbr>.copy<wbr>.closure]</span></a>
</div>

<ul>
<li>未捕获任何值或仅捕获 <code>Copy</code> 类型值的 <a href="#闭包类型">闭包</a></li>
</ul>
<div class="rule" id="r-lang-types.clone"><a class="rule-link" href="#r-lang-types.clone" title="lang-types.clone"><span>[lang-types<wbr>.clone]</span></a>
</div>

<h2 id="clone"><a class="header" href="#clone"><code>Clone</code></a></h2>
<div class="rule" id="r-lang-types.clone.intro"><a class="rule-link" href="#r-lang-types.clone.intro" title="lang-types.clone.intro"><span>[lang-types<wbr>.clone<wbr>.intro]</span></a>
</div>

<p><a href="../core/clone/trait.Clone.html"><code>Clone</code></a> 特型 是 <code>Copy</code> 的父特型，因此它也需要编译器生成的实现。</p>
<div class="rule" id="r-lang-types.clone.builtin-types"><a class="rule-link" href="#r-lang-types.clone.builtin-types" title="lang-types.clone.builtin-types"><span>[lang-types<wbr>.clone<wbr>.builtin-types]</span></a>
</div>

<p>它由编译器为以下类型实现：</p>
<div class="rule" id="r-lang-types.clone.builtin-copy"><a class="rule-link" href="#r-lang-types.clone.builtin-copy" title="lang-types.clone.builtin-copy"><span>[lang-types<wbr>.clone<wbr>.builtin-copy]</span></a>
</div>

<ul>
<li>具有内置 <code>Copy</code> 实现的类型（见上文）</li>
</ul>
<div class="rule" id="r-lang-types.clone.tuple"><a class="rule-link" href="#r-lang-types.clone.tuple" title="lang-types.clone.tuple"><span>[lang-types<wbr>.clone<wbr>.tuple]</span></a>
</div>

<ul>
<li><code>Clone</code> 类型的 <a href="#元组类型">元组</a></li>
</ul>
<div class="rule" id="r-lang-types.clone.closure"><a class="rule-link" href="#r-lang-types.clone.closure" title="lang-types.clone.closure"><span>[lang-types<wbr>.clone<wbr>.closure]</span></a>
</div>

<ul>
<li>仅捕获 <code>Clone</code> 类型的值或不从环境中捕获值的 <a href="#闭包类型">闭包</a></li>
</ul>
<div class="rule" id="r-lang-types.send"><a class="rule-link" href="#r-lang-types.send" title="lang-types.send"><span>[lang-types<wbr>.send]</span></a>
</div>

<h2 id="send"><a class="header" href="#send"><code>Send</code></a></h2>
<p><a href="../core/marker/trait.Send.html"><code>Send</code></a> 特型 表示该类型的值可以安全地从一个线程发送到另一个线程。</p>
<div class="rule" id="r-lang-types.sync"><a class="rule-link" href="#r-lang-types.sync" title="lang-types.sync"><span>[lang-types<wbr>.sync]</span></a>
</div>

<h2 id="sync"><a class="header" href="#sync"><code>Sync</code></a></h2>
<div class="rule" id="r-lang-types.sync.intro"><a class="rule-link" href="#r-lang-types.sync.intro" title="lang-types.sync.intro"><span>[lang-types<wbr>.sync<wbr>.intro]</span></a>
</div>

<p><a href="../core/marker/trait.Sync.html"><code>Sync</code></a> 特型 表示该类型的值可以安全地在多个线程之间共享。</p>
<div class="rule" id="r-lang-types.sync.static-constraint"><a class="rule-link" href="#r-lang-types.sync.static-constraint" title="lang-types.sync.static-constraint"><span>[lang-types<wbr>.sync<wbr>.static-constraint]</span></a>
</div>

<p>此 特型 必须为不可变 <a href="#静态项"><code>static</code> 项</a> 中使用的所有类型实现。</p>
<div class="rule" id="r-lang-types.termination"><a class="rule-link" href="#r-lang-types.termination" title="lang-types.termination"><span>[lang-types<wbr>.termination]</span></a>
</div>

<h2 id="termination"><a class="header" href="#termination"><code>Termination</code></a></h2>
<p><a href="../std/process/trait.Termination.html"><code>Termination</code></a> 特型 表示 <a href="#main函数">main 函数</a> 和 <a href="#the-test-attribute">测试函数</a> 可接受的返回类型。</p>
<div class="rule" id="r-lang-types.auto-traits"><a class="rule-link" href="#r-lang-types.auto-traits" title="lang-types.auto-traits"><span>[lang-types<wbr>.auto-traits]</span></a>
</div>

<h2 id="自动特型"><a class="header" href="#自动特型">自动特型</a></h2>
<p><a href="../core/marker/trait.Send.html"><code>Send</code></a> 、 <a href="../core/marker/trait.Sync.html"><code>Sync</code></a> 、 <a href="../core/marker/trait.Unpin.html"><code>Unpin</code></a> 、 <a href="../core/panic/unwind_safe/trait.UnwindSafe.html"><code>UnwindSafe</code></a> 和 <a href="../core/panic/unwind_safe/trait.RefUnwindSafe.html"><code>RefUnwindSafe</code></a> 特型 是 <em>自动特型</em> 。自动特型具有特殊属性。</p>
<div class="rule" id="r-lang-types.auto-traits.auto-impl"><a class="rule-link" href="#r-lang-types.auto-traits.auto-impl" title="lang-types.auto-traits.auto-impl"><span>[lang-types<wbr>.auto-traits<wbr>.auto-impl]</span></a>
</div>

<p>如果未针对给定类型的自动 特型 编写显式实现或否定实现，则编译器会根据以下规则自动实现它：</p>
<div class="rule" id="r-lang-types.auto-traits.builtin-composite"><a class="rule-link" href="#r-lang-types.auto-traits.builtin-composite" title="lang-types.auto-traits.builtin-composite"><span>[lang-types<wbr>.auto-traits<wbr>.builtin-composite]</span></a>
</div>

<ul>
<li>如果 <code>T</code> 实现了该 特型 ，则 <code>&amp;T</code> 、 <code>&amp;mut T</code> 、 <code>*const T</code> 、 <code>*mut T</code> 、 <code>[T; n]</code> 和 <code>[T]</code> 也会实现。</li>
</ul>
<div class="rule" id="r-lang-types.auto-traits.fn-item-pointer"><a class="rule-link" href="#r-lang-types.auto-traits.fn-item-pointer" title="lang-types.auto-traits.fn-item-pointer"><span>[lang-types<wbr>.auto-traits<wbr>.fn-item-pointer]</span></a>
</div>

<ul>
<li>函数项类型和函数指针会自动实现该 特型 。</li>
</ul>
<div class="rule" id="r-lang-types.auto-traits.aggregate"><a class="rule-link" href="#r-lang-types.auto-traits.aggregate" title="lang-types.auto-traits.aggregate"><span>[lang-types<wbr>.auto-traits<wbr>.aggregate]</span></a>
</div>

<ul>
<li>结构体 、枚举、 联合体 和元组的所有字段都实现了该 特型 ，则它们也会实现。</li>
</ul>
<div class="rule" id="r-lang-types.auto-traits.closure"><a class="rule-link" href="#r-lang-types.auto-traits.closure" title="lang-types.auto-traits.closure"><span>[lang-types<wbr>.auto-traits<wbr>.closure]</span></a>
</div>

<ul>
<li>如果闭包所有捕获的类型都实现了该 特型 ，则该闭包也会实现。通过共享引用捕获 <code>T</code> 并通过值捕获 <code>U</code> 的闭包将实现 <code>&amp;T</code> 和 <code>U</code> 都实现的任何自动 特型 。</li>
</ul>
<div class="rule" id="r-lang-types.auto-traits.generic-impl"><a class="rule-link" href="#r-lang-types.auto-traits.generic-impl" title="lang-types.auto-traits.generic-impl"><span>[lang-types<wbr>.auto-traits<wbr>.generic-impl]</span></a>
</div>

<p>对于 泛型 类型（将上述内置类型视为关于 <code>T</code> 的 泛型 ），如果存在 泛型 实现，那么对于那些本可以使用该实现但因不满足必要 特型 约束而无法使用的类型，编译器不会自动实现它。例如，标准库为所有 <code>T</code> 为 <code>Sync</code> 的 <code>&amp;T</code> 实现了 <code>Send</code> ；这意味着如果 <code>T</code> 是 <code>Send</code> 但不是 <code>Sync</code> ，编译器将不会为 <code>&amp;T</code> 实现 <code>Send</code> 。</p>
<div class="rule" id="r-lang-types.auto-traits.negative"><a class="rule-link" href="#r-lang-types.auto-traits.negative" title="lang-types.auto-traits.negative"><span>[lang-types<wbr>.auto-traits<wbr>.negative]</span></a>
</div>

<p>自动 特型 也可以具有否定实现（在标准库文档中显示为 <code>impl !AutoTrait for T</code> ），这些实现会覆盖自动实现。例如 <code>*mut T</code> 具有 <code>Send</code> 的否定实现，因此即使 <code>T</code> 是 <code>Send</code> ， <code>*mut T</code> 也不是 <code>Send</code> 。目前还没有稳定且通用的方法来指定额外的否定实现；它们仅存在于标准库中。</p>
<div class="rule" id="r-lang-types.auto-traits.trait-object-marker"><a class="rule-link" href="#r-lang-types.auto-traits.trait-object-marker" title="lang-types.auto-traits.trait-object-marker"><span>[lang-types<wbr>.auto-traits<wbr>.trait-object-marker]</span></a>
</div>

<p>自动 特型 可以作为附加约束添加到任何 <a href="#特型对象">特型对象</a> 中，即使通常只允许一个 特型 。例如， <code>Box&lt;dyn Debug + Send + UnwindSafe&gt;</code> 是一个有效类型。</p>
<div class="rule" id="r-lang-types.sized"><a class="rule-link" href="#r-lang-types.sized" title="lang-types.sized"><span>[lang-types<wbr>.sized]</span></a>
</div>

<h2 id="sized-1"><a class="header" href="#sized-1"><code>Sized</code></a></h2>
<div class="rule" id="r-lang-types.sized.intro"><a class="rule-link" href="#r-lang-types.sized.intro" title="lang-types.sized.intro"><span>[lang-types<wbr>.sized<wbr>.intro]</span></a>
</div>

<p><a href="../core/marker/trait.Sized.html"><code>Sized</code></a> 特型 表示该类型的大小在编译时是已知的；也就是说，它不是 <a href="#动态大小类型">动态大小类型</a> 。</p>
<div class="rule" id="r-lang-types.sized.implicit-sized"><a class="rule-link" href="#r-lang-types.sized.implicit-sized" title="lang-types.sized.implicit-sized"><span>[lang-types<wbr>.sized<wbr>.implicit-sized]</span></a>
</div>

<p><a href="#类型参数">类型参数</a> （ 特型 中的 <code>Self</code> 除外）默认是 <code>Sized</code> 的， <a href="#associated-types">关联类型</a> 也是如此。</p>
<div class="rule" id="r-lang-types.sized.implicit-impl"><a class="rule-link" href="#r-lang-types.sized.implicit-impl" title="lang-types.sized.implicit-impl"><span>[lang-types<wbr>.sized<wbr>.implicit-impl]</span></a>
</div>

<p><code>Sized</code> 总是由编译器自动实现，而不是通过 <a href="#实现">实现项</a> 实现。</p>
<div class="rule" id="r-lang-types.sized.relaxation"><a class="rule-link" href="#r-lang-types.sized.relaxation" title="lang-types.sized.relaxation"><span>[lang-types<wbr>.sized<wbr>.relaxation]</span></a>
</div>

<p>这些隐式的 <code>Sized</code> 约束可以通过使用特殊的 <code>?Sized</code> 约束来放宽。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-names"><a class="rule-link" href="#r-names" title="names"><span>[names]</span></a>
</div>

<h1 id="名称"><a class="header" href="#名称">名称</a></h1>
<div class="rule" id="r-names.intro"><a class="rule-link" href="#r-names.intro" title="names.intro"><span>[names<wbr>.intro]</span></a>
</div>

<p>一个 <em>实体(entity)</em> 是一种语言结构，它在源程序中可以以某种方式被引用，通常是通过 <a href="#路径">路径</a> 。实体包括 <a href="#类型">类型</a> 、 <a href="#项">项</a> 、 <a href="#泛型参数">泛型参数</a> 、 <a href="#模式">变量绑定</a> 、 <a href="#loop-labels">循环标签</a> 、 <a href="#生命周期和循环标签">生命周期</a> 、 <a href="#字段访问表达式">字段</a> 、 <a href="#属性-1">属性</a> 以及 <a href="#lint-check-attributes">lint</a> 。</p>
<p>一个 <em>声明(declaration)</em> 是一种语法结构，它可以引入一个 <em>名称(name)</em> 来引用实体。实体名称在 <a href="#作用域"><em>作用域</em></a> 内有效 — 即该名称可以被引用的源文本区域。</p>
<p>某些实体在源码中被 <a href="#explicitly-declared-entities">显式声明</a> ，而某些实体作为语言或编译器扩展的一部分被 <a href="#implicitly-declared-entities">隐式声明</a> 。</p>
<p><a href="#路径"><em>路径</em></a> 用于引用实体，可能是在另一个模块或类型中。</p>
<p>生命周期和循环标签使用一种 <a href="#生命周期和循环标签">专用语法</a> ，带有一个前导引号。</p>
<p>名称被隔离在不同的 <a href="#命名空间"><em>命名空间</em></a> 中，允许不同命名空间中的实体共享相同的名称而不会发生冲突。</p>
<p><a href="#名称解析"><em>名称解析</em></a> 是将路径、标识符和标签绑定到实体声明的编译时过程。</p>
<p>对某些名称的访问可能会基于它们的 <a href="#可见性和私有性"><em>可见性</em></a> 受到限制。</p>
<div class="rule" id="r-names.explicit"><a class="rule-link" href="#r-names.explicit" title="names.explicit"><span>[names<wbr>.explicit]</span></a>
</div>

<h2 id="显式声明的实体"><a class="header" href="#显式声明的实体">显式声明的实体</a></h2>
<div class="rule" id="r-names.explicit.list"><a class="rule-link" href="#r-names.explicit.list" title="names.explicit.list"><span>[names<wbr>.explicit<wbr>.list]</span></a>
</div>

<p>在源码中显式引入名称的实体有：</p>
<div class="rule" id="r-names.explicit.item-decl"><a class="rule-link" href="#r-names.explicit.item-decl" title="names.explicit.item-decl"><span>[names<wbr>.explicit<wbr>.item-decl]</span></a>
</div>

<ul>
<li><a href="#项">项</a> ：
<ul>
<li><a href="#模块">模块声明</a></li>
<li><a href="#extern-crate-声明">外部 crate 声明</a></li>
<li><a href="#use声明">使用声明</a></li>
<li><a href="#函数">函数声明</a> 和 <a href="#function-parameters">函数参数</a></li>
<li><a href="#类型别名">类型别名</a></li>
<li><a href="#结构体">结构体</a> 、 <a href="#联合体">联合体</a> 、 <a href="#枚举">枚举</a> 、枚举变体声明以及它们的具名字段</li>
<li><a href="#常量项">常量项声明</a></li>
<li><a href="#静态项">静态项声明</a></li>
<li><a href="#特型">特型项声明</a> 和它们的 <a href="#关联项">关联项</a></li>
<li><a href="#外部块">外部块项</a></li>
<li><a href="#声明宏"><code>macro_rules</code> 声明</a> 和 <a href="#元变量">匹配器元变量</a></li>
<li><a href="#实现">实现</a> 关联项</li>
</ul>
</li>
</ul>
<div class="rule" id="r-names.explicit.expr"><a class="rule-link" href="#r-names.explicit.expr" title="names.explicit.expr"><span>[names<wbr>.explicit<wbr>.expr]</span></a>
</div>

<ul>
<li><a href="#表达式">表达式</a> ：
<ul>
<li><a href="#闭包表达式">闭包</a> 参数</li>
<li><a href="#while-let-patterns"><code>while let</code></a> 模式绑定</li>
<li><a href="#iterator-loops"><code>for</code></a> 模式绑定</li>
<li><a href="#if-let-patterns"><code>if let</code></a> 模式绑定</li>
<li><a href="#match表达式"><code>match</code></a> 模式绑定</li>
<li><a href="#loop-labels">循环标签</a></li>
</ul>
</li>
</ul>
<div class="rule" id="r-names.explicit.generics"><a class="rule-link" href="#r-names.explicit.generics" title="names.explicit.generics"><span>[names<wbr>.explicit<wbr>.generics]</span></a>
</div>

<ul>
<li><a href="#泛型参数">泛型参数</a></li>
</ul>
<div class="rule" id="r-names.explicit.higher-ranked-bounds"><a class="rule-link" href="#r-names.explicit.higher-ranked-bounds" title="names.explicit.higher-ranked-bounds"><span>[names<wbr>.explicit<wbr>.higher-ranked-bounds]</span></a>
</div>

<ul>
<li><a href="#higher-ranked-trait-bounds">高阶特型界限</a></li>
</ul>
<div class="rule" id="r-names.explicit.binding"><a class="rule-link" href="#r-names.explicit.binding" title="names.explicit.binding"><span>[names<wbr>.explicit<wbr>.binding]</span></a>
</div>

<ul>
<li><a href="#let-statements"><code>let</code> 语句</a> 模式绑定</li>
</ul>
<div class="rule" id="r-names.explicit.macro_use"><a class="rule-link" href="#r-names.explicit.macro_use" title="names.explicit.macro_use"><span>[names<wbr>.explicit<wbr>.macro_use]</span></a>
</div>

<ul>
<li><a href="#macro_use属性"><code>macro_use</code> 属性</a> 可以引入来自另一个 crate 的宏名称</li>
</ul>
<div class="rule" id="r-names.explicit.macro_export"><a class="rule-link" href="#r-names.explicit.macro_export" title="names.explicit.macro_export"><span>[names<wbr>.explicit<wbr>.macro_export]</span></a>
</div>

<ul>
<li><a href="#macro_export属性"><code>macro_export</code> 属性</a> 可以为宏向 crate 根部引入一个别名</li>
</ul>
<div class="rule" id="r-names.explicit.macro-invocation"><a class="rule-link" href="#r-names.explicit.macro-invocation" title="names.explicit.macro-invocation"><span>[names<wbr>.explicit<wbr>.macro-invocation]</span></a>
</div>

<p>此外， <a href="#宏调用">宏调用</a> 和 <a href="#属性-1">属性</a> 可以通过展开为上述项之一来引入名称。</p>
<div class="rule" id="r-names.implicit"><a class="rule-link" href="#r-names.implicit" title="names.implicit"><span>[names<wbr>.implicit]</span></a>
</div>

<h2 id="隐式声明的实体"><a class="header" href="#隐式声明的实体">隐式声明的实体</a></h2>
<div class="rule" id="r-names.implicit.list"><a class="rule-link" href="#r-names.implicit.list" title="names.implicit.list"><span>[names<wbr>.implicit<wbr>.list]</span></a>
</div>

<p>以下实体由语言隐式定义，或由编译器选项和扩展引入：</p>
<div class="rule" id="r-names.implicit.primitive-types"><a class="rule-link" href="#r-names.implicit.primitive-types" title="names.implicit.primitive-types"><span>[names<wbr>.implicit<wbr>.primitive-types]</span></a>
</div>

<ul>
<li><a href="#language-prelude">语言预导入</a> ：
<ul>
<li><a href="#布尔类型">布尔类型</a> — <code>bool</code></li>
<li><a href="#文本类型">文本类型</a> — <code>char</code> 和 <code>str</code></li>
<li><a href="#integer-types">整数类型</a> — <code>i8</code>, <code>i16</code>, <code>i32</code>, <code>i64</code>, <code>i128</code>, <code>u8</code>, <code>u16</code>, <code>u32</code>, <code>u64</code>, <code>u128</code></li>
<li><a href="#machine-dependent-integer-types">机器相关整数类型</a> — <code>usize</code> 和 <code>isize</code></li>
<li><a href="#floating-point-types">浮点类型</a> — <code>f32</code> 和 <code>f64</code></li>
</ul>
</li>
</ul>
<div class="rule" id="r-names.implicit.builtin-attributes"><a class="rule-link" href="#r-names.implicit.builtin-attributes" title="names.implicit.builtin-attributes"><span>[names<wbr>.implicit<wbr>.builtin-attributes]</span></a>
</div>

<ul>
<li><a href="#built-in-attributes-index">内置属性</a></li>
</ul>
<div class="rule" id="r-names.implicit.prelude"><a class="rule-link" href="#r-names.implicit.prelude" title="names.implicit.prelude"><span>[names<wbr>.implicit<wbr>.prelude]</span></a>
</div>

<ul>
<li><a href="#standard-library-prelude">标准库预导入</a> 项、属性和宏</li>
</ul>
<div class="rule" id="r-names.implicit.stdlib"><a class="rule-link" href="#r-names.implicit.stdlib" title="names.implicit.stdlib"><span>[names<wbr>.implicit<wbr>.stdlib]</span></a>
</div>

<ul>
<li>根模块中的 <a href="#extern-prelude">标准库</a> crate</li>
</ul>
<div class="rule" id="r-names.implicit.extern-prelude"><a class="rule-link" href="#r-names.implicit.extern-prelude" title="names.implicit.extern-prelude"><span>[names<wbr>.implicit<wbr>.extern-prelude]</span></a>
</div>

<ul>
<li>由编译器链接的 <a href="#extern-prelude">外部 crate</a></li>
</ul>
<div class="rule" id="r-names.implicit.tool-attributes"><a class="rule-link" href="#r-names.implicit.tool-attributes" title="names.implicit.tool-attributes"><span>[names<wbr>.implicit<wbr>.tool-attributes]</span></a>
</div>

<ul>
<li><a href="#tool-attributes">工具属性</a></li>
</ul>
<div class="rule" id="r-names.implicit.lints"><a class="rule-link" href="#r-names.implicit.lints" title="names.implicit.lints"><span>[names<wbr>.implicit<wbr>.lints]</span></a>
</div>

<ul>
<li><a href="#lint-check-attributes">lint</a> 和 <a href="#tool-lint-attributes">工具 lint 属性</a></li>
</ul>
<div class="rule" id="r-names.implicit.derive-helpers"><a class="rule-link" href="#r-names.implicit.derive-helpers" title="names.implicit.derive-helpers"><span>[names<wbr>.implicit<wbr>.derive-helpers]</span></a>
</div>

<ul>
<li><a href="#派生宏辅助属性">派生辅助属性</a> 在项内有效，无需显式导入</li>
</ul>
<div class="rule" id="r-names.implicit.lifetime-static"><a class="rule-link" href="#r-names.implicit.lifetime-static" title="names.implicit.lifetime-static"><span>[names<wbr>.implicit<wbr>.lifetime-static]</span></a>
</div>

<ul>
<li><a href="#弱关键字"><code>'static</code></a> 生命周期</li>
</ul>
<div class="rule" id="r-names.implicit.root"><a class="rule-link" href="#r-names.implicit.root" title="names.implicit.root"><span>[names<wbr>.implicit<wbr>.root]</span></a>
</div>

<p>此外，crate 根模块没有名称，但可以使用某些 <a href="#path-qualifiers">路径限定符</a> 或别名来引用。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-names.namespaces"><a class="rule-link" href="#r-names.namespaces" title="names.namespaces"><span>[names<wbr>.namespaces]</span></a>
</div>

<h1 id="命名空间"><a class="header" href="#命名空间">命名空间</a></h1>
<div class="rule" id="r-names.namespaces.intro"><a class="rule-link" href="#r-names.namespaces.intro" title="names.namespaces.intro"><span>[names<wbr>.namespaces<wbr>.intro]</span></a>
</div>

<p>一个 <em>命名空间</em> 是已声明 <a href="#名称">名称</a> 的逻辑分组。名称根据其引用的实体种类被隔离到不同的命名空间中。命名空间允许一个命名空间中出现的名称与另一个命名空间中的相同名称不发生冲突。</p>
<p>存在几个不同的命名空间，每个命名空间包含不同种类的实体。名称的使用将根据上下文在不同的命名空间中寻找该名称的声明，如 <a href="#名称解析">名称解析</a> 章节所述。</p>
<div class="rule" id="r-names.namespaces.kinds"><a class="rule-link" href="#r-names.namespaces.kinds" title="names.namespaces.kinds"><span>[names<wbr>.namespaces<wbr>.kinds]</span></a>
</div>

<p>以下是命名空间列表及其对应的实体：</p>
<ul>
<li>类型命名空间
<ul>
<li><a href="#模块">模块声明</a></li>
<li><a href="#extern-crate-声明">外部 crate 声明</a></li>
<li><a href="#extern-prelude">外部 crate 预导入</a> 项</li>
<li><a href="#结构体">结构体</a> 、 <a href="#联合体">联合体</a> 、 <a href="#枚举">枚举</a> 、枚举变体声明</li>
<li><a href="#特型">特型项声明</a></li>
<li><a href="#类型别名">类型别名</a></li>
<li><a href="#associated-types">关联类型声明</a></li>
<li>内置类型： <a href="#布尔类型">布尔型</a> 、 <a href="#数值类型">数值型</a> 和 <a href="#文本类型">文本型</a></li>
<li><a href="#泛型参数">泛型类型参数</a></li>
<li><a href="#self-1"><code>Self</code> 类型</a></li>
<li><a href="#tool-attributes">工具属性模块</a></li>
</ul>
</li>
<li>值命名空间
<ul>
<li><a href="#函数">函数声明</a></li>
<li><a href="#常量项">常量项声明</a></li>
<li><a href="#静态项">静态项声明</a></li>
<li><a href="#结构体">结构体构造函数</a></li>
<li><a href="#枚举">枚举变体构造函数</a></li>
<li><a href="#self-1"><code>Self</code> 构造函数</a></li>
<li><a href="#const-generics">泛型常量参数</a></li>
<li><a href="#associated-constants">关联常量声明</a></li>
<li><a href="#associated-functions-and-methods">关联函数声明</a></li>
<li>本地绑定 — <a href="#let-statements"><code>let</code></a> 、 <a href="#if-let-patterns"><code>if let</code></a> 、 <a href="#while-let-patterns"><code>while let</code></a> 、 <a href="#iterator-loops"><code>for</code></a> 、 <a href="#match表达式"><code>match</code></a> 分支、 <a href="#function-parameters">函数参数</a> 、 <a href="#闭包表达式">闭包参数</a></li>
<li>捕获的 <a href="#闭包表达式">闭包</a> 变量</li>
</ul>
</li>
<li>宏命名空间
<ul>
<li><a href="#声明宏"><code>macro_rules</code> 声明</a></li>
<li><a href="#built-in-attributes-index">内置属性</a></li>
<li><a href="#tool-attributes">工具属性</a></li>
<li><a href="#proc_macro属性">类函数过程宏</a></li>
<li><a href="#r-macro.proc.derive">派生宏</a></li>
<li><a href="#派生宏辅助属性">派生宏辅助属性</a></li>
<li><a href="#proc_macro_attribute属性">属性宏</a></li>
</ul>
</li>
<li>生命周期命名空间
<ul>
<li><a href="#泛型参数">泛型生命周期参数</a></li>
</ul>
</li>
<li>标签命名空间
<ul>
<li><a href="#loop-labels">循环标签</a></li>
<li><a href="#r-expr.loop.block-labels">块标签</a></li>
</ul>
</li>
</ul>
<p>关于如何在不同命名空间中使用重叠名称而不会产生歧义的示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Foo 在类型命名空间中引入了一个类型，在值命名空间中引入了一个构造函数。
struct Foo(u32);

// Foo 宏在宏命名空间中声明。
macro_rules! Foo {
    () =&gt; {};
}

// f 参数类型中的 Foo 指向类型命名空间中的 Foo。
// 'Foo 在生命周期命名空间中引入了一个新的生命周期。
fn example&lt;'Foo&gt;(f: Foo) {
    // Foo 指向值命名空间中的 Foo 构造函数。
    let ctor = Foo;
    // Foo 指向宏命名空间中的 Foo 宏。
    Foo!{}
    // 'Foo 在标签命名空间中引入了一个标签。
    'Foo: loop {
        // 'Foo 指向 'Foo 生命周期参数，而 Foo 指向类型命名空间。
        let x: &amp;'Foo Foo;
        // 'Foo 指向该标签。
        break 'Foo;
    }
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-names.namespaces.without"><a class="rule-link" href="#r-names.namespaces.without" title="names.namespaces.without"><span>[names<wbr>.namespaces<wbr>.without]</span></a>
</div>

<h2 id="无命名空间的具名实体"><a class="header" href="#无命名空间的具名实体">无命名空间的具名实体</a></h2>
<p>以下实体具有显式名称，但这些名称不属于任何特定的命名空间。</p>
<h3 id="字段"><a class="header" href="#字段">字段</a></h3>
<div class="rule" id="r-names.namespaces.without.fields"><a class="rule-link" href="#r-names.namespaces.without.fields" title="names.namespaces.without.fields"><span>[names<wbr>.namespaces<wbr>.without<wbr>.fields]</span></a>
</div>

<p>尽管结构体、枚举和联合体字段是具名的，但这些具名字段并不存在于显式命名空间中。它们只能通过 <a href="#字段访问表达式">字段表达式</a> 访问，该表达式仅检查正在访问的特定类型的字段名称。</p>
<h3 id="use声明-1"><a class="header" href="#use声明-1">Use声明</a></h3>
<div class="rule" id="r-names.namespaces.without.use"><a class="rule-link" href="#r-names.namespaces.without.use" title="names.namespaces.without.use"><span>[names<wbr>.namespaces<wbr>.without<wbr>.use]</span></a>
</div>

<p>一个 <a href="#use声明">use声明</a> 具有导入到作用域中的具名别名，但 <code>use</code> 项本身并不属于特定命名空间。相反，它可以根据正在导入的项种类，将别名引入到多个命名空间中。</p>
<div class="rule" id="r-names.namespaces.sub-namespaces"><a class="rule-link" href="#r-names.namespaces.sub-namespaces" title="names.namespaces.sub-namespaces"><span>[names<wbr>.namespaces<wbr>.sub-namespaces]</span></a>
</div>

<h2 id="子命名空间"><a class="header" href="#子命名空间">子命名空间</a></h2>
<div class="rule" id="r-names.namespaces.sub-namespaces.intro"><a class="rule-link" href="#r-names.namespaces.sub-namespaces.intro" title="names.namespaces.sub-namespaces.intro"><span>[names<wbr>.namespaces<wbr>.sub-namespaces<wbr>.intro]</span></a>
</div>

<p>宏命名空间分为两个子命名空间：一个用于 <a href="#宏">感叹号风格宏</a> ，另一个用于 <a href="#属性-1">属性</a> 。
当解析属性时，作用域内的任何感叹号风格宏都将被忽略。
反之，解析感叹号风格宏将忽略作用域内的属性宏。
这可以防止一种风格遮蔽另一种风格。</p>
<p>例如， <a href="#cfg属性"><code>cfg</code> 属性</a> 和 <a href="#cfg宏"><code>cfg</code> 宏</a> 是宏命名空间中具有相同名称的两个不同实体，但它们仍然可以在各自的上下文中使用。</p>
<!-- ignore: requires external crates -->
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>use</code> 导入仍然不能在模块或块中创建相同名称的重复绑定，无论子命名空间如何。</p>
<pre><code class="language-rust ignore">#[macro_export]
macro_rules! mymac {
    () =&gt; {};
}

use myattr::mymac; // error[E0252]: 名称 `mymac` 被多次定义。</code></pre>
</blockquote>
</div>

<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-names.scopes"><a class="rule-link" href="#r-names.scopes" title="names.scopes"><span>[names<wbr>.scopes]</span></a>
</div>

<h1 id="作用域"><a class="header" href="#作用域">作用域</a></h1>
<div class="rule" id="r-names.scopes.intro"><a class="rule-link" href="#r-names.scopes.intro" title="names.scopes.intro"><span>[names<wbr>.scopes<wbr>.intro]</span></a>
</div>

<p>一个 <em>作用域</em> 是源代码中一个被命名的 <a href="#名称">实体</a> 可以通过该名称被引用的区域。
以下部分提供了有关作用域规则和行为的详细信息，这些规则和行为取决于实体的种类及其声明位置。
名称如何解析为实体的过程在 <a href="#名称解析">名称解析</a> 章节中描述。
有关用于运行析构函数的 “drop scopes” 的更多信息，可以在 <a href="#析构函数">析构函数</a> 章节中找到。</p>
<div class="rule" id="r-names.scopes.items"><a class="rule-link" href="#r-names.scopes.items" title="names.scopes.items"><span>[names<wbr>.scopes<wbr>.items]</span></a>
</div>

<h2 id="项作用域"><a class="header" href="#项作用域">项作用域</a></h2>
<div class="rule" id="r-names.scopes.items.module"><a class="rule-link" href="#r-names.scopes.items.module" title="names.scopes.items.module"><span>[names<wbr>.scopes<wbr>.items<wbr>.module]</span></a>
</div>

<p>直接在 <a href="#模块">模块</a> 中声明的 <a href="#项">项</a> 的名称，其作用域从模块开始延伸到模块结束。这些项也是模块的成员，可以通过从其模块开始的 <a href="#路径">路径</a> 来引用。</p>
<div class="rule" id="r-names.scopes.items.statement"><a class="rule-link" href="#r-names.scopes.items.statement" title="names.scopes.items.statement"><span>[names<wbr>.scopes<wbr>.items<wbr>.statement]</span></a>
</div>

<p>作为 <a href="#语句">语句</a> 声明的项的名称，其作用域从该项语句所在的块开始延伸到该块结束。</p>
<div class="rule" id="r-names.scopes.items.duplicate"><a class="rule-link" href="#r-names.scopes.items.duplicate" title="names.scopes.items.duplicate"><span>[names<wbr>.scopes<wbr>.items<wbr>.duplicate]</span></a>
</div>

<p>在同一个模块或块中，在同一个 <a href="#命名空间">命名空间</a> 内引入与另一个项同名的项是错误的。
<a href="#use声明">星号通配符导入</a> 在处理重复名称和遮蔽方面具有特殊行为，详见链接章节。</p>
<div class="rule" id="r-names.scopes.items.shadow-prelude"><a class="rule-link" href="#r-names.scopes.items.shadow-prelude" title="names.scopes.items.shadow-prelude"><span>[names<wbr>.scopes<wbr>.items<wbr>.shadow-prelude]</span></a>
</div>

<p>模块中的项可能会遮蔽 <a href="#prelude-scopes">预导入</a> 中的项。</p>
<div class="rule" id="r-names.scopes.items.nested-modules"><a class="rule-link" href="#r-names.scopes.items.nested-modules" title="names.scopes.items.nested-modules"><span>[names<wbr>.scopes<wbr>.items<wbr>.nested-modules]</span></a>
</div>

<p>外部模块中的项名称在嵌套模块的作用域内不可见。
<a href="#路径">路径</a> 可用于引用另一个模块中的项。</p>
<div class="rule" id="r-names.scopes.associated-items"><a class="rule-link" href="#r-names.scopes.associated-items" title="names.scopes.associated-items"><span>[names<wbr>.scopes<wbr>.associated-items]</span></a>
</div>

<h3 id="关联项作用域"><a class="header" href="#关联项作用域">关联项作用域</a></h3>
<div class="rule" id="r-names.scopes.associated-items.scope"><a class="rule-link" href="#r-names.scopes.associated-items.scope" title="names.scopes.associated-items.scope"><span>[names<wbr>.scopes<wbr>.associated-items<wbr>.scope]</span></a>
</div>

<p><a href="#关联项">关联项</a> 没有作用域，只能通过使用从它们关联的类型或 特型 开始的 <a href="#路径">路径</a> 来引用。
<a href="#方法">方法</a> 也可以通过 <a href="#调用表达式">调用表达式</a> 来引用。</p>
<div class="rule" id="r-names.scopes.associated-items.duplicate"><a class="rule-link" href="#r-names.scopes.associated-items.duplicate" title="names.scopes.associated-items.duplicate"><span>[names<wbr>.scopes<wbr>.associated-items<wbr>.duplicate]</span></a>
</div>

<p>与模块或块内的项类似，在 特型 或实现中引入与该 特型 或实现中同一命名空间内的另一个项重复的项是错误的。</p>
<div class="rule" id="r-names.scopes.pattern-bindings"><a class="rule-link" href="#r-names.scopes.pattern-bindings" title="names.scopes.pattern-bindings"><span>[names<wbr>.scopes<wbr>.pattern-bindings]</span></a>
</div>

<h2 id="模式绑定作用域"><a class="header" href="#模式绑定作用域">模式绑定作用域</a></h2>
<p>局部变量 <a href="#模式">模式</a> 绑定的作用域取决于它的使用位置：</p>
<div class="rule" id="r-names.scopes.pattern-bindings.let"><a class="rule-link" href="#r-names.scopes.pattern-bindings.let" title="names.scopes.pattern-bindings.let"><span>[names<wbr>.scopes<wbr>.pattern-bindings<wbr>.let]</span></a>
</div>

<ul>
<li><a href="#let-statements"><code>let</code> 语句</a> 绑定的范围从 <code>let</code> 语句之后直到声明它的块结束。</li>
</ul>
<div class="rule" id="r-names.scopes.pattern-bindings.parameter"><a class="rule-link" href="#r-names.scopes.pattern-bindings.parameter" title="names.scopes.pattern-bindings.parameter"><span>[names<wbr>.scopes<wbr>.pattern-bindings<wbr>.parameter]</span></a>
</div>

<ul>
<li><a href="#function-parameters">函数参数</a> 绑定在函数体内部。</li>
</ul>
<div class="rule" id="r-names.scopes.pattern-bindings.closure"><a class="rule-link" href="#r-names.scopes.pattern-bindings.closure" title="names.scopes.pattern-bindings.closure"><span>[names<wbr>.scopes<wbr>.pattern-bindings<wbr>.closure]</span></a>
</div>

<ul>
<li><a href="#闭包表达式">闭包参数</a> 绑定在闭包体内部。</li>
</ul>
<div class="rule" id="r-names.scopes.pattern-bindings.loop"><a class="rule-link" href="#r-names.scopes.pattern-bindings.loop" title="names.scopes.pattern-bindings.loop"><span>[names<wbr>.scopes<wbr>.pattern-bindings<wbr>.loop]</span></a>
</div>

<ul>
<li><a href="#iterator-loops"><code>for</code></a> 绑定在循环体内部。</li>
</ul>
<div class="rule" id="r-names.scopes.pattern-bindings.let-chains"><a class="rule-link" href="#r-names.scopes.pattern-bindings.let-chains" title="names.scopes.pattern-bindings.let-chains"><span>[names<wbr>.scopes<wbr>.pattern-bindings<wbr>.let-chains]</span></a>
</div>

<ul>
<li><a href="#if-let-patterns"><code>if let</code></a> 和 <a href="#while-let-patterns"><code>while let</code></a> 绑定在后续条件以及随后的块中有效。</li>
</ul>
<div class="rule" id="r-names.scopes.pattern-bindings.match-arm"><a class="rule-link" href="#r-names.scopes.pattern-bindings.match-arm" title="names.scopes.pattern-bindings.match-arm"><span>[names<wbr>.scopes<wbr>.pattern-bindings<wbr>.match-arm]</span></a>
</div>

<ul>
<li><a href="#match表达式"><code>match</code> 臂</a> 绑定在 <a href="#match-guards">match 守卫</a> 和 match 臂表达式内部。</li>
</ul>
<div class="rule" id="r-names.scopes.pattern-bindings.items"><a class="rule-link" href="#r-names.scopes.pattern-bindings.items" title="names.scopes.pattern-bindings.items"><span>[names<wbr>.scopes<wbr>.pattern-bindings<wbr>.items]</span></a>
</div>

<p>局部变量作用域不会延伸到项声明中。</p>
<!-- Not entirely, see https://github.com/rust-lang/rust/issues/33118 -->
<h3 id="模式绑定遮蔽"><a class="header" href="#模式绑定遮蔽">模式绑定遮蔽</a></h3>
<div class="rule" id="r-names.scopes.pattern-bindings.shadow"><a class="rule-link" href="#r-names.scopes.pattern-bindings.shadow" title="names.scopes.pattern-bindings.shadow"><span>[names<wbr>.scopes<wbr>.pattern-bindings<wbr>.shadow]</span></a>
</div>

<p>模式绑定允许遮蔽作用域内的任何名称，但以下情况除外（属于错误）：</p>
<ul>
<li>常量泛型参数</li>
<li><a href="#静态项">静态项</a></li>
<li><a href="#常量项">常量项</a></li>
<li><a href="#结构体">结构体</a> 和 <a href="#枚举">枚举</a> 的构造函数</li>
</ul>
<p>以下示例说明了局部绑定如何遮蔽项声明：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn shadow_example() {
    // 由于目前作用域内没有局部变量，这会解析为函数。
    foo(); // 打印 `function`
    let foo = || println!("closure");
    fn foo() { println!("function"); }
    // 这会解析为局部闭包，因为它遮蔽了该项。
    foo(); // 打印 `closure`
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-names.scopes.generic-parameters"><a class="rule-link" href="#r-names.scopes.generic-parameters" title="names.scopes.generic-parameters"><span>[names<wbr>.scopes<wbr>.generic-parameters]</span></a>
</div>

<h2 id="泛型参数作用域"><a class="header" href="#泛型参数作用域">泛型参数作用域</a></h2>
<div class="rule" id="r-names.scopes.generic-parameters.param-list"><a class="rule-link" href="#r-names.scopes.generic-parameters.param-list" title="names.scopes.generic-parameters.param-list"><span>[names<wbr>.scopes<wbr>.generic-parameters<wbr>.param-list]</span></a>
</div>

<p>泛型参数在 <a href="#grammar-GenericParams">GenericParams</a> 列表中声明。
泛型参数的作用域在声明它的项之内。</p>
<div class="rule" id="r-names.scopes.generic-parameters.order-independent"><a class="rule-link" href="#r-names.scopes.generic-parameters.order-independent" title="names.scopes.generic-parameters.order-independent"><span>[names<wbr>.scopes<wbr>.generic-parameters<wbr>.order-independent]</span></a>
</div>

<p>所有参数在泛型参数列表中都是可见的，无论其声明顺序如何。
以下展示了一些参数在声明之前被引用的示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 'b 界限在声明之前就被引用了。
fn params_scope&lt;'a: 'b, 'b&gt;() {}

<span class="boring">trait SomeTrait&lt;const Z: usize&gt; {}
</span>// 常量 N 在声明之前就在特型界限中被引用了。
fn f&lt;T: SomeTrait&lt;N&gt;, const N: usize&gt;() {}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-names.scopes.generic-parameters.bounds"><a class="rule-link" href="#r-names.scopes.generic-parameters.bounds" title="names.scopes.generic-parameters.bounds"><span>[names<wbr>.scopes<wbr>.generic-parameters<wbr>.bounds]</span></a>
</div>

<p>泛型参数在类型界限和 where 子句中也在作用域内，例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">trait SomeTrait&lt;'a, T&gt; {}
</span>// SomeTrait 的 &lt;'a, U&gt; 引用了 bounds_scope 的 'a 和 U 参数。
fn bounds_scope&lt;'a, T: SomeTrait&lt;'a, U&gt;, U&gt;() {}

fn where_scope&lt;'a, T, U&gt;()
    where T: SomeTrait&lt;'a, U&gt;
{}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-names.scopes.generic-parameters.inner-items"><a class="rule-link" href="#r-names.scopes.generic-parameters.inner-items" title="names.scopes.generic-parameters.inner-items"><span>[names<wbr>.scopes<wbr>.generic-parameters<wbr>.inner-items]</span></a>
</div>

<p>在函数内部声明的 <a href="#项">项</a> 引用其外部作用域的泛型参数是错误的。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn example&lt;T&gt;() {
    fn inner(x: T) {} // 错误：不能使用外部函数的泛型参数
}
<span class="boring">}</span></code></pre>
<h3 id="泛型参数遮蔽"><a class="header" href="#泛型参数遮蔽">泛型参数遮蔽</a></h3>
<div class="rule" id="r-names.scopes.generic-parameters.shadow"><a class="rule-link" href="#r-names.scopes.generic-parameters.shadow" title="names.scopes.generic-parameters.shadow"><span>[names<wbr>.scopes<wbr>.generic-parameters<wbr>.shadow]</span></a>
</div>

<p>遮蔽泛型参数是错误的，但函数内部声明的项允许遮蔽函数的泛型参数名称。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn example&lt;'a, T, const N: usize&gt;() {
    // 函数内部的项允许遮蔽作用域内的泛型参数。
    fn inner_lifetime&lt;'a&gt;() {} // OK
    fn inner_type&lt;T&gt;() {} // OK
    fn inner_const&lt;const N: usize&gt;() {} // OK
}
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait SomeTrait&lt;'a, T, const N: usize&gt; {
    fn example_lifetime&lt;'a&gt;() {} // 错误：'a 已经在使用中
    fn example_type&lt;T&gt;() {} // 错误：T 已经在使用中
    fn example_const&lt;const N: usize&gt;() {} // 错误：N 已经在使用中
    fn example_mixed&lt;const T: usize&gt;() {} // 错误：T 已经在使用中
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-names.scopes.lifetimes"><a class="rule-link" href="#r-names.scopes.lifetimes" title="names.scopes.lifetimes"><span>[names<wbr>.scopes<wbr>.lifetimes]</span></a>
</div>

<h3 id="生命周期作用域"><a class="header" href="#生命周期作用域">生命周期作用域</a></h3>
<p>生命周期参数在 <a href="#grammar-GenericParams">GenericParams</a> 列表和 <a href="#higher-ranked-trait-bounds">高阶特型界限</a> 中声明。</p>
<div class="rule" id="r-names.scopes.lifetimes.special"><a class="rule-link" href="#r-names.scopes.lifetimes.special" title="names.scopes.lifetimes.special"><span>[names<wbr>.scopes<wbr>.lifetimes<wbr>.special]</span></a>
</div>

<p><code>'static</code> 生命周期和 <a href="#生命周期省略">占位符生命周期</a> <code>'_</code> 具有特殊含义，不能声明为参数。</p>
<h4 id="生命周期泛型参数作用域"><a class="header" href="#生命周期泛型参数作用域">生命周期泛型参数作用域</a></h4>
<div class="rule" id="r-names.scopes.lifetimes.generic"><a class="rule-link" href="#r-names.scopes.lifetimes.generic" title="names.scopes.lifetimes.generic"><span>[names<wbr>.scopes<wbr>.lifetimes<wbr>.generic]</span></a>
</div>

<p><a href="#常量项">常量</a> 和 <a href="#静态项">静态</a> 项以及 <a href="#const-context">常量上下文</a> 仅允许 <code>'static</code> 生命周期引用，因此它们内部不能有其他生命周期。
<a href="#associated-constants">关联常量</a> 确实允许引用其 特型 或实现中声明的生命周期。</p>
<h4 id="高阶特型界限作用域"><a class="header" href="#高阶特型界限作用域">高阶特型界限作用域</a></h4>
<div class="rule" id="r-names.scopes.lifetimes.higher-ranked"><a class="rule-link" href="#r-names.scopes.lifetimes.higher-ranked" title="names.scopes.lifetimes.higher-ranked"><span>[names<wbr>.scopes<wbr>.lifetimes<wbr>.higher-ranked]</span></a>
</div>

<p>声明为 <a href="#higher-ranked-trait-bounds">高阶特型界限</a> 的生命周期参数的作用域取决于它的使用场景。</p>
<ul>
<li>作为 <a href="#grammar-TypeBoundWhereClauseItem">TypeBoundWhereClauseItem</a>，声明的生命周期在类型和类型界限中处于作用域内。</li>
<li>作为 <a href="#grammar-TraitBound">TraitBound</a>，声明的生命周期在界限类型路径中处于作用域内。</li>
<li>作为 <a href="#grammar-BareFunctionType">BareFunctionType</a>，声明的生命周期在函数参数和返回类型中处于作用域内。</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">trait Trait&lt;'a&gt;{}
</span>
fn where_clause&lt;T&gt;()
    // 'a 在类型和类型界限中都在作用域内。
    where for &lt;'a&gt; &amp;'a T: Trait&lt;'a&gt;
{}

fn bound&lt;T&gt;()
    // 'a 在界限内处于作用域内。
    where T: for &lt;'a&gt; Trait&lt;'a&gt;
{}

<span class="boring">struct Example&lt;'a&gt; {
</span><span class="boring">    field: &amp;'a u32
</span><span class="boring">}
</span>
// 'a 在参数和返回类型中都在作用域内。
type FnExample = for&lt;'a&gt; fn(x: Example&lt;'a&gt;) -&gt; Example&lt;'a&gt;;
<span class="boring">}</span></code></pre>
<h4 id="impl-trait限制"><a class="header" href="#impl-trait限制">Impl trait限制</a></h4>
<div class="rule" id="r-names.scopes.lifetimes.impl-trait"><a class="rule-link" href="#r-names.scopes.lifetimes.impl-trait" title="names.scopes.lifetimes.impl-trait"><span>[names<wbr>.scopes<wbr>.lifetimes<wbr>.impl-trait]</span></a>
</div>

<p><a href="#impl-trait">Impl trait</a> 类型只能引用在函数或实现上声明的生命周期。</p>
<!-- not able to demonstrate the scope error because the compiler panics
     https://github.com/rust-lang/rust/issues/67830
-->
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">trait Trait1 {
</span><span class="boring">    type Item;
</span><span class="boring">}
</span><span class="boring">trait Trait2&lt;'a&gt; {}
</span><span class="boring">
</span><span class="boring">struct Example;
</span><span class="boring">
</span><span class="boring">impl Trait1 for Example {
</span><span class="boring">    type Item = Element;
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">struct Element;
</span><span class="boring">impl&lt;'a&gt; Trait2&lt;'a&gt; for Element {}
</span><span class="boring">
</span>// 这里的 impl Trait2 不允许引用 'b，但允许引用 'a。
fn foo&lt;'a&gt;() -&gt; impl for&lt;'b&gt; Trait1&lt;Item = impl Trait2&lt;'a&gt; + use&lt;'a&gt;&gt; {
    // ...
<span class="boring">   Example
</span>}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-names.scopes.loop-label"><a class="rule-link" href="#r-names.scopes.loop-label" title="names.scopes.loop-label"><span>[names<wbr>.scopes<wbr>.loop-label]</span></a>
</div>

<h2 id="循环标签作用域"><a class="header" href="#循环标签作用域">循环标签作用域</a></h2>
<div class="rule" id="r-names.scopes.loop-label.scope"><a class="rule-link" href="#r-names.scopes.loop-label.scope" title="names.scopes.loop-label.scope"><span>[names<wbr>.scopes<wbr>.loop-label<wbr>.scope]</span></a>
</div>

<p><a href="#loop-labels">循环标签</a> 可以由 <a href="#循环及其他可中断表达式">循环表达式</a> 声明。
循环标签的作用域从它被声明的那一点开始，直到循环表达式结束。
该作用域不会延伸到 <a href="#项">项</a>、<a href="#闭包表达式">闭包</a>、<a href="#async-blocks">异步块</a>、<a href="#const-generics">常量参数</a>、<a href="#const-context">常量上下文</a> 以及定义它的 <a href="#iterator-loops"><code>for</code> 循环</a> 的迭代器表达式中。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>'a: for n in 0..3 {
    if n % 2 == 0 {
        break 'a;
    }
    fn inner() {
        // 在这里使用 'a 将是一个错误。
        // break 'a;
    }
}

// 标签在 while 循环的表达式中处于作用域内。
'a: while break 'a {}         // 循环不运行。
'a: while let _ = break 'a {} // 循环不运行。

// 标签在定义它的 for 循环中不在作用域内：
'a: for outer in 0..5 {
    // 这将中断外部循环，跳过内部循环并停止外部循环。
    'a: for inner in { break 'a; 0..1 } {
        println!("{}", inner); // 这不会运行。
    }
    println!("{}", outer); // 这也不会运行。
}

<span class="boring">}</span></code></pre>
<div class="rule" id="r-names.scopes.loop-label.shadow"><a class="rule-link" href="#r-names.scopes.loop-label.shadow" title="names.scopes.loop-label.shadow"><span>[names<wbr>.scopes<wbr>.loop-label<wbr>.shadow]</span></a>
</div>

<p>循环标签可能会遮蔽外部作用域中同名的标签。
对标签的引用指向最近的定义。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 循环标签遮蔽示例。
'a: for outer in 0..5 {
    'a: for inner in 0..5 {
        // 这会终止内部循环，但外部循环继续运行。
        break 'a;
    }
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-names.scopes.prelude"><a class="rule-link" href="#r-names.scopes.prelude" title="names.scopes.prelude"><span>[names<wbr>.scopes<wbr>.prelude]</span></a>
</div>

<h2 id="预导入作用域"><a class="header" href="#预导入作用域">预导入作用域</a></h2>
<div class="rule" id="r-names.scopes.prelude.intro"><a class="rule-link" href="#r-names.scopes.prelude.intro" title="names.scopes.prelude.intro"><span>[names<wbr>.scopes<wbr>.prelude<wbr>.intro]</span></a>
</div>

<p><a href="#预导入">预导入</a> 将实体引入每个模块的作用域。
这些实体不是模块的成员，但在 <a href="#名称解析">名称解析</a> 期间会被隐式查询。</p>
<div class="rule" id="r-names.scopes.prelude.shadow"><a class="rule-link" href="#r-names.scopes.prelude.shadow" title="names.scopes.prelude.shadow"><span>[names<wbr>.scopes<wbr>.prelude<wbr>.shadow]</span></a>
</div>

<p>预导入名称可能会被模块中的声明遮蔽。</p>
<div class="rule" id="r-names.scopes.prelude.layers"><a class="rule-link" href="#r-names.scopes.prelude.layers" title="names.scopes.prelude.layers"><span>[names<wbr>.scopes<wbr>.prelude<wbr>.layers]</span></a>
</div>

<p>预导入是分层的，如果它们包含同名的实体，则其中一个会遮蔽另一个。
预导入可能遮蔽其他预导入的顺序如下，其中前面的条目可以遮蔽后面的条目：</p>
<ol>
<li><a href="#extern-prelude">外部预导入</a></li>
<li><a href="#tool-prelude">工具预导入</a></li>
<li><a href="#macro_use-prelude"><code>macro_use</code> 预导入</a></li>
<li><a href="#standard-library-prelude">标准库预导入</a></li>
<li><a href="#language-prelude">语言预导入</a></li>
</ol>
<div class="rule" id="r-names.scopes.macro_rules"><a class="rule-link" href="#r-names.scopes.macro_rules" title="names.scopes.macro_rules"><span>[names<wbr>.scopes<wbr>.macro_rules]</span></a>
</div>

<h2 id="macro_rules作用域"><a class="header" href="#macro_rules作用域"><code>macro_rules</code>作用域</a></h2>
<p><code>macro_rules</code> 宏的作用域在 <a href="#声明宏">声明宏</a> 章节中描述。
其行为取决于 <a href="#macro_use属性"><code>macro_use</code></a> 和 <a href="#macro_export属性"><code>macro_export</code></a> 属性的使用。</p>
<div class="rule" id="r-names.scopes.derive"><a class="rule-link" href="#r-names.scopes.derive" title="names.scopes.derive"><span>[names<wbr>.scopes<wbr>.derive]</span></a>
</div>

<h2 id="派生宏辅助属性-1"><a class="header" href="#派生宏辅助属性-1">派生宏辅助属性</a></h2>
<div class="rule" id="r-names.scopes.derive.scope"><a class="rule-link" href="#r-names.scopes.derive.scope" title="names.scopes.derive.scope"><span>[names<wbr>.scopes<wbr>.derive<wbr>.scope]</span></a>
</div>

<p><a href="#派生宏辅助属性">派生宏辅助属性</a> 在指定了其相应 <a href="#派生"><code>derive</code> 属性</a> 的项中处于作用域内。
该作用域从 <code>derive</code> 属性之后延伸到该项结束。 <!-- 注意：并非严格正确，见 https://github.com/rust-lang/rust/issues/79202 ，但这是本意。 --></p>
<div class="rule" id="r-names.scopes.derive.shadow"><a class="rule-link" href="#r-names.scopes.derive.shadow" title="names.scopes.derive.shadow"><span>[names<wbr>.scopes<wbr>.derive<wbr>.shadow]</span></a>
</div>

<p>辅助属性会遮蔽作用域内同名的其他属性。</p>
<div class="rule" id="r-names.scopes.self"><a class="rule-link" href="#r-names.scopes.self" title="names.scopes.self"><span>[names<wbr>.scopes<wbr>.self]</span></a>
</div>

<h2 id="self作用域"><a class="header" href="#self作用域"><code>Self</code>作用域</a></h2>
<div class="rule" id="r-names.scopes.self.intro"><a class="rule-link" href="#r-names.scopes.self.intro" title="names.scopes.self.intro"><span>[names<wbr>.scopes<wbr>.self<wbr>.intro]</span></a>
</div>

<p>虽然 <a href="#self-1"><code>Self</code></a> 是一个具有特殊含义的关键字，但它与名称解析的交互方式类似于普通名称。</p>
<div class="rule" id="r-names.scopes.self.def-scope"><a class="rule-link" href="#r-names.scopes.self.def-scope" title="names.scopes.self.def-scope"><span>[names<wbr>.scopes<wbr>.self<wbr>.def-scope]</span></a>
</div>

<p><a href="#结构体">结构体</a>、<a href="#枚举">枚举</a>、<a href="#联合体">联合体</a>、<a href="#特型">特型</a> 或 <a href="#实现">实现</a> 的定义中的隐式 <code>Self</code> 类型被视为类似于 <a href="#generic-parameter-scopes">泛型参数</a>，其作用域与泛型类型参数相同。</p>
<div class="rule" id="r-names.scopes.self.impl-scope"><a class="rule-link" href="#r-names.scopes.self.impl-scope" title="names.scopes.self.impl-scope"><span>[names<wbr>.scopes<wbr>.self<wbr>.impl-scope]</span></a>
</div>

<p><a href="#实现">实现</a> 的值 <a href="#命名空间">命名空间</a> 中的隐式 <code>Self</code> 构造函数在实现体（实现的 <a href="#关联项">关联项</a>）内处于作用域内。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 结构体定义内的 Self 类型。
struct Recursive {
    f1: Option&lt;Box&lt;Self&gt;&gt;
}

// 泛型参数内的 Self 类型。
struct SelfGeneric&lt;T: Into&lt;Self&gt;&gt;(T);

// 实现内的 Self 值构造函数。
struct ImplExample();
impl ImplExample {
    fn example() -&gt; Self { // Self 类型
        Self() // Self 值构造函数
    }
}
<span class="boring">}</span></code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-names.preludes"><a class="rule-link" href="#r-names.preludes" title="names.preludes"><span>[names<wbr>.preludes]</span></a>
</div>

<h1 id="预导入"><a class="header" href="#预导入">预导入</a></h1>
<div class="rule" id="r-names.preludes.intro"><a class="rule-link" href="#r-names.preludes.intro" title="names.preludes.intro"><span>[names<wbr>.preludes<wbr>.intro]</span></a>
</div>

<p>一个 <em>预导入</em> 是自动引入到 crate 中每个模块作用域的名称集合。</p>
<p>这些 预导入 名称本身不是模块的一部分：它们在 <a href="#名称解析">名称解析</a> 期间被隐式查询。例如，尽管像 <a href="../alloc/boxed/struct.Box.html"><code>Box</code></a> 这样的东西在每个模块的作用域内，你也不能将其引用为 <code>self::Box</code>，因为它不是当前模块的成员。</p>
<div class="rule" id="r-names.preludes.kinds"><a class="rule-link" href="#r-names.preludes.kinds" title="names.preludes.kinds"><span>[names<wbr>.preludes<wbr>.kinds]</span></a>
</div>

<p>有几种不同的 预导入：</p>
<ul>
<li><a href="#r-names.preludes.std">标准库预导入</a></li>
<li><a href="#extern-prelude">外部预导入</a></li>
<li><a href="#language-prelude">语言预导入</a></li>
<li><a href="#macro_use-prelude"><code>macro_use</code> 预导入</a></li>
<li><a href="#tool-prelude">工具预导入</a></li>
</ul>
<div class="rule" id="r-names.preludes.std"><a class="rule-link" href="#r-names.preludes.std" title="names.preludes.std"><span>[names<wbr>.preludes<wbr>.std]</span></a>
</div>

<h2 id="标准库预导入"><a class="header" href="#标准库预导入">标准库预导入</a></h2>
<div class="rule" id="r-names.preludes.std.intro"><a class="rule-link" href="#r-names.preludes.std.intro" title="names.preludes.std.intro"><span>[names<wbr>.preludes<wbr>.std<wbr>.intro]</span></a>
</div>

<p>每个 crate 都有一个标准库预导入，它由单个标准库模块中的名称组成。</p>
<div class="rule" id="r-names.preludes.std.module"><a class="rule-link" href="#r-names.preludes.std.module" title="names.preludes.std.module"><span>[names<wbr>.preludes<wbr>.std<wbr>.module]</span></a>
</div>

<p>所使用的模块取决于 crate 的 版次，以及是否对 crate 应用了 <a href="#the-no_std-attribute"><code>no_std</code> 属性</a>：</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>版次</th><th>未应用 <code>no_std</code></th><th>已应用 <code>no_std</code></th></tr>
</thead>
<tbody>
<tr><td>2015</td><td><a href="../std/prelude/rust_2015/index.html"><code>std::prelude::rust_2015</code></a></td><td><a href="../core/prelude/rust_2015/index.html"><code>core::prelude::rust_2015</code></a></td></tr>
<tr><td>2018</td><td><a href="../std/prelude/rust_2018/index.html"><code>std::prelude::rust_2018</code></a></td><td><a href="../core/prelude/rust_2018/index.html"><code>core::prelude::rust_2018</code></a></td></tr>
<tr><td>2021</td><td><a href="../std/prelude/rust_2021/index.html"><code>std::prelude::rust_2021</code></a></td><td><a href="../core/prelude/rust_2021/index.html"><code>core::prelude::rust_2021</code></a></td></tr>
<tr><td>2024</td><td><a href="../std/prelude/rust_2024/index.html"><code>std::prelude::rust_2024</code></a></td><td><a href="../core/prelude/rust_2024/index.html"><code>core::prelude::rust_2024</code></a></td></tr>
</tbody>
</table>
</div>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><a href="../std/prelude/rust_2015/index.html"><code>std::prelude::rust_2015</code></a> 和 <a href="../std/prelude/rust_2018/index.html"><code>std::prelude::rust_2018</code></a> 的内容与 <a href="../std/prelude/v1/index.html"><code>std::prelude::v1</code></a> 相同。</p>
<p><a href="../core/prelude/rust_2015/index.html"><code>core::prelude::rust_2015</code></a> 和 <a href="../core/prelude/rust_2018/index.html"><code>core::prelude::rust_2018</code></a> 的内容与 <a href="../core/prelude/v1/index.html"><code>core::prelude::v1</code></a> 相同。</p>
</blockquote>
</div>

<div class="rule" id="r-names.preludes.extern"><a class="rule-link" href="#r-names.preludes.extern" title="names.preludes.extern"><span>[names<wbr>.preludes<wbr>.extern]</span></a>
</div>

<h2 id="外部预导入"><a class="header" href="#外部预导入">外部预导入</a></h2>
<div class="rule" id="r-names.preludes.extern.intro"><a class="rule-link" href="#r-names.preludes.extern.intro" title="names.preludes.extern.intro"><span>[names<wbr>.preludes<wbr>.extern<wbr>.intro]</span></a>
</div>

<p>在根模块中使用 <a href="#extern-crate-声明"><code>extern crate</code></a> 导入或提供给编译器（如使用 <code>rustc</code> 的 <code>--extern</code> 标志）的外部 crate 会被添加到 <em>外部预导入</em> 中。如果使用别名导入（如 <code>extern crate orig_name as new_name</code>），那么符号 <code>new_name</code> 将被添加到 预导入 中。</p>
<div class="rule" id="r-names.preludes.extern.core"><a class="rule-link" href="#r-names.preludes.extern.core" title="names.preludes.extern.core"><span>[names<wbr>.preludes<wbr>.extern<wbr>.core]</span></a>
</div>

<p><a href="../core/index.html"><code>core</code></a> crate 总是被添加到 外部预导入 中。</p>
<div class="rule" id="r-names.preludes.extern.std"><a class="rule-link" href="#r-names.preludes.extern.std" title="names.preludes.extern.std"><span>[names<wbr>.preludes<wbr>.extern<wbr>.std]</span></a>
</div>

<p>只要在 crate 根中没有指定 <a href="#the-no_std-attribute"><code>no_std</code> 属性</a>，<a href="../std/index.html"><code>std</code></a> crate 就会被添加。</p>
<div class="rule" id="r-names.preludes.extern.edition2018"><a class="rule-link" href="#r-names.preludes.extern.edition2018" title="names.preludes.extern.edition2018"><span>[names<wbr>.preludes<wbr>.extern<wbr>.edition2018]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p>在 2015 版次中，外部预导入中的 crate 不能通过 <a href="#use声明">use 声明</a> 引用，因此通常的标准做法是包含 <code>extern crate</code> 声明来将它们引入作用域。</p>
<p>从 2018 版次开始，<a href="#use声明">use 声明</a> 可以引用 外部预导入 中的 crate，因此使用 <code>extern crate</code> 被认为是不符合习惯的。</p>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>随 <code>rustc</code> 一起提供的其他 crate，例如 <a href="../alloc/index.html"><code>alloc</code></a> 和 <a href="../test/index.html"><code>test</code></a>，在使用 Cargo 时不会通过 <code>--extern</code> 标志自动包含。即使在 2018 版次中，也必须通过 <code>extern crate</code> 声明将它们引入作用域。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>extern crate alloc;
use alloc::rc::Rc;
<span class="boring">}</span></code></pre>
<p>Cargo 仅会为过程宏 crate 将 <code>proc_macro</code> 引入 外部预导入。</p>
</blockquote>
</div>

<!--
See https://github.com/rust-lang/rust/issues/57288 for more about the
alloc/test limitation.
-->
<!-- template:attributes -->
<div class="rule" id="r-names.preludes.extern.no_std"><a class="rule-link" href="#r-names.preludes.extern.no_std" title="names.preludes.extern.no_std"><span>[names<wbr>.preludes<wbr>.extern<wbr>.no_std]</span></a>
</div>

<h3 id="no_std属性"><a class="header" href="#no_std属性">no_std属性</a></h3>
<div class="rule" id="r-names.preludes.extern.no_std.intro"><a class="rule-link" href="#r-names.preludes.extern.no_std.intro" title="names.preludes.extern.no_std.intro"><span>[names<wbr>.preludes<wbr>.extern<wbr>.no_std<wbr>.intro]</span></a>
</div>

<p><em><code>no_std</code> <a href="#r-attributes">属性</a></em> 会导致 <a href="../std/index.html"><code>std</code></a> crate 不被自动链接，<a href="#r-names.preludes.std">标准库预导入</a> 转而使用 <code>core</code> 预导入，且 <a href="#macro_use-prelude"><code>macro_use</code> 预导入</a> 转而使用从 <code>core</code> crate 导出的宏。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<!-- ignore: test infrastructure can't handle no_std -->
<pre><code class="language-rust ignore">#![no_std]</code></pre>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>当 crate 的目标平台不支持标准库，或者是有意不使用标准库的功能时，使用 <code>no_std</code> 很有用。这些功能主要是动态内存分配（例如 <code>Box</code> 和 <code>Vec</code>）以及文件和网络功能（例如 <code>std::fs</code> 和 <code>std::io</code>）。</p>
</blockquote>
</div>

<div class="alert alert-warning">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>警告</p>

<p>使用 <code>no_std</code> 并不阻止链接标准库。在 crate 或其依赖项之一中编写 <code>extern crate std</code> 仍然是有效的；这将导致编译器将 <code>std</code> crate 链接到程序中。</p>
</blockquote>
</div>

<div class="rule" id="r-names.preludes.extern.no_std.syntax"><a class="rule-link" href="#r-names.preludes.extern.no_std.syntax" title="names.preludes.extern.no_std.syntax"><span>[names<wbr>.preludes<wbr>.extern<wbr>.no_std<wbr>.syntax]</span></a>
</div>

<p><code>no_std</code> 属性使用 <a href="#grammar-MetaWord">MetaWord</a> 语法格式。</p>
<div class="rule" id="r-names.preludes.extern.no_std.allowed-positions"><a class="rule-link" href="#r-names.preludes.extern.no_std.allowed-positions" title="names.preludes.extern.no_std.allowed-positions"><span>[names<wbr>.preludes<wbr>.extern<wbr>.no_std<wbr>.allowed-positions]</span></a>
</div>

<p><code>no_std</code> 属性只能应用于 crate 根。</p>
<div class="rule" id="r-names.preludes.extern.no_std.duplicates"><a class="rule-link" href="#r-names.preludes.extern.no_std.duplicates" title="names.preludes.extern.no_std.duplicates"><span>[names<wbr>.preludes<wbr>.extern<wbr>.no_std<wbr>.duplicates]</span></a>
</div>

<p><code>no_std</code> 属性可以在一个形式上使用任意次数。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 会对第一次之后的任何使用发出 lint。</p>
</blockquote>
</div>

<div class="rule" id="r-names.preludes.extern.no_std.module"><a class="rule-link" href="#r-names.preludes.extern.no_std.module" title="names.preludes.extern.no_std.module"><span>[names<wbr>.preludes<wbr>.extern<wbr>.no_std<wbr>.module]</span></a>
</div>

<p><code>no_std</code> 属性将 <a href="#r-names.preludes.std">标准库预导入</a> 更改为使用 <code>core</code> 预导入而不是 <code>std</code> 预导入。</p>
<div class="rule" id="r-names.preludes.extern.no_std.macro_use"><a class="rule-link" href="#r-names.preludes.extern.no_std.macro_use" title="names.preludes.extern.no_std.macro_use"><span>[names<wbr>.preludes<wbr>.extern<wbr>.no_std<wbr>.macro_use]</span></a>
</div>

<p>默认情况下，从 <code>std</code> crate 导出的所有宏都会被添加到 <a href="#macro_use-prelude"><code>macro_use</code> 预导入</a> 中。如果指定了 <code>no_std</code> 属性，那么从 <code>core</code> crate 导出的所有宏将转而被放入 <a href="#macro_use-prelude"><code>macro_use</code> 预导入</a> 中。</p>
<div class="rule" id="r-names.preludes.extern.no_std.edition2018"><a class="rule-link" href="#r-names.preludes.extern.no_std.edition2018" title="names.preludes.extern.no_std.edition2018"><span>[names<wbr>.preludes<wbr>.extern<wbr>.no_std<wbr>.edition2018]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p>在 2018 版次之前，<code>std</code> 默认注入到 crate 根中。如果指定了 <code>no_std</code>，则注入 <code>core</code> 代替。从 2018 版次开始，无论是否指定 <code>no_std</code>，都不会将两者注入到 crate 根中。</p>
</blockquote>
</div>

<div class="rule" id="r-names.preludes.lang"><a class="rule-link" href="#r-names.preludes.lang" title="names.preludes.lang"><span>[names<wbr>.preludes<wbr>.lang]</span></a>
</div>

<h2 id="语言预导入"><a class="header" href="#语言预导入">语言预导入</a></h2>
<div class="rule" id="r-names.preludes.lang.intro"><a class="rule-link" href="#r-names.preludes.lang.intro" title="names.preludes.lang.intro"><span>[names<wbr>.preludes<wbr>.lang<wbr>.intro]</span></a>
</div>

<p>语言预导入包含了语言内置的类型和属性名称。语言预导入始终在作用域内。</p>
<div class="rule" id="r-names.preludes.lang.entities"><a class="rule-link" href="#r-names.preludes.lang.entities" title="names.preludes.lang.entities"><span>[names<wbr>.preludes<wbr>.lang<wbr>.entities]</span></a>
</div>

<p>它包含以下内容：</p>
<ul>
<li><a href="#命名空间">类型命名空间</a>
<ul>
<li><a href="#布尔类型">布尔类型</a> — <code>bool</code></li>
<li><a href="#文本类型">文本类型</a> — <code>char</code> 和 <code>str</code></li>
<li><a href="#integer-types">整数类型</a> — <code>i8</code>, <code>i16</code>, <code>i32</code>, <code>i64</code>, <code>i128</code>, <code>u8</code>, <code>u16</code>, <code>u32</code>, <code>u64</code>, <code>u128</code></li>
<li><a href="#machine-dependent-integer-types">平台相关整数类型</a> — <code>usize</code> 和 <code>isize</code></li>
<li><a href="#floating-point-types">浮点类型</a> — <code>f32</code> 和 <code>f64</code></li>
</ul>
</li>
<li><a href="#命名空间">宏命名空间</a>
<ul>
<li><a href="#built-in-attributes-index">内置属性</a></li>
<li><a href="#r-attributes.derive.built-in">内置派生宏</a></li>
</ul>
</li>
</ul>
<div class="rule" id="r-names.preludes.macro_use"><a class="rule-link" href="#r-names.preludes.macro_use" title="names.preludes.macro_use"><span>[names<wbr>.preludes<wbr>.macro_use]</span></a>
</div>

<h2 id="macro_use预导入"><a class="header" href="#macro_use预导入"><code>macro_use</code>预导入</a></h2>
<div class="rule" id="r-names.preludes.macro_use.intro"><a class="rule-link" href="#r-names.preludes.macro_use.intro" title="names.preludes.macro_use.intro"><span>[names<wbr>.preludes<wbr>.macro_use<wbr>.intro]</span></a>
</div>

<p><code>macro_use</code> 预导入包含了从应用了 <a href="#macro_use属性"><code>macro_use</code> 属性</a> 的 <a href="#extern-crate-声明"><code>extern crate</code></a> 导入的外部 crate 中的宏。</p>
<div class="rule" id="r-names.preludes.tool"><a class="rule-link" href="#r-names.preludes.tool" title="names.preludes.tool"><span>[names<wbr>.preludes<wbr>.tool]</span></a>
</div>

<h2 id="工具预导入"><a class="header" href="#工具预导入">工具预导入</a></h2>
<div class="rule" id="r-names.preludes.tool.intro"><a class="rule-link" href="#r-names.preludes.tool.intro" title="names.preludes.tool.intro"><span>[names<wbr>.preludes<wbr>.tool<wbr>.intro]</span></a>
</div>

<p>工具预导入包含了 <a href="#命名空间">类型命名空间</a> 中外部工具的工具名称。有关更多详细信息，请参阅 <a href="#tool-attributes">工具属性</a> 部分。</p>
<!-- template:attributes -->
<div class="rule" id="r-names.preludes.no_implicit_prelude"><a class="rule-link" href="#r-names.preludes.no_implicit_prelude" title="names.preludes.no_implicit_prelude"><span>[names<wbr>.preludes<wbr>.no_implicit_prelude]</span></a>
</div>

<h2 id="no_implicit_prelude属性"><a class="header" href="#no_implicit_prelude属性">no_implicit_prelude属性</a></h2>
<div class="rule" id="r-names.preludes.no_implicit_prelude.intro"><a class="rule-link" href="#r-names.preludes.no_implicit_prelude.intro" title="names.preludes.no_implicit_prelude.intro"><span>[names<wbr>.preludes<wbr>.no_implicit_prelude<wbr>.intro]</span></a>
</div>

<p><em><code>no_implicit_prelude</code> <a href="#属性-1">属性</a></em> 用于防止隐式 预导入 被引入作用域。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 该属性可以应用于 crate 根以影响
// 所有模块。
#![no_implicit_prelude]

// 或者它可以应用于一个模块，仅影响该模块
// 及其后代。
#[no_implicit_prelude]
mod example {
    // ...
}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-names.preludes.no_implicit_prelude.syntax"><a class="rule-link" href="#r-names.preludes.no_implicit_prelude.syntax" title="names.preludes.no_implicit_prelude.syntax"><span>[names<wbr>.preludes<wbr>.no_implicit_prelude<wbr>.syntax]</span></a>
</div>

<p><code>no_implicit_prelude</code> 属性使用 <a href="#grammar-MetaWord">MetaWord</a> 语法格式。</p>
<div class="rule" id="r-names.preludes.no_implicit_prelude.allowed-positions"><a class="rule-link" href="#r-names.preludes.no_implicit_prelude.allowed-positions" title="names.preludes.no_implicit_prelude.allowed-positions"><span>[names<wbr>.preludes<wbr>.no_implicit_prelude<wbr>.allowed-positions]</span></a>
</div>

<p><code>no_implicit_prelude</code> 属性只能应用于 crate 或模块。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 会忽略在其他位置的使用，但会对其发出 lint。这在未来可能会变成一个错误。</p>
</blockquote>
</div>

<div class="rule" id="r-names.preludes.no_implicit_prelude.duplicates"><a class="rule-link" href="#r-names.preludes.no_implicit_prelude.duplicates" title="names.preludes.no_implicit_prelude.duplicates"><span>[names<wbr>.preludes<wbr>.no_implicit_prelude<wbr>.duplicates]</span></a>
</div>

<p><code>no_implicit_prelude</code> 属性可以在一个形式上使用任意次数。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 会对第一次之后的任何使用发出 lint。</p>
</blockquote>
</div>

<div class="rule" id="r-names.preludes.no_implicit_prelude.excluded-preludes"><a class="rule-link" href="#r-names.preludes.no_implicit_prelude.excluded-preludes" title="names.preludes.no_implicit_prelude.excluded-preludes"><span>[names<wbr>.preludes<wbr>.no_implicit_prelude<wbr>.excluded-preludes]</span></a>
</div>

<p><code>no_implicit_prelude</code> 属性阻止 <a href="#r-names.preludes.std">标准库预导入</a>、<a href="#extern-prelude">外部预导入</a>、<a href="#macro_use-prelude"><code>macro_use</code> 预导入</a> 和 <a href="#tool-prelude">工具预导入</a> 被引入到该模块及其后代的作用域中。</p>
<div class="rule" id="r-names.preludes.no_implicit_prelude.lang"><a class="rule-link" href="#r-names.preludes.no_implicit_prelude.lang" title="names.preludes.no_implicit_prelude.lang"><span>[names<wbr>.preludes<wbr>.no_implicit_prelude<wbr>.lang]</span></a>
</div>

<p><code>no_implicit_prelude</code> 属性不影响 <a href="#language-prelude">语言预导入</a>。</p>
<div class="rule" id="r-names.preludes.no_implicit_prelude.edition2018"><a class="rule-link" href="#r-names.preludes.no_implicit_prelude.edition2018" title="names.preludes.no_implicit_prelude.edition2018"><span>[names<wbr>.preludes<wbr>.no_implicit_prelude<wbr>.edition2018]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p>在 2015 版次中，<code>no_implicit_prelude</code> 属性不影响 <a href="#macro_use-prelude"><code>macro_use</code> 预导入</a>，并且从标准库导出的所有宏仍包含在 <code>macro_use</code> 预导入中。从 2018 版次开始，该属性确实会移除 <code>macro_use</code> 预导入。</p>
</blockquote>
</div>

<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-paths"><a class="rule-link" href="#r-paths" title="paths"><span>[paths]</span></a>
</div>

<h1 id="路径"><a class="header" href="#路径">路径</a></h1>
<div class="rule" id="r-paths.intro"><a class="rule-link" href="#r-paths.intro" title="paths.intro"><span>[paths<wbr>.intro]</span></a>
</div>

<p>一个 <em>路径</em> 是由 <code>::</code> 词法单元分隔的一个或多个路径段组成的序列。路径用于引用 <a href="#项">项</a>、值、 <a href="#类型">类型</a>、 <a href="#宏">宏</a> 和 <a href="#属性-1">属性</a>。</p>
<p>两个仅由标识符段组成的简单路径示例：</p>
<!-- ignore: syntax fragment -->
<pre><code class="language-rust ignore">x;
x::y::z;</code></pre>
<h2 id="路径的类型"><a class="header" href="#路径的类型">路径的类型</a></h2>
<div class="rule" id="r-paths.simple"><a class="rule-link" href="#r-paths.simple" title="paths.simple"><span>[paths<wbr>.simple]</span></a>
</div>

<h3 id="简单路径"><a class="header" href="#简单路径">简单路径</a></h3>
<div class="rule" id="r-paths.simple.syntax"><a class="rule-link" href="#r-paths.simple.syntax" title="paths.simple.syntax"><span>[paths<wbr>.simple<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-SimplePath" onclick="show_railroad()"><a href="#railroad-SimplePath">SimplePath</a></span> → <br>    <span class="grammar-literal">::</span><sup>?</sup> <span class="grammar-text"><a href="#grammar-SimplePathSegment">SimplePathSegment</a></span> ( <span class="grammar-literal">::</span> <span class="grammar-text"><a href="#grammar-SimplePathSegment">SimplePathSegment</a></span> )<sup>*</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-SimplePathSegment" onclick="show_railroad()"><a href="#railroad-SimplePathSegment">SimplePathSegment</a></span> → <br>    <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> | <span class="grammar-literal">super</span> | <span class="grammar-literal">self</span> | <span class="grammar-literal">crate</span> | <span class="grammar-literal">$crate</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 604px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-SimplePath"><svg class="railroad" viewbox="0 0 604 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-SimplePath">
<text class="comment" x="50" y="25">
SimplePath</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 36 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="55" />
<text x="77" y="71">
::</text>
</g>
</g>
<a class="link" xlink:href="#railroad-SimplePathSegment">
<g class="nonterminal">
<rect height="22" width="156" x="129" y="55" />
<text x="207" y="71">
SimplePathSegment</text>
</g>
</a>
<g class="optional">
<path d=" M 295 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 226 m -110 0 l -5 -5 m 0 10 l 5 -5 m 110 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 319 66 h 12 m 202 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -202 m 104 0 l 5 -5 m 0 10 l -5 -5 m -104 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="331" y="55" />
<text x="349" y="71">
::</text>
</g>
<a class="link" xlink:href="#railroad-SimplePathSegment">
<g class="nonterminal">
<rect height="22" width="156" x="377" y="55" />
<text x="455" y="71">
SimplePathSegment</text>
</g>
</a>
<path d=" M 367 66 h 10" />
</g>
</g>
</g>
<path d=" M 119 66 h 10" />
<path d=" M 285 66 h 10" />
</g>
<path d=" M 579 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 569 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 218px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-SimplePathSegment"><svg class="railroad" viewbox="0 0 218 206" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-SimplePathSegment">
<text class="comment" x="74" y="25">
SimplePathSegment</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 100 0 h 24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="42" />
<text x="109" y="58">
IDENTIFIER</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 124 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 124 0 v -33" />
<path d=" M 47 107 v 33 m 124 0 v -33" />
<path d=" M 47 140 v 33 m 124 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 60 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="59" y="75" />
<text x="89" y="91">
super</text>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 52 0 h 48 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="108" />
<text x="85" y="124">
self</text>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 60 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="59" y="141" />
<text x="89" y="157">
crate</text>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 68 0 h 32 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="174" />
<text x="93" y="190">
$crate</text>
</g>
</g>
<path d=" M 193 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 183 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-paths.simple.intro"><a class="rule-link" href="#r-paths.simple.intro" title="paths.simple.intro"><span>[paths<wbr>.simple<wbr>.intro]</span></a>
</div>

<p>简单路径用于 <a href="#可见性和私有性">可见性</a> 标记、 <a href="#属性-1">属性</a>、 <a href="#声明宏">声明宏</a> 和 <a href="#use声明"><code>use</code></a> 项。例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::io::{self, Write};
mod m {
    #[clippy::cyclomatic_complexity = "0"]
    pub (in super) fn f1() {}
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-paths.expr"><a class="rule-link" href="#r-paths.expr" title="paths.expr"><span>[paths<wbr>.expr]</span></a>
</div>

<h3 id="表达式中的路径"><a class="header" href="#表达式中的路径">表达式中的路径</a></h3>
<div class="rule" id="r-paths.expr.syntax"><a class="rule-link" href="#r-paths.expr.syntax" title="paths.expr.syntax"><span>[paths<wbr>.expr<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-PathInExpression" onclick="show_railroad()"><a href="#railroad-PathInExpression">PathInExpression</a></span> → <br>    <span class="grammar-literal">::</span><sup>?</sup> <span class="grammar-text"><a href="#grammar-PathExprSegment">PathExprSegment</a></span> ( <span class="grammar-literal">::</span> <span class="grammar-text"><a href="#grammar-PathExprSegment">PathExprSegment</a></span> )<sup>*</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-PathExprSegment" onclick="show_railroad()"><a href="#railroad-PathExprSegment">PathExprSegment</a></span> → <br>    <span class="grammar-text"><a href="#grammar-PathIdentSegment">PathIdentSegment</a></span> ( <span class="grammar-literal">::</span> <span class="grammar-text"><a href="#grammar-GenericArgs">GenericArgs</a></span> )<sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-PathIdentSegment" onclick="show_railroad()"><a href="#railroad-PathIdentSegment">PathIdentSegment</a></span> → <br>    <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> | <span class="grammar-literal">super</span> | <span class="grammar-literal">self</span> | <span class="grammar-literal">Self</span> | <span class="grammar-literal">crate</span> | <span class="grammar-literal">$crate</span></p>
<p><span class="grammar-text grammar-production" id="grammar-GenericArgs" onclick="show_railroad()"><a href="#railroad-GenericArgs">GenericArgs</a></span> → <br>      <span class="grammar-literal">&lt;</span> <span class="grammar-literal">&gt;</span> <br>    | <span class="grammar-literal">&lt;</span> ( <span class="grammar-text"><a href="#grammar-GenericArg">GenericArg</a></span> <span class="grammar-literal">,</span> )<sup>*</sup> <span class="grammar-text"><a href="#grammar-GenericArg">GenericArg</a></span> <span class="grammar-literal">,</span><sup>?</sup> <span class="grammar-literal">&gt;</span></p>
<p><span class="grammar-text grammar-production" id="grammar-GenericArg" onclick="show_railroad()"><a href="#railroad-GenericArg">GenericArg</a></span> → <br>    <span class="grammar-text"><a href="#grammar-Lifetime">Lifetime</a></span> | <span class="grammar-text"><a href="#grammar-Type">Type</a></span> | <span class="grammar-text"><a href="#grammar-GenericArgsConst">GenericArgsConst</a></span> | <span class="grammar-text"><a href="#grammar-GenericArgsBinding">GenericArgsBinding</a></span> | <span class="grammar-text"><a href="#grammar-GenericArgsBounds">GenericArgsBounds</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-GenericArgsConst" onclick="show_railroad()"><a href="#railroad-GenericArgsConst">GenericArgsConst</a></span> → <br>      <span class="grammar-text"><a href="#grammar-BlockExpression">BlockExpression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-LiteralExpression">LiteralExpression</a></span> <br>    | <span class="grammar-literal">-</span> <span class="grammar-text"><a href="#grammar-LiteralExpression">LiteralExpression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-SimplePathSegment">SimplePathSegment</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-GenericArgsBinding" onclick="show_railroad()"><a href="#railroad-GenericArgsBinding">GenericArgsBinding</a></span> → <br>    <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-text"><a href="#grammar-GenericArgs">GenericArgs</a></span><sup>?</sup> <span class="grammar-literal">=</span> <span class="grammar-text"><a href="#grammar-Type">Type</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-GenericArgsBounds" onclick="show_railroad()"><a href="#railroad-GenericArgsBounds">GenericArgsBounds</a></span> → <br>    <span class="grammar-text"><a href="#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-text"><a href="#grammar-GenericArgs">GenericArgs</a></span><sup>?</sup> <span class="grammar-literal">:</span> <span class="grammar-text"><a href="#grammar-TypeParamBounds">TypeParamBounds</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 572px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-PathInExpression"><svg class="railroad" viewbox="0 0 572 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-PathInExpression">
<text class="comment" x="71" y="25">
PathInExpression</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 36 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="55" />
<text x="77" y="71">
::</text>
</g>
</g>
<a class="link" xlink:href="#railroad-PathExprSegment">
<g class="nonterminal">
<rect height="22" width="140" x="129" y="55" />
<text x="199" y="71">
PathExprSegment</text>
</g>
</a>
<g class="optional">
<path d=" M 279 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 210 m -102 0 l -5 -5 m 0 10 l 5 -5 m 102 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 303 66 h 12 m 186 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -186 m 96 0 l 5 -5 m 0 10 l -5 -5 m -96 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="315" y="55" />
<text x="333" y="71">
::</text>
</g>
<a class="link" xlink:href="#railroad-PathExprSegment">
<g class="nonterminal">
<rect height="22" width="140" x="361" y="55" />
<text x="431" y="71">
PathExprSegment</text>
</g>
</a>
<path d=" M 351 66 h 10" />
</g>
</g>
</g>
<path d=" M 119 66 h 10" />
<path d=" M 269 66 h 10" />
</g>
<path d=" M 547 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 537 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 430px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-PathExprSegment"><svg class="railroad" viewbox="0 0 430 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-PathExprSegment">
<text class="comment" x="67" y="25">
PathExprSegment</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-PathIdentSegment">
<g class="nonterminal">
<rect height="22" width="148" x="35" y="55" />
<text x="109" y="71">
PathIdentSegment</text>
</g>
</a>
<g class="optional">
<path d=" M 193 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 154 m -74 0 l -5 -5 m 0 10 l 5 -5 m 74 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="217" y="55" />
<text x="235" y="71">
::</text>
</g>
<a class="link" xlink:href="#railroad-GenericArgs">
<g class="nonterminal">
<rect height="22" width="108" x="263" y="55" />
<text x="317" y="71">
GenericArgs</text>
</g>
</a>
<path d=" M 253 66 h 10" />
</g>
</g>
<path d=" M 183 66 h 10" />
</g>
<path d=" M 405 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 395 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 218px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-PathIdentSegment"><svg class="railroad" viewbox="0 0 218 239" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-PathIdentSegment">
<text class="comment" x="71" y="25">
PathIdentSegment</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 100 0 h 24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="42" />
<text x="109" y="58">
IDENTIFIER</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 124 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 124 0 v -33" />
<path d=" M 47 107 v 33 m 124 0 v -33" />
<path d=" M 47 140 v 33 m 124 0 v -33" />
<path d=" M 47 173 v 33 m 124 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 60 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="59" y="75" />
<text x="89" y="91">
super</text>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 52 0 h 48 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="108" />
<text x="85" y="124">
self</text>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 52 0 h 48 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="141" />
<text x="85" y="157">
Self</text>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 60 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="59" y="174" />
<text x="89" y="190">
crate</text>
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 68 0 h 32 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="68" x="59" y="207" />
<text x="93" y="223">
$crate</text>
</g>
</g>
<path d=" M 193 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 183 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 600px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-GenericArgs"><svg class="railroad" viewbox="0 0 600 132" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-GenericArgs">
<text class="comment" x="53" y="25">
GenericArgs</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 66 0 h 440 m -217 0 l -5 -5 m 0 10 l 5 -5 m 217 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="42" />
<text x="73" y="58">
&lt;</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="97" y="42" />
<text x="111" y="58">
&gt;</text>
</g>
<path d=" M 87 53 h 10" />
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 506 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 12 a 12 12 0 0 0 12 12 m 482 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="87" />
<text x="73" y="103">
&lt;</text>
</g>
<g class="optional">
<path d=" M 97 98 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 162 m -78 0 l -5 -5 m 0 10 l 5 -5 m 78 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 121 98 h 12 m 138 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -138 m 72 0 l 5 -5 m 0 10 l -5 -5 m -72 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<a class="link" xlink:href="#railroad-GenericArg">
<g class="nonterminal">
<rect height="22" width="100" x="133" y="87" />
<text x="183" y="103">
GenericArg</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="243" y="87" />
<text x="257" y="103">
,</text>
</g>
<path d=" M 233 98 h 10" />
</g>
</g>
</g>
<a class="link" xlink:href="#railroad-GenericArg">
<g class="nonterminal">
<rect height="22" width="100" x="317" y="87" />
<text x="367" y="103">
GenericArg</text>
</g>
</a>
<g class="optional">
<path d=" M 427 98 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="451" y="87" />
<text x="465" y="103">
,</text>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="513" y="87" />
<text x="527" y="103">
&gt;</text>
</g>
<path d=" M 87 98 h 10" />
<path d=" M 307 98 h 10" />
<path d=" M 417 98 h 10" />
<path d=" M 503 98 h 10" />
</g>
</g>
<path d=" M 575 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 565 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 282px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-GenericArg"><svg class="railroad" viewbox="0 0 282 206" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-GenericArg">
<text class="comment" x="50" y="25">
GenericArg</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 84 0 h 104 m -49 0 l -5 -5 m 0 10 l 5 -5 m 49 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Lifetime">
<g class="nonterminal">
<rect height="22" width="84" x="59" y="42" />
<text x="101" y="58">
Lifetime</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 188 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 188 0 v -33" />
<path d=" M 47 107 v 33 m 188 0 v -33" />
<path d=" M 47 140 v 33 m 188 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 52 0 h 112 m -53 0 l -5 -5 m 0 10 l 5 -5 m 53 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="59" y="75" />
<text x="85" y="91">
Type</text>
</g>
</a>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 148 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-GenericArgsConst">
<g class="nonterminal">
<rect height="22" width="148" x="59" y="108" />
<text x="133" y="124">
GenericArgsConst</text>
</g>
</a>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 164 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-GenericArgsBinding">
<g class="nonterminal">
<rect height="22" width="164" x="59" y="141" />
<text x="141" y="157">
GenericArgsBinding</text>
</g>
</a>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 156 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-GenericArgsBounds">
<g class="nonterminal">
<rect height="22" width="156" x="59" y="174" />
<text x="137" y="190">
GenericArgsBounds</text>
</g>
</a>
</g>
<path d=" M 257 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 247 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 312px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-GenericArgsConst"><svg class="railroad" viewbox="0 0 312 173" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-GenericArgsConst">
<text class="comment" x="71" y="25">
GenericArgsConst</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 140 0 h 78 m -36 0 l -5 -5 m 0 10 l 5 -5 m 36 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-BlockExpression">
<g class="nonterminal">
<rect height="22" width="140" x="59" y="42" />
<text x="129" y="58">
BlockExpression</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 218 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 218 0 v -33" />
<path d=" M 47 107 v 33 m 218 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 156 0 h 38 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-LiteralExpression">
<g class="nonterminal">
<rect height="22" width="156" x="59" y="75" />
<text x="137" y="91">
LiteralExpression</text>
</g>
</a>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 194 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="108" />
<text x="73" y="124">
-</text>
</g>
<a class="link" xlink:href="#railroad-LiteralExpression">
<g class="nonterminal">
<rect height="22" width="156" x="97" y="108" />
<text x="175" y="124">
LiteralExpression</text>
</g>
</a>
<path d=" M 87 119 h 10" />
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 156 0 h 38 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-SimplePathSegment">
<g class="nonterminal">
<rect height="22" width="156" x="59" y="141" />
<text x="137" y="157">
SimplePathSegment</text>
</g>
</a>
</g>
<path d=" M 287 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 277 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 436px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-GenericArgsBinding"><svg class="railroad" viewbox="0 0 436 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-GenericArgsBinding">
<text class="comment" x="78" y="25">
GenericArgsBinding</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="55" />
<text x="85" y="71">
IDENTIFIER</text>
</g>
</a>
<g class="optional">
<path d=" M 145 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 108 m -51 0 l -5 -5 m 0 10 l 5 -5 m 51 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-GenericArgs">
<g class="nonterminal">
<rect height="22" width="108" x="169" y="55" />
<text x="223" y="71">
GenericArgs</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="311" y="55" />
<text x="325" y="71">
=</text>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="349" y="55" />
<text x="375" y="71">
Type</text>
</g>
</a>
<path d=" M 135 66 h 10" />
<path d=" M 301 66 h 10" />
<path d=" M 339 66 h 10" />
</g>
<path d=" M 411 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 401 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 524px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-GenericArgsBounds"><svg class="railroad" viewbox="0 0 524 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-GenericArgsBounds">
<text class="comment" x="74" y="25">
GenericArgsBounds</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="55" />
<text x="85" y="71">
IDENTIFIER</text>
</g>
</a>
<g class="optional">
<path d=" M 145 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 108 m -51 0 l -5 -5 m 0 10 l 5 -5 m 51 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-GenericArgs">
<g class="nonterminal">
<rect height="22" width="108" x="169" y="55" />
<text x="223" y="71">
GenericArgs</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="311" y="55" />
<text x="325" y="71">
:</text>
</g>
<a class="link" xlink:href="#railroad-TypeParamBounds">
<g class="nonterminal">
<rect height="22" width="140" x="349" y="55" />
<text x="419" y="71">
TypeParamBounds</text>
</g>
</a>
<path d=" M 135 66 h 10" />
<path d=" M 301 66 h 10" />
<path d=" M 339 66 h 10" />
</g>
<path d=" M 499 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 489 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-paths.expr.intro"><a class="rule-link" href="#r-paths.expr.intro" title="paths.expr.intro"><span>[paths<wbr>.expr<wbr>.intro]</span></a>
</div>

<p>表达式中的路径允许指定带有泛型参数的路径。它们被用于 <a href="#表达式">表达式</a> 和 <a href="#模式">模式</a> 的各个地方。</p>
<div class="rule" id="r-paths.expr.turbofish"><a class="rule-link" href="#r-paths.expr.turbofish" title="paths.expr.turbofish"><span>[paths<wbr>.expr<wbr>.turbofish]</span></a>
</div>

<p>在泛型参数的开口 <code>&lt;</code> 之前需要 <code>::</code> 词法单元，以避免与小于运算符产生歧义。这被通俗地称为 “turbofish” 语法格式。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>(0..10).collect::&lt;Vec&lt;_&gt;&gt;();
Vec::&lt;u8&gt;::with_capacity(1024);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-paths.expr.argument-order"><a class="rule-link" href="#r-paths.expr.argument-order" title="paths.expr.argument-order"><span>[paths<wbr>.expr<wbr>.argument-order]</span></a>
</div>

<p>泛型参数的顺序限制为生命周期参数，然后是类型参数，接着是常量参数，最后是等值约束。</p>
<div class="rule" id="r-paths.expr.complex-const-params"><a class="rule-link" href="#r-paths.expr.complex-const-params" title="paths.expr.complex-const-params"><span>[paths<wbr>.expr<wbr>.complex-const-params]</span></a>
</div>

<p>常量参数必须用大括号括起来，除非它们是 <a href="#字面量表达式">字面量</a>、 <a href="#r-items.generics.const.inferred">推断常量</a> 或单段路径。 <a href="#r-items.generics.const.inferred">推断常量</a> 不得用大括号括起来。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>mod m {
    pub const C: usize = 1;
}
const C: usize = m::C;
fn f&lt;const N: usize&gt;() -&gt; [u8; N] { [0; N] }

let _ = f::&lt;1&gt;(); // 字面量。
let _: [_; 1] = f::&lt;_&gt;(); // 推断常量。
let _: [_; 1] = f::&lt;(((_)))&gt;(); // 推断常量。
let _ = f::&lt;C&gt;(); // 单段路径。
let _ = f::&lt;{ m::C }&gt;(); // 多段路径必须用大括号包围。
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn f&lt;const N: usize&gt;() -&gt; [u8; N] { [0; _] }
let _: [_; 1] = f::&lt;{ _ }&gt;();
//                    ^ ERROR `_` not allowed here
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>在泛型参数列表中， <a href="#r-items.generics.const.inferred">推断常量</a> 被解析为 <a href="#grammar-InferredType">推断类型</a>，但在语义上被视为一种单独的 <a href="#r-items.generics.const.argument">常量泛型参数</a>。</p>
</blockquote>
</div>

<div class="rule" id="r-paths.expr.impl-trait-params"><a class="rule-link" href="#r-paths.expr.impl-trait-params" title="paths.expr.impl-trait-params"><span>[paths<wbr>.expr<wbr>.impl-trait-params]</span></a>
</div>

<p>对应于 <code>impl Trait</code> 类型的合成类型参数是隐式的，不能显式指定。</p>
<div class="rule" id="r-paths.qualified"><a class="rule-link" href="#r-paths.qualified" title="paths.qualified"><span>[paths<wbr>.qualified]</span></a>
</div>

<h2 id="限定路径"><a class="header" href="#限定路径">限定路径</a></h2>
<div class="rule" id="r-paths.qualified.syntax"><a class="rule-link" href="#r-paths.qualified.syntax" title="paths.qualified.syntax"><span>[paths<wbr>.qualified<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-QualifiedPathInExpression" onclick="show_railroad()"><a href="#railroad-QualifiedPathInExpression">QualifiedPathInExpression</a></span> → <span class="grammar-text"><a href="#grammar-QualifiedPathType">QualifiedPathType</a></span> ( <span class="grammar-literal">::</span> <span class="grammar-text"><a href="#grammar-PathExprSegment">PathExprSegment</a></span> )<sup>+</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-QualifiedPathType" onclick="show_railroad()"><a href="#railroad-QualifiedPathType">QualifiedPathType</a></span> → <span class="grammar-literal">&lt;</span> <span class="grammar-text"><a href="#grammar-Type">Type</a></span> ( <span class="grammar-literal">as</span> <span class="grammar-text"><a href="#grammar-TypePath">TypePath</a></span> )<sup>?</sup> <span class="grammar-literal">&gt;</span></p>
<p><span class="grammar-text grammar-production" id="grammar-QualifiedPathInType" onclick="show_railroad()"><a href="#railroad-QualifiedPathInType">QualifiedPathInType</a></span> → <span class="grammar-text"><a href="#grammar-QualifiedPathType">QualifiedPathType</a></span> ( <span class="grammar-literal">::</span> <span class="grammar-text"><a href="#grammar-TypePathSegment">TypePathSegment</a></span> )<sup>+</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 446px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-QualifiedPathInExpression"><svg class="railroad" viewbox="0 0 446 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-QualifiedPathInExpression">
<text class="comment" x="106" y="25">
QualifiedPathInExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-QualifiedPathType">
<g class="nonterminal">
<rect height="22" width="156" x="35" y="42" />
<text x="113" y="58">
QualifiedPathType</text>
</g>
</a>
<g class="repeat">
<path d=" M 201 53 h 12 m 186 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -186 m 96 0 l 5 -5 m 0 10 l -5 -5 m -96 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="213" y="42" />
<text x="231" y="58">
::</text>
</g>
<a class="link" xlink:href="#railroad-PathExprSegment">
<g class="nonterminal">
<rect height="22" width="140" x="259" y="42" />
<text x="329" y="58">
PathExprSegment</text>
</g>
</a>
<path d=" M 249 53 h 10" />
</g>
</g>
<path d=" M 191 53 h 10" />
</g>
<path d=" M 421 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 411 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 386px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-QualifiedPathType"><svg class="railroad" viewbox="0 0 386 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-QualifiedPathType">
<text class="comment" x="74" y="25">
QualifiedPathType</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="55" />
<text x="49" y="71">
&lt;</text>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="73" y="55" />
<text x="99" y="71">
Type</text>
</g>
</a>
<g class="optional">
<path d=" M 135 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 130 m -62 0 l -5 -5 m 0 10 l 5 -5 m 62 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="159" y="55" />
<text x="177" y="71">
as</text>
</g>
<a class="link" xlink:href="#railroad-TypePath">
<g class="nonterminal">
<rect height="22" width="84" x="205" y="55" />
<text x="247" y="71">
TypePath</text>
</g>
</a>
<path d=" M 195 66 h 10" />
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="323" y="55" />
<text x="337" y="71">
&gt;</text>
</g>
<path d=" M 63 66 h 10" />
<path d=" M 125 66 h 10" />
<path d=" M 313 66 h 10" />
</g>
<path d=" M 361 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 351 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 446px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-QualifiedPathInType"><svg class="railroad" viewbox="0 0 446 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-QualifiedPathInType">
<text class="comment" x="81" y="25">
QualifiedPathInType</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-QualifiedPathType">
<g class="nonterminal">
<rect height="22" width="156" x="35" y="42" />
<text x="113" y="58">
QualifiedPathType</text>
</g>
</a>
<g class="repeat">
<path d=" M 201 53 h 12 m 186 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -186 m 96 0 l 5 -5 m 0 10 l -5 -5 m -96 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="213" y="42" />
<text x="231" y="58">
::</text>
</g>
<a class="link" xlink:href="#railroad-TypePathSegment">
<g class="nonterminal">
<rect height="22" width="140" x="259" y="42" />
<text x="329" y="58">
TypePathSegment</text>
</g>
</a>
<path d=" M 249 53 h 10" />
</g>
</g>
<path d=" M 191 53 h 10" />
</g>
<path d=" M 421 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 411 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-paths.qualified.intro"><a class="rule-link" href="#r-paths.qualified.intro" title="paths.qualified.intro"><span>[paths<wbr>.qualified<wbr>.intro]</span></a>
</div>

<p>全限定路径允许消除 <a href="#trait-implementations">特型实现</a> 的路径歧义，并用于指定 <a href="#canonical-paths">规范路径</a>。当用于类型规范时，它支持使用下面指定的类型语法格式。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct S;
impl S {
    fn f() { println!("S"); }
}
trait T1 {
    fn f() { println!("T1 f"); }
}
impl T1 for S {}
trait T2 {
    fn f() { println!("T2 f"); }
}
impl T2 for S {}
S::f();  // 调用固有实现。
&lt;S as T1&gt;::f();  // 调用 T1 特型函数。
&lt;S as T2&gt;::f();  // 调用 T2 特型函数。
<span class="boring">}</span></code></pre>
<div class="rule" id="r-paths.type"><a class="rule-link" href="#r-paths.type" title="paths.type"><span>[paths<wbr>.type]</span></a>
</div>

<h3 id="类型中的路径"><a class="header" href="#类型中的路径">类型中的路径</a></h3>
<div class="rule" id="r-paths.type.syntax"><a class="rule-link" href="#r-paths.type.syntax" title="paths.type.syntax"><span>[paths<wbr>.type<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-TypePath" onclick="show_railroad()"><a href="#railroad-TypePath">TypePath</a></span> → <span class="grammar-literal">::</span><sup>?</sup> <span class="grammar-text"><a href="#grammar-TypePathSegment">TypePathSegment</a></span> ( <span class="grammar-literal">::</span> <span class="grammar-text"><a href="#grammar-TypePathSegment">TypePathSegment</a></span> )<sup>*</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-TypePathSegment" onclick="show_railroad()"><a href="#railroad-TypePathSegment">TypePathSegment</a></span> → <span class="grammar-text"><a href="#grammar-PathIdentSegment">PathIdentSegment</a></span> ( <span class="grammar-literal">::</span><sup>?</sup> ( <span class="grammar-text"><a href="#grammar-GenericArgs">GenericArgs</a></span> | <span class="grammar-text"><a href="#grammar-TypePathFn">TypePathFn</a></span> ) )<sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-TypePathFn" onclick="show_railroad()"><a href="#railroad-TypePathFn">TypePathFn</a></span> → <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-TypePathFnInputs">TypePathFnInputs</a></span><sup>?</sup> <span class="grammar-literal">)</span> ( <span class="grammar-literal">-&gt;</span> <span class="grammar-text"><a href="#grammar-TypeNoBounds">TypeNoBounds</a></span> )<sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-TypePathFnInputs" onclick="show_railroad()"><a href="#railroad-TypePathFnInputs">TypePathFnInputs</a></span> → <span class="grammar-text"><a href="#grammar-Type">Type</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-Type">Type</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 572px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TypePath"><svg class="railroad" viewbox="0 0 572 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TypePath">
<text class="comment" x="43" y="25">
TypePath</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 36 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="55" />
<text x="77" y="71">
::</text>
</g>
</g>
<a class="link" xlink:href="#railroad-TypePathSegment">
<g class="nonterminal">
<rect height="22" width="140" x="129" y="55" />
<text x="199" y="71">
TypePathSegment</text>
</g>
</a>
<g class="optional">
<path d=" M 279 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 210 m -102 0 l -5 -5 m 0 10 l 5 -5 m 102 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 303 66 h 12 m 186 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -186 m 96 0 l 5 -5 m 0 10 l -5 -5 m -96 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="315" y="55" />
<text x="333" y="71">
::</text>
</g>
<a class="link" xlink:href="#railroad-TypePathSegment">
<g class="nonterminal">
<rect height="22" width="140" x="361" y="55" />
<text x="431" y="71">
TypePathSegment</text>
</g>
</a>
<path d=" M 351 66 h 10" />
</g>
</g>
</g>
<path d=" M 119 66 h 10" />
<path d=" M 269 66 h 10" />
</g>
<path d=" M 547 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 537 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 526px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TypePathSegment"><svg class="railroad" viewbox="0 0 526 132" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TypePathSegment">
<text class="comment" x="67" y="25">
TypePathSegment</text>
</a>
<g class="sequence">
<path d=" M 10 78 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-PathIdentSegment">
<g class="nonterminal">
<rect height="22" width="148" x="35" y="67" />
<text x="109" y="83">
PathIdentSegment</text>
</g>
</a>
<g class="optional">
<path d=" M 193 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -12 a 12 12 0 0 1 12 -12 h 250 m -122 0 l -5 -5 m 0 10 l 5 -5 m 122 0 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="optional">
<path d=" M 217 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 36 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="241" y="67" />
<text x="259" y="83">
::</text>
</g>
</g>
<g class="choice">
<path d=" M 311 78 h 24 m 108 0 h 24" />
<a class="link" xlink:href="#railroad-GenericArgs">
<g class="nonterminal">
<rect height="22" width="108" x="335" y="67" />
<text x="389" y="83">
GenericArgs</text>
</g>
</a>
<path d=" M 311 78 a 12 12 0 0 1 12 12 v 9 m 132 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 323 99 v 0 a 12 12 0 0 0 12 12 m 100 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-TypePathFn">
<g class="nonterminal">
<rect height="22" width="100" x="335" y="100" />
<text x="385" y="116">
TypePathFn</text>
</g>
</a>
</g>
<path d=" M 301 78 h 10" />
</g>
</g>
<path d=" M 183 78 h 10" />
</g>
<path d=" M 501 78 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 78 h 10" />
<path d=" M 491 78 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 562px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TypePathFn"><svg class="railroad" viewbox="0 0 562 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TypePathFn">
<text class="comment" x="50" y="25">
TypePathFn</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="35" y="55" />
<text x="49" y="71">
(</text>
</g>
<g class="optional">
<path d=" M 73 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 148 m -71 0 l -5 -5 m 0 10 l 5 -5 m 71 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-TypePathFnInputs">
<g class="nonterminal">
<rect height="22" width="148" x="97" y="55" />
<text x="171" y="71">
TypePathFnInputs</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="279" y="55" />
<text x="293" y="71">
)</text>
</g>
<g class="optional">
<path d=" M 317 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 162 m -78 0 l -5 -5 m 0 10 l 5 -5 m 78 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="341" y="55" />
<text x="359" y="71">
-&gt;</text>
</g>
<a class="link" xlink:href="#railroad-TypeNoBounds">
<g class="nonterminal">
<rect height="22" width="116" x="387" y="55" />
<text x="445" y="71">
TypeNoBounds</text>
</g>
</a>
<path d=" M 377 66 h 10" />
</g>
</g>
<path d=" M 63 66 h 10" />
<path d=" M 269 66 h 10" />
<path d=" M 307 66 h 10" />
</g>
<path d=" M 537 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 527 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 380px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TypePathFnInputs"><svg class="railroad" viewbox="0 0 380 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-TypePathFnInputs">
<text class="comment" x="71" y="25">
TypePathFnInputs</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="35" y="55" />
<text x="61" y="71">
Type</text>
</g>
</a>
<g class="optional">
<path d=" M 97 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 114 m -54 0 l -5 -5 m 0 10 l 5 -5 m 54 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 121 66 h 12 m 90 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -90 m 48 0 l 5 -5 m 0 10 l -5 -5 m -48 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="133" y="55" />
<text x="147" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-Type">
<g class="nonterminal">
<rect height="22" width="52" x="171" y="55" />
<text x="197" y="71">
Type</text>
</g>
</a>
<path d=" M 161 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 269 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="293" y="55" />
<text x="307" y="71">
,</text>
</g>
</g>
<path d=" M 87 66 h 10" />
<path d=" M 259 66 h 10" />
</g>
<path d=" M 355 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 345 66 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-paths.type.intro"><a class="rule-link" href="#r-paths.type.intro" title="paths.type.intro"><span>[paths<wbr>.type<wbr>.intro]</span></a>
</div>

<p>类型路径用于类型定义、特型界限、类型参数界限和限定路径中。</p>
<div class="rule" id="r-paths.type.turbofish"><a class="rule-link" href="#r-paths.type.turbofish" title="paths.type.turbofish"><span>[paths<wbr>.type<wbr>.turbofish]</span></a>
</div>

<p>虽然在泛型参数之前允许使用 <code>::</code> 词法单元，但它不是必需的，因为不像在 <a href="#grammar-PathInExpression">PathInExpression</a> 中那样存在歧义。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">mod ops {
</span><span class="boring">    pub struct Range&lt;T&gt; {f1: T}
</span><span class="boring">    pub trait Index&lt;T&gt; {}
</span><span class="boring">    pub struct Example&lt;'a&gt; {f1: &amp;'a i32}
</span><span class="boring">}
</span><span class="boring">struct S;
</span>impl ops::Index&lt;ops::Range&lt;usize&gt;&gt; for S { /*...*/ }
fn i&lt;'a&gt;() -&gt; impl Iterator&lt;Item = ops::Example&lt;'a&gt;&gt; {
    // ...
<span class="boring">   const EXAMPLE: Vec&lt;ops::Example&lt;'static&gt;&gt; = Vec::new();
</span><span class="boring">   EXAMPLE.into_iter()
</span>}
type G = std::boxed::Box&lt;dyn std::ops::FnOnce(isize) -&gt; isize&gt;;
<span class="boring">}</span></code></pre>
<div class="rule" id="r-paths.qualifiers"><a class="rule-link" href="#r-paths.qualifiers" title="paths.qualifiers"><span>[paths<wbr>.qualifiers]</span></a>
</div>

<h2 id="路径限定符"><a class="header" href="#路径限定符">路径限定符</a></h2>
<p>路径可以用各种前导限定符来表示，以改变其解析方式的含义。</p>
<div class="rule" id="r-paths.qualifiers.global-root"><a class="rule-link" href="#r-paths.qualifiers.global-root" title="paths.qualifiers.global-root"><span>[paths<wbr>.qualifiers<wbr>.global-root]</span></a>
</div>

<h3 id=""><a class="header" href="#"><code>::</code></a></h3>
<div class="rule" id="r-paths.qualifiers.global-root.intro"><a class="rule-link" href="#r-paths.qualifiers.global-root.intro" title="paths.qualifiers.global-root.intro"><span>[paths<wbr>.qualifiers<wbr>.global-root<wbr>.intro]</span></a>
</div>

<p>以 <code>::</code> 开头的路径被认为是 <em>全局路径</em>，其路径段的解析起始位置因版次而异。路径中的每个标识符必须解析为一个项。</p>
<div class="rule" id="r-paths.qualifiers.global-root.edition2018"><a class="rule-link" href="#r-paths.qualifiers.global-root.edition2018" title="paths.qualifiers.global-root.edition2018"><span>[paths<wbr>.qualifiers<wbr>.global-root<wbr>.edition2018]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p>在 2015 版次中，标识符从 “crate 根”（2018 版次中的 <code>crate::</code>）开始解析，它包含各种不同的项，包括外部 crate、默认 crate（如 <code>std</code> 或 <code>core</code>）以及 crate 顶层的项（包括 <code>use</code> 导入）。</p>
<p>从 2018 版次开始，以 <code>::</code> 开头的路径从 <a href="#extern-prelude">外部预导入</a> 中的 crate 开始解析。也就是说，它们后面必须紧跟一个 crate 的名称。</p>
</blockquote>
</div>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub fn foo() {
    // 在 2018 版次中，这通过外部预导入访问 `std`。
    // 在 2015 版次中，这通过 crate 根访问 `std`。
    let now = ::std::time::Instant::now();
    println!("{:?}", now);
}
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2015">// 2015 版次
mod a {
    pub fn foo() {}
}
mod b {
    pub fn foo() {
        ::a::foo(); // 调用 a 的 foo 函数
        // 在 Rust 2018 中，`::a` 将被解释为 crate `a`。
    }
}
<span class="boring">fn main() {}</span></code></pre>
<div class="rule" id="r-paths.qualifiers.mod-self"><a class="rule-link" href="#r-paths.qualifiers.mod-self" title="paths.qualifiers.mod-self"><span>[paths<wbr>.qualifiers<wbr>.mod-self]</span></a>
</div>

<h3 id="self"><a class="header" href="#self"><code>self</code></a></h3>
<div class="rule" id="r-paths.qualifiers.mod-self.intro"><a class="rule-link" href="#r-paths.qualifiers.mod-self.intro" title="paths.qualifiers.mod-self.intro"><span>[paths<wbr>.qualifiers<wbr>.mod-self<wbr>.intro]</span></a>
</div>

<p><code>self</code> 相对于当前模块解析路径。</p>
<div class="rule" id="r-paths.qualifiers.mod-self.restriction"><a class="rule-link" href="#r-paths.qualifiers.mod-self.restriction" title="paths.qualifiers.mod-self.restriction"><span>[paths<wbr>.qualifiers<wbr>.mod-self<wbr>.restriction]</span></a>
</div>

<p><code>self</code> 只能用作第一段，且前面不能有 <code>::</code>。</p>
<div class="rule" id="r-paths.qualifiers.self-pat"><a class="rule-link" href="#r-paths.qualifiers.self-pat" title="paths.qualifiers.self-pat"><span>[paths<wbr>.qualifiers<wbr>.self-pat]</span></a>
</div>

<p>在方法体中，仅由单个 <code>self</code> 段组成的路径解析为该方法的 self 参数。</p>
<pre class="playground"><code class="language-rust edition2024">fn foo() {}
fn bar() {
    self::foo();
}
struct S(bool);
impl S {
  fn baz(self) {
        self.0;
    }
}
<span class="boring">fn main() {}</span></code></pre>
<div class="rule" id="r-paths.qualifiers.type-self"><a class="rule-link" href="#r-paths.qualifiers.type-self" title="paths.qualifiers.type-self"><span>[paths<wbr>.qualifiers<wbr>.type-self]</span></a>
</div>

<h3 id="self-1"><a class="header" href="#self-1"><code>Self</code></a></h3>
<div class="rule" id="r-paths.qualifiers.type-self.intro"><a class="rule-link" href="#r-paths.qualifiers.type-self.intro" title="paths.qualifiers.type-self.intro"><span>[paths<wbr>.qualifiers<wbr>.type-self<wbr>.intro]</span></a>
</div>

<p>首字母大写的 <code>Self</code> 用于引用当前正在实现或定义的类型。它可以用于以下情况：</p>
<div class="rule" id="r-paths.qualifiers.type-self.trait"><a class="rule-link" href="#r-paths.qualifiers.type-self.trait" title="paths.qualifiers.type-self.trait"><span>[paths<wbr>.qualifiers<wbr>.type-self<wbr>.trait]</span></a>
</div>

<ul>
<li>在 <a href="#特型">特型</a> 定义中，它引用实现该特型的类型。</li>
</ul>
<div class="rule" id="r-paths.qualifiers.type-self.impl"><a class="rule-link" href="#r-paths.qualifiers.type-self.impl" title="paths.qualifiers.type-self.impl"><span>[paths<wbr>.qualifiers<wbr>.type-self<wbr>.impl]</span></a>
</div>

<ul>
<li>在 <a href="#实现">实现</a> 中，它引用正在被实现的类型。
在实现元组或单元 <a href="#结构体">结构体</a> 时，它还在 <a href="#命名空间">值命名空间</a> 中引用构造函数。</li>
</ul>
<div class="rule" id="r-paths.qualifiers.type-self.type"><a class="rule-link" href="#r-paths.qualifiers.type-self.type" title="paths.qualifiers.type-self.type"><span>[paths<wbr>.qualifiers<wbr>.type-self<wbr>.type]</span></a>
</div>

<ul>
<li>在 <a href="#结构体">结构体</a>、 <a href="#枚举">枚举</a> 或 <a href="#联合体">联合体</a> 的定义中，它引用正在被定义的类型。
定义不允许无限递归（必须有间接寻址）。</li>
</ul>
<div class="rule" id="r-paths.qualifiers.type-self.scope"><a class="rule-link" href="#r-paths.qualifiers.type-self.scope" title="paths.qualifiers.type-self.scope"><span>[paths<wbr>.qualifiers<wbr>.type-self<wbr>.scope]</span></a>
</div>

<p><code>Self</code> 的作用域行为类似于泛型参数；有关更多详细信息，请参阅 <a href="#self-scope"><code>Self</code> 作用域</a> 部分。</p>
<div class="rule" id="r-paths.qualifiers.type-self.allowed-positions"><a class="rule-link" href="#r-paths.qualifiers.type-self.allowed-positions" title="paths.qualifiers.type-self.allowed-positions"><span>[paths<wbr>.qualifiers<wbr>.type-self<wbr>.allowed-positions]</span></a>
</div>

<p><code>Self</code> 只能用作第一段，且前面不能有 <code>::</code>。</p>
<div class="rule" id="r-paths.qualifiers.type-self.no-generics"><a class="rule-link" href="#r-paths.qualifiers.type-self.no-generics" title="paths.qualifiers.type-self.no-generics"><span>[paths<wbr>.qualifiers<wbr>.type-self<wbr>.no-generics]</span></a>
</div>

<p><code>Self</code> 路径不能包含泛型参数（如 <code>Self::&lt;i32&gt;</code>）。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait T {
    type Item;
    const C: i32;
    // `Self` 将是实现 `T` 的任何类型。
    fn new() -&gt; Self;
    // `Self::Item` 将是实现中的类型别名。
    fn f(&amp;self) -&gt; Self::Item;
}
struct S;
impl T for S {
    type Item = i32;
    const C: i32 = 9;
    fn new() -&gt; Self {           // `Self` 是类型 `S`。
        S
    }
    fn f(&amp;self) -&gt; Self::Item {  // `Self::Item` 是类型 `i32`。
        Self::C                  // `Self::C` 是常量值 `9`。
    }
}

// `Self` 在特型定义的泛型作用域内，
// 用以引用正在定义的类型。
trait Add&lt;Rhs = Self&gt; {
    type Output;
    // `Self` 也可以引用
    // 正在实现的类型的关联项。
    fn add(self, rhs: Rhs) -&gt; Self::Output;
}

struct NonEmptyList&lt;T&gt; {
    head: T,
    // 结构体可以引用自身（只要它不是
    // 无限递归的）。
    tail: Option&lt;Box&lt;Self&gt;&gt;,
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-paths.qualifiers.super"><a class="rule-link" href="#r-paths.qualifiers.super" title="paths.qualifiers.super"><span>[paths<wbr>.qualifiers<wbr>.super]</span></a>
</div>

<h3 id="super"><a class="header" href="#super"><code>super</code></a></h3>
<div class="rule" id="r-paths.qualifiers.super.intro"><a class="rule-link" href="#r-paths.qualifiers.super.intro" title="paths.qualifiers.super.intro"><span>[paths<wbr>.qualifiers<wbr>.super<wbr>.intro]</span></a>
</div>

<p>路径中的 <code>super</code> 解析为父模块。</p>
<div class="rule" id="r-paths.qualifiers.super.allowed-positions"><a class="rule-link" href="#r-paths.qualifiers.super.allowed-positions" title="paths.qualifiers.super.allowed-positions"><span>[paths<wbr>.qualifiers<wbr>.super<wbr>.allowed-positions]</span></a>
</div>

<p>它只能用于路径的前导段，可能在初始的 <code>self</code> 段之后。</p>
<pre class="playground"><code class="language-rust edition2024">mod a {
    pub fn foo() {}
}
mod b {
    pub fn foo() {
        super::a::foo(); // 调用 a 的 foo 函数
    }
}
<span class="boring">fn main() {}</span></code></pre>
<div class="rule" id="r-paths.qualifiers.super.repetition"><a class="rule-link" href="#r-paths.qualifiers.super.repetition" title="paths.qualifiers.super.repetition"><span>[paths<wbr>.qualifiers<wbr>.super<wbr>.repetition]</span></a>
</div>

<p><code>super</code> 可以在第一个 <code>super</code> 或 <code>self</code> 之后重复多次，以引用祖先模块。</p>
<pre class="playground"><code class="language-rust edition2024">mod a {
    fn foo() {}

    mod b {
        mod c {
            fn foo() {
                super::super::foo(); // 调用 a 的 foo 函数
                self::super::super::foo(); // 调用 a 的 foo 函数
            }
        }
    }
}
<span class="boring">fn main() {}</span></code></pre>
<div class="rule" id="r-paths.qualifiers.crate"><a class="rule-link" href="#r-paths.qualifiers.crate" title="paths.qualifiers.crate"><span>[paths<wbr>.qualifiers<wbr>.crate]</span></a>
</div>

<h3 id="crate"><a class="header" href="#crate"><code>crate</code></a></h3>
<div class="rule" id="r-paths.qualifiers.crate.intro"><a class="rule-link" href="#r-paths.qualifiers.crate.intro" title="paths.qualifiers.crate.intro"><span>[paths<wbr>.qualifiers<wbr>.crate<wbr>.intro]</span></a>
</div>

<p><code>crate</code> 相对于当前 crate 解析路径。</p>
<div class="rule" id="r-paths.qualifiers.crate.allowed-positions"><a class="rule-link" href="#r-paths.qualifiers.crate.allowed-positions" title="paths.qualifiers.crate.allowed-positions"><span>[paths<wbr>.qualifiers<wbr>.crate<wbr>.allowed-positions]</span></a>
</div>

<p><code>crate</code> 只能用作第一段，且前面不能有 <code>::</code>。</p>
<pre class="playground"><code class="language-rust edition2024">fn foo() {}
mod a {
    fn bar() {
        crate::foo();
    }
}
<span class="boring">fn main() {}</span></code></pre>
<div class="rule" id="r-paths.qualifiers.macro-crate"><a class="rule-link" href="#r-paths.qualifiers.macro-crate" title="paths.qualifiers.macro-crate"><span>[paths<wbr>.qualifiers<wbr>.macro-crate]</span></a>
</div>

<h3 id="crate-1"><a class="header" href="#crate-1"><code>$crate</code></a></h3>
<div class="rule" id="r-paths.qualifiers.macro-crate.allowed-positions"><a class="rule-link" href="#r-paths.qualifiers.macro-crate.allowed-positions" title="paths.qualifiers.macro-crate.allowed-positions"><span>[paths<wbr>.qualifiers<wbr>.macro-crate<wbr>.allowed-positions]</span></a>
</div>

<p><a href="#r-macro.decl.hygiene.crate"><code>$crate</code></a> 仅在 <a href="#声明宏">宏转录器</a> 中使用，并且只能用作第一段，且前面不能有 <code>::</code>。</p>
<div class="rule" id="r-paths.qualifiers.macro-crate.hygiene"><a class="rule-link" href="#r-paths.qualifiers.macro-crate.hygiene" title="paths.qualifiers.macro-crate.hygiene"><span>[paths<wbr>.qualifiers<wbr>.macro-crate<wbr>.hygiene]</span></a>
</div>

<p><a href="#r-macro.decl.hygiene.crate"><code>$crate</code></a> 将展开为访问宏定义所在 crate 顶层项的路径，无论宏在哪个 crate 中被调用。</p>
<pre class="playground"><code class="language-rust edition2024">pub fn increment(x: u32) -&gt; u32 {
    x + 1
}

#[macro_export]
macro_rules! inc {
    ($x:expr) =&gt; ( $crate::increment($x) )
}
<span class="boring">fn main() { }</span></code></pre>
<div class="rule" id="r-paths.canonical"><a class="rule-link" href="#r-paths.canonical" title="paths.canonical"><span>[paths<wbr>.canonical]</span></a>
</div>

<h2 id="规范路径"><a class="header" href="#规范路径">规范路径</a></h2>
<div class="rule" id="r-paths.canonical.intro"><a class="rule-link" href="#r-paths.canonical.intro" title="paths.canonical.intro"><span>[paths<wbr>.canonical<wbr>.intro]</span></a>
</div>

<p>在模块或实现中定义的项具有一个 <em>规范路径</em>，该路径对应于它在其 crate 中定义的位置。</p>
<div class="rule" id="r-paths.canonical.alias"><a class="rule-link" href="#r-paths.canonical.alias" title="paths.canonical.alias"><span>[paths<wbr>.canonical<wbr>.alias]</span></a>
</div>

<p>指向这些项的所有其他路径都是别名。</p>
<div class="rule" id="r-paths.canonical.def"><a class="rule-link" href="#r-paths.canonical.def" title="paths.canonical.def"><span>[paths<wbr>.canonical<wbr>.def]</span></a>
</div>

<p>规范路径被定义为一个 <em>路径前缀</em> 加上项本身定义的路径段。</p>
<div class="rule" id="r-paths.canonical.non-canonical"><a class="rule-link" href="#r-paths.canonical.non-canonical" title="paths.canonical.non-canonical"><span>[paths<wbr>.canonical<wbr>.non-canonical]</span></a>
</div>

<p><a href="#实现">实现</a> 和 <a href="#use声明">使用声明</a> 没有规范路径，尽管实现定义的项确实有规范路径。在块表达式中定义的项没有规范路径。在没有规范路径的模块中定义的项没有规范路径。在引用了没有规范路径的项（例如作为实现类型、正在实现的特型、类型参数或类型参数界限）的实现中定义的关联项，没有规范路径。</p>
<div class="rule" id="r-paths.canonical.module-prefix"><a class="rule-link" href="#r-paths.canonical.module-prefix" title="paths.canonical.module-prefix"><span>[paths<wbr>.canonical<wbr>.module-prefix]</span></a>
</div>

<p>模块的路径前缀是该模块的规范路径。</p>
<div class="rule" id="r-paths.canonical.bare-impl-prefix"><a class="rule-link" href="#r-paths.canonical.bare-impl-prefix" title="paths.canonical.bare-impl-prefix"><span>[paths<wbr>.canonical<wbr>.bare-impl-prefix]</span></a>
</div>

<p>对于固有实现，它是正在实现的项的规范路径，并用 <span class="parenthetical">尖括号 (<code>&lt;&gt;</code>)</span> 包围。</p>
<div class="rule" id="r-paths.canonical.trait-impl-prefix"><a class="rule-link" href="#r-paths.canonical.trait-impl-prefix" title="paths.canonical.trait-impl-prefix"><span>[paths<wbr>.canonical<wbr>.trait-impl-prefix]</span></a>
</div>

<p>对于 <a href="#trait-implementations">特型实现</a>，它是正在实现的项的规范路径，后跟 <code>as</code>，再后跟该特型的规范路径，全部用 <span class="parenthetical">尖括号 (<code>&lt;&gt;</code>)</span> 包围。</p>
<div class="rule" id="r-paths.canonical.local-canonical-path"><a class="rule-link" href="#r-paths.canonical.local-canonical-path" title="paths.canonical.local-canonical-path"><span>[paths<wbr>.canonical<wbr>.local-canonical-path]</span></a>
</div>

<p>规范路径仅在给定的 crate 内有意义。不存在跨 crate 的全局命名空间；项的规范路径仅在其 crate 内标识它。</p>
<pre class="playground"><code class="language-rust edition2024">// 注释显示了项的规范路径。

mod a { // crate::a
    pub struct Struct; // crate::a::Struct

    pub trait Trait { // crate::a::Trait
        fn f(&amp;self); // crate::a::Trait::f
    }

    impl Trait for Struct {
        fn f(&amp;self) {} // &lt;crate::a::Struct as crate::a::Trait&gt;::f
    }

    impl Struct {
        fn g(&amp;self) {} // &lt;crate::a::Struct&gt;::g
    }
}

mod without { // crate::without
    fn canonicals() { // crate::without::canonicals
        struct OtherStruct; // 无

        trait OtherTrait { // 无
            fn g(&amp;self); // 无
        }

        impl OtherTrait for OtherStruct {
            fn g(&amp;self) {} // 无
        }

        impl OtherTrait for crate::a::Struct {
            fn g(&amp;self) {} // 无
        }

        impl crate::a::Trait for OtherStruct {
            fn f(&amp;self) {} // 无
        }
    }
}

<span class="boring">fn main() {}</span></code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-names.resolution"><a class="rule-link" href="#r-names.resolution" title="names.resolution"><span>[names<wbr>.resolution]</span></a>
</div>

<h1 id="名称解析"><a class="header" href="#名称解析">名称解析</a></h1>
<div class="rule" id="r-names.resolution.intro"><a class="rule-link" href="#r-names.resolution.intro" title="names.resolution.intro"><span>[names<wbr>.resolution<wbr>.intro]</span></a>
</div>

<p><em>名称解析</em> 是将路径和其他标识符绑定到这些实体的声明的过程。名称被分隔到不同的 <a href="#命名空间">命名空间</a> 中，允许不同命名空间中的实体在没有冲突的情况下共享相同的名称。每个名称在 <a href="#作用域">作用域</a>（即可以引用该名称的源代码区域）内有效。对名称的访问可能会根据其 <a href="#可见性和私有性">可见性</a> 受到限制。</p>
<p>在整个编译过程中，名称解析分为三个阶段。第一个阶段， * 展开时解析 *，解析所有的 <a href="#use声明"><code>use</code> 声明</a> 和 <a href="#宏调用">宏调用</a>。第二个阶段， * 初级解析 *，解析所有尚未解析且不依赖于类型信息来解析的名称。最后一个阶段， * 类型相关解析 *，一旦类型信息可用，就解析剩余的名称。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>展开时解析 也被称为 * 早期解析 *。 初级解析 也被称为 * 晚期解析 *。</p>
</blockquote>
</div>

<div class="rule" id="r-names.resolution.general"><a class="rule-link" href="#r-names.resolution.general" title="names.resolution.general"><span>[names<wbr>.resolution<wbr>.general]</span></a>
</div>

<h2 id="通用"><a class="header" href="#通用">通用</a></h2>
<div class="rule" id="r-names.resolution.general.intro"><a class="rule-link" href="#r-names.resolution.general.intro" title="names.resolution.general.intro"><span>[names<wbr>.resolution<wbr>.general<wbr>.intro]</span></a>
</div>

<p>本节中的规则适用于名称解析的所有阶段。</p>
<div class="rule" id="r-names.resolution.general.scopes"><a class="rule-link" href="#r-names.resolution.general.scopes" title="names.resolution.general.scopes"><span>[names<wbr>.resolution<wbr>.general<wbr>.scopes]</span></a>
</div>

<h3 id="作用域-1"><a class="header" href="#作用域-1">作用域</a></h3>
<div class="rule" id="r-names.resolution.general.scopes.intro"><a class="rule-link" href="#r-names.resolution.general.scopes.intro" title="names.resolution.general.scopes.intro"><span>[names<wbr>.resolution<wbr>.general<wbr>.scopes<wbr>.intro]</span></a>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>这是未来关于各种作用域内名称解析扩展的占位符。</p>
</blockquote>
</div>

<div class="rule" id="r-names.resolution.expansion"><a class="rule-link" href="#r-names.resolution.expansion" title="names.resolution.expansion"><span>[names<wbr>.resolution<wbr>.expansion]</span></a>
</div>

<h2 id="展开时名称解析"><a class="header" href="#展开时名称解析">展开时名称解析</a></h2>
<div class="rule" id="r-names.resolution.expansion.intro"><a class="rule-link" href="#r-names.resolution.expansion.intro" title="names.resolution.expansion.intro"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.intro]</span></a>
</div>

<p>展开时名称解析是完成宏展开并完全生成 crate 的 <a href="#r-glossary.ast">AST</a> 所必需的名称解析阶段。此阶段需要解析宏调用和 <code>use</code> 声明。解析 <code>use</code> 声明是解析通过 <a href="#r-macro.invocation.name-resolution">基于路径的作用域</a> 的宏调用所必需的。为了展开宏调用，必须先解析它们。</p>
<div class="rule" id="r-names.resolution.expansion.unresolved-invocations"><a class="rule-link" href="#r-names.resolution.expansion.unresolved-invocations" title="names.resolution.expansion.unresolved-invocations"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.unresolved-invocations]</span></a>
</div>

<p>在展开时名称解析之后， <a href="#r-glossary.ast">AST</a> 不得包含任何未展开的宏调用。每个宏调用都必须解析为存在于最终 <a href="#r-glossary.ast">AST</a> 中或外部 crate 中的有效定义。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>m!(); // 错误：在此作用域内找不到宏 `m`。
<span class="boring">}</span></code></pre>
<div class="rule" id="r-names.resolution.expansion.expansion-order-stability"><a class="rule-link" href="#r-names.resolution.expansion.expansion-order-stability" title="names.resolution.expansion.expansion-order-stability"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.expansion-order-stability]</span></a>
</div>

<p>名称的解析必须是稳定的。展开后，完全展开的 <a href="#r-glossary.ast">AST</a> 中的名称必须解析为相同的定义，无论宏展开和导入解析的顺序如何。</p>
<div class="rule" id="r-names.resolution.expansion.speculation"><a class="rule-link" href="#r-names.resolution.expansion.speculation" title="names.resolution.expansion.speculation"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.speculation]</span></a>
</div>

<p>宏展开期间选择的所有名称解析候选者都被视为推测性的。一旦 crate 被完全展开，所有的推测性导入解析都会被验证，以确保宏展开没有引入任何新的歧义。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>由于宏展开的迭代性质，这会导致所谓的时空穿越歧义，例如当宏或通配符导入引入了一个与其自身基路径歧义的项时。</p>
<pre class="playground"><code class="language-rust compile_fail E0659 edition2024"><span class="boring">fn main() {}
</span>macro_rules! f {
    () =&gt; {
        mod m {
            pub(crate) use f;
        }
    }
}
f!();

const _: () = {
    // 最初，我们将 `m` 推测性地解析为 crate 根中的模块。
    //
    // `f` 的展开在此体内部引入了第二个 `m` 模块。
    //
    // 展开时解析通过重新解析所有导入和宏调用来完成解析，
    // 发现引入的歧义并将其作为错误报告。
    m::f!(); // 错误：`m` 存在歧义。
};</code></pre>
</blockquote>
</div>

<div class="rule" id="r-names.resolution.expansion.imports"><a class="rule-link" href="#r-names.resolution.expansion.imports" title="names.resolution.expansion.imports"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.imports]</span></a>
</div>

<h3 id="导入"><a class="header" href="#导入">导入</a></h3>
<div class="rule" id="r-names.resolution.expansion.imports.intro"><a class="rule-link" href="#r-names.resolution.expansion.imports.intro" title="names.resolution.expansion.imports.intro"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.imports<wbr>.intro]</span></a>
</div>

<p>所有的 <code>use</code> 声明都在此解析阶段被完全解析。 <a href="#r-names.resolution.type-relative">类型相关路径</a> 在此阶段无法解析，并将产生错误。</p>
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>mod m {
    pub const C: () = ();
    pub enum E { V }
    pub type A = E;
    impl E {
        pub const C: () = ();
    }
}

// 在展开时解析的有效导入：
use m::C; // OK。
use m::E; // OK。
use m::A; // OK。
use m::E::V; // OK。

// 在类型相关解析期间解析的有效表达式：
let _ = m::A::V; // OK。
let _ = m::E::C; // OK。
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0432 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">mod m {
</span><span class="boring">    pub const C: () = ();
</span><span class="boring">    pub enum E { V }
</span><span class="boring">    pub type A = E;
</span><span class="boring">    impl E {
</span><span class="boring">        pub const C: () = ();
</span><span class="boring">    }
</span><span class="boring">}
</span>// 在展开时无法解析的无效类型相关导入：
use m::A::V; // 错误：未解析的导入 `m::A::V`。
use m::E::C; // 错误：未解析的导入 `m::E::C`。
<span class="boring">}</span></code></pre>
<div class="rule" id="r-names.resolution.expansion.imports.shadowing"><a class="rule-link" href="#r-names.resolution.expansion.imports.shadowing" title="names.resolution.expansion.imports.shadowing"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.imports<wbr>.shadowing]</span></a>
</div>

<p>除了受 <a href="#r-names.resolution.expansion.imports.ambiguity">名称解析歧义</a> 限制的情况外，通过 <a href="#r-names.resolution.general.scopes">外部作用域</a> 中的 <code>use</code> 声明引入的名称会被内部作用域中同一命名空间内同名的候选者遮蔽。</p>
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub mod m1 {
    pub mod ambig {
        pub const C: u8 = 1;
    }
}

pub mod m2 {
    pub mod ambig {
        pub const C: u8 = 2;
    }
}

// 这在外部作用域中引入了名称 `ambig`。
use m1::ambig;
const _: () = {
    // 这在内部作用域中遮蔽了 `ambig`。
    use m2::ambig;
    // 这里的 `ambig` 解析选择内部候选者。
    use ambig::C;
    assert!(C == 2);
};
<span class="boring">}</span></code></pre>
<div class="rule" id="r-names.resolution.expansion.imports.shadowing.shared-scope"><a class="rule-link" href="#r-names.resolution.expansion.imports.shadowing.shared-scope" title="names.resolution.expansion.imports.shadowing.shared-scope"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.imports<wbr>.shadowing<wbr>.shared-scope]</span></a>
</div>

<p>在单个作用域内，允许对通过 <code>use</code> 声明引入的名称进行遮蔽的情况如下：</p>
<ul>
<li><a href="#r-items.use.glob.shadowing"><code>use</code> 通配符遮蔽</a></li>
<li><a href="#r-macro.decl.scope.textual.shadow">宏文本作用域遮蔽</a></li>
</ul>
<div class="rule" id="r-names.resolution.expansion.imports.ambiguity"><a class="rule-link" href="#r-names.resolution.expansion.imports.ambiguity" title="names.resolution.expansion.imports.ambiguity"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.imports<wbr>.ambiguity]</span></a>
</div>

<h4 id="歧义"><a class="header" href="#歧义">歧义</a></h4>
<div class="rule" id="r-names.resolution.expansion.imports.ambiguity.intro"><a class="rule-link" href="#r-names.resolution.expansion.imports.ambiguity.intro" title="names.resolution.expansion.imports.ambiguity.intro"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.imports<wbr>.ambiguity<wbr>.intro]</span></a>
</div>

<p>在展开时解析期间，某些情况下存在多个宏定义、 <code>use</code> 声明或模块，导入或宏调用的名称可能指向这些定义、声明或模块，而编译器无法始终如一地确定哪个候选者应该遮蔽另一个。在这些情况下不允许遮蔽，编译器会发出歧义错误。</p>
<div class="rule" id="r-names.resolution.expansion.imports.ambiguity.glob-vs-glob"><a class="rule-link" href="#r-names.resolution.expansion.imports.ambiguity.glob-vs-glob" title="names.resolution.expansion.imports.ambiguity.glob-vs-glob"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.imports<wbr>.ambiguity<wbr>.glob-vs-glob]</span></a>
</div>

<p>名称不能通过有歧义的通配符导入来解析。通配符导入允许在同一命名空间中导入冲突的名称，只要不使用该名称即可。具有来自歧义通配符导入的冲突候选者的名称仍然可以被非通配符导入遮蔽，并在不产生错误的情况下使用。错误发生在使用的时刻，而不是导入的时刻。</p>
<pre class="playground"><code class="language-rust compile_fail E0659 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>mod m1 {
    pub struct Ambig;
}

mod m2 {
    pub struct Ambig;
}

// OK：这将同一命名空间中冲突的名称引入作用域，但尚未被使用。
use m1::*;
use m2::*;

const _: () = {
    // 当使用具有冲突候选者的名称时发生错误。
    let x = Ambig; // 错误：`Ambig` 存在歧义。
}
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">mod m1 {
</span><span class="boring">    pub struct Ambig;
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">mod m2 {
</span><span class="boring">    pub struct Ambig;
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">use m1::*;
</span><span class="boring">use m2::*; // OK：没有名称冲突。
</span>const _: () = {
    // 这是允许的，因为解析不是通过歧义通配符进行的。
    struct Ambig;
    let x = Ambig; // OK。
};
<span class="boring">}</span></code></pre>
<p>允许通过多个通配符导入导入相同的名称，如果导入的是同一个项（遵循重导出），则允许使用该名称。该名称的可见性是这些导入中的最大可见性。</p>
<pre class="playground"><code class="language-rust no_run edition2024">mod m1 {
    pub struct Ambig;
}

mod m2 {
    // 这从第二个模块重导出同一个 `Ambig` 项。
    pub use super::m1::Ambig;
}

mod m3 {
    // 这两者都导入同一个 `Ambig`。
    //
    // `Ambig` 的可见性是 `pub`，因为这是这两个 `use` 声明之间的最大可见性。
    pub use super::m1::*;
    use super::m2::*;
}

mod m4 {
    // `Ambig` 可以通过 `m3` 的通配符使用，且仍然具有 `pub` 可见性。
    pub use crate::m3::Ambig;
}

const _: () = {
    // 因此，我们可以在这里使用它。
    let _ = m4::Ambig; // OK。
};
<span class="boring">fn main() {}</span></code></pre>
<div class="rule" id="r-names.resolution.expansion.imports.ambiguity.glob-vs-outer"><a class="rule-link" href="#r-names.resolution.expansion.imports.ambiguity.glob-vs-outer" title="names.resolution.expansion.imports.ambiguity.glob-vs-outer"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.imports<wbr>.ambiguity<wbr>.glob-vs-outer]</span></a>
</div>

<p>当在 <a href="#r-names.resolution.general.scopes">外部作用域</a> 中有另一个可用候选者时，导入和宏调用中的名称不能通过通配符导入来解析。</p>
<pre class="playground"><code class="language-rust compile_fail E0659 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>mod glob {
    pub mod ambig {
        pub struct Name;
    }
}

// 外部 `ambig` 候选者。
pub mod ambig {
    pub struct Name;
}

const _: () = {
    // 无法通过此通配符解析 `ambig`，
    // 因为上方有外部 `ambig` 候选者。
    use glob::*;
    use ambig::Name; // 错误：`ambig` 存在歧义。
};
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0659 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 如上，但使用宏。
pub mod m {
    macro_rules! f {
        () =&gt; {};
    }
    pub(crate) use f;
}
pub mod glob {
    macro_rules! f {
        () =&gt; {};
    }
    pub(crate) use f as ambig;
}

use m::f as ambig;

const _: () = {
    use glob::*;
    ambig!(); // 错误：`ambig` 存在歧义。
};
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>这些歧义错误特定于展开时解析。在解析的后续阶段，为一个给定的名称提供多个候选者不被视为错误。只要导入本身没有歧义，就总是会有一个唯一的、无歧义的最近解析。</p>
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>mod glob {
    pub const AMBIG: u8 = 1;
}

mod outer {
    pub const AMBIG: u8 = 2;
}

use outer::AMBIG;

const C: () = {
    use glob::*;
    assert!(AMBIG == 1);
    //      ^---- 这个 `AMBIG` 在初级解析期间解析。
};
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-names.resolution.expansion.imports.ambiguity.path-vs-textual-macro"><a class="rule-link" href="#r-names.resolution.expansion.imports.ambiguity.path-vs-textual-macro" title="names.resolution.expansion.imports.ambiguity.path-vs-textual-macro"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.imports<wbr>.ambiguity<wbr>.path-vs-textual-macro]</span></a>
</div>

<p>名称不能通过有歧义的宏重导出进行解析。当宏重导出会遮蔽 <a href="#r-names.resolution.general.scopes">外部作用域</a> 中同名的文本宏候选者时，宏重导出即具有歧义。</p>
<pre class="playground"><code class="language-rust compile_fail E0659 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 文本宏候选者。
macro_rules! ambig {
    () =&gt; {}
}

// 基于路径的宏候选者。
macro_rules! path_based {
    () =&gt; {}
}

pub fn f() {
    // 将 `path_based` 宏定义重导出为 `ambig` 
    // 不得遮蔽通过文本宏作用域解析的 `ambig` 宏定义。
    use path_based as ambig;
    ambig!(); // 错误：`ambig` 存在歧义。
}
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>这种限制是由于编译器中的实现细节而需要的，特别是当前的作用域访问逻辑和支持此行为的复杂性。此歧义错误可能会在未来被移除。</p>
</blockquote>
</div>

<div class="rule" id="r-names.resolution.expansion.macros"><a class="rule-link" href="#r-names.resolution.expansion.macros" title="names.resolution.expansion.macros"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.macros]</span></a>
</div>

<h3 id="宏-1"><a class="header" href="#宏-1">宏</a></h3>
<div class="rule" id="r-names.resolution.expansion.macros.intro"><a class="rule-link" href="#r-names.resolution.expansion.macros.intro" title="names.resolution.expansion.macros.intro"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.macros<wbr>.intro]</span></a>
</div>

<p>宏通过遍历可用作用域来查找可用候选者进行解析。宏被分为两个子命名空间，一个用于类函数宏，另一个用于属性和派生宏。来自错误子命名空间的解析候选者将被忽略。</p>
<div class="rule" id="r-names.resolution.expansion.macros.visitation-order"><a class="rule-link" href="#r-names.resolution.expansion.macros.visitation-order" title="names.resolution.expansion.macros.visitation-order"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.macros<wbr>.visitation-order]</span></a>
</div>

<p>可用作用域种类的访问顺序如下。这些作用域种类中的每一个都代表一个或多个作用域。</p>
<ul>
<li><a href="#r-macro.proc.derive.attributes">派生辅助属性</a></li>
<li><a href="#r-macro.decl.scope.textual">文本作用域宏</a></li>
<li><a href="#r-macro.invocation.name-resolution">基于路径的作用域宏</a></li>
<li><a href="#r-names.preludes.macro_use"><code>macro_use</code> 预导入</a></li>
<li><a href="#r-names.preludes.std">标准库预导入</a></li>
<li><a href="#r-names.preludes.lang">内置属性</a></li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>编译器将尝试解析在其关联宏将其引入作用域之前使用的派生辅助属性。此作用域在访问已正确处于作用域内的派生辅助候选者的作用域之后被访问。此行为计划被移除。</p>
<p>更多信息请参见 <a href="#r-macro.proc.derive.attributes.scope">派生辅助属性作用域</a>。</p>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>此访问顺序将来可能会改变，例如根据文本和基于路径的作用域候选者的词法作用域来交替访问它们。</p>
</blockquote>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p>从 2018 版次开始，当存在 <a href="#r-names.preludes.no_implicit_prelude"><code>#[no_implicit_prelude]</code></a> 时，不会访问 <code>#[macro_use]</code> 预导入。</p>
</blockquote>
</div>

<div class="rule" id="r-names.resolution.expansion.macros.reserved-names"><a class="rule-link" href="#r-names.resolution.expansion.macros.reserved-names" title="names.resolution.expansion.macros.reserved-names"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.macros<wbr>.reserved-names]</span></a>
</div>

<p>名称 <code>cfg</code> 和 <code>cfg_attr</code> 在宏属性 <a href="#r-names.namespaces.sub-namespaces">子命名空间</a> 中被保留。</p>
<div class="rule" id="r-names.resolution.expansion.macros.ambiguity"><a class="rule-link" href="#r-names.resolution.expansion.macros.ambiguity" title="names.resolution.expansion.macros.ambiguity"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.macros<wbr>.ambiguity]</span></a>
</div>

<h4 id="歧义-1"><a class="header" href="#歧义-1">歧义</a></h4>
<div class="rule" id="r-names.resolution.expansion.macros.ambiguity.more-expanded-vs-outer"><a class="rule-link" href="#r-names.resolution.expansion.macros.ambiguity.more-expanded-vs-outer" title="names.resolution.expansion.macros.ambiguity.more-expanded-vs-outer"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.macros<wbr>.ambiguity<wbr>.more-expanded-vs-outer]</span></a>
</div>

<p>名称不能通过宏展开内部的歧义候选者进行解析。当宏展开内部的候选者会遮蔽来自第一个候选者宏展开外部的同名候选者，且正在解析的名称调用也来自第一个候选者宏展开外部时，宏展开内部的候选者即具有歧义。</p>
<pre class="playground"><code class="language-rust compile_fail E0659 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! define_ambig {
    () =&gt; {
        macro_rules! ambig {
            () =&gt; {}
        }
    }
}

// 为 `ambig` 宏调用引入外部候选者定义。
macro_rules! ambig {
    () =&gt; {}
}

// 在宏展开内部引入第二个 `ambig` 候选者定义。
define_ambig!();

// 来自 `define_ambig` 第二次调用的 `ambig` 定义是最内部的候选者。
//
// 来自 `define_ambig` 第一次调用的 `ambig` 定义是第二个候选者。
//
// 编译器检查第一个候选者是否在宏展开内部，
// 第二个候选者是否不在同一个宏展开内部，
// 以及正在解析的名称是否不在同一个宏展开内部。
ambig!(); // 错误：`ambig` 存在歧义。
<span class="boring">}</span></code></pre>
<p>反过来则不被视为歧义。</p>
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">macro_rules! define_ambig {
</span><span class="boring">    () =&gt; {
</span><span class="boring">        macro_rules! ambig {
</span><span class="boring">            () =&gt; {}
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">}
</span>// 交换定义顺序。
define_ambig!();
macro_rules! ambig {
    () =&gt; {}
}
// 最内部的候选者现在展开程度较低，因此它可以遮蔽其上方的宏展开定义。
ambig!();
<span class="boring">}</span></code></pre>
<p>如果正在解析的调用在最内部候选者的展开范围内，也不是歧义。</p>
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! ambig {
    () =&gt; {}
}

macro_rules! define_and_invoke_ambig {
    () =&gt; {
        // 定义最内部候选者。
        macro_rules! ambig {
            () =&gt; {}
        }

        // `ambig` 的调用与最内部候选者在同一个展开中。
        ambig!(); // OK
    }
}

define_and_invoke_ambig!();
<span class="boring">}</span></code></pre>
<p>即使两个定义都来自同一个宏的调用，这也没有关系；最外部的候选者仍然被视为 “展开较少”，因为它不在包含最内部候选者定义的展开范围内。</p>
<pre class="playground"><code class="language-rust compile_fail E0659 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">macro_rules! define_ambig {
</span><span class="boring">    () =&gt; {
</span><span class="boring">        macro_rules! ambig {
</span><span class="boring">            () =&gt; {}
</span><span class="boring">        }
</span><span class="boring">    }
</span><span class="boring">}
</span>define_ambig!();
define_ambig!();
ambig!(); // 错误：`ambig` 存在歧义。
<span class="boring">}</span></code></pre>
<p>这也适用于导入，只要名称的最内部候选者来自宏展开。</p>
<pre class="playground"><code class="language-rust compile_fail E0659 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! define_ambig {
    () =&gt; {
        mod ambig {
            pub struct Name;
        }
    }
}

mod ambig {
    pub struct Name;
}

const _: () = {
    // 在此宏展开中引入 `ambig` 模块的最内部候选者。
    define_ambig!();
    use ambig::Name; // 错误：`ambig` 存在歧义。
};
<span class="boring">}</span></code></pre>
<div class="rule" id="r-names.resolution.expansion.macros.ambiguity.built-in-attr"><a class="rule-link" href="#r-names.resolution.expansion.macros.ambiguity.built-in-attr" title="names.resolution.expansion.macros.ambiguity.built-in-attr"><span>[names<wbr>.resolution<wbr>.expansion<wbr>.macros<wbr>.ambiguity<wbr>.built-in-attr]</span></a>
</div>

<p>用户定义的属性或派生宏不得遮蔽内置的非宏属性（例如 inline）。</p>
<!-- ignore: test doesn't support proc-macro -->
<pre><code class="language-rust ignore">// with-helper/src/lib.rs
<span class="boring">use proc_macro::TokenStream;
</span>#[proc_macro_derive(WithHelperAttr, attributes(non_exhaustive))]
//                                             ^^^^^^^^^^^^^^
//                                   用户定义的属性候选者。
// ...
<span class="boring">pub fn derive_with_helper_attr(_item: TokenStream) -&gt; TokenStream {
</span><span class="boring">    TokenStream::new()
</span><span class="boring">}</span></code></pre>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">// src/lib.rs
#[derive(with_helper::WithHelperAttr)]
#[non_exhaustive] // 错误：`non_exhaustive` 存在歧义。
struct S;</code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>无论内置属性是哪个名称的候选者，这都适用：</p>
<!-- ignore: test doesn't support proc-macro -->
<pre><code class="language-rust ignore">// with-helper/src/lib.rs
<span class="boring">use proc_macro::TokenStream;
</span><span class="boring">
</span>#[proc_macro_derive(WithHelperAttr, attributes(helper))]
//                                             ^^^^^^
//                                 用户定义的属性候选者。
// ...
<span class="boring">pub fn derive_with_helper_attr(_item: TokenStream) -&gt; TokenStream {
</span><span class="boring">    TokenStream::new()
</span><span class="boring">}</span></code></pre>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">// src/lib.rs
use inline as helper;
//            ^----- 通过重导出的内置属性候选者。

#[derive(with_helper::WithHelperAttr)]
#[helper] // 错误：`helper` 存在歧义。
struct S;</code></pre>
</blockquote>
</div>

<div class="rule" id="r-names.resolution.primary"><a class="rule-link" href="#r-names.resolution.primary" title="names.resolution.primary"><span>[names<wbr>.resolution<wbr>.primary]</span></a>
</div>

<h2 id="初级名称解析"><a class="header" href="#初级名称解析">初级名称解析</a></h2>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>这是未来关于初级名称解析扩展的占位符。</p>
</blockquote>
</div>

<div class="rule" id="r-names.resolution.type-relative"><a class="rule-link" href="#r-names.resolution.type-relative" title="names.resolution.type-relative"><span>[names<wbr>.resolution<wbr>.type-relative]</span></a>
</div>

<h2 id="类型相关解析"><a class="header" href="#类型相关解析">类型相关解析</a></h2>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>这是未来关于类型依赖解析扩展的占位符。</p>
</blockquote>
</div>

<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-vis"><a class="rule-link" href="#r-vis" title="vis"><span>[vis]</span></a>
</div>

<h1 id="可见性和私有性"><a class="header" href="#可见性和私有性">可见性和私有性</a></h1>
<div class="rule" id="r-vis.syntax"><a class="rule-link" href="#r-vis.syntax" title="vis.syntax"><span>[vis<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-Visibility" onclick="show_railroad()"><a href="#railroad-Visibility">Visibility</a></span> → <br>      <span class="grammar-literal">pub</span> <br>    | <span class="grammar-literal">pub</span> <span class="grammar-literal">(</span> <span class="grammar-literal">crate</span> <span class="grammar-literal">)</span> <br>    | <span class="grammar-literal">pub</span> <span class="grammar-literal">(</span> <span class="grammar-literal">self</span> <span class="grammar-literal">)</span> <br>    | <span class="grammar-literal">pub</span> <span class="grammar-literal">(</span> <span class="grammar-literal">super</span> <span class="grammar-literal">)</span> <br>    | <span class="grammar-literal">pub</span> <span class="grammar-literal">(</span> <span class="grammar-literal">in</span> <span class="grammar-text"><a href="#grammar-SimplePath">SimplePath</a></span> <span class="grammar-literal">)</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 394px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-Visibility"><svg class="railroad" viewbox="0 0 394 206" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-Visibility">
<text class="comment" x="50" y="25">
Visibility</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 44 0 h 256 m -125 0 l -5 -5 m 0 10 l 5 -5 m 125 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="42" />
<text x="81" y="58">
pub</text>
</g>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 300 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 300 0 v -33" />
<path d=" M 47 107 v 33 m 300 0 v -33" />
<path d=" M 47 140 v 33 m 300 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 190 0 h 86 m -40 0 l -5 -5 m 0 10 l 5 -5 m 40 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="75" />
<text x="81" y="91">
pub</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="113" y="75" />
<text x="127" y="91">
(</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="151" y="75" />
<text x="181" y="91">
crate</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="221" y="75" />
<text x="235" y="91">
)</text>
</g>
<path d=" M 103 86 h 10" />
<path d=" M 141 86 h 10" />
<path d=" M 211 86 h 10" />
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 182 0 h 94 m -44 0 l -5 -5 m 0 10 l 5 -5 m 44 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="108" />
<text x="81" y="124">
pub</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="113" y="108" />
<text x="127" y="124">
(</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="151" y="108" />
<text x="177" y="124">
self</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="213" y="108" />
<text x="227" y="124">
)</text>
</g>
<path d=" M 103 119 h 10" />
<path d=" M 141 119 h 10" />
<path d=" M 203 119 h 10" />
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 190 0 h 86 m -40 0 l -5 -5 m 0 10 l 5 -5 m 40 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="141" />
<text x="81" y="157">
pub</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="113" y="141" />
<text x="127" y="157">
(</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="151" y="141" />
<text x="181" y="157">
super</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="221" y="141" />
<text x="235" y="157">
)</text>
</g>
<path d=" M 103 152 h 10" />
<path d=" M 141 152 h 10" />
<path d=" M 211 152 h 10" />
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 276 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="174" />
<text x="81" y="190">
pub</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="113" y="174" />
<text x="127" y="190">
(</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="151" y="174" />
<text x="169" y="190">
in</text>
</g>
<a class="link" xlink:href="#railroad-SimplePath">
<g class="nonterminal">
<rect height="22" width="100" x="197" y="174" />
<text x="247" y="190">
SimplePath</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="307" y="174" />
<text x="321" y="190">
)</text>
</g>
<path d=" M 103 185 h 10" />
<path d=" M 141 185 h 10" />
<path d=" M 187 185 h 10" />
<path d=" M 297 185 h 10" />
</g>
</g>
<path d=" M 369 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 359 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-vis.intro"><a class="rule-link" href="#r-vis.intro" title="vis.intro"><span>[vis<wbr>.intro]</span></a>
</div>

<p>这两个术语经常互换使用，它们试图传达的是对 “这个 项 是否可以在此位置使用？” 这一问题的回答。</p>
<div class="rule" id="r-vis.name-hierarchy"><a class="rule-link" href="#r-vis.name-hierarchy" title="vis.name-hierarchy"><span>[vis<wbr>.name-hierarchy]</span></a>
</div>

<p>Rust 的名称解析在命名空间的全局层级结构上运行。层级结构中的每一层都可以被看作是某个 项 。这些 项 是上述提到的那些，但也包括外部 crate 。声明或定义一个新模块可以被看作是在定义所在的位置向层级结构中插入一棵新树。</p>
<div class="rule" id="r-vis.privacy"><a class="rule-link" href="#r-vis.privacy" title="vis.privacy"><span>[vis<wbr>.privacy]</span></a>
</div>

<p>为了控制接口是否可以跨模块使用，Rust 会检查每个 项 的使用，看它是否应该被允许。这就是生成私有性警告的地方，或者说是 “你使用了另一个模块的私有 项 ，这是不被允许的。”</p>
<div class="rule" id="r-vis.default"><a class="rule-link" href="#r-vis.default" title="vis.default"><span>[vis<wbr>.default]</span></a>
</div>

<p>默认情况下，一切都是 <em>private</em> (私有的)，但有两个例外： <code>pub</code> 特型 中的关联 项 默认是公有的； <code>pub</code> 枚举中的枚举 变体 默认也是公有的。当一个 项 被声明为 <code>pub</code> 时，可以认为它是可以被外界访问的。例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {}
</span>// 声明一个私有的结构体
struct Foo;

// 声明一个带有一个私有字段的公有结构体
pub struct Bar {
    field: i32,
}

// 声明一个带有两个公有变体的公有枚举
pub enum State {
    PubliclyAccessibleState,
    PubliclyAccessibleState2,
}</code></pre>
<div class="rule" id="r-vis.access"><a class="rule-link" href="#r-vis.access" title="vis.access"><span>[vis<wbr>.access]</span></a>
</div>

<p>有了 项 是公有或私有这一概念，Rust 在两种情况下允许 项 访问：</p>
<ol>
<li>如果一个 项 是公有的，那么如果你可以从模块 <code>m</code> 访问该 项 的所有祖先模块，那么它就可以从模块 <code>m</code> 外部访问。你还可能能够通过重导出为该 项 命名。见下文。</li>
<li>如果一个 项 是私有的，它可以被当前模块及其后代访问。</li>
</ol>
<p>这两条规则在创建暴露公有 API 同时隐藏内部实现细节的模块层级结构方面出奇地强大。为了帮助解释，这里有几个用例及其含义：</p>
<ul>
<li>
<p>库开发人员需要向链接到其库的 crate 暴露功能。作为第一种情况的结果，这意味着任何可以从外部使用的东西，从根部到目标 项 都必须是 <code>pub</code> 的。链条中任何私有的 项 都会禁止外部访问。</p>
</li>
<li>
<p>一个 crate 需要为其自身提供一个全局可用的 “辅助模块”，但它不想将该辅助模块作为公有 API 暴露。为了实现这一点，该 crate 层级结构的根部会有一个私有模块，然后该模块内部有一个 “公有 API”。因为整个 crate 都是根部的后代，所以整个本地 crate 都可以通过第二种情况访问这个私有模块。</p>
</li>
<li>
<p>在为模块编写单元测试时，一个常见的惯例是拥有一个名为 <code>mod test</code> 的待测模块的直接子模块。该模块可以通过第二种情况访问父模块的任何 项 ，这意味着内部实现细节也可以从子模块中无缝测试。</p>
</li>
</ul>
<p>在第二种情况中提到，一个私有的 项 “可以被” 当前模块及其后代访问，但访问一个 项 的确切含义取决于该 项 是什么。</p>
<div class="rule" id="r-vis.usage"><a class="rule-link" href="#r-vis.usage" title="vis.usage"><span>[vis<wbr>.usage]</span></a>
</div>

<p>例如，访问一个模块意味着查看其内部（以导入更多 项 ）。另一方面，访问一个函数意味着它被调用。此外，路径表达式和导入语句被认为是访问一个 项 ，因为只有当目标在当前的可见性作用域内时，导入/表达式才有效。</p>
<p>这里有一个体现了上述三种情况的程序示例：</p>
<pre class="playground"><code class="language-rust edition2024">// 这个模块是私有的，意味着没有外部 crate 可以访问这个模块。
// 然而，由于它在当前 crate 的根部是私有的，crate 中的任何模块
// 都可以访问这个模块中任何公开可见的项。
mod crate_helper_module {

    // 这个函数可以被当前 crate 中的任何东西使用
    pub fn crate_helper() {}

    // 这个函数 *不能* 被 crate 中的其他任何东西使用。它在
    // `crate_helper_module` 之外不是公开可见的，所以只有
    // 当前模块及其后代可以访问它。
    fn implementation_detail() {}
}

// 这个函数是 "对根部公有" 的，意味着它对链接到此 crate 的
// 外部 crate 可用。
pub fn public_api() {}

// 与 'public_api' 类似，这个模块是公有的，因此外部 crate 可以查看其内部。
pub mod submodule {
    use crate::crate_helper_module;

    pub fn my_method() {
        // 本地 crate 中的任何项都可以通过上述两条规则的组合
        // 调用辅助模块的公有接口。
        crate_helper_module::crate_helper();
    }

    // 这个函数对任何不是 `submodule` 后代的模块都是隐藏的
    fn my_implementation() {}

    #[cfg(test)]
    mod test {

        #[test]
        fn test_my_implementation() {
            // 因为这个模块是 `submodule` 的后代，所以允许
            // 访问 `submodule` 内部的私有项而不会违反私有性。
            super::my_implementation();
        }
    }
}

<span class="boring">fn main() {}</span></code></pre>
<p>为了使 Rust 程序通过私有性检查，基于上述两条规则，所有路径都必须是有效的访问。这包括所有的 <code>use</code> 语句、表达式、类型等。</p>
<div class="rule" id="r-vis.scoped"><a class="rule-link" href="#r-vis.scoped" title="vis.scoped"><span>[vis<wbr>.scoped]</span></a>
</div>

<h2 id="pubin-pathpubcratepubsuper和pubself"><a class="header" href="#pubin-pathpubcratepubsuper和pubself"><code>pub(in path)</code>，<code>pub(crate)</code>，<code>pub(super)</code>，和<code>pub(self)</code></a></h2>
<div class="rule" id="r-vis.scoped.intro"><a class="rule-link" href="#r-vis.scoped.intro" title="vis.scoped.intro"><span>[vis<wbr>.scoped<wbr>.intro]</span></a>
</div>

<p>除了公有和私有，Rust 还允许用户声明一个 项 仅在给定的作用域内可见。 <code>pub</code> 限制的规则如下：</p>
<div class="rule" id="r-vis.scoped.in"><a class="rule-link" href="#r-vis.scoped.in" title="vis.scoped.in"><span>[vis<wbr>.scoped<wbr>.in]</span></a>
</div>

<ul>
<li><code>pub(in path)</code> 使一个 项 在提供的 <code>path</code> 内可见。 <code>path</code> 必须是一个简单路径，解析为声明其可见性的 项 的祖先模块。 <code>path</code> 中的每个标识符必须直接引用一个模块（而不是由 <code>use</code> 语句引入的名称）。</li>
</ul>
<div class="rule" id="r-vis.scoped.crate"><a class="rule-link" href="#r-vis.scoped.crate" title="vis.scoped.crate"><span>[vis<wbr>.scoped<wbr>.crate]</span></a>
</div>

<ul>
<li><code>pub(crate)</code> 使一个 项 在当前 crate 内可见。</li>
</ul>
<div class="rule" id="r-vis.scoped.super"><a class="rule-link" href="#r-vis.scoped.super" title="vis.scoped.super"><span>[vis<wbr>.scoped<wbr>.super]</span></a>
</div>

<ul>
<li><code>pub(super)</code> 使一个 项 对父模块可见。这等同于 <code>pub(in super)</code> 。</li>
</ul>
<div class="rule" id="r-vis.scoped.self"><a class="rule-link" href="#r-vis.scoped.self" title="vis.scoped.self"><span>[vis<wbr>.scoped<wbr>.self]</span></a>
</div>

<ul>
<li><code>pub(self)</code> 使一个 项 对当前模块可见。这等同于 <code>pub(in self)</code> 或根本不使用 <code>pub</code> 。</li>
</ul>
<div class="rule" id="r-vis.scoped.edition2018"><a class="rule-link" href="#r-vis.scoped.edition2018" title="vis.scoped.edition2018"><span>[vis<wbr>.scoped<wbr>.edition2018]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2018</span> 版次差异</p>

<p>从 2018 版次开始， <code>pub(in path)</code> 的路径必须以 <code>crate</code> ， <code>self</code> ，或 <code>super</code> 开头。2015 版次还可以使用以 <code>::</code> 开头的路径或来自 crate 根部的模块。</p>
</blockquote>
</div>

<p>这里有一个例子：</p>
<pre class="playground"><code class="language-rust edition2015">pub mod outer_mod {
    pub mod inner_mod {
        // 这个函数在 `outer_mod` 内可见
        pub(in crate::outer_mod) fn outer_mod_visible_fn() {}
        // 与上面相同，这仅在 2015 版次中有效。
        pub(in outer_mod) fn outer_mod_visible_fn_2015() {}

        // 这个函数对整个 crate 可见
        pub(crate) fn crate_visible_fn() {}

        // 这个函数在 `outer_mod` 内可见
        pub(super) fn super_mod_visible_fn() {
            // 这个函数是可见的，因为我们在同一个 `mod` 中
            inner_mod_visible_fn();
        }

        // 这个函数仅在 `inner_mod` 内可见，
        // 这与保持其私有是一样的。
        pub(self) fn inner_mod_visible_fn() {}
    }
    pub fn foo() {
        inner_mod::outer_mod_visible_fn();
        inner_mod::crate_visible_fn();
        inner_mod::super_mod_visible_fn();

        // 这个函数不再可见，因为我们在 `inner_mod` 之外
        // 错误！`inner_mod_visible_fn` 是私有的
        //inner_mod::inner_mod_visible_fn();
    }
}

fn bar() {
    // 这个函数仍然可见，因为我们在同一个 crate 中
    outer_mod::inner_mod::crate_visible_fn();

    // 这个函数不再可见，因为我们在 `outer_mod` 之外
    // 错误！`super_mod_visible_fn` 是私有的
    //outer_mod::inner_mod::super_mod_visible_fn();

    // 这个函数不再可见，因为我们在 `outer_mod` 之外
    // 错误！`outer_mod_visible_fn` 是私有的
    //outer_mod::inner_mod::outer_mod_visible_fn();

    outer_mod::foo();
}

fn main() { bar() }</code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>此语法格式仅为 项 的可见性添加了另一个限制。它并不保证该 项 在指定作用域的所有部分都可见。要访问一个 项 ，直到当前作用域的所有父 项 必须仍然也是可见的。</p>
</blockquote>
</div>

<div class="rule" id="r-vis.reexports"><a class="rule-link" href="#r-vis.reexports" title="vis.reexports"><span>[vis<wbr>.reexports]</span></a>
</div>

<h2 id="重导出和可见性"><a class="header" href="#重导出和可见性">重导出和可见性</a></h2>
<div class="rule" id="r-vis.reexports.intro"><a class="rule-link" href="#r-vis.reexports.intro" title="vis.reexports.intro"><span>[vis<wbr>.reexports<wbr>.intro]</span></a>
</div>

<p>Rust 允许通过 <code>pub use</code> 指令公开重导出 项 。因为这是一个公开指令，这允许根据上述规则在当前模块中使用该 项 。它本质上允许对重导出的 项 进行公有访问。例如，这个程序是有效的：</p>
<pre class="playground"><code class="language-rust edition2024">pub use self::implementation::api;

mod implementation {
    pub mod api {
        pub fn f() {}
    }
}

<span class="boring">fn main() {}</span></code></pre>
<p>这意味着任何引用 <code>implementation::api::f</code> 的外部 crate 都会收到一个私有性违规，而路径 <code>api::f</code> 将是被允许的。</p>
<div class="rule" id="r-vis.reexports.private-item"><a class="rule-link" href="#r-vis.reexports.private-item" title="vis.reexports.private-item"><span>[vis<wbr>.reexports<wbr>.private-item]</span></a>
</div>

<p>当重导出私有 项 时，可以将其看作是允许 “私有链” 通过重导出短路，而不是像通常那样通过命名空间层级结构。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-memory"><a class="rule-link" href="#r-memory" title="memory"><span>[memory]</span></a>
</div>

<h1 id="内存模型"><a class="header" href="#内存模型">内存模型</a></h1>
<div class="alert alert-warning">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>警告</p>

<p>Rust 的 内存模型 尚未完善且未完全确定。</p>
</blockquote>
</div>

<div class="rule" id="r-memory.bytes"><a class="rule-link" href="#r-memory.bytes" title="memory.bytes"><span>[memory<wbr>.bytes]</span></a>
</div>

<h2 id="字节"><a class="header" href="#字节">字节</a></h2>
<div class="rule" id="r-memory.bytes.intro"><a class="rule-link" href="#r-memory.bytes.intro" title="memory.bytes.intro"><span>[memory<wbr>.bytes<wbr>.intro]</span></a>
</div>

<p>Rust 中最基本的内存单位是字节。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>虽然字节通常被映射到硬件字节，但 Rust 使用一种“抽象”的字节概念，可以做出硬件中不存在的区分，例如未初始化，或存储指针的一部分。这些区分会影响你的程序是否具有未定义行为，因此它们仍然对编译后的 Rust 程序的行为产生实际影响。</p>
</blockquote>
</div>

<div class="rule" id="r-memory.bytes.contents"><a class="rule-link" href="#r-memory.bytes.contents" title="memory.bytes.contents"><span>[memory<wbr>.bytes<wbr>.contents]</span></a>
</div>

<p>每个字节可能具有以下值之一：</p>
<div class="rule" id="r-memory.bytes.init"><a class="rule-link" href="#r-memory.bytes.init" title="memory.bytes.init"><span>[memory<wbr>.bytes<wbr>.init]</span></a>
</div>

<ul>
<li>一个包含 <code>u8</code> 值和可选的 <a href="../core/ptr/index.html#provenance">来源</a> 的已初始化字节，</li>
</ul>
<div class="rule" id="r-memory.bytes.uninit"><a class="rule-link" href="#r-memory.bytes.uninit" title="memory.bytes.uninit"><span>[memory<wbr>.bytes<wbr>.uninit]</span></a>
</div>

<ul>
<li>一个未初始化字节。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>以上列表尚未保证是详尽的。</p>
</blockquote>
</div>

<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-alloc"><a class="rule-link" href="#r-alloc" title="alloc"><span>[alloc]</span></a>
</div>

<h1 id="内存分配和生命周期"><a class="header" href="#内存分配和生命周期">内存分配和生命周期</a></h1>
<div class="rule" id="r-alloc.static"><a class="rule-link" href="#r-alloc.static" title="alloc.static"><span>[alloc<wbr>.static]</span></a>
</div>

<p>程序的 项 是那些在编译时计算其值并唯一地存储在 Rust 进程内存映像中的函数、模块和类型。 项 既不动态分配也不释放。</p>
<div class="rule" id="r-alloc.dynamic"><a class="rule-link" href="#r-alloc.dynamic" title="alloc.dynamic"><span>[alloc<wbr>.dynamic]</span></a>
</div>

<p>堆 是描述 盒子的通用术语。 堆中分配的生命周期取决于指向它的 盒子 值的生命周期。 由于 盒子 值本身可以在帧之间传递进出，或者存储在 堆中，因此 堆分配 可能会超出它们被分配的帧的生命周期。 堆中的一个分配 在其整个生命周期内保证驻留在 堆中的一个单一位置——它永远不会因为移动 盒子 值而重新定位。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-variable"><a class="rule-link" href="#r-variable" title="variable"><span>[variable]</span></a>
</div>

<h1 id="变量"><a class="header" href="#变量">变量</a></h1>
<div class="rule" id="r-variable.intro"><a class="rule-link" href="#r-variable.intro" title="variable.intro"><span>[variable<wbr>.intro]</span></a>
</div>

<p>一个 变量 是 栈帧 的一个组成部分，它可以是一个具名函数 参数，一个匿名 <a href="#temporaries">临时量</a>，或者一个具名 局部变量。</p>
<div class="rule" id="r-variable.local"><a class="rule-link" href="#r-variable.local" title="variable.local"><span>[variable<wbr>.local]</span></a>
</div>

<p>一个 局部变量 （或 栈-局部 分配）直接持有值，在 栈内存 中分配。该值是 栈帧 的一部分。</p>
<div class="rule" id="r-variable.local-mut"><a class="rule-link" href="#r-variable.local-mut" title="variable.local-mut"><span>[variable<wbr>.local-mut]</span></a>
</div>

<p>局部变量 默认不可变，除非另行声明。例如：<code>let mut x = ...</code>。</p>
<div class="rule" id="r-variable.param-mut"><a class="rule-link" href="#r-variable.param-mut" title="variable.param-mut"><span>[variable<wbr>.param-mut]</span></a>
</div>

<p>函数 参数 默认不可变，除非用 <code>mut</code> 声明。<code>mut</code> 关键字仅适用于其后的 参数。例如：<code>|mut x, y|</code> 和 <code>fn f(mut x: Box&lt;i32&gt;, y: Box&lt;i32&gt;)</code> 声明了一个 可变 变量 <code>x</code> 和一个 不可变 变量 <code>y</code>。</p>
<div class="rule" id="r-variable.init"><a class="rule-link" href="#r-variable.init" title="variable.init"><span>[variable<wbr>.init]</span></a>
</div>

<p>局部变量 在分配时不会被初始化。相反，整个 栈帧 上的 局部变量 会在 栈帧 进入时以未初始化状态分配。函数内的后续语句可能会或可能不会初始化 局部变量。局部变量 只能在它们通过所有可达的 控制流路径 被初始化后才能使用。</p>
<p>在下一个示例中，<code>init_after_if</code> 在 <a href="#if-expressions"><code>if</code> 表达式</a> 之后被初始化，而 <code>uninit_after_if</code> 没有，因为它在 <code>else</code> 分支中未被初始化。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">fn random_bool() -&gt; bool { true }
</span>fn initialization_example() {
    let init_after_if: ();
    let uninit_after_if: ();

    if random_bool() {
        init_after_if = ();
        uninit_after_if = ();
    } else {
        init_after_if = ();
    }

    init_after_if; // ok
    // uninit_after_if; // 错误：使用了可能未初始化的 `uninit_after_if`
}
<span class="boring">}</span></code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-panic"><a class="rule-link" href="#r-panic" title="panic"><span>[panic]</span></a>
</div>

<h1 id="恐慌"><a class="header" href="#恐慌">恐慌</a></h1>
<div class="rule" id="r-panic.intro"><a class="rule-link" href="#r-panic.intro" title="panic.intro"><span>[panic<wbr>.intro]</span></a>
</div>

<p>Rust 提供了一种机制来防止函数正常返回，而是引发 “恐慌 (panic)”。这是对错误条件的响应，通常在遇到错误的上下文中被认为无法恢复。</p>
<div class="rule" id="r-panic.lang-ops"><a class="rule-link" href="#r-panic.lang-ops" title="panic.lang-ops"><span>[panic<wbr>.lang-ops]</span></a>
</div>

<p>一些语言结构，例如越界的 <a href="#array-and-slice-indexing-expressions">数组索引</a>，会自动引发恐慌。</p>
<div class="rule" id="r-panic.control"><a class="rule-link" href="#r-panic.control" title="panic.control"><span>[panic<wbr>.control]</span></a>
</div>

<p>还有一些语言特性提供了一定程度的恐慌行为控制：</p>
<ul>
<li><a href="#the-panic_handler-attribute"><em>恐慌处理器 (panic handler)</em></a> 定义了恐慌的行为。</li>
<li><a href="#unwinding">FFI ABI</a> 可能会改变恐慌的行为。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>标准库提供了通过 <a href="../std/macro.panic.html">panic! 宏</a> 显式引发恐慌的能力。</p>
</blockquote>
</div>

<div class="rule" id="r-panic.panic_handler"><a class="rule-link" href="#r-panic.panic_handler" title="panic.panic_handler"><span>[panic<wbr>.panic_handler]</span></a>
</div>

<h2 id="panic_handler属性"><a class="header" href="#panic_handler属性">panic_handler属性</a></h2>
<div class="rule" id="r-panic.panic_handler.intro"><a class="rule-link" href="#r-panic.panic_handler.intro" title="panic.panic_handler.intro"><span>[panic<wbr>.panic_handler<wbr>.intro]</span></a>
</div>

<p><em>panic_handler 属性</em> 可以应用于函数以定义恐慌的行为。</p>
<div class="rule" id="r-panic.panic_handler.allowed-positions"><a class="rule-link" href="#r-panic.panic_handler.allowed-positions" title="panic.panic_handler.allowed-positions"><span>[panic<wbr>.panic_handler<wbr>.allowed-positions]</span></a>
</div>

<p>panic_handler 属性只能应用于具有签名 <code>fn(&amp;PanicInfo) -&gt; !</code> 的函数。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><a href="../core/panic/panic_info/struct.PanicInfo.html">PanicInfo 结构体</a> 包含了有关恐慌发生位置的信息。</p>
</blockquote>
</div>

<div class="rule" id="r-panic.panic_handler.unique"><a class="rule-link" href="#r-panic.panic_handler.unique" title="panic.panic_handler.unique"><span>[panic<wbr>.panic_handler<wbr>.unique]</span></a>
</div>

<p>在依赖图中必须有且仅有一个 panic_handler 函数。</p>
<p>下面展示了一个记录恐慌消息然后停止线程的 panic_handler 函数。</p>
<!-- ignore: test infrastructure can't handle no_std -->
<pre><code class="language-rust ignore">#![no_std]

use core::fmt::{self, Write};
use core::panic::PanicInfo;

struct Sink {
    // ..
<span class="boring">   _0: (),
</span>}
<span class="boring">
</span><span class="boring">impl Sink {
</span><span class="boring">    fn new() -&gt; Sink { Sink { _0: () }}
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">impl fmt::Write for Sink {
</span><span class="boring">    fn write_str(&amp;mut self, _: &amp;str) -&gt; fmt::Result { Ok(()) }
</span><span class="boring">}
</span>
#[panic_handler]
fn panic(info: &amp;PanicInfo) -&gt; ! {
    let mut sink = Sink::new();

    // 将 "panicked at '$reason', src/main.rs:27:4" 记录到某个 `sink`
    let _ = writeln!(sink, "{}", info);

    loop {}
}</code></pre>
<div class="rule" id="r-panic.panic_handler.std"><a class="rule-link" href="#r-panic.panic_handler.std" title="panic.panic_handler.std"><span>[panic<wbr>.panic_handler<wbr>.std]</span></a>
</div>

<h3 id="标准行为"><a class="header" href="#标准行为">标准行为</a></h3>
<div class="rule" id="r-panic.panic_handler.std.kinds"><a class="rule-link" href="#r-panic.panic_handler.std.kinds" title="panic.panic_handler.std.kinds"><span>[panic<wbr>.panic_handler<wbr>.std<wbr>.kinds]</span></a>
</div>

<p><code>std</code> 提供了两种不同的恐慌处理器：</p>
<ul>
<li><code>unwind</code> — 展开栈，并且是潜在可恢复的。</li>
<li><code>abort</code> –– 中止进程，且是不可恢复的。</li>
</ul>
<p>并非所有 target 都提供 <code>unwind</code> 处理器。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>链接 <code>std</code> 时使用的恐慌处理器可以通过 <a href="https://doc.rust-lang.org/rustc/codegen-options/index.html#panic"><code>-C panic</code></a> 命令行标志设置。大多数 target 的默认值是 <code>unwind</code>。</p>
<p>标准库的恐慌行为可以在运行时使用 <a href="../std/panicking/fn.set_hook.html"><code>std::panic::set_hook</code></a> 函数进行修改。</p>
</blockquote>
</div>

<div class="rule" id="r-panic.panic_handler.std.no_std"><a class="rule-link" href="#r-panic.panic_handler.std.no_std" title="panic.panic_handler.std.no_std"><span>[panic<wbr>.panic_handler<wbr>.std<wbr>.no_std]</span></a>
</div>

<p>链接 <a href="#the-no_std-attribute"><code>no_std</code></a> 二进制文件、dylib、cdylib 或 staticlib 时，需要指定你自己的恐慌处理器。</p>
<div class="rule" id="r-panic.strategy"><a class="rule-link" href="#r-panic.strategy" title="panic.strategy"><span>[panic<wbr>.strategy]</span></a>
</div>

<h2 id="恐慌策略"><a class="header" href="#恐慌策略">恐慌策略</a></h2>
<div class="rule" id="r-panic.strategy.intro"><a class="rule-link" href="#r-panic.strategy.intro" title="panic.strategy.intro"><span>[panic<wbr>.strategy<wbr>.intro]</span></a>
</div>

<p><em>恐慌策略 (panic strategy)</em> 定义了一个 crate 构建时支持的恐慌行为类型。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>恐慌策略可以在 <code>rustc</code> 中使用 <a href="https://doc.rust-lang.org/rustc/codegen-options/index.html#panic"><code>-C panic</code></a> 命令行标志进行选择。</p>
<p>当生成二进制文件、dylib、cdylib 或 staticlib 且链接 <code>std</code> 时， <code>-C panic</code> 命令行标志也会影响使用哪个 <a href="#the-panic_handler-attribute">恐慌处理器</a>。</p>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>当使用 <code>abort</code> 恐慌策略编译代码时，优化器可能会假设跨 Rust 栈帧的展开是不可能的，这可以提高代码大小和运行时速度。</p>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>有关链接具有不同恐慌策略的 crate 的限制，请参见 <a href="#r-link.unwinding">link.unwinding</a>。其中一个暗示是，使用 <code>unwind</code> 策略构建的 crate 可以使用 <code>abort</code> 恐慌处理器，但 <code>abort</code> 策略不能使用 <code>unwind</code> 恐慌处理器。</p>
</blockquote>
</div>

<div class="rule" id="r-panic.unwind"><a class="rule-link" href="#r-panic.unwind" title="panic.unwind"><span>[panic<wbr>.unwind]</span></a>
</div>

<h2 id="展开"><a class="header" href="#展开">展开</a></h2>
<div class="rule" id="r-panic.unwind.intro"><a class="rule-link" href="#r-panic.unwind.intro" title="panic.unwind.intro"><span>[panic<wbr>.unwind<wbr>.intro]</span></a>
</div>

<p>引发恐慌可能是可恢复的或不可恢复的，尽管可以配置（通过选择不展开的恐慌处理器）为始终不可恢复。（反之则不然：<code>unwind</code> 处理器不保证所有恐慌都是可恢复的，仅保证通过 <code>panic!</code> 宏及类似的标准库机制引发的恐慌是可恢复的。）</p>
<div class="rule" id="r-panic.unwind.destruction"><a class="rule-link" href="#r-panic.unwind.destruction" title="panic.unwind.destruction"><span>[panic<wbr>.unwind<wbr>.destruction]</span></a>
</div>

<p>当发生恐慌时，<code>unwind</code> 处理器会 “展开 (unwind)” Rust 栈帧，就像 C++ 的 <code>throw</code> 展开 C++ 栈帧一样，直到恐慌到达恢复点（例如在线程边界处）。这意味着当恐慌遍历 Rust 栈帧时，这些栈帧中 <a href="#析构函数">实现 Drop</a> 的活跃对象将调用其 <code>drop</code> 方法。因此，当恢复正常执行时，不再可访问的对象将被 “清理” 掉，就像它们正常超出作用域一样。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>只要保留了这种资源清理的保证， “展开” 的实现可以不实际使用 target 平台 C++ 所使用的机制。</p>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>标准库提供了两种从恐慌中恢复的机制：<a href="../std/panic/fn.catch_unwind.html"><code>std::panic::catch_unwind</code></a>（允许在发生恐慌的线程内恢复）和 <a href="../std/thread/functions/fn.spawn.html"><code>std::thread::spawn</code></a>（自动为生成的线程设置恐慌恢复，以便其他线程可以继续运行）。</p>
</blockquote>
</div>

<div class="rule" id="r-panic.unwind.ffi"><a class="rule-link" href="#r-panic.unwind.ffi" title="panic.unwind.ffi"><span>[panic<wbr>.unwind<wbr>.ffi]</span></a>
</div>

<h3 id="跨ffi边界展开"><a class="header" href="#跨ffi边界展开">跨FFI边界展开</a></h3>
<div class="rule" id="r-panic.unwind.ffi.intro"><a class="rule-link" href="#r-panic.unwind.ffi.intro" title="panic.unwind.ffi.intro"><span>[panic<wbr>.unwind<wbr>.ffi<wbr>.intro]</span></a>
</div>

<p>可以使用 <a href="#unwinding">适当的 ABI 声明</a> 跨 FFI 边界进行展开。虽然在某些情况下很有用，但这为未定义行为创造了独特的机会，特别是在涉及多个语言运行时时。</p>
<div class="rule" id="r-panic.unwind.ffi.undefined"><a class="rule-link" href="#r-panic.unwind.ffi.undefined" title="panic.unwind.ffi.undefined"><span>[panic<wbr>.unwind<wbr>.ffi<wbr>.undefined]</span></a>
</div>

<p>使用错误的 ABI 进行展开是未定义行为：</p>
<ul>
<li>从通过不带展开的 ABI（如 <code>"C"</code>、<code>"system"</code> 等）声明的函数声明或指针调用的外部函数，引发指向 Rust 代码的展开。（例如，这种情况发生在用 C++ 编写的此类函数抛出未捕获且传播到 Rust 的异常时。）</li>
<li>在不支持展开的代码（例如使用 GCC 或 Clang 并配合 <code>-fno-exceptions</code> 编译的代码）中调用会展开（带有 <code>extern "C-unwind"</code> 或其他允许展开的 ABI）的 Rust <code>extern</code> 函数。</li>
</ul>
<div class="rule" id="r-panic.unwind.ffi.catch-foreign"><a class="rule-link" href="#r-panic.unwind.ffi.catch-foreign" title="panic.unwind.ffi.catch-foreign"><span>[panic<wbr>.unwind<wbr>.ffi<wbr>.catch-foreign]</span></a>
</div>

<p>使用 <a href="../std/panic/fn.catch_unwind.html"><code>std::panic::catch_unwind</code></a>、<a href="../std/thread/join_handle/struct.JoinHandle.html#method.join"><code>std::thread::JoinHandle::join</code></a> 或让外部展开操作传播到 Rust <code>main()</code> 函数或线程根部之外来捕获它（例如 C++ 异常），将产生以下两种行为之一，且未指定具体会发生哪种：</p>
<ul>
<li>进程中止。</li>
<li>函数返回一个包含不透明类型的 <a href="../core/result/enum.Result.html#variant.Err"><code>Result::Err</code></a>。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>就此项保证而言，使用不同的 Rust 标准库实例编译或链接的 Rust 代码算作 “外部异常” 。因此，如果一个使用了 <code>panic!</code> 且链接到一个版本 Rust 标准库的库，被一个使用不同版本标准库的应用程序调用，即使该库仅在子线程中使用，也可能导致整个应用程序中止。</p>
</blockquote>
</div>

<div class="rule" id="r-panic.unwind.ffi.dispose-panic"><a class="rule-link" href="#r-panic.unwind.ffi.dispose-panic" title="panic.unwind.ffi.dispose-panic"><span>[panic<wbr>.unwind<wbr>.ffi<wbr>.dispose-panic]</span></a>
</div>

<p>目前对于外部运行时尝试处理或重新抛出 Rust <code>panic</code> 负载时的行为没有任何保证。换句话说，起源于 Rust 运行时的展开必须要么导致进程终止，要么被同一个运行时捕获。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-link"><a class="rule-link" href="#r-link" title="link"><span>[link]</span></a>
</div>

<h1 id="链接"><a class="header" href="#链接">链接</a></h1>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>本节更多是从编译器而非语言本身的角度进行描述。</p>
</blockquote>
</div>

<div class="rule" id="r-link.intro"><a class="rule-link" href="#r-link.intro" title="link.intro"><span>[link<wbr>.intro]</span></a>
</div>

<p>编译器支持静态和动态链接 crate 的多种方法。本节将探讨链接 crate 的各种方法，有关原生库的更多信息可以在 <a href="https://doc.rust-lang.org/book/ch19-01-unsafe-rust.html#using-extern-functions-to-call-external-code">本书的 FFI 章节</a> 中找到。</p>
<div class="rule" id="r-link.type"><a class="rule-link" href="#r-link.type" title="link.type"><span>[link<wbr>.type]</span></a>
</div>

<p>在一次编译会话中，编译器可以通过使用命令行标志或 <code>crate_type</code> 属性生成多个产物。如果指定了一个或多个命令行标志，则所有的 <code>crate_type</code> 属性都将被忽略，而只构建通过命令行指定的产物。</p>
<div class="rule" id="r-link.bin"><a class="rule-link" href="#r-link.bin" title="link.bin"><span>[link<wbr>.bin]</span></a>
</div>

<ul>
<li><code>--crate-type=bin</code>, <code>#![crate_type = "bin"]</code> - 将生成一个可运行的可执行文件。这要求 crate 中有一个 <code>main</code> 函数，该函数将在程序开始执行时运行。这将链接所有的 Rust 和原生依赖项，生成一个单一的可分发二进制文件。这是默认的 crate 类型。</li>
</ul>
<div class="rule" id="r-link.lib"><a class="rule-link" href="#r-link.lib" title="link.lib"><span>[link<wbr>.lib]</span></a>
</div>

<ul>
<li><code>--crate-type=lib</code>, <code>#![crate_type = "lib"]</code> - 将生成一个 Rust 库。这是一个模棱两可的概念，因为库可以以多种形式表现。这种通用的 <code>lib</code> 选项的目的是生成 “compiler recommended” 风格的库。输出的库始终可以被 rustc 使用，但库的具体类型可能会不时发生变化。其余输出类型都是库的不同变体，<code>lib</code> 类型可以看作是其中之一的别名 (but the actual one is compiler-defined)。</li>
</ul>
<div class="rule" id="r-link.dylib"><a class="rule-link" href="#r-link.dylib" title="link.dylib"><span>[link<wbr>.dylib]</span></a>
</div>

<ul>
<li><code>--crate-type=dylib</code>, <code>#![crate_type = "dylib"]</code> - 将生成一个动态 Rust 库。这与 <code>lib</code> 输出类型的不同之处在于它强制生成动态库。生成的动态库可以用作其他库和/或可执行文件的依赖项。这种输出类型将在 Linux 上创建 <code>*.so</code> 文件，在 macOS 上创建 <code>*.dylib</code> 文件，在 Windows 上创建 <code>*.dll</code> 文件。</li>
</ul>
<div class="rule" id="r-link.staticlib"><a class="rule-link" href="#r-link.staticlib" title="link.staticlib"><span>[link<wbr>.staticlib]</span></a>
</div>

<ul>
<li>
<p><code>--crate-type=staticlib</code>, <code>#![crate_type = "staticlib"]</code> - 将生成一个静态系统库。这与其他库输出的不同之处在于，编译器永远不会尝试链接到 <code>staticlib</code> 输出。这种输出类型的目的是创建一个包含所有本地 crate 代码以及所有上游依赖项的静态库。这种输出类型将在 Linux, macOS 和 Windows (MinGW) 上创建 <code>*.a</code> 文件，并在 Windows (MSVC) 上创建 <code>*.lib</code> 文件。建议在将 Rust 代码链接到现有的非 Rust 应用程序等情况下使用此格式，因为它不会对其他 Rust 代码产生动态依赖。</p>
<p>请注意，静态库可能具有的任何动态依赖项 (such as dependencies on system libraries, or dependencies on Rust libraries that are compiled as dynamic libraries) 在从某处链接该静态库时必须手动指定。 <code>--print=native-static-libs</code> 标志可能对此有所帮助。</p>
<p>请注意，由于生成的静态库包含所有依赖项的代码 (including the standard library) ，并且还导出了它们的所有公共符号，因此将静态库链接到可执行文件或共享库可能需要特别注意。在共享库的情况下，必须通过例如链接器或符号版本脚本、导出符号列表 (macOS) 或模块定义文件 (Windows) 来限制导出符号的列表。此外，可以删除未使用的节，以删除未实际使用的所有依赖项代码 (e.g. <code>--gc-sections</code> or <code>-dead_strip</code> for macOS)。</p>
</li>
</ul>
<div class="rule" id="r-link.cdylib"><a class="rule-link" href="#r-link.cdylib" title="link.cdylib"><span>[link<wbr>.cdylib]</span></a>
</div>

<ul>
<li><code>--crate-type=cdylib</code>, <code>#![crate_type = "cdylib"]</code> - 将生成一个动态系统库。这用于在编译要从另一种语言加载的动态库时使用。这种输出类型将在 Linux 上创建 <code>*.so</code> 文件，在 macOS 上创建 <code>*.dylib</code> 文件，在 Windows 上创建 <code>*.dll</code> 文件。</li>
</ul>
<div class="rule" id="r-link.rlib"><a class="rule-link" href="#r-link.rlib" title="link.rlib"><span>[link<wbr>.rlib]</span></a>
</div>

<ul>
<li><code>--crate-type=rlib</code>, <code>#![crate_type = "rlib"]</code> - 将生成一个 “Rust library” 文件。这用作中间产物，可以被认为是 “static Rust library” 。与 <code>staticlib</code> 文件不同，这些 <code>rlib</code> 文件在未来的链接中由编译器解释。这本质上意味着 <code>rustc</code> 将在 <code>rlib</code> 文件中寻找元数据，就像在动态库中寻找元数据一样。这种输出形式用于生成静态链接的可执行文件以及 <code>staticlib</code> 输出。</li>
</ul>
<div class="rule" id="r-link.proc-macro"><a class="rule-link" href="#r-link.proc-macro" title="link.proc-macro"><span>[link<wbr>.proc-macro]</span></a>
</div>

<ul>
<li><code>--crate-type=proc-macro</code>, <code>#![crate_type = "proc-macro"]</code> - 生成的输出未指定，但如果为其提供了 <code>-L</code> 路径，则编译器会将输出产物识别为宏，并且可以为程序加载它。使用此 crate 类型编译的 crate 只能导出 <a href="#过程宏">过程宏</a>。编译器将自动设置 <code>proc_macro</code> <a href="#条件编译">配置选项</a>。crate 始终使用与编译器本身构建时相同的 target 进行编译。例如，如果您在带有 <code>x86_64</code> CPU 的 Linux 上执行编译器，则 target 将是 <code>x86_64-unknown-linux-gnu</code>，即使该 crate 是为不同 target 构建的另一个 crate 的依赖项。</li>
</ul>
<div class="rule" id="r-link.repetition"><a class="rule-link" href="#r-link.repetition" title="link.repetition"><span>[link<wbr>.repetition]</span></a>
</div>

<p>请注意，这些输出是可堆叠的，即如果指定了多个，则编译器将生成每种形式的输出，而无需重新编译。但是，这仅适用于通过相同方法指定的输出。如果仅指定了 <code>crate_type</code> 属性，则它们都将被构建，但如果指定了一个或多个 <code>--crate-type</code> 命令行标志，则仅构建那些输出。</p>
<div class="rule" id="r-link.dependency"><a class="rule-link" href="#r-link.dependency" title="link.dependency"><span>[link<wbr>.dependency]</span></a>
</div>

<p>对于所有这些不同种类的输出，如果 crate A 依赖于 crate B，则编译器可能会在整个系统中找到各种不同形式的 B。然而，编译器寻找的唯一形式是 <code>rlib</code> 格式和动态库格式。对于依赖库的这两个选项，编译器必须在某个时间点在两种格式之间做出选择。考虑到这一点，编译器在确定将使用哪种格式的依赖项时遵循以下规则：</p>
<div class="rule" id="r-link.dependency-staticlib"><a class="rule-link" href="#r-link.dependency-staticlib" title="link.dependency-staticlib"><span>[link<wbr>.dependency-staticlib]</span></a>
</div>

<ol>
<li>
<p>如果正在生成静态库，则要求所有上游依赖项都必须以 <code>rlib</code> 格式可用。这一要求源于动态库无法转换为静态格式的原因。</p>
<p>请注意，无法将原生动态依赖项链接到静态库，在这种情况下，将打印有关所有未链接的原生动态依赖项的警告。</p>
</li>
</ol>
<div class="rule" id="r-link.dependency-rlib"><a class="rule-link" href="#r-link.dependency-rlib" title="link.dependency-rlib"><span>[link<wbr>.dependency-rlib]</span></a>
</div>

<ol start="2">
<li>
<p>如果正在生成 <code>rlib</code> 文件，则对上游依赖项可用的格式没有限制。仅要求所有上游依赖项都可用于读取元数据。</p>
<p>这是因为 <code>rlib</code> 文件不包含其任何上游依赖项。让所有 <code>rlib</code> 文件都包含 <code>libstd.rlib</code> 的副本是非常低效的！</p>
</li>
</ol>
<div class="rule" id="r-link.dependency-prefer-dynamic"><a class="rule-link" href="#r-link.dependency-prefer-dynamic" title="link.dependency-prefer-dynamic"><span>[link<wbr>.dependency-prefer-dynamic]</span></a>
</div>

<ol start="3">
<li>如果正在生成可执行文件且未指定 <code>-C prefer-dynamic</code> 标志，则首先尝试寻找 <code>rlib</code> 格式的依赖项。如果某些依赖项在 rlib 格式下不可用，则尝试动态链接 (see below)。</li>
</ol>
<div class="rule" id="r-link.dependency-dynamic"><a class="rule-link" href="#r-link.dependency-dynamic" title="link.dependency-dynamic"><span>[link<wbr>.dependency-dynamic]</span></a>
</div>

<ol start="4">
<li>
<p>如果正在生成动态库或正在动态链接的可执行文件，则编译器将尝试协调以 rlib 或 dylib 格式提供的依赖项，以创建最终产品。</p>
<p>编译器的主要目标是确保一个库在任何产物中都不会出现超过一次。例如，如果动态库 B 和 C 都静态链接到库 A，那么一个 crate 就不能同时链接到 B 和 C，因为那样就会有两个 A 的副本。编译器允许混合 rlib 和 dylib 格式，但必须满足这一限制。</p>
<p>编译器目前没有提供暗示库应以何种格式链接的方法。在动态链接时，编译器将尝试最大化动态依赖项，同时仍允许通过 rlib 链接一些依赖项。</p>
<p>对于大多数情况，如果进行动态链接，建议所有库都以 dylib 形式可用。对于其他情况，如果编译器无法确定每个库应以哪种格式链接，它将发出警告。</p>
</li>
</ol>
<p>通常，对于所有编译需求，<code>--crate-type=bin</code> 或 <code>--crate-type=lib</code> 应该就足够了，其他选项仅在需要对 crate 输出格式进行更精细控制时可用。</p>
<div class="rule" id="r-link.crt"><a class="rule-link" href="#r-link.crt" title="link.crt"><span>[link<wbr>.crt]</span></a>
</div>

<h2 id="静态和动态c运行时"><a class="header" href="#静态和动态c运行时">静态和动态C运行时</a></h2>
<div class="rule" id="r-link.crt.intro"><a class="rule-link" href="#r-link.crt.intro" title="link.crt.intro"><span>[link<wbr>.crt<wbr>.intro]</span></a>
</div>

<p>标准库通常力求根据需要为 target 支持静态链接和动态链接的 C 运行时。例如 <code>x86_64-pc-windows-msvc</code> 和 <code>x86_64-unknown-linux-musl</code> target 通常带有两种运行时，用户可以选择他们喜欢的。编译器中的所有 target 都有链接到 C 运行时的默认模式。通常 target 默认是动态链接的，但也有些例外是默认静态链接的，例如：</p>
<ul>
<li><code>arm-unknown-linux-musleabi</code></li>
<li><code>arm-unknown-linux-musleabihf</code></li>
<li><code>armv7-unknown-linux-musleabihf</code></li>
<li><code>i686-unknown-linux-musl</code></li>
<li><code>x86_64-unknown-linux-musl</code></li>
</ul>
<div class="rule" id="r-link.crt.crt-static"><a class="rule-link" href="#r-link.crt.crt-static" title="link.crt.crt-static"><span>[link<wbr>.crt<wbr>.crt-static]</span></a>
</div>

<p>C 运行时的链接配置为遵循 <code>crt-static</code> target 特性。这些 target 特性通常在命令行中通过编译器的标志进行配置。例如，要启用静态运行时，您可以执行：</p>
<pre><code class="language-sh">rustc -C target-feature=+crt-static foo.rs
</code></pre>
<p>而要动态链接到 C 运行时，您可以执行：</p>
<pre><code class="language-sh">rustc -C target-feature=-crt-static foo.rs
</code></pre>
<div class="rule" id="r-link.crt.ineffective"><a class="rule-link" href="#r-link.crt.ineffective" title="link.crt.ineffective"><span>[link<wbr>.crt<wbr>.ineffective]</span></a>
</div>

<p>不支持在 C 运行时链接方式之间切换的 target 将忽略此标志。建议在编译器成功后检查生成的二进制文件，以确保它按预期链接。</p>
<div class="rule" id="r-link.crt.target_feature"><a class="rule-link" href="#r-link.crt.target_feature" title="link.crt.target_feature"><span>[link<wbr>.crt<wbr>.target_feature]</span></a>
</div>

<p>crate 也可以了解 C 运行时是如何被链接的。例如，MSVC 上的代码需要根据链接的运行时进行不同的编译 (e.g. with <code>/MT</code> or <code>/MD</code>) 。这目前通过 <a href="#target_feature"><code>cfg</code> 属性 <code>target_feature</code> 选项</a> 导出：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[cfg(target_feature = "crt-static")]
fn foo() {
    println!("the C runtime should be statically linked");
}

#[cfg(not(target_feature = "crt-static"))]
fn foo() {
    println!("the C runtime should be dynamically linked");
}
<span class="boring">}</span></code></pre>
<p>另请注意，Cargo 构建脚本可以通过 <a href="../cargo/reference/environment-variables.html#environment-variables-cargo-sets-for-build-scripts">环境变量</a> 了解此特性。在构建脚本中，您可以通过以下方式检测链接：</p>
<pre class="playground"><code class="language-rust edition2024">use std::env;

fn main() {
    let linkage = env::var("CARGO_CFG_TARGET_FEATURE").unwrap_or(String::new());

    if linkage.contains("crt-static") {
        println!("the C runtime will be statically linked");
    } else {
        println!("the C runtime will be dynamically linked");
    }
}</code></pre>
<p>要在本地使用此特性，您通常会使用 <code>RUSTFLAGS</code> 环境变量通过 Cargo 为编译器指定标志。例如，要在 MSVC 上编译静态链接的二进制文件，您可以执行：</p>
<pre><code class="language-sh">RUSTFLAGS='-C target-feature=+crt-static' cargo build --target x86_64-pc-windows-msvc
</code></pre>
<div class="rule" id="r-link.foreign-code"><a class="rule-link" href="#r-link.foreign-code" title="link.foreign-code"><span>[link<wbr>.foreign-code]</span></a>
</div>

<h2 id="混合rust和外部代码库"><a class="header" href="#混合rust和外部代码库">混合Rust和外部代码库</a></h2>
<div class="rule" id="r-link.foreign-code.foreign-linkers"><a class="rule-link" href="#r-link.foreign-code.foreign-linkers" title="link.foreign-code.foreign-linkers"><span>[link<wbr>.foreign-code<wbr>.foreign-linkers]</span></a>
</div>

<p>如果您混合使用 Rust 和外部代码 (e.g. C, C++) 并希望制作包含两种代码类型的单个二进制文件，则最终二进制链接有两种方法：</p>
<ul>
<li>使用 <code>rustc</code>。使用 <code>rustc</code> 参数 <code>-L &lt;directory&gt;</code> 和 <code>-l&lt;library&gt;</code> 传递任何非 Rust 库，和/或在 Rust 代码中使用 <code>#[link]</code> 指令。如果您需要链接 <code>*.o</code> 文件，可以使用 <code>-Clink-arg=file.o</code>。</li>
<li>使用您的外部链接器。在这种情况下，您首先需要生成一个 Rust <code>staticlib</code> target 并将其传递给您的外部链接器调用。如果您需要链接多个 Rust 子系统，您将需要生成一个 <em>单个</em> <code>staticlib</code>，可能需要使用大量的 <code>extern crate</code> 语句来包含多个 Rust <code>rlib</code>。多个 Rust <code>staticlib</code> 文件很可能会冲突。</li>
</ul>
<p>目前不支持将 <code>rlib</code> 直接传递到您的外部链接器中。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>对于本节而言，使用不同的 Rust 运行时实例编译或链接的 Rust 代码也算作 “foreign code” 。</p>
</blockquote>
</div>

<div class="rule" id="r-link.unwinding"><a class="rule-link" href="#r-link.unwinding" title="link.unwinding"><span>[link<wbr>.unwinding]</span></a>
</div>

<h3 id="禁止的链接和恐慌展开"><a class="header" href="#禁止的链接和恐慌展开">禁止的链接和恐慌展开</a></h3>
<div class="rule" id="r-link.unwinding.intro"><a class="rule-link" href="#r-link.unwinding.intro" title="link.unwinding.intro"><span>[link<wbr>.unwinding<wbr>.intro]</span></a>
</div>

<p>仅当二进制文件根据以下规则一致地构建时，才能使用恐慌展开。</p>
<div class="rule" id="r-link.unwinding.potential"><a class="rule-link" href="#r-link.unwinding.potential" title="link.unwinding.potential"><span>[link<wbr>.unwinding<wbr>.potential]</span></a>
</div>

<p>如果满足以下任何条件，则 Rust 产物被称为 <em>潜在展开的</em> ：</p>
<ul>
<li>该产物使用 <a href="#r-panic.panic_handler"><code>unwind</code> 恐慌处理器</a>。</li>
<li>该产物包含一个使用 <code>unwind</code> <a href="#恐慌策略">恐慌策略</a> 构建的 crate，该 crate 使用 <code>-unwind</code> ABI 调用函数。</li>
<li>该产物对在另一个拥有独立的 Rust 运行时副本的 Rust 产物中运行的代码进行 “Rust” ABI 调用，并且该另一个产物是潜在展开的。</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>此定义涵盖了 Rust 产物内部的 “Rust” ABI 调用是否会发生展开。</p>
</blockquote>
</div>

<div class="rule" id="r-link.unwinding.prohibited"><a class="rule-link" href="#r-link.unwinding.prohibited" title="link.unwinding.prohibited"><span>[link<wbr>.unwinding<wbr>.prohibited]</span></a>
</div>

<p>如果一个 Rust 产物是潜在展开的，那么它的所有 crate 都必须使用 <code>unwind</code> <a href="#恐慌策略">恐慌策略</a> 构建。否则，展开可能会导致未定义行为。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>如果您使用 <code>rustc</code> 进行链接，这些规则会自动执行。如果您 <em>不</em> 使用 <code>rustc</code> 进行链接，则必须注意确保在整个二进制文件中一致地处理展开。不使用 <code>rustc</code> 链接包括使用 <code>dlopen</code> 或类似设施，其中链接由系统运行时完成，而不涉及 <code>rustc</code>。这种情况仅在混合使用具有不同 <a href="https://doc.rust-lang.org/rustc/codegen-options/index.html#panic"><code>-C panic</code></a> 标志的代码时才会发生，因此大多数用户无需担心这一点。</p>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>为了保证无论链接时使用何种恐慌运行时，库都是健全的 (and linkable with <code>rustc</code>) ，可以使用 <a href="https://doc.rust-lang.org/rustc/lints/listing/allowed-by-default.html#ffi-unwind-calls"><code>ffi_unwind_calls</code> lint</a> 。该 lint 会标记对 <code>-unwind</code> 外部函数或函数指针的任何调用。</p>
</blockquote>
</div>

<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-asm"><a class="rule-link" href="#r-asm" title="asm"><span>[asm]</span></a>
</div>

<h1 id="内联汇编"><a class="header" href="#内联汇编">内联汇编</a></h1>
<div class="rule" id="r-asm.intro"><a class="rule-link" href="#r-asm.intro" title="asm.intro"><span>[asm<wbr>.intro]</span></a>
</div>

<p>通过 <a href="../core/arch/macro.asm.html"><code>asm!</code></a>、<a href="../core/arch/macro.naked_asm.html"><code>naked_asm!</code></a> 和 <a href="../core/arch/macro.global_asm.html"><code>global_asm!</code></a> 宏提供对内联汇编的支持。它可以用于在编译器生成的汇编输出中嵌入手写的汇编代码。</p>
<div class="rule" id="r-asm.stable-targets"><a class="rule-link" href="#r-asm.stable-targets" title="asm.stable-targets"><span>[asm<wbr>.stable-targets]</span></a>
</div>

<p>内联汇编支持在以下架构上是稳定的：</p>
<ul>
<li>x86 和 x86-64</li>
<li>ARM</li>
<li>AArch64 和 Arm64EC</li>
<li>RISC-V</li>
<li>LoongArch</li>
<li>s390x</li>
</ul>
<p>如果在不支持的 target 上使用汇编宏，编译器将报错。</p>
<div class="rule" id="r-asm.example"><a class="rule-link" href="#r-asm.example" title="asm.example"><span>[asm<wbr>.example]</span></a>
</div>

<h2 id="示例-6"><a class="header" href="#示例-6">示例</a></h2>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>use std::arch::asm;

// 使用移位和加法将 x 乘以 6
let mut x: u64 = 4;
unsafe {
    asm!(
        "mov {tmp}, {x}",
        "shl {tmp}, 1",
        "shl {x}, 2",
        "add {x}, {tmp}",
        x = inout(reg) x,
        tmp = out(reg) _,
    );
}
assert_eq!(x, 4 * 6);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.syntax"><a class="rule-link" href="#r-asm.syntax" title="asm.syntax"><span>[asm<wbr>.syntax]</span></a>
</div>

<h2 id="语法格式"><a class="header" href="#语法格式">语法格式</a></h2>
<p>下面的语法指定了可以传递给 <code>asm!</code>、<code>global_asm!</code> 和 <code>naked_asm!</code> 宏的参数。</p>
<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-AsmArgs" onclick="show_railroad()"><a href="#railroad-AsmArgs">AsmArgs</a></span> → <span class="grammar-text"><a href="#grammar-AsmAttrFormatString">AsmAttrFormatString</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-AsmAttrFormatString">AsmAttrFormatString</a></span> )<sup>*</sup> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-AsmAttrOperand">AsmAttrOperand</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-FormatString" onclick="show_railroad()"><a href="#railroad-FormatString">FormatString</a></span> → <span class="grammar-text"><a href="#grammar-STRING_LITERAL">STRING_LITERAL</a></span> | <span class="grammar-text"><a href="#grammar-RAW_STRING_LITERAL">RAW_STRING_LITERAL</a></span> | <span class="grammar-text"><a href="#grammar-MacroInvocation">MacroInvocation</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-AsmAttrFormatString" onclick="show_railroad()"><a href="#railroad-AsmAttrFormatString">AsmAttrFormatString</a></span> → ( <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span> )<sup>*</sup> <span class="grammar-text"><a href="#grammar-FormatString">FormatString</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-AsmOperand" onclick="show_railroad()"><a href="#railroad-AsmOperand">AsmOperand</a></span> → <br>      <span class="grammar-text"><a href="#grammar-ClobberAbi">ClobberAbi</a></span> <br>    | <span class="grammar-text"><a href="#grammar-AsmOptions">AsmOptions</a></span> <br>    | <span class="grammar-text"><a href="#grammar-RegOperand">RegOperand</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-AsmAttrOperand" onclick="show_railroad()"><a href="#railroad-AsmAttrOperand">AsmAttrOperand</a></span> → ( <span class="grammar-text"><a href="#grammar-OuterAttribute">OuterAttribute</a></span> )<sup>*</sup> <span class="grammar-text"><a href="#grammar-AsmOperand">AsmOperand</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-ClobberAbi" onclick="show_railroad()"><a href="#railroad-ClobberAbi">ClobberAbi</a></span> → <span class="grammar-literal">clobber_abi</span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-Abi">Abi</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-Abi">Abi</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-AsmOptions" onclick="show_railroad()"><a href="#railroad-AsmOptions">AsmOptions</a></span> → <br>    <span class="grammar-literal">options</span> <span class="grammar-literal">(</span> ( <span class="grammar-text"><a href="#grammar-AsmOption">AsmOption</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="#grammar-AsmOption">AsmOption</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup> )<sup>?</sup> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-AsmOption" onclick="show_railroad()"><a href="#railroad-AsmOption">AsmOption</a></span> → <br>      <span class="grammar-literal">pure</span> <br>    | <span class="grammar-literal">nomem</span> <br>    | <span class="grammar-literal">readonly</span> <br>    | <span class="grammar-literal">preserves_flags</span> <br>    | <span class="grammar-literal">noreturn</span> <br>    | <span class="grammar-literal">nostack</span> <br>    | <span class="grammar-literal">att_syntax</span> <br>    | <span class="grammar-literal">raw</span></p>
<p><span class="grammar-text grammar-production" id="grammar-RegOperand" onclick="show_railroad()"><a href="#railroad-RegOperand">RegOperand</a></span> → ( <span class="grammar-text"><a href="#grammar-ParamName">ParamName</a></span> <span class="grammar-literal">=</span> )<sup>?</sup> <br>    ( <br>          <span class="grammar-text"><a href="#grammar-DirSpec">DirSpec</a></span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-RegSpec">RegSpec</a></span> <span class="grammar-literal">)</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>        | <span class="grammar-text"><a href="#grammar-DualDirSpec">DualDirSpec</a></span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="#grammar-RegSpec">RegSpec</a></span> <span class="grammar-literal">)</span> <span class="grammar-text"><a href="#grammar-DualDirSpecExpression">DualDirSpecExpression</a></span> <br>        | <span class="grammar-literal">sym</span> <span class="grammar-text"><a href="#grammar-PathExpression">PathExpression</a></span> <br>        | <span class="grammar-literal">const</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>        | <span class="grammar-literal">label</span> <span class="grammar-literal">{</span> <span class="grammar-text"><a href="#grammar-Statements">Statements</a></span><sup>?</sup> <span class="grammar-literal">}</span> <br>    )</p>
<p><span class="grammar-text grammar-production" id="grammar-ParamName" onclick="show_railroad()"><a href="#railroad-ParamName">ParamName</a></span> → <span class="grammar-text"><a href="#grammar-IDENTIFIER_OR_KEYWORD">IDENTIFIER_OR_KEYWORD</a></span> | <span class="grammar-text"><a href="#grammar-RAW_IDENTIFIER">RAW_IDENTIFIER</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-DualDirSpecExpression" onclick="show_railroad()"><a href="#railroad-DualDirSpecExpression">DualDirSpecExpression</a></span> → <br>      <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span> <span class="grammar-literal">=&gt;</span> <span class="grammar-text"><a href="#grammar-Expression">Expression</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-RegSpec" onclick="show_railroad()"><a href="#railroad-RegSpec">RegSpec</a></span> → <span class="grammar-text"><a href="#grammar-RegisterClass">RegisterClass</a></span> | <span class="grammar-text"><a href="#grammar-ExplicitRegister">ExplicitRegister</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-RegisterClass" onclick="show_railroad()"><a href="#railroad-RegisterClass">RegisterClass</a></span> → <span class="grammar-text"><a href="#grammar-IDENTIFIER_OR_KEYWORD">IDENTIFIER_OR_KEYWORD</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-ExplicitRegister" onclick="show_railroad()"><a href="#railroad-ExplicitRegister">ExplicitRegister</a></span> → <span class="grammar-text"><a href="#grammar-STRING_LITERAL">STRING_LITERAL</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-DirSpec" onclick="show_railroad()"><a href="#railroad-DirSpec">DirSpec</a></span> → <br>      <span class="grammar-literal">in</span> <br>    | <span class="grammar-literal">out</span> <br>    | <span class="grammar-literal">lateout</span></p>
<p><span class="grammar-text grammar-production" id="grammar-DualDirSpec" onclick="show_railroad()"><a href="#railroad-DualDirSpec">DualDirSpec</a></span> → <br>      <span class="grammar-literal">inout</span> <br>    | <span class="grammar-literal">inlateout</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 872px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-AsmArgs"><svg class="railroad" viewbox="0 0 872 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-AsmArgs">
<text class="comment" x="39" y="25">
AsmArgs</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="#railroad-AsmAttrFormatString">
<g class="nonterminal">
<rect height="22" width="172" x="35" y="55" />
<text x="121" y="71">
AsmAttrFormatString</text>
</g>
</a>
<g class="optional">
<path d=" M 217 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 234 m -114 0 l -5 -5 m 0 10 l 5 -5 m 114 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 241 66 h 12 m 210 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -210 m 108 0 l 5 -5 m 0 10 l -5 -5 m -108 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="253" y="55" />
<text x="267" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-AsmAttrFormatString">
<g class="nonterminal">
<rect height="22" width="172" x="291" y="55" />
<text x="377" y="71">
AsmAttrFormatString</text>
</g>
</a>
<path d=" M 281 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 509 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 194 m -94 0 l -5 -5 m 0 10 l 5 -5 m 94 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 533 66 h 12 m 170 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -170 m 88 0 l 5 -5 m 0 10 l -5 -5 m -88 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="545" y="55" />
<text x="559" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-AsmAttrOperand">
<g class="nonterminal">
<rect height="22" width="132" x="583" y="55" />
<text x="649" y="71">
AsmAttrOperand</text>
</g>
</a>
<path d=" M 573 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 761 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="785" y="55" />
<text x="799" y="71">
,</text>
</g>
</g>
<path d=" M 207 66 h 10" />
<path d=" M 499 66 h 10" />
<path d=" M 751 66 h 10" />
</g>
<path d=" M 847 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 837 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 282px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-FormatString"><svg class="railroad" viewbox="0 0 282 140" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-FormatString">
<text class="comment" x="57" y="25">
FormatString</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 132 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0" />
<a class="link" xlink:href="#railroad-STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="132" x="59" y="42" />
<text x="125" y="58">
STRING_LITERAL</text>
</g>
</a>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 188 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 188 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 164 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-RAW_STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="164" x="59" y="75" />
<text x="141" y="91">
RAW_STRING_LITERAL</text>
</g>
</a>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 140 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-MacroInvocation">
<g class="nonterminal">
<rect height="22" width="140" x="59" y="108" />
<text x="129" y="124">
MacroInvocation</text>
</g>
</a>
</g>
<path d=" M 257 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 247 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 400px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-AsmAttrFormatString"><svg class="railroad" viewbox="0 0 400 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-AsmAttrFormatString">
<text class="comment" x="81" y="25">
AsmAttrFormatString</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<a class="link" xlink:href="#railroad-FormatString">
<g class="nonterminal">
<rect height="22" width="116" x="249" y="55" />
<text x="307" y="71">
FormatString</text>
</g>
</a>
<path d=" M 239 66 h 10" />
</g>
<path d=" M 375 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 365 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 218px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-AsmOperand"><svg class="railroad" viewbox="0 0 218 140" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-AsmOperand">
<text class="comment" x="50" y="25">
AsmOperand</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 100 0 h 24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ClobberAbi">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="42" />
<text x="109" y="58">
ClobberAbi</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 124 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 124 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 100 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-AsmOptions">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="75" />
<text x="109" y="91">
AsmOptions</text>
</g>
</a>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 100 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-RegOperand">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="108" />
<text x="109" y="124">
RegOperand</text>
</g>
</a>
</g>
<path d=" M 193 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 183 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 384px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-AsmAttrOperand"><svg class="railroad" viewbox="0 0 384 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-AsmAttrOperand">
<text class="comment" x="64" y="25">
AsmAttrOperand</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<a class="link" xlink:href="#railroad-AsmOperand">
<g class="nonterminal">
<rect height="22" width="100" x="249" y="55" />
<text x="299" y="71">
AsmOperand</text>
</g>
</a>
<path d=" M 239 66 h 10" />
</g>
<path d=" M 359 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 349 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 558px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ClobberAbi"><svg class="railroad" viewbox="0 0 558 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ClobberAbi">
<text class="comment" x="50" y="25">
ClobberAbi</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="108" x="35" y="55" />
<text x="89" y="71">
clobber_abi</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="153" y="55" />
<text x="167" y="71">
(</text>
</g>
<a class="link" xlink:href="#railroad-Abi">
<g class="nonterminal">
<rect height="22" width="44" x="191" y="55" />
<text x="213" y="71">
Abi</text>
</g>
</a>
<g class="optional">
<path d=" M 245 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 106 m -50 0 l -5 -5 m 0 10 l 5 -5 m 50 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 269 66 h 12 m 82 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -82 m 44 0 l 5 -5 m 0 10 l -5 -5 m -44 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="281" y="55" />
<text x="295" y="71">
,</text>
</g>
<a class="link" xlink:href="#railroad-Abi">
<g class="nonterminal">
<rect height="22" width="44" x="319" y="55" />
<text x="341" y="71">
Abi</text>
</g>
</a>
<path d=" M 309 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 409 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="433" y="55" />
<text x="447" y="71">
,</text>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="495" y="55" />
<text x="509" y="71">
)</text>
</g>
<path d=" M 143 66 h 10" />
<path d=" M 181 66 h 10" />
<path d=" M 235 66 h 10" />
<path d=" M 399 66 h 10" />
<path d=" M 485 66 h 10" />
</g>
<path d=" M 533 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 523 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 670px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-AsmOptions"><svg class="railroad" viewbox="0 0 670 112" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-AsmOptions">
<text class="comment" x="50" y="25">
AsmOptions</text>
</a>
<g class="sequence">
<path d=" M 10 78 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="76" x="35" y="67" />
<text x="73" y="83">
options</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="121" y="67" />
<text x="135" y="83">
(</text>
</g>
<g class="optional">
<path d=" M 159 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -12 a 12 12 0 0 1 12 -12 h 390 m -192 0 l -5 -5 m 0 10 l 5 -5 m 192 0 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-AsmOption">
<g class="nonterminal">
<rect height="22" width="92" x="183" y="67" />
<text x="229" y="83">
AsmOption</text>
</g>
</a>
<g class="optional">
<path d=" M 285 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 154 m -74 0 l -5 -5 m 0 10 l 5 -5 m 74 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 309 78 h 12 m 130 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -130 m 68 0 l 5 -5 m 0 10 l -5 -5 m -68 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="321" y="67" />
<text x="335" y="83">
,</text>
</g>
<a class="link" xlink:href="#railroad-AsmOption">
<g class="nonterminal">
<rect height="22" width="92" x="359" y="67" />
<text x="405" y="83">
AsmOption</text>
</g>
</a>
<path d=" M 349 78 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 497 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="521" y="67" />
<text x="535" y="83">
,</text>
</g>
</g>
<path d=" M 275 78 h 10" />
<path d=" M 487 78 h 10" />
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="607" y="67" />
<text x="621" y="83">
)</text>
</g>
<path d=" M 111 78 h 10" />
<path d=" M 149 78 h 10" />
<path d=" M 597 78 h 10" />
</g>
<path d=" M 645 78 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 78 h 10" />
<path d=" M 635 78 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 258px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-AsmOption"><svg class="railroad" viewbox="0 0 258 305" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-AsmOption">
<text class="comment" x="46" y="25">
AsmOption</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 52 0 h 112 m -53 0 l -5 -5 m 0 10 l 5 -5 m 53 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="42" />
<text x="85" y="58">
pure</text>
</g>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 164 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 164 0 v -33" />
<path d=" M 47 107 v 33 m 164 0 v -33" />
<path d=" M 47 140 v 33 m 164 0 v -33" />
<path d=" M 47 173 v 33 m 164 0 v -33" />
<path d=" M 47 206 v 33 m 164 0 v -33" />
<path d=" M 47 239 v 33 m 164 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 60 0 h 80 m -37 0 l -5 -5 m 0 10 l 5 -5 m 37 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="59" y="75" />
<text x="89" y="91">
nomem</text>
</g>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 84 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="84" x="59" y="108" />
<text x="101" y="124">
readonly</text>
</g>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 140 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="140" x="59" y="141" />
<text x="129" y="157">
preserves_flags</text>
</g>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 84 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="84" x="59" y="174" />
<text x="101" y="190">
noreturn</text>
</g>
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 76 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="76" x="59" y="207" />
<text x="97" y="223">
nostack</text>
</g>
</g>
<path d=" M 47 239 v 0 a 12 12 0 0 0 12 12 m 100 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="100" x="59" y="240" />
<text x="109" y="256">
att_syntax</text>
</g>
</g>
<path d=" M 47 272 v 0 a 12 12 0 0 0 12 12 m 44 0 h 96 m -45 0 l -5 -5 m 0 10 l 5 -5 m 45 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="273" />
<text x="81" y="289">
raw</text>
</g>
</g>
<path d=" M 233 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 223 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 782px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RegOperand"><svg class="railroad" viewbox="0 0 782 231" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RegOperand">
<text class="comment" x="50" y="25">
RegOperand</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 130 m -62 0 l -5 -5 m 0 10 l 5 -5 m 62 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<a class="link" xlink:href="#railroad-ParamName">
<g class="nonterminal">
<rect height="22" width="92" x="59" y="55" />
<text x="105" y="71">
ParamName</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="161" y="55" />
<text x="175" y="71">
=</text>
</g>
<path d=" M 151 66 h 10" />
</g>
</g>
<g class="choice">
<path d=" M 223 66 h 24 m 348 0 h 152 m -73 0 l -5 -5 m 0 10 l 5 -5 m 73 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-DirSpec">
<g class="nonterminal">
<rect height="22" width="76" x="247" y="55" />
<text x="285" y="71">
DirSpec</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="333" y="55" />
<text x="347" y="71">
(</text>
</g>
<a class="link" xlink:href="#railroad-RegSpec">
<g class="nonterminal">
<rect height="22" width="76" x="371" y="55" />
<text x="409" y="71">
RegSpec</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="457" y="55" />
<text x="471" y="71">
)</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="495" y="55" />
<text x="545" y="71">
Expression</text>
</g>
</a>
<path d=" M 323 66 h 10" />
<path d=" M 361 66 h 10" />
<path d=" M 447 66 h 10" />
<path d=" M 485 66 h 10" />
</g>
<path d=" M 223 66 a 12 12 0 0 1 12 12 v 9 m 500 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 235 87 v 33 m 500 0 v -33" />
<path d=" M 235 120 v 33 m 500 0 v -33" />
<path d=" M 235 153 v 33 m 500 0 v -33" />
<path d=" M 235 87 v 0 a 12 12 0 0 0 12 12 m 476 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-DualDirSpec">
<g class="nonterminal">
<rect height="22" width="108" x="247" y="88" />
<text x="301" y="104">
DualDirSpec</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="365" y="88" />
<text x="379" y="104">
(</text>
</g>
<a class="link" xlink:href="#railroad-RegSpec">
<g class="nonterminal">
<rect height="22" width="76" x="403" y="88" />
<text x="441" y="104">
RegSpec</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="489" y="88" />
<text x="503" y="104">
)</text>
</g>
<a class="link" xlink:href="#railroad-DualDirSpecExpression">
<g class="nonterminal">
<rect height="22" width="196" x="527" y="88" />
<text x="625" y="104">
DualDirSpecExpression</text>
</g>
</a>
<path d=" M 355 99 h 10" />
<path d=" M 393 99 h 10" />
<path d=" M 479 99 h 10" />
<path d=" M 517 99 h 10" />
</g>
<path d=" M 235 120 v 0 a 12 12 0 0 0 12 12 m 186 0 h 290 m -142 0 l -5 -5 m 0 10 l 5 -5 m 142 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="247" y="121" />
<text x="269" y="137">
sym</text>
</g>
<a class="link" xlink:href="#railroad-PathExpression">
<g class="nonterminal">
<rect height="22" width="132" x="301" y="121" />
<text x="367" y="137">
PathExpression</text>
</g>
</a>
<path d=" M 291 132 h 10" />
</g>
<path d=" M 235 153 v 0 a 12 12 0 0 0 12 12 m 170 0 h 306 m -150 0 l -5 -5 m 0 10 l 5 -5 m 150 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="247" y="154" />
<text x="277" y="170">
const</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="317" y="154" />
<text x="367" y="170">
Expression</text>
</g>
</a>
<path d=" M 307 165 h 10" />
</g>
<path d=" M 235 186 v 12 a 12 12 0 0 0 12 12 m 294 0 h 182 m -88 0 l -5 -5 m 0 10 l 5 -5 m 88 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="247" y="199" />
<text x="277" y="215">
label</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="317" y="199" />
<text x="331" y="215">
{</text>
</g>
<g class="optional">
<path d=" M 355 210 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="#railroad-Statements">
<g class="nonterminal">
<rect height="22" width="100" x="379" y="199" />
<text x="429" y="215">
Statements</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="513" y="199" />
<text x="527" y="215">
}</text>
</g>
<path d=" M 307 210 h 10" />
<path d=" M 345 210 h 10" />
<path d=" M 503 210 h 10" />
</g>
</g>
<path d=" M 213 66 h 10" />
</g>
<path d=" M 757 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 747 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 314px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ParamName"><svg class="railroad" viewbox="0 0 314 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ParamName">
<text class="comment" x="46" y="25">
ParamName</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 196 0 h 24" />
<a class="link" xlink:href="#railroad-IDENTIFIER_OR_KEYWORD">
<g class="nonterminal">
<rect height="22" width="196" x="59" y="42" />
<text x="157" y="58">
IDENTIFIER_OR_KEYWORD</text>
</g>
</a>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 220 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 132 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-RAW_IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="132" x="59" y="75" />
<text x="125" y="91">
RAW_IDENTIFIER</text>
</g>
</a>
</g>
<path d=" M 289 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 279 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 374px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-DualDirSpecExpression"><svg class="railroad" viewbox="0 0 374 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-DualDirSpecExpression">
<text class="comment" x="92" y="25">
DualDirSpecExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 100 0 h 180 m -87 0 l -5 -5 m 0 10 l 5 -5 m 87 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="42" />
<text x="109" y="58">
Expression</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 280 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 256 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="75" />
<text x="109" y="91">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="169" y="75" />
<text x="187" y="91">
=&gt;</text>
</g>
<a class="link" xlink:href="#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="215" y="75" />
<text x="265" y="91">
Expression</text>
</g>
</a>
<path d=" M 159 86 h 10" />
<path d=" M 205 86 h 10" />
</g>
</g>
<path d=" M 349 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 339 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 266px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RegSpec"><svg class="railroad" viewbox="0 0 266 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RegSpec">
<text class="comment" x="39" y="25">
RegSpec</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 124 0 h 48" />
<a class="link" xlink:href="#railroad-RegisterClass">
<g class="nonterminal">
<rect height="22" width="124" x="59" y="42" />
<text x="121" y="58">
RegisterClass</text>
</g>
</a>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 172 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 148 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="#railroad-ExplicitRegister">
<g class="nonterminal">
<rect height="22" width="148" x="59" y="75" />
<text x="133" y="91">
ExplicitRegister</text>
</g>
</a>
</g>
<path d=" M 241 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 231 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 266px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RegisterClass"><svg class="railroad" viewbox="0 0 266 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-RegisterClass">
<text class="comment" x="60" y="25">
RegisterClass</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<a class="link" xlink:href="#railroad-IDENTIFIER_OR_KEYWORD">
<g class="nonterminal">
<rect height="22" width="196" x="35" y="42" />
<text x="133" y="58">
IDENTIFIER_OR_KEYWORD</text>
</g>
</a>
<path d=" M 241 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 231 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 202px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ExplicitRegister"><svg class="railroad" viewbox="0 0 202 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-ExplicitRegister">
<text class="comment" x="71" y="25">
ExplicitRegister</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<a class="link" xlink:href="#railroad-STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="132" x="35" y="42" />
<text x="101" y="58">
STRING_LITERAL</text>
</g>
</a>
<path d=" M 177 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 167 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 194px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-DirSpec"><svg class="railroad" viewbox="0 0 194 140" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-DirSpec">
<text class="comment" x="39" y="25">
DirSpec</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 36 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="42" />
<text x="77" y="58">
in</text>
</g>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 100 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 100 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 44 0 h 32 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="75" />
<text x="81" y="91">
out</text>
</g>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 76 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="76" x="59" y="108" />
<text x="97" y="124">
lateout</text>
</g>
</g>
<path d=" M 169 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 159 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 210px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-DualDirSpec"><svg class="railroad" viewbox="0 0 210 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="#grammar-DualDirSpec">
<text class="comment" x="53" y="25">
DualDirSpec</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 60 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="59" y="42" />
<text x="89" y="58">
inout</text>
</g>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 116 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 92 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="92" x="59" y="75" />
<text x="105" y="91">
inlateout</text>
</g>
</g>
<path d=" M 185 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 175 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-asm.scope"><a class="rule-link" href="#r-asm.scope" title="asm.scope"><span>[asm<wbr>.scope]</span></a>
</div>

<h2 id="作用域-2"><a class="header" href="#作用域-2">作用域</a></h2>
<div class="rule" id="r-asm.scope.intro"><a class="rule-link" href="#r-asm.scope.intro" title="asm.scope.intro"><span>[asm<wbr>.scope<wbr>.intro]</span></a>
</div>

<p>内联汇编可以以三种方式之一使用。</p>
<div class="rule" id="r-asm.scope.asm"><a class="rule-link" href="#r-asm.scope.asm" title="asm.scope.asm"><span>[asm<wbr>.scope<wbr>.asm]</span></a>
</div>

<p>使用 <code>asm!</code> 宏，汇编代码在函数作用域内发出，并集成到编译器生成的函数汇编代码中。这些汇编代码必须遵守 <a href="#rules-for-inline-assembly">严格的规则</a> 以避免未定义行为。请注意，在某些情况下，编译器可能会选择将汇编代码作为单独的函数发出并生成对它的调用。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>unsafe { core::arch::asm!("/* {} */", in(reg) 0); }
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.scope.naked_asm"><a class="rule-link" href="#r-asm.scope.naked_asm" title="asm.scope.naked_asm"><span>[asm<wbr>.scope<wbr>.naked_asm]</span></a>
</div>

<p>使用 <code>naked_asm!</code> 宏，汇编代码在函数作用域内发出，并构成函数的完整汇编代码。<code>naked_asm!</code> 宏仅允许在 <a href="#the-naked-attribute">裸函数</a> 中使用。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span><span class="boring">#[unsafe(naked)]
</span><span class="boring">extern "C" fn wrapper() {
</span>core::arch::naked_asm!("/* {} */", const 0);
<span class="boring">}
</span><span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.scope.global_asm"><a class="rule-link" href="#r-asm.scope.global_asm" title="asm.scope.global_asm"><span>[asm<wbr>.scope<wbr>.global_asm]</span></a>
</div>

<p>使用 <code>global_asm!</code> 宏，汇编代码在全局作用域内发出，位于函数之外。这可用于使用汇编代码手写整个函数，通常可以更自由地使用任意寄存器和汇编指令。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {}
</span><span class="boring">#[cfg(target_arch = "x86_64")]
</span>core::arch::global_asm!("/* {} */", const 0);</code></pre>
<div class="rule" id="r-asm.ts-args"><a class="rule-link" href="#r-asm.ts-args" title="asm.ts-args"><span>[asm<wbr>.ts-args]</span></a>
</div>

<h2 id="模板字符串参数"><a class="header" href="#模板字符串参数">模板字符串参数</a></h2>
<div class="rule" id="r-asm.ts-args.syntax"><a class="rule-link" href="#r-asm.ts-args.syntax" title="asm.ts-args.syntax"><span>[asm<wbr>.ts-args<wbr>.syntax]</span></a>
</div>

<p>汇编器模板使用与 <a href="../alloc/fmt/index.html#syntax">格式化字符串</a> 相同的语法格式（即占位符通过大括号指定）。</p>
<div class="rule" id="r-asm.ts-args.order"><a class="rule-link" href="#r-asm.ts-args.order" title="asm.ts-args.order"><span>[asm<wbr>.ts-args<wbr>.order]</span></a>
</div>

<p>对应的参数按顺序、按索引或按名称访问。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i64;
let y: i64;
let z: i64;
// 这个
unsafe { core::arch::asm!("mov {}, {}", out(reg) x, in(reg) 5); }
// ... 这个
unsafe { core::arch::asm!("mov {0}, {1}", out(reg) y, in(reg) 5); }
// ... 以及这个
unsafe { core::arch::asm!("mov {out}, {in}", out = out(reg) z, in = in(reg) 5); }
// 都有相同的行为
assert_eq!(x, y);
assert_eq!(y, z);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.ts-args.no-implicit"><a class="rule-link" href="#r-asm.ts-args.no-implicit" title="asm.ts-args.no-implicit"><span>[asm<wbr>.ts-args<wbr>.no-implicit]</span></a>
</div>

<p>但是，不支持（由 <a href="https://github.com/rust-lang/rfcs/pull/2795">RFC #2795</a> 引入的）隐式命名参数。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x = 5;
// 我们不能直接从作用域引用 `x`，我们需要一个类似 `in(reg) x` 的操作数
unsafe { core::arch::asm!("/* {x} */"); } // ERROR: no argument named x
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.ts-args.one-or-more"><a class="rule-link" href="#r-asm.ts-args.one-or-more" title="asm.ts-args.one-or-more"><span>[asm<wbr>.ts-args<wbr>.one-or-more]</span></a>
</div>

<p>一个 <code>asm!</code> 调用可以有一个或多个模板字符串参数；具有多个模板字符串参数的 <code>asm!</code> 被处理为所有字符串都连接在一起，且它们之间有一个 <code>\n</code>。预期用法是每个模板字符串参数对应一行汇编代码。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i64;
let y: i64;
// 我们可以将多个字符串分开，就像它们是写在一起的一样
unsafe { core::arch::asm!("mov eax, 5", "mov ecx, eax", out("rax") x, out("rcx") y); }
assert_eq!(x, y);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.ts-args.before-other-args"><a class="rule-link" href="#r-asm.ts-args.before-other-args" title="asm.ts-args.before-other-args"><span>[asm<wbr>.ts-args<wbr>.before-other-args]</span></a>
</div>

<p>所有模板字符串参数必须出现在任何其他参数之前。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = 5;
<span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// 模板字符串需要首先出现在 asm 调用中
unsafe { core::arch::asm!("/* {x} */", x = const 5, "ud2"); } // ERROR: unexpected token
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.ts-args.positional-first"><a class="rule-link" href="#r-asm.ts-args.positional-first" title="asm.ts-args.positional-first"><span>[asm<wbr>.ts-args<wbr>.positional-first]</span></a>
</div>

<p>与格式化字符串一样，位置参数必须出现在命名参数和显式 <a href="#register-operands">寄存器操作数</a> 之前。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// 命名操作数需要放在位置操作数之后
unsafe { core::arch::asm!("/* {x} {} */", x = const 5, in(reg) 5); }
// ERROR: positional arguments cannot follow named arguments or explicit register arguments
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// 我们也不能将显式寄存器放在位置操作数之前
unsafe { core::arch::asm!("/* {} */", in("eax") 0, in(reg) 5); }
// ERROR: positional arguments cannot follow named arguments or explicit register arguments
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.ts-args.register-operands"><a class="rule-link" href="#r-asm.ts-args.register-operands" title="asm.ts-args.register-operands"><span>[asm<wbr>.ts-args<wbr>.register-operands]</span></a>
</div>

<p>显式寄存器操作数不能被模板字符串中的占位符使用。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// 显式寄存器操作数不会被替换，请在字符串中显式使用 `eax`
unsafe { core::arch::asm!("/* {} */", in("eax") 5); }
// ERROR: invalid reference to argument at index 0
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.ts-args.at-least-once"><a class="rule-link" href="#r-asm.ts-args.at-least-once" title="asm.ts-args.at-least-once"><span>[asm<wbr>.ts-args<wbr>.at-least-once]</span></a>
</div>

<p>所有其他命名和位置操作数必须在模板字符串中至少出现一次，否则会产生编译器错误。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// 我们必须在格式化字符串中命名所有的操作数
unsafe { core::arch::asm!("", in(reg) 5, x = const 5); }
// ERROR: multiple unused asm arguments
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.ts-args.opaque"><a class="rule-link" href="#r-asm.ts-args.opaque" title="asm.ts-args.opaque"><span>[asm<wbr>.ts-args<wbr>.opaque]</span></a>
</div>

<p>除了将操作数替换到模板字符串中以形成传递给汇编器的代码的方式外，确切的汇编代码语法是特定于 target 的，且对编译器是不透明的。</p>
<div class="rule" id="r-asm.ts-args.llvm-syntax"><a class="rule-link" href="#r-asm.ts-args.llvm-syntax" title="asm.ts-args.llvm-syntax"><span>[asm<wbr>.ts-args<wbr>.llvm-syntax]</span></a>
</div>

<p>目前，所有受支持的 target 都遵循 LLVM 内部汇编器使用的汇编代码语法，这通常对应于 GNU 汇编器（GAS）的语法。在 x86 上，默认使用 GAS 的 <code>.intel_syntax noprefix</code> 模式。在 ARM 上，使用 <code>.syntax unified</code> 模式。这些 target 对汇编代码施加了额外的限制：任何汇编器状态（例如可以通过 <code>.section</code> 更改的当前节）必须在汇编字符串结束时恢复为其原始值。不符合 GAS 语法的汇编代码将导致特定于汇编器的行为。有关内联汇编所用指令的进一步约束由 <a href="#directives-support">指令支持</a> 指出。</p>
<div class="rule" id="r-asm.attributes"><a class="rule-link" href="#r-asm.attributes" title="asm.attributes"><span>[asm<wbr>.attributes]</span></a>
</div>

<h2 id="属性-2"><a class="header" href="#属性-2">属性</a></h2>
<div class="rule" id="r-asm.attributes.supported-attributes"><a class="rule-link" href="#r-asm.attributes.supported-attributes" title="asm.attributes.supported-attributes"><span>[asm<wbr>.attributes<wbr>.supported-attributes]</span></a>
</div>

<p>在语义上，只有 <a href="#cfg属性"><code>cfg</code></a> 和 <a href="#cfg_attr属性"><code>cfg_attr</code></a> 属性被内联汇编模板字符串和操作数接受。其他属性虽然会被解析，但在汇编宏展开时会被拒绝。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {}
</span><span class="boring">#[cfg(target_arch = "x86_64")]
</span>core::arch::global_asm!(
    #[cfg(not(panic = "abort"))]
    ".cfi_startproc",
    // ...
    "ret",
    #[cfg(not(panic = "abort"))]
    ".cfi_endproc",
);</code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>在 <code>rustc</code> 中，汇编宏对这些属性的处理与处理语言中类似属性的普通系统是分开实现的。这解释了受支持属性种类有限的原因，并可能导致行为上的细微差异。</p>
</blockquote>
</div>

<div class="rule" id="r-asm.attributes.starts-with-template"><a class="rule-link" href="#r-asm.attributes.starts-with-template" title="asm.attributes.starts-with-template"><span>[asm<wbr>.attributes<wbr>.starts-with-template]</span></a>
</div>

<p>在语法上，第一个操作数之前必须至少有一个模板字符串。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 这被拒绝是因为 `a = out(reg) x` 不会被解析为
// 模板字符串。
core::arch::asm!(
    #[cfg(false)]
    a = out(reg) x, // ERROR.
    "",
);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type"><a class="rule-link" href="#r-asm.operand-type" title="asm.operand-type"><span>[asm<wbr>.operand-type]</span></a>
</div>

<h2 id="操作数类型"><a class="header" href="#操作数类型">操作数类型</a></h2>
<div class="rule" id="r-asm.operand-type.supported-operands"><a class="rule-link" href="#r-asm.operand-type.supported-operands" title="asm.operand-type.supported-operands"><span>[asm<wbr>.operand-type<wbr>.supported-operands]</span></a>
</div>

<p>支持几种类型的操作数：</p>
<div class="rule" id="r-asm.operand-type.supported-operands.in"><a class="rule-link" href="#r-asm.operand-type.supported-operands.in" title="asm.operand-type.supported-operands.in"><span>[asm<wbr>.operand-type<wbr>.supported-operands<wbr>.in]</span></a>
</div>

<ul>
<li><code>in(&lt;reg&gt;) &lt;expr&gt;</code>
<ul>
<li><code>&lt;reg&gt;</code> 可以引用一个寄存器类或一个显式寄存器。分配的寄存器名称将被替换到汇编模板字符串中。</li>
<li>在汇编代码开始时，分配的寄存器将包含 <code>&lt;expr&gt;</code> 的值。</li>
<li>分配的寄存器在汇编代码结束时必须包含相同的值（除非 <code>lateout</code> 被分配到同一个寄存器）。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// `in` 可用于将值传递到内联汇编中...
unsafe { core::arch::asm!("/* {} */", in(reg) 5); }
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.supported-operands.out"><a class="rule-link" href="#r-asm.operand-type.supported-operands.out" title="asm.operand-type.supported-operands.out"><span>[asm<wbr>.operand-type<wbr>.supported-operands<wbr>.out]</span></a>
</div>

<ul>
<li><code>out(&lt;reg&gt;) &lt;expr&gt;</code>
<ul>
<li><code>&lt;reg&gt;</code> 可以引用一个寄存器类或一个显式寄存器。分配的寄存器名称将被替换到汇编模板字符串中。</li>
<li>在汇编代码开始时，分配的寄存器将包含一个未定义的值。</li>
<li><code>&lt;expr&gt;</code> 必须是一个（可能未初始化的）位置表达式，分配的寄存器的内容将在汇编代码结束时写入该表达式。</li>
<li>可以指定下划线（<code>_</code>）而不是表达式，这将导致寄存器的内容在汇编代码结束时被丢弃（实际上起到了破坏列表（clobber）的作用）。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i64;
// 而 `out` 可用于将值传回 rust。
unsafe { core::arch::asm!("/* {} */", out(reg) x); }
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.supported-operands.lateout"><a class="rule-link" href="#r-asm.operand-type.supported-operands.lateout" title="asm.operand-type.supported-operands.lateout"><span>[asm<wbr>.operand-type<wbr>.supported-operands<wbr>.lateout]</span></a>
</div>

<ul>
<li><code>lateout(&lt;reg&gt;) &lt;expr&gt;</code>
<ul>
<li>与 <code>out</code> 相同，除了寄存器分配器可以重用分配给 <code>in</code> 的寄存器。</li>
<li>您应该仅在读取所有输入后才写入寄存器，否则可能会破坏某个输入。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i64;
// `lateout` 与 `out` 相同
// 但编译器知道在我们要覆盖它的时候，我们并不关心任何输入的值。
unsafe { core::arch::asm!("mov {}, 5", lateout(reg) x); }
assert_eq!(x, 5)
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.supported-operands.inout"><a class="rule-link" href="#r-asm.operand-type.supported-operands.inout" title="asm.operand-type.supported-operands.inout"><span>[asm<wbr>.operand-type<wbr>.supported-operands<wbr>.inout]</span></a>
</div>

<ul>
<li><code>inout(&lt;reg&gt;) &lt;expr&gt;</code>
<ul>
<li><code>&lt;reg&gt;</code> 可以引用一个寄存器类或一个显式寄存器。分配的寄存器名称将被替换到汇编模板字符串中。</li>
<li>在汇编代码开始时，分配的寄存器将包含 <code>&lt;expr&gt;</code> 的值。</li>
<li><code>&lt;expr&gt;</code> 必须是一个可变的已初始化位置表达式，分配的寄存器的内容将在汇编代码结束时写入该表达式。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let mut x: i64 = 4;
// `inout` 可用于在寄存器内修改值
unsafe { core::arch::asm!("inc {}", inout(reg) x); }
assert_eq!(x, 5);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.supported-operands.inout-arrow"><a class="rule-link" href="#r-asm.operand-type.supported-operands.inout-arrow" title="asm.operand-type.supported-operands.inout-arrow"><span>[asm<wbr>.operand-type<wbr>.supported-operands<wbr>.inout-arrow]</span></a>
</div>

<ul>
<li><code>inout(&lt;reg&gt;) &lt;in expr&gt; =&gt; &lt;out expr&gt;</code>
<ul>
<li>与 <code>inout</code> 相同，除了寄存器的初始值取自 <code>&lt;in expr&gt;</code> 的值。</li>
<li><code>&lt;out expr&gt;</code> 必须是一个（可能未初始化的）位置表达式，分配的寄存器的内容将在汇编代码结束时写入该表达式。</li>
<li>可以为 <code>&lt;out expr&gt;</code> 指定下划线（<code>_</code>）而不是表达式，这将导致寄存器的内容在汇编代码结束时被丢弃（实际上起到了破坏列表的作用）。</li>
<li><code>&lt;in expr&gt;</code> 和 <code>&lt;out expr&gt;</code> 可以具有不同的类型。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i64;
// `inout` 也可以将值移动到不同的地方
unsafe { core::arch::asm!("inc {}", inout(reg) 4u64=&gt;x); }
assert_eq!(x, 5);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.supported-operands.inlateout"><a class="rule-link" href="#r-asm.operand-type.supported-operands.inlateout" title="asm.operand-type.supported-operands.inlateout"><span>[asm<wbr>.operand-type<wbr>.supported-operands<wbr>.inlateout]</span></a>
</div>

<ul>
<li><code>inlateout(&lt;reg&gt;) &lt;expr&gt;</code> / <code>inlateout(&lt;reg&gt;) &lt;in expr&gt; =&gt; &lt;out expr&gt;</code>
<ul>
<li>与 <code>inout</code> 相同，除了寄存器分配器可以重用分配给 <code>in</code> 的寄存器（如果编译器知道 <code>in</code> 具有与 <code>inlateout</code> 相同的初始值，就会发生这种情况）。</li>
<li>您应该仅在读取所有输入后才写入寄存器，否则可能会破坏某个输入。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let mut x: i64 = 4;
// `inlateout` 是使用 `lateout` 的 `inout`
unsafe { core::arch::asm!("inc {}", inlateout(reg) x); }
assert_eq!(x, 5);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.supported-operands.sym"><a class="rule-link" href="#r-asm.operand-type.supported-operands.sym" title="asm.operand-type.supported-operands.sym"><span>[asm<wbr>.operand-type<wbr>.supported-operands<wbr>.sym]</span></a>
</div>

<ul>
<li><code>sym &lt;path&gt;</code>
<ul>
<li><code>&lt;path&gt;</code> 必须引用一个 <code>fn</code> 或 <code>static</code>。</li>
<li>引用该项的混淆后的符号名称将被替换到汇编模板字符串中。</li>
<li>替换后的字符串不包括任何修饰符（例如 GOT、PLT、重定位等）。</li>
<li><code>&lt;path&gt;</code> 允许指向一个 <code>#[thread_local]</code> 静态变量，在这种情况下，汇编代码可以将该符号与重定位（例如 <code>@plt</code>、<code>@TPOFF</code>）结合使用以读取线程局部数据。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>extern "C" fn foo() {
    println!("Hello from inline assembly")
}
// `sym` 可用于引用函数（即使它没有我们可以直接编写的外部名称）
unsafe { core::arch::asm!("call {}", sym foo, clobber_abi("C")); }
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.supported-operands.const"><a class="rule-link" href="#r-asm.operand-type.supported-operands.const" title="asm.operand-type.supported-operands.const"><span>[asm<wbr>.operand-type<wbr>.supported-operands<wbr>.const]</span></a>
</div>

<ul>
<li><code>const &lt;expr&gt;</code>
<ul>
<li><code>&lt;expr&gt;</code> 必须是一个整数常量表达式。此表达式遵循与内联 <code>const</code> 块相同的规则。</li>
<li>表达式的类型可以是任何整数类型，但默认情况下就像整数面值一样是 <code>i32</code>。</li>
<li>表达式的值被格式化为字符串，并直接替换到汇编模板字符串中。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// swizzle [0, 1, 2, 3] =&gt; [3, 2, 0, 1]
const SHUFFLE: u8 = 0b01_00_10_11;
let x: core::arch::x86_64::__m128 = unsafe { core::mem::transmute([0u32, 1u32, 2u32, 3u32]) };
let y: core::arch::x86_64::__m128;
// 将常量值传递给需要立即数的指令，如 `pshufd`
unsafe {
    core::arch::asm!("pshufd {xmm}, {xmm}, {shuffle}",
        xmm = inlateout(xmm_reg) x=&gt;y,
        shuffle = const SHUFFLE
    );
}
let y: [u32; 4] = unsafe { core::mem::transmute(y) };
assert_eq!(y, [3, 2, 0, 1]);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.supported-operands.label"><a class="rule-link" href="#r-asm.operand-type.supported-operands.label" title="asm.operand-type.supported-operands.label"><span>[asm<wbr>.operand-type<wbr>.supported-operands<wbr>.label]</span></a>
</div>

<ul>
<li><code>label &lt;block&gt;</code>
<ul>
<li>该块的地址将被替换到汇编模板字符串中。汇编代码可以跳转到替换后的地址。</li>
<li>对于区分直接跳转和间接跳转的 target（例如启用了 <code>cf-protection</code> 的 x86-64），汇编代码不得间接跳转到替换后的地址。</li>
<li>执行完该块后，<code>asm!</code> 表达式返回。</li>
<li>块的类型必须是单元类型或 <code>!</code>（从不）。</li>
<li>该块启动了一个新的安全上下文；<code>label</code> 块内的不安全操作必须包装在内部的 <code>unsafe</code> 块中，尽管整个 <code>asm!</code> 表达式已经包装在 <code>unsafe</code> 中了。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")]
</span>unsafe {
    core::arch::asm!("jmp {}", label {
        println!("Hello from inline assembly label");
    });
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.left-to-right"><a class="rule-link" href="#r-asm.operand-type.left-to-right" title="asm.operand-type.left-to-right"><span>[asm<wbr>.operand-type<wbr>.left-to-right]</span></a>
</div>

<p>操作数表达式从左到右进行评估，就像函数调用参数一样。在 <code>asm!</code> 执行后，输出按从左到右的顺序写入。如果两个输出指向同一个地方，这一点很重要：该地方将包含最右侧输出的值。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let mut y: i64;
// y 从第二个输出而不是第一个输出获取其值
unsafe { core::arch::asm!("mov {}, 0", "mov {}, 1", out(reg) y, out(reg) y); }
assert_eq!(y, 1);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.naked_asm-restriction"><a class="rule-link" href="#r-asm.operand-type.naked_asm-restriction" title="asm.operand-type.naked_asm-restriction"><span>[asm<wbr>.operand-type<wbr>.naked_asm-restriction]</span></a>
</div>

<p>由于 <code>naked_asm!</code> 定义了整个函数体，且编译器无法发出任何额外的代码来处理操作数，因此它只能使用 <code>sym</code> 和 <code>const</code> 操作数。</p>
<div class="rule" id="r-asm.operand-type.global_asm-restriction"><a class="rule-link" href="#r-asm.operand-type.global_asm-restriction" title="asm.operand-type.global_asm-restriction"><span>[asm<wbr>.operand-type<wbr>.global_asm-restriction]</span></a>
</div>

<p>由于 <code>global_asm!</code> 存在于函数之外，它只能使用 <code>sym</code> 和 <code>const</code> 操作数。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">fn main() {}
</span>// 不允许寄存器操作数，因为我们不在函数中
<span class="boring">#[cfg(target_arch = "x86_64")]
</span>core::arch::global_asm!("", in(reg) 5);
// ERROR: the `in` operand cannot be used with `global_asm!`
<span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {}
</span>fn foo() {}

<span class="boring">#[cfg(target_arch = "x86_64")]
</span>// 然而，`const` 和 `sym` 都是允许的
core::arch::global_asm!("/* {} {} */", const 0, sym foo);</code></pre>
<div class="rule" id="r-asm.register-operands"><a class="rule-link" href="#r-asm.register-operands" title="asm.register-operands"><span>[asm<wbr>.register-operands]</span></a>
</div>

<h2 id="寄存器操作数"><a class="header" href="#寄存器操作数">寄存器操作数</a></h2>
<div class="rule" id="r-asm.register-operands.register-or-class"><a class="rule-link" href="#r-asm.register-operands.register-or-class" title="asm.register-operands.register-or-class"><span>[asm<wbr>.register-operands<wbr>.register-or-class]</span></a>
</div>

<p>输入和输出操作数既可以指定为显式寄存器，也可以指定为寄存器分配器可以从中选择寄存器的寄存器类。显式寄存器被指定为字符串字面量（例如 <code>"eax"</code>），而寄存器类被指定为标识符（例如 <code>reg</code>）。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let mut y: i64;
// 我们既可以将两者都命名为 `reg`，也可以使用显式寄存器（如 `eax`）来获取一个
// 整数寄存器
unsafe { core::arch::asm!("mov eax, {:e}", in(reg) 5, lateout("eax") y); }
assert_eq!(y, 5);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.register-operands.equivalence-to-base-register"><a class="rule-link" href="#r-asm.register-operands.equivalence-to-base-register" title="asm.register-operands.equivalence-to-base-register"><span>[asm<wbr>.register-operands<wbr>.equivalence-to-base-register]</span></a>
</div>

<p>请注意，显式寄存器将寄存器别名（例如 ARM 上的 <code>r14</code> 与 <code>lr</code>）和寄存器的较小视图（例如 <code>eax</code> 与 <code>rax</code>）视为等同于基本寄存器。</p>
<div class="rule" id="r-asm.register-operands.error-two-operands"><a class="rule-link" href="#r-asm.register-operands.error-two-operands" title="asm.register-operands.error-two-operands"><span>[asm<wbr>.register-operands<wbr>.error-two-operands]</span></a>
</div>

<p>在两个输入操作数或两个输出操作数中使用相同的显式寄存器是一个编译时错误。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// 我们不能两次命名 eax
unsafe { core::arch::asm!("", in("eax") 5, in("eax") 4); }
// ERROR: register `eax` conflicts with register `eax`
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// ... 即使使用不同的别名
unsafe { core::arch::asm!("", in("ax") 5, in("rax") 4); }
// ERROR: register `rax` conflicts with register `ax`
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.register-operands.error-overlapping"><a class="rule-link" href="#r-asm.register-operands.error-overlapping" title="asm.register-operands.error-overlapping"><span>[asm<wbr>.register-operands<wbr>.error-overlapping]</span></a>
</div>

<p>此外，在输入操作数或输出操作数中使用重叠的寄存器（例如 ARM VFP）也是一个编译时错误。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// al 与 ax 重叠，所以我们不能同时命名它们。
unsafe { core::arch::asm!("", in("ax") 5, in("al") 4i8); }
// ERROR: register `al` conflicts with register `ax`
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.register-operands.allowed-types"><a class="rule-link" href="#r-asm.register-operands.allowed-types" title="asm.register-operands.allowed-types"><span>[asm<wbr>.register-operands<wbr>.allowed-types]</span></a>
</div>

<p>内联汇编仅允许使用以下类型作为操作数：</p>
<ul>
<li>整数（有符号和无符号）</li>
<li>浮点数</li>
<li>指针（仅瘦指针）</li>
<li>函数指针</li>
<li>SIMD 向量（使用 <code>#[repr(simd)]</code> 定义且实现了 <code>Copy</code> 的结构体）。这包括在 <code>std::arch</code> 中定义的特定架构向量类型，如 <code>__m128</code> (x86) 或 <code>int8x16_t</code> (ARM)。</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>extern "C" fn foo() {}

// 允许整数...
let y: i64 = 5;
unsafe { core::arch::asm!("/* {} */", in(reg) y); }

// 以及指针...
let py = &amp;raw const y;
unsafe { core::arch::asm!("/* {} */", in(reg) py); }

// 还有浮点数...
let f = 1.0f32;
unsafe { core::arch::asm!("/* {} */", in(xmm_reg) f); }

// 甚至是函数指针和 simd 向量。
let func: extern "C" fn() = foo;
unsafe { core::arch::asm!("/* {} */", in(reg) func); }

let z = unsafe { core::arch::x86_64::_mm_set_epi64x(1, 0) };
unsafe { core::arch::asm!("/* {} */", in(xmm_reg) z); }
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>struct Foo;
let x: Foo = Foo;
// 不允许像结构体这样的复杂类型
unsafe { core::arch::asm!("/* {} */", in(reg) x); }
// ERROR: cannot use value of type `Foo` for inline assembly
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.register-operands.supported-register-classes"><a class="rule-link" href="#r-asm.register-operands.supported-register-classes" title="asm.register-operands.supported-register-classes"><span>[asm<wbr>.register-operands<wbr>.supported-register-classes]</span></a>
</div>

<p>以下是当前受支持的寄存器类列表：</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>架构</th><th>寄存器类</th><th>寄存器</th><th>LLVM 约束代码</th></tr>
</thead>
<tbody>
<tr><td>x86</td><td><code>reg</code></td><td><code>ax</code>, <code>bx</code>, <code>cx</code>, <code>dx</code>, <code>si</code>, <code>di</code>, <code>bp</code>, <code>r[8-15]</code> (仅限 x86-64)</td><td><code>r</code></td></tr>
<tr><td>x86</td><td><code>reg_abcd</code></td><td><code>ax</code>, <code>bx</code>, <code>cx</code>, <code>dx</code></td><td><code>Q</code></td></tr>
<tr><td>x86-32</td><td><code>reg_byte</code></td><td><code>al</code>, <code>bl</code>, <code>cl</code>, <code>dl</code>, <code>ah</code>, <code>bh</code>, <code>ch</code>, <code>dh</code></td><td><code>q</code></td></tr>
<tr><td>x86-64</td><td><code>reg_byte</code>*</td><td><code>al</code>, <code>bl</code>, <code>cl</code>, <code>dl</code>, <code>sil</code>, <code>dil</code>, <code>bpl</code>, <code>r[8-15]b</code></td><td><code>q</code></td></tr>
<tr><td>x86</td><td><code>xmm_reg</code></td><td><code>xmm[0-7]</code> (x86) <code>xmm[0-15]</code> (x86-64)</td><td><code>x</code></td></tr>
<tr><td>x86</td><td><code>ymm_reg</code></td><td><code>ymm[0-7]</code> (x86) <code>ymm[0-15]</code> (x86-64)</td><td><code>x</code></td></tr>
<tr><td>x86</td><td><code>zmm_reg</code></td><td><code>zmm[0-7]</code> (x86) <code>zmm[0-31]</code> (x86-64)</td><td><code>v</code></td></tr>
<tr><td>x86</td><td><code>kreg</code></td><td><code>k[1-7]</code></td><td><code>Yk</code></td></tr>
<tr><td>x86</td><td><code>kreg0</code></td><td><code>k0</code></td><td>仅限破坏列表</td></tr>
<tr><td>x86</td><td><code>x87_reg</code></td><td><code>st([0-7])</code></td><td>仅限破坏列表</td></tr>
<tr><td>x86</td><td><code>mmx_reg</code></td><td><code>mm[0-7]</code></td><td>仅限破坏列表</td></tr>
<tr><td>x86-64</td><td><code>tmm_reg</code></td><td><code>tmm[0-7]</code></td><td>仅限破坏列表</td></tr>
<tr><td>AArch64</td><td><code>reg</code></td><td><code>x[0-30]</code></td><td><code>r</code></td></tr>
<tr><td>AArch64</td><td><code>vreg</code></td><td><code>v[0-31]</code></td><td><code>w</code></td></tr>
<tr><td>AArch64</td><td><code>vreg_low16</code></td><td><code>v[0-15]</code></td><td><code>x</code></td></tr>
<tr><td>AArch64</td><td><code>preg</code></td><td><code>p[0-15]</code>, <code>ffr</code></td><td>仅限破坏列表</td></tr>
<tr><td>Arm64EC</td><td><code>reg</code></td><td><code>x[0-12]</code>, <code>x[15-22]</code>, <code>x[25-27]</code>, <code>x30</code></td><td><code>r</code></td></tr>
<tr><td>Arm64EC</td><td><code>vreg</code></td><td><code>v[0-15]</code></td><td><code>w</code></td></tr>
<tr><td>Arm64EC</td><td><code>vreg_low16</code></td><td><code>v[0-15]</code></td><td><code>x</code></td></tr>
<tr><td>ARM (ARM/Thumb2)</td><td><code>reg</code></td><td><code>r[0-12]</code>, <code>r14</code></td><td><code>r</code></td></tr>
<tr><td>ARM (Thumb1)</td><td><code>reg</code></td><td><code>r[0-7]</code></td><td><code>r</code></td></tr>
<tr><td>ARM</td><td><code>sreg</code></td><td><code>s[0-31]</code></td><td><code>t</code></td></tr>
<tr><td>ARM</td><td><code>sreg_low16</code></td><td><code>s[0-15]</code></td><td><code>x</code></td></tr>
<tr><td>ARM</td><td><code>dreg</code></td><td><code>d[0-31]</code></td><td><code>w</code></td></tr>
<tr><td>ARM</td><td><code>dreg_low16</code></td><td><code>d[0-15]</code></td><td><code>t</code></td></tr>
<tr><td>ARM</td><td><code>dreg_low8</code></td><td><code>d[0-8]</code></td><td><code>x</code></td></tr>
<tr><td>ARM</td><td><code>qreg</code></td><td><code>q[0-15]</code></td><td><code>w</code></td></tr>
<tr><td>ARM</td><td><code>qreg_low8</code></td><td><code>q[0-7]</code></td><td><code>t</code></td></tr>
<tr><td>ARM</td><td><code>qreg_low4</code></td><td><code>q[0-3]</code></td><td><code>x</code></td></tr>
<tr><td>RISC-V</td><td><code>reg</code></td><td><code>x1</code>, <code>x[5-7]</code>, <code>x[9-15]</code>, <code>x[16-31]</code> (非 RV32E)</td><td><code>r</code></td></tr>
<tr><td>RISC-V</td><td><code>freg</code></td><td><code>f[0-31]</code></td><td><code>f</code></td></tr>
<tr><td>RISC-V</td><td><code>vreg</code></td><td><code>v[0-31]</code></td><td>仅限破坏列表</td></tr>
<tr><td>LoongArch</td><td><code>reg</code></td><td><code>$r1</code>, <code>$r[4-20]</code>, <code>$r[23,30]</code></td><td><code>r</code></td></tr>
<tr><td>LoongArch</td><td><code>freg</code></td><td><code>$f[0-31]</code></td><td><code>f</code></td></tr>
<tr><td>s390x</td><td><code>reg</code></td><td><code>r[0-10]</code>, <code>r[12-14]</code></td><td><code>r</code></td></tr>
<tr><td>s390x</td><td><code>reg_addr</code></td><td><code>r[1-10]</code>, <code>r[12-14]</code></td><td><code>a</code></td></tr>
<tr><td>s390x</td><td><code>freg</code></td><td><code>f[0-15]</code></td><td><code>f</code></td></tr>
<tr><td>s390x</td><td><code>vreg</code></td><td><code>v[0-31]</code></td><td>仅限破坏列表</td></tr>
<tr><td>s390x</td><td><code>areg</code></td><td><code>a[2-15]</code></td><td>仅限破坏列表</td></tr>
</tbody>
</table>
</div>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<ul>
<li>在 x86 上，我们将 <code>reg_byte</code> 与 <code>reg</code> 区别对待，因为编译器可以分别分配 <code>al</code> 和 <code>ah</code>，而 <code>reg</code> 会保留整个寄存器。</li>
<li>在 x86-64 上，高字节寄存器（例如 <code>ah</code>）在 <code>reg_byte</code> 寄存器类中不可用。</li>
<li>一些寄存器类被标记为 “仅限破坏列表” ，这意味着这些类中的寄存器不能用于输入或输出，只能用于 <code>out(&lt;explicit register&gt;) _</code> 或 <code>lateout(&lt;explicit register&gt;) _</code> 形式的破坏列表。</li>
</ul>
</blockquote>
</div>

<div class="rule" id="r-asm.register-operands.value-type-constraints"><a class="rule-link" href="#r-asm.register-operands.value-type-constraints" title="asm.register-operands.value-type-constraints"><span>[asm<wbr>.register-operands<wbr>.value-type-constraints]</span></a>
</div>

<p>每个寄存器类对其可以使用的值类型都有约束。这是必要的，因为将值加载到寄存器的方式取决于其类型。例如，在大端系统上，将 <code>i32x4</code> 和 <code>i8x16</code> 加载到 SIMD 寄存器中可能会导致不同的寄存器内容，即使这两个值的按字节内存表示是相同的。特定寄存器类可用支持类型的可用性可能取决于当前启用了哪些 target 特性。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>架构</th><th>寄存器类</th><th>target 特性</th><th>允许的类型</th></tr>
</thead>
<tbody>
<tr><td>x86-32</td><td><code>reg</code></td><td>None</td><td><code>i16</code>, <code>i32</code>, <code>f32</code></td></tr>
<tr><td>x86-64</td><td><code>reg</code></td><td>None</td><td><code>i16</code>, <code>i32</code>, <code>f32</code>, <code>i64</code>, <code>f64</code></td></tr>
<tr><td>x86</td><td><code>reg_byte</code></td><td>None</td><td><code>i8</code></td></tr>
<tr><td>x86</td><td><code>xmm_reg</code></td><td><code>sse</code></td><td><code>i32</code>, <code>f32</code>, <code>i64</code>, <code>f64</code>, <br> <code>i8x16</code>, <code>i16x8</code>, <code>i32x4</code>, <code>i64x2</code>, <code>f32x4</code>, <code>f64x2</code></td></tr>
<tr><td>x86</td><td><code>ymm_reg</code></td><td><code>avx</code></td><td><code>i32</code>, <code>f32</code>, <code>i64</code>, <code>f64</code>, <br> <code>i8x16</code>, <code>i16x8</code>, <code>i32x4</code>, <code>i64x2</code>, <code>f32x4</code>, <code>f64x2</code> <br> <code>i8x32</code>, <code>i16x16</code>, <code>i32x8</code>, <code>i64x4</code>, <code>f32x8</code>, <code>f64x4</code></td></tr>
<tr><td>x86</td><td><code>zmm_reg</code></td><td><code>avx512f</code></td><td><code>i32</code>, <code>f32</code>, <code>i64</code>, <code>f64</code>, <br> <code>i8x16</code>, <code>i16x8</code>, <code>i32x4</code>, <code>i64x2</code>, <code>f32x4</code>, <code>f64x2</code> <br> <code>i8x32</code>, <code>i16x16</code>, <code>i32x8</code>, <code>i64x4</code>, <code>f32x8</code>, <code>f64x4</code> <br> <code>i8x64</code>, <code>i16x32</code>, <code>i32x16</code>, <code>i64x8</code>, <code>f32x16</code>, <code>f64x8</code></td></tr>
<tr><td>x86</td><td><code>kreg</code></td><td><code>avx512f</code></td><td><code>i8</code>, <code>i16</code></td></tr>
<tr><td>x86</td><td><code>kreg</code></td><td><code>avx512bw</code></td><td><code>i32</code>, <code>i64</code></td></tr>
<tr><td>x86</td><td><code>mmx_reg</code></td><td>N/A</td><td>仅限破坏列表</td></tr>
<tr><td>x86</td><td><code>x87_reg</code></td><td>N/A</td><td>仅限破坏列表</td></tr>
<tr><td>x86</td><td><code>tmm_reg</code></td><td>N/A</td><td>仅限破坏列表</td></tr>
<tr><td>AArch64</td><td><code>reg</code></td><td>None</td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>f32</code>, <code>i64</code>, <code>f64</code></td></tr>
<tr><td>AArch64</td><td><code>vreg</code></td><td><code>neon</code></td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>f32</code>, <code>i64</code>, <code>f64</code>, <br> <code>i8x8</code>, <code>i16x4</code>, <code>i32x2</code>, <code>i64x1</code>, <code>f32x2</code>, <code>f64x1</code>, <br> <code>i8x16</code>, <code>i16x8</code>, <code>i32x4</code>, <code>i64x2</code>, <code>f32x4</code>, <code>f64x2</code></td></tr>
<tr><td>AArch64</td><td><code>preg</code></td><td>N/A</td><td>仅限破坏列表</td></tr>
<tr><td>Arm64EC</td><td><code>reg</code></td><td>None</td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>f32</code>, <code>i64</code>, <code>f64</code></td></tr>
<tr><td>Arm64EC</td><td><code>vreg</code></td><td><code>neon</code></td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>f32</code>, <code>i64</code>, <code>f64</code>, <br> <code>i8x8</code>, <code>i16x4</code>, <code>i32x2</code>, <code>i64x1</code>, <code>f32x2</code>, <code>f64x1</code>, <br> <code>i8x16</code>, <code>i16x8</code>, <code>i32x4</code>, <code>i64x2</code>, <code>f32x4</code>, <code>f64x2</code></td></tr>
<tr><td>ARM</td><td><code>reg</code></td><td>None</td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>f32</code></td></tr>
<tr><td>ARM</td><td><code>sreg</code></td><td><code>vfp2</code></td><td><code>i32</code>, <code>f32</code></td></tr>
<tr><td>ARM</td><td><code>dreg</code></td><td><code>vfp2</code></td><td><code>i64</code>, <code>f64</code>, <code>i8x8</code>, <code>i16x4</code>, <code>i32x2</code>, <code>i64x1</code>, <code>f32x2</code></td></tr>
<tr><td>ARM</td><td><code>qreg</code></td><td><code>neon</code></td><td><code>i8x16</code>, <code>i16x8</code>, <code>i32x4</code>, <code>i64x2</code>, <code>f32x4</code></td></tr>
<tr><td>RISC-V32</td><td><code>reg</code></td><td>None</td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>f32</code></td></tr>
<tr><td>RISC-V64</td><td><code>reg</code></td><td>None</td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>f32</code>, <code>i64</code>, <code>f64</code></td></tr>
<tr><td>RISC-V</td><td><code>freg</code></td><td><code>f</code></td><td><code>f32</code></td></tr>
<tr><td>RISC-V</td><td><code>freg</code></td><td><code>d</code></td><td><code>f64</code></td></tr>
<tr><td>RISC-V</td><td><code>vreg</code></td><td>N/A</td><td>仅限破坏列表</td></tr>
<tr><td>LoongArch32</td><td><code>reg</code></td><td>None</td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>f32</code></td></tr>
<tr><td>LoongArch64</td><td><code>reg</code></td><td>None</td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>i64</code>, <code>f32</code>, <code>f64</code></td></tr>
<tr><td>LoongArch</td><td><code>freg</code></td><td><code>f</code></td><td><code>f32</code></td></tr>
<tr><td>LoongArch</td><td><code>freg</code></td><td><code>d</code></td><td><code>f64</code></td></tr>
<tr><td>s390x</td><td><code>reg</code>, <code>reg_addr</code></td><td>None</td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>i64</code></td></tr>
<tr><td>s390x</td><td><code>freg</code></td><td>None</td><td><code>f32</code>, <code>f64</code></td></tr>
<tr><td>s390x</td><td><code>vreg</code></td><td>N/A</td><td>仅限破坏列表</td></tr>
<tr><td>s390x</td><td><code>areg</code></td><td>N/A</td><td>仅限破坏列表</td></tr>
</tbody>
</table>
</div>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>就上表而言，指针、函数指针和 <code>isize</code>/<code>usize</code> 被视为等效的整数类型（取决于 target，为 <code>i16</code>/<code>i32</code>/<code>i64</code>）。</p>
</blockquote>
</div>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x = 5i32;
let y = -1i8;
let z = unsafe { core::arch::x86_64::_mm_set_epi64x(1, 0) };

// reg 对 `i32` 有效，reg_byte 对 `i8` 有效，而 xmm_reg 对 `__m128i` 有效
// 我们不能使用 `tmm0` 作为输入或输出，但我们可以将其加入破坏列表。
unsafe { core::arch::asm!("/* {} {} {} */", in(reg) x, in(reg_byte) y, in(xmm_reg) z, out("tmm0") _); }
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let z = unsafe { core::arch::x86_64::_mm_set_epi64x(1, 0) };
// 我们不能将 `__m128i` 传递给 `reg` 输入
unsafe { core::arch::asm!("/* {} */", in(reg) z); }
// ERROR: type `__m128i` cannot be used with this register class
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.register-operands.smaller-value"><a class="rule-link" href="#r-asm.register-operands.smaller-value" title="asm.register-operands.smaller-value"><span>[asm<wbr>.register-operands<wbr>.smaller-value]</span></a>
</div>

<p>如果值的大小小于它所分配到的寄存器的大小，那么该寄存器的高位对于输入将具有未定义的值，而对于输出将被忽略。唯一的例外是 RISC-V 上的 <code>freg</code> 寄存器类，其中 <code>f32</code> 值按照 RISC-V 架构的要求被 NaN 装箱（NaN-boxed）在 <code>f64</code> 中。</p>
<!--no_run, this test has a non-deterministic runtime behavior-->
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let mut x: i64;
// 将 32 位值移动到 64 位值中，哎呀。
#[allow(asm_sub_register)] // rustc 对此行为发出警告
unsafe { core::arch::asm!("mov {}, {}", lateout(reg) x, in(reg) 4i32); }
// 高 32 位是不确定的
assert_eq!(x, 4); // 不保证此断言成功
assert_eq!(x &amp; 0xFFFFFFFF, 4); // 但是，这个断言会成功
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.register-operands.separate-input-output"><a class="rule-link" href="#r-asm.register-operands.separate-input-output" title="asm.register-operands.separate-input-output"><span>[asm<wbr>.register-operands<wbr>.separate-input-output]</span></a>
</div>

<p>当为 <code>inout</code> 操作数指定单独的输入和输出表达式时，两个表达式必须具有相同的类型。唯一的例外是如果两个操作数都是指针或整数，在这种情况下，它们仅要求具有相同的大小。存在此限制是因为 LLVM 和 GCC 中的寄存器分配器有时无法处理具有不同类型的绑定操作数。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// 指针和整数可以混用（只要它们大小相同）
let x: isize = 0;
let y: *mut ();
// 使用内联汇编魔术将 `isize` 转换为 `*mut ()`
unsafe { core::arch::asm!("/*{}*/", inout(reg) x=&gt;y); }
assert!(y.is_null()); // 一种极其曲折的创建空指针的方法
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i32 = 0;
let y: f32;
// 但我们不能像这样将 `i32` 重新解释为 `f32`
unsafe { core::arch::asm!("/* {} */", inout(reg) x=&gt;y); }
// ERROR: incompatible types for asm inout argument
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.register-names"><a class="rule-link" href="#r-asm.register-names" title="asm.register-names"><span>[asm<wbr>.register-names]</span></a>
</div>

<h2 id="寄存器名称"><a class="header" href="#寄存器名称">寄存器名称</a></h2>
<div class="rule" id="r-asm.register-names.supported-register-aliases"><a class="rule-link" href="#r-asm.register-names.supported-register-aliases" title="asm.register-names.supported-register-aliases"><span>[asm<wbr>.register-names<wbr>.supported-register-aliases]</span></a>
</div>

<p>有些寄存器有多个名称。编译器将这些名称都视为与基本寄存器名称相同。以下是所有受支持的寄存器别名列表：</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>架构</th><th>基本寄存器</th><th>别名</th></tr>
</thead>
<tbody>
<tr><td>x86</td><td><code>ax</code></td><td><code>eax</code>, <code>rax</code></td></tr>
<tr><td>x86</td><td><code>bx</code></td><td><code>ebx</code>, <code>rbx</code></td></tr>
<tr><td>x86</td><td><code>cx</code></td><td><code>ecx</code>, <code>rcx</code></td></tr>
<tr><td>x86</td><td><code>dx</code></td><td><code>edx</code>, <code>rdx</code></td></tr>
<tr><td>x86</td><td><code>si</code></td><td><code>esi</code>, <code>rsi</code></td></tr>
<tr><td>x86</td><td><code>di</code></td><td><code>edi</code>, <code>rdi</code></td></tr>
<tr><td>x86</td><td><code>bp</code></td><td><code>bpl</code>, <code>ebp</code>, <code>rbp</code></td></tr>
<tr><td>x86</td><td><code>sp</code></td><td><code>spl</code>, <code>esp</code>, <code>rsp</code></td></tr>
<tr><td>x86</td><td><code>ip</code></td><td><code>eip</code>, <code>rip</code></td></tr>
<tr><td>x86</td><td><code>st(0)</code></td><td><code>st</code></td></tr>
<tr><td>x86</td><td><code>r[8-15]</code></td><td><code>r[8-15]b</code>, <code>r[8-15]w</code>, <code>r[8-15]d</code></td></tr>
<tr><td>x86</td><td><code>xmm[0-31]</code></td><td><code>ymm[0-31]</code>, <code>zmm[0-31]</code></td></tr>
<tr><td>AArch64</td><td><code>x[0-30]</code></td><td><code>w[0-30]</code></td></tr>
<tr><td>AArch64</td><td><code>x29</code></td><td><code>fp</code></td></tr>
<tr><td>AArch64</td><td><code>x30</code></td><td><code>lr</code></td></tr>
<tr><td>AArch64</td><td><code>sp</code></td><td><code>wsp</code></td></tr>
<tr><td>AArch64</td><td><code>xzr</code></td><td><code>wzr</code></td></tr>
<tr><td>AArch64</td><td><code>v[0-31]</code></td><td><code>b[0-31]</code>, <code>h[0-31]</code>, <code>s[0-31]</code>, <code>d[0-31]</code>, <code>q[0-31]</code></td></tr>
<tr><td>Arm64EC</td><td><code>x[0-30]</code></td><td><code>w[0-30]</code></td></tr>
<tr><td>Arm64EC</td><td><code>x29</code></td><td><code>fp</code></td></tr>
<tr><td>Arm64EC</td><td><code>x30</code></td><td><code>lr</code></td></tr>
<tr><td>Arm64EC</td><td><code>sp</code></td><td><code>wsp</code></td></tr>
<tr><td>Arm64EC</td><td><code>xzr</code></td><td><code>wzr</code></td></tr>
<tr><td>Arm64EC</td><td><code>v[0-15]</code></td><td><code>b[0-15]</code>, <code>h[0-15]</code>, <code>s[0-15]</code>, <code>d[0-15]</code>, <code>q[0-15]</code></td></tr>
<tr><td>ARM</td><td><code>r[0-3]</code></td><td><code>a[1-4]</code></td></tr>
<tr><td>ARM</td><td><code>r[4-9]</code></td><td><code>v[1-6]</code></td></tr>
<tr><td>ARM</td><td><code>r9</code></td><td><code>rfp</code></td></tr>
<tr><td>ARM</td><td><code>r10</code></td><td><code>sl</code></td></tr>
<tr><td>ARM</td><td><code>r11</code></td><td><code>fp</code></td></tr>
<tr><td>ARM</td><td><code>r12</code></td><td><code>ip</code></td></tr>
<tr><td>ARM</td><td><code>r13</code></td><td><code>sp</code></td></tr>
<tr><td>ARM</td><td><code>r14</code></td><td><code>lr</code></td></tr>
<tr><td>ARM</td><td><code>r15</code></td><td><code>pc</code></td></tr>
<tr><td>RISC-V</td><td><code>x0</code></td><td><code>zero</code></td></tr>
<tr><td>RISC-V</td><td><code>x1</code></td><td><code>ra</code></td></tr>
<tr><td>RISC-V</td><td><code>x2</code></td><td><code>sp</code></td></tr>
<tr><td>RISC-V</td><td><code>x3</code></td><td><code>gp</code></td></tr>
<tr><td>RISC-V</td><td><code>x4</code></td><td><code>tp</code></td></tr>
<tr><td>RISC-V</td><td><code>x[5-7]</code></td><td><code>t[0-2]</code></td></tr>
<tr><td>RISC-V</td><td><code>x8</code></td><td><code>fp</code>, <code>s0</code></td></tr>
<tr><td>RISC-V</td><td><code>x9</code></td><td><code>s1</code></td></tr>
<tr><td>RISC-V</td><td><code>x[10-17]</code></td><td><code>a[0-7]</code></td></tr>
<tr><td>RISC-V</td><td><code>x[18-27]</code></td><td><code>s[2-11]</code></td></tr>
<tr><td>RISC-V</td><td><code>x[28-31]</code></td><td><code>t[3-6]</code></td></tr>
<tr><td>RISC-V</td><td><code>f[0-7]</code></td><td><code>ft[0-7]</code></td></tr>
<tr><td>RISC-V</td><td><code>f[8-9]</code></td><td><code>fs[0-1]</code></td></tr>
<tr><td>RISC-V</td><td><code>f[10-17]</code></td><td><code>fa[0-7]</code></td></tr>
<tr><td>RISC-V</td><td><code>f[18-27]</code></td><td><code>fs[2-11]</code></td></tr>
<tr><td>RISC-V</td><td><code>f[28-31]</code></td><td><code>ft[8-11]</code></td></tr>
<tr><td>LoongArch</td><td><code>$r0</code></td><td><code>$zero</code></td></tr>
<tr><td>LoongArch</td><td><code>$r1</code></td><td><code>$ra</code></td></tr>
<tr><td>LoongArch</td><td><code>$r2</code></td><td><code>$tp</code></td></tr>
<tr><td>LoongArch</td><td><code>$r3</code></td><td><code>$sp</code></td></tr>
<tr><td>LoongArch</td><td><code>$r[4-11]</code></td><td><code>$a[0-7]</code></td></tr>
<tr><td>LoongArch</td><td><code>$r[12-20]</code></td><td><code>$t[0-8]</code></td></tr>
<tr><td>LoongArch</td><td><code>$r21</code></td><td></td></tr>
<tr><td>LoongArch</td><td><code>$r22</code></td><td><code>$fp</code>, <code>$s9</code></td></tr>
<tr><td>LoongArch</td><td><code>$r[23-31]</code></td><td><code>$s[0-8]</code></td></tr>
<tr><td>LoongArch</td><td><code>$f[0-7]</code></td><td><code>$fa[0-7]</code></td></tr>
<tr><td>LoongArch</td><td><code>$f[8-23]</code></td><td><code>$ft[0-15]</code></td></tr>
<tr><td>LoongArch</td><td><code>$f[24-31]</code></td><td><code>$fs[0-7]</code></td></tr>
</tbody>
</table>
</div>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let z = 0i64;
// rax 是 eax 和 ax 的别名
unsafe { core::arch::asm!("", in("rax") z); }
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.register-names.not-for-io"><a class="rule-link" href="#r-asm.register-names.not-for-io" title="asm.register-names.not-for-io"><span>[asm<wbr>.register-names<wbr>.not-for-io]</span></a>
</div>

<p>某些寄存器不能用于输入或输出操作数：</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>架构</th><th>不受支持的寄存器</th><th>原因</th></tr>
</thead>
<tbody>
<tr><td>All</td><td><code>sp</code>, <code>r15</code> (s390x)</td><td>栈指针必须在汇编代码结束时或跳转到 <code>label</code> 块之前恢复其原始值。</td></tr>
<tr><td>All</td><td><code>bp</code> (x86), <code>x29</code> (AArch64 和 Arm64EC), <code>x8</code> (RISC-V), <code>$fp</code> (LoongArch), <code>r11</code> (s390x)</td><td>帧指针不能用作输入或输出。</td></tr>
<tr><td>ARM</td><td><code>r7</code> 或 <code>r11</code></td><td>在 ARM 上，帧指针可以是 <code>r7</code> 或 <code>r11</code>，具体取决于 target。帧指针不能用作输入或输出。</td></tr>
<tr><td>All</td><td><code>si</code> (x86-32), <code>bx</code> (x86-64), <code>r6</code> (ARM), <code>x19</code> (AArch64 和 Arm64EC), <code>x9</code> (RISC-V), <code>$s8</code> (LoongArch)</td><td>LLVM 内部将其用作具有复杂栈帧的函数的 “base pointer” 。</td></tr>
<tr><td>x86</td><td><code>ip</code></td><td>这是程序计数器，不是真实的寄存器。</td></tr>
<tr><td>AArch64</td><td><code>xzr</code></td><td>这是一个常量零寄存器，无法修改。</td></tr>
<tr><td>AArch64</td><td><code>x18</code></td><td>在某些 AArch64 target 上，这是操作系统保留的寄存器。</td></tr>
<tr><td>Arm64EC</td><td><code>xzr</code></td><td>这是一个常量零寄存器，无法修改。</td></tr>
<tr><td>Arm64EC</td><td><code>x18</code></td><td>这是一个操作系统保留的寄存器。</td></tr>
<tr><td>Arm64EC</td><td><code>x13</code>, <code>x14</code>, <code>x23</code>, <code>x24</code>, <code>x28</code>, <code>v[16-31]</code>, <code>p[0-15]</code>, <code>ffr</code></td><td>这些是 Arm64EC 不支持的 AArch64 寄存器。</td></tr>
<tr><td>ARM</td><td><code>pc</code></td><td>这是程序计数器，不是真实的寄存器。</td></tr>
<tr><td>ARM</td><td><code>r9</code></td><td>在某些 ARM target 上，这是操作系统保留的寄存器。</td></tr>
<tr><td>RISC-V</td><td><code>x0</code></td><td>这是一个常量零寄存器，无法修改。</td></tr>
<tr><td>RISC-V</td><td><code>gp</code>, <code>tp</code></td><td>这些寄存器是保留的，不能用作输入或输出。</td></tr>
<tr><td>LoongArch</td><td><code>$r0</code> 或 <code>$zero</code></td><td>这是一个常量零寄存器，无法修改。</td></tr>
<tr><td>LoongArch</td><td><code>$r2</code> 或 <code>$tp</code></td><td>这是为 TLS 保留的。</td></tr>
<tr><td>LoongArch</td><td><code>$r21</code></td><td>这是由 ABI 保留的。</td></tr>
<tr><td>s390x</td><td><code>c[0-15]</code></td><td>由内核保留。</td></tr>
<tr><td>s390x</td><td><code>a[0-1]</code></td><td>保留供系统使用。</td></tr>
</tbody>
</table>
</div>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// bp 是保留的
unsafe { core::arch::asm!("", in("bp") 5i32); }
// ERROR: invalid register `bp`: the frame pointer cannot be used as an operand for inline asm
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.register-names.fp-bp-reserved"><a class="rule-link" href="#r-asm.register-names.fp-bp-reserved" title="asm.register-names.fp-bp-reserved"><span>[asm<wbr>.register-names<wbr>.fp-bp-reserved]</span></a>
</div>

<p>帧指针和基指针寄存器保留供 LLVM 内部使用。虽然 <code>asm!</code> 语句不能显式指定使用保留寄存器，但在某些情况下，LLVM 会为 <code>reg</code> 操作数分配这些保留寄存器之一。使用保留寄存器的汇编代码应当小心，因为 <code>reg</code> 操作数可能会使用相同的寄存器。</p>
<div class="rule" id="r-asm.template-modifiers"><a class="rule-link" href="#r-asm.template-modifiers" title="asm.template-modifiers"><span>[asm<wbr>.template-modifiers]</span></a>
</div>

<h2 id="模板修饰符"><a class="header" href="#模板修饰符">模板修饰符</a></h2>
<div class="rule" id="r-asm.template-modifiers.intro"><a class="rule-link" href="#r-asm.template-modifiers.intro" title="asm.template-modifiers.intro"><span>[asm<wbr>.template-modifiers<wbr>.intro]</span></a>
</div>

<p>占位符可以通过修饰符进行增强，修饰符在花括号中的 <code>:</code> 之后指定。这些修饰符不影响寄存器分配，但会改变操作数在插入模板字符串时的格式化方式。</p>
<div class="rule" id="r-asm.template-modifiers.only-one"><a class="rule-link" href="#r-asm.template-modifiers.only-one" title="asm.template-modifiers.only-one"><span>[asm<wbr>.template-modifiers<wbr>.only-one]</span></a>
</div>

<p>每个模板占位符仅允许使用一个修饰符。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// 我们不能同时指定 `r` 和 `e`。
unsafe { core::arch::asm!("/* {:er}", in(reg) 5i32); }
// ERROR: asm template modifier must be a single character
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.template-modifiers.supported-modifiers"><a class="rule-link" href="#r-asm.template-modifiers.supported-modifiers" title="asm.template-modifiers.supported-modifiers"><span>[asm<wbr>.template-modifiers<wbr>.supported-modifiers]</span></a>
</div>

<p>支持的修饰符是 LLVM（和 GCC）<a href="http://llvm.org/docs/LangRef.html#asm-template-argument-modifiers">汇编模板参数修饰符</a> 的子集，但不使用相同的字母代码。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>架构</th><th>寄存器类</th><th>修饰符</th><th>示例输出</th><th>LLVM 修饰符</th></tr>
</thead>
<tbody>
<tr><td>x86-32</td><td><code>reg</code></td><td>None</td><td><code>eax</code></td><td><code>k</code></td></tr>
<tr><td>x86-64</td><td><code>reg</code></td><td>None</td><td><code>rax</code></td><td><code>q</code></td></tr>
<tr><td>x86-32</td><td><code>reg_abcd</code></td><td><code>l</code></td><td><code>al</code></td><td><code>b</code></td></tr>
<tr><td>x86-64</td><td><code>reg</code></td><td><code>l</code></td><td><code>al</code></td><td><code>b</code></td></tr>
<tr><td>x86</td><td><code>reg_abcd</code></td><td><code>h</code></td><td><code>ah</code></td><td><code>h</code></td></tr>
<tr><td>x86</td><td><code>reg</code></td><td><code>x</code></td><td><code>ax</code></td><td><code>w</code></td></tr>
<tr><td>x86</td><td><code>reg</code></td><td><code>e</code></td><td><code>eax</code></td><td><code>k</code></td></tr>
<tr><td>x86-64</td><td><code>reg</code></td><td><code>r</code></td><td><code>rax</code></td><td><code>q</code></td></tr>
<tr><td>x86</td><td><code>reg_byte</code></td><td>None</td><td><code>al</code> / <code>ah</code></td><td>None</td></tr>
<tr><td>x86</td><td><code>xmm_reg</code></td><td>None</td><td><code>xmm0</code></td><td><code>x</code></td></tr>
<tr><td>x86</td><td><code>ymm_reg</code></td><td>None</td><td><code>ymm0</code></td><td><code>t</code></td></tr>
<tr><td>x86</td><td><code>zmm_reg</code></td><td>None</td><td><code>zmm0</code></td><td><code>g</code></td></tr>
<tr><td>x86</td><td><code>*mm_reg</code></td><td><code>x</code></td><td><code>xmm0</code></td><td><code>x</code></td></tr>
<tr><td>x86</td><td><code>*mm_reg</code></td><td><code>y</code></td><td><code>ymm0</code></td><td><code>t</code></td></tr>
<tr><td>x86</td><td><code>*mm_reg</code></td><td><code>z</code></td><td><code>zmm0</code></td><td><code>g</code></td></tr>
<tr><td>x86</td><td><code>kreg</code></td><td>None</td><td><code>k1</code></td><td>None</td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>reg</code></td><td>None</td><td><code>x0</code></td><td><code>x</code></td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>reg</code></td><td><code>w</code></td><td><code>w0</code></td><td><code>w</code></td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>reg</code></td><td><code>x</code></td><td><code>x0</code></td><td><code>x</code></td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>vreg</code></td><td>None</td><td><code>v0</code></td><td>None</td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>vreg</code></td><td><code>v</code></td><td><code>v0</code></td><td>None</td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>vreg</code></td><td><code>b</code></td><td><code>b0</code></td><td><code>b</code></td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>vreg</code></td><td><code>h</code></td><td><code>h0</code></td><td><code>h</code></td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>vreg</code></td><td><code>s</code></td><td><code>s0</code></td><td><code>s</code></td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>vreg</code></td><td><code>d</code></td><td><code>d0</code></td><td><code>d</code></td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>vreg</code></td><td><code>q</code></td><td><code>q0</code></td><td><code>q</code></td></tr>
<tr><td>ARM</td><td><code>reg</code></td><td>None</td><td><code>r0</code></td><td>None</td></tr>
<tr><td>ARM</td><td><code>sreg</code></td><td>None</td><td><code>s0</code></td><td>None</td></tr>
<tr><td>ARM</td><td><code>dreg</code></td><td>None</td><td><code>d0</code></td><td><code>P</code></td></tr>
<tr><td>ARM</td><td><code>qreg</code></td><td>None</td><td><code>q0</code></td><td><code>q</code></td></tr>
<tr><td>ARM</td><td><code>qreg</code></td><td><code>e</code> / <code>f</code></td><td><code>d0</code> / <code>d1</code></td><td><code>e</code> / <code>f</code></td></tr>
<tr><td>RISC-V</td><td><code>reg</code></td><td>None</td><td><code>x1</code></td><td>None</td></tr>
<tr><td>RISC-V</td><td><code>freg</code></td><td>None</td><td><code>f0</code></td><td>None</td></tr>
<tr><td>LoongArch</td><td><code>reg</code></td><td>None</td><td><code>$r1</code></td><td>None</td></tr>
<tr><td>LoongArch</td><td><code>freg</code></td><td>None</td><td><code>$f0</code></td><td>None</td></tr>
<tr><td>s390x</td><td><code>reg</code></td><td>None</td><td><code>%r0</code></td><td>None</td></tr>
<tr><td>s390x</td><td><code>reg_addr</code></td><td>None</td><td><code>%r1</code></td><td>None</td></tr>
<tr><td>s390x</td><td><code>freg</code></td><td>None</td><td><code>%f0</code></td><td>None</td></tr>
</tbody>
</table>
</div>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<ul>
<li>在 ARM 上 <code>e</code> / <code>f</code>：这会打印 NEON quad (128-bit) 寄存器的低双字或高双字寄存器名称。</li>
<li>在 x86 上：我们对不带修饰符的 <code>reg</code> 的行为与 GCC 所做的不同。GCC 将根据操作数值类型推断修饰符，而我们默认使用完整的寄存器大小。</li>
<li>在 x86 <code>xmm_reg</code> 上：<code>x</code>、<code>t</code> 和 <code>g</code> LLVM 修饰符尚未在 LLVM 中实现（它们仅受 GCC 支持），但这应该是一个简单的改动。</li>
</ul>
</blockquote>
</div>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let mut x = 0x10u16;

// 使用 `xchg` 的 u16::swap_bytes
// `{x}` 的低半部分由 `{x:l}` 引用，高半部分由 `{x:h}` 引用
unsafe { core::arch::asm!("xchg {x:l}, {x:h}", x = inout(reg_abcd) x); }
assert_eq!(x, 0x1000u16);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.template-modifiers.smaller-value"><a class="rule-link" href="#r-asm.template-modifiers.smaller-value" title="asm.template-modifiers.smaller-value"><span>[asm<wbr>.template-modifiers<wbr>.smaller-value]</span></a>
</div>

<p>如上一节所述，传递小于寄存器宽度的输入值将导致寄存器的高位包含未定义的值。如果内联汇编仅访问寄存器的低位，这就不是问题，可以通过使用模板修饰符在汇编代码中使用子寄存器名称（例如使用 <code>ax</code> 而不是 <code>rax</code>）来实现。由于这是一个容易掉进去的陷阱，编译器将根据输入类型建议在适当的地方使用模板修饰符。如果对操作数的所有引用都已经有了修饰符，则会抑制该操作数的警告。</p>
<div class="rule" id="r-asm.abi-clobbers"><a class="rule-link" href="#r-asm.abi-clobbers" title="asm.abi-clobbers"><span>[asm<wbr>.abi-clobbers]</span></a>
</div>

<h2 id="abi破坏列表"><a class="header" href="#abi破坏列表">ABI破坏列表</a></h2>
<div class="rule" id="r-asm.abi-clobbers.intro"><a class="rule-link" href="#r-asm.abi-clobbers.intro" title="asm.abi-clobbers.intro"><span>[asm<wbr>.abi-clobbers<wbr>.intro]</span></a>
</div>

<p><code>clobber_abi</code> 关键字可用于为汇编代码应用一组默认的破坏列表。这将根据调用具有特定调用约定（calling convention）的函数自动插入必要的破坏约束：如果调用约定不能在调用过程中完全保留寄存器的值，则会隐式地将 <code>lateout("...") _</code> 添加到操作数列表中（其中 <code>...</code> 被替换为寄存器的名称）。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>extern "C" fn foo() -&gt; i32 { 0 }

let z: i32;
// 要调用函数，我们必须告知编译器我们正在破坏
// 被调用者保存的寄存器
unsafe { core::arch::asm!("call {}", sym foo, out("rax") z, clobber_abi("C")); }
assert_eq!(z, 0);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.abi-clobbers.many"><a class="rule-link" href="#r-asm.abi-clobbers.many" title="asm.abi-clobbers.many"><span>[asm<wbr>.abi-clobbers<wbr>.many]</span></a>
</div>

<p><code>clobber_abi</code> 可以指定任意次数。它将为所有指定调用约定的并集中的所有唯一寄存器插入一个破坏列表。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>extern "sysv64" fn foo() -&gt; i32 { 0 }
extern "win64" fn bar(x: i32) -&gt; i32 { x + 1}

let z: i32;
// 我们甚至可以调用多个具有不同约定和
// 不同保存寄存器的函数
unsafe {
    core::arch::asm!(
        "call {}",
        "mov ecx, eax",
        "call {}",
        sym foo,
        sym bar,
        out("rax") z,
        clobber_abi("C")
    );
}
assert_eq!(z, 1);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.abi-clobbers.must-specify"><a class="rule-link" href="#r-asm.abi-clobbers.must-specify" title="asm.abi-clobbers.must-specify"><span>[asm<wbr>.abi-clobbers<wbr>.must-specify]</span></a>
</div>

<p>当使用 <code>clobber_abi</code> 时，编译器不允许泛型寄存器类输出：所有输出必须指定显式寄存器。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>extern "C" fn foo(x: i32) -&gt; i32 { 0 }

let z: i32;
// 必须使用显式寄存器以免意外重叠。
unsafe {
    core::arch::asm!(
        "mov eax, {:e}",
        "call {}",
        out(reg) z,
        sym foo,
        clobber_abi("C")
    );
    // ERROR: asm with `clobber_abi` must specify explicit registers for outputs
}
assert_eq!(z, 0);
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.abi-clobbers.explicit-have-precedence"><a class="rule-link" href="#r-asm.abi-clobbers.explicit-have-precedence" title="asm.abi-clobbers.explicit-have-precedence"><span>[asm<wbr>.abi-clobbers<wbr>.explicit-have-precedence]</span></a>
</div>

<p>显式寄存器输出优先于由 <code>clobber_abi</code> 插入的隐式破坏列表：仅当寄存器未用作输出时，才会为该寄存器插入破坏列表。</p>
<div class="rule" id="r-asm.abi-clobbers.supported-abis"><a class="rule-link" href="#r-asm.abi-clobbers.supported-abis" title="asm.abi-clobbers.supported-abis"><span>[asm<wbr>.abi-clobbers<wbr>.supported-abis]</span></a>
</div>

<p>以下 ABI 可与 <code>clobber_abi</code> 一起使用：</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>架构</th><th>ABI 名称</th><th>被破坏的寄存器</th></tr>
</thead>
<tbody>
<tr><td>x86-32</td><td><code>"C"</code>, <code>"system"</code>, <code>"efiapi"</code>, <code>"cdecl"</code>, <code>"stdcall"</code>, <code>"fastcall"</code></td><td><code>ax</code>, <code>cx</code>, <code>dx</code>, <code>xmm[0-7]</code>, <code>mm[0-7]</code>, <code>k[0-7]</code>, <code>st([0-7])</code></td></tr>
<tr><td>x86-64</td><td><code>"C"</code>, <code>"system"</code> (在 Windows 上), <code>"efiapi"</code>, <code>"win64"</code></td><td><code>ax</code>, <code>cx</code>, <code>dx</code>, <code>r[8-11]</code>, <code>xmm[0-31]</code>, <code>mm[0-7]</code>, <code>k[0-7]</code>, <code>st([0-7])</code>, <code>tmm[0-7]</code></td></tr>
<tr><td>x86-64</td><td><code>"C"</code>, <code>"system"</code> (在非 Windows 上), <code>"sysv64"</code></td><td><code>ax</code>, <code>cx</code>, <code>dx</code>, <code>si</code>, <code>di</code>, <code>r[8-11]</code>, <code>xmm[0-31]</code>, <code>mm[0-7]</code>, <code>k[0-7]</code>, <code>st([0-7])</code>, <code>tmm[0-7]</code></td></tr>
<tr><td>AArch64</td><td><code>"C"</code>, <code>"system"</code>, <code>"efiapi"</code></td><td><code>x[0-17]</code>, <code>x18</code>*, <code>x30</code>, <code>v[0-31]</code>, <code>p[0-15]</code>, <code>ffr</code></td></tr>
<tr><td>Arm64EC</td><td><code>"C"</code>, <code>"system"</code></td><td><code>x[0-12]</code>, <code>x[15-17]</code>, <code>x30</code>, <code>v[0-15]</code></td></tr>
<tr><td>ARM</td><td><code>"C"</code>, <code>"system"</code>, <code>"efiapi"</code>, <code>"aapcs"</code></td><td><code>r[0-3]</code>, <code>r12</code>, <code>r14</code>, <code>s[0-15]</code>, <code>d[0-7]</code>, <code>d[16-31]</code></td></tr>
<tr><td>RISC-V</td><td><code>"C"</code>, <code>"system"</code>, <code>"efiapi"</code></td><td><code>x1</code>, <code>x[5-7]</code>, <code>x[10-17]</code>*, <code>x[28-31]</code>*, <code>f[0-7]</code>, <code>f[10-17]</code>, <code>f[28-31]</code>, <code>v[0-31]</code></td></tr>
<tr><td>LoongArch</td><td><code>"C"</code>, <code>"system"</code></td><td><code>$r1</code>, <code>$r[4-20]</code>, <code>$f[0-23]</code></td></tr>
<tr><td>s390x</td><td><code>"C"</code>, <code>"system"</code></td><td><code>r[0-5]</code>, <code>r14</code>, <code>f[0-7]</code>, <code>v[0-31]</code>, <code>a[2-15]</code></td></tr>
</tbody>
</table>
</div>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<ul>
<li>在 AArch64 上，仅当 <code>x18</code> 在 target 上不被视为保留寄存器时，才将其包含在破坏列表中。</li>
<li>在 RISC-V 上，仅当 <code>x[16-17]</code> 和 <code>x[28-31]</code> 在 target 上不被视为保留寄存器时，才将其包含在破坏列表中。</li>
</ul>
</blockquote>
</div>

<p>随着架构获得新寄存器，rustc 会更新每个 ABI 的破坏寄存器列表：这确保了当 LLVM 开始在其生成的代码中使用这些新寄存器时，<code>asm!</code> 破坏列表将继续保持正确。</p>
<div class="rule" id="r-asm.options"><a class="rule-link" href="#r-asm.options" title="asm.options"><span>[asm<wbr>.options]</span></a>
</div>

<h2 id="选项"><a class="header" href="#选项">选项</a></h2>
<div class="rule" id="r-asm.options.supported-options"><a class="rule-link" href="#r-asm.options.supported-options" title="asm.options.supported-options"><span>[asm<wbr>.options<wbr>.supported-options]</span></a>
</div>

<p>标志用于进一步影响内联汇编代码的行为。目前定义了以下选项：</p>
<div class="rule" id="r-asm.options.supported-options.pure"><a class="rule-link" href="#r-asm.options.supported-options.pure" title="asm.options.supported-options.pure"><span>[asm<wbr>.options<wbr>.supported-options<wbr>.pure]</span></a>
</div>

<ul>
<li><code>pure</code>：汇编代码没有副作用，必须最终返回，并且其输出仅取决于其直接输入（即值本身，而不是它们指向的内容）或从内存读取的值（除非还设置了 <code>nomem</code> 选项）。这允许编译器执行汇编代码的次数少于程序中指定的次数（例如通过将其提升到循环之外），或者如果输出未被使用，甚至可以完全消除它。<code>pure</code> 选项必须与 <code>nomem</code> 或 <code>readonly</code> 选项之一结合使用，否则会发出编译时错误。</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i32 = 0;
let z: i32;
// `pure` 可用于通过假设汇编没有副作用来进行优化
unsafe { core::arch::asm!("inc {}", inout(reg) x =&gt; z, options(pure, nomem)); }
assert_eq!(z, 1);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i32 = 0;
let z: i32;
// 必须满足 `nomem` 或 `readonly` 之一，以指示是否
// 允许读取内存
unsafe { core::arch::asm!("inc {}", inout(reg) x =&gt; z, options(pure)); }
// ERROR: the `pure` option must be combined with either `nomem` or `readonly`
assert_eq!(z, 0);
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.options.supported-options.nomem"><a class="rule-link" href="#r-asm.options.supported-options.nomem" title="asm.options.supported-options.nomem"><span>[asm<wbr>.options<wbr>.supported-options<wbr>.nomem]</span></a>
</div>

<ul>
<li><code>nomem</code>：汇编代码不会读取或写入汇编代码之外可访问的任何内存。这允许编译器在执行汇编代码期间将修改后的全局变量的值缓存在寄存器中，因为它知道汇编代码不会读取或写入它们。编译器还假设汇编代码不会与其他线程执行任何形式的同步，例如通过内存屏障（fence）。</li>
</ul>
<!-- no_run: This test has unpredictable or undefined behavior at runtime -->
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let mut x = 0i32;
let z: i32;
// 当指定 `nomem` 时，不允许从汇编访问外部内存
unsafe {
    core::arch::asm!("mov {val:e}, dword ptr [{ptr}]",
        ptr = in(reg) &amp;mut x,
        val = lateout(reg) z,
        options(nomem)
    )
}

// 当指定 `nomem` 时，从汇编写入外部内存也是未定义行为
unsafe {
    core::arch::asm!("mov  dword ptr [{ptr}], {val:e}",
        ptr = in(reg) &amp;mut x,
        val = in(reg) z,
        options(nomem)
    )
}
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i32 = 0;
let z: i32;
// 然而，如果我们分配自己的内存，例如通过 `push`。
// 我们仍然可以使用它
unsafe {
    core::arch::asm!("push {x}", "add qword ptr [rsp], 1", "pop {x}",
        x = inout(reg) x =&gt; z,
        options(nomem)
    );
}
assert_eq!(z, 1);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.options.supported-options.readonly"><a class="rule-link" href="#r-asm.options.supported-options.readonly" title="asm.options.supported-options.readonly"><span>[asm<wbr>.options<wbr>.supported-options<wbr>.readonly]</span></a>
</div>

<ul>
<li><code>readonly</code>：汇编代码不会写入汇编代码之外可访问的任何内存。这允许编译器在执行汇编代码期间将未修改的全局变量的值缓存在寄存器中，因为它知道汇编代码不会写入它们。编译器还假设此汇编代码不会与其他线程执行任何形式的同步，例如通过内存屏障。</li>
</ul>
<!-- no_run: This test has undefined behaviour at runtime -->
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let mut x = 0;
// 当指定 `readonly` 时，我们不能修改外部内存
unsafe {
    core::arch::asm!("mov dword ptr[{}], 1", in(reg) &amp;mut x, options(readonly))
}
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i64 = 0;
let z: i64;
// 不过我们仍然可以从中读取
unsafe {
    core::arch::asm!("mov {x}, qword ptr [{x}]",
        x = inout(reg) &amp;x =&gt; z,
        options(readonly)
    );
}
assert_eq!(z, 0);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i64 = 0;
let z: i64;
// 与 `nomem` 相同的例外也适用。
unsafe {
    core::arch::asm!("push {x}", "add qword ptr [rsp], 1", "pop {x}",
        x = inout(reg) x =&gt; z,
        options(readonly)
    );
}
assert_eq!(z, 1);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.options.supported-options.preserves_flags"><a class="rule-link" href="#r-asm.options.supported-options.preserves_flags" title="asm.options.supported-options.preserves_flags"><span>[asm<wbr>.options<wbr>.supported-options<wbr>.preserves_flags]</span></a>
</div>

<ul>
<li><code>preserves_flags</code>：汇编代码不修改标志寄存器（在下面的规则中定义）。这允许编译器避免在执行汇编代码后重新计算条件标志。</li>
</ul>
<div class="rule" id="r-asm.options.supported-options.noreturn"><a class="rule-link" href="#r-asm.options.supported-options.noreturn" title="asm.options.supported-options.noreturn"><span>[asm<wbr>.options<wbr>.supported-options<wbr>.noreturn]</span></a>
</div>

<ul>
<li><code>noreturn</code>：汇编代码不会顺序执行（fall through）；如果它这样做，则行为是未定义的。它仍然可以跳转到 <code>label</code> 块。如果任何 <code>label</code> 块返回单元类型，则 <code>asm!</code> 块将返回单元类型。否则它将返回 <code>!</code>（从不）。与调用不返回的函数一样，作用域内的局部变量在执行汇编代码之前不会被丢弃。</li>
</ul>
<!-- no_run: This test aborts at runtime -->
<pre class="playground"><code class="language-rust no_run edition2024">fn main() -&gt; ! {
<span class="boring">#[cfg(target_arch = "x86_64")] {
</span>    // 我们可以在 `noreturn` 块内使用一条指令来捕获执行
    unsafe { core::arch::asm!("ud2", options(noreturn)); }
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] panic!("no return");
</span>}</code></pre>
<!-- no_run: Test has undefined behavior at runtime -->
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// 您负责确保执行不会越过 `noreturn` 汇编块的末尾
unsafe { core::arch::asm!("", options(noreturn)); }
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")]
</span>let _: () = unsafe {
    // 您仍然可以跳转到 `label` 块
    core::arch::asm!("jmp {}", label {
        println!();
    }, options(noreturn));
};
<span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.options.supported-options.nostack"><a class="rule-link" href="#r-asm.options.supported-options.nostack" title="asm.options.supported-options.nostack"><span>[asm<wbr>.options<wbr>.supported-options<wbr>.nostack]</span></a>
</div>

<ul>
<li><code>nostack</code>：汇编代码不会将数据压入栈，也不会写入栈红区（red-zone）（如果 target 支持）。如果 <em>不</em> 使用此选项，则编译器保证在汇编代码开始时，栈指针已（根据 target ABI）适当对齐，以便进行函数调用。</li>
</ul>
<!-- no_run: Test has undefined behavior at runtime -->
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// `push` 和 `pop` 在与 `nostack` 一起使用时是未定义行为
unsafe { core::arch::asm!("push rax", "pop rax", options(nostack)); }
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.options.supported-options.att_syntax"><a class="rule-link" href="#r-asm.options.supported-options.att_syntax" title="asm.options.supported-options.att_syntax"><span>[asm<wbr>.options<wbr>.supported-options<wbr>.att_syntax]</span></a>
</div>

<ul>
<li><code>att_syntax</code>：此选项仅在 x86 上有效，并导致汇编器使用 GNU 汇编器的 <code>.att_syntax prefix</code> 模式。替换进来的寄存器操作数带有一个前导 <code>%</code>。</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i32;
let y = 1i32;
// 我们在这里需要使用 AT&amp;T 语法。操作数的顺序是源、目的
unsafe {
    core::arch::asm!("mov {y:e}, {x:e}",
        x = lateout(reg) x,
        y = in(reg) y,
        options(att_syntax)
    );
}
assert_eq!(x, y);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.options.supported-options.raw"><a class="rule-link" href="#r-asm.options.supported-options.raw" title="asm.options.supported-options.raw"><span>[asm<wbr>.options<wbr>.supported-options<wbr>.raw]</span></a>
</div>

<ul>
<li><code>raw</code>：这导致模板字符串被解析为原始汇编字符串，不对 <code>{</code> 和 <code>}</code> 进行特殊处理。这在通过 <code>include_str!</code> 从外部文件包含原始汇编代码时特别有用。</li>
</ul>
<div class="rule" id="r-asm.options.checks"><a class="rule-link" href="#r-asm.options.checks" title="asm.options.checks"><span>[asm<wbr>.options<wbr>.checks]</span></a>
</div>

<p>编译器对选项执行一些额外的检查：</p>
<div class="rule" id="r-asm.options.checks.mutually-exclusive"><a class="rule-link" href="#r-asm.options.checks.mutually-exclusive" title="asm.options.checks.mutually-exclusive"><span>[asm<wbr>.options<wbr>.checks<wbr>.mutually-exclusive]</span></a>
</div>

<ul>
<li><code>nomem</code> 和 <code>readonly</code> 选项是互斥的：同时指定两者是一个编译时错误。</li>
</ul>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// `nomem` 严格强于 `readonly` ，它们不能同时指定
unsafe { core::arch::asm!("", options(nomem, readonly)); }
// ERROR: the `nomem` and `readonly` options are mutually exclusive
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.options.checks.pure"><a class="rule-link" href="#r-asm.options.checks.pure" title="asm.options.checks.pure"><span>[asm<wbr>.options<wbr>.checks<wbr>.pure]</span></a>
</div>

<ul>
<li>在没有输出或只有被丢弃的输出（<code>_</code>）的汇编块上指定 <code>pure</code> 是一个编译时错误。</li>
</ul>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// `pure` 块需要至少一个输出
unsafe { core::arch::asm!("", options(pure)); }
// ERROR: asm with the `pure` option must have at least one output
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.options.checks.noreturn"><a class="rule-link" href="#r-asm.options.checks.noreturn" title="asm.options.checks.noreturn"><span>[asm<wbr>.options<wbr>.checks<wbr>.noreturn]</span></a>
</div>

<ul>
<li>在具有输出且没有 label 的汇编块上指定 <code>noreturn</code> 是一个编译时错误。</li>
</ul>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let z: i32;
// `noreturn` 不能有输出
unsafe { core::arch::asm!("mov {:e}, 1", out(reg) z, options(noreturn)); }
// ERROR: asm outputs are not allowed with the `noreturn` option
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.options.checks.label-with-outputs"><a class="rule-link" href="#r-asm.options.checks.label-with-outputs" title="asm.options.checks.label-with-outputs"><span>[asm<wbr>.options<wbr>.checks<wbr>.label-with-outputs]</span></a>
</div>

<ul>
<li>在具有输出的汇编块中拥有任何 <code>label</code> 块是一个编译时错误。</li>
</ul>
<div class="rule" id="r-asm.options.naked_asm-restriction"><a class="rule-link" href="#r-asm.options.naked_asm-restriction" title="asm.options.naked_asm-restriction"><span>[asm<wbr>.options<wbr>.naked_asm-restriction]</span></a>
</div>

<p><code>naked_asm!</code> 仅支持 <code>att_syntax</code> 和 <code>raw</code> 选项。其余选项没有意义，因为内联汇编定义了整个函数体。</p>
<div class="rule" id="r-asm.options.global_asm-restriction"><a class="rule-link" href="#r-asm.options.global_asm-restriction" title="asm.options.global_asm-restriction"><span>[asm<wbr>.options<wbr>.global_asm-restriction]</span></a>
</div>

<p><code>global_asm!</code> 仅支持 <code>att_syntax</code> 和 <code>raw</code> 选项。其余选项对于全局作用域内联汇编没有意义。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">fn main() {}
</span><span class="boring">#[cfg(target_arch = "x86_64")]
</span>// `nomem` 在 `global_asm!` 上没有用
core::arch::global_asm!("", options(nomem));
<span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");</span></code></pre>
<div class="rule" id="r-asm.rules"><a class="rule-link" href="#r-asm.rules" title="asm.rules"><span>[asm<wbr>.rules]</span></a>
</div>

<h2 id="内联汇编规则"><a class="header" href="#内联汇编规则">内联汇编规则</a></h2>
<div class="rule" id="r-asm.rules.intro"><a class="rule-link" href="#r-asm.rules.intro" title="asm.rules.intro"><span>[asm<wbr>.rules<wbr>.intro]</span></a>
</div>

<p>为避免未定义行为，在使用函数作用域内联汇编（<code>asm!</code>）时必须遵守以下规则：</p>
<div class="rule" id="r-asm.rules.reg-not-input"><a class="rule-link" href="#r-asm.rules.reg-not-input" title="asm.rules.reg-not-input"><span>[asm<wbr>.rules<wbr>.reg-not-input]</span></a>
</div>

<ul>
<li>任何未指定为输入的寄存器在进入汇编代码时都将包含一个未定义的值。
<ul>
<li>在内联汇编的语境下， “未定义的值” 意味着寄存器可以（非确定性地）具有架构所允许的任何一个可能的值。值得注意的是，它与 LLVM 的 <code>undef</code> 不同，后者每次读取时都可以具有不同的值（因为汇编代码中不存在这样的概念）。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.reg-not-output"><a class="rule-link" href="#r-asm.rules.reg-not-output" title="asm.rules.reg-not-output"><span>[asm<wbr>.rules<wbr>.reg-not-output]</span></a>
</div>

<ul>
<li>任何未指定为输出的寄存器在退出汇编代码时必须具有与进入时相同的值，否则行为是未定义的。
<ul>
<li>这仅适用于可以指定为输入或输出的寄存器。其他寄存器遵循特定于 target 的规则。</li>
<li>请注意，<code>lateout</code> 可能会被分配到与 <code>in</code> 相同的寄存器，在这种情况下，此规则不适用。然而，代码不应依赖于此，因为它取决于寄存器分配的结果。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.unwind"><a class="rule-link" href="#r-asm.rules.unwind" title="asm.rules.unwind"><span>[asm<wbr>.rules<wbr>.unwind]</span></a>
</div>

<ul>
<li>如果执行从汇编代码中展开（unwind），则行为是未定义的。
<ul>
<li>这也适用于汇编代码调用了一个随后发生展开的函数的情况。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.mem-same-as-ffi"><a class="rule-link" href="#r-asm.rules.mem-same-as-ffi" title="asm.rules.mem-same-as-ffi"><span>[asm<wbr>.rules<wbr>.mem-same-as-ffi]</span></a>
</div>

<ul>
<li>汇编代码允许读取和写入的内存位置集与 FFI 函数所允许的相同。
<ul>
<li>如果设置了 <code>readonly</code> 选项，则仅允许读取内存。</li>
<li>如果设置了 <code>nomem</code> 选项，则不允许读取或写入内存。</li>
<li>这些规则不适用于汇编代码私有的内存，例如在其内部分配的栈空间。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.black-box"><a class="rule-link" href="#r-asm.rules.black-box" title="asm.rules.black-box"><span>[asm<wbr>.rules<wbr>.black-box]</span></a>
</div>

<ul>
<li>编译器不能假设汇编代码中的指令就是最终会执行的指令。
<ul>
<li>这实际上意味着编译器必须将汇编代码视为黑盒，仅考虑接口规范，而不是指令本身。</li>
<li>允许通过特定于 target 的机制进行运行时代码补丁。</li>
<li>然而，不保证源代码中的每个汇编代码块都直接对应于目标文件中的单个指令实例；编译器可以自由地复制或去重 <code>asm!</code> 块中的汇编代码。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.stack-below-sp"><a class="rule-link" href="#r-asm.rules.stack-below-sp" title="asm.rules.stack-below-sp"><span>[asm<wbr>.rules<wbr>.stack-below-sp]</span></a>
</div>

<ul>
<li>除非设置了 <code>nostack</code> 选项，否则允许汇编代码使用栈指针下方的栈空间。
<ul>
<li>在进入汇编代码时，栈指针保证已（根据 target ABI）适当对齐，以便进行函数调用。</li>
<li>您负责确保不会发生栈溢出（例如使用栈探测以确保触及保护页）。</li>
<li>您应当根据 target ABI 的要求，在分配栈内存时调整栈指针。</li>
<li>栈指针必须在离开汇编代码之前恢复为其原始值。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.noreturn"><a class="rule-link" href="#r-asm.rules.noreturn" title="asm.rules.noreturn"><span>[asm<wbr>.rules<wbr>.noreturn]</span></a>
</div>

<ul>
<li>如果设置了 <code>noreturn</code> 选项，则如果执行顺序执行到汇编代码末尾，则行为是未定义的。</li>
</ul>
<div class="rule" id="r-asm.rules.pure"><a class="rule-link" href="#r-asm.rules.pure" title="asm.rules.pure"><span>[asm<wbr>.rules<wbr>.pure]</span></a>
</div>

<ul>
<li>如果设置了 <code>pure</code> 选项，则如果 <code>asm!</code> 除了其直接输出之外还有副作用，则行为是未定义的。如果具有相同输入的 <code>asm!</code> 代码的两次执行导致不同的输出，则行为也是未定义的。
<ul>
<li>当与 <code>nomem</code> 选项一起使用时， “输入” 只是 <code>asm!</code> 的直接输入。</li>
<li>当与 <code>readonly</code> 选项一起使用时， “输入” 包括汇编代码的直接输入和它允许读取的任何内存。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.preserved-registers"><a class="rule-link" href="#r-asm.rules.preserved-registers" title="asm.rules.preserved-registers"><span>[asm<wbr>.rules<wbr>.preserved-registers]</span></a>
</div>

<ul>
<li>如果设置了 <code>preserves_flags</code> 选项，则退出汇编代码时必须恢复这些标志寄存器：
<ul>
<li>x86
<ul>
<li><code>EFLAGS</code> 中的状态标志位（CF, PF, AF, ZF, SF, OF）。</li>
<li>浮点状态字（全部）。</li>
<li><code>MXCSR</code> 中的浮点异常标志（PE, UE, OE, ZF, DE, IE）。</li>
</ul>
</li>
<li>ARM
<ul>
<li><code>CPSR</code> 中的条件标志（N, Z, C, V）</li>
<li><code>CPSR</code> 中的饱和标志（Q）</li>
<li><code>CPSR</code> 中的大于或等于标志（GE）。</li>
<li><code>FPSCR</code> 中的条件标志（N, Z, C, V）</li>
<li><code>FPSCR</code> 中的饱和标志（QC）</li>
<li><code>FPSCR</code> 中的浮点异常标志（IDC, IXC, UFC, OFC, DZC, IOC）。</li>
</ul>
</li>
<li>AArch64 和 Arm64EC
<ul>
<li>条件标志（<code>NZCV</code> 寄存器）。</li>
<li>浮点状态（<code>FPSR</code> 寄存器）。</li>
</ul>
</li>
<li>RISC-V
<ul>
<li><code>fcsr</code> 中的浮点异常标志（<code>fflags</code>）。</li>
<li>向量扩展状态（<code>vtype</code>、<code>vl</code>、<code>vxsat</code> 和 <code>vxrm</code>）。</li>
</ul>
</li>
<li>LoongArch
<ul>
<li><code>$fcc[0-7]</code> 中的浮点条件标志。</li>
</ul>
</li>
<li>s390x
<ul>
<li>条件代码寄存器 <code>cc</code>。</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.x86-df"><a class="rule-link" href="#r-asm.rules.x86-df" title="asm.rules.x86-df"><span>[asm<wbr>.rules<wbr>.x86-df]</span></a>
</div>

<ul>
<li>在 x86 上，方向标志位（<code>EFLAGS</code> 中的 DF）在进入汇编代码时为清除状态，且退出时必须为清除状态。
<ul>
<li>如果退出汇编代码时设置了方向标志位，则行为是未定义的。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.x86-x87"><a class="rule-link" href="#r-asm.rules.x86-x87" title="asm.rules.x86-x87"><span>[asm<wbr>.rules<wbr>.x86-x87]</span></a>
</div>

<ul>
<li>在 x86 上，x87 浮点寄存器栈必须保持不变，除非所有 <code>st([0-7])</code> 寄存器都已标记为使用 <code>out("st(0)") _, out("st(1)") _, ...</code> 进行了破坏。
<ul>
<li>如果所有 x87 寄存器都被破坏，则保证在进入汇编代码时 x87 寄存器栈为空。汇编代码必须确保在退出汇编代码时 x87 寄存器栈也为空。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#[cfg(target_arch = "x86_64")]
</span>pub fn fadd(x: f64, y: f64) -&gt; f64 {
  let mut out = 0f64;
  let mut top = 0u16;
  // 如果我们破坏了整个 x87 栈，我们可以用 x87 做复杂的事情
  unsafe { core::arch::asm!(
    "fld qword ptr [{x}]",
    "fld qword ptr [{y}])",
    "faddp",
    "fstp qword ptr [{out}]",
    "xor eax, eax",
    "fstsw ax",
    "shl eax, 11",
    x = in(reg) &amp;x,
    y = in(reg) &amp;y,
    out = in(reg) &amp;mut out,
    out("st(0)") _, out("st(1)") _, out("st(2)") _, out("st(3)") _,
    out("st(4)") _, out("st(5)") _, out("st(6)") _, out("st(7)") _,
    out("eax") top
  );}

  assert_eq!(top &amp; 0x7, 0);
  out
}

pub fn main() {
<span class="boring">#[cfg(target_arch = "x86_64")]{
</span>  assert_eq!(fadd(1.0, 1.0), 2.0);
<span class="boring">}
</span>}</code></pre>
<div class="rule" id="r-asm.rules.arm64ec"><a class="rule-link" href="#r-asm.rules.arm64ec" title="asm.rules.arm64ec"><span>[asm<wbr>.rules<wbr>.arm64ec]</span></a>
</div>

<ul>
<li>在 arm64ec 上，调用函数时必须使用 <a href="https://learn.microsoft.com/en-us/windows/arm/arm64ec-abi#authoring-arm64ec-in-assembly">带有适当转换器（thunks）的调用检查器</a>。</li>
</ul>
<div class="rule" id="r-asm.rules.only-on-exit"><a class="rule-link" href="#r-asm.rules.only-on-exit" title="asm.rules.only-on-exit"><span>[asm<wbr>.rules<wbr>.only-on-exit]</span></a>
</div>

<ul>
<li>恢复栈指针和非输出寄存器为其原始值的要求仅适用于退出汇编代码时。
<ul>
<li>这意味着不顺序执行且不跳转到任何 <code>label</code> 块的汇编代码，即使没有标记为 <code>noreturn</code>，也不需要保留这些寄存器。</li>
<li>当返回到与进入时不同的 <code>asm!</code> 块的汇编代码时（例如用于上下文切换），这些寄存器必须包含在进入您正在 <em>退出</em> 的 <code>asm!</code> 块时所具有的值。
<ul>
<li>您不能退出未进入的 <code>asm!</code> 块的汇编代码。也不能退出其汇编代码已退出的 <code>asm!</code> 块的汇编代码（除非再次进入它）。</li>
<li>您负责切换任何特定于 target 的状态（例如线程局部存储、栈边界）。</li>
<li>您不能从一个 <code>asm!</code> 块中的地址跳转到另一个块中的地址，即使在同一个函数或块内，而不将它们的上下文视为可能不同的并需要进行上下文切换。您不能假设这些上下文中的任何特定值（例如当前栈指针或栈指针下方的临时值）在两个 <code>asm!</code> 块之间将保持不变。</li>
<li>您可以访问的内存位置集是您进入和退出的 <code>asm!</code> 块所允许的位置集的交集。</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.not-successive"><a class="rule-link" href="#r-asm.rules.not-successive" title="asm.rules.not-successive"><span>[asm<wbr>.rules<wbr>.not-successive]</span></a>
</div>

<ul>
<li>您不能假设源代码中相邻的两个 <code>asm!</code> 块，即使它们之间没有任何其他代码，最终也会位于二进制文件中连续的地址且它们之间没有任何其他指令。</li>
</ul>
<div class="rule" id="r-asm.rules.not-exactly-once"><a class="rule-link" href="#r-asm.rules.not-exactly-once" title="asm.rules.not-exactly-once"><span>[asm<wbr>.rules<wbr>.not-exactly-once]</span></a>
</div>

<ul>
<li>您不能假设 <code>asm!</code> 块在输出二进制文件中恰好出现一次。编译器允许实例化 <code>asm!</code> 块的多个副本，例如当包含它的函数在多个地方内联时。</li>
</ul>
<div class="rule" id="r-asm.rules.x86-prefix-restriction"><a class="rule-link" href="#r-asm.rules.x86-prefix-restriction" title="asm.rules.x86-prefix-restriction"><span>[asm<wbr>.rules<wbr>.x86-prefix-restriction]</span></a>
</div>

<ul>
<li>在 x86 上，内联汇编不得以会应用于编译器生成的指令的指令前缀（例如 <code>LOCK</code>）结尾。
<ul>
<li>由于内联汇编的编译方式，编译器目前无法检测到这一点，但将来可能会捕获并拒绝这种情况。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.preserves_flags"><a class="rule-link" href="#r-asm.rules.preserves_flags" title="asm.rules.preserves_flags"><span>[asm<wbr>.rules<wbr>.preserves_flags]</span></a>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>作为一般规则，<code>preserves_flags</code> 涵盖的标志是那些在执行函数调用时 <em>不</em> 被保留的标志。</p>
</blockquote>
</div>

<div class="rule" id="r-asm.naked-rules"><a class="rule-link" href="#r-asm.naked-rules" title="asm.naked-rules"><span>[asm<wbr>.naked-rules]</span></a>
</div>

<h2 id="裸内联汇编规则"><a class="header" href="#裸内联汇编规则">裸内联汇编规则</a></h2>
<div class="rule" id="r-asm.naked-rules.intro"><a class="rule-link" href="#r-asm.naked-rules.intro" title="asm.naked-rules.intro"><span>[asm<wbr>.naked-rules<wbr>.intro]</span></a>
</div>

<p>为避免未定义行为，在裸函数（<code>naked_asm!</code>）中使用函数作用域内联汇编时必须遵守以下规则：</p>
<div class="rule" id="r-asm.naked-rules.reg-not-input"><a class="rule-link" href="#r-asm.naked-rules.reg-not-input" title="asm.naked-rules.reg-not-input"><span>[asm<wbr>.naked-rules<wbr>.reg-not-input]</span></a>
</div>

<ul>
<li>根据调用约定和函数签名，任何未用于函数输入的寄存器在进入 <code>naked_asm!</code> 块时都将包含一个未定义的值。
<ul>
<li>在内联汇编的语境下， “未定义的值” 意味着寄存器可以（非确定性地）具有架构所允许的任何一个可能的值。值得注意的是，它与 LLVM 的 <code>undef</code> 不同，后者每次读取时都可以具有不同的值（因为汇编代码中不存在这样的概念）。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.naked-rules.callee-saved-registers"><a class="rule-link" href="#r-asm.naked-rules.callee-saved-registers" title="asm.naked-rules.callee-saved-registers"><span>[asm<wbr>.naked-rules<wbr>.callee-saved-registers]</span></a>
</div>

<ul>
<li>所有被调用者保存（callee-saved）的寄存器在返回时必须具有与进入时相同的值。</li>
</ul>
<div class="rule" id="r-asm.naked-rules.caller-saved-registers"><a class="rule-link" href="#r-asm.naked-rules.caller-saved-registers" title="asm.naked-rules.caller-saved-registers"><span>[asm<wbr>.naked-rules<wbr>.caller-saved-registers]</span></a>
</div>

<ul>
<li>可以自由使用调用者保存（caller-saved）的寄存器。</li>
</ul>
<div class="rule" id="r-asm.naked-rules.noreturn"><a class="rule-link" href="#r-asm.naked-rules.noreturn" title="asm.naked-rules.noreturn"><span>[asm<wbr>.naked-rules<wbr>.noreturn]</span></a>
</div>

<ul>
<li>如果执行顺序执行过汇编代码末尾，则行为是未定义的。
<ul>
<li>汇编代码中的每条路径都应以返回指令结束或发散。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.naked-rules.mem-same-as-ffi"><a class="rule-link" href="#r-asm.naked-rules.mem-same-as-ffi" title="asm.naked-rules.mem-same-as-ffi"><span>[asm<wbr>.naked-rules<wbr>.mem-same-as-ffi]</span></a>
</div>

<ul>
<li>汇编代码允许读取和写入的内存位置集与 FFI 函数所允许的相同。</li>
</ul>
<div class="rule" id="r-asm.naked-rules.black-box"><a class="rule-link" href="#r-asm.naked-rules.black-box" title="asm.naked-rules.black-box"><span>[asm<wbr>.naked-rules<wbr>.black-box]</span></a>
</div>

<ul>
<li>编译器不能假设 <code>naked_asm!</code> 块中的指令就是最终会执行的指令。
<ul>
<li>这实际上意味着编译器必须将 <code>naked_asm!</code> 视为黑盒，仅考虑接口规范，而不是指令本身。</li>
<li>允许通过特定于 target 的机制进行运行时代码补丁。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.naked-rules.unwind"><a class="rule-link" href="#r-asm.naked-rules.unwind" title="asm.naked-rules.unwind"><span>[asm<wbr>.naked-rules<wbr>.unwind]</span></a>
</div>

<ul>
<li>允许从 <code>naked_asm!</code> 块中展开。
<ul>
<li>为了保证行为正确，必须使用发出展开元数据的适当汇编指令。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>#[unsafe(naked)]
extern "sysv64-unwind" fn unwinding_naked() {
    core::arch::naked_asm!(
        // 这里的 "CFI" 代表 "调用栈帧信息" (call frame information)。
        ".cfi_startproc",
        // CFA (规范栈帧地址) 是 `call` 之前 `rsp` 的值，
        // 即在返回地址 `rip` 被压入 `rsp` 之前的值，
        // 所以在进入函数时（在 `rip` 被压入后），
        // 它在内存中比 `rsp` 高 8 个字节。
        //
        // 这是默认设置，所以我们不必写它。
        //".cfi_def_cfa rsp, 8",
        //
        // 传统做法是保留基指针，所以我们就这么做。
        "push rbp",
        // 既然我们现在已在内存中将栈向下扩展了 8 个字节，
        // 我们需要将从 `rsp` 到 CFA 的偏移量再调整 8 个字节。
        ".cfi_adjust_cfa_offset 8",
        // 然后我们还注释了我们将调用者的 `rbp` 值相对于 CFA 存储在哪里，
        // 以便在展开到调用者时可以找到它，以防我们需要它
        // 来计算调用者相对于它的 CFA。
        //
        // 在这里，我们从 CFA 下方 16 字节开始存储调用者的 `rbp`。
        // 即从 CFA 开始，首先是 `rip`（从 CFA 下方 8 字节开始并持续到它），
        // 然后是我们刚刚压入的调用者的 `rbp`。
        ".cfi_offset rbp, -16",
        // 按照传统，我们将基指针设置为栈指针的值。
        // 这样，基指针在整个函数体中保持不变。
        "mov rbp, rsp",
        // 我们现在可以跟踪从基指针到 CFA 的偏移量。
        // 这意味着直到最后我们都不需要再做任何调整，
        // 因为我们不改变 `rbp`。
        ".cfi_def_cfa_register rbp",
        // 我们现在可以调用一个可能产生恐慌的函数。
        "call {f}",
        // 返回后，我们恢复 `rbp` 以准备返回我们自己。
        "pop rbp",
        // 现在我们已经恢复了 `rbp`，我们必须再次根据 `rsp`
        // 指定到 CFA 的偏移量。
        ".cfi_def_cfa rsp, 8",
        // 现在我们可以返回了。
        "ret",
        ".cfi_endproc",
        f = sym may_panic,
    )
}

extern "sysv64-unwind" fn may_panic() {
    panic!("unwind");
}
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>有关上述 <code>cfi</code> 汇编指令的更多信息，请参阅以下资源：</p>
<ul>
<li><a href="https://sourceware.org/binutils/docs/as/CFI-directives.html">Using <code>as</code> - CFI directives</a></li>
<li><a href="https://dwarfstd.org/doc/DWARF5.pdf">DWARF Debugging Information Format Version 5</a></li>
<li><a href="https://www.imperialviolet.org/2017/01/18/cfi.html">ImperialViolet - CFI directives in assembly files</a></li>
</ul>
</blockquote>
</div>

<div class="rule" id="r-asm.validity"><a class="rule-link" href="#r-asm.validity" title="asm.validity"><span>[asm<wbr>.validity]</span></a>
</div>

<h3 id="正确性和有效性"><a class="header" href="#正确性和有效性">正确性和有效性</a></h3>
<div class="rule" id="r-asm.validity.necessary-but-not-sufficient"><a class="rule-link" href="#r-asm.validity.necessary-but-not-sufficient" title="asm.validity.necessary-but-not-sufficient"><span>[asm<wbr>.validity<wbr>.necessary-but-not-sufficient]</span></a>
</div>

<p>除了所有先前的规则外，<code>asm!</code> 的字符串参数最终必须变为——在评估了所有其他参数、执行了格式化并转换了操作数之后——在语法上正确且在语义上对于 target 架构有效。格式化规则允许编译器生成具有正确语法的汇编代码。关于操作数的规则允许将 Rust 操作数有效转换进出汇编代码。遵守这些规则是必要的，但对于最终展开的汇编代码既正确又有效是不充分的。例如：</p>
<ul>
<li>格式化后，参数可能被放置在语法上不正确的位置</li>
<li>指令可能书写正确，但给出了架构上无效的操作数</li>
<li>架构上未指定的指令可能会被汇编成未指定的代码</li>
<li>一组指令，即使每个指令都正确且有效，如果紧接着放置也可能导致未定义行为</li>
</ul>
<div class="rule" id="r-asm.validity.non-exhaustive"><a class="rule-link" href="#r-asm.validity.non-exhaustive" title="asm.validity.non-exhaustive"><span>[asm<wbr>.validity<wbr>.non-exhaustive]</span></a>
</div>

<p>因此，这些规则是 <em>非详尽的</em> 。编译器不被要求检查初始字符串或最终生成的汇编代码的正确性和有效性。汇编器可以检查正确性和有效性，但不是必须这样做。使用 <code>asm!</code> 时，一个排版错误可能就足以使程序不健全，而汇编规则可能包括数千页的架构参考手册。程序员应当行使适当的谨慎，因为调用这种 <code>unsafe</code> 能力意味着承担不违反编译器和架构规则的责任。</p>
<div class="rule" id="r-asm.directives"><a class="rule-link" href="#r-asm.directives" title="asm.directives"><span>[asm<wbr>.directives]</span></a>
</div>

<h3 id="指令支持"><a class="header" href="#指令支持">指令支持</a></h3>
<div class="rule" id="r-asm.directives.subset-supported"><a class="rule-link" href="#r-asm.directives.subset-supported" title="asm.directives.subset-supported"><span>[asm<wbr>.directives<wbr>.subset-supported]</span></a>
</div>

<p>内联汇编支持 GNU AS 和 LLVM 内部汇编器所支持的指令子集，如下所示。使用其他指令的结果是特定于汇编器的（可能会导致错误，也可能会被原样接受）。</p>
<div class="rule" id="r-asm.directives.stateful"><a class="rule-link" href="#r-asm.directives.stateful" title="asm.directives.stateful"><span>[asm<wbr>.directives<wbr>.stateful]</span></a>
</div>

<p>如果内联汇编包括任何修改后续汇编处理方式的 “stateful” 指令，则汇编代码必须在内联汇编结束前撤消任何此类指令的影响。</p>
<div class="rule" id="r-asm.directives.supported-directives"><a class="rule-link" href="#r-asm.directives.supported-directives" title="asm.directives.supported-directives"><span>[asm<wbr>.directives<wbr>.supported-directives]</span></a>
</div>

<p>汇编器保证支持以下指令：</p>
<ul>
<li><code>.2byte</code></li>
<li><code>.4byte</code></li>
<li><code>.8byte</code></li>
<li><code>.align</code></li>
<li><code>.alt_entry</code></li>
<li><code>.ascii</code></li>
<li><code>.asciz</code></li>
<li><code>.balign</code></li>
<li><code>.balignl</code></li>
<li><code>.balignw</code></li>
<li><code>.bss</code></li>
<li><code>.byte</code></li>
<li><code>.comm</code></li>
<li><code>.data</code></li>
<li><code>.def</code></li>
<li><code>.double</code></li>
<li><code>.endef</code></li>
<li><code>.equ</code></li>
<li><code>.equiv</code></li>
<li><code>.eqv</code></li>
<li><code>.fill</code></li>
<li><code>.float</code></li>
<li><code>.global</code></li>
<li><code>.globl</code></li>
<li><code>.inst</code></li>
<li><code>.insn</code></li>
<li><code>.lcomm</code></li>
<li><code>.long</code></li>
<li><code>.octa</code></li>
<li><code>.option</code></li>
<li><code>.p2align</code></li>
<li><code>.popsection</code></li>
<li><code>.private_extern</code></li>
<li><code>.pushsection</code></li>
<li><code>.quad</code></li>
<li><code>.scl</code></li>
<li><code>.section</code></li>
<li><code>.set</code></li>
<li><code>.short</code></li>
<li><code>.size</code></li>
<li><code>.skip</code></li>
<li><code>.sleb128</code></li>
<li><code>.space</code></li>
<li><code>.string</code></li>
<li><code>.text</code></li>
<li><code>.type</code></li>
<li><code>.uleb128</code></li>
<li><code>.word</code></li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let bytes: *const u8;
let len: usize;
unsafe {
    core::arch::asm!(
        "jmp 3f", "2: .ascii \"Hello World!\"",
        "3: lea {bytes}, [2b+rip]",
        "mov {len}, 12",
        bytes = out(reg) bytes,
        len = out(reg) len
    );
}

let s = unsafe { core::str::from_utf8_unchecked(core::slice::from_raw_parts(bytes, len)) };

assert_eq!(s, "Hello World!");
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.target-specific-directives"><a class="rule-link" href="#r-asm.target-specific-directives" title="asm.target-specific-directives"><span>[asm<wbr>.target-specific-directives]</span></a>
</div>

<h4 id="特定于target的指令支持"><a class="header" href="#特定于target的指令支持">特定于target的指令支持</a></h4>
<div class="rule" id="r-asm.target-specific-directives.dwarf-unwinding"><a class="rule-link" href="#r-asm.target-specific-directives.dwarf-unwinding" title="asm.target-specific-directives.dwarf-unwinding"><span>[asm<wbr>.target-specific-directives<wbr>.dwarf-unwinding]</span></a>
</div>

<h5 id="dwarf展开"><a class="header" href="#dwarf展开">Dwarf展开</a></h5>
<p>在支持 DWARF 展开信息的 ELF target 上支持以下指令：</p>
<ul>
<li><code>.cfi_adjust_cfa_offset</code></li>
<li><code>.cfi_def_cfa</code></li>
<li><code>.cfi_def_cfa_offset</code></li>
<li><code>.cfi_def_cfa_register</code></li>
<li><code>.cfi_endproc</code></li>
<li><code>.cfi_escape</code></li>
<li><code>.cfi_lsda</code></li>
<li><code>.cfi_offset</code></li>
<li><code>.cfi_personality</code></li>
<li><code>.cfi_register</code></li>
<li><code>.cfi_rel_offset</code></li>
<li><code>.cfi_remember_state</code></li>
<li><code>.cfi_restore</code></li>
<li><code>.cfi_restore_state</code></li>
<li><code>.cfi_return_column</code></li>
<li><code>.cfi_same_value</code></li>
<li><code>.cfi_sections</code></li>
<li><code>.cfi_signal_frame</code></li>
<li><code>.cfi_startproc</code></li>
<li><code>.cfi_undefined</code></li>
<li><code>.cfi_window_save</code></li>
</ul>
<div class="rule" id="r-asm.target-specific-directives.structured-exception-handling"><a class="rule-link" href="#r-asm.target-specific-directives.structured-exception-handling" title="asm.target-specific-directives.structured-exception-handling"><span>[asm<wbr>.target-specific-directives<wbr>.structured-exception-handling]</span></a>
</div>

<h5 id="结构化异常处理"><a class="header" href="#结构化异常处理">结构化异常处理</a></h5>
<p>在具有结构化异常处理的 target 上，保证支持以下附加指令：</p>
<ul>
<li><code>.seh_endproc</code></li>
<li><code>.seh_endprologue</code></li>
<li><code>.seh_proc</code></li>
<li><code>.seh_pushreg</code></li>
<li><code>.seh_savereg</code></li>
<li><code>.seh_setframe</code></li>
<li><code>.seh_stackalloc</code></li>
</ul>
<div class="rule" id="r-asm.target-specific-directives.x86"><a class="rule-link" href="#r-asm.target-specific-directives.x86" title="asm.target-specific-directives.x86"><span>[asm<wbr>.target-specific-directives<wbr>.x86]</span></a>
</div>

<h5 id="x8632-位和-64-位"><a class="header" href="#x8632-位和-64-位">x86（32 位和 64 位）</a></h5>
<p>在 x86 target（32 位和 64 位）上，保证支持以下附加指令：</p>
<ul>
<li><code>.nops</code></li>
<li><code>.code16</code></li>
<li><code>.code32</code></li>
<li><code>.code64</code></li>
</ul>
<p>仅当在退出汇编代码之前将状态重置为默认值时，才支持使用 <code>.code16</code>、<code>.code32</code> 和 <code>.code64</code> 指令。32 位 x86 默认使用 <code>.code32</code>，x86_64 默认使用 <code>.code64</code>。</p>
<div class="rule" id="r-asm.target-specific-directives.arm-32-bit"><a class="rule-link" href="#r-asm.target-specific-directives.arm-32-bit" title="asm.target-specific-directives.arm-32-bit"><span>[asm<wbr>.target-specific-directives<wbr>.arm-32-bit]</span></a>
</div>

<h5 id="arm32-位"><a class="header" href="#arm32-位">ARM（32 位）</a></h5>
<p>在 ARM 上，保证支持以下附加指令：</p>
<ul>
<li><code>.even</code></li>
<li><code>.fnstart</code></li>
<li><code>.fnend</code></li>
<li><code>.save</code></li>
<li><code>.movsp</code></li>
<li><code>.code</code></li>
<li><code>.thumb</code></li>
<li><code>.thumb_func</code></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-safety"><a class="rule-link" href="#r-safety" title="safety"><span>[safety]</span></a>
</div>

<h1 id="不安全性"><a class="header" href="#不安全性">不安全性</a></h1>
<div class="rule" id="r-safety.intro"><a class="rule-link" href="#r-safety.intro" title="safety.intro"><span>[safety<wbr>.intro]</span></a>
</div>

<p>不安全操作是指那些可能会违反 Rust 静态语义中内存安全保证的操作。</p>
<div class="rule" id="r-safety.unsafe-ops"><a class="rule-link" href="#r-safety.unsafe-ops" title="safety.unsafe-ops"><span>[safety<wbr>.unsafe-ops]</span></a>
</div>

<p>以下语言层级的特性不能在 Rust 的安全子集中使用：</p>
<div class="rule" id="r-safety.unsafe-deref"><a class="rule-link" href="#r-safety.unsafe-deref" title="safety.unsafe-deref"><span>[safety<wbr>.unsafe-deref]</span></a>
</div>

<ul>
<li>解引用 <a href="#指针类型">原始指针</a>。</li>
</ul>
<div class="rule" id="r-safety.unsafe-static"><a class="rule-link" href="#r-safety.unsafe-static" title="safety.unsafe-static"><span>[safety<wbr>.unsafe-static]</span></a>
</div>

<ul>
<li>读取或写入 <a href="#mutable-statics">可变</a> 或不安全的 <a href="#外部块">外部</a> 静态变量。</li>
</ul>
<div class="rule" id="r-safety.unsafe-union-access"><a class="rule-link" href="#r-safety.unsafe-union-access" title="safety.unsafe-union-access"><span>[safety<wbr>.unsafe-union-access]</span></a>
</div>

<ul>
<li>访问 <a href="#联合体"><code>联合体</code></a> 的字段，除了对其进行赋值。</li>
</ul>
<div class="rule" id="r-safety.unsafe-call"><a class="rule-link" href="#r-safety.unsafe-call" title="safety.unsafe-call"><span>[safety<wbr>.unsafe-call]</span></a>
</div>

<ul>
<li>调用不安全函数。</li>
</ul>
<div class="rule" id="r-safety.unsafe-target-feature-call"><a class="rule-link" href="#r-safety.unsafe-target-feature-call" title="safety.unsafe-target-feature-call"><span>[safety<wbr>.unsafe-target-feature-call]</span></a>
</div>

<ul>
<li>在没有启用相同特性的 <code>target_feature</code> 属性的函数中，调用标有 <a href="#r-attributes.codegen.target_feature"><code>target_feature</code></a> 的安全函数（请参阅 <a href="#r-attributes.codegen.target_feature.safety-restrictions">attributes.codegen.target_feature.safety-restrictions</a>）。</li>
</ul>
<div class="rule" id="r-safety.unsafe-impl"><a class="rule-link" href="#r-safety.unsafe-impl" title="safety.unsafe-impl"><span>[safety<wbr>.unsafe-impl]</span></a>
</div>

<ul>
<li>实现 <a href="#unsafe-traits">不安全特型</a>。</li>
</ul>
<div class="rule" id="r-safety.unsafe-extern"><a class="rule-link" href="#r-safety.unsafe-extern" title="safety.unsafe-extern"><span>[safety<wbr>.unsafe-extern]</span></a>
</div>

<ul>
<li>声明 <a href="#外部块"><code>外部</code></a> 块<sup class="footnote-reference" id="fr-extern-2024-1"><a href="#footnote-extern-2024">1</a></sup>。</li>
</ul>
<div class="rule" id="r-safety.unsafe-attribute"><a class="rule-link" href="#r-safety.unsafe-attribute" title="safety.unsafe-attribute"><span>[safety<wbr>.unsafe-attribute]</span></a>
</div>

<ul>
<li>将 <a href="#属性-1">不安全属性</a> 应用于 <a href="#grammar-Item">项</a>。</li>
</ul>
<hr>
<ol class="footnote-definition">
<li id="footnote-extern-2024">
<p>在 2024 版次 之前，允许在不使用 <code>unsafe</code> 的情况下声明外部块。 <a href="#fr-extern-2024-1">↩</a></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-unsafe"><a class="rule-link" href="#r-unsafe" title="unsafe"><span>[unsafe]</span></a>
</div>

<h1 id="unsafe-关键字"><a class="header" href="#unsafe-关键字"><code>unsafe</code> 关键字</a></h1>
<div class="rule" id="r-unsafe.intro"><a class="rule-link" href="#r-unsafe.intro" title="unsafe.intro"><span>[unsafe<wbr>.intro]</span></a>
</div>

<p><code>unsafe</code> 关键字用于创建或履行证明某事是安全的义务。具体来说：</p>
<ul>
<li>它用于标记 <em>定义</em> 了必须在其他地方遵守的额外安全条件的代码。
<ul>
<li>这包括 <code>unsafe fn</code>、<code>unsafe static</code> 和 <code>unsafe trait</code>。</li>
</ul>
</li>
<li>它用于标记程序员 <em>断言</em> 满足了在其他地方定义的安全条件的代码。
<ul>
<li>这包括 <code>unsafe {}</code>、<code>unsafe impl</code>、不带 <a href="https://doc.rust-lang.org/rustc/lints/listing/allowed-by-default.html#unsafe-op-in-unsafe-fn"><code>unsafe_op_in_unsafe_fn</code></a> 的 <code>unsafe fn</code>、<code>unsafe extern</code> 和 <code>#[unsafe(attr)]</code>。</li>
</ul>
</li>
</ul>
<p>下面将讨论这些情况。
请参阅 <a href="https://doc.rust-lang.org/std/keyword.unsafe.html">关键字</a> 文档中的一些示例。</p>
<div class="rule" id="r-unsafe.positions"><a class="rule-link" href="#r-unsafe.positions" title="unsafe.positions"><span>[unsafe<wbr>.positions]</span></a>
</div>

<p><code>unsafe</code> 关键字可以出现在几种不同的上下文中：</p>
<ul>
<li>不安全函数 (<code>unsafe fn</code>)</li>
<li>不安全块 (<code>unsafe {}</code>)</li>
<li>不安全特型 (<code>unsafe trait</code>)</li>
<li>不安全特型实现 (<code>unsafe impl</code>)</li>
<li>不安全外部块 (<code>unsafe extern</code>)</li>
<li>不安全外部静态项 (<code>unsafe static</code>)</li>
<li>不安全属性 (<code>#[unsafe(attr)]</code>)</li>
</ul>
<div class="rule" id="r-unsafe.fn"><a class="rule-link" href="#r-unsafe.fn" title="unsafe.fn"><span>[unsafe<wbr>.fn]</span></a>
</div>

<h2 id="不安全函数-unsafe-fn"><a class="header" href="#不安全函数-unsafe-fn">不安全函数 (<code>unsafe fn</code>)</a></h2>
<div class="rule" id="r-unsafe.fn.intro"><a class="rule-link" href="#r-unsafe.fn.intro" title="unsafe.fn.intro"><span>[unsafe<wbr>.fn<wbr>.intro]</span></a>
</div>

<p>不安全函数是在所有上下文和/或所有可能的输入下都不安全的函数。
我们说它们具有 <em>额外安全条件</em> ，这些是所有调用者必须遵守的要求，且编译器不会检查。
例如，<a href="../std/primitive.slice.html#method.get_unchecked"><code>get_unchecked</code></a> 具有索引必须在范围内的额外安全条件。
不安全函数应当附带说明这些额外安全条件的文档。</p>
<div class="rule" id="r-unsafe.fn.safety"><a class="rule-link" href="#r-unsafe.fn.safety" title="unsafe.fn.safety"><span>[unsafe<wbr>.fn<wbr>.safety]</span></a>
</div>

<p>此类函数必须带有 <code>unsafe</code> 关键字前缀，且只能从 <code>unsafe</code> 块内部调用，或者在没有启用 <a href="https://doc.rust-lang.org/rustc/lints/listing/allowed-by-default.html#unsafe-op-in-unsafe-fn"><code>unsafe_op_in_unsafe_fn</code></a> lint 的 <code>unsafe fn</code> 内部调用。</p>
<div class="rule" id="r-unsafe.block"><a class="rule-link" href="#r-unsafe.block" title="unsafe.block"><span>[unsafe<wbr>.block]</span></a>
</div>

<h2 id="不安全块-unsafe-"><a class="header" href="#不安全块-unsafe-">不安全块 (<code>unsafe {}</code>)</a></h2>
<div class="rule" id="r-unsafe.block.intro"><a class="rule-link" href="#r-unsafe.block.intro" title="unsafe.block.intro"><span>[unsafe<wbr>.block<wbr>.intro]</span></a>
</div>

<p>代码块可以带有 <code>unsafe</code> 关键字前缀，以允许使用 <a href="#不安全性">不安全性</a> 一章中定义的各种不安全操作，例如调用其他不安全函数或解引用原始指针。</p>
<div class="rule" id="r-unsafe.block.fn-body"><a class="rule-link" href="#r-unsafe.block.fn-body" title="unsafe.block.fn-body"><span>[unsafe<wbr>.block<wbr>.fn-body]</span></a>
</div>

<p>默认情况下，不安全函数的主体也被认为是一个不安全块；
这可以通过启用 <a href="https://doc.rust-lang.org/rustc/lints/listing/allowed-by-default.html#unsafe-op-in-unsafe-fn"><code>unsafe_op_in_unsafe_fn</code></a> lint 来更改。</p>
<p>通过将操作放入不安全块中，程序员声明他们已经负责满足该块内所有操作的额外安全条件。</p>
<p>不安全块是不安全函数的逻辑对等物：
不安全函数定义了调用者必须遵守的证明义务，而不安全块则表示块内调用的函数或操作的所有相关证明义务都已履行。
履行证明义务的方法有很多；
例如，可以有运行时检查或数据结构不变性，保证某些属性绝对为真；或者不安全块可能位于 <code>unsafe fn</code> 内部，在这种情况下，该块可以使用该函数的证明义务来履行块内产生的证明义务。</p>
<p>不安全块用于包装外部库、直接使用硬件或实现语言中没有直接提供的功能。
例如，Rust 提供了实现内存安全并发所需的语言特性，但标准库中线程和消息传递的实现使用了不安全块。</p>
<p>Rust 的类型系统是对动态安全要求的保守近似，因此在某些情况下，使用安全代码会有性能代价。
例如，双向链表不是树结构，在安全代码中只能用引用计数指针表示。
通过使用 <code>unsafe</code> 块将反向链接表示为原始指针，可以在不使用引用计数的情况下实现它。
（有关此特定示例的更深入探索，请参阅 <a href="https://rust-unofficial.github.io/too-many-lists/">“Learn Rust With Entirely Too Many Linked Lists”</a>。）</p>
<div class="rule" id="r-unsafe.trait"><a class="rule-link" href="#r-unsafe.trait" title="unsafe.trait"><span>[unsafe<wbr>.trait]</span></a>
</div>

<h2 id="不安全特型-unsafe-trait"><a class="header" href="#不安全特型-unsafe-trait">不安全特型 (<code>unsafe trait</code>)</a></h2>
<div class="rule" id="r-unsafe.trait.intro"><a class="rule-link" href="#r-unsafe.trait.intro" title="unsafe.trait.intro"><span>[unsafe<wbr>.trait<wbr>.intro]</span></a>
</div>

<p>不安全特型是附带额外安全条件的特型，这些条件必须由该特型的 <em>实现</em> 遵守。
不安全特型应当附带说明这些额外安全条件的文档。</p>
<div class="rule" id="r-unsafe.trait.safety"><a class="rule-link" href="#r-unsafe.trait.safety" title="unsafe.trait.safety"><span>[unsafe<wbr>.trait<wbr>.safety]</span></a>
</div>

<p>此类特型必须带有 <code>unsafe</code> 关键字前缀，且只能由 <code>unsafe impl</code> 块实现。</p>
<div class="rule" id="r-unsafe.impl"><a class="rule-link" href="#r-unsafe.impl" title="unsafe.impl"><span>[unsafe<wbr>.impl]</span></a>
</div>

<h2 id="不安全特型实现-unsafe-impl"><a class="header" href="#不安全特型实现-unsafe-impl">不安全特型实现 (<code>unsafe impl</code>)</a></h2>
<p>在实现不安全特型时，实现需要带有 <code>unsafe</code> 关键字前缀。
通过编写 <code>unsafe impl</code>，程序员声明他们已经负责满足特型所要求的额外安全条件。</p>
<p>不安全特型实现是不安全特型的逻辑对等物：不安全特型定义了实现必须遵守的证明义务，而不安全实现则表示所有相关的证明义务都已履行。</p>
<div class="rule" id="r-unsafe.extern"><a class="rule-link" href="#r-unsafe.extern" title="unsafe.extern"><span>[unsafe<wbr>.extern]</span></a>
</div>

<h2 id="不安全外部块-unsafe-extern"><a class="header" href="#不安全外部块-unsafe-extern">不安全外部块 (<code>unsafe extern</code>)</a></h2>
<p>声明 <a href="#外部块">外部块</a> 的程序员必须确保其中包含的项的签名是正确的。如果不这样做，可能会导致未定义行为。通过编写 <code>unsafe extern</code> 来表明这一义务已经履行。</p>
<div class="rule" id="r-unsafe.extern.edition2024"><a class="rule-link" href="#r-unsafe.extern.edition2024" title="unsafe.extern.edition2024"><span>[unsafe<wbr>.extern<wbr>.edition2024]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2024</span> 版次差异</p>

<p>在 2024 版次 之前，允许在没有 <code>unsafe</code> 限定的情况下使用 <code>extern</code> 块。</p>
</blockquote>
</div>

<div class="rule" id="r-unsafe.attribute"><a class="rule-link" href="#r-unsafe.attribute" title="unsafe.attribute"><span>[unsafe<wbr>.attribute]</span></a>
</div>

<h2 id="不安全属性-unsafeattr"><a class="header" href="#不安全属性-unsafeattr">不安全属性 (<code>#[unsafe(attr)]</code>)</a></h2>
<p><a href="#属性-1">不安全属性</a> 是指在使用该属性时必须遵守额外安全条件的属性。编译器无法检查这些条件是否已得到遵守。为了断言它们已得到遵守，这些属性必须包装在 <code>unsafe(..)</code> 中，例如 <code>#[unsafe(no_mangle)]</code>。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-undefined"><a class="rule-link" href="#r-undefined" title="undefined"><span>[undefined]</span></a>
</div>

<h1 id="被视为未定义的行为"><a class="header" href="#被视为未定义的行为">被视为未定义的行为</a></h1>
<div class="rule" id="r-undefined.general"><a class="rule-link" href="#r-undefined.general" title="undefined.general"><span>[undefined<wbr>.general]</span></a>
</div>

<p>Rust 代码如果表现出以下列表中的任何行为，就是不正确的。这包括 <code>unsafe</code> 块和 <code>unsafe</code> 函数中的代码。<code>unsafe</code> 仅意味着避免未定义行为的责任在程序员身上；它并不会改变 Rust 程序决不能导致未定义行为这一事实。</p>
<div class="rule" id="r-undefined.soundness"><a class="rule-link" href="#r-undefined.soundness" title="undefined.soundness"><span>[undefined<wbr>.soundness]</span></a>
</div>

<p>在编写 <code>unsafe</code> 代码时，程序员有责任确保任何与 <code>unsafe</code> 代码交互的安全代码都不会触发这些行为。对于任何安全客户端都能满足此属性的 <code>unsafe</code> 代码被称为 <em>sound (无害的)</em> ；如果 <code>unsafe</code> 代码可能被安全代码误用而表现出未定义行为，则它是 <em>unsound (有害的)</em> 。</p>
<div class="alert alert-warning">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>警告</p>

<p>以下列表并不详尽；它可能会增加或减少。对于在不安全代码中哪些允许、哪些不允许，目前还没有正式的 Rust 语义模型，因此可能还有更多行为被认为是不安全的。我们也保留在未来将列表中某些行为变为“已定义行为”的权利。换句话说，此列表并不代表任何内容在所有未来的 Rust 版本中都 <em>肯定</em> 始终是未定义的（但我们将来可能会对某些列表项做出此类承诺）。</p>
<p>在编写不安全代码之前，请阅读 <a href="../nomicon/index.html">Rustonomicon</a>。</p>
</blockquote>
</div>

<div class="rule" id="r-undefined.race"><a class="rule-link" href="#r-undefined.race" title="undefined.race"><span>[undefined<wbr>.race]</span></a>
</div>

<ul>
<li>数据竞争。</li>
</ul>
<div class="rule" id="r-undefined.pointer-access"><a class="rule-link" href="#r-undefined.pointer-access" title="undefined.pointer-access"><span>[undefined<wbr>.pointer-access]</span></a>
</div>

<ul>
<li>访问（加载或存储）一个 <a href="#dangling-pointers">悬垂</a> 或 <a href="#places-based-on-misaligned-pointers">基于对齐错误指针</a> 的位置。</li>
</ul>
<div class="rule" id="r-undefined.place-projection"><a class="rule-link" href="#r-undefined.place-projection" title="undefined.place-projection"><span>[undefined<wbr>.place-projection]</span></a>
</div>

<ul>
<li>执行违反 <a href="../std/primitive.pointer.html#method.offset">in-bounds 指针算术</a> 要求的 位置投影 (place projection)。位置投影是指 <a href="#字段访问表达式">字段表达式</a>、<a href="#tuple-indexing-expressions">元组索引表达式</a> 或 <a href="#array-and-slice-indexing-expressions">数组/切片索引表达式</a>。</li>
</ul>
<div class="rule" id="r-undefined.alias"><a class="rule-link" href="#r-undefined.alias" title="undefined.alias"><span>[undefined<wbr>.alias]</span></a>
</div>

<ul>
<li>
<p>违反指针别名规则。精确的别名规则尚未确定，但这里有一个通用原则的大纲：
<code>&amp;T</code> 必须指向在其存续期间未被修改的内存（除了 <a href="../core/cell/struct.UnsafeCell.html"><code>UnsafeCell&lt;U&gt;</code></a> 内部的数据），
且 <code>&amp;mut T</code> 必须指向在其存续期间不被任何非该引用派生的指针读取或写入，且没有其他引用指向的内存。
出于这些规则的目的，<code>Box&lt;T&gt;</code> 的处理方式类似于 <code>&amp;'static mut T</code>。
精确的存续持续时间 (liveness duration) 尚未指定，但存在一些界限：</p>
<ul>
<li>对于引用，存续持续时间由借用检查器分配的语法生命周期作为上限；它的存续时间不能比该生命周期更 <em>长</em>。</li>
<li>每次解引用或重新借用引用或 <code>Box</code> 时，它都被视为存续。</li>
<li>每次将引用或 <code>Box</code> 传递给函数或从函数返回时，它都被视为存续。</li>
<li>当引用（但不是 <code>Box</code>！）传递给函数时，它的存续时间至少与该函数调用一样长，同样，除非 <code>&amp;T</code> 包含 <a href="../core/cell/struct.UnsafeCell.html"><code>UnsafeCell&lt;U&gt;</code></a>。</li>
</ul>
<p>当这些类型的值作为复合类型的（嵌套）字段传递时，上述规则同样适用，但不适用于指针间接寻址后的情况。</p>
</li>
</ul>
<div class="rule" id="r-undefined.immutable"><a class="rule-link" href="#r-undefined.immutable" title="undefined.immutable"><span>[undefined<wbr>.immutable]</span></a>
</div>

<ul>
<li>
<p>修改不可变字节。
通过 <a href="#constant-promotion">常量提升</a> 表达式可达的所有字节都是不可变的，以及通过 <code>static</code> 和 <code>const</code> 初始化器中已 <a href="#temporary-lifetime-extension">生命周期延长</a> 到 <code>'static</code> 的借用可达的字节也是不可变的。
由不可变绑定或不可变 <code>static</code> 拥有的字节是不可变的，除非这些字节是 <a href="../core/cell/struct.UnsafeCell.html"><code>UnsafeCell&lt;U&gt;</code></a> 的一部分。</p>
<p>此外，由共享引用 <a href="#pointed-to-bytes">指向</a> 的字节（包括通过其他引用（共享和可变）以及 <code>Box</code> 的间接指向）都是不可变的；传递性包括存储在复合类型字段中的那些引用。</p>
<p>修改 (mutation) 是指与任何相关字节重叠的、多于 0 字节的任何写入（即使该写入没有改变内存内容）。</p>
</li>
</ul>
<div class="rule" id="r-undefined.intrinsic"><a class="rule-link" href="#r-undefined.intrinsic" title="undefined.intrinsic"><span>[undefined<wbr>.intrinsic]</span></a>
</div>

<ul>
<li>通过编译器内部函数 (compiler intrinsics) 调用未定义行为。</li>
</ul>
<div class="rule" id="r-undefined.target-feature"><a class="rule-link" href="#r-undefined.target-feature" title="undefined.target-feature"><span>[undefined<wbr>.target-feature]</span></a>
</div>

<ul>
<li>执行由当前平台不支持的平台特性编译的代码（请参阅 <a href="#the-target_feature-attribute"><code>target_feature</code></a>），<em>除非</em> 平台明确记录这是安全的。</li>
</ul>
<div class="rule" id="r-undefined.call"><a class="rule-link" href="#r-undefined.call" title="undefined.call"><span>[undefined<wbr>.call]</span></a>
</div>

<ul>
<li>使用错误的 <a href="#abi">调用 ABI</a> 调用函数，或者回溯 (unwind) 超过一个不允许回溯的栈帧（例如，通过调用一个导入为或转录为 <code>"C"</code> 函数或函数指针的 <code>"C-unwind"</code> 函数）。</li>
</ul>
<div class="rule" id="r-undefined.invalid"><a class="rule-link" href="#r-undefined.invalid" title="undefined.invalid"><span>[undefined<wbr>.invalid]</span></a>
</div>

<ul>
<li>产生 <a href="#invalid-values">无效值</a>。“产生”一个值发生在任何时候：当一个值被赋值给一个位置、从一个位置读取、传递给函数/原始操作或从函数/原始操作返回时。</li>
</ul>
<div class="rule" id="r-undefined.asm"><a class="rule-link" href="#r-undefined.asm" title="undefined.asm"><span>[undefined<wbr>.asm]</span></a>
</div>

<ul>
<li>错误使用内联汇编。有关更多详细信息，请参阅编写使用内联汇编的代码时应遵守的 <a href="#rules-for-inline-assembly">规则</a>。</li>
</ul>
<div class="rule" id="r-undefined.runtime"><a class="rule-link" href="#r-undefined.runtime" title="undefined.runtime"><span>[undefined<wbr>.runtime]</span></a>
</div>

<ul>
<li>违反 Rust 运行时的假设。目前大多数 Rust 运行时的假设尚未明确记录。
<ul>
<li>对于专门与回溯相关的假设，请参阅 <a href="#unwinding-across-ffi-boundaries">恐慌文档</a>。</li>
<li>运行时假设 Rust 栈帧在不执行该栈帧拥有的局部变量的析构函数的情况下不会被释放。这一假设可能被像 <code>longjmp</code> 这样的 C 函数违反。</li>
</ul>
</li>
</ul>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>未定义行为会影响整个程序。例如，调用一个表现出 C 语言未定义行为的 C 函数意味着你的整个程序都包含未定义行为，这也可能影响 Rust 代码。反之亦然，Rust 中的未定义行为可能会对通过 FFI 调用其他语言执行的代码产生不利影响。</p>
</blockquote>
</div>

<div class="rule" id="r-undefined.pointed-to"><a class="rule-link" href="#r-undefined.pointed-to" title="undefined.pointed-to"><span>[undefined<wbr>.pointed-to]</span></a>
</div>

<h2 id="指向的字节"><a class="header" href="#指向的字节">指向的字节</a></h2>
<p>指针或引用“指向”的字节范围由指针值和被指向类型的类型大小决定（使用 <code>size_of_val</code>）。</p>
<div class="rule" id="r-undefined.misaligned"><a class="rule-link" href="#r-undefined.misaligned" title="undefined.misaligned"><span>[undefined<wbr>.misaligned]</span></a>
</div>

<h2 id="基于对齐错误指针的位置"><a class="header" href="#基于对齐错误指针的位置">基于对齐错误指针的位置</a></h2>
<div class="rule" id="r-undefined.misaligned.general"><a class="rule-link" href="#r-undefined.misaligned.general" title="undefined.misaligned.general"><span>[undefined<wbr>.misaligned<wbr>.general]</span></a>
</div>

<p>如果在位置计算过程中的最后一个 <code>*</code> 投影是在对其类型未对齐的指针上执行的，则称该位置是“基于对齐错误指针的”。（如果位置表达式中没有 <code>*</code> 投影，那么这就是访问局部变量或 <code>static</code> 的字段，rustc 将保证正确的对齐。如果有多个 <code>*</code> 投影，则其中每一个都会导致从内存中加载待解引用的指针本身，并且这些加载中的每一个都受对齐约束。请注意，由于自动解引用，在 Rust 表面语法格式中可能会省略一些 <code>*</code> 投影；我们在这里考虑的是完全展开后的位置表达式。）</p>
<p>例如，如果 <code>ptr</code> 的类型为 <code>*const S</code>，其中 <code>S</code> 的对齐要求为 8，那么 <code>ptr</code> 必须 8 字节对齐，否则 <code>(*ptr).f</code> 就是“基于对齐错误指针的”。即使字段 <code>f</code> 的类型是 <code>u8</code>（即对齐要求为 1 的类型），这也是成立的。换句话说，对齐要求源自被解引用的指针类型，<em>而不是</em> 正在被访问的字段类型。</p>
<div class="rule" id="r-undefined.misaligned.load-store"><a class="rule-link" href="#r-undefined.misaligned.load-store" title="undefined.misaligned.load-store"><span>[undefined<wbr>.misaligned<wbr>.load-store]</span></a>
</div>

<p>请注意，基于对齐错误指针的位置仅在被加载或存储时才会导致未定义行为。</p>
<div class="rule" id="r-undefined.misaligned.raw"><a class="rule-link" href="#r-undefined.misaligned.raw" title="undefined.misaligned.raw"><span>[undefined<wbr>.misaligned<wbr>.raw]</span></a>
</div>

<p>在这样的位置上使用 <code>&amp;raw const</code>/<code>&amp;raw mut</code> 是允许的。</p>
<div class="rule" id="r-undefined.misaligned.reference"><a class="rule-link" href="#r-undefined.misaligned.reference" title="undefined.misaligned.reference"><span>[undefined<wbr>.misaligned<wbr>.reference]</span></a>
</div>

<p>在位置上使用 <code>&amp;</code>/<code>&amp;mut</code> 要求满足字段类型的对齐（否则程序将“产生无效值”），这通常比“基于对齐的指针”的要求更宽松。</p>
<div class="rule" id="r-undefined.misaligned.packed"><a class="rule-link" href="#r-undefined.misaligned.packed" title="undefined.misaligned.packed"><span>[undefined<wbr>.misaligned<wbr>.packed]</span></a>
</div>

<p>在字段类型可能比包含它的类型更对齐的情况下（即 <code>repr(packed)</code>），获取引用将导致编译器错误。这意味着基于对齐的指针始终足以确保新引用是对齐的，但它并不总是必要的。</p>
<div class="rule" id="r-undefined.dangling"><a class="rule-link" href="#r-undefined.dangling" title="undefined.dangling"><span>[undefined<wbr>.dangling]</span></a>
</div>

<h2 id="悬垂指针"><a class="header" href="#悬垂指针">悬垂指针</a></h2>
<div class="rule" id="r-undefined.dangling.general"><a class="rule-link" href="#r-undefined.dangling.general" title="undefined.dangling.general"><span>[undefined<wbr>.dangling<wbr>.general]</span></a>
</div>

<p>如果引用/指针 <a href="#pointed-to-bytes">指向</a> 的字节并不都属于同一个存活的分配（特别地，它们都必须属于 <em>某个</em> 分配），则该引用/指针是“悬垂的”。</p>
<div class="rule" id="r-undefined.dangling.zero-size"><a class="rule-link" href="#r-undefined.dangling.zero-size" title="undefined.dangling.zero-size"><span>[undefined<wbr>.dangling<wbr>.zero-size]</span></a>
</div>

<p>如果大小为 0，那么指针在平凡意义上永远不会是“悬垂的”（即使它是空指针）。</p>
<div class="rule" id="r-undefined.dangling.dynamic-size"><a class="rule-link" href="#r-undefined.dangling.dynamic-size" title="undefined.dangling.dynamic-size"><span>[undefined<wbr>.dangling<wbr>.dynamic-size]</span></a>
</div>

<p>请注意，动态大小类型（如切片和字符串）指向它们的整个范围，因此长度元数据绝不能过大非常重要。</p>
<div class="rule" id="r-undefined.dangling.alloc-limit"><a class="rule-link" href="#r-undefined.dangling.alloc-limit" title="undefined.dangling.alloc-limit"><span>[undefined<wbr>.dangling<wbr>.alloc-limit]</span></a>
</div>

<p>特别地，Rust 值的动态大小（由 <code>size_of_val</code> 确定）绝不能超过 <code>isize::MAX</code>，因为单个分配的大小不可能大于 <code>isize::MAX</code>。</p>
<div class="rule" id="r-undefined.validity"><a class="rule-link" href="#r-undefined.validity" title="undefined.validity"><span>[undefined<wbr>.validity]</span></a>
</div>

<h2 id="无效值"><a class="header" href="#无效值">无效值</a></h2>
<div class="rule" id="r-undefined.validity.general"><a class="rule-link" href="#r-undefined.validity.general" title="undefined.validity.general"><span>[undefined<wbr>.validity<wbr>.general]</span></a>
</div>

<p>Rust 编译器假设程序执行期间产生的所有值都是“有效的”，因此产生无效值会立即导致 UB。</p>
<p>一个值是否有效取决于其类型：</p>
<div class="rule" id="r-undefined.validity.bool"><a class="rule-link" href="#r-undefined.validity.bool" title="undefined.validity.bool"><span>[undefined<wbr>.validity<wbr>.bool]</span></a>
</div>

<ul>
<li>一个 <a href="#布尔类型"><code>bool</code></a> 值必须是 <code>false</code> (<code>0</code>) 或 <code>true</code> (<code>1</code>)。</li>
</ul>
<div class="rule" id="r-undefined.validity.fn-pointer"><a class="rule-link" href="#r-undefined.validity.fn-pointer" title="undefined.validity.fn-pointer"><span>[undefined<wbr>.validity<wbr>.fn-pointer]</span></a>
</div>

<ul>
<li>一个 <code>fn</code> 指针值必须非空。</li>
</ul>
<div class="rule" id="r-undefined.validity.char"><a class="rule-link" href="#r-undefined.validity.char" title="undefined.validity.char"><span>[undefined<wbr>.validity<wbr>.char]</span></a>
</div>

<ul>
<li>一个 <code>char</code> 值不能是代理对 (surrogate)（即不能在 <code>0xD800..=0xDFFF</code> 范围内），且必须小于或等于 <code>char::MAX</code>。</li>
</ul>
<div class="rule" id="r-undefined.validity.never"><a class="rule-link" href="#r-undefined.validity.never" title="undefined.validity.never"><span>[undefined<wbr>.validity<wbr>.never]</span></a>
</div>

<ul>
<li><code>!</code> 值绝不能存在。</li>
</ul>
<div class="rule" id="r-undefined.validity.scalar"><a class="rule-link" href="#r-undefined.validity.scalar" title="undefined.validity.scalar"><span>[undefined<wbr>.validity<wbr>.scalar]</span></a>
</div>

<ul>
<li>整数 (<code>i*</code>/<code>u*</code>)、浮点值 (<code>f*</code>) 或原始指针必须已初始化，即不能从未初始化的内存中获得。</li>
</ul>
<div class="rule" id="r-undefined.validity.str"><a class="rule-link" href="#r-undefined.validity.str" title="undefined.validity.str"><span>[undefined<wbr>.validity<wbr>.str]</span></a>
</div>

<ul>
<li><code>str</code> 值被视为类似于 <code>[u8]</code>，即它必须已初始化。</li>
</ul>
<div class="rule" id="r-undefined.validity.enum"><a class="rule-link" href="#r-undefined.validity.enum" title="undefined.validity.enum"><span>[undefined<wbr>.validity<wbr>.enum]</span></a>
</div>

<ul>
<li>一个 <code>enum</code> 必须具有有效的判别值 (discriminant)，且该判别值指示的变体 (variant) 的所有字段必须在其各自类型上有效。</li>
</ul>
<div class="rule" id="r-undefined.validity.struct"><a class="rule-link" href="#r-undefined.validity.struct" title="undefined.validity.struct"><span>[undefined<wbr>.validity<wbr>.struct]</span></a>
</div>

<ul>
<li><code>struct</code>、元组和数组要求所有字段/元素在其各自类型上有效。</li>
</ul>
<div class="rule" id="r-undefined.validity.union"><a class="rule-link" href="#r-undefined.validity.union" title="undefined.validity.union"><span>[undefined<wbr>.validity<wbr>.union]</span></a>
</div>

<ul>
<li>对于 <code>union</code>，确切的有效性要求尚未确定。
显然，所有完全在安全代码中创建的值都是有效的。
如果联合体具有零大小字段，则每个可能的值都是有效的。
更多细节 <a href="https://github.com/rust-lang/unsafe-code-guidelines/issues/438">仍处于讨论中</a>。</li>
</ul>
<div class="rule" id="r-undefined.validity.reference-box"><a class="rule-link" href="#r-undefined.validity.reference-box" title="undefined.validity.reference-box"><span>[undefined<wbr>.validity<wbr>.reference-box]</span></a>
</div>

<ul>
<li>引用或 <a href="../alloc/boxed/struct.Box.html"><code>Box&lt;T&gt;</code></a> 必须对齐且非空，它不能是 <a href="#dangling-pointers">悬垂的</a>，且必须指向一个有效值
（对于动态大小类型，使用由元数据确定的被指向者的实际动态类型）。
请注意，最后一点（关于指向有效值）仍是一个有争议的话题。</li>
</ul>
<div class="rule" id="r-undefined.validity.wide"><a class="rule-link" href="#r-undefined.validity.wide" title="undefined.validity.wide"><span>[undefined<wbr>.validity<wbr>.wide]</span></a>
</div>

<ul>
<li>宽引用、<a href="../alloc/boxed/struct.Box.html"><code>Box&lt;T&gt;</code></a> 或原始指针的元数据必须与 unsized tail 的类型匹配：
<ul>
<li><code>dyn Trait</code> 元数据必须是编译器为 <code>Trait</code> 生成的虚表 (vtable) 指针。
（对于原始指针，这一要求仍是一个有争议的话题。）</li>
<li>切片 (<code>[T]</code>) 元数据必须是一个有效的 <code>usize</code>。
此外，对于宽引用和 <a href="../alloc/boxed/struct.Box.html"><code>Box&lt;T&gt;</code></a>，如果切片元数据使得被指向值的总大小大于 <code>isize::MAX</code>，则该元数据是无效的。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-undefined.validity.valid-range"><a class="rule-link" href="#r-undefined.validity.valid-range" title="undefined.validity.valid-range"><span>[undefined<wbr>.validity<wbr>.valid-range]</span></a>
</div>

<ul>
<li>
<p>如果一个类型具有自定义的有效值范围，那么有效值必须在该范围内。
在标准库中，这会影响 <a href="../core/ptr/non_null/struct.NonNull.html"><code>NonNull&lt;T&gt;</code></a> 和 <a href="../core/num/nonzero/struct.NonZero.html"><code>NonZero&lt;T&gt;</code></a>。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 通过不稳定的 <code>rustc_layout_scalar_valid_range_*</code> 属性来实现这一点。</p>
</blockquote>
</div>

</li>
</ul>
<div class="rule" id="r-undefined.validity.const-provenance"><a class="rule-link" href="#r-undefined.validity.const-provenance" title="undefined.validity.const-provenance"><span>[undefined<wbr>.validity<wbr>.const-provenance]</span></a>
</div>

<ul>
<li>
<p><strong>在 <a href="#r-const-eval.const-context">常量上下文</a> 中</strong>：除了上述描述之外，常量求值期间还适用进一步的与 物源 (provenance) 相关的要求。任何持有纯整数数据（<code>i*</code>/<code>u*</code>/<code>f*</code> 类型以及 <code>bool</code> 和 <code>char</code>、枚举判别值和切片元数据）的值都不得携带任何物源。任何持有指针数据（引用、原始指针、函数指针和 <code>dyn Trait</code> 元数据）的值必须要么不携带物源，要么所有字节必须是同一个原始指针值按正确顺序排列的碎片。</p>
<p>这意味着如果指针具有物源，那么将指针（引用、原始指针或函数指针） transmute 或以其他方式重新解释为非指针类型（如整数）就是未定义行为。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>以下所有情况都是 UB：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use core::mem::MaybeUninit;
</span><span class="boring">use core::ptr;
</span>// 我们不能将具有物源的指针重新解释为整数，
// 否则该整数的字节将具有物源。
const _: usize = {
    let ptr = &amp;0;
    unsafe { (&amp;raw const ptr as *const usize).read() }
};

// 我们不能重新排列具有物源的指针的字节，
// 然后将它们解释为引用，因为那样持有
// 指针数据的值将具有顺序错误的指针碎片。
const _: &amp;i32 = {
    let mut ptr = &amp;0;
    let ptr_bytes = &amp;raw mut ptr as *mut MaybeUninit::&lt;u8&gt;;
    unsafe { ptr::swap(ptr_bytes.add(1), ptr_bytes.add(2)) };
    ptr
};
<span class="boring">}</span></code></pre>
</blockquote>
</div>

</li>
</ul>
<div class="rule" id="r-undefined.validity.undef"><a class="rule-link" href="#r-undefined.validity.undef" title="undefined.validity.undef"><span>[undefined<wbr>.validity<wbr>.undef]</span></a>
</div>

<p><strong>注意：</strong> 未初始化内存对于任何具有限制有效值集合的类型也是隐式无效的。换句话说，唯一允许读取未初始化内存的情况是在 <code>union</code> 内部和“填充 (padding)”中（类型字段之间的间隙）。</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="不被视为-unsafe-的行为"><a class="header" href="#不被视为-unsafe-的行为">不被视为 <code>unsafe</code> 的行为</a></h1>
<p>Rust 编译器不认为以下行为是 <em>不安全</em> 的，尽管程序员可能（应该）发现它们是不受欢迎的、意外的或错误的。</p>
<ul>
<li>死锁</li>
<li>内存和其他资源的泄漏</li>
<li>退出而不调用析构函数</li>
<li>通过指针泄漏暴露随机化的基地址</li>
</ul>
<h2 id="整数溢出"><a class="header" href="#整数溢出">整数溢出</a></h2>
<p>如果程序包含算术溢出，说明程序员犯了错误。在接下来的讨论中，我们对算术溢出和回绕算术进行区分。前者是错误的，而后者是有意的。</p>
<p>当程序员启用了 <code>debug_assert!</code> 断言时（例如，通过启用非优化构建），实现必须插入在溢出时触发 <code>恐慌</code> 的动态检查。其他类型的构建可能会根据实现的决定，在溢出时导致 <code>恐慌</code> 或静默回绕值。</p>
<p>在隐式回绕溢出的情况下，实现必须通过使用补码溢出惯例提供定义良好的（即使仍被认为是错误的）结果。</p>
<p>整数类型提供了固有方法，允许程序员显式地执行回绕算术。例如，<code>i32::wrapping_add</code> 提供了补码回绕加法。</p>
<p>标准库还提供了一个 <code>Wrapping&lt;T&gt;</code> 新类型，它确保 <code>T</code> 的所有标准算术运算都具有回绕语义。</p>
<p>有关错误条件、基本原理以及关于整数溢出的更多详细信息，请参阅 <a href="https://github.com/rust-lang/rfcs/blob/master/text/0560-integer-overflow.md">RFC 560</a>。</p>
<h2 id="逻辑错误"><a class="header" href="#逻辑错误">逻辑错误</a></h2>
<p>安全代码可能会施加额外的逻辑约束，这些约束既不能在编译时也不能在运行时检查。如果程序违反了此类约束，行为可能是未指明的，但不会导致未定义行为。这可能包括 <code>恐慌</code> 、错误结果、中止和非终止。行为在不同运行、构建或构建类型之间也可能有所不同。</p>
<p>例如，同时实现 <code>Hash</code> 和 <code>Eq</code> 要求被认为相等的值具有相等的哈希值。另一个例子是像 <code>BinaryHeap</code>、<code>BTreeMap</code>、<code>BTreeSet</code>、<code>HashMap</code> 和 <code>HashSet</code> 这样的数据结构，它们描述了当键位于数据结构中时对其进行修改的约束。违反这些约束不被视为不安全，但程序被认为是错误的，其行为是不可预测的。</p>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-const-eval"><a class="rule-link" href="#r-const-eval" title="const-eval"><span>[const-eval]</span></a>
</div>

<h1 id="常量求值"><a class="header" href="#常量求值">常量求值</a></h1>
<div class="rule" id="r-const-eval.general"><a class="rule-link" href="#r-const-eval.general" title="const-eval.general"><span>[const-eval<wbr>.general]</span></a>
</div>

<p>常量求值是在编译过程中计算 <a href="#表达式">表达式</a> 结果的过程。所有表达式中只有一部分可以在编译时求值。</p>
<div class="rule" id="r-const-eval.const-expr"><a class="rule-link" href="#r-const-eval.const-expr" title="const-eval.const-expr"><span>[const-eval<wbr>.const-expr]</span></a>
</div>

<h2 id="常量表达式"><a class="header" href="#常量表达式">常量表达式</a></h2>
<div class="rule" id="r-const-eval.const-expr.general"><a class="rule-link" href="#r-const-eval.const-expr.general" title="const-eval.const-expr.general"><span>[const-eval<wbr>.const-expr<wbr>.general]</span></a>
</div>

<p>某些形式的表达式，称为常量表达式，可以在编译时求值。</p>
<div class="rule" id="r-const-eval.const-expr.const-context"><a class="rule-link" href="#r-const-eval.const-expr.const-context" title="const-eval.const-expr.const-context"><span>[const-eval<wbr>.const-expr<wbr>.const-context]</span></a>
</div>

<p>在 <a href="#常量上下文">常量上下文</a> 中的表达式必须是常量表达式。</p>
<div class="rule" id="r-const-eval.const-expr.evaluation"><a class="rule-link" href="#r-const-eval.const-expr.evaluation" title="const-eval.const-expr.evaluation"><span>[const-eval<wbr>.const-expr<wbr>.evaluation]</span></a>
</div>

<p>常量上下文中的表达式总是在编译时求值。</p>
<div class="rule" id="r-const-eval.const-expr.runtime-context"><a class="rule-link" href="#r-const-eval.const-expr.runtime-context" title="const-eval.const-expr.runtime-context"><span>[const-eval<wbr>.const-expr<wbr>.runtime-context]</span></a>
</div>

<p>在常量上下文之外，常量表达式 <em>可能</em> 会被求值，但不保证一定在编译时求值。</p>
<div class="rule" id="r-const-eval.const-expr.error"><a class="rule-link" href="#r-const-eval.const-expr.error" title="const-eval.const-expr.error"><span>[const-eval<wbr>.const-expr<wbr>.error]</span></a>
</div>

<p>如果一个值必须在编译时（即在常量上下文中）求值，那么诸如越界 <a href="#array-and-slice-indexing-expressions">数组索引</a> 或 <a href="#overflow">溢出</a> 之类的行为将是编译器错误。否则，这些行为只是警告，但在运行时很可能会产生 恐慌。</p>
<div class="rule" id="r-const-eval.const-expr.list"><a class="rule-link" href="#r-const-eval.const-expr.list" title="const-eval.const-expr.list"><span>[const-eval<wbr>.const-expr<wbr>.list]</span></a>
</div>

<p>只要所有操作数也都是常量表达式，且不会导致任何 <a href="#析构函数"><code>Drop::drop</code></a> 调用被运行，以下表达式就是常量表达式。</p>
<div class="rule" id="r-const-eval.const-expr.literal"><a class="rule-link" href="#r-const-eval.const-expr.literal" title="const-eval.const-expr.literal"><span>[const-eval<wbr>.const-expr<wbr>.literal]</span></a>
</div>

<ul>
<li><a href="#字面量表达式">字面量</a>。</li>
</ul>
<div class="rule" id="r-const-eval.const-expr.parameter"><a class="rule-link" href="#r-const-eval.const-expr.parameter" title="const-eval.const-expr.parameter"><span>[const-eval<wbr>.const-expr<wbr>.parameter]</span></a>
</div>

<ul>
<li><a href="#泛型参数">常量参数</a>。</li>
</ul>
<div class="rule" id="r-const-eval.const-expr.path-item"><a class="rule-link" href="#r-const-eval.const-expr.path-item" title="const-eval.const-expr.path-item"><span>[const-eval<wbr>.const-expr<wbr>.path-item]</span></a>
</div>

<ul>
<li>指向 <a href="#函数">函数</a> 和 <a href="#常量项">常量</a> 的 <a href="#路径表达式">路径</a>。不允许递归地定义常量。</li>
</ul>
<div class="rule" id="r-const-eval.const-expr.path-static"><a class="rule-link" href="#r-const-eval.const-expr.path-static" title="const-eval.const-expr.path-static"><span>[const-eval<wbr>.const-expr<wbr>.path-static]</span></a>
</div>

<ul>
<li>
<p>指向 <a href="#静态项">静态项</a> 的路径，具有以下限制：</p>
<ul>
<li>在任何常量求值上下文中都不允许对 <code>static</code> 项进行写入。</li>
<li>在任何常量求值上下文中都不允许从 <code>extern</code> 静态项中读取。</li>
<li>如果求值 <em>不是</em> 在 <code>static</code> 项的初始化器中进行的，那么就不允许从任何可变的 <code>static</code> 中读取。可变的 <code>static</code> 是指 <code>static mut</code> 项，或者具有内部可变类型的 <code>static</code> 项。</li>
</ul>
<p>这些要求仅在常量求值时检查。换句话说，只要这些访问从未被执行，它们在语法上出现在常量上下文中是允许的。</p>
</li>
</ul>
<div class="rule" id="r-const-eval.const-expr.tuple"><a class="rule-link" href="#r-const-eval.const-expr.tuple" title="const-eval.const-expr.tuple"><span>[const-eval<wbr>.const-expr<wbr>.tuple]</span></a>
</div>

<ul>
<li><a href="#元组和元组索引表达式">元组表达式</a>。</li>
</ul>
<div class="rule" id="r-const-eval.const-expr.array"><a class="rule-link" href="#r-const-eval.const-expr.array" title="const-eval.const-expr.array"><span>[const-eval<wbr>.const-expr<wbr>.array]</span></a>
</div>

<ul>
<li><a href="#数组和数组索引表达式">数组表达式</a>。</li>
</ul>
<div class="rule" id="r-const-eval.const-expr.constructor"><a class="rule-link" href="#r-const-eval.const-expr.constructor" title="const-eval.const-expr.constructor"><span>[const-eval<wbr>.const-expr<wbr>.constructor]</span></a>
</div>

<ul>
<li><a href="#结构体表达式">结构体表达式</a>。</li>
</ul>
<div class="rule" id="r-const-eval.const-expr.block"><a class="rule-link" href="#r-const-eval.const-expr.block" title="const-eval.const-expr.block"><span>[const-eval<wbr>.const-expr<wbr>.block]</span></a>
</div>

<ul>
<li><a href="#块表达式">块表达式</a>，包括 <code>unsafe</code> 和 <code>const</code> 块。
<ul>
<li><a href="#let-statements">let 语句</a> 及其不可驳 <a href="#模式">模式</a>，包括可变绑定</li>
<li><a href="#assignment-expressions">赋值表达式</a></li>
<li><a href="#compound-assignment-expressions">复合赋值表达式</a></li>
<li><a href="#expression-statements">表达式语句</a></li>
</ul>
</li>
</ul>
<div class="rule" id="r-const-eval.const-expr.field"><a class="rule-link" href="#r-const-eval.const-expr.field" title="const-eval.const-expr.field"><span>[const-eval<wbr>.const-expr<wbr>.field]</span></a>
</div>

<ul>
<li><a href="#字段访问表达式">字段</a> 表达式。</li>
</ul>
<div class="rule" id="r-const-eval.const-expr.index"><a class="rule-link" href="#r-const-eval.const-expr.index" title="const-eval.const-expr.index"><span>[const-eval<wbr>.const-expr<wbr>.index]</span></a>
</div>

<ul>
<li>索引表达式，使用 <code>usize</code> 进行 <a href="#array-and-slice-indexing-expressions">数组索引</a> 或 <a href="#切片类型">切片</a>。</li>
</ul>
<div class="rule" id="r-const-eval.const-expr.range"><a class="rule-link" href="#r-const-eval.const-expr.range" title="const-eval.const-expr.range"><span>[const-eval<wbr>.const-expr<wbr>.range]</span></a>
</div>

<ul>
<li><a href="#范围表达式">范围表达式</a>。</li>
</ul>
<div class="rule" id="r-const-eval.const-expr.closure"><a class="rule-link" href="#r-const-eval.const-expr.closure" title="const-eval.const-expr.closure"><span>[const-eval<wbr>.const-expr<wbr>.closure]</span></a>
</div>

<ul>
<li>不从环境中捕获变量的 <a href="#闭包表达式">闭包表达式</a>。</li>
</ul>
<div class="rule" id="r-const-eval.const-expr.builtin-arith-logic"><a class="rule-link" href="#r-const-eval.const-expr.builtin-arith-logic" title="const-eval.const-expr.builtin-arith-logic"><span>[const-eval<wbr>.const-expr<wbr>.builtin-arith-logic]</span></a>
</div>

<ul>
<li>用于整数和浮点类型、<code>bool</code> 和 <code>char</code> 的内建 <a href="#negation-operators">取反</a>、<a href="#arithmetic-and-logical-binary-operators">算术</a>、<a href="#arithmetic-and-logical-binary-operators">逻辑</a>、<a href="#comparison-operators">比较</a> 或 <a href="#lazy-boolean-operators">惰性布尔</a> 运算符。</li>
</ul>
<div class="rule" id="r-const-eval.const-expr.borrows"><a class="rule-link" href="#r-const-eval.const-expr.borrows" title="const-eval.const-expr.borrows"><span>[const-eval<wbr>.const-expr<wbr>.borrows]</span></a>
</div>

<ul>
<li>
<p>所有形式的 <a href="#borrow-operators">借用</a>，包括原始借用，但以下表达式的借用除外（这些表达式的临时作用域会被延长（见 <a href="#r-destructors.scope.lifetime-extension">临时变量生命周期延长</a>）至程序结束）：</p>
<ul>
<li>可变借用。</li>
<li>对产生具有 <a href="#内部可变性">内部可变性</a> 的值的表达式的共享借用。</li>
</ul>
<pre class="playground"><code class="language-rust compile_fail E0764 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 由于处于尾部位置，此借用将临时变量的作用域延长至程序结束。
// 由于借用是可变的，这在常量表达式中是不允许的。
const C: &amp;u8 = &amp;mut 0; // ERROR not allowed
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0764 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 常量块类似于常量项的初始化器。
let _: &amp;u8 = const { &amp;mut 0 }; // ERROR not allowed
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0492 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use core::sync::atomic::AtomicU8;
</span>// 这是不允许的，因为 1) 临时作用域延长到了程序结束，且 2) 临时变量具有内部可变性。
const C: &amp;AtomicU8 = &amp;AtomicU8::new(0); // ERROR not allowed
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0492 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use core::sync::atomic::AtomicU8;
</span>// 同上。
let _: &amp;_ = const { &amp;AtomicU8::new(0) }; // ERROR not allowed
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#![allow(static_mut_refs)]
</span>// 尽管此借用是可变的，但它不是对临时变量的借用，因此这是允许的。
const C: &amp;u8 = unsafe { static mut S: u8 = 0; &amp;mut S }; // OK
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use core::sync::atomic::AtomicU8;
</span>// 尽管此借用是对具有内部可变性的值的借用，但它不是对临时变量的借用，因此这是允许的。
const C: &amp;AtomicU8 = {
    static S: AtomicU8 = AtomicU8::new(0); &amp;S // OK
};
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use core::sync::atomic::AtomicU8;
</span>// 这种对内部可变临时变量的共享借用是允许的，因为其作用域没有被延长。
const C: () = { _ = &amp;AtomicU8::new(0); }; // OK
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 尽管借用是可变的，且临时变量因提升而存续到程序结束，但这是允许的，因为
// 借用不在尾部位置，因此临时变量的作用域不会通过临时变量生命周期延长来延长。
const C: () = { let _: &amp;'static mut [u8] = &amp;mut []; }; // OK
//                                              ~~
//                                     提升的临时变量。
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>换句话说 —— 为了关注什么是允许的而不是什么是不允许的 —— 只有当被借用的 <a href="#r-expr.place-value.place-memory-location">位置表达式</a> 是 <em>瞬态的</em> 、 <em>间接的</em> 或 <em>静态的</em> 时，才允许在 <a href="#常量上下文">常量上下文</a> 中对内部可变数据进行共享借用和可变借用。</p>
<p>如果位置表达式是当前常量上下文的局部变量，或者是临时作用域包含在当前常量上下文中的表达式，则该位置表达式是 <em>瞬态的</em> 。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 借用是对初始化器局部变量的借用，因此此位置表达式是瞬态的。
const C: () = { let mut x = 0; _ = &amp;mut x; };
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 借用是对作用域未延长的临时变量的借用，因此此位置表达式是瞬态的。
const C: () = { _ = &amp;mut 0u8; };
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 当临时变量被提升但没有延长生命周期时，其位置表达式仍被视为瞬态的。
const C: () = { let _: &amp;'static mut [u8] = &amp;mut []; };
<span class="boring">}</span></code></pre>
<p>如果位置表达式是 <a href="#r-expr.deref">解引用表达式</a>，则该位置表达式是 <em>间接的</em> 。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>const C: () = { _ = &amp;mut *(&amp;mut 0); };
<span class="boring">}</span></code></pre>
<p>如果位置表达式是一个 <code>static</code> 项，则该位置表达式是 <em>静态的</em> 。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#![allow(static_mut_refs)]
</span>const C: &amp;u8 = unsafe { static mut S: u8 = 0; &amp;mut S };
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>这些规则的一个令人惊讶的后果是我们允许这样做：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>const C: &amp;[u8] = { let x: &amp;mut [u8] = &amp;mut []; x }; // OK
//                                    ~~~~~~~
// 即使在可变借用之后，空数组也会被提升。
<span class="boring">}</span></code></pre>
<p>但我们不允许类似的这段代码：</p>
<pre class="playground"><code class="language-rust compile_fail E0764 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>const C: &amp;[u8] = &amp;mut []; // ERROR
//               ~~~~~~~
//           尾部表达式。
<span class="boring">}</span></code></pre>
<p>它们之间的区别在于，在第一种情况中，空数组被 <a href="#constant-promotion">提升</a> 了，但它的作用域没有经历 <a href="#r-destructors.scope.lifetime-extension">临时变量生命周期延长</a>，所以我们认为 <a href="#r-expr.place-value.place-memory-location">位置表达式</a> 是瞬态的（即使在提升之后该位置确实存续到程序结束）。在第二种情况中，空数组临时变量的作用域确实经历了生命周期延长，因此它因为是对生命周期延长的临时变量的可变借用（从而借用了非瞬态的位置表达式）而被拒绝。</p>
<p>这种效果令人惊讶，因为在这种情况下，临时变量生命周期延长导致可编译的代码比没有它时更少。</p>
<p>见 <a href="https://github.com/rust-lang/rust/issues/143129">issue #143129</a> 了解更多细节。</p>
</blockquote>
</div>

</li>
</ul>
<div class="rule" id="r-const-eval.const-expr.deref"><a class="rule-link" href="#r-const-eval.const-expr.deref" title="const-eval.const-expr.deref"><span>[const-eval<wbr>.const-expr<wbr>.deref]</span></a>
</div>

<ul>
<li>
<p><a href="#r-expr.deref">解引用表达式</a>。</p>
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">use core::cell::UnsafeCell;
</span>const _: u8 = unsafe {
    let x: *mut u8 = &amp;raw mut *&amp;mut 0;
    //                        ^^^^^^^
    //             对可变引用的解引用。
    *x = 1; // 对可变指针的解引用。
    *(x as *const u8) // 对常量指针的解引用。
};
const _: u8 = unsafe {
    let x = &amp;UnsafeCell::new(0);
    *x.get() = 1; // 对内部可变值的修改。
    *x.get()
};
<span class="boring">}</span></code></pre>
</li>
</ul>
<div class="rule" id="r-const-eval.const-expr.group"><a class="rule-link" href="#r-const-eval.const-expr.group" title="const-eval.const-expr.group"><span>[const-eval<wbr>.const-expr<wbr>.group]</span></a>
</div>

<ul>
<li><a href="#分组表达式">分组</a> 表达式。</li>
</ul>
<div class="rule" id="r-const-eval.const-expr.cast"><a class="rule-link" href="#r-const-eval.const-expr.cast" title="const-eval.const-expr.cast"><span>[const-eval<wbr>.const-expr<wbr>.cast]</span></a>
</div>

<ul>
<li><a href="#type-cast-expressions">转换</a> 表达式，除了
<ul>
<li>指针到地址转换以及</li>
<li>函数指针到地址转换。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-const-eval.const-expr.const-fn"><a class="rule-link" href="#r-const-eval.const-expr.const-fn" title="const-eval.const-expr.const-fn"><span>[const-eval<wbr>.const-expr<wbr>.const-fn]</span></a>
</div>

<ul>
<li>调用 <a href="#const-functions">常量函数</a> 和常量方法。</li>
</ul>
<div class="rule" id="r-const-eval.const-expr.loop"><a class="rule-link" href="#r-const-eval.const-expr.loop" title="const-eval.const-expr.loop"><span>[const-eval<wbr>.const-expr<wbr>.loop]</span></a>
</div>

<ul>
<li><a href="#infinite-loops">loop</a> 和 <a href="#predicate-loops">while</a> 表达式。</li>
</ul>
<div class="rule" id="r-const-eval.const-expr.if-match"><a class="rule-link" href="#r-const-eval.const-expr.if-match" title="const-eval.const-expr.if-match"><span>[const-eval<wbr>.const-expr<wbr>.if-match]</span></a>
</div>

<ul>
<li><a href="#if-expressions">if</a> 和 <a href="#match表达式">match</a> 表达式。</li>
</ul>
<div class="rule" id="r-const-eval.const-context"><a class="rule-link" href="#r-const-eval.const-context" title="const-eval.const-context"><span>[const-eval<wbr>.const-context]</span></a>
</div>

<h2 id="常量上下文"><a class="header" href="#常量上下文">常量上下文</a></h2>
<div class="rule" id="r-const-eval.const-context.general"><a class="rule-link" href="#r-const-eval.const-context.general" title="const-eval.const-context.general"><span>[const-eval<wbr>.const-context<wbr>.general]</span></a>
</div>

<p><em>常量上下文</em> 是以下之一：</p>
<div class="rule" id="r-const-eval.const-context.array-length"><a class="rule-link" href="#r-const-eval.const-context.array-length" title="const-eval.const-context.array-length"><span>[const-eval<wbr>.const-context<wbr>.array-length]</span></a>
</div>

<ul>
<li><a href="#数组类型">数组类型长度表达式</a></li>
</ul>
<div class="rule" id="r-const-eval.const-context.repeat-length"><a class="rule-link" href="#r-const-eval.const-context.repeat-length" title="const-eval.const-context.repeat-length"><span>[const-eval<wbr>.const-context<wbr>.repeat-length]</span></a>
</div>

<ul>
<li><a href="#数组和数组索引表达式">数组重复长度表达式</a></li>
</ul>
<div class="rule" id="r-const-eval.const-context.init"><a class="rule-link" href="#r-const-eval.const-context.init" title="const-eval.const-context.init"><span>[const-eval<wbr>.const-context<wbr>.init]</span></a>
</div>

<ul>
<li>以下项的初始化器
<ul>
<li><a href="#常量项">常量</a></li>
<li><a href="#静态项">静态项</a></li>
<li><a href="#discriminants">枚举判别值</a></li>
</ul>
</li>
</ul>
<div class="rule" id="r-const-eval.const-context.generic"><a class="rule-link" href="#r-const-eval.const-context.generic" title="const-eval.const-context.generic"><span>[const-eval<wbr>.const-context<wbr>.generic]</span></a>
</div>

<ul>
<li><a href="#const-generics">常量泛型参数</a></li>
</ul>
<div class="rule" id="r-const-eval.const-context.block"><a class="rule-link" href="#r-const-eval.const-context.block" title="const-eval.const-context.block"><span>[const-eval<wbr>.const-context<wbr>.block]</span></a>
</div>

<ul>
<li><a href="#const-blocks">常量块</a></li>
</ul>
<div class="rule" id="r-const-eval.const-context.outer-generics"><a class="rule-link" href="#r-const-eval.const-context.outer-generics" title="const-eval.const-context.outer-generics"><span>[const-eval<wbr>.const-context<wbr>.outer-generics]</span></a>
</div>

<p>作为类型一部分使用的常量上下文（数组类型和重复长度表达式以及常量泛型参数）只能限制性地使用周围的泛型参数：此类表达式必须要么是单个裸常量泛型参数，要么是不使用任何泛型的任意表达式。</p>
<div class="rule" id="r-const-eval.const-fn"><a class="rule-link" href="#r-const-eval.const-fn" title="const-eval.const-fn"><span>[const-eval<wbr>.const-fn]</span></a>
</div>

<h2 id="常量函数"><a class="header" href="#常量函数">常量函数</a></h2>
<div class="rule" id="r-const-eval.const-fn.intro"><a class="rule-link" href="#r-const-eval.const-fn.intro" title="const-eval.const-fn.intro"><span>[const-eval<wbr>.const-fn<wbr>.intro]</span></a>
</div>

<p><em>常量函数</em> 是可以从常量上下文中调用的函数。它使用 <code>const</code> 限定符定义，并且还包括 <a href="#结构体">元组结构体</a> 和 <a href="#枚举">元组枚举变体</a> 构造函数。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>const fn square(x: i32) -&gt; i32 { x * x }

const VALUE: i32 = square(12);
square(12);
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-const-eval.const-fn.const-context"><a class="rule-link" href="#r-const-eval.const-fn.const-context" title="const-eval.const-fn.const-context"><span>[const-eval<wbr>.const-fn<wbr>.const-context]</span></a>
</div>

<p>当从常量上下文中调用时，常量函数由编译器在编译时解释。这种解释发生在编译 target 的环境中，而不是宿主环境。因此，如果你针对 <code>32</code> 位系统进行编译，<code>usize</code> 就是 <code>32</code> 位，而不管你是在 <code>64</code> 位还是 <code>32</code> 位系统上进行构建。</p>
<div class="rule" id="r-const-eval.const-fn.outside-context"><a class="rule-link" href="#r-const-eval.const-fn.outside-context" title="const-eval.const-fn.outside-context"><span>[const-eval<wbr>.const-fn<wbr>.outside-context]</span></a>
</div>

<p>当在常量上下文之外调用常量函数时，它的行为与没有 <code>const</code> 限定符时相同。</p>
<div class="rule" id="r-const-eval.const-fn.body-restriction"><a class="rule-link" href="#r-const-eval.const-fn.body-restriction" title="const-eval.const-fn.body-restriction"><span>[const-eval<wbr>.const-fn<wbr>.body-restriction]</span></a>
</div>

<p>常量函数的主体只能使用 <a href="#constant-expressions">常量表达式</a>。</p>
<div class="rule" id="r-const-eval.const-fn.async"><a class="rule-link" href="#r-const-eval.const-fn.async" title="const-eval.const-fn.async"><span>[const-eval<wbr>.const-fn<wbr>.async]</span></a>
</div>

<p>常量函数不允许是 <a href="#async-functions">异步</a> 的。</p>
<div class="rule" id="r-const-eval.const-fn.type-restrictions"><a class="rule-link" href="#r-const-eval.const-fn.type-restrictions" title="const-eval.const-fn.type-restrictions"><span>[const-eval<wbr>.const-fn<wbr>.type-restrictions]</span></a>
</div>

<p>常量函数的参数类型和返回类型仅限于那些与常量上下文兼容的类型。</p>
<!-- TODO: 定义类型限制。 -->
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-abi"><a class="rule-link" href="#r-abi" title="abi"><span>[abi]</span></a>
</div>

<h1 id="应用二进制接口abi"><a class="header" href="#应用二进制接口abi">应用二进制接口(ABI)</a></h1>
<div class="rule" id="r-abi.intro"><a class="rule-link" href="#r-abi.intro" title="abi.intro"><span>[abi<wbr>.intro]</span></a>
</div>

<p>本节记录了影响 crate 编译输出 ABI 的特性。</p>
<p>有关指定导出函数 ABI 的信息，请参阅 <em><a href="#extern-function-qualifier">外部函数</a></em>。有关指定链接外部库 ABI 的信息，请参阅 <em><a href="#外部块">外部块</a></em>。</p>
<div class="rule" id="r-abi.used"><a class="rule-link" href="#r-abi.used" title="abi.used"><span>[abi<wbr>.used]</span></a>
</div>

<h2 id="used属性"><a class="header" href="#used属性">used属性</a></h2>
<div class="rule" id="r-abi.used.intro"><a class="rule-link" href="#r-abi.used.intro" title="abi.used.intro"><span>[abi<wbr>.used<wbr>.intro]</span></a>
</div>

<p><em><code>used</code> 属性</em> 只能应用于 <a href="#静态项"><code>static</code> 项</a>。此 <a href="#属性-1">属性</a> 强制编译器在输出的目标文件（.o、.rlib 等，不包括最终的可执行文件）中保留变量，即使该变量未被 crate 中的任何其他项使用或引用。然而，链接器仍然可以自由地删除这样的项。</p>
<p>下面是一个示例，展示了编译器在什么条件下会将 <code>static</code> 项保留在输出的目标文件中。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// foo.rs

// 即使未使用，也因为 #[used] 而被保留：
#[used]
static FOO: u32 = 0;

// 因为未使用而可以被删除：
#[allow(dead_code)]
static BAR: u32 = 0;

// 因为是公共可达的而被保留：
pub static BAZ: u32 = 0;

// 因为被一个公共可达的函数引用而被保留：
static QUUX: u32 = 0;

pub fn quux() -&gt; &amp;'static u32 {
    &amp;QUUX
}

// 因为被一个私有的、未使用的（死代码）函数引用而可以被删除：
static CORGE: u32 = 0;

#[allow(dead_code)]
fn corge() -&gt; &amp;'static u32 {
    &amp;CORGE
}
<span class="boring">}</span></code></pre>
<pre><code class="language-console">$ rustc -O --emit=obj --crate-type=rlib foo.rs

$ nm -C foo.o
0000000000000000 R foo::BAZ
0000000000000000 r foo::FOO
0000000000000000 R foo::QUUX
0000000000000000 T foo::quux
</code></pre>
<div class="rule" id="r-abi.no_mangle"><a class="rule-link" href="#r-abi.no_mangle" title="abi.no_mangle"><span>[abi<wbr>.no_mangle]</span></a>
</div>

<h2 id="no_mangle属性"><a class="header" href="#no_mangle属性">no_mangle属性</a></h2>
<div class="rule" id="r-abi.no_mangle.intro"><a class="rule-link" href="#r-abi.no_mangle.intro" title="abi.no_mangle.intro"><span>[abi<wbr>.no_mangle<wbr>.intro]</span></a>
</div>

<p><em><code>no_mangle</code> 属性</em> 可用于任何 <a href="#项">项</a> 以禁用标准的符号名混淆。该项的符号将是其名称的标识符。</p>
<div class="rule" id="r-abi.no_mangle.publicly-exported"><a class="rule-link" href="#r-abi.no_mangle.publicly-exported" title="abi.no_mangle.publicly-exported"><span>[abi<wbr>.no_mangle<wbr>.publicly-exported]</span></a>
</div>

<p>此外，该项将从生成的库或目标文件中公开导出，类似于 <a href="#the-used-attribute"><code>used</code> 属性</a>。</p>
<div class="rule" id="r-abi.no_mangle.unsafe"><a class="rule-link" href="#r-abi.no_mangle.unsafe" title="abi.no_mangle.unsafe"><span>[abi<wbr>.no_mangle<wbr>.unsafe]</span></a>
</div>

<p>此属性是不安全的，因为不混淆的符号可能会与另一个具有相同名称的符号（或与众所周知的符号）发生冲突，从而导致未定义行为。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[unsafe(no_mangle)]
extern "C" fn foo() {}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-abi.no_mangle.edition2024"><a class="rule-link" href="#r-abi.no_mangle.edition2024" title="abi.no_mangle.edition2024"><span>[abi<wbr>.no_mangle<wbr>.edition2024]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2024</span> 版次差异</p>

<p>在 2024 版次 之前，允许不带 <code>unsafe</code> 限定地使用 <code>no_mangle</code> 属性。</p>
</blockquote>
</div>

<div class="rule" id="r-abi.link_section"><a class="rule-link" href="#r-abi.link_section" title="abi.link_section"><span>[abi<wbr>.link_section]</span></a>
</div>

<h2 id="link_section属性"><a class="header" href="#link_section属性">link_section属性</a></h2>
<div class="rule" id="r-abi.link_section.intro"><a class="rule-link" href="#r-abi.link_section.intro" title="abi.link_section.intro"><span>[abi<wbr>.link_section<wbr>.intro]</span></a>
</div>

<p><em><code>link_section</code> 属性</em> 指定了 <a href="#函数">函数</a> 或 <a href="#静态项">static</a> 内容将放置在目标文件的哪个节中。</p>
<div class="rule" id="r-abi.link_section.syntax"><a class="rule-link" href="#r-abi.link_section.syntax" title="abi.link_section.syntax"><span>[abi<wbr>.link_section<wbr>.syntax]</span></a>
</div>

<p><code>link_section</code> 属性使用 <a href="#grammar-MetaNameValueStr">MetaNameValueStr</a> 语法来指定节的名称。</p>
<!-- no_run: don't link. The format of the section name is platform-specific. -->
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[unsafe(no_mangle)]
#[unsafe(link_section = ".example_section")]
pub static VAR1: u32 = 1;
<span class="boring">}</span></code></pre>
<div class="rule" id="r-abi.link_section.unsafe"><a class="rule-link" href="#r-abi.link_section.unsafe" title="abi.link_section.unsafe"><span>[abi<wbr>.link_section<wbr>.unsafe]</span></a>
</div>

<p>此属性是不安全的，因为它允许用户将数据和代码放置在不期望它们的内存节中，例如将可变数据放置在只读区域中。</p>
<div class="rule" id="r-abi.link_section.edition2024"><a class="rule-link" href="#r-abi.link_section.edition2024" title="abi.link_section.edition2024"><span>[abi<wbr>.link_section<wbr>.edition2024]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2024</span> 版次差异</p>

<p>在 2024 版次 之前，允许不带 <code>unsafe</code> 限定地使用 <code>link_section</code> 属性。</p>
</blockquote>
</div>

<div class="rule" id="r-abi.export_name"><a class="rule-link" href="#r-abi.export_name" title="abi.export_name"><span>[abi<wbr>.export_name]</span></a>
</div>

<h2 id="export_name属性"><a class="header" href="#export_name属性">export_name属性</a></h2>
<div class="rule" id="r-abi.export_name.intro"><a class="rule-link" href="#r-abi.export_name.intro" title="abi.export_name.intro"><span>[abi<wbr>.export_name<wbr>.intro]</span></a>
</div>

<p><em><code>export_name</code> 属性</em> 指定了将在 <a href="#函数">函数</a> 或 <a href="#静态项">static</a> 上导出的符号名称。</p>
<div class="rule" id="r-abi.export_name.syntax"><a class="rule-link" href="#r-abi.export_name.syntax" title="abi.export_name.syntax"><span>[abi<wbr>.export_name<wbr>.syntax]</span></a>
</div>

<p><code>export_name</code> 属性使用 <a href="#grammar-MetaNameValueStr">MetaNameValueStr</a> 语法来指定符号名称。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[unsafe(export_name = "exported_symbol_name")]
pub fn name_in_rust() { }
<span class="boring">}</span></code></pre>
<div class="rule" id="r-abi.export_name.unsafe"><a class="rule-link" href="#r-abi.export_name.unsafe" title="abi.export_name.unsafe"><span>[abi<wbr>.export_name<wbr>.unsafe]</span></a>
</div>

<p>此属性是不安全的，因为具有自定义名称的符号可能会与另一个具有相同名称的符号（或与众所周知的符号）发生冲突，从而导致未定义行为。</p>
<div class="rule" id="r-abi.export_name.edition2024"><a class="rule-link" href="#r-abi.export_name.edition2024" title="abi.export_name.edition2024"><span>[abi<wbr>.export_name<wbr>.edition2024]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2024</span> 版次差异</p>

<p>在 2024 版次 之前，允许不带 <code>unsafe</code> 限定地使用 <code>export_name</code> 属性。</p>
</blockquote>
</div>

<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-runtime"><a class="rule-link" href="#r-runtime" title="runtime"><span>[runtime]</span></a>
</div>

<h1 id="rust-运行时"><a class="header" href="#rust-运行时">Rust 运行时</a></h1>
<p>本节记录了定义 Rust 运行时某些方面的特性。</p>
<!-- template:attributes -->
<div class="rule" id="r-runtime.global_allocator"><a class="rule-link" href="#r-runtime.global_allocator" title="runtime.global_allocator"><span>[runtime<wbr>.global_allocator]</span></a>
</div>

<h2 id="global_allocator属性"><a class="header" href="#global_allocator属性">global_allocator属性</a></h2>
<div class="rule" id="r-runtime.global_allocator.intro"><a class="rule-link" href="#r-runtime.global_allocator.intro" title="runtime.global_allocator.intro"><span>[runtime<wbr>.global_allocator<wbr>.intro]</span></a>
</div>

<p><em>global_allocator <a href="#r-attributes">属性</a></em> 选择一个 <a href="../std/alloc/index.html">内存分配器</a>。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use core::alloc::{GlobalAlloc, Layout};
use std::alloc::System;

struct MyAllocator;

unsafe impl GlobalAlloc for MyAllocator {
    unsafe fn alloc(&amp;self, layout: Layout) -&gt; *mut u8 {
        unsafe { System.alloc(layout) }
    }
    unsafe fn dealloc(&amp;self, ptr: *mut u8, layout: Layout) {
        unsafe { System.dealloc(ptr, layout) }
    }
}

#[global_allocator]
static GLOBAL: MyAllocator = MyAllocator;
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-runtime.global_allocator.syntax"><a class="rule-link" href="#r-runtime.global_allocator.syntax" title="runtime.global_allocator.syntax"><span>[runtime<wbr>.global_allocator<wbr>.syntax]</span></a>
</div>

<p>global_allocator 属性使用 <a href="#grammar-MetaWord">MetaWord</a> 语法格式。</p>
<div class="rule" id="r-runtime.global_allocator.allowed-positions"><a class="rule-link" href="#r-runtime.global_allocator.allowed-positions" title="runtime.global_allocator.allowed-positions"><span>[runtime<wbr>.global_allocator<wbr>.allowed-positions]</span></a>
</div>

<p>global_allocator 属性只能应用于其类型实现了 <a href="../core/alloc/global/trait.GlobalAlloc.html"><code>GlobalAlloc</code></a> 特型 的 <a href="#静态项">静态项</a>。</p>
<div class="rule" id="r-runtime.global_allocator.duplicates"><a class="rule-link" href="#r-runtime.global_allocator.duplicates" title="runtime.global_allocator.duplicates"><span>[runtime<wbr>.global_allocator<wbr>.duplicates]</span></a>
</div>

<p>global_allocator 属性在项上只能使用一次。</p>
<div class="rule" id="r-runtime.global_allocator.single"><a class="rule-link" href="#r-runtime.global_allocator.single" title="runtime.global_allocator.single"><span>[runtime<wbr>.global_allocator<wbr>.single]</span></a>
</div>

<p>global_allocator 属性在 crate 图中只能使用一次。</p>
<div class="rule" id="r-runtime.global_allocator.stdlib"><a class="rule-link" href="#r-runtime.global_allocator.stdlib" title="runtime.global_allocator.stdlib"><span>[runtime<wbr>.global_allocator<wbr>.stdlib]</span></a>
</div>

<p>global_allocator 属性从 <a href="../core/prelude/v1/index.html">标准库预导入</a> 中导出。</p>
<!-- template:attributes -->
<div class="rule" id="r-runtime.windows_subsystem"><a class="rule-link" href="#r-runtime.windows_subsystem" title="runtime.windows_subsystem"><span>[runtime<wbr>.windows_subsystem]</span></a>
</div>

<h2 id="windows_subsystem属性"><a class="header" href="#windows_subsystem属性">windows_subsystem属性</a></h2>
<div class="rule" id="r-runtime.windows_subsystem.intro"><a class="rule-link" href="#r-runtime.windows_subsystem.intro" title="runtime.windows_subsystem.intro"><span>[runtime<wbr>.windows_subsystem<wbr>.intro]</span></a>
</div>

<p><em>windows_subsystem <a href="#r-attributes">属性</a></em> 在 Windows target 上链接时设置 <a href="https://msdn.microsoft.com/en-us/library/fcc1zstk.aspx">子系统</a>。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span>#![windows_subsystem = "windows"]
<span class="boring">fn main() {
</span><span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-runtime.windows_subsystem.syntax"><a class="rule-link" href="#r-runtime.windows_subsystem.syntax" title="runtime.windows_subsystem.syntax"><span>[runtime<wbr>.windows_subsystem<wbr>.syntax]</span></a>
</div>

<p>windows_subsystem 属性使用 <a href="#grammar-MetaNameValueStr">MetaNameValueStr</a> 语法格式。可接受的值为 <code>"console"</code> 和 <code>"windows"</code>。</p>
<div class="rule" id="r-runtime.windows_subsystem.allowed-positions"><a class="rule-link" href="#r-runtime.windows_subsystem.allowed-positions" title="runtime.windows_subsystem.allowed-positions"><span>[runtime<wbr>.windows_subsystem<wbr>.allowed-positions]</span></a>
</div>

<p>windows_subsystem 属性只能应用于 crate 根。</p>
<div class="rule" id="r-runtime.windows_subsystem.duplicates"><a class="rule-link" href="#r-runtime.windows_subsystem.duplicates" title="runtime.windows_subsystem.duplicates"><span>[runtime<wbr>.windows_subsystem<wbr>.duplicates]</span></a>
</div>

<p>只有第一次使用的 windows_subsystem 才会生效。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 会对第一次之后的任何使用发出 lint。这在将来可能会变成一个错误。</p>
</blockquote>
</div>

<div class="rule" id="r-runtime.windows_subsystem.ignored"><a class="rule-link" href="#r-runtime.windows_subsystem.ignored" title="runtime.windows_subsystem.ignored"><span>[runtime<wbr>.windows_subsystem<wbr>.ignored]</span></a>
</div>

<p>windows_subsystem 属性在非 Windows target 和非 <code>bin</code> <a href="#链接">crate 类型</a> 上会被忽略。</p>
<div class="rule" id="r-runtime.windows_subsystem.console"><a class="rule-link" href="#r-runtime.windows_subsystem.console" title="runtime.windows_subsystem.console"><span>[runtime<wbr>.windows_subsystem<wbr>.console]</span></a>
</div>

<p><code>"console"</code> 子系统是默认值。如果从现有的控制台运行控制台进程，那么它将附加到该控制台；否则将创建一个新的控制台窗口。</p>
<div class="rule" id="r-runtime.windows_subsystem.windows"><a class="rule-link" href="#r-runtime.windows_subsystem.windows" title="runtime.windows_subsystem.windows"><span>[runtime<wbr>.windows_subsystem<wbr>.windows]</span></a>
</div>

<p><code>"windows"</code> 子系统将脱离任何现有的控制台运行。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>"windows"</code> 子系统通常由不希望在启动时显示控制台窗口的 GUI 应用程序使用。</p>
</blockquote>
</div>

<div style="break-before: page; page-break-before: always;"></div>
<h1 id="附录"><a class="header" href="#附录">附录</a></h1>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="语法总结"><a class="header" href="#语法总结">语法总结</a></h1>
<p>以下是语法生成规则的总结。有关此语法的 语法格式 详情，请参阅 <em><a href="#r-notation.grammar.syntax">语法格式记法</a></em>。</p>
<p>{{ grammar-summary }}</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="语法索引"><a class="header" href="#语法索引">语法索引</a></h1>
<p>本附录提供了 词法单元 和常见形式的索引，并附有这些元素定义的链接。</p>
<h2 id="关键字-1"><a class="header" href="#关键字-1">关键字</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>关键字</th><th>用途</th></tr>
</thead>
<tbody>
<tr><td><code>_</code></td><td><a href="#r-patterns.wildcard">通配符模式</a>，<a href="#r-items.generics.const.inferred">推断的常量</a>，<a href="#r-type.inferred">推断类型</a>，<a href="#r-lifetime-elision.function.explicit-placeholder">占位符生命周期</a>，<a href="#r-items.const">常量项</a>，<a href="#r-items.extern-crate">外部 crate</a>，<a href="#r-items.use">use 声明</a>，<a href="#r-expr.placeholder">解构赋值</a></td></tr>
<tr><td><code>abstract</code></td><td><a href="#r-lex.keywords.reserved">保留关键字</a></td></tr>
<tr><td><code>as</code></td><td><a href="#r-items.extern-crate.as">外部 crate</a>，<a href="#r-items.use.forms.as">use 声明</a>，<a href="#r-expr.as">类型转换表达式</a>，<a href="#r-paths.qualified">限定路径</a></td></tr>
<tr><td><code>async</code></td><td><a href="#r-items.fn.async">异步函数</a>，<a href="#r-expr.block.async">异步块</a>，<a href="#r-expr.closure.async">异步闭包</a></td></tr>
<tr><td><code>await</code></td><td><a href="#r-expr.await">await 表达式</a></td></tr>
<tr><td><code>become</code></td><td><a href="#r-lex.keywords.reserved">保留关键字</a></td></tr>
<tr><td><code>box</code></td><td><a href="#r-lex.keywords.reserved">保留关键字</a></td></tr>
<tr><td><code>break</code></td><td><a href="#r-expr.loop.break">break 表达式</a></td></tr>
<tr><td><code>const</code></td><td><a href="#r-const-eval.const-fn">常量函数</a>，<a href="#r-items.const">常量项</a>，<a href="#r-items.generics.const">const 泛型</a>，<a href="#r-expr.block.const">常量块</a>，<a href="#r-expr.borrow.raw">裸借用运算符</a>，<a href="#r-type.pointer.raw">裸指针类型</a>，<a href="#r-asm.operand-type.supported-operands.const">常量汇编操作数</a></td></tr>
<tr><td><code>continue</code></td><td><a href="#r-expr.loop.continue">continue 表达式</a></td></tr>
<tr><td><code>crate</code></td><td><a href="#r-items.extern-crate">外部 crate</a>，<a href="#r-vis">可见性</a>，<a href="#r-paths">路径</a></td></tr>
<tr><td><code>do</code></td><td><a href="#r-lex.keywords.reserved">保留关键字</a></td></tr>
<tr><td><code>dyn</code></td><td><a href="#r-type.trait-object">特型对象</a></td></tr>
<tr><td><code>else</code></td><td><a href="#r-statement.let">let 语句</a>，<a href="#r-expr.if">if 表达式</a></td></tr>
<tr><td><code>enum</code></td><td><a href="#r-items.enum">枚举</a></td></tr>
<tr><td><code>extern</code></td><td><a href="#r-items.extern-crate">外部 crate</a>，<a href="#r-items.fn.extern">外部函数限定符</a>，<a href="#r-items.extern">外部块</a>，<a href="#r-type.fn-pointer.qualifiers">外部函数指针类型</a></td></tr>
<tr><td><code>false</code></td><td><a href="#r-type.bool">布尔类型</a>，<a href="#r-expr.literal">布尔表达式</a>，<a href="#r-cfg">配置断言</a></td></tr>
<tr><td><code>final</code></td><td><a href="#r-lex.keywords.reserved">保留关键字</a></td></tr>
<tr><td><code>fn</code></td><td><a href="#r-items.fn">函数</a>，<a href="#r-type.fn-pointer">函数指针类型</a></td></tr>
<tr><td><code>for</code></td><td><a href="#r-items.impl.trait">特型实现</a>，<a href="#r-expr.loop.for">迭代器循环</a>，<a href="#r-bound.higher-ranked">高阶特型界限</a></td></tr>
<tr><td><code>gen</code></td><td><a href="#r-lex.keywords.reserved">保留关键字</a></td></tr>
<tr><td><code>if</code></td><td><a href="#r-expr.if">if 表达式</a>，<a href="#r-expr.match.guard">match 守卫</a></td></tr>
<tr><td><code>impl</code></td><td><a href="#r-items.impl.inherent">固有实现</a>，<a href="#r-items.impl.trait">特型实现</a>，<a href="#r-type.impl-trait.return">impl trait 类型</a>，<a href="#r-type.impl-trait.param">匿名类型参数</a></td></tr>
<tr><td><code>in</code></td><td><a href="#r-vis">可见性</a>，<a href="#r-expr.loop.for">迭代器循环</a>，<a href="#r-asm.operand-type.supported-operands.in">汇编操作数</a></td></tr>
<tr><td><code>let</code></td><td><a href="#r-statement.let">let 语句</a>，<a href="#r-expr.if.let"><code>if let</code> 模式</a></td></tr>
<tr><td><code>loop</code></td><td><a href="#r-expr.loop.infinite">无限循环</a></td></tr>
<tr><td><code>macro_rules</code></td><td><a href="#r-macro.decl">声明宏</a></td></tr>
<tr><td><code>macro</code></td><td><a href="#r-lex.keywords.reserved">保留关键字</a></td></tr>
<tr><td><code>match</code></td><td><a href="#r-expr.match">match 表达式</a></td></tr>
<tr><td><code>mod</code></td><td><a href="#r-items.mod">模块</a></td></tr>
<tr><td><code>move</code></td><td><a href="#r-expr.closure">闭包表达式</a>，<a href="#r-expr.block.async">异步块</a></td></tr>
<tr><td><code>mut</code></td><td><a href="#r-expr.operator.borrow">借用表达式</a>，<a href="#r-patterns.ident">标识符模式</a>，<a href="#r-patterns.ref">引用模式</a>，<a href="#r-patterns.struct">结构体模式</a>，<a href="#r-type.pointer.reference">引用类型</a>，<a href="#r-type.pointer.raw">裸指针类型</a>，<a href="#r-items.fn.params.self-pat">self 参数</a>，<a href="#r-items.static">静态项</a></td></tr>
<tr><td><code>override</code></td><td><a href="#r-lex.keywords.reserved">保留关键字</a></td></tr>
<tr><td><code>priv</code></td><td><a href="#r-lex.keywords.reserved">保留关键字</a></td></tr>
<tr><td><code>pub</code></td><td><a href="#r-vis">可见性</a></td></tr>
<tr><td><code>raw</code></td><td><a href="#r-expr.operator.borrow">借用表达式</a>，<a href="#r-asm.options.supported-options.raw">原始汇编</a></td></tr>
<tr><td><code>ref</code></td><td><a href="#r-patterns.ident">标识符模式</a>，<a href="#r-patterns.struct">结构体模式</a></td></tr>
<tr><td><code>return</code></td><td><a href="#r-expr.return">return 表达式</a></td></tr>
<tr><td><code>safe</code></td><td><a href="#r-items.extern.fn">外部块函数</a>，<a href="#r-items.extern.static">外部块静态变量</a></td></tr>
<tr><td><code>self</code></td><td><a href="#r-items.extern-crate.self">外部 crate</a>，<a href="#r-items.fn.params.self-pat">self 参数</a>，<a href="#r-vis">可见性</a>，<a href="#r-paths.qualifiers.mod-self"><code>self</code> 路径</a></td></tr>
<tr><td><code>Self</code></td><td><a href="#r-paths.qualifiers.type-self"><code>Self</code> 类型路径</a>，<a href="#r-bound.use">use 界限</a></td></tr>
<tr><td><code>static</code></td><td><a href="#r-items.static">静态项</a>，<a href="#r-bound"><code>'static</code> 生命周期</a></td></tr>
<tr><td><code>struct</code></td><td><a href="#r-items.struct">结构体</a></td></tr>
<tr><td><code>super</code></td><td><a href="#r-paths.qualifiers.super">super 路径</a>，<a href="#r-vis">可见性</a></td></tr>
<tr><td><code>trait</code></td><td><a href="#r-items.traits">特型项</a></td></tr>
<tr><td><code>true</code></td><td><a href="#r-type.bool">布尔类型</a>，<a href="#r-expr.literal">布尔表达式</a>，<a href="#r-cfg">配置断言</a></td></tr>
<tr><td><code>try</code></td><td><a href="#r-lex.keywords.reserved">保留关键字</a></td></tr>
<tr><td><code>type</code></td><td><a href="#r-items.type">类型别名</a></td></tr>
<tr><td><code>typeof</code></td><td><a href="#r-lex.keywords.reserved">保留关键字</a></td></tr>
<tr><td><code>union</code></td><td><a href="#r-items.union">联合体项</a></td></tr>
<tr><td><code>unsafe</code></td><td><a href="#r-expr.block.unsafe">unsafe 块</a>，<a href="#r-attributes.safety">unsafe 属性</a>，<a href="#r-items.mod.unsafe">unsafe 模块</a>，<a href="#r-unsafe.fn">unsafe 函数</a>，<a href="#r-unsafe.extern">unsafe 外部块</a>，<a href="#r-items.extern.fn.safety">unsafe 外部函数</a>，<a href="#r-items.extern.static.safety">unsafe 外部静态变量</a>，<a href="#r-items.traits.safety">unsafe 特型</a>，<a href="#r-items.impl.trait.safety">unsafe 特型实现</a></td></tr>
<tr><td><code>unsized</code></td><td><a href="#r-lex.keywords.reserved">保留关键字</a></td></tr>
<tr><td><code>use</code></td><td><a href="#r-items.use">use 项</a>，<a href="#r-bound.use">use 界限</a></td></tr>
<tr><td><code>virtual</code></td><td><a href="#r-lex.keywords.reserved">保留关键字</a></td></tr>
<tr><td><code>where</code></td><td><a href="#r-items.generics.where">where 子句</a></td></tr>
<tr><td><code>while</code></td><td><a href="#r-expr.loop.while">断言循环</a></td></tr>
<tr><td><code>yield</code></td><td><a href="#r-lex.keywords.reserved">保留关键字</a></td></tr>
</tbody>
</table>
</div>
<h2 id="运算符和标点符号"><a class="header" href="#运算符和标点符号">运算符和标点符号</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>符号</th><th>名称</th><th>用途</th></tr>
</thead>
<tbody>
<tr><td><code>+</code></td><td>加号</td><td><a href="#r-expr.arith-logic">加法</a>，<a href="#r-bound">特型界限</a>，<a href="#r-macro.decl.repetition">宏克莱尼匹配器</a></td></tr>
<tr><td><code>-</code></td><td>减号</td><td><a href="#r-expr.arith-logic">减法</a>，<a href="#r-expr.negate">求反</a></td></tr>
<tr><td><code>*</code></td><td>星号</td><td><a href="#r-expr.arith-logic">乘法</a>，<a href="#r-expr.deref">解引用</a>，<a href="#r-type.pointer.raw">裸指针</a>，<a href="#r-macro.decl.repetition">宏克莱尼匹配器</a>，<a href="#r-items.use.glob">glob 导入</a></td></tr>
<tr><td><code>/</code></td><td>斜杠</td><td><a href="#r-expr.arith-logic">除法</a></td></tr>
<tr><td><code>%</code></td><td>百分号</td><td><a href="#r-expr.arith-logic">取余</a></td></tr>
<tr><td><code>^</code></td><td>插入符</td><td><a href="#r-expr.arith-logic">位与逻辑异或</a></td></tr>
<tr><td><code>!</code></td><td>非</td><td><a href="#r-expr.negate">位与逻辑非</a>，<a href="#r-macro.invocation">宏调用</a>，<a href="#r-attributes">内部属性</a>，<a href="#r-type.never">never 类型</a>，<a href="#r-items.impl">负实现</a></td></tr>
<tr><td><code>&amp;</code></td><td>与</td><td><a href="#r-expr.arith-logic">位与逻辑与</a>，<a href="#r-expr.operator.borrow">借用</a>，<a href="#r-type.pointer.reference">引用</a>，<a href="#r-patterns.ref">引用模式</a></td></tr>
<tr><td><code>|</code></td><td>或</td><td><a href="#r-expr.arith-logic">位与逻辑或</a>，<a href="#r-expr.closure">闭包</a>，<a href="#r-patterns.or">或模式</a>，<a href="#r-expr.if.let">if let</a>，<a href="#r-expr.loop.while.let">while let</a></td></tr>
<tr><td><code>&amp;&amp;</code></td><td>逻辑与</td><td><a href="#r-expr.bool-logic">惰性与</a>，<a href="#r-expr.operator.borrow">借用</a>，<a href="#r-type.pointer.reference">引用</a>，<a href="#r-patterns.ref">引用模式</a></td></tr>
<tr><td><code>||</code></td><td>逻辑或</td><td><a href="#r-expr.bool-logic">惰性或</a>，<a href="#r-expr.closure">闭包</a></td></tr>
<tr><td><code>&lt;&lt;</code></td><td>左移</td><td><a href="#r-expr.arith-logic">左移</a>，<a href="#r-items.generics">嵌套泛型</a></td></tr>
<tr><td><code>&gt;&gt;</code></td><td>右移</td><td><a href="#r-expr.arith-logic">右移</a>，<a href="#r-items.generics">嵌套泛型</a></td></tr>
<tr><td><code>+=</code></td><td>加法赋值</td><td><a href="#r-expr.compound-assign">加法赋值</a></td></tr>
<tr><td><code>-=</code></td><td>减法赋值</td><td><a href="#r-expr.compound-assign">减法赋值</a></td></tr>
<tr><td><code>*=</code></td><td>乘法赋值</td><td><a href="#r-expr.compound-assign">乘法赋值</a></td></tr>
<tr><td><code>/=</code></td><td>除法赋值</td><td><a href="#r-expr.compound-assign">除法赋值</a></td></tr>
<tr><td><code>%=</code></td><td>取余赋值</td><td><a href="#r-expr.compound-assign">取余赋值</a></td></tr>
<tr><td><code>^=</code></td><td>位异或赋值</td><td><a href="#r-expr.compound-assign">位异或赋值</a></td></tr>
<tr><td><code>&amp;=</code></td><td>位与赋值</td><td><a href="#r-expr.compound-assign">位与赋值</a></td></tr>
<tr><td><code>|=</code></td><td>位或赋值</td><td><a href="#r-expr.compound-assign">位或赋值</a></td></tr>
<tr><td><code>&lt;&lt;=</code></td><td>左移赋值</td><td><a href="#r-expr.compound-assign">左移赋值</a></td></tr>
<tr><td><code>&gt;&gt;=</code></td><td>右移赋值</td><td><a href="#r-expr.compound-assign">右移赋值</a>，<a href="#r-items.generics">嵌套泛型</a></td></tr>
<tr><td><code>=</code></td><td>等于</td><td><a href="#r-expr.assign">赋值</a>，<a href="#r-statement.let">let 语句</a>，<a href="#r-attributes">属性</a>，各种类型定义</td></tr>
<tr><td><code>==</code></td><td>等于等于</td><td><a href="#r-expr.cmp">等于</a></td></tr>
<tr><td><code>!=</code></td><td>不等于</td><td><a href="#r-expr.cmp">不等于</a></td></tr>
<tr><td><code>&gt;</code></td><td>大于</td><td><a href="#r-expr.cmp">大于</a>，<a href="#r-items.generics">泛型</a>，<a href="#r-paths">路径</a>，<a href="#r-bound.use">use 界限</a></td></tr>
<tr><td><code>&lt;</code></td><td>小于</td><td><a href="#r-expr.cmp">小于</a>，<a href="#r-items.generics">泛型</a>，<a href="#r-paths">路径</a>，<a href="#r-bound.use">use 界限</a></td></tr>
<tr><td><code>&gt;=</code></td><td>大于等于</td><td><a href="#r-expr.cmp">大于或等于</a>，<a href="#r-items.generics">泛型</a></td></tr>
<tr><td><code>&lt;=</code></td><td>小于等于</td><td><a href="#r-expr.cmp">小于或等于</a></td></tr>
<tr><td><code>@</code></td><td>at 符号</td><td><a href="#r-patterns.ident.scrutinized">子模式绑定</a></td></tr>
<tr><td><code>.</code></td><td>点</td><td><a href="#r-expr.field">字段访问</a>，<a href="#r-expr.tuple-index">元组索引</a></td></tr>
<tr><td><code>..</code></td><td>点点</td><td><a href="#r-expr.range">范围表达式</a>，<a href="#r-expr.struct">结构体表达式</a>，<a href="#r-patterns.rest">剩余模式</a>，<a href="#r-patterns.range">范围模式</a>，<a href="#r-patterns.struct">结构体模式</a></td></tr>
<tr><td><code>...</code></td><td>点点点</td><td><a href="#r-items.extern.variadic">可变参数函数</a>，<a href="#r-patterns.range">范围模式</a></td></tr>
<tr><td><code>..=</code></td><td>点点等于</td><td><a href="#r-expr.range">包含范围表达式</a>，<a href="#r-patterns.range">范围模式</a></td></tr>
<tr><td><code>,</code></td><td>逗号</td><td>各种分隔符</td></tr>
<tr><td><code>;</code></td><td>分号</td><td>各种 项 和 语句的终止符，<a href="#r-expr.array">数组表达式</a>，<a href="#r-type.array">数组类型</a></td></tr>
<tr><td><code>:</code></td><td>冒号</td><td>各种分隔符</td></tr>
<tr><td><code>::</code></td><td>路径分隔符</td><td><a href="#r-paths">路径分隔符</a></td></tr>
<tr><td><code>-&gt;</code></td><td>右箭头</td><td><a href="#r-items.fn">函数</a>，<a href="#r-expr.closure">闭包</a>，<a href="#r-type.fn-pointer">函数指针类型</a></td></tr>
<tr><td><code>=&gt;</code></td><td>胖箭头</td><td><a href="#r-expr.match">match 分支</a>，<a href="#r-macro.decl">宏</a></td></tr>
<tr><td><code>&lt;-</code></td><td>左箭头</td><td>左箭头符号在 Rust 1.0 之前就已停用，但仍被视为单个 词法单元。</td></tr>
<tr><td><code>#</code></td><td>井号</td><td><a href="#r-attributes">属性</a>，<a href="#r-lex.token.literal.str-raw">原始字符串字面量</a>，<a href="#r-lex.token.str-byte-raw">原始字节字符串字面量</a>，<a href="#r-lex.token.str-c-raw">原始 C 字符串字面量</a></td></tr>
<tr><td><code>$</code></td><td>美元符号</td><td><a href="#r-macro.decl">宏</a></td></tr>
<tr><td><code>?</code></td><td>问号</td><td><a href="#r-expr.try">try 传播表达式</a>，<a href="#r-bound.sized">宽松特型界限</a>，<a href="#r-macro.decl.repetition">宏克莱尼匹配器</a></td></tr>
<tr><td><code>~</code></td><td>波浪号</td><td>波浪号运算符在 Rust 1.0 之前就已停用，但其 词法单元 仍可能被使用。</td></tr>
</tbody>
</table>
</div>
<h2 id="注释-1"><a class="header" href="#注释-1">注释</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>注释</th><th>用途</th></tr>
</thead>
<tbody>
<tr><td><code>//</code></td><td><a href="#r-comments">行注释</a></td></tr>
<tr><td><code>//!</code></td><td><a href="#r-comments">内部行注释</a></td></tr>
<tr><td><code>///</code></td><td><a href="#r-comments">外部行文档注释</a></td></tr>
<tr><td><code>/*…*/</code></td><td><a href="#r-comments">块注释</a></td></tr>
<tr><td><code>/*!…*/</code></td><td><a href="#r-comments">内部块文档注释</a></td></tr>
<tr><td><code>/**…*/</code></td><td><a href="#r-comments">外部块文档注释</a></td></tr>
</tbody>
</table>
</div>
<h2 id="其他词法单元"><a class="header" href="#其他词法单元">其他词法单元</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>词法单元</th><th>用途</th></tr>
</thead>
<tbody>
<tr><td><code>ident</code></td><td><a href="#r-ident">标识符</a></td></tr>
<tr><td><code>r#ident</code></td><td><a href="#r-ident.raw">原始标识符</a></td></tr>
<tr><td><code>'ident</code></td><td><a href="#r-lex.token.life">生命周期和循环标签</a></td></tr>
<tr><td><code>'r#ident</code></td><td><a href="#r-lex.token.life">原始生命周期和循环标签</a></td></tr>
<tr><td><code>…u8</code>, <code>…i32</code>, <code>…f64</code>, <code>…usize</code>, …</td><td><a href="#r-lex.token.literal.num">数字字面量</a></td></tr>
<tr><td><code>"…"</code></td><td><a href="#r-lex.token.literal.str">字符串字面量</a></td></tr>
<tr><td><code>r"…"</code>, <code>r#"…"#</code>, <code>r##"…"##</code>, …</td><td><a href="#r-lex.token.literal.str-raw">原始字符串字面量</a></td></tr>
<tr><td><code>b"…"</code></td><td><a href="#r-lex.token.str-byte">字节字符串字面量</a></td></tr>
<tr><td><code>br"…"</code>, <code>br#"…"#</code>, <code>br##"…"##</code>, …</td><td><a href="#r-lex.token.str-byte-raw">原始字节字符串字面量</a></td></tr>
<tr><td><code>'…'</code></td><td><a href="#r-lex.token.literal.char">字符字面量</a></td></tr>
<tr><td><code>b'…'</code></td><td><a href="#r-lex.token.byte">字节字面量</a></td></tr>
<tr><td><code>c"…"</code></td><td><a href="#r-lex.token.str-c">C 字符串字面量</a></td></tr>
<tr><td><code>cr"…"</code>, <code>cr#"…"#</code>, <code>cr##"…"##</code>, …</td><td><a href="#r-lex.token.str-c-raw">原始 C 字符串字面量</a></td></tr>
</tbody>
</table>
</div>
<h2 id="宏-2"><a class="header" href="#宏-2">宏</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>语法格式</th><th>用途</th></tr>
</thead>
<tbody>
<tr><td><code>ident!(…)</code><br><code>ident! {…}</code><br><code>ident![…]</code></td><td><a href="#r-macro.invocation">宏调用</a></td></tr>
<tr><td><code>$ident</code></td><td><a href="#r-macro.decl.meta">宏元变量</a></td></tr>
<tr><td><code>$ident:kind</code></td><td><a href="#r-macro.decl.meta.specifier">宏匹配器片段指定符</a></td></tr>
<tr><td><code>$(…)…</code></td><td><a href="#r-macro.decl.repetition">宏重复</a></td></tr>
</tbody>
</table>
</div>
<h2 id="属性-3"><a class="header" href="#属性-3">属性</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>语法格式</th><th>用途</th></tr>
</thead>
<tbody>
<tr><td><code>#[meta]</code></td><td><a href="#r-attributes.outer">外部属性</a></td></tr>
<tr><td><code>#![meta]</code></td><td><a href="#r-attributes.inner">内部属性</a></td></tr>
</tbody>
</table>
</div>
<h2 id="表达式-1"><a class="header" href="#表达式-1">表达式</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>表达式</th><th>用途</th></tr>
</thead>
<tbody>
<tr><td><code>|…| expr</code><br><code>|…| -&gt; Type { … }</code></td><td><a href="#r-expr.closure">闭包</a></td></tr>
<tr><td><code>ident::…</code></td><td><a href="#r-paths">路径</a></td></tr>
<tr><td><code>::crate_name::…</code></td><td><a href="#r-paths.qualifiers.global-root">显式 crate 路径</a></td></tr>
<tr><td><code>crate::…</code></td><td><a href="#r-paths.qualifiers.crate">crate 相对路径</a></td></tr>
<tr><td><code>self::…</code></td><td><a href="#r-paths.qualifiers.mod-self">模块相对路径</a></td></tr>
<tr><td><code>super::…</code></td><td><a href="#r-paths.qualifiers.super">父模块路径</a></td></tr>
<tr><td><code>Type::…</code><br><code>&lt;Type as Trait&gt;::ident</code></td><td><a href="#r-items.associated">关联项</a></td></tr>
<tr><td><code>&lt;Type&gt;::…</code></td><td><a href="#r-paths.qualified">限定路径</a>，可用于没有名称的类型，例如 <code>&lt;&amp;T&gt;::…</code>、<code>&lt;[T]&gt;::…</code> 等。</td></tr>
<tr><td><code>Trait::method(…)</code><br><code>Type::method(…)</code><br><code>&lt;Type as Trait&gt;::method(…)</code></td><td><a href="#r-expr.call.desugar">消歧方法调用</a></td></tr>
<tr><td><code>method::&lt;…&gt;(…)</code><br><code>path::&lt;…&gt;</code></td><td><a href="#r-items.generics">泛型参数</a>，又称 涡轮鱼</td></tr>
<tr><td><code>()</code></td><td><a href="#r-type.tuple.unit">单元</a></td></tr>
<tr><td><code>(expr)</code></td><td><a href="#r-expr.paren">带括号的表达式</a></td></tr>
<tr><td><code>(expr,)</code></td><td><a href="#r-expr.tuple">单元素元组表达式</a></td></tr>
<tr><td><code>(expr, …)</code></td><td><a href="#r-expr.tuple">元组表达式</a></td></tr>
<tr><td><code>expr(expr, …)</code></td><td><a href="#r-expr.call">调用表达式</a></td></tr>
<tr><td><code>expr.0</code>, <code>expr.1</code>, …</td><td><a href="#r-expr.tuple-index">元组索引表达式</a></td></tr>
<tr><td><code>expr.ident</code></td><td><a href="#r-expr.field">字段访问表达式</a></td></tr>
<tr><td><code>{…}</code></td><td><a href="#r-expr.block">块表达式</a></td></tr>
<tr><td><code>Type {…}</code></td><td><a href="#r-expr.struct">结构体表达式</a></td></tr>
<tr><td><code>Type(…)</code></td><td><a href="#r-items.struct.tuple">元组结构体构造器</a></td></tr>
<tr><td><code>[…]</code></td><td><a href="#r-expr.array">数组表达式</a></td></tr>
<tr><td><code>[expr; len]</code></td><td><a href="#r-expr.array">重复数组表达式</a></td></tr>
<tr><td><code>expr[..]</code>, <code>expr[a..]</code>, <code>expr[..b]</code>, <code>expr[a..b]</code>, <code>expr[a..=b]</code>, <code>expr[..=b]</code></td><td><a href="#r-expr.array.index">数组和切片索引表达式</a></td></tr>
<tr><td><code>if expr {…} else {…}</code></td><td><a href="#r-expr.if">if 表达式</a></td></tr>
<tr><td><code>match expr { pattern =&gt; {…} }</code></td><td><a href="#r-expr.match">match 表达式</a></td></tr>
<tr><td><code>loop {…}</code></td><td><a href="#r-expr.loop.infinite">无限循环表达式</a></td></tr>
<tr><td><code>while expr {…}</code></td><td><a href="#r-expr.loop.while">断言循环表达式</a></td></tr>
<tr><td><code>for pattern in expr {…}</code></td><td><a href="#r-expr.loop.for">迭代器循环</a></td></tr>
<tr><td><code>&amp;expr</code><br><code>&amp;mut expr</code></td><td><a href="#r-expr.operator.borrow">借用表达式</a></td></tr>
<tr><td><code>&amp;raw const expr</code><br><code>&amp;raw mut expr</code></td><td><a href="#r-expr.borrow.raw">裸借用表达式</a></td></tr>
<tr><td><code>*expr</code></td><td><a href="#r-expr.deref">解引用表达式</a></td></tr>
<tr><td><code>expr?</code></td><td><a href="#r-expr.try">try 传播表达式</a></td></tr>
<tr><td><code>-expr</code></td><td><a href="#r-expr.negate">求反表达式</a></td></tr>
<tr><td><code>!expr</code></td><td><a href="#r-expr.negate">位与逻辑非表达式</a></td></tr>
<tr><td><code>expr as Type</code></td><td><a href="#r-expr.as">类型转换表达式</a></td></tr>
</tbody>
</table>
</div>
<h2 id="项-1"><a class="header" href="#项-1">项</a></h2>
<p><a href="#r-items">项</a> 是 crate 的组成部分。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>项</th><th>用途</th></tr>
</thead>
<tbody>
<tr><td><code>mod ident;</code><br><code>mod ident {…}</code></td><td><a href="#r-items.mod">模块</a></td></tr>
<tr><td><code>use path;</code></td><td><a href="#r-items.use">use 声明</a></td></tr>
<tr><td><code>fn ident(…) {…}</code></td><td><a href="#r-items.fn">函数</a></td></tr>
<tr><td><code>type Type = Type;</code></td><td><a href="#r-items.type">类型别名</a></td></tr>
<tr><td><code>struct ident {…}</code></td><td><a href="#r-items.struct">结构体</a></td></tr>
<tr><td><code>enum ident {…}</code></td><td><a href="#r-items.enum">枚举</a></td></tr>
<tr><td><code>union ident {…}</code></td><td><a href="#r-items.union">联合体</a></td></tr>
<tr><td><code>trait ident {…}</code></td><td><a href="#r-items.traits">特型</a></td></tr>
<tr><td><code>impl Type {…}</code><br><code>impl Type for Trait {…}</code></td><td><a href="#r-items.impl">实现</a></td></tr>
<tr><td><code>const ident = expr;</code></td><td><a href="#r-items.const">常量项</a></td></tr>
<tr><td><code>static ident = expr;</code></td><td><a href="#r-items.static">静态项</a></td></tr>
<tr><td><code>extern "C" {…}</code></td><td><a href="#r-items.extern">外部块</a></td></tr>
<tr><td><code>fn ident&lt;…&gt;(…) …</code><br><code>struct ident&lt;…&gt; {…}</code><br><code>enum ident&lt;…&gt; {…}</code><br><code>impl&lt;…&gt; Type&lt;…&gt; {…}</code></td><td><a href="#r-items.generics">泛型定义</a></td></tr>
</tbody>
</table>
</div>
<h2 id="类型表达式-1"><a class="header" href="#类型表达式-1">类型表达式</a></h2>
<p><a href="#r-type.name">类型表达式</a> 用于引用 类型。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>类型</th><th>用途</th></tr>
</thead>
<tbody>
<tr><td><code>bool</code>, <code>u8</code>, <code>f64</code>, <code>str</code>, …</td><td><a href="#r-type.kinds">原始类型</a></td></tr>
<tr><td><code>for&lt;…&gt;</code></td><td><a href="#r-bound.higher-ranked">高阶特型界限</a></td></tr>
<tr><td><code>T: TraitA + TraitB</code></td><td><a href="#r-bound">特型界限</a></td></tr>
<tr><td><code>T: 'a + 'b</code></td><td><a href="#r-bound.lifetime">生命周期界限</a></td></tr>
<tr><td><code>T: TraitA + 'a</code></td><td><a href="#r-bound">特型和生命周期界限</a></td></tr>
<tr><td><code>T: ?Sized</code></td><td><a href="#r-bound.sized">宽松特型界限</a></td></tr>
<tr><td><code>[Type; len]</code></td><td><a href="#r-type.array">数组类型</a></td></tr>
<tr><td><code>(Type, …)</code></td><td><a href="#r-type.tuple">元组类型</a></td></tr>
<tr><td><code>[Type]</code></td><td><a href="#r-type.slice">切片类型</a></td></tr>
<tr><td><code>(Type)</code></td><td><a href="#r-type.name.parenthesized">带括号的类型</a></td></tr>
<tr><td><code>impl Trait</code></td><td><a href="#r-type.impl-trait.return">impl trait 类型</a>，<a href="#r-type.impl-trait.param">匿名类型参数</a></td></tr>
<tr><td><code>dyn Trait</code></td><td><a href="#r-type.trait-object">特型对象类型</a></td></tr>
<tr><td><code>ident</code><br><code>ident::…</code></td><td><a href="#r-type.name.path">类型路径</a> (可引用 <a href="#r-items.struct">结构体</a>，<a href="#r-items.enum">枚举</a>，<a href="#r-items.union">联合体</a>，<a href="#r-items.type">类型别名</a>，<a href="#r-items.traits">特型</a>，<a href="#r-items.generics">泛型</a> 等)</td></tr>
<tr><td><code>Type&lt;…&gt;</code><br><code>Trait&lt;…&gt;</code></td><td><a href="#r-items.generics">泛型参数</a> (例如 <code>Vec&lt;u8&gt;</code>)</td></tr>
<tr><td><code>Trait&lt;ident = Type&gt;</code></td><td><a href="#r-paths.expr">关联类型绑定</a> (例如 <code>Iterator&lt;Item = T&gt;</code>)</td></tr>
<tr><td><code>Trait&lt;ident: …&gt;</code></td><td><a href="#r-paths.expr">关联类型界限</a> (例如 <code>Iterator&lt;Item: Send&gt;</code>)</td></tr>
<tr><td><code>&amp;Type</code><br><code>&amp;mut Type</code></td><td><a href="#r-type.pointer.reference">引用类型</a></td></tr>
<tr><td><code>*mut Type</code><br><code>*const Type</code></td><td><a href="#r-type.pointer.raw">裸指针类型</a></td></tr>
<tr><td><code>fn(…) -&gt; Type</code></td><td><a href="#r-type.fn-pointer">函数指针类型</a></td></tr>
<tr><td><code>_</code></td><td><a href="#r-type.inferred">推断类型</a>，<a href="#r-items.generics.const.inferred">推断的常量</a></td></tr>
<tr><td><code>'_</code></td><td><a href="#r-lifetime-elision.function.explicit-placeholder">占位符生命周期</a></td></tr>
<tr><td><code>!</code></td><td><a href="#r-type.never">never 类型</a></td></tr>
</tbody>
</table>
</div>
<h2 id="模式-1"><a class="header" href="#模式-1">模式</a></h2>
<p><a href="#r-patterns">模式</a> 用于匹配值。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>模式</th><th>用途</th></tr>
</thead>
<tbody>
<tr><td><code>"foo"</code>, <code>'a'</code>, <code>123</code>, <code>2.4</code>, …</td><td><a href="#r-patterns.literal">字面量模式</a></td></tr>
<tr><td><code>ident</code></td><td><a href="#r-patterns.ident">标识符模式</a></td></tr>
<tr><td><code>_</code></td><td><a href="#r-patterns.wildcard">通配符模式</a></td></tr>
<tr><td><code>..</code></td><td><a href="#r-patterns.rest">剩余模式</a></td></tr>
<tr><td><code>a..</code>, <code>..b</code>, <code>a..b</code>, <code>a..=b</code>, <code>..=b</code></td><td><a href="#r-patterns.range">范围模式</a></td></tr>
<tr><td><code>&amp;pattern</code><br><code>&amp;mut pattern</code></td><td><a href="#r-patterns.ref">引用模式</a></td></tr>
<tr><td><code>path {…}</code></td><td><a href="#r-patterns.struct">结构体模式</a></td></tr>
<tr><td><code>path(…)</code></td><td><a href="#r-patterns.tuple-struct">元组结构体模式</a></td></tr>
<tr><td><code>(pattern, …)</code></td><td><a href="#r-patterns.tuple">元组模式</a></td></tr>
<tr><td><code>(pattern)</code></td><td><a href="#r-patterns.paren">分组模式</a></td></tr>
<tr><td><code>[pattern, …]</code></td><td><a href="#r-patterns.slice">切片模式</a></td></tr>
<tr><td><code>CONST</code>, <code>Enum::Variant</code>, …</td><td><a href="#r-patterns.path">路径模式</a></td></tr>
</tbody>
</table>
</div>
<div style="break-before: page; page-break-before: always;"></div>
<div class="rule" id="r-macro.ambiguity"><a class="rule-link" href="#r-macro.ambiguity" title="macro.ambiguity"><span>[macro<wbr>.ambiguity]</span></a>
</div>

<h1 id="附录宏后继集歧义形式化规范"><a class="header" href="#附录宏后继集歧义形式化规范">附录：宏后继集歧义形式化规范</a></h1>
<p>本页记录了 <a href="#声明宏">声明宏</a> 后继规则的形式化规范。它们最初在 <a href="https://github.com/rust-lang/rfcs/blob/master/text/0550-macro-future-proofing.md">RFC 550</a> 中指定，本文的大部分内容即复制自该 RFC，并在后续的 RFC 中进行了扩展。</p>
<div class="rule" id="r-macro.ambiguity.convention"><a class="rule-link" href="#r-macro.ambiguity.convention" title="macro.ambiguity.convention"><span>[macro<wbr>.ambiguity<wbr>.convention]</span></a>
</div>

<h2 id="定义和约定"><a class="header" href="#定义和约定">定义和约定</a></h2>
<div class="rule" id="r-macro.ambiguity.convention.defs"><a class="rule-link" href="#r-macro.ambiguity.convention.defs" title="macro.ambiguity.convention.defs"><span>[macro<wbr>.ambiguity<wbr>.convention<wbr>.defs]</span></a>
</div>

<ul>
<li><code>macro</code>: 源代码中可调用为 <code>foo!(...)</code> 的任何内容。</li>
<li><code>MBE</code>: 声明宏，由 <code>macro_rules</code> 定义的宏。</li>
<li><code>matcher</code>: <code>macro_rules</code> 调用中规则的左侧，或其子部分。</li>
<li><code>macro 解析器</code>: Rust 解析器中用于使用所有匹配器派生出的语法格式来解析输入的代码片段。</li>
<li><code>fragment</code>: 给定 匹配器 将接受（或“匹配”）的 Rust 语法类别。</li>
<li><code>repetition</code>: 遵循常规重复模式的片段。</li>
<li><code>NT</code>: 非终结符，出现在 匹配器 中的各种“元变量”或重复匹配器，在 MBE 语法格式中以 <code>$</code> 字符开头。</li>
<li><code>simple NT</code>: “元变量”非终结符（下文将进一步讨论）。</li>
<li><code>complex NT</code>: 重复匹配非终结符，通过重复运算符（<code>*</code>、<code>+</code>、<code>?</code>）指定。</li>
<li><code>token</code>: 匹配器的原子元素；即 标识符、运算符、开/闭分隔符，<em>以及</em> 简单 NT。</li>
<li><code>token tree</code>: 由 词法单元（叶子）、复杂 NT 和有限 词法单元树 序列组成的树结构。</li>
<li><code>delimiter token</code>: 用于分隔一个片段的结尾和下一个片段的开头的 词法单元。</li>
<li><code>separator token</code>: 复杂 NT 中可选的 分隔符 词法单元，用于分隔匹配重复中的每对元素。</li>
<li><code>separated complex NT</code>: 具有自己 分隔符 词法单元 的复杂 NT。</li>
<li><code>delimited sequence</code>: 以适当的开闭分隔符开始和结束的 词法单元树 序列。</li>
<li><code>empty fragment</code>: 分隔 词法单元 的不可见 Rust 语法格式类别，即 空白符，或（在某些词法上下文中）空 词法单元 序列。</li>
<li><code>fragment specifier</code>: 简单 NT 中指定 NT 接受哪个片段的 标识符。</li>
<li><code>language</code>: 上下文无关语言。</li>
</ul>
<p>示例：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! i_am_an_mbe {
    (start $foo:expr $($i:ident),* end) =&gt; ($foo)
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-macro.ambiguity.convention.matcher"><a class="rule-link" href="#r-macro.ambiguity.convention.matcher" title="macro.ambiguity.convention.matcher"><span>[macro<wbr>.ambiguity<wbr>.convention<wbr>.matcher]</span></a>
</div>

<p><code>(start $foo:expr $($i:ident),* end)</code> 是一个 匹配器。整个 匹配器 是一个 分隔序列（带有开闭分隔符 <code>(</code> 和 <code>)</code>），<code>$foo</code> 和 <code>$i</code> 是带有 <code>expr</code> 和 <code>ident</code> 作为其各自 片段指定符 的 简单 NT。</p>
<div class="rule" id="r-macro.ambiguity.convention.complex-nt"><a class="rule-link" href="#r-macro.ambiguity.convention.complex-nt" title="macro.ambiguity.convention.complex-nt"><span>[macro<wbr>.ambiguity<wbr>.convention<wbr>.complex-nt]</span></a>
</div>

<p><code>$(i:ident),*</code> <em>也是</em> 一个 NT；它是一个 复杂 NT，匹配逗号分隔的 标识符 重复。<code>,</code> 是 复杂 NT 的 分隔符 词法单元；它出现在匹配片段的每对元素（如果存在）之间。</p>
<p>复杂 NT 的另一个例子是 <code>$(hi $e:expr ;)+</code>，它匹配 <code>hi &lt;expr&gt;; hi &lt;expr&gt;; ...</code> 形式的任何片段，其中 <code>hi &lt;expr&gt;;</code> 至少出现一次。请注意，此 复杂 NT 没有专用的 分隔符 词法单元。</p>
<p>（请注意，Rust 的 解析器 确保 分隔序列 总是以适当嵌套的 词法单元树 结构和正确的开闭分隔符匹配出现。）</p>
<div class="rule" id="r-macro.ambiguity.convention.vars"><a class="rule-link" href="#r-macro.ambiguity.convention.vars" title="macro.ambiguity.convention.vars"><span>[macro<wbr>.ambiguity<wbr>.convention<wbr>.vars]</span></a>
</div>

<p>我们将倾向于使用变量 “M” 代表 匹配器，变量 “t” 和 “u” 代表任意单个 词法单元，变量 “tt” 和 “uu” 代表任意 词法单元树。（“tt” 的使用确实可能与它作为 片段指定符 的额外角色产生歧义；但从上下文中可以清楚地看出其意图。）</p>
<div class="rule" id="r-macro.ambiguity.convention.set"><a class="rule-link" href="#r-macro.ambiguity.convention.set" title="macro.ambiguity.convention.set"><span>[macro<wbr>.ambiguity<wbr>.convention<wbr>.set]</span></a>
</div>

<p>“SEP” 将表示 分隔符 词法单元，“OP” 表示重复运算符 <code>*</code>、<code>+</code> 和 <code>?</code>，“OPEN”/“CLOSE” 表示围绕 分隔序列 的匹配 词法单元 对（例如 <code>[</code> 和 <code>]</code>）。</p>
<div class="rule" id="r-macro.ambiguity.convention.sequence-vars"><a class="rule-link" href="#r-macro.ambiguity.convention.sequence-vars" title="macro.ambiguity.convention.sequence-vars"><span>[macro<wbr>.ambiguity<wbr>.convention<wbr>.sequence-vars]</span></a>
</div>

<p>希腊字母 “α”、“β”、“γ”、“δ” 代表可能为空的 词法单元树 序列。（但是，希腊字母 “ε”（epsilon）在表达中具有特殊作用，不代表 词法单元树 序列。）</p>
<ul>
<li>这种希腊字母约定通常仅在序列的存在是技术细节时使用；特别是，当我们希望 <em>强调</em> 我们正在对 词法单元树 序列进行操作时，我们将使用符号 “tt …” 代表该序列，而不是希腊字母。</li>
</ul>
<p>请注意，匹配器 仅仅是 词法单元树。如上所述，“简单 NT” 是一个元变量 NT；因此它不是一个 重复。例如，<code>$foo:ty</code> 是一个 简单 NT，但 <code>$($foo:ty)+</code> 是一个 复杂 NT。</p>
<p>另请注意，在此形式化上下文中，“词法单元” 一词通常 <em>包含</em> 简单 NT。</p>
<p>最后，读者需要记住，根据此形式化的定义，没有 简单 NT 匹配 空片段，同样也没有 词法单元 匹配 Rust 语法格式的 空片段。（因此，<em>唯一</em> 可以匹配 空片段 的 NT 是 复杂 NT。）这实际上不是真的，因为 <code>vis</code> 匹配器 可以匹配一个 空片段。因此，为了形式化的目的，我们将把 <code>$v:vis</code> 视为 <code>$($v:vis)?</code>，并要求 匹配器 匹配一个 空片段。</p>
<div class="rule" id="r-macro.ambiguity.invariant"><a class="rule-link" href="#r-macro.ambiguity.invariant" title="macro.ambiguity.invariant"><span>[macro<wbr>.ambiguity<wbr>.invariant]</span></a>
</div>

<h3 id="匹配器不变式"><a class="header" href="#匹配器不变式">匹配器不变式</a></h3>
<div class="rule" id="r-macro.ambiguity.invariant.list"><a class="rule-link" href="#r-macro.ambiguity.invariant.list" title="macro.ambiguity.invariant.list"><span>[macro<wbr>.ambiguity<wbr>.invariant<wbr>.list]</span></a>
</div>

<p>要有效，匹配器 必须满足以下三个 不变式。FIRST 和 FOLLOW 的定义将在后面描述。</p>
<ol>
<li>在 匹配器 <code>M</code> 中，对于任意两个连续的 词法单元树 序列（即 <code>M = ... tt uu ...</code>），且 <code>uu ...</code> 非空，我们必须有 FOLLOW(<code>... tt</code>) ∪ {ε} ⊇ FIRST(<code>uu ...</code>)。</li>
<li>在 匹配器 中，对于任何 分隔复杂 NT，<code>M = ... $(tt ...) SEP OP ...</code>，我们必须有 <code>SEP</code> ∈ FOLLOW(<code>tt ...</code>)。</li>
<li>在 匹配器 中，对于未分隔的 复杂 NT，<code>M = ... $(tt ...) OP ...</code>，如果 OP = <code>*</code> 或 <code>+</code>，我们必须有 FOLLOW(<code>tt ...</code>) ⊇ FIRST(<code>tt ...</code>)。</li>
</ol>
<div class="rule" id="r-macro.ambiguity.invariant.follow-matcher"><a class="rule-link" href="#r-macro.ambiguity.invariant.follow-matcher" title="macro.ambiguity.invariant.follow-matcher"><span>[macro<wbr>.ambiguity<wbr>.invariant<wbr>.follow-matcher]</span></a>
</div>

<p>第一个 不变式 表示，无论 匹配器 之后实际出现什么 词法单元（如果存在），它都必须在预定的 后继集 中。这确保了合法的宏定义将继续分配相同的确定，即 <code>... tt</code> 在哪里结束，<code>uu ...</code> 在哪里开始，即使在语言中添加了新的 语法格式 形式。</p>
<div class="rule" id="r-macro.ambiguity.invariant.separated-complex-nt"><a class="rule-link" href="#r-macro.ambiguity.invariant.separated-complex-nt" title="macro.ambiguity.invariant.separated-complex-nt"><span>[macro<wbr>.ambiguity<wbr>.invariant<wbr>.separated-complex-nt]</span></a>
</div>

<p>第二个 不变式 表示，分隔复杂 NT 必须使用一个 分隔符 词法单元，该 词法单元 是 NT 内部内容的预定 后继集 的一部分。这确保了合法的宏定义将继续将输入片段解析为相同的 <code>tt ...</code> 分隔序列，即使在语言中添加了新的 语法格式 形式。</p>
<div class="rule" id="r-macro.ambiguity.invariant.unseparated-complex-nt"><a class="rule-link" href="#r-macro.ambiguity.invariant.unseparated-complex-nt" title="macro.ambiguity.invariant.unseparated-complex-nt"><span>[macro<wbr>.ambiguity<wbr>.invariant<wbr>.unseparated-complex-nt]</span></a>
</div>

<p>第三个 不变式 表示，当我们有一个 复杂 NT 可以匹配两个或多个相同且没有分隔符 的实体时，必须允许它们根据第一个 不变式 放置在一起。这个 不变式 还要求它们非空，这消除了可能的歧义。</p>
<p><strong>注意：由于历史遗留问题和对行为的严重依赖，第三个 不变式 目前未强制执行。目前尚未决定下一步如何处理。不遵守该行为的宏在未来的 Rust 版次 中可能会变得无效。参见 <a href="https://github.com/rust-lang/rust/issues/56575">跟踪 issue</a>。</strong></p>
<div class="rule" id="r-macro.ambiguity.sets"><a class="rule-link" href="#r-macro.ambiguity.sets" title="macro.ambiguity.sets"><span>[macro<wbr>.ambiguity<wbr>.sets]</span></a>
</div>

<h3 id="first和follow非正式地"><a class="header" href="#first和follow非正式地">FIRST和FOLLOW，非正式地</a></h3>
<div class="rule" id="r-macro.ambiguity.sets.intro"><a class="rule-link" href="#r-macro.ambiguity.sets.intro" title="macro.ambiguity.sets.intro"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.intro]</span></a>
</div>

<p>给定 匹配器 M 映射到三个集合：FIRST(M)、LAST(M) 和 FOLLOW(M)。</p>
<p>这三个集合中的每一个都由 词法单元 组成。FIRST(M) 和 LAST(M) 还可以包含一个特殊的非 词法单元 元素 ε (“epsilon”)，它表示 M 可以匹配 空片段。（但 FOLLOW(M) 始终只是 词法单元 集合。）</p>
<p>非正式地：</p>
<div class="rule" id="r-macro.ambiguity.sets.first"><a class="rule-link" href="#r-macro.ambiguity.sets.first" title="macro.ambiguity.sets.first"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.first]</span></a>
</div>

<ul>
<li>FIRST(M): 收集在将片段匹配到 M 时可能首先使用的 词法单元。</li>
</ul>
<div class="rule" id="r-macro.ambiguity.sets.last"><a class="rule-link" href="#r-macro.ambiguity.sets.last" title="macro.ambiguity.sets.last"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.last]</span></a>
</div>

<ul>
<li>LAST(M): 收集在将片段匹配到 M 时可能最后使用的 词法单元。</li>
</ul>
<div class="rule" id="r-macro.ambiguity.sets.follow"><a class="rule-link" href="#r-macro.ambiguity.sets.follow" title="macro.ambiguity.sets.follow"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.follow]</span></a>
</div>

<ul>
<li>
<p>FOLLOW(M): 允许紧跟在 M 匹配的某个片段之后的 词法单元 集合。</p>
<p>换句话说：当且仅当存在（可能为空） 词法单元 序列 α、β、γ、δ，其中：</p>
<ul>
<li>
<p>M 匹配 β，</p>
</li>
<li>
<p>t 匹配 γ，并且</p>
</li>
<li>
<p>拼接 α β γ δ 是一个可解析的 Rust 程序，</p>
</li>
</ul>
<p>则 t ∈ FOLLOW(M)。</p>
</li>
</ul>
<div class="rule" id="r-macro.ambiguity.sets.universe"><a class="rule-link" href="#r-macro.ambiguity.sets.universe" title="macro.ambiguity.sets.universe"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.universe]</span></a>
</div>

<p>我们使用简写 ANYTOKEN 表示所有 词法单元（包括 简单 NT）的集合。例如，如果任何 词法单元 在 匹配器 M 之后都是合法的，那么 FOLLOW(M) = ANYTOKEN。</p>
<p>（为了回顾对上述非正式描述的理解，读者此时可能希望跳到 <a href="#examples-of-first-and-last">FIRST/LAST 示例</a> 之前阅读它们的正式定义。）</p>
<div class="rule" id="r-macro.ambiguity.sets.def"><a class="rule-link" href="#r-macro.ambiguity.sets.def" title="macro.ambiguity.sets.def"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def]</span></a>
</div>

<h3 id="firstlast"><a class="header" href="#firstlast">FIRST，LAST</a></h3>
<div class="rule" id="r-macro.ambiguity.sets.def.intro"><a class="rule-link" href="#r-macro.ambiguity.sets.def.intro" title="macro.ambiguity.sets.def.intro"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.intro]</span></a>
</div>

<p>以下是 FIRST 和 LAST 的形式化归纳定义。</p>
<div class="rule" id="r-macro.ambiguity.sets.def.notation"><a class="rule-link" href="#r-macro.ambiguity.sets.def.notation" title="macro.ambiguity.sets.def.notation"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.notation]</span></a>
</div>

<p>“A ∪ B” 表示集合并集，“A ∩ B” 表示集合交集，“A \ B” 表示集合差集（即 A 中所有不在 B 中的元素）。</p>
<div class="rule" id="r-macro.ambiguity.sets.def.first"><a class="rule-link" href="#r-macro.ambiguity.sets.def.first" title="macro.ambiguity.sets.def.first"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.first]</span></a>
</div>

<h4 id="first"><a class="header" href="#first">FIRST</a></h4>
<div class="rule" id="r-macro.ambiguity.sets.def.first.intro"><a class="rule-link" href="#r-macro.ambiguity.sets.def.first.intro" title="macro.ambiguity.sets.def.first.intro"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.first<wbr>.intro]</span></a>
</div>

<p>FIRST(M) 根据序列 M 及其第一个 词法单元树（如果存在）的结构进行案例分析定义：</p>
<div class="rule" id="r-macro.ambiguity.sets.def.first.epsilon"><a class="rule-link" href="#r-macro.ambiguity.sets.def.first.epsilon" title="macro.ambiguity.sets.def.first.epsilon"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.first<wbr>.epsilon]</span></a>
</div>

<ul>
<li>如果 M 是空序列，则 FIRST(M) = { ε }，</li>
</ul>
<div class="rule" id="r-macro.ambiguity.sets.def.first.token"><a class="rule-link" href="#r-macro.ambiguity.sets.def.first.token" title="macro.ambiguity.sets.def.first.token"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.first<wbr>.token]</span></a>
</div>

<ul>
<li>
<p>如果 M 以 词法单元 t 开头，则 FIRST(M) = { t }，</p>
<p>（注意：这涵盖了 M 以 分隔词法单元树 序列 <code>M = OPEN tt ... CLOSE ...</code> 开头的情况，在这种情况下 <code>t = OPEN</code>，因此 FIRST(M) = { <code>OPEN</code> }。）</p>
<p>（注意：这严重依赖于没有 简单 NT 匹配 空片段 的属性。）</p>
</li>
</ul>
<div class="rule" id="r-macro.ambiguity.sets.def.first.complex"><a class="rule-link" href="#r-macro.ambiguity.sets.def.first.complex" title="macro.ambiguity.sets.def.first.complex"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.first<wbr>.complex]</span></a>
</div>

<ul>
<li>
<p>否则，M 是以 复杂 NT 开头的 词法单元树 序列：<code>M = $( tt ... ) OP α</code>，或 <code>M = $( tt ... ) SEP OP α</code>（其中 <code>α</code> 是 匹配器 剩余部分的（可能为空） 词法单元树 序列）。</p>
<ul>
<li>如果 SEP 存在且 ε ∈ FIRST(<code>tt ...</code>)，则令 SEP_SET(M) = { SEP }；否则 SEP_SET(M) = {}。</li>
</ul>
</li>
<li>
<p>如果 OP = <code>*</code> 或 <code>?</code>，则令 ALPHA_SET(M) = FIRST(<code>α</code>)；如果 OP = <code>+</code>，则 ALPHA_SET(M) = {}。</p>
</li>
<li>
<p>FIRST(M) = (FIRST(<code>tt ...</code>) \ {ε}) ∪ SEP_SET(M) ∪ ALPHA_SET(M)。</p>
</li>
</ul>
<p>复杂 NT 的定义值得一些解释。SEP_SET(M) 定义了分隔符可能作为 M 的有效第一个 词法单元 的可能性，当存在分隔符且重复片段可能为空时，就会发生这种情况。ALPHA_SET(M) 定义了 复杂 NT 可能为空的可能性，这意味着 M 的有效第一个 词法单元 是紧随其后的 词法单元树 序列 <code>α</code> 的。这发生在使用了 <code>*</code> 或 <code>?</code> 的情况下，此时可能存在零次重复。理论上，如果使用 <code>+</code> 且重复片段可能为空，也可能发生这种情况，但这被第三个 不变式 禁止。</p>
<p>从那里，显然 FIRST(M) 可以包含来自 SEP_SET(M) 或 ALPHA_SET(M) 的任何 词法单元，如果 复杂 NT 匹配非空，那么任何以 FIRST(<code>tt ...</code>) 开头的 词法单元 也可以。最后要考虑的是 ε。SEP_SET(M) 和 FIRST(<code>tt ...</code>) \ {ε} 不能包含 ε，但 ALPHA_SET(M) 可以。因此，此定义允许 M 接受 ε 当且仅当 ε ∈ ALPHA_SET(M) 时。这是正确的，因为对于 复杂 NT 情况下的 M 要接受 ε，复杂 NT 和 α 都必须接受它。如果 OP = <code>+</code>，这意味着 复杂 NT 不能为空，那么根据定义 ε ∉ ALPHA_SET(M)。否则，复杂 NT 可以接受零次重复，然后 ALPHA_SET(M) = FOLLOW(<code>α</code>)。因此，此定义对于 \varepsilon 也是正确的。</p>
<div class="rule" id="r-macro.ambiguity.sets.def.last"><a class="rule-link" href="#r-macro.ambiguity.sets.def.last" title="macro.ambiguity.sets.def.last"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.last]</span></a>
</div>

<h4 id="last"><a class="header" href="#last">LAST</a></h4>
<div class="rule" id="r-macro.ambiguity.sets.def.last.intro"><a class="rule-link" href="#r-macro.ambiguity.sets.def.last.intro" title="macro.ambiguity.sets.def.last.intro"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.last<wbr>.intro]</span></a>
</div>

<p>LAST(M) 根据 M 本身（ 词法单元树 序列）进行案例分析定义：</p>
<div class="rule" id="r-macro.ambiguity.sets.def.last.empty"><a class="rule-link" href="#r-macro.ambiguity.sets.def.last.empty" title="macro.ambiguity.sets.def.last.empty"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.last<wbr>.empty]</span></a>
</div>

<ul>
<li>如果 M 是空序列，则 LAST(M) = { ε }</li>
</ul>
<div class="rule" id="r-macro.ambiguity.sets.def.last.token"><a class="rule-link" href="#r-macro.ambiguity.sets.def.last.token" title="macro.ambiguity.sets.def.last.token"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.last<wbr>.token]</span></a>
</div>

<ul>
<li>如果 M 是单例 词法单元 t，则 LAST(M) = { t }</li>
</ul>
<div class="rule" id="r-macro.ambiguity.sets.def.last.rep-star"><a class="rule-link" href="#r-macro.ambiguity.sets.def.last.rep-star" title="macro.ambiguity.sets.def.last.rep-star"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.last<wbr>.rep-star]</span></a>
</div>

<ul>
<li>
<p>如果 M 是重复零次或多次的单例 复杂 NT，<code>M = $( tt ... ) *</code>，或 <code>M = $( tt ... ) SEP *</code></p>
<ul>
<li>
<p>如果 SEP 存在，则令 sep_set = { SEP }；否则 sep_set = {}。</p>
</li>
<li>
<p>如果 ε ∈ LAST(<code>tt ...</code>)，则 LAST(M) = LAST(<code>tt ...</code>) ∪ sep_set</p>
</li>
<li>
<p>否则，序列 <code>tt ...</code> 必须非空；LAST(M) = LAST(<code>tt ...</code>) ∪ {ε}。</p>
</li>
</ul>
</li>
</ul>
<div class="rule" id="r-macro.ambiguity.sets.def.last.rep-plus"><a class="rule-link" href="#r-macro.ambiguity.sets.def.last.rep-plus" title="macro.ambiguity.sets.def.last.rep-plus"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.last<wbr>.rep-plus]</span></a>
</div>

<ul>
<li>
<p>如果 M 是重复一次或多次的单例 复杂 NT，<code>M = $( tt ... ) +</code>，或 <code>M = $( tt ... ) SEP +</code></p>
<ul>
<li>
<p>如果 SEP 存在，则令 sep_set = { SEP }；否则 sep_set = {}。</p>
</li>
<li>
<p>如果 ε ∈ LAST(<code>tt ...</code>)，则 LAST(M) = LAST(<code>tt ...</code>) ∪ sep_set</p>
</li>
<li>
<p>否则，序列 <code>tt ...</code> 必须非空；LAST(M) = LAST(<code>tt ...</code>)</p>
</li>
</ul>
</li>
</ul>
<div class="rule" id="r-macro.ambiguity.sets.def.last.rep-question"><a class="rule-link" href="#r-macro.ambiguity.sets.def.last.rep-question" title="macro.ambiguity.sets.def.last.rep-question"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.last<wbr>.rep-question]</span></a>
</div>

<ul>
<li>如果 M 是重复零次或一次的单例 复杂 NT，<code>M = $( tt ...) ?</code>，则 LAST(M) = LAST(<code>tt ...</code>) ∪ {ε}。</li>
</ul>
<div class="rule" id="r-macro.ambiguity.sets.def.last.delim"><a class="rule-link" href="#r-macro.ambiguity.sets.def.last.delim" title="macro.ambiguity.sets.def.last.delim"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.last<wbr>.delim]</span></a>
</div>

<ul>
<li>如果 M 是 分隔词法单元树 序列 <code>OPEN tt ... CLOSE</code>，则 LAST(M) = { <code>CLOSE</code> }。</li>
</ul>
<div class="rule" id="r-macro.ambiguity.sets.def.last.sequence"><a class="rule-link" href="#r-macro.ambiguity.sets.def.last.sequence" title="macro.ambiguity.sets.def.last.sequence"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.last<wbr>.sequence]</span></a>
</div>

<ul>
<li>
<p>如果 M 是非空 词法单元树 序列 <code>tt uu ...</code>，</p>
<ul>
<li>
<p>如果 ε ∈ LAST(<code>uu ...</code>)，则 LAST(M) = LAST(<code>tt</code>) ∪ (LAST(<code>uu ...</code>) \ { ε })。</p>
</li>
<li>
<p>否则，序列 <code>uu ...</code> 必须非空；则 LAST(M) = LAST(<code>uu ...</code>)。</p>
</li>
</ul>
</li>
</ul>
<h3 id="first和last的示例"><a class="header" href="#first和last的示例">FIRST和LAST的示例</a></h3>
<p>以下是 FIRST 和 LAST 的一些示例。
（请特别注意 ε 元素是如何根据输入片段之间的交互引入和消除的。）</p>
<p>我们的第一个示例以树形结构呈现，以详细说明 匹配器 的分析如何组合。（一些更简单的子树已被省略。）</p>
<pre><code class="language-text">INPUT:  $(  $d:ident   $e:expr   );*    $( $( h )* );*    $( f ; )+   g
            ~~~~~~~~   ~~~~~~~                ~
                |         |                   |
FIRST:   { $d:ident }  { $e:expr }          { h }


INPUT:  $(  $d:ident   $e:expr   );*    $( $( h )* );*    $( f ; )+
            ~~~~~~~~~~~~~~~~~~             ~~~~~~~           ~~~
                        |                      |               |
FIRST:          { $d:ident }               { h, ε }         { f }

INPUT:  $(  $d:ident   $e:expr   );*    $( $( h )* );*    $( f ; )+   g
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~    ~~~~~~~~~~~~~~    ~~~~~~~~~   ~
                        |                       |              |       |
FIRST:        { $d:ident, ε }            {  h, ε, ;  }      { f }   { g }


INPUT:  $(  $d:ident   $e:expr   );*    $( $( h )* );*    $( f ; )+   g
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                                        |
FIRST:                       { $d:ident, h, ;,  f }
</code></pre>
<p>因此：</p>
<ul>
<li>FIRST(<code>$($d:ident $e:expr );* $( $(h)* );* $( f ;)+ g</code>) = { <code>$d:ident</code>, <code>h</code>, <code>;</code>, <code>f</code> }</li>
</ul>
<p>但请注意：</p>
<ul>
<li>FIRST(<code>$($d:ident $e:expr );* $( $(h)* );* $($( f ;)+ g)*</code>) = { <code>$d:ident</code>, <code>h</code>, <code>;</code>, <code>f</code>, ε }</li>
</ul>
<p>以下是类似的示例，但现在针对 LAST。</p>
<ul>
<li>LAST(<code>$d:ident $e:expr</code>) = { <code>$e:expr</code> }</li>
<li>LAST(<code>$( $d:ident $e:expr );*</code>) = { <code>$e:expr</code>, ε }</li>
<li>LAST(<code>$( $d:ident $e:expr );* $(h)*</code>) = { <code>$e:expr</code>, ε, <code>h</code> }</li>
<li>LAST(<code>$( $d:ident $e:expr );* $(h)* $( f ;)+</code>) = { <code>;</code> }</li>
<li>LAST(<code>$( $d:ident $e:expr );* $(h)* $( f ;)+ g</code>) = { <code>g</code> }</li>
</ul>
<div class="rule" id="r-macro.ambiguity.sets.def.follow"><a class="rule-link" href="#r-macro.ambiguity.sets.def.follow" title="macro.ambiguity.sets.def.follow"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.follow]</span></a>
</div>

<h3 id="followm"><a class="header" href="#followm">FOLLOW(M)</a></h3>
<div class="rule" id="r-macro.ambiguity.sets.def.follow.intro"><a class="rule-link" href="#r-macro.ambiguity.sets.def.follow.intro" title="macro.ambiguity.sets.def.follow.intro"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.follow<wbr>.intro]</span></a>
</div>

<p>最后，FOLLOW(M) 的定义如下构建。pat, expr 等表示具有给定 片段指定符 的 简单 非终结符。</p>
<div class="rule" id="r-macro.ambiguity.sets.def.follow.pat"><a class="rule-link" href="#r-macro.ambiguity.sets.def.follow.pat" title="macro.ambiguity.sets.def.follow.pat"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.follow<wbr>.pat]</span></a>
</div>

<ul>
<li>FOLLOW(pat) = {<code>=&gt;</code>, <code>,</code>, <code>=</code>, <code>|</code>, <code>if</code>, <code>in</code>}。</li>
</ul>
<div class="rule" id="r-macro.ambiguity.sets.def.follow.expr-stmt"><a class="rule-link" href="#r-macro.ambiguity.sets.def.follow.expr-stmt" title="macro.ambiguity.sets.def.follow.expr-stmt"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.follow<wbr>.expr-stmt]</span></a>
</div>

<ul>
<li>FOLLOW(expr) = FOLLOW(expr_2021) = FOLLOW(stmt) = {<code>=&gt;</code>, <code>,</code>, <code>;</code>}。</li>
</ul>
<div class="rule" id="r-macro.ambiguity.sets.def.follow.ty-path"><a class="rule-link" href="#r-macro.ambiguity.sets.def.follow.ty-path" title="macro.ambiguity.sets.def.follow.ty-path"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.follow<wbr>.ty-path]</span></a>
</div>

<ul>
<li>FOLLOW(ty) = FOLLOW(path) = {<code>{</code>, <code>[</code>, <code>,</code>, <code>=&gt;</code>, <code>:</code>, <code>=</code>, <code>&gt;</code>, <code>&gt;&gt;</code>, <code>;</code>,
<code>|</code>, <code>as</code>, <code>where</code>, 块 非终结符}。</li>
</ul>
<div class="rule" id="r-macro.ambiguity.sets.def.follow.vis"><a class="rule-link" href="#r-macro.ambiguity.sets.def.follow.vis" title="macro.ambiguity.sets.def.follow.vis"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.follow<wbr>.vis]</span></a>
</div>

<ul>
<li>FOLLOW(vis) = {<code>,</code>l 任何 关键字 或 标识符，除了非原始 <code>priv</code>；任何可以开始一个 类型 的 词法单元；标识符， 类型 和 路径 非终结符}。</li>
</ul>
<div class="rule" id="r-macro.ambiguity.sets.def.follow.simple"><a class="rule-link" href="#r-macro.ambiguity.sets.def.follow.simple" title="macro.ambiguity.sets.def.follow.simple"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.follow<wbr>.simple]</span></a>
</div>

<ul>
<li>FOLLOW(t) = ANYTOKEN 对于任何其他 简单 词法单元，包括 块，标识符，
tt， 项，生命周期，字面量 和 元 简单 非终结符，以及所有 终结符。</li>
</ul>
<div class="rule" id="r-macro.ambiguity.sets.def.follow.other-matcher"><a class="rule-link" href="#r-macro.ambiguity.sets.def.follow.other-matcher" title="macro.ambiguity.sets.def.follow.other-matcher"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.follow<wbr>.other-matcher]</span></a>
</div>

<ul>
<li>FOLLOW(M)，对于任何其他 M，定义为 FOLLOW(t) 的交集，其中 t 遍历 (LAST(M) \ {ε})。</li>
</ul>
<div class="rule" id="r-macro.ambiguity.sets.def.follow.type-first"><a class="rule-link" href="#r-macro.ambiguity.sets.def.follow.type-first" title="macro.ambiguity.sets.def.follow.type-first"><span>[macro<wbr>.ambiguity<wbr>.sets<wbr>.def<wbr>.follow<wbr>.type-first]</span></a>
</div>

<p>可以开始一个 类型 的 词法单元，截至本文撰写之时，有 {<code>(</code>, <code>[</code>, <code>!</code>, <code>*</code>,
<code>&amp;</code>, <code>&amp;&amp;</code>, <code>?</code>, 生命周期，<code>&gt;</code>, <code>&gt;&gt;</code>, <code>::</code>, 任何非 关键字 标识符，<code>super</code>,
<code>self</code>, <code>Self</code>, <code>extern</code>, <code>crate</code>, <code>$crate</code>, <code>_</code>, <code>for</code>, <code>impl</code>, <code>fn</code>, <code>unsafe</code>,
<code>typeof</code>, <code>dyn</code>}，尽管此列表可能不完整，因为人们可能不会总是记得在添加新 词法单元 时更新附录。</p>
<p>复杂 M 的 FOLLOW 示例：</p>
<ul>
<li>FOLLOW(<code>$( $d:ident $e:expr )*</code>) = FOLLOW(<code>$e:expr</code>)</li>
<li>FOLLOW(<code>$( $d:ident $e:expr )* $(;)*</code>) = FOLLOW(<code>$e:expr</code>) ∩ ANYTOKEN = FOLLOW(<code>$e:expr</code>)</li>
<li>FOLLOW(<code>$( $d:ident $e:expr )* $(;)* $( f |)+</code>) = ANYTOKEN</li>
</ul>
<h3 id="有效和无效匹配器的示例"><a class="header" href="#有效和无效匹配器的示例">有效和无效匹配器的示例</a></h3>
<p>有了上述规范，我们可以给出为什么特定 匹配器 合法而其他不合法的论证。</p>
<ul>
<li>
<p><code>($ty:ty &lt; foo ,)</code>：非法，因为 FIRST(<code>&lt; foo ,</code>) = { <code>&lt;</code> } ⊈ FOLLOW(<code>ty</code>)</p>
</li>
<li>
<p><code>($ty:ty , foo &lt;)</code>：合法，因为 FIRST(<code>, foo &lt;</code>) = { <code>,</code> } ⊆ FOLLOW(<code>ty</code>)。</p>
</li>
<li>
<p><code>($pa:pat $pb:pat $ty:ty ,)</code>：非法，因为 FIRST(<code>$pb:pat $ty:ty ,</code>) = { <code>$pb:pat</code> } ⊈ FOLLOW(<code>pat</code>)，并且 FIRST(<code>$ty:ty ,</code>) = { <code>$ty:ty</code> } ⊈ FOLLOW(<code>pat</code>)。</p>
</li>
<li>
<p><code>( $($a:tt $b:tt)* ; )</code>：合法，因为 FIRST(<code>$b:tt</code>) = { <code>$b:tt</code> } ⊆ FOLLOW(<code>tt</code>) = ANYTOKEN，FIRST(<code>;</code>) = { <code>;</code> } 也是。</p>
</li>
<li>
<p><code>( $($t:tt),* , $(t:tt),* )</code>：合法（尽管任何实际使用此宏的尝试都会在展开期间发出本地歧义错误）。</p>
</li>
<li>
<p><code>($ty:ty $(; not sep)* -)</code>：非法，因为 FIRST(<code>$(; not sep)* -</code>) = { <code>;</code>, <code>-</code> } 不在 FOLLOW(<code>ty</code>) 中。</p>
</li>
<li>
<p><code>($($ty:ty)-+)</code>：非法，因为分隔符 <code>-</code> 不在 FOLLOW(<code>ty</code>) 中。</p>
</li>
<li>
<p><code>($($e:expr)*)</code>：非法，因为 expr NT 不在 FOLLOW(expr NT) 中。</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="影响"><a class="header" href="#影响">影响</a></h1>
<p>Rust 并非一种特别原创的语言，其设计元素来自广泛的来源。其中一些列举如下（包括后来已被移除的元素）：</p>
<ul>
<li>SML, OCaml: 代数数据类型，模式匹配，类型推断，分号语句分隔</li>
<li>C++: 引用，RAII，智能指针，移动语义，单态化，内存模型</li>
<li>ML Kit, Cyclone: 基于区域的内存管理</li>
<li>Haskell (GHC): 类型类，类型家族</li>
<li>Newsqueak, Alef, Limbo: 通道，并发</li>
<li>Erlang: 消息传递，线程失败，<del>关联线程失败</del>，<del>轻量级并发</del></li>
<li>Swift: 可选绑定</li>
<li>Scheme: 卫生宏</li>
<li>C#: 属性</li>
<li>Ruby: 闭包 语法格式，<del>块 语法格式</del></li>
<li>NIL, Hermes: <del>类型状态</del></li>
<li><a href="http://www.unicode.org/reports/tr31/">Unicode 附录 #31</a>: 标识符 和 模式 语法格式</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="测试总结"><a class="header" href="#测试总结">测试总结</a></h1>
<p>以下是引用中链接到各个规则标识符的测试总数的总结。</p>
<p>{{summary-table}}</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="词汇表"><a class="header" href="#词汇表">词汇表</a></h1>
<div class="rule" id="r-glossary.ast"><a class="rule-link" href="#r-glossary.ast" title="glossary.ast"><span>[glossary<wbr>.ast]</span></a>
</div>

<h3 id="抽象语法树"><a class="header" href="#抽象语法树">抽象语法树</a></h3>
<p>“抽象语法树”，或“AST”，是编译器编译程序时，程序结构的中间表示。</p>
<h3 id="对齐"><a class="header" href="#对齐">对齐</a></h3>
<p>值的 对齐 方式指定了值倾向于从哪个地址开始。始终是 2 的幂。对值的引用必须对齐。
<a href="#大小和对齐">更多</a>。</p>
<div class="rule" id="r-glossary.abi"><a class="rule-link" href="#r-glossary.abi" title="glossary.abi"><span>[glossary<wbr>.abi]</span></a>
</div>

<h3 id="应用程序二进制接口abi"><a class="header" href="#应用程序二进制接口abi">应用程序二进制接口(ABI)</a></h3>
<p>一个 <em>应用程序二进制接口</em> (ABI) 定义了编译后的代码如何与其它编译后的代码交互。通过 <a href="#r-items.extern"><code>extern</code> 块</a> 和 <a href="#r-items.fn.extern"><code>extern fn</code></a>，<em>ABI 字符串</em> 影响：</p>
<ul>
<li><strong>调用约定</strong>：函数参数如何传递，返回值如何返回（例如，在寄存器中或在栈上），以及谁负责清理栈。</li>
<li><strong>展开</strong>：是否允许栈展开。例如，<code>"C-unwind"</code> ABI 允许跨 FFI 边界展开，而 <code>"C"</code> ABI 不允许。</li>
</ul>
<h3 id="元数"><a class="header" href="#元数">元数</a></h3>
<p>元数 指的是函数或运算符接受的参数数量。例如，<code>f(2, 3)</code> 和 <code>g(4, 6)</code> 的 元数 是 2，而 <code>h(8, 2, 6)</code> 的 元数 是 3。<code>!</code> 运算符的 元数 是 1。</p>
<h3 id="数组"><a class="header" href="#数组">数组</a></h3>
<p>数组，有时也称为 固定大小数组 或 内联数组，是一个描述元素集合的值，每个元素通过程序在运行时计算的索引来选择。它占据一片连续的内存区域。</p>
<h3 id="关联项-1"><a class="header" href="#关联项-1">关联项</a></h3>
<p>关联项 是与另一个 <a href="#项">项</a> 关联的 <a href="#项">项</a>。关联项 在 <a href="#实现">实现</a> 中定义，并在 <a href="#特型">特型</a> 中声明。只有函数、常量和类型别名可以关联。与 <a href="#自由项">自由项</a> 形成对比。</p>
<h3 id="全局实现"><a class="header" href="#全局实现">全局实现</a></h3>
<p>任何类型以 <a href="#未覆盖类型">未覆盖类型</a> 方式出现的实现。<code>impl&lt;T&gt; Foo for T</code>、<code>impl&lt;T&gt; Bar&lt;T&gt; for T</code>、<code>impl&lt;T&gt; Bar&lt;Vec&lt;T&gt;&gt; for T</code> 和 <code>impl&lt;T&gt; Bar&lt;T&gt; for Vec&lt;T&gt;</code> 都被认为是 全局实现。然而，<code>impl&lt;T&gt; Bar&lt;Vec&lt;T&gt;&gt; for Vec&lt;T&gt;</code> 不是 全局实现，因为出现在此 <code>impl</code> 中的所有 <code>T</code> 实例都被 <code>Vec</code> 覆盖。</p>
<h3 id="界限"><a class="header" href="#界限">界限</a></h3>
<p>界限 是对类型或 特型 的约束。例如，如果对函数接受的参数设置了 界限，则传递给该函数的类型必须遵守该约束。</p>
<h3 id="组合器"><a class="header" href="#组合器">组合器</a></h3>
<p>组合器 是高阶函数，它们只应用函数和先前定义的 组合器，以从其参数中提供结果。它们可以用于以模块化的方式管理控制流。</p>
<h3 id="crate-2"><a class="header" href="#crate-2">crate</a></h3>
<p>crate 是编译和链接的单元。有不同的 <a href="#链接">crate 类型</a>，例如库或可执行文件。crate 可以链接并引用其他库 crate，称为 外部 crate。一个 crate 拥有一个自包含的 <a href="#模块">模块</a> 树，从一个名为 crate 根 的未命名根模块开始。<a href="#项">项</a> 可以通过在 crate 根 中将其标记为公共来对其他 crate 可见，包括通过公共模块的 <a href="#路径">路径</a> 。
<a href="#crate与源文件">更多</a>。</p>
<h3 id="调度"><a class="header" href="#调度">调度</a></h3>
<p>调度 是一种机制，用于在涉及 多态 时确定实际运行哪个特定版本的代码。调度的主要形式有两种：静态调度 和 动态调度。Rust 通过使用 <a href="#r-type.trait-object">特型对象</a> 支持 动态调度。</p>
<h3 id="动态大小类型dst"><a class="header" href="#动态大小类型dst">动态大小类型(DST)</a></h3>
<p>动态大小类型 (DST) 是一种没有静态已知大小或对齐的 类型。</p>
<h3 id="实体"><a class="header" href="#实体">实体</a></h3>
<p>一个 <a href="#名称"><em>实体</em></a> 是一种语言构造，可以在源程序中以某种方式引用，通常通过 <a href="#路径">路径</a> 来引用。实体 包括 <a href="#类型">类型</a>、<a href="#项">项</a>、<a href="#泛型参数">泛型参数</a>、<a href="#模式">变量绑定</a>、<a href="#生命周期和循环标签">循环标签</a>、<a href="#生命周期和循环标签">生命周期</a>、<a href="#字段访问表达式">字段</a>、<a href="#属性-1">属性</a> 和 <a href="#lint检查属性">lint</a>。</p>
<h3 id="表达式-2"><a class="header" href="#表达式-2">表达式</a></h3>
<p>表达式 是值、常量、变量、运算符和函数的组合，它们评估为一个单一的值，有或没有副作用。</p>
<p>例如，<code>2 + (3 * 4)</code> 是一个返回 14 的 表达式。</p>
<h3 id="自由项"><a class="header" href="#自由项">自由项</a></h3>
<p>一个不属于 <a href="#实现">实现</a> 的 <a href="#项">项</a>，例如 <em>自由函数</em> 或 <em>自由常量</em>。与 <a href="#关联项-1">关联项</a> 形成对比。</p>
<h3 id="基本特型"><a class="header" href="#基本特型">基本特型</a></h3>
<p>基本特型 是指为现有类型添加它的实现会造成 破坏性变更 的 特型。<code>Fn</code> 特型和 <code>Sized</code> 是 基本特型。</p>
<h3 id="基本类型构造器"><a class="header" href="#基本类型构造器">基本类型构造器</a></h3>
<p>基本类型构造器 是一种类型，对其实现 <a href="#全局实现">全局实现</a> 会造成 破坏性变更。<code>&amp;</code>、<code>&amp;mut</code>、<code>Box</code> 和 <code>Pin</code> 是 基本的。</p>
<p>任何时候，如果类型 <code>T</code> 被认为是 <a href="#局部类型">局部</a> 的，那么 <code>&amp;T</code>、<code>&amp;mut T</code>、<code>Box&lt;T&gt;</code> 和 <code>Pin&lt;T&gt;</code> 也被认为是 局部 的。基本类型构造器 不能 <a href="#未覆盖类型">覆盖</a> 其他类型。任何时候使用术语“覆盖类型”时，<code>&amp;T</code>、<code>&amp;mut T</code>、<code>Box&lt;T&gt;</code> 和 <code>Pin&lt;T&gt;</code> 中的 <code>T</code> 都不被认为是 覆盖的。</p>
<h3 id="可居住的"><a class="header" href="#可居住的">可居住的</a></h3>
<p>如果一个类型有构造器，从而可以被 实例化，那么它就是 可居住的。一个 可居住的 类型在“空”的意义上并非“空”，即可以存在该类型的值。与 <a href="#不可居住的">不可居住的</a> 相反。</p>
<h3 id="固有实现-1"><a class="header" href="#固有实现-1">固有实现</a></h3>
<p>一个适用于名义类型而非 特型-类型对 的 <a href="#实现">实现</a>。
<a href="#固有实现">更多</a>。</p>
<h3 id="固有方法"><a class="header" href="#固有方法">固有方法</a></h3>
<p>在 <a href="#固有实现">固有实现</a> 中定义而不是在 特型实现 中定义的 <a href="#方法">方法</a>。</p>
<h3 id="已初始化"><a class="header" href="#已初始化">已初始化</a></h3>
<p>如果一个变量已被 赋值 且之后未被 移出，则它就是 已初始化 的。所有其他内存位置都被认为是 未初始化 的。只有 非安全 Rust 才能创建未初始化的内存位置。</p>
<h3 id="局部特型"><a class="header" href="#局部特型">局部特型</a></h3>
<p>在当前 crate 中定义的 <code>trait</code>。特型定义 的 局部性 独立于应用的 类型参数。给定 <code>trait Foo&lt;T, U&gt;</code>，<code>Foo</code> 始终是 局部 的，无论为 <code>T</code> 和 <code>U</code> 替换什么类型。</p>
<h3 id="局部类型"><a class="header" href="#局部类型">局部类型</a></h3>
<p>在当前 crate 中定义的 <code>struct</code>、<code>enum</code> 或 <code>union</code>。这不受应用的 类型参数 影响。<code>struct Foo</code> 被认为是 局部 的，但 <code>Vec&lt;Foo&gt;</code> 不是。<code>LocalType&lt;ForeignType&gt;</code> 是 局部 的。类型别名 不影响 局部性。</p>
<h3 id="模块-1"><a class="header" href="#模块-1">模块</a></h3>
<p>模块 是一个包含零个或多个 <a href="#项">项</a> 的容器。模块 以树形结构组织，从一个未命名的根模块开始，该模块称为 crate 根 或 根模块。<a href="#路径">路径</a> 可用于引用其他模块中的 项，这可能受到 <a href="#可见性和私有性">可见性规则</a> 的限制。
<a href="#模块">更多</a></p>
<h3 id="名称-1"><a class="header" href="#名称-1">名称</a></h3>
<p>一个 <a href="#名称"><em>名称</em></a> 是一个 <a href="#标识符">标识符</a> 或 <a href="#生命周期和循环标签">生命周期或循环标签</a>，它引用一个 <a href="#实体">实体</a>。<em>名称绑定</em> 是指一个 实体声明 引入了一个与该 实体 关联的 标识符 或 标签。<a href="#路径">路径</a>、标识符 和 <a href="#生命周期和循环标签">标签</a> 用于引用一个 实体。</p>
<h3 id="名称解析-1"><a class="header" href="#名称解析-1">名称解析</a></h3>
<p><a href="#名称解析"><em>名称解析</em></a> 是将 <a href="#路径">路径</a>、<a href="#标识符">标识符</a> 和 <a href="#生命周期和循环标签">标签</a> 与 <a href="#实体">实体</a> 声明 关联起来的 编译时过程。</p>
<h3 id="命名空间-1"><a class="header" href="#命名空间-1">命名空间</a></h3>
<p>一个 <em>命名空间</em> 是根据名称所引用的 <a href="#实体">实体</a> 类型，对已声明的 <a href="#名称-1">名称</a> 进行的 逻辑分组。命名空间 允许一个 名称 在一个 命名空间 中出现，而不会与另一个 命名空间 中的同名 名称 冲突。</p>
<p>在 命名空间 内部，名称 以 层次结构 的方式组织，其中 层次结构 的每个级别都有自己的一组 命名实体。</p>
<h3 id="名义类型"><a class="header" href="#名义类型">名义类型</a></h3>
<p>可以直接通过 路径 引用的 类型。具体来说是 <a href="#枚举">枚举</a>、<a href="#结构体">结构体</a>、<a href="#联合体">联合体</a> 和 <a href="#特型对象">特型对象类型</a>。</p>
<h3 id="dyn兼容特型"><a class="header" href="#dyn兼容特型">dyn兼容特型</a></h3>
<p>可以在 <a href="#特型对象">特型对象类型</a> (<code>dyn Trait</code>) 中使用的 <a href="#特型">特型</a> 。
只有遵循特定 <a href="#dyn兼容性">规则</a> 的 特型 才是 <em>dyn 兼容</em> 的。</p>
<p>这些以前被称为 <em>对象安全特型</em>。</p>
<h3 id="路径-1"><a class="header" href="#路径-1">路径</a></h3>
<p>一个 <a href="#路径"><em>路径</em></a> 是一系列一个或多个 路径段，用于引用当前 <a href="#作用域-3">作用域</a> 或 <a href="#命名空间-1">命名空间</a> 层次结构 其它级别中的 <a href="#实体">实体</a>。</p>
<h3 id="预导入-1"><a class="header" href="#预导入-1">预导入</a></h3>
<p>预导入，或称 Rust 预导入，是一个小型的 项 集合——主要是 特型——它们被导入到每个 crate 的每个 模块 中。预导入 中的 特型 是普遍存在的。</p>
<h3 id="作用域-3"><a class="header" href="#作用域-3">作用域</a></h3>
<p>一个 <a href="#作用域"><em>作用域</em></a> 是源代码中一个 命名实体 可以通过该名称被引用的区域。</p>
<h3 id="审查值"><a class="header" href="#审查值">审查值</a></h3>
<p>审查值 是在 <code>match</code> 表达式和类似的 模式匹配构造 中被匹配的 表达式。例如，在 <code>match x { A =&gt; 1, B =&gt; 2 }</code> 中，表达式 <code>x</code> 是 审查值。</p>
<h3 id="大小"><a class="header" href="#大小">大小</a></h3>
<p>值 的 大小 有两种定义。</p>
<p>第一种是存储该 值 必须分配多少 内存。</p>
<p>第二种是具有该 项类型 的 数组 中连续 元素 之间的 字节 偏移量。</p>
<p>它是 对齐 的倍数，包括零。大小 可能因 编译器版本（随着新 优化 的出现）和 目标平台（类似于 <code>usize</code> 在不同平台上的差异）而变化。</p>
<p><a href="#大小和对齐">更多</a>。</p>
<h3 id="切片"><a class="header" href="#切片">切片</a></h3>
<p>切片 是一个对 连续序列 的 动态大小视图，写作 <code>[T]</code>。</p>
<p>它通常以其借用形式出现，可以是 可变 的或 共享 的。共享 切片类型 是 <code>&amp;[T]</code>，而 可变 切片类型 是 <code>&amp;mut [T]</code>，其中 <code>T</code> 代表 元素类型。</p>
<h3 id="语句-1"><a class="header" href="#语句-1">语句</a></h3>
<p>语句 是编程语言中最小的独立元素，它命令计算机执行一个 动作。</p>
<h3 id="字符串字面量-1"><a class="header" href="#字符串字面量-1">字符串字面量</a></h3>
<p>字符串字面量 是直接存储在 最终二进制文件 中的 字符串，因此在 <code>'static</code> 持续时间 内有效。</p>
<p>它的类型是 <code>'static</code> 持续时间 借用字符串切片，<code>&amp;'static str</code>。</p>
<h3 id="字符串切片"><a class="header" href="#字符串切片">字符串切片</a></h3>
<p>字符串切片 是 Rust 中最原始的 字符串类型，写作 <code>str</code>。它通常以其借用形式出现，可以是 可变 的或 共享 的。共享 字符串切片类型 是 <code>&amp;str</code>，而 可变 字符串切片类型 是 <code>&amp;mut str</code>。</p>
<p>字符串切片 始终是有效的 UTF-8。</p>
<h3 id="特型-1"><a class="header" href="#特型-1">特型</a></h3>
<p>特型 是一种语言项，用于描述 类型 必须提供的 功能。它允许 类型 对其 行为 做出某些承诺。</p>
<p>泛型函数 和 泛型结构体 可以使用 特型 来 约束 或 限定它们接受的 类型。</p>
<h3 id="涡轮鱼"><a class="header" href="#涡轮鱼">涡轮鱼</a></h3>
<p>表达式 中带有 泛型参数 的 路径 必须在开头的尖括号前加上 <code>::</code>。结合 泛型 的尖括号，这看起来像一条鱼 <code>::&lt;&gt;</code>。因此，这种 语法格式 被俗称为 涡轮鱼 语法格式。</p>
<p>示例：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let ok_num = Ok::&lt;_, ()&gt;(5); // 好的数字
let vec = [1, 2, 3].iter().map(|n| n * 2).collect::&lt;Vec&lt;_&gt;&gt;(); // 向量
<span class="boring">}</span></code></pre>
<p>这个 <code>::</code> 前缀是必需的，用于消除 逗号分隔列表 中带有 多个比较 的 泛型路径 的歧义。有关缺少前缀会产生 模糊性 的示例，请参阅 <a href="https://github.com/rust-lang/rust/blob/1.58.0/src/test/ui/parser/bastion-of-the-turbofish.rs">涡轮鱼的堡垒</a>。</p>
<h3 id="未覆盖类型"><a class="header" href="#未覆盖类型">未覆盖类型</a></h3>
<p>未覆盖类型 是不作为另一个 类型 的 参数 出现的 类型。例如，<code>T</code> 是 未覆盖 的，但 <code>Vec&lt;T&gt;</code> 中的 <code>T</code> 是 覆盖的。这仅与 类型参数 相关。</p>
<h3 id="未定义行为"><a class="header" href="#未定义行为">未定义行为</a></h3>
<p>未定义行为 是未指定 的 编译时 或 运行时行为。这可能导致（但不限于）：进程终止或损坏；不适当、不正确或意外的计算；或平台特定结果。
<a href="#被视为未定义的行为">更多</a>。</p>
<h3 id="不可居住的"><a class="header" href="#不可居住的">不可居住的</a></h3>
<p>如果一个 类型 没有 构造器，从而永远不能被 实例化，那么它就是 不可居住的。一个 不可居住的 类型在“空”的意义上是“空”的，即该 类型 没有 值。一个 不可居住的 类型 的典型例子是 <a href="#never类型">never 类型</a> <code>!</code>，或者一个没有 变体 的枚举 <code>enum Never { }</code>。与 <a href="#可居住的">可居住的</a> 相反。</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/reference-da60281b.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>
