<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>内联汇编 - Rust语言参考手册</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/reference-ce12791d.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-4a49bb37.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-99e7fd87.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust语言参考手册</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/zhiming-wu/rust-reference-zh_cn/" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <div class="rule" id="r-asm"><a class="rule-link" href="#r-asm" title="asm"><span>[asm]</span></a>
</div>

<h1 id="内联汇编"><a class="header" href="#内联汇编">内联汇编</a></h1>
<div class="rule" id="r-asm.intro"><a class="rule-link" href="#r-asm.intro" title="asm.intro"><span>[asm<wbr>.intro]</span></a>
</div>

<p>通过 <a href="../core/arch/macro.asm.html"><code>asm!</code></a>、<a href="../core/arch/macro.naked_asm.html"><code>naked_asm!</code></a> 和 <a href="../core/arch/macro.global_asm.html"><code>global_asm!</code></a> 宏提供对内联汇编的支持。它可以用于在编译器生成的汇编输出中嵌入手写的汇编代码。</p>
<div class="rule" id="r-asm.stable-targets"><a class="rule-link" href="#r-asm.stable-targets" title="asm.stable-targets"><span>[asm<wbr>.stable-targets]</span></a>
</div>

<p>内联汇编支持在以下架构上是稳定的：</p>
<ul>
<li>x86 和 x86-64</li>
<li>ARM</li>
<li>AArch64 和 Arm64EC</li>
<li>RISC-V</li>
<li>LoongArch</li>
<li>s390x</li>
</ul>
<p>如果在不支持的 target 上使用汇编宏，编译器将报错。</p>
<div class="rule" id="r-asm.example"><a class="rule-link" href="#r-asm.example" title="asm.example"><span>[asm<wbr>.example]</span></a>
</div>

<h2 id="示例"><a class="header" href="#示例">示例</a></h2>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>use std::arch::asm;

// 使用移位和加法将 x 乘以 6
let mut x: u64 = 4;
unsafe {
    asm!(
        "mov {tmp}, {x}",
        "shl {tmp}, 1",
        "shl {x}, 2",
        "add {x}, {tmp}",
        x = inout(reg) x,
        tmp = out(reg) _,
    );
}
assert_eq!(x, 4 * 6);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.syntax"><a class="rule-link" href="#r-asm.syntax" title="asm.syntax"><span>[asm<wbr>.syntax]</span></a>
</div>

<h2 id="语法格式"><a class="header" href="#语法格式">语法格式</a></h2>
<p>下面的语法指定了可以传递给 <code>asm!</code>、<code>global_asm!</code> 和 <code>naked_asm!</code> 宏的参数。</p>
<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-AsmArgs" onclick="show_railroad()"><a href="inline-assembly.html#railroad-AsmArgs">AsmArgs</a></span> → <span class="grammar-text"><a href="inline-assembly.html#grammar-AsmAttrFormatString">AsmAttrFormatString</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="inline-assembly.html#grammar-AsmAttrFormatString">AsmAttrFormatString</a></span> )<sup>*</sup> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="inline-assembly.html#grammar-AsmAttrOperand">AsmAttrOperand</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-FormatString" onclick="show_railroad()"><a href="inline-assembly.html#railroad-FormatString">FormatString</a></span> → <span class="grammar-text"><a href="tokens.html#grammar-STRING_LITERAL">STRING_LITERAL</a></span> | <span class="grammar-text"><a href="tokens.html#grammar-RAW_STRING_LITERAL">RAW_STRING_LITERAL</a></span> | <span class="grammar-text"><a href="macros.html#grammar-MacroInvocation">MacroInvocation</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-AsmAttrFormatString" onclick="show_railroad()"><a href="inline-assembly.html#railroad-AsmAttrFormatString">AsmAttrFormatString</a></span> → ( <span class="grammar-text"><a href="attributes.html#grammar-OuterAttribute">OuterAttribute</a></span> )<sup>*</sup> <span class="grammar-text"><a href="inline-assembly.html#grammar-FormatString">FormatString</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-AsmOperand" onclick="show_railroad()"><a href="inline-assembly.html#railroad-AsmOperand">AsmOperand</a></span> → <br>      <span class="grammar-text"><a href="inline-assembly.html#grammar-ClobberAbi">ClobberAbi</a></span> <br>    | <span class="grammar-text"><a href="inline-assembly.html#grammar-AsmOptions">AsmOptions</a></span> <br>    | <span class="grammar-text"><a href="inline-assembly.html#grammar-RegOperand">RegOperand</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-AsmAttrOperand" onclick="show_railroad()"><a href="inline-assembly.html#railroad-AsmAttrOperand">AsmAttrOperand</a></span> → ( <span class="grammar-text"><a href="attributes.html#grammar-OuterAttribute">OuterAttribute</a></span> )<sup>*</sup> <span class="grammar-text"><a href="inline-assembly.html#grammar-AsmOperand">AsmOperand</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-ClobberAbi" onclick="show_railroad()"><a href="inline-assembly.html#railroad-ClobberAbi">ClobberAbi</a></span> → <span class="grammar-literal">clobber_abi</span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="items/functions.html#grammar-Abi">Abi</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="items/functions.html#grammar-Abi">Abi</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-AsmOptions" onclick="show_railroad()"><a href="inline-assembly.html#railroad-AsmOptions">AsmOptions</a></span> → <br>    <span class="grammar-literal">options</span> <span class="grammar-literal">(</span> ( <span class="grammar-text"><a href="inline-assembly.html#grammar-AsmOption">AsmOption</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="inline-assembly.html#grammar-AsmOption">AsmOption</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup> )<sup>?</sup> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-AsmOption" onclick="show_railroad()"><a href="inline-assembly.html#railroad-AsmOption">AsmOption</a></span> → <br>      <span class="grammar-literal">pure</span> <br>    | <span class="grammar-literal">nomem</span> <br>    | <span class="grammar-literal">readonly</span> <br>    | <span class="grammar-literal">preserves_flags</span> <br>    | <span class="grammar-literal">noreturn</span> <br>    | <span class="grammar-literal">nostack</span> <br>    | <span class="grammar-literal">att_syntax</span> <br>    | <span class="grammar-literal">raw</span></p>
<p><span class="grammar-text grammar-production" id="grammar-RegOperand" onclick="show_railroad()"><a href="inline-assembly.html#railroad-RegOperand">RegOperand</a></span> → ( <span class="grammar-text"><a href="inline-assembly.html#grammar-ParamName">ParamName</a></span> <span class="grammar-literal">=</span> )<sup>?</sup> <br>    ( <br>          <span class="grammar-text"><a href="inline-assembly.html#grammar-DirSpec">DirSpec</a></span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="inline-assembly.html#grammar-RegSpec">RegSpec</a></span> <span class="grammar-literal">)</span> <span class="grammar-text"><a href="expressions.html#grammar-Expression">Expression</a></span> <br>        | <span class="grammar-text"><a href="inline-assembly.html#grammar-DualDirSpec">DualDirSpec</a></span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="inline-assembly.html#grammar-RegSpec">RegSpec</a></span> <span class="grammar-literal">)</span> <span class="grammar-text"><a href="inline-assembly.html#grammar-DualDirSpecExpression">DualDirSpecExpression</a></span> <br>        | <span class="grammar-literal">sym</span> <span class="grammar-text"><a href="expressions/path-expr.html#grammar-PathExpression">PathExpression</a></span> <br>        | <span class="grammar-literal">const</span> <span class="grammar-text"><a href="expressions.html#grammar-Expression">Expression</a></span> <br>        | <span class="grammar-literal">label</span> <span class="grammar-literal">{</span> <span class="grammar-text"><a href="expressions/block-expr.html#grammar-Statements">Statements</a></span><sup>?</sup> <span class="grammar-literal">}</span> <br>    )</p>
<p><span class="grammar-text grammar-production" id="grammar-ParamName" onclick="show_railroad()"><a href="inline-assembly.html#railroad-ParamName">ParamName</a></span> → <span class="grammar-text"><a href="identifiers.html#grammar-IDENTIFIER_OR_KEYWORD">IDENTIFIER_OR_KEYWORD</a></span> | <span class="grammar-text"><a href="identifiers.html#grammar-RAW_IDENTIFIER">RAW_IDENTIFIER</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-DualDirSpecExpression" onclick="show_railroad()"><a href="inline-assembly.html#railroad-DualDirSpecExpression">DualDirSpecExpression</a></span> → <br>      <span class="grammar-text"><a href="expressions.html#grammar-Expression">Expression</a></span> <br>    | <span class="grammar-text"><a href="expressions.html#grammar-Expression">Expression</a></span> <span class="grammar-literal">=&gt;</span> <span class="grammar-text"><a href="expressions.html#grammar-Expression">Expression</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-RegSpec" onclick="show_railroad()"><a href="inline-assembly.html#railroad-RegSpec">RegSpec</a></span> → <span class="grammar-text"><a href="inline-assembly.html#grammar-RegisterClass">RegisterClass</a></span> | <span class="grammar-text"><a href="inline-assembly.html#grammar-ExplicitRegister">ExplicitRegister</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-RegisterClass" onclick="show_railroad()"><a href="inline-assembly.html#railroad-RegisterClass">RegisterClass</a></span> → <span class="grammar-text"><a href="identifiers.html#grammar-IDENTIFIER_OR_KEYWORD">IDENTIFIER_OR_KEYWORD</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-ExplicitRegister" onclick="show_railroad()"><a href="inline-assembly.html#railroad-ExplicitRegister">ExplicitRegister</a></span> → <span class="grammar-text"><a href="tokens.html#grammar-STRING_LITERAL">STRING_LITERAL</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-DirSpec" onclick="show_railroad()"><a href="inline-assembly.html#railroad-DirSpec">DirSpec</a></span> → <br>      <span class="grammar-literal">in</span> <br>    | <span class="grammar-literal">out</span> <br>    | <span class="grammar-literal">lateout</span></p>
<p><span class="grammar-text grammar-production" id="grammar-DualDirSpec" onclick="show_railroad()"><a href="inline-assembly.html#railroad-DualDirSpec">DualDirSpec</a></span> → <br>      <span class="grammar-literal">inout</span> <br>    | <span class="grammar-literal">inlateout</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 872px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-AsmArgs"><svg class="railroad" viewbox="0 0 872 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="inline-assembly.html#grammar-AsmArgs">
<text class="comment" x="39" y="25">
AsmArgs</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="inline-assembly.html#railroad-AsmAttrFormatString">
<g class="nonterminal">
<rect height="22" width="172" x="35" y="55" />
<text x="121" y="71">
AsmAttrFormatString</text>
</g>
</a>
<g class="optional">
<path d=" M 217 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 234 m -114 0 l -5 -5 m 0 10 l 5 -5 m 114 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 241 66 h 12 m 210 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -210 m 108 0 l 5 -5 m 0 10 l -5 -5 m -108 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="253" y="55" />
<text x="267" y="71">
,</text>
</g>
<a class="link" xlink:href="inline-assembly.html#railroad-AsmAttrFormatString">
<g class="nonterminal">
<rect height="22" width="172" x="291" y="55" />
<text x="377" y="71">
AsmAttrFormatString</text>
</g>
</a>
<path d=" M 281 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 509 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 194 m -94 0 l -5 -5 m 0 10 l 5 -5 m 94 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 533 66 h 12 m 170 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -170 m 88 0 l 5 -5 m 0 10 l -5 -5 m -88 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="545" y="55" />
<text x="559" y="71">
,</text>
</g>
<a class="link" xlink:href="inline-assembly.html#railroad-AsmAttrOperand">
<g class="nonterminal">
<rect height="22" width="132" x="583" y="55" />
<text x="649" y="71">
AsmAttrOperand</text>
</g>
</a>
<path d=" M 573 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 761 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="785" y="55" />
<text x="799" y="71">
,</text>
</g>
</g>
<path d=" M 207 66 h 10" />
<path d=" M 499 66 h 10" />
<path d=" M 751 66 h 10" />
</g>
<path d=" M 847 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 837 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 282px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-FormatString"><svg class="railroad" viewbox="0 0 282 140" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="inline-assembly.html#grammar-FormatString">
<text class="comment" x="57" y="25">
FormatString</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 132 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0" />
<a class="link" xlink:href="tokens.html#railroad-STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="132" x="59" y="42" />
<text x="125" y="58">
STRING_LITERAL</text>
</g>
</a>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 188 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 188 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 164 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="tokens.html#railroad-RAW_STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="164" x="59" y="75" />
<text x="141" y="91">
RAW_STRING_LITERAL</text>
</g>
</a>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 140 0 h 24 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="macros.html#railroad-MacroInvocation">
<g class="nonterminal">
<rect height="22" width="140" x="59" y="108" />
<text x="129" y="124">
MacroInvocation</text>
</g>
</a>
</g>
<path d=" M 257 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 247 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 400px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-AsmAttrFormatString"><svg class="railroad" viewbox="0 0 400 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="inline-assembly.html#grammar-AsmAttrFormatString">
<text class="comment" x="81" y="25">
AsmAttrFormatString</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="attributes.html#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<a class="link" xlink:href="inline-assembly.html#railroad-FormatString">
<g class="nonterminal">
<rect height="22" width="116" x="249" y="55" />
<text x="307" y="71">
FormatString</text>
</g>
</a>
<path d=" M 239 66 h 10" />
</g>
<path d=" M 375 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 365 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 218px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-AsmOperand"><svg class="railroad" viewbox="0 0 218 140" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="inline-assembly.html#grammar-AsmOperand">
<text class="comment" x="50" y="25">
AsmOperand</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 100 0 h 24" />
<g class="sequence">
<a class="link" xlink:href="inline-assembly.html#railroad-ClobberAbi">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="42" />
<text x="109" y="58">
ClobberAbi</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 124 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 124 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 100 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="inline-assembly.html#railroad-AsmOptions">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="75" />
<text x="109" y="91">
AsmOptions</text>
</g>
</a>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 100 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="inline-assembly.html#railroad-RegOperand">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="108" />
<text x="109" y="124">
RegOperand</text>
</g>
</a>
</g>
<path d=" M 193 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 183 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 384px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-AsmAttrOperand"><svg class="railroad" viewbox="0 0 384 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="inline-assembly.html#grammar-AsmAttrOperand">
<text class="comment" x="64" y="25">
AsmAttrOperand</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="attributes.html#railroad-OuterAttribute">
<g class="nonterminal">
<rect height="22" width="132" x="71" y="55" />
<text x="137" y="71">
OuterAttribute</text>
</g>
</a>
</g>
</g>
<a class="link" xlink:href="inline-assembly.html#railroad-AsmOperand">
<g class="nonterminal">
<rect height="22" width="100" x="249" y="55" />
<text x="299" y="71">
AsmOperand</text>
</g>
</a>
<path d=" M 239 66 h 10" />
</g>
<path d=" M 359 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 349 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 558px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ClobberAbi"><svg class="railroad" viewbox="0 0 558 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="inline-assembly.html#grammar-ClobberAbi">
<text class="comment" x="50" y="25">
ClobberAbi</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="108" x="35" y="55" />
<text x="89" y="71">
clobber_abi</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="153" y="55" />
<text x="167" y="71">
(</text>
</g>
<a class="link" xlink:href="items/functions.html#railroad-Abi">
<g class="nonterminal">
<rect height="22" width="44" x="191" y="55" />
<text x="213" y="71">
Abi</text>
</g>
</a>
<g class="optional">
<path d=" M 245 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 106 m -50 0 l -5 -5 m 0 10 l 5 -5 m 50 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 269 66 h 12 m 82 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -82 m 44 0 l 5 -5 m 0 10 l -5 -5 m -44 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="281" y="55" />
<text x="295" y="71">
,</text>
</g>
<a class="link" xlink:href="items/functions.html#railroad-Abi">
<g class="nonterminal">
<rect height="22" width="44" x="319" y="55" />
<text x="341" y="71">
Abi</text>
</g>
</a>
<path d=" M 309 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 409 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="433" y="55" />
<text x="447" y="71">
,</text>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="495" y="55" />
<text x="509" y="71">
)</text>
</g>
<path d=" M 143 66 h 10" />
<path d=" M 181 66 h 10" />
<path d=" M 235 66 h 10" />
<path d=" M 399 66 h 10" />
<path d=" M 485 66 h 10" />
</g>
<path d=" M 533 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 523 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 670px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-AsmOptions"><svg class="railroad" viewbox="0 0 670 112" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="inline-assembly.html#grammar-AsmOptions">
<text class="comment" x="50" y="25">
AsmOptions</text>
</a>
<g class="sequence">
<path d=" M 10 78 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="76" x="35" y="67" />
<text x="73" y="83">
options</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="121" y="67" />
<text x="135" y="83">
(</text>
</g>
<g class="optional">
<path d=" M 159 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -12 a 12 12 0 0 1 12 -12 h 390 m -192 0 l -5 -5 m 0 10 l 5 -5 m 192 0 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<a class="link" xlink:href="inline-assembly.html#railroad-AsmOption">
<g class="nonterminal">
<rect height="22" width="92" x="183" y="67" />
<text x="229" y="83">
AsmOption</text>
</g>
</a>
<g class="optional">
<path d=" M 285 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 154 m -74 0 l -5 -5 m 0 10 l 5 -5 m 74 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 309 78 h 12 m 130 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -130 m 68 0 l 5 -5 m 0 10 l -5 -5 m -68 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="321" y="67" />
<text x="335" y="83">
,</text>
</g>
<a class="link" xlink:href="inline-assembly.html#railroad-AsmOption">
<g class="nonterminal">
<rect height="22" width="92" x="359" y="67" />
<text x="405" y="83">
AsmOption</text>
</g>
</a>
<path d=" M 349 78 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 497 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="521" y="67" />
<text x="535" y="83">
,</text>
</g>
</g>
<path d=" M 275 78 h 10" />
<path d=" M 487 78 h 10" />
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="607" y="67" />
<text x="621" y="83">
)</text>
</g>
<path d=" M 111 78 h 10" />
<path d=" M 149 78 h 10" />
<path d=" M 597 78 h 10" />
</g>
<path d=" M 645 78 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 78 h 10" />
<path d=" M 635 78 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 258px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-AsmOption"><svg class="railroad" viewbox="0 0 258 305" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="inline-assembly.html#grammar-AsmOption">
<text class="comment" x="46" y="25">
AsmOption</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 52 0 h 112 m -53 0 l -5 -5 m 0 10 l 5 -5 m 53 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="42" />
<text x="85" y="58">
pure</text>
</g>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 164 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 164 0 v -33" />
<path d=" M 47 107 v 33 m 164 0 v -33" />
<path d=" M 47 140 v 33 m 164 0 v -33" />
<path d=" M 47 173 v 33 m 164 0 v -33" />
<path d=" M 47 206 v 33 m 164 0 v -33" />
<path d=" M 47 239 v 33 m 164 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 60 0 h 80 m -37 0 l -5 -5 m 0 10 l 5 -5 m 37 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="59" y="75" />
<text x="89" y="91">
nomem</text>
</g>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 84 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="84" x="59" y="108" />
<text x="101" y="124">
readonly</text>
</g>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 140 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="140" x="59" y="141" />
<text x="129" y="157">
preserves_flags</text>
</g>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 84 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="84" x="59" y="174" />
<text x="101" y="190">
noreturn</text>
</g>
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 76 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="76" x="59" y="207" />
<text x="97" y="223">
nostack</text>
</g>
</g>
<path d=" M 47 239 v 0 a 12 12 0 0 0 12 12 m 100 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="100" x="59" y="240" />
<text x="109" y="256">
att_syntax</text>
</g>
</g>
<path d=" M 47 272 v 0 a 12 12 0 0 0 12 12 m 44 0 h 96 m -45 0 l -5 -5 m 0 10 l 5 -5 m 45 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="273" />
<text x="81" y="289">
raw</text>
</g>
</g>
<path d=" M 233 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 223 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 782px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RegOperand"><svg class="railroad" viewbox="0 0 782 231" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="inline-assembly.html#grammar-RegOperand">
<text class="comment" x="50" y="25">
RegOperand</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="optional">
<path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 130 m -62 0 l -5 -5 m 0 10 l 5 -5 m 62 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<a class="link" xlink:href="inline-assembly.html#railroad-ParamName">
<g class="nonterminal">
<rect height="22" width="92" x="59" y="55" />
<text x="105" y="71">
ParamName</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="161" y="55" />
<text x="175" y="71">
=</text>
</g>
<path d=" M 151 66 h 10" />
</g>
</g>
<g class="choice">
<path d=" M 223 66 h 24 m 348 0 h 152 m -73 0 l -5 -5 m 0 10 l 5 -5 m 73 0" />
<g class="sequence">
<a class="link" xlink:href="inline-assembly.html#railroad-DirSpec">
<g class="nonterminal">
<rect height="22" width="76" x="247" y="55" />
<text x="285" y="71">
DirSpec</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="333" y="55" />
<text x="347" y="71">
(</text>
</g>
<a class="link" xlink:href="inline-assembly.html#railroad-RegSpec">
<g class="nonterminal">
<rect height="22" width="76" x="371" y="55" />
<text x="409" y="71">
RegSpec</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="457" y="55" />
<text x="471" y="71">
)</text>
</g>
<a class="link" xlink:href="expressions.html#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="495" y="55" />
<text x="545" y="71">
Expression</text>
</g>
</a>
<path d=" M 323 66 h 10" />
<path d=" M 361 66 h 10" />
<path d=" M 447 66 h 10" />
<path d=" M 485 66 h 10" />
</g>
<path d=" M 223 66 a 12 12 0 0 1 12 12 v 9 m 500 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 235 87 v 33 m 500 0 v -33" />
<path d=" M 235 120 v 33 m 500 0 v -33" />
<path d=" M 235 153 v 33 m 500 0 v -33" />
<path d=" M 235 87 v 0 a 12 12 0 0 0 12 12 m 476 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="inline-assembly.html#railroad-DualDirSpec">
<g class="nonterminal">
<rect height="22" width="108" x="247" y="88" />
<text x="301" y="104">
DualDirSpec</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="365" y="88" />
<text x="379" y="104">
(</text>
</g>
<a class="link" xlink:href="inline-assembly.html#railroad-RegSpec">
<g class="nonterminal">
<rect height="22" width="76" x="403" y="88" />
<text x="441" y="104">
RegSpec</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="489" y="88" />
<text x="503" y="104">
)</text>
</g>
<a class="link" xlink:href="inline-assembly.html#railroad-DualDirSpecExpression">
<g class="nonterminal">
<rect height="22" width="196" x="527" y="88" />
<text x="625" y="104">
DualDirSpecExpression</text>
</g>
</a>
<path d=" M 355 99 h 10" />
<path d=" M 393 99 h 10" />
<path d=" M 479 99 h 10" />
<path d=" M 517 99 h 10" />
</g>
<path d=" M 235 120 v 0 a 12 12 0 0 0 12 12 m 186 0 h 290 m -142 0 l -5 -5 m 0 10 l 5 -5 m 142 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="247" y="121" />
<text x="269" y="137">
sym</text>
</g>
<a class="link" xlink:href="expressions/path-expr.html#railroad-PathExpression">
<g class="nonterminal">
<rect height="22" width="132" x="301" y="121" />
<text x="367" y="137">
PathExpression</text>
</g>
</a>
<path d=" M 291 132 h 10" />
</g>
<path d=" M 235 153 v 0 a 12 12 0 0 0 12 12 m 170 0 h 306 m -150 0 l -5 -5 m 0 10 l 5 -5 m 150 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="247" y="154" />
<text x="277" y="170">
const</text>
</g>
<a class="link" xlink:href="expressions.html#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="317" y="154" />
<text x="367" y="170">
Expression</text>
</g>
</a>
<path d=" M 307 165 h 10" />
</g>
<path d=" M 235 186 v 12 a 12 12 0 0 0 12 12 m 294 0 h 182 m -88 0 l -5 -5 m 0 10 l 5 -5 m 88 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="247" y="199" />
<text x="277" y="215">
label</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="317" y="199" />
<text x="331" y="215">
{</text>
</g>
<g class="optional">
<path d=" M 355 210 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 100 m -47 0 l -5 -5 m 0 10 l 5 -5 m 47 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="expressions/block-expr.html#railroad-Statements">
<g class="nonterminal">
<rect height="22" width="100" x="379" y="199" />
<text x="429" y="215">
Statements</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="513" y="199" />
<text x="527" y="215">
}</text>
</g>
<path d=" M 307 210 h 10" />
<path d=" M 345 210 h 10" />
<path d=" M 503 210 h 10" />
</g>
</g>
<path d=" M 213 66 h 10" />
</g>
<path d=" M 757 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 747 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 314px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ParamName"><svg class="railroad" viewbox="0 0 314 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="inline-assembly.html#grammar-ParamName">
<text class="comment" x="46" y="25">
ParamName</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 196 0 h 24" />
<a class="link" xlink:href="identifiers.html#railroad-IDENTIFIER_OR_KEYWORD">
<g class="nonterminal">
<rect height="22" width="196" x="59" y="42" />
<text x="157" y="58">
IDENTIFIER_OR_KEYWORD</text>
</g>
</a>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 220 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 132 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="identifiers.html#railroad-RAW_IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="132" x="59" y="75" />
<text x="125" y="91">
RAW_IDENTIFIER</text>
</g>
</a>
</g>
<path d=" M 289 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 279 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 374px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-DualDirSpecExpression"><svg class="railroad" viewbox="0 0 374 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="inline-assembly.html#grammar-DualDirSpecExpression">
<text class="comment" x="92" y="25">
DualDirSpecExpression</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 100 0 h 180 m -87 0 l -5 -5 m 0 10 l 5 -5 m 87 0" />
<g class="sequence">
<a class="link" xlink:href="expressions.html#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="42" />
<text x="109" y="58">
Expression</text>
</g>
</a>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 280 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 256 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="expressions.html#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="59" y="75" />
<text x="109" y="91">
Expression</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="169" y="75" />
<text x="187" y="91">
=&gt;</text>
</g>
<a class="link" xlink:href="expressions.html#railroad-Expression">
<g class="nonterminal">
<rect height="22" width="100" x="215" y="75" />
<text x="265" y="91">
Expression</text>
</g>
</a>
<path d=" M 159 86 h 10" />
<path d=" M 205 86 h 10" />
</g>
</g>
<path d=" M 349 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 339 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 266px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RegSpec"><svg class="railroad" viewbox="0 0 266 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="inline-assembly.html#grammar-RegSpec">
<text class="comment" x="39" y="25">
RegSpec</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 124 0 h 48" />
<a class="link" xlink:href="inline-assembly.html#railroad-RegisterClass">
<g class="nonterminal">
<rect height="22" width="124" x="59" y="42" />
<text x="121" y="58">
RegisterClass</text>
</g>
</a>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 172 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 148 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="inline-assembly.html#railroad-ExplicitRegister">
<g class="nonterminal">
<rect height="22" width="148" x="59" y="75" />
<text x="133" y="91">
ExplicitRegister</text>
</g>
</a>
</g>
<path d=" M 241 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 231 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 266px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-RegisterClass"><svg class="railroad" viewbox="0 0 266 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="inline-assembly.html#grammar-RegisterClass">
<text class="comment" x="60" y="25">
RegisterClass</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<a class="link" xlink:href="identifiers.html#railroad-IDENTIFIER_OR_KEYWORD">
<g class="nonterminal">
<rect height="22" width="196" x="35" y="42" />
<text x="133" y="58">
IDENTIFIER_OR_KEYWORD</text>
</g>
</a>
<path d=" M 241 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 231 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 202px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ExplicitRegister"><svg class="railroad" viewbox="0 0 202 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="inline-assembly.html#grammar-ExplicitRegister">
<text class="comment" x="71" y="25">
ExplicitRegister</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<a class="link" xlink:href="tokens.html#railroad-STRING_LITERAL">
<g class="nonterminal">
<rect height="22" width="132" x="35" y="42" />
<text x="101" y="58">
STRING_LITERAL</text>
</g>
</a>
<path d=" M 177 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 167 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 194px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-DirSpec"><svg class="railroad" viewbox="0 0 194 140" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="inline-assembly.html#grammar-DirSpec">
<text class="comment" x="39" y="25">
DirSpec</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 36 0 h 64 m -29 0 l -5 -5 m 0 10 l 5 -5 m 29 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="42" />
<text x="77" y="58">
in</text>
</g>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 100 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 100 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 44 0 h 32 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="75" />
<text x="81" y="91">
out</text>
</g>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 76 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="76" x="59" y="108" />
<text x="97" y="124">
lateout</text>
</g>
</g>
<path d=" M 169 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 159 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 210px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-DualDirSpec"><svg class="railroad" viewbox="0 0 210 107" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="inline-assembly.html#grammar-DualDirSpec">
<text class="comment" x="53" y="25">
DualDirSpec</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 60 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="59" y="42" />
<text x="89" y="58">
inout</text>
</g>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 116 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 92 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="92" x="59" y="75" />
<text x="105" y="91">
inlateout</text>
</g>
</g>
<path d=" M 185 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 175 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-asm.scope"><a class="rule-link" href="#r-asm.scope" title="asm.scope"><span>[asm<wbr>.scope]</span></a>
</div>

<h2 id="作用域"><a class="header" href="#作用域">作用域</a></h2>
<div class="rule" id="r-asm.scope.intro"><a class="rule-link" href="#r-asm.scope.intro" title="asm.scope.intro"><span>[asm<wbr>.scope<wbr>.intro]</span></a>
</div>

<p>内联汇编可以以三种方式之一使用。</p>
<div class="rule" id="r-asm.scope.asm"><a class="rule-link" href="#r-asm.scope.asm" title="asm.scope.asm"><span>[asm<wbr>.scope<wbr>.asm]</span></a>
</div>

<p>使用 <code>asm!</code> 宏，汇编代码在函数作用域内发出，并集成到编译器生成的函数汇编代码中。这些汇编代码必须遵守 <a href="#rules-for-inline-assembly">严格的规则</a> 以避免未定义行为。请注意，在某些情况下，编译器可能会选择将汇编代码作为单独的函数发出并生成对它的调用。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>unsafe { core::arch::asm!("/* {} */", in(reg) 0); }
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.scope.naked_asm"><a class="rule-link" href="#r-asm.scope.naked_asm" title="asm.scope.naked_asm"><span>[asm<wbr>.scope<wbr>.naked_asm]</span></a>
</div>

<p>使用 <code>naked_asm!</code> 宏，汇编代码在函数作用域内发出，并构成函数的完整汇编代码。<code>naked_asm!</code> 宏仅允许在 <a href="attributes/codegen.html#the-naked-attribute">裸函数</a> 中使用。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span><span class="boring">#[unsafe(naked)]
</span><span class="boring">extern "C" fn wrapper() {
</span>core::arch::naked_asm!("/* {} */", const 0);
<span class="boring">}
</span><span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.scope.global_asm"><a class="rule-link" href="#r-asm.scope.global_asm" title="asm.scope.global_asm"><span>[asm<wbr>.scope<wbr>.global_asm]</span></a>
</div>

<p>使用 <code>global_asm!</code> 宏，汇编代码在全局作用域内发出，位于函数之外。这可用于使用汇编代码手写整个函数，通常可以更自由地使用任意寄存器和汇编指令。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {}
</span><span class="boring">#[cfg(target_arch = "x86_64")]
</span>core::arch::global_asm!("/* {} */", const 0);</code></pre>
<div class="rule" id="r-asm.ts-args"><a class="rule-link" href="#r-asm.ts-args" title="asm.ts-args"><span>[asm<wbr>.ts-args]</span></a>
</div>

<h2 id="模板字符串参数"><a class="header" href="#模板字符串参数">模板字符串参数</a></h2>
<div class="rule" id="r-asm.ts-args.syntax"><a class="rule-link" href="#r-asm.ts-args.syntax" title="asm.ts-args.syntax"><span>[asm<wbr>.ts-args<wbr>.syntax]</span></a>
</div>

<p>汇编器模板使用与 <a href="../alloc/fmt/index.html#syntax">格式化字符串</a> 相同的语法格式（即占位符通过大括号指定）。</p>
<div class="rule" id="r-asm.ts-args.order"><a class="rule-link" href="#r-asm.ts-args.order" title="asm.ts-args.order"><span>[asm<wbr>.ts-args<wbr>.order]</span></a>
</div>

<p>对应的参数按顺序、按索引或按名称访问。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i64;
let y: i64;
let z: i64;
// 这个
unsafe { core::arch::asm!("mov {}, {}", out(reg) x, in(reg) 5); }
// ... 这个
unsafe { core::arch::asm!("mov {0}, {1}", out(reg) y, in(reg) 5); }
// ... 以及这个
unsafe { core::arch::asm!("mov {out}, {in}", out = out(reg) z, in = in(reg) 5); }
// 都有相同的行为
assert_eq!(x, y);
assert_eq!(y, z);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.ts-args.no-implicit"><a class="rule-link" href="#r-asm.ts-args.no-implicit" title="asm.ts-args.no-implicit"><span>[asm<wbr>.ts-args<wbr>.no-implicit]</span></a>
</div>

<p>但是，不支持（由 <a href="https://github.com/rust-lang/rfcs/pull/2795">RFC #2795</a> 引入的）隐式命名参数。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x = 5;
// 我们不能直接从作用域引用 `x`，我们需要一个类似 `in(reg) x` 的操作数
unsafe { core::arch::asm!("/* {x} */"); } // ERROR: no argument named x
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.ts-args.one-or-more"><a class="rule-link" href="#r-asm.ts-args.one-or-more" title="asm.ts-args.one-or-more"><span>[asm<wbr>.ts-args<wbr>.one-or-more]</span></a>
</div>

<p>一个 <code>asm!</code> 调用可以有一个或多个模板字符串参数；具有多个模板字符串参数的 <code>asm!</code> 被处理为所有字符串都连接在一起，且它们之间有一个 <code>\n</code>。预期用法是每个模板字符串参数对应一行汇编代码。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i64;
let y: i64;
// 我们可以将多个字符串分开，就像它们是写在一起的一样
unsafe { core::arch::asm!("mov eax, 5", "mov ecx, eax", out("rax") x, out("rcx") y); }
assert_eq!(x, y);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.ts-args.before-other-args"><a class="rule-link" href="#r-asm.ts-args.before-other-args" title="asm.ts-args.before-other-args"><span>[asm<wbr>.ts-args<wbr>.before-other-args]</span></a>
</div>

<p>所有模板字符串参数必须出现在任何其他参数之前。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = 5;
<span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// 模板字符串需要首先出现在 asm 调用中
unsafe { core::arch::asm!("/* {x} */", x = const 5, "ud2"); } // ERROR: unexpected token
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.ts-args.positional-first"><a class="rule-link" href="#r-asm.ts-args.positional-first" title="asm.ts-args.positional-first"><span>[asm<wbr>.ts-args<wbr>.positional-first]</span></a>
</div>

<p>与格式化字符串一样，位置参数必须出现在命名参数和显式 <a href="#register-operands">寄存器操作数</a> 之前。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// 命名操作数需要放在位置操作数之后
unsafe { core::arch::asm!("/* {x} {} */", x = const 5, in(reg) 5); }
// ERROR: positional arguments cannot follow named arguments or explicit register arguments
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// 我们也不能将显式寄存器放在位置操作数之前
unsafe { core::arch::asm!("/* {} */", in("eax") 0, in(reg) 5); }
// ERROR: positional arguments cannot follow named arguments or explicit register arguments
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.ts-args.register-operands"><a class="rule-link" href="#r-asm.ts-args.register-operands" title="asm.ts-args.register-operands"><span>[asm<wbr>.ts-args<wbr>.register-operands]</span></a>
</div>

<p>显式寄存器操作数不能被模板字符串中的占位符使用。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// 显式寄存器操作数不会被替换，请在字符串中显式使用 `eax`
unsafe { core::arch::asm!("/* {} */", in("eax") 5); }
// ERROR: invalid reference to argument at index 0
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.ts-args.at-least-once"><a class="rule-link" href="#r-asm.ts-args.at-least-once" title="asm.ts-args.at-least-once"><span>[asm<wbr>.ts-args<wbr>.at-least-once]</span></a>
</div>

<p>所有其他命名和位置操作数必须在模板字符串中至少出现一次，否则会产生编译器错误。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// 我们必须在格式化字符串中命名所有的操作数
unsafe { core::arch::asm!("", in(reg) 5, x = const 5); }
// ERROR: multiple unused asm arguments
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.ts-args.opaque"><a class="rule-link" href="#r-asm.ts-args.opaque" title="asm.ts-args.opaque"><span>[asm<wbr>.ts-args<wbr>.opaque]</span></a>
</div>

<p>除了将操作数替换到模板字符串中以形成传递给汇编器的代码的方式外，确切的汇编代码语法是特定于 target 的，且对编译器是不透明的。</p>
<div class="rule" id="r-asm.ts-args.llvm-syntax"><a class="rule-link" href="#r-asm.ts-args.llvm-syntax" title="asm.ts-args.llvm-syntax"><span>[asm<wbr>.ts-args<wbr>.llvm-syntax]</span></a>
</div>

<p>目前，所有受支持的 target 都遵循 LLVM 内部汇编器使用的汇编代码语法，这通常对应于 GNU 汇编器（GAS）的语法。在 x86 上，默认使用 GAS 的 <code>.intel_syntax noprefix</code> 模式。在 ARM 上，使用 <code>.syntax unified</code> 模式。这些 target 对汇编代码施加了额外的限制：任何汇编器状态（例如可以通过 <code>.section</code> 更改的当前节）必须在汇编字符串结束时恢复为其原始值。不符合 GAS 语法的汇编代码将导致特定于汇编器的行为。有关内联汇编所用指令的进一步约束由 <a href="#directives-support">指令支持</a> 指出。</p>
<div class="rule" id="r-asm.attributes"><a class="rule-link" href="#r-asm.attributes" title="asm.attributes"><span>[asm<wbr>.attributes]</span></a>
</div>

<h2 id="属性"><a class="header" href="#属性">属性</a></h2>
<div class="rule" id="r-asm.attributes.supported-attributes"><a class="rule-link" href="#r-asm.attributes.supported-attributes" title="asm.attributes.supported-attributes"><span>[asm<wbr>.attributes<wbr>.supported-attributes]</span></a>
</div>

<p>在语义上，只有 <a href="conditional-compilation.html#cfg属性"><code>cfg</code></a> 和 <a href="conditional-compilation.html#cfg_attr属性"><code>cfg_attr</code></a> 属性被内联汇编模板字符串和操作数接受。其他属性虽然会被解析，但在汇编宏展开时会被拒绝。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {}
</span><span class="boring">#[cfg(target_arch = "x86_64")]
</span>core::arch::global_asm!(
    #[cfg(not(panic = "abort"))]
    ".cfi_startproc",
    // ...
    "ret",
    #[cfg(not(panic = "abort"))]
    ".cfi_endproc",
);</code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>在 <code>rustc</code> 中，汇编宏对这些属性的处理与处理语言中类似属性的普通系统是分开实现的。这解释了受支持属性种类有限的原因，并可能导致行为上的细微差异。</p>
</blockquote>
</div>

<div class="rule" id="r-asm.attributes.starts-with-template"><a class="rule-link" href="#r-asm.attributes.starts-with-template" title="asm.attributes.starts-with-template"><span>[asm<wbr>.attributes<wbr>.starts-with-template]</span></a>
</div>

<p>在语法上，第一个操作数之前必须至少有一个模板字符串。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 这被拒绝是因为 `a = out(reg) x` 不会被解析为
// 模板字符串。
core::arch::asm!(
    #[cfg(false)]
    a = out(reg) x, // ERROR.
    "",
);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type"><a class="rule-link" href="#r-asm.operand-type" title="asm.operand-type"><span>[asm<wbr>.operand-type]</span></a>
</div>

<h2 id="操作数类型"><a class="header" href="#操作数类型">操作数类型</a></h2>
<div class="rule" id="r-asm.operand-type.supported-operands"><a class="rule-link" href="#r-asm.operand-type.supported-operands" title="asm.operand-type.supported-operands"><span>[asm<wbr>.operand-type<wbr>.supported-operands]</span></a>
</div>

<p>支持几种类型的操作数：</p>
<div class="rule" id="r-asm.operand-type.supported-operands.in"><a class="rule-link" href="#r-asm.operand-type.supported-operands.in" title="asm.operand-type.supported-operands.in"><span>[asm<wbr>.operand-type<wbr>.supported-operands<wbr>.in]</span></a>
</div>

<ul>
<li><code>in(&lt;reg&gt;) &lt;expr&gt;</code>
<ul>
<li><code>&lt;reg&gt;</code> 可以引用一个寄存器类或一个显式寄存器。分配的寄存器名称将被替换到汇编模板字符串中。</li>
<li>在汇编代码开始时，分配的寄存器将包含 <code>&lt;expr&gt;</code> 的值。</li>
<li>分配的寄存器在汇编代码结束时必须包含相同的值（除非 <code>lateout</code> 被分配到同一个寄存器）。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// `in` 可用于将值传递到内联汇编中...
unsafe { core::arch::asm!("/* {} */", in(reg) 5); }
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.supported-operands.out"><a class="rule-link" href="#r-asm.operand-type.supported-operands.out" title="asm.operand-type.supported-operands.out"><span>[asm<wbr>.operand-type<wbr>.supported-operands<wbr>.out]</span></a>
</div>

<ul>
<li><code>out(&lt;reg&gt;) &lt;expr&gt;</code>
<ul>
<li><code>&lt;reg&gt;</code> 可以引用一个寄存器类或一个显式寄存器。分配的寄存器名称将被替换到汇编模板字符串中。</li>
<li>在汇编代码开始时，分配的寄存器将包含一个未定义的值。</li>
<li><code>&lt;expr&gt;</code> 必须是一个（可能未初始化的）位置表达式，分配的寄存器的内容将在汇编代码结束时写入该表达式。</li>
<li>可以指定下划线（<code>_</code>）而不是表达式，这将导致寄存器的内容在汇编代码结束时被丢弃（实际上起到了破坏列表（clobber）的作用）。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i64;
// 而 `out` 可用于将值传回 rust。
unsafe { core::arch::asm!("/* {} */", out(reg) x); }
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.supported-operands.lateout"><a class="rule-link" href="#r-asm.operand-type.supported-operands.lateout" title="asm.operand-type.supported-operands.lateout"><span>[asm<wbr>.operand-type<wbr>.supported-operands<wbr>.lateout]</span></a>
</div>

<ul>
<li><code>lateout(&lt;reg&gt;) &lt;expr&gt;</code>
<ul>
<li>与 <code>out</code> 相同，除了寄存器分配器可以重用分配给 <code>in</code> 的寄存器。</li>
<li>您应该仅在读取所有输入后才写入寄存器，否则可能会破坏某个输入。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i64;
// `lateout` 与 `out` 相同
// 但编译器知道在我们要覆盖它的时候，我们并不关心任何输入的值。
unsafe { core::arch::asm!("mov {}, 5", lateout(reg) x); }
assert_eq!(x, 5)
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.supported-operands.inout"><a class="rule-link" href="#r-asm.operand-type.supported-operands.inout" title="asm.operand-type.supported-operands.inout"><span>[asm<wbr>.operand-type<wbr>.supported-operands<wbr>.inout]</span></a>
</div>

<ul>
<li><code>inout(&lt;reg&gt;) &lt;expr&gt;</code>
<ul>
<li><code>&lt;reg&gt;</code> 可以引用一个寄存器类或一个显式寄存器。分配的寄存器名称将被替换到汇编模板字符串中。</li>
<li>在汇编代码开始时，分配的寄存器将包含 <code>&lt;expr&gt;</code> 的值。</li>
<li><code>&lt;expr&gt;</code> 必须是一个可变的已初始化位置表达式，分配的寄存器的内容将在汇编代码结束时写入该表达式。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let mut x: i64 = 4;
// `inout` 可用于在寄存器内修改值
unsafe { core::arch::asm!("inc {}", inout(reg) x); }
assert_eq!(x, 5);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.supported-operands.inout-arrow"><a class="rule-link" href="#r-asm.operand-type.supported-operands.inout-arrow" title="asm.operand-type.supported-operands.inout-arrow"><span>[asm<wbr>.operand-type<wbr>.supported-operands<wbr>.inout-arrow]</span></a>
</div>

<ul>
<li><code>inout(&lt;reg&gt;) &lt;in expr&gt; =&gt; &lt;out expr&gt;</code>
<ul>
<li>与 <code>inout</code> 相同，除了寄存器的初始值取自 <code>&lt;in expr&gt;</code> 的值。</li>
<li><code>&lt;out expr&gt;</code> 必须是一个（可能未初始化的）位置表达式，分配的寄存器的内容将在汇编代码结束时写入该表达式。</li>
<li>可以为 <code>&lt;out expr&gt;</code> 指定下划线（<code>_</code>）而不是表达式，这将导致寄存器的内容在汇编代码结束时被丢弃（实际上起到了破坏列表的作用）。</li>
<li><code>&lt;in expr&gt;</code> 和 <code>&lt;out expr&gt;</code> 可以具有不同的类型。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i64;
// `inout` 也可以将值移动到不同的地方
unsafe { core::arch::asm!("inc {}", inout(reg) 4u64=&gt;x); }
assert_eq!(x, 5);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.supported-operands.inlateout"><a class="rule-link" href="#r-asm.operand-type.supported-operands.inlateout" title="asm.operand-type.supported-operands.inlateout"><span>[asm<wbr>.operand-type<wbr>.supported-operands<wbr>.inlateout]</span></a>
</div>

<ul>
<li><code>inlateout(&lt;reg&gt;) &lt;expr&gt;</code> / <code>inlateout(&lt;reg&gt;) &lt;in expr&gt; =&gt; &lt;out expr&gt;</code>
<ul>
<li>与 <code>inout</code> 相同，除了寄存器分配器可以重用分配给 <code>in</code> 的寄存器（如果编译器知道 <code>in</code> 具有与 <code>inlateout</code> 相同的初始值，就会发生这种情况）。</li>
<li>您应该仅在读取所有输入后才写入寄存器，否则可能会破坏某个输入。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let mut x: i64 = 4;
// `inlateout` 是使用 `lateout` 的 `inout`
unsafe { core::arch::asm!("inc {}", inlateout(reg) x); }
assert_eq!(x, 5);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.supported-operands.sym"><a class="rule-link" href="#r-asm.operand-type.supported-operands.sym" title="asm.operand-type.supported-operands.sym"><span>[asm<wbr>.operand-type<wbr>.supported-operands<wbr>.sym]</span></a>
</div>

<ul>
<li><code>sym &lt;path&gt;</code>
<ul>
<li><code>&lt;path&gt;</code> 必须引用一个 <code>fn</code> 或 <code>static</code>。</li>
<li>引用该项的混淆后的符号名称将被替换到汇编模板字符串中。</li>
<li>替换后的字符串不包括任何修饰符（例如 GOT、PLT、重定位等）。</li>
<li><code>&lt;path&gt;</code> 允许指向一个 <code>#[thread_local]</code> 静态变量，在这种情况下，汇编代码可以将该符号与重定位（例如 <code>@plt</code>、<code>@TPOFF</code>）结合使用以读取线程局部数据。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>extern "C" fn foo() {
    println!("Hello from inline assembly")
}
// `sym` 可用于引用函数（即使它没有我们可以直接编写的外部名称）
unsafe { core::arch::asm!("call {}", sym foo, clobber_abi("C")); }
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.supported-operands.const"><a class="rule-link" href="#r-asm.operand-type.supported-operands.const" title="asm.operand-type.supported-operands.const"><span>[asm<wbr>.operand-type<wbr>.supported-operands<wbr>.const]</span></a>
</div>

<ul>
<li><code>const &lt;expr&gt;</code>
<ul>
<li><code>&lt;expr&gt;</code> 必须是一个整数常量表达式。此表达式遵循与内联 <code>const</code> 块相同的规则。</li>
<li>表达式的类型可以是任何整数类型，但默认情况下就像整数面值一样是 <code>i32</code>。</li>
<li>表达式的值被格式化为字符串，并直接替换到汇编模板字符串中。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// swizzle [0, 1, 2, 3] =&gt; [3, 2, 0, 1]
const SHUFFLE: u8 = 0b01_00_10_11;
let x: core::arch::x86_64::__m128 = unsafe { core::mem::transmute([0u32, 1u32, 2u32, 3u32]) };
let y: core::arch::x86_64::__m128;
// 将常量值传递给需要立即数的指令，如 `pshufd`
unsafe {
    core::arch::asm!("pshufd {xmm}, {xmm}, {shuffle}",
        xmm = inlateout(xmm_reg) x=&gt;y,
        shuffle = const SHUFFLE
    );
}
let y: [u32; 4] = unsafe { core::mem::transmute(y) };
assert_eq!(y, [3, 2, 0, 1]);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.supported-operands.label"><a class="rule-link" href="#r-asm.operand-type.supported-operands.label" title="asm.operand-type.supported-operands.label"><span>[asm<wbr>.operand-type<wbr>.supported-operands<wbr>.label]</span></a>
</div>

<ul>
<li><code>label &lt;block&gt;</code>
<ul>
<li>该块的地址将被替换到汇编模板字符串中。汇编代码可以跳转到替换后的地址。</li>
<li>对于区分直接跳转和间接跳转的 target（例如启用了 <code>cf-protection</code> 的 x86-64），汇编代码不得间接跳转到替换后的地址。</li>
<li>执行完该块后，<code>asm!</code> 表达式返回。</li>
<li>块的类型必须是单元类型或 <code>!</code>（从不）。</li>
<li>该块启动了一个新的安全上下文；<code>label</code> 块内的不安全操作必须包装在内部的 <code>unsafe</code> 块中，尽管整个 <code>asm!</code> 表达式已经包装在 <code>unsafe</code> 中了。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")]
</span>unsafe {
    core::arch::asm!("jmp {}", label {
        println!("Hello from inline assembly label");
    });
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.left-to-right"><a class="rule-link" href="#r-asm.operand-type.left-to-right" title="asm.operand-type.left-to-right"><span>[asm<wbr>.operand-type<wbr>.left-to-right]</span></a>
</div>

<p>操作数表达式从左到右进行评估，就像函数调用参数一样。在 <code>asm!</code> 执行后，输出按从左到右的顺序写入。如果两个输出指向同一个地方，这一点很重要：该地方将包含最右侧输出的值。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let mut y: i64;
// y 从第二个输出而不是第一个输出获取其值
unsafe { core::arch::asm!("mov {}, 0", "mov {}, 1", out(reg) y, out(reg) y); }
assert_eq!(y, 1);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.operand-type.naked_asm-restriction"><a class="rule-link" href="#r-asm.operand-type.naked_asm-restriction" title="asm.operand-type.naked_asm-restriction"><span>[asm<wbr>.operand-type<wbr>.naked_asm-restriction]</span></a>
</div>

<p>由于 <code>naked_asm!</code> 定义了整个函数体，且编译器无法发出任何额外的代码来处理操作数，因此它只能使用 <code>sym</code> 和 <code>const</code> 操作数。</p>
<div class="rule" id="r-asm.operand-type.global_asm-restriction"><a class="rule-link" href="#r-asm.operand-type.global_asm-restriction" title="asm.operand-type.global_asm-restriction"><span>[asm<wbr>.operand-type<wbr>.global_asm-restriction]</span></a>
</div>

<p>由于 <code>global_asm!</code> 存在于函数之外，它只能使用 <code>sym</code> 和 <code>const</code> 操作数。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">fn main() {}
</span>// 不允许寄存器操作数，因为我们不在函数中
<span class="boring">#[cfg(target_arch = "x86_64")]
</span>core::arch::global_asm!("", in(reg) 5);
// ERROR: the `in` operand cannot be used with `global_asm!`
<span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">fn main() {}
</span>fn foo() {}

<span class="boring">#[cfg(target_arch = "x86_64")]
</span>// 然而，`const` 和 `sym` 都是允许的
core::arch::global_asm!("/* {} {} */", const 0, sym foo);</code></pre>
<div class="rule" id="r-asm.register-operands"><a class="rule-link" href="#r-asm.register-operands" title="asm.register-operands"><span>[asm<wbr>.register-operands]</span></a>
</div>

<h2 id="寄存器操作数"><a class="header" href="#寄存器操作数">寄存器操作数</a></h2>
<div class="rule" id="r-asm.register-operands.register-or-class"><a class="rule-link" href="#r-asm.register-operands.register-or-class" title="asm.register-operands.register-or-class"><span>[asm<wbr>.register-operands<wbr>.register-or-class]</span></a>
</div>

<p>输入和输出操作数既可以指定为显式寄存器，也可以指定为寄存器分配器可以从中选择寄存器的寄存器类。显式寄存器被指定为字符串字面量（例如 <code>"eax"</code>），而寄存器类被指定为标识符（例如 <code>reg</code>）。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let mut y: i64;
// 我们既可以将两者都命名为 `reg`，也可以使用显式寄存器（如 `eax`）来获取一个
// 整数寄存器
unsafe { core::arch::asm!("mov eax, {:e}", in(reg) 5, lateout("eax") y); }
assert_eq!(y, 5);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.register-operands.equivalence-to-base-register"><a class="rule-link" href="#r-asm.register-operands.equivalence-to-base-register" title="asm.register-operands.equivalence-to-base-register"><span>[asm<wbr>.register-operands<wbr>.equivalence-to-base-register]</span></a>
</div>

<p>请注意，显式寄存器将寄存器别名（例如 ARM 上的 <code>r14</code> 与 <code>lr</code>）和寄存器的较小视图（例如 <code>eax</code> 与 <code>rax</code>）视为等同于基本寄存器。</p>
<div class="rule" id="r-asm.register-operands.error-two-operands"><a class="rule-link" href="#r-asm.register-operands.error-two-operands" title="asm.register-operands.error-two-operands"><span>[asm<wbr>.register-operands<wbr>.error-two-operands]</span></a>
</div>

<p>在两个输入操作数或两个输出操作数中使用相同的显式寄存器是一个编译时错误。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// 我们不能两次命名 eax
unsafe { core::arch::asm!("", in("eax") 5, in("eax") 4); }
// ERROR: register `eax` conflicts with register `eax`
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// ... 即使使用不同的别名
unsafe { core::arch::asm!("", in("ax") 5, in("rax") 4); }
// ERROR: register `rax` conflicts with register `ax`
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.register-operands.error-overlapping"><a class="rule-link" href="#r-asm.register-operands.error-overlapping" title="asm.register-operands.error-overlapping"><span>[asm<wbr>.register-operands<wbr>.error-overlapping]</span></a>
</div>

<p>此外，在输入操作数或输出操作数中使用重叠的寄存器（例如 ARM VFP）也是一个编译时错误。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// al 与 ax 重叠，所以我们不能同时命名它们。
unsafe { core::arch::asm!("", in("ax") 5, in("al") 4i8); }
// ERROR: register `al` conflicts with register `ax`
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.register-operands.allowed-types"><a class="rule-link" href="#r-asm.register-operands.allowed-types" title="asm.register-operands.allowed-types"><span>[asm<wbr>.register-operands<wbr>.allowed-types]</span></a>
</div>

<p>内联汇编仅允许使用以下类型作为操作数：</p>
<ul>
<li>整数（有符号和无符号）</li>
<li>浮点数</li>
<li>指针（仅瘦指针）</li>
<li>函数指针</li>
<li>SIMD 向量（使用 <code>#[repr(simd)]</code> 定义且实现了 <code>Copy</code> 的结构体）。这包括在 <code>std::arch</code> 中定义的特定架构向量类型，如 <code>__m128</code> (x86) 或 <code>int8x16_t</code> (ARM)。</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>extern "C" fn foo() {}

// 允许整数...
let y: i64 = 5;
unsafe { core::arch::asm!("/* {} */", in(reg) y); }

// 以及指针...
let py = &amp;raw const y;
unsafe { core::arch::asm!("/* {} */", in(reg) py); }

// 还有浮点数...
let f = 1.0f32;
unsafe { core::arch::asm!("/* {} */", in(xmm_reg) f); }

// 甚至是函数指针和 simd 向量。
let func: extern "C" fn() = foo;
unsafe { core::arch::asm!("/* {} */", in(reg) func); }

let z = unsafe { core::arch::x86_64::_mm_set_epi64x(1, 0) };
unsafe { core::arch::asm!("/* {} */", in(xmm_reg) z); }
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>struct Foo;
let x: Foo = Foo;
// 不允许像结构体这样的复杂类型
unsafe { core::arch::asm!("/* {} */", in(reg) x); }
// ERROR: cannot use value of type `Foo` for inline assembly
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.register-operands.supported-register-classes"><a class="rule-link" href="#r-asm.register-operands.supported-register-classes" title="asm.register-operands.supported-register-classes"><span>[asm<wbr>.register-operands<wbr>.supported-register-classes]</span></a>
</div>

<p>以下是当前受支持的寄存器类列表：</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>架构</th><th>寄存器类</th><th>寄存器</th><th>LLVM 约束代码</th></tr>
</thead>
<tbody>
<tr><td>x86</td><td><code>reg</code></td><td><code>ax</code>, <code>bx</code>, <code>cx</code>, <code>dx</code>, <code>si</code>, <code>di</code>, <code>bp</code>, <code>r[8-15]</code> (仅限 x86-64)</td><td><code>r</code></td></tr>
<tr><td>x86</td><td><code>reg_abcd</code></td><td><code>ax</code>, <code>bx</code>, <code>cx</code>, <code>dx</code></td><td><code>Q</code></td></tr>
<tr><td>x86-32</td><td><code>reg_byte</code></td><td><code>al</code>, <code>bl</code>, <code>cl</code>, <code>dl</code>, <code>ah</code>, <code>bh</code>, <code>ch</code>, <code>dh</code></td><td><code>q</code></td></tr>
<tr><td>x86-64</td><td><code>reg_byte</code>*</td><td><code>al</code>, <code>bl</code>, <code>cl</code>, <code>dl</code>, <code>sil</code>, <code>dil</code>, <code>bpl</code>, <code>r[8-15]b</code></td><td><code>q</code></td></tr>
<tr><td>x86</td><td><code>xmm_reg</code></td><td><code>xmm[0-7]</code> (x86) <code>xmm[0-15]</code> (x86-64)</td><td><code>x</code></td></tr>
<tr><td>x86</td><td><code>ymm_reg</code></td><td><code>ymm[0-7]</code> (x86) <code>ymm[0-15]</code> (x86-64)</td><td><code>x</code></td></tr>
<tr><td>x86</td><td><code>zmm_reg</code></td><td><code>zmm[0-7]</code> (x86) <code>zmm[0-31]</code> (x86-64)</td><td><code>v</code></td></tr>
<tr><td>x86</td><td><code>kreg</code></td><td><code>k[1-7]</code></td><td><code>Yk</code></td></tr>
<tr><td>x86</td><td><code>kreg0</code></td><td><code>k0</code></td><td>仅限破坏列表</td></tr>
<tr><td>x86</td><td><code>x87_reg</code></td><td><code>st([0-7])</code></td><td>仅限破坏列表</td></tr>
<tr><td>x86</td><td><code>mmx_reg</code></td><td><code>mm[0-7]</code></td><td>仅限破坏列表</td></tr>
<tr><td>x86-64</td><td><code>tmm_reg</code></td><td><code>tmm[0-7]</code></td><td>仅限破坏列表</td></tr>
<tr><td>AArch64</td><td><code>reg</code></td><td><code>x[0-30]</code></td><td><code>r</code></td></tr>
<tr><td>AArch64</td><td><code>vreg</code></td><td><code>v[0-31]</code></td><td><code>w</code></td></tr>
<tr><td>AArch64</td><td><code>vreg_low16</code></td><td><code>v[0-15]</code></td><td><code>x</code></td></tr>
<tr><td>AArch64</td><td><code>preg</code></td><td><code>p[0-15]</code>, <code>ffr</code></td><td>仅限破坏列表</td></tr>
<tr><td>Arm64EC</td><td><code>reg</code></td><td><code>x[0-12]</code>, <code>x[15-22]</code>, <code>x[25-27]</code>, <code>x30</code></td><td><code>r</code></td></tr>
<tr><td>Arm64EC</td><td><code>vreg</code></td><td><code>v[0-15]</code></td><td><code>w</code></td></tr>
<tr><td>Arm64EC</td><td><code>vreg_low16</code></td><td><code>v[0-15]</code></td><td><code>x</code></td></tr>
<tr><td>ARM (ARM/Thumb2)</td><td><code>reg</code></td><td><code>r[0-12]</code>, <code>r14</code></td><td><code>r</code></td></tr>
<tr><td>ARM (Thumb1)</td><td><code>reg</code></td><td><code>r[0-7]</code></td><td><code>r</code></td></tr>
<tr><td>ARM</td><td><code>sreg</code></td><td><code>s[0-31]</code></td><td><code>t</code></td></tr>
<tr><td>ARM</td><td><code>sreg_low16</code></td><td><code>s[0-15]</code></td><td><code>x</code></td></tr>
<tr><td>ARM</td><td><code>dreg</code></td><td><code>d[0-31]</code></td><td><code>w</code></td></tr>
<tr><td>ARM</td><td><code>dreg_low16</code></td><td><code>d[0-15]</code></td><td><code>t</code></td></tr>
<tr><td>ARM</td><td><code>dreg_low8</code></td><td><code>d[0-8]</code></td><td><code>x</code></td></tr>
<tr><td>ARM</td><td><code>qreg</code></td><td><code>q[0-15]</code></td><td><code>w</code></td></tr>
<tr><td>ARM</td><td><code>qreg_low8</code></td><td><code>q[0-7]</code></td><td><code>t</code></td></tr>
<tr><td>ARM</td><td><code>qreg_low4</code></td><td><code>q[0-3]</code></td><td><code>x</code></td></tr>
<tr><td>RISC-V</td><td><code>reg</code></td><td><code>x1</code>, <code>x[5-7]</code>, <code>x[9-15]</code>, <code>x[16-31]</code> (非 RV32E)</td><td><code>r</code></td></tr>
<tr><td>RISC-V</td><td><code>freg</code></td><td><code>f[0-31]</code></td><td><code>f</code></td></tr>
<tr><td>RISC-V</td><td><code>vreg</code></td><td><code>v[0-31]</code></td><td>仅限破坏列表</td></tr>
<tr><td>LoongArch</td><td><code>reg</code></td><td><code>$r1</code>, <code>$r[4-20]</code>, <code>$r[23,30]</code></td><td><code>r</code></td></tr>
<tr><td>LoongArch</td><td><code>freg</code></td><td><code>$f[0-31]</code></td><td><code>f</code></td></tr>
<tr><td>s390x</td><td><code>reg</code></td><td><code>r[0-10]</code>, <code>r[12-14]</code></td><td><code>r</code></td></tr>
<tr><td>s390x</td><td><code>reg_addr</code></td><td><code>r[1-10]</code>, <code>r[12-14]</code></td><td><code>a</code></td></tr>
<tr><td>s390x</td><td><code>freg</code></td><td><code>f[0-15]</code></td><td><code>f</code></td></tr>
<tr><td>s390x</td><td><code>vreg</code></td><td><code>v[0-31]</code></td><td>仅限破坏列表</td></tr>
<tr><td>s390x</td><td><code>areg</code></td><td><code>a[2-15]</code></td><td>仅限破坏列表</td></tr>
</tbody>
</table>
</div>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<ul>
<li>在 x86 上，我们将 <code>reg_byte</code> 与 <code>reg</code> 区别对待，因为编译器可以分别分配 <code>al</code> 和 <code>ah</code>，而 <code>reg</code> 会保留整个寄存器。</li>
<li>在 x86-64 上，高字节寄存器（例如 <code>ah</code>）在 <code>reg_byte</code> 寄存器类中不可用。</li>
<li>一些寄存器类被标记为 “仅限破坏列表” ，这意味着这些类中的寄存器不能用于输入或输出，只能用于 <code>out(&lt;explicit register&gt;) _</code> 或 <code>lateout(&lt;explicit register&gt;) _</code> 形式的破坏列表。</li>
</ul>
</blockquote>
</div>

<div class="rule" id="r-asm.register-operands.value-type-constraints"><a class="rule-link" href="#r-asm.register-operands.value-type-constraints" title="asm.register-operands.value-type-constraints"><span>[asm<wbr>.register-operands<wbr>.value-type-constraints]</span></a>
</div>

<p>每个寄存器类对其可以使用的值类型都有约束。这是必要的，因为将值加载到寄存器的方式取决于其类型。例如，在大端系统上，将 <code>i32x4</code> 和 <code>i8x16</code> 加载到 SIMD 寄存器中可能会导致不同的寄存器内容，即使这两个值的按字节内存表示是相同的。特定寄存器类可用支持类型的可用性可能取决于当前启用了哪些 target 特性。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>架构</th><th>寄存器类</th><th>target 特性</th><th>允许的类型</th></tr>
</thead>
<tbody>
<tr><td>x86-32</td><td><code>reg</code></td><td>None</td><td><code>i16</code>, <code>i32</code>, <code>f32</code></td></tr>
<tr><td>x86-64</td><td><code>reg</code></td><td>None</td><td><code>i16</code>, <code>i32</code>, <code>f32</code>, <code>i64</code>, <code>f64</code></td></tr>
<tr><td>x86</td><td><code>reg_byte</code></td><td>None</td><td><code>i8</code></td></tr>
<tr><td>x86</td><td><code>xmm_reg</code></td><td><code>sse</code></td><td><code>i32</code>, <code>f32</code>, <code>i64</code>, <code>f64</code>, <br> <code>i8x16</code>, <code>i16x8</code>, <code>i32x4</code>, <code>i64x2</code>, <code>f32x4</code>, <code>f64x2</code></td></tr>
<tr><td>x86</td><td><code>ymm_reg</code></td><td><code>avx</code></td><td><code>i32</code>, <code>f32</code>, <code>i64</code>, <code>f64</code>, <br> <code>i8x16</code>, <code>i16x8</code>, <code>i32x4</code>, <code>i64x2</code>, <code>f32x4</code>, <code>f64x2</code> <br> <code>i8x32</code>, <code>i16x16</code>, <code>i32x8</code>, <code>i64x4</code>, <code>f32x8</code>, <code>f64x4</code></td></tr>
<tr><td>x86</td><td><code>zmm_reg</code></td><td><code>avx512f</code></td><td><code>i32</code>, <code>f32</code>, <code>i64</code>, <code>f64</code>, <br> <code>i8x16</code>, <code>i16x8</code>, <code>i32x4</code>, <code>i64x2</code>, <code>f32x4</code>, <code>f64x2</code> <br> <code>i8x32</code>, <code>i16x16</code>, <code>i32x8</code>, <code>i64x4</code>, <code>f32x8</code>, <code>f64x4</code> <br> <code>i8x64</code>, <code>i16x32</code>, <code>i32x16</code>, <code>i64x8</code>, <code>f32x16</code>, <code>f64x8</code></td></tr>
<tr><td>x86</td><td><code>kreg</code></td><td><code>avx512f</code></td><td><code>i8</code>, <code>i16</code></td></tr>
<tr><td>x86</td><td><code>kreg</code></td><td><code>avx512bw</code></td><td><code>i32</code>, <code>i64</code></td></tr>
<tr><td>x86</td><td><code>mmx_reg</code></td><td>N/A</td><td>仅限破坏列表</td></tr>
<tr><td>x86</td><td><code>x87_reg</code></td><td>N/A</td><td>仅限破坏列表</td></tr>
<tr><td>x86</td><td><code>tmm_reg</code></td><td>N/A</td><td>仅限破坏列表</td></tr>
<tr><td>AArch64</td><td><code>reg</code></td><td>None</td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>f32</code>, <code>i64</code>, <code>f64</code></td></tr>
<tr><td>AArch64</td><td><code>vreg</code></td><td><code>neon</code></td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>f32</code>, <code>i64</code>, <code>f64</code>, <br> <code>i8x8</code>, <code>i16x4</code>, <code>i32x2</code>, <code>i64x1</code>, <code>f32x2</code>, <code>f64x1</code>, <br> <code>i8x16</code>, <code>i16x8</code>, <code>i32x4</code>, <code>i64x2</code>, <code>f32x4</code>, <code>f64x2</code></td></tr>
<tr><td>AArch64</td><td><code>preg</code></td><td>N/A</td><td>仅限破坏列表</td></tr>
<tr><td>Arm64EC</td><td><code>reg</code></td><td>None</td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>f32</code>, <code>i64</code>, <code>f64</code></td></tr>
<tr><td>Arm64EC</td><td><code>vreg</code></td><td><code>neon</code></td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>f32</code>, <code>i64</code>, <code>f64</code>, <br> <code>i8x8</code>, <code>i16x4</code>, <code>i32x2</code>, <code>i64x1</code>, <code>f32x2</code>, <code>f64x1</code>, <br> <code>i8x16</code>, <code>i16x8</code>, <code>i32x4</code>, <code>i64x2</code>, <code>f32x4</code>, <code>f64x2</code></td></tr>
<tr><td>ARM</td><td><code>reg</code></td><td>None</td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>f32</code></td></tr>
<tr><td>ARM</td><td><code>sreg</code></td><td><code>vfp2</code></td><td><code>i32</code>, <code>f32</code></td></tr>
<tr><td>ARM</td><td><code>dreg</code></td><td><code>vfp2</code></td><td><code>i64</code>, <code>f64</code>, <code>i8x8</code>, <code>i16x4</code>, <code>i32x2</code>, <code>i64x1</code>, <code>f32x2</code></td></tr>
<tr><td>ARM</td><td><code>qreg</code></td><td><code>neon</code></td><td><code>i8x16</code>, <code>i16x8</code>, <code>i32x4</code>, <code>i64x2</code>, <code>f32x4</code></td></tr>
<tr><td>RISC-V32</td><td><code>reg</code></td><td>None</td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>f32</code></td></tr>
<tr><td>RISC-V64</td><td><code>reg</code></td><td>None</td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>f32</code>, <code>i64</code>, <code>f64</code></td></tr>
<tr><td>RISC-V</td><td><code>freg</code></td><td><code>f</code></td><td><code>f32</code></td></tr>
<tr><td>RISC-V</td><td><code>freg</code></td><td><code>d</code></td><td><code>f64</code></td></tr>
<tr><td>RISC-V</td><td><code>vreg</code></td><td>N/A</td><td>仅限破坏列表</td></tr>
<tr><td>LoongArch32</td><td><code>reg</code></td><td>None</td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>f32</code></td></tr>
<tr><td>LoongArch64</td><td><code>reg</code></td><td>None</td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>i64</code>, <code>f32</code>, <code>f64</code></td></tr>
<tr><td>LoongArch</td><td><code>freg</code></td><td><code>f</code></td><td><code>f32</code></td></tr>
<tr><td>LoongArch</td><td><code>freg</code></td><td><code>d</code></td><td><code>f64</code></td></tr>
<tr><td>s390x</td><td><code>reg</code>, <code>reg_addr</code></td><td>None</td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>i64</code></td></tr>
<tr><td>s390x</td><td><code>freg</code></td><td>None</td><td><code>f32</code>, <code>f64</code></td></tr>
<tr><td>s390x</td><td><code>vreg</code></td><td>N/A</td><td>仅限破坏列表</td></tr>
<tr><td>s390x</td><td><code>areg</code></td><td>N/A</td><td>仅限破坏列表</td></tr>
</tbody>
</table>
</div>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>就上表而言，指针、函数指针和 <code>isize</code>/<code>usize</code> 被视为等效的整数类型（取决于 target，为 <code>i16</code>/<code>i32</code>/<code>i64</code>）。</p>
</blockquote>
</div>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x = 5i32;
let y = -1i8;
let z = unsafe { core::arch::x86_64::_mm_set_epi64x(1, 0) };

// reg 对 `i32` 有效，reg_byte 对 `i8` 有效，而 xmm_reg 对 `__m128i` 有效
// 我们不能使用 `tmm0` 作为输入或输出，但我们可以将其加入破坏列表。
unsafe { core::arch::asm!("/* {} {} {} */", in(reg) x, in(reg_byte) y, in(xmm_reg) z, out("tmm0") _); }
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let z = unsafe { core::arch::x86_64::_mm_set_epi64x(1, 0) };
// 我们不能将 `__m128i` 传递给 `reg` 输入
unsafe { core::arch::asm!("/* {} */", in(reg) z); }
// ERROR: type `__m128i` cannot be used with this register class
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.register-operands.smaller-value"><a class="rule-link" href="#r-asm.register-operands.smaller-value" title="asm.register-operands.smaller-value"><span>[asm<wbr>.register-operands<wbr>.smaller-value]</span></a>
</div>

<p>如果值的大小小于它所分配到的寄存器的大小，那么该寄存器的高位对于输入将具有未定义的值，而对于输出将被忽略。唯一的例外是 RISC-V 上的 <code>freg</code> 寄存器类，其中 <code>f32</code> 值按照 RISC-V 架构的要求被 NaN 装箱（NaN-boxed）在 <code>f64</code> 中。</p>
<!--no_run, this test has a non-deterministic runtime behavior-->
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let mut x: i64;
// 将 32 位值移动到 64 位值中，哎呀。
#[allow(asm_sub_register)] // rustc 对此行为发出警告
unsafe { core::arch::asm!("mov {}, {}", lateout(reg) x, in(reg) 4i32); }
// 高 32 位是不确定的
assert_eq!(x, 4); // 不保证此断言成功
assert_eq!(x &amp; 0xFFFFFFFF, 4); // 但是，这个断言会成功
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.register-operands.separate-input-output"><a class="rule-link" href="#r-asm.register-operands.separate-input-output" title="asm.register-operands.separate-input-output"><span>[asm<wbr>.register-operands<wbr>.separate-input-output]</span></a>
</div>

<p>当为 <code>inout</code> 操作数指定单独的输入和输出表达式时，两个表达式必须具有相同的类型。唯一的例外是如果两个操作数都是指针或整数，在这种情况下，它们仅要求具有相同的大小。存在此限制是因为 LLVM 和 GCC 中的寄存器分配器有时无法处理具有不同类型的绑定操作数。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// 指针和整数可以混用（只要它们大小相同）
let x: isize = 0;
let y: *mut ();
// 使用内联汇编魔术将 `isize` 转换为 `*mut ()`
unsafe { core::arch::asm!("/*{}*/", inout(reg) x=&gt;y); }
assert!(y.is_null()); // 一种极其曲折的创建空指针的方法
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i32 = 0;
let y: f32;
// 但我们不能像这样将 `i32` 重新解释为 `f32`
unsafe { core::arch::asm!("/* {} */", inout(reg) x=&gt;y); }
// ERROR: incompatible types for asm inout argument
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.register-names"><a class="rule-link" href="#r-asm.register-names" title="asm.register-names"><span>[asm<wbr>.register-names]</span></a>
</div>

<h2 id="寄存器名称"><a class="header" href="#寄存器名称">寄存器名称</a></h2>
<div class="rule" id="r-asm.register-names.supported-register-aliases"><a class="rule-link" href="#r-asm.register-names.supported-register-aliases" title="asm.register-names.supported-register-aliases"><span>[asm<wbr>.register-names<wbr>.supported-register-aliases]</span></a>
</div>

<p>有些寄存器有多个名称。编译器将这些名称都视为与基本寄存器名称相同。以下是所有受支持的寄存器别名列表：</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>架构</th><th>基本寄存器</th><th>别名</th></tr>
</thead>
<tbody>
<tr><td>x86</td><td><code>ax</code></td><td><code>eax</code>, <code>rax</code></td></tr>
<tr><td>x86</td><td><code>bx</code></td><td><code>ebx</code>, <code>rbx</code></td></tr>
<tr><td>x86</td><td><code>cx</code></td><td><code>ecx</code>, <code>rcx</code></td></tr>
<tr><td>x86</td><td><code>dx</code></td><td><code>edx</code>, <code>rdx</code></td></tr>
<tr><td>x86</td><td><code>si</code></td><td><code>esi</code>, <code>rsi</code></td></tr>
<tr><td>x86</td><td><code>di</code></td><td><code>edi</code>, <code>rdi</code></td></tr>
<tr><td>x86</td><td><code>bp</code></td><td><code>bpl</code>, <code>ebp</code>, <code>rbp</code></td></tr>
<tr><td>x86</td><td><code>sp</code></td><td><code>spl</code>, <code>esp</code>, <code>rsp</code></td></tr>
<tr><td>x86</td><td><code>ip</code></td><td><code>eip</code>, <code>rip</code></td></tr>
<tr><td>x86</td><td><code>st(0)</code></td><td><code>st</code></td></tr>
<tr><td>x86</td><td><code>r[8-15]</code></td><td><code>r[8-15]b</code>, <code>r[8-15]w</code>, <code>r[8-15]d</code></td></tr>
<tr><td>x86</td><td><code>xmm[0-31]</code></td><td><code>ymm[0-31]</code>, <code>zmm[0-31]</code></td></tr>
<tr><td>AArch64</td><td><code>x[0-30]</code></td><td><code>w[0-30]</code></td></tr>
<tr><td>AArch64</td><td><code>x29</code></td><td><code>fp</code></td></tr>
<tr><td>AArch64</td><td><code>x30</code></td><td><code>lr</code></td></tr>
<tr><td>AArch64</td><td><code>sp</code></td><td><code>wsp</code></td></tr>
<tr><td>AArch64</td><td><code>xzr</code></td><td><code>wzr</code></td></tr>
<tr><td>AArch64</td><td><code>v[0-31]</code></td><td><code>b[0-31]</code>, <code>h[0-31]</code>, <code>s[0-31]</code>, <code>d[0-31]</code>, <code>q[0-31]</code></td></tr>
<tr><td>Arm64EC</td><td><code>x[0-30]</code></td><td><code>w[0-30]</code></td></tr>
<tr><td>Arm64EC</td><td><code>x29</code></td><td><code>fp</code></td></tr>
<tr><td>Arm64EC</td><td><code>x30</code></td><td><code>lr</code></td></tr>
<tr><td>Arm64EC</td><td><code>sp</code></td><td><code>wsp</code></td></tr>
<tr><td>Arm64EC</td><td><code>xzr</code></td><td><code>wzr</code></td></tr>
<tr><td>Arm64EC</td><td><code>v[0-15]</code></td><td><code>b[0-15]</code>, <code>h[0-15]</code>, <code>s[0-15]</code>, <code>d[0-15]</code>, <code>q[0-15]</code></td></tr>
<tr><td>ARM</td><td><code>r[0-3]</code></td><td><code>a[1-4]</code></td></tr>
<tr><td>ARM</td><td><code>r[4-9]</code></td><td><code>v[1-6]</code></td></tr>
<tr><td>ARM</td><td><code>r9</code></td><td><code>rfp</code></td></tr>
<tr><td>ARM</td><td><code>r10</code></td><td><code>sl</code></td></tr>
<tr><td>ARM</td><td><code>r11</code></td><td><code>fp</code></td></tr>
<tr><td>ARM</td><td><code>r12</code></td><td><code>ip</code></td></tr>
<tr><td>ARM</td><td><code>r13</code></td><td><code>sp</code></td></tr>
<tr><td>ARM</td><td><code>r14</code></td><td><code>lr</code></td></tr>
<tr><td>ARM</td><td><code>r15</code></td><td><code>pc</code></td></tr>
<tr><td>RISC-V</td><td><code>x0</code></td><td><code>zero</code></td></tr>
<tr><td>RISC-V</td><td><code>x1</code></td><td><code>ra</code></td></tr>
<tr><td>RISC-V</td><td><code>x2</code></td><td><code>sp</code></td></tr>
<tr><td>RISC-V</td><td><code>x3</code></td><td><code>gp</code></td></tr>
<tr><td>RISC-V</td><td><code>x4</code></td><td><code>tp</code></td></tr>
<tr><td>RISC-V</td><td><code>x[5-7]</code></td><td><code>t[0-2]</code></td></tr>
<tr><td>RISC-V</td><td><code>x8</code></td><td><code>fp</code>, <code>s0</code></td></tr>
<tr><td>RISC-V</td><td><code>x9</code></td><td><code>s1</code></td></tr>
<tr><td>RISC-V</td><td><code>x[10-17]</code></td><td><code>a[0-7]</code></td></tr>
<tr><td>RISC-V</td><td><code>x[18-27]</code></td><td><code>s[2-11]</code></td></tr>
<tr><td>RISC-V</td><td><code>x[28-31]</code></td><td><code>t[3-6]</code></td></tr>
<tr><td>RISC-V</td><td><code>f[0-7]</code></td><td><code>ft[0-7]</code></td></tr>
<tr><td>RISC-V</td><td><code>f[8-9]</code></td><td><code>fs[0-1]</code></td></tr>
<tr><td>RISC-V</td><td><code>f[10-17]</code></td><td><code>fa[0-7]</code></td></tr>
<tr><td>RISC-V</td><td><code>f[18-27]</code></td><td><code>fs[2-11]</code></td></tr>
<tr><td>RISC-V</td><td><code>f[28-31]</code></td><td><code>ft[8-11]</code></td></tr>
<tr><td>LoongArch</td><td><code>$r0</code></td><td><code>$zero</code></td></tr>
<tr><td>LoongArch</td><td><code>$r1</code></td><td><code>$ra</code></td></tr>
<tr><td>LoongArch</td><td><code>$r2</code></td><td><code>$tp</code></td></tr>
<tr><td>LoongArch</td><td><code>$r3</code></td><td><code>$sp</code></td></tr>
<tr><td>LoongArch</td><td><code>$r[4-11]</code></td><td><code>$a[0-7]</code></td></tr>
<tr><td>LoongArch</td><td><code>$r[12-20]</code></td><td><code>$t[0-8]</code></td></tr>
<tr><td>LoongArch</td><td><code>$r21</code></td><td></td></tr>
<tr><td>LoongArch</td><td><code>$r22</code></td><td><code>$fp</code>, <code>$s9</code></td></tr>
<tr><td>LoongArch</td><td><code>$r[23-31]</code></td><td><code>$s[0-8]</code></td></tr>
<tr><td>LoongArch</td><td><code>$f[0-7]</code></td><td><code>$fa[0-7]</code></td></tr>
<tr><td>LoongArch</td><td><code>$f[8-23]</code></td><td><code>$ft[0-15]</code></td></tr>
<tr><td>LoongArch</td><td><code>$f[24-31]</code></td><td><code>$fs[0-7]</code></td></tr>
</tbody>
</table>
</div>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let z = 0i64;
// rax 是 eax 和 ax 的别名
unsafe { core::arch::asm!("", in("rax") z); }
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.register-names.not-for-io"><a class="rule-link" href="#r-asm.register-names.not-for-io" title="asm.register-names.not-for-io"><span>[asm<wbr>.register-names<wbr>.not-for-io]</span></a>
</div>

<p>某些寄存器不能用于输入或输出操作数：</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>架构</th><th>不受支持的寄存器</th><th>原因</th></tr>
</thead>
<tbody>
<tr><td>All</td><td><code>sp</code>, <code>r15</code> (s390x)</td><td>栈指针必须在汇编代码结束时或跳转到 <code>label</code> 块之前恢复其原始值。</td></tr>
<tr><td>All</td><td><code>bp</code> (x86), <code>x29</code> (AArch64 和 Arm64EC), <code>x8</code> (RISC-V), <code>$fp</code> (LoongArch), <code>r11</code> (s390x)</td><td>帧指针不能用作输入或输出。</td></tr>
<tr><td>ARM</td><td><code>r7</code> 或 <code>r11</code></td><td>在 ARM 上，帧指针可以是 <code>r7</code> 或 <code>r11</code>，具体取决于 target。帧指针不能用作输入或输出。</td></tr>
<tr><td>All</td><td><code>si</code> (x86-32), <code>bx</code> (x86-64), <code>r6</code> (ARM), <code>x19</code> (AArch64 和 Arm64EC), <code>x9</code> (RISC-V), <code>$s8</code> (LoongArch)</td><td>LLVM 内部将其用作具有复杂栈帧的函数的 “base pointer” 。</td></tr>
<tr><td>x86</td><td><code>ip</code></td><td>这是程序计数器，不是真实的寄存器。</td></tr>
<tr><td>AArch64</td><td><code>xzr</code></td><td>这是一个常量零寄存器，无法修改。</td></tr>
<tr><td>AArch64</td><td><code>x18</code></td><td>在某些 AArch64 target 上，这是操作系统保留的寄存器。</td></tr>
<tr><td>Arm64EC</td><td><code>xzr</code></td><td>这是一个常量零寄存器，无法修改。</td></tr>
<tr><td>Arm64EC</td><td><code>x18</code></td><td>这是一个操作系统保留的寄存器。</td></tr>
<tr><td>Arm64EC</td><td><code>x13</code>, <code>x14</code>, <code>x23</code>, <code>x24</code>, <code>x28</code>, <code>v[16-31]</code>, <code>p[0-15]</code>, <code>ffr</code></td><td>这些是 Arm64EC 不支持的 AArch64 寄存器。</td></tr>
<tr><td>ARM</td><td><code>pc</code></td><td>这是程序计数器，不是真实的寄存器。</td></tr>
<tr><td>ARM</td><td><code>r9</code></td><td>在某些 ARM target 上，这是操作系统保留的寄存器。</td></tr>
<tr><td>RISC-V</td><td><code>x0</code></td><td>这是一个常量零寄存器，无法修改。</td></tr>
<tr><td>RISC-V</td><td><code>gp</code>, <code>tp</code></td><td>这些寄存器是保留的，不能用作输入或输出。</td></tr>
<tr><td>LoongArch</td><td><code>$r0</code> 或 <code>$zero</code></td><td>这是一个常量零寄存器，无法修改。</td></tr>
<tr><td>LoongArch</td><td><code>$r2</code> 或 <code>$tp</code></td><td>这是为 TLS 保留的。</td></tr>
<tr><td>LoongArch</td><td><code>$r21</code></td><td>这是由 ABI 保留的。</td></tr>
<tr><td>s390x</td><td><code>c[0-15]</code></td><td>由内核保留。</td></tr>
<tr><td>s390x</td><td><code>a[0-1]</code></td><td>保留供系统使用。</td></tr>
</tbody>
</table>
</div>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// bp 是保留的
unsafe { core::arch::asm!("", in("bp") 5i32); }
// ERROR: invalid register `bp`: the frame pointer cannot be used as an operand for inline asm
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.register-names.fp-bp-reserved"><a class="rule-link" href="#r-asm.register-names.fp-bp-reserved" title="asm.register-names.fp-bp-reserved"><span>[asm<wbr>.register-names<wbr>.fp-bp-reserved]</span></a>
</div>

<p>帧指针和基指针寄存器保留供 LLVM 内部使用。虽然 <code>asm!</code> 语句不能显式指定使用保留寄存器，但在某些情况下，LLVM 会为 <code>reg</code> 操作数分配这些保留寄存器之一。使用保留寄存器的汇编代码应当小心，因为 <code>reg</code> 操作数可能会使用相同的寄存器。</p>
<div class="rule" id="r-asm.template-modifiers"><a class="rule-link" href="#r-asm.template-modifiers" title="asm.template-modifiers"><span>[asm<wbr>.template-modifiers]</span></a>
</div>

<h2 id="模板修饰符"><a class="header" href="#模板修饰符">模板修饰符</a></h2>
<div class="rule" id="r-asm.template-modifiers.intro"><a class="rule-link" href="#r-asm.template-modifiers.intro" title="asm.template-modifiers.intro"><span>[asm<wbr>.template-modifiers<wbr>.intro]</span></a>
</div>

<p>占位符可以通过修饰符进行增强，修饰符在花括号中的 <code>:</code> 之后指定。这些修饰符不影响寄存器分配，但会改变操作数在插入模板字符串时的格式化方式。</p>
<div class="rule" id="r-asm.template-modifiers.only-one"><a class="rule-link" href="#r-asm.template-modifiers.only-one" title="asm.template-modifiers.only-one"><span>[asm<wbr>.template-modifiers<wbr>.only-one]</span></a>
</div>

<p>每个模板占位符仅允许使用一个修饰符。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// 我们不能同时指定 `r` 和 `e`。
unsafe { core::arch::asm!("/* {:er}", in(reg) 5i32); }
// ERROR: asm template modifier must be a single character
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.template-modifiers.supported-modifiers"><a class="rule-link" href="#r-asm.template-modifiers.supported-modifiers" title="asm.template-modifiers.supported-modifiers"><span>[asm<wbr>.template-modifiers<wbr>.supported-modifiers]</span></a>
</div>

<p>支持的修饰符是 LLVM（和 GCC）<a href="http://llvm.org/docs/LangRef.html#asm-template-argument-modifiers">汇编模板参数修饰符</a> 的子集，但不使用相同的字母代码。</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>架构</th><th>寄存器类</th><th>修饰符</th><th>示例输出</th><th>LLVM 修饰符</th></tr>
</thead>
<tbody>
<tr><td>x86-32</td><td><code>reg</code></td><td>None</td><td><code>eax</code></td><td><code>k</code></td></tr>
<tr><td>x86-64</td><td><code>reg</code></td><td>None</td><td><code>rax</code></td><td><code>q</code></td></tr>
<tr><td>x86-32</td><td><code>reg_abcd</code></td><td><code>l</code></td><td><code>al</code></td><td><code>b</code></td></tr>
<tr><td>x86-64</td><td><code>reg</code></td><td><code>l</code></td><td><code>al</code></td><td><code>b</code></td></tr>
<tr><td>x86</td><td><code>reg_abcd</code></td><td><code>h</code></td><td><code>ah</code></td><td><code>h</code></td></tr>
<tr><td>x86</td><td><code>reg</code></td><td><code>x</code></td><td><code>ax</code></td><td><code>w</code></td></tr>
<tr><td>x86</td><td><code>reg</code></td><td><code>e</code></td><td><code>eax</code></td><td><code>k</code></td></tr>
<tr><td>x86-64</td><td><code>reg</code></td><td><code>r</code></td><td><code>rax</code></td><td><code>q</code></td></tr>
<tr><td>x86</td><td><code>reg_byte</code></td><td>None</td><td><code>al</code> / <code>ah</code></td><td>None</td></tr>
<tr><td>x86</td><td><code>xmm_reg</code></td><td>None</td><td><code>xmm0</code></td><td><code>x</code></td></tr>
<tr><td>x86</td><td><code>ymm_reg</code></td><td>None</td><td><code>ymm0</code></td><td><code>t</code></td></tr>
<tr><td>x86</td><td><code>zmm_reg</code></td><td>None</td><td><code>zmm0</code></td><td><code>g</code></td></tr>
<tr><td>x86</td><td><code>*mm_reg</code></td><td><code>x</code></td><td><code>xmm0</code></td><td><code>x</code></td></tr>
<tr><td>x86</td><td><code>*mm_reg</code></td><td><code>y</code></td><td><code>ymm0</code></td><td><code>t</code></td></tr>
<tr><td>x86</td><td><code>*mm_reg</code></td><td><code>z</code></td><td><code>zmm0</code></td><td><code>g</code></td></tr>
<tr><td>x86</td><td><code>kreg</code></td><td>None</td><td><code>k1</code></td><td>None</td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>reg</code></td><td>None</td><td><code>x0</code></td><td><code>x</code></td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>reg</code></td><td><code>w</code></td><td><code>w0</code></td><td><code>w</code></td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>reg</code></td><td><code>x</code></td><td><code>x0</code></td><td><code>x</code></td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>vreg</code></td><td>None</td><td><code>v0</code></td><td>None</td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>vreg</code></td><td><code>v</code></td><td><code>v0</code></td><td>None</td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>vreg</code></td><td><code>b</code></td><td><code>b0</code></td><td><code>b</code></td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>vreg</code></td><td><code>h</code></td><td><code>h0</code></td><td><code>h</code></td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>vreg</code></td><td><code>s</code></td><td><code>s0</code></td><td><code>s</code></td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>vreg</code></td><td><code>d</code></td><td><code>d0</code></td><td><code>d</code></td></tr>
<tr><td>AArch64/Arm64EC</td><td><code>vreg</code></td><td><code>q</code></td><td><code>q0</code></td><td><code>q</code></td></tr>
<tr><td>ARM</td><td><code>reg</code></td><td>None</td><td><code>r0</code></td><td>None</td></tr>
<tr><td>ARM</td><td><code>sreg</code></td><td>None</td><td><code>s0</code></td><td>None</td></tr>
<tr><td>ARM</td><td><code>dreg</code></td><td>None</td><td><code>d0</code></td><td><code>P</code></td></tr>
<tr><td>ARM</td><td><code>qreg</code></td><td>None</td><td><code>q0</code></td><td><code>q</code></td></tr>
<tr><td>ARM</td><td><code>qreg</code></td><td><code>e</code> / <code>f</code></td><td><code>d0</code> / <code>d1</code></td><td><code>e</code> / <code>f</code></td></tr>
<tr><td>RISC-V</td><td><code>reg</code></td><td>None</td><td><code>x1</code></td><td>None</td></tr>
<tr><td>RISC-V</td><td><code>freg</code></td><td>None</td><td><code>f0</code></td><td>None</td></tr>
<tr><td>LoongArch</td><td><code>reg</code></td><td>None</td><td><code>$r1</code></td><td>None</td></tr>
<tr><td>LoongArch</td><td><code>freg</code></td><td>None</td><td><code>$f0</code></td><td>None</td></tr>
<tr><td>s390x</td><td><code>reg</code></td><td>None</td><td><code>%r0</code></td><td>None</td></tr>
<tr><td>s390x</td><td><code>reg_addr</code></td><td>None</td><td><code>%r1</code></td><td>None</td></tr>
<tr><td>s390x</td><td><code>freg</code></td><td>None</td><td><code>%f0</code></td><td>None</td></tr>
</tbody>
</table>
</div>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<ul>
<li>在 ARM 上 <code>e</code> / <code>f</code>：这会打印 NEON quad (128-bit) 寄存器的低双字或高双字寄存器名称。</li>
<li>在 x86 上：我们对不带修饰符的 <code>reg</code> 的行为与 GCC 所做的不同。GCC 将根据操作数值类型推断修饰符，而我们默认使用完整的寄存器大小。</li>
<li>在 x86 <code>xmm_reg</code> 上：<code>x</code>、<code>t</code> 和 <code>g</code> LLVM 修饰符尚未在 LLVM 中实现（它们仅受 GCC 支持），但这应该是一个简单的改动。</li>
</ul>
</blockquote>
</div>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let mut x = 0x10u16;

// 使用 `xchg` 的 u16::swap_bytes
// `{x}` 的低半部分由 `{x:l}` 引用，高半部分由 `{x:h}` 引用
unsafe { core::arch::asm!("xchg {x:l}, {x:h}", x = inout(reg_abcd) x); }
assert_eq!(x, 0x1000u16);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.template-modifiers.smaller-value"><a class="rule-link" href="#r-asm.template-modifiers.smaller-value" title="asm.template-modifiers.smaller-value"><span>[asm<wbr>.template-modifiers<wbr>.smaller-value]</span></a>
</div>

<p>如上一节所述，传递小于寄存器宽度的输入值将导致寄存器的高位包含未定义的值。如果内联汇编仅访问寄存器的低位，这就不是问题，可以通过使用模板修饰符在汇编代码中使用子寄存器名称（例如使用 <code>ax</code> 而不是 <code>rax</code>）来实现。由于这是一个容易掉进去的陷阱，编译器将根据输入类型建议在适当的地方使用模板修饰符。如果对操作数的所有引用都已经有了修饰符，则会抑制该操作数的警告。</p>
<div class="rule" id="r-asm.abi-clobbers"><a class="rule-link" href="#r-asm.abi-clobbers" title="asm.abi-clobbers"><span>[asm<wbr>.abi-clobbers]</span></a>
</div>

<h2 id="abi破坏列表"><a class="header" href="#abi破坏列表">ABI破坏列表</a></h2>
<div class="rule" id="r-asm.abi-clobbers.intro"><a class="rule-link" href="#r-asm.abi-clobbers.intro" title="asm.abi-clobbers.intro"><span>[asm<wbr>.abi-clobbers<wbr>.intro]</span></a>
</div>

<p><code>clobber_abi</code> 关键字可用于为汇编代码应用一组默认的破坏列表。这将根据调用具有特定调用约定（calling convention）的函数自动插入必要的破坏约束：如果调用约定不能在调用过程中完全保留寄存器的值，则会隐式地将 <code>lateout("...") _</code> 添加到操作数列表中（其中 <code>...</code> 被替换为寄存器的名称）。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>extern "C" fn foo() -&gt; i32 { 0 }

let z: i32;
// 要调用函数，我们必须告知编译器我们正在破坏
// 被调用者保存的寄存器
unsafe { core::arch::asm!("call {}", sym foo, out("rax") z, clobber_abi("C")); }
assert_eq!(z, 0);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.abi-clobbers.many"><a class="rule-link" href="#r-asm.abi-clobbers.many" title="asm.abi-clobbers.many"><span>[asm<wbr>.abi-clobbers<wbr>.many]</span></a>
</div>

<p><code>clobber_abi</code> 可以指定任意次数。它将为所有指定调用约定的并集中的所有唯一寄存器插入一个破坏列表。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>extern "sysv64" fn foo() -&gt; i32 { 0 }
extern "win64" fn bar(x: i32) -&gt; i32 { x + 1}

let z: i32;
// 我们甚至可以调用多个具有不同约定和
// 不同保存寄存器的函数
unsafe {
    core::arch::asm!(
        "call {}",
        "mov ecx, eax",
        "call {}",
        sym foo,
        sym bar,
        out("rax") z,
        clobber_abi("C")
    );
}
assert_eq!(z, 1);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.abi-clobbers.must-specify"><a class="rule-link" href="#r-asm.abi-clobbers.must-specify" title="asm.abi-clobbers.must-specify"><span>[asm<wbr>.abi-clobbers<wbr>.must-specify]</span></a>
</div>

<p>当使用 <code>clobber_abi</code> 时，编译器不允许泛型寄存器类输出：所有输出必须指定显式寄存器。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>extern "C" fn foo(x: i32) -&gt; i32 { 0 }

let z: i32;
// 必须使用显式寄存器以免意外重叠。
unsafe {
    core::arch::asm!(
        "mov eax, {:e}",
        "call {}",
        out(reg) z,
        sym foo,
        clobber_abi("C")
    );
    // ERROR: asm with `clobber_abi` must specify explicit registers for outputs
}
assert_eq!(z, 0);
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.abi-clobbers.explicit-have-precedence"><a class="rule-link" href="#r-asm.abi-clobbers.explicit-have-precedence" title="asm.abi-clobbers.explicit-have-precedence"><span>[asm<wbr>.abi-clobbers<wbr>.explicit-have-precedence]</span></a>
</div>

<p>显式寄存器输出优先于由 <code>clobber_abi</code> 插入的隐式破坏列表：仅当寄存器未用作输出时，才会为该寄存器插入破坏列表。</p>
<div class="rule" id="r-asm.abi-clobbers.supported-abis"><a class="rule-link" href="#r-asm.abi-clobbers.supported-abis" title="asm.abi-clobbers.supported-abis"><span>[asm<wbr>.abi-clobbers<wbr>.supported-abis]</span></a>
</div>

<p>以下 ABI 可与 <code>clobber_abi</code> 一起使用：</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>架构</th><th>ABI 名称</th><th>被破坏的寄存器</th></tr>
</thead>
<tbody>
<tr><td>x86-32</td><td><code>"C"</code>, <code>"system"</code>, <code>"efiapi"</code>, <code>"cdecl"</code>, <code>"stdcall"</code>, <code>"fastcall"</code></td><td><code>ax</code>, <code>cx</code>, <code>dx</code>, <code>xmm[0-7]</code>, <code>mm[0-7]</code>, <code>k[0-7]</code>, <code>st([0-7])</code></td></tr>
<tr><td>x86-64</td><td><code>"C"</code>, <code>"system"</code> (在 Windows 上), <code>"efiapi"</code>, <code>"win64"</code></td><td><code>ax</code>, <code>cx</code>, <code>dx</code>, <code>r[8-11]</code>, <code>xmm[0-31]</code>, <code>mm[0-7]</code>, <code>k[0-7]</code>, <code>st([0-7])</code>, <code>tmm[0-7]</code></td></tr>
<tr><td>x86-64</td><td><code>"C"</code>, <code>"system"</code> (在非 Windows 上), <code>"sysv64"</code></td><td><code>ax</code>, <code>cx</code>, <code>dx</code>, <code>si</code>, <code>di</code>, <code>r[8-11]</code>, <code>xmm[0-31]</code>, <code>mm[0-7]</code>, <code>k[0-7]</code>, <code>st([0-7])</code>, <code>tmm[0-7]</code></td></tr>
<tr><td>AArch64</td><td><code>"C"</code>, <code>"system"</code>, <code>"efiapi"</code></td><td><code>x[0-17]</code>, <code>x18</code>*, <code>x30</code>, <code>v[0-31]</code>, <code>p[0-15]</code>, <code>ffr</code></td></tr>
<tr><td>Arm64EC</td><td><code>"C"</code>, <code>"system"</code></td><td><code>x[0-12]</code>, <code>x[15-17]</code>, <code>x30</code>, <code>v[0-15]</code></td></tr>
<tr><td>ARM</td><td><code>"C"</code>, <code>"system"</code>, <code>"efiapi"</code>, <code>"aapcs"</code></td><td><code>r[0-3]</code>, <code>r12</code>, <code>r14</code>, <code>s[0-15]</code>, <code>d[0-7]</code>, <code>d[16-31]</code></td></tr>
<tr><td>RISC-V</td><td><code>"C"</code>, <code>"system"</code>, <code>"efiapi"</code></td><td><code>x1</code>, <code>x[5-7]</code>, <code>x[10-17]</code>*, <code>x[28-31]</code>*, <code>f[0-7]</code>, <code>f[10-17]</code>, <code>f[28-31]</code>, <code>v[0-31]</code></td></tr>
<tr><td>LoongArch</td><td><code>"C"</code>, <code>"system"</code></td><td><code>$r1</code>, <code>$r[4-20]</code>, <code>$f[0-23]</code></td></tr>
<tr><td>s390x</td><td><code>"C"</code>, <code>"system"</code></td><td><code>r[0-5]</code>, <code>r14</code>, <code>f[0-7]</code>, <code>v[0-31]</code>, <code>a[2-15]</code></td></tr>
</tbody>
</table>
</div>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<ul>
<li>在 AArch64 上，仅当 <code>x18</code> 在 target 上不被视为保留寄存器时，才将其包含在破坏列表中。</li>
<li>在 RISC-V 上，仅当 <code>x[16-17]</code> 和 <code>x[28-31]</code> 在 target 上不被视为保留寄存器时，才将其包含在破坏列表中。</li>
</ul>
</blockquote>
</div>

<p>随着架构获得新寄存器，rustc 会更新每个 ABI 的破坏寄存器列表：这确保了当 LLVM 开始在其生成的代码中使用这些新寄存器时，<code>asm!</code> 破坏列表将继续保持正确。</p>
<div class="rule" id="r-asm.options"><a class="rule-link" href="#r-asm.options" title="asm.options"><span>[asm<wbr>.options]</span></a>
</div>

<h2 id="选项"><a class="header" href="#选项">选项</a></h2>
<div class="rule" id="r-asm.options.supported-options"><a class="rule-link" href="#r-asm.options.supported-options" title="asm.options.supported-options"><span>[asm<wbr>.options<wbr>.supported-options]</span></a>
</div>

<p>标志用于进一步影响内联汇编代码的行为。目前定义了以下选项：</p>
<div class="rule" id="r-asm.options.supported-options.pure"><a class="rule-link" href="#r-asm.options.supported-options.pure" title="asm.options.supported-options.pure"><span>[asm<wbr>.options<wbr>.supported-options<wbr>.pure]</span></a>
</div>

<ul>
<li><code>pure</code>：汇编代码没有副作用，必须最终返回，并且其输出仅取决于其直接输入（即值本身，而不是它们指向的内容）或从内存读取的值（除非还设置了 <code>nomem</code> 选项）。这允许编译器执行汇编代码的次数少于程序中指定的次数（例如通过将其提升到循环之外），或者如果输出未被使用，甚至可以完全消除它。<code>pure</code> 选项必须与 <code>nomem</code> 或 <code>readonly</code> 选项之一结合使用，否则会发出编译时错误。</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i32 = 0;
let z: i32;
// `pure` 可用于通过假设汇编没有副作用来进行优化
unsafe { core::arch::asm!("inc {}", inout(reg) x =&gt; z, options(pure, nomem)); }
assert_eq!(z, 1);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i32 = 0;
let z: i32;
// 必须满足 `nomem` 或 `readonly` 之一，以指示是否
// 允许读取内存
unsafe { core::arch::asm!("inc {}", inout(reg) x =&gt; z, options(pure)); }
// ERROR: the `pure` option must be combined with either `nomem` or `readonly`
assert_eq!(z, 0);
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.options.supported-options.nomem"><a class="rule-link" href="#r-asm.options.supported-options.nomem" title="asm.options.supported-options.nomem"><span>[asm<wbr>.options<wbr>.supported-options<wbr>.nomem]</span></a>
</div>

<ul>
<li><code>nomem</code>：汇编代码不会读取或写入汇编代码之外可访问的任何内存。这允许编译器在执行汇编代码期间将修改后的全局变量的值缓存在寄存器中，因为它知道汇编代码不会读取或写入它们。编译器还假设汇编代码不会与其他线程执行任何形式的同步，例如通过内存屏障（fence）。</li>
</ul>
<!-- no_run: This test has unpredictable or undefined behavior at runtime -->
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let mut x = 0i32;
let z: i32;
// 当指定 `nomem` 时，不允许从汇编访问外部内存
unsafe {
    core::arch::asm!("mov {val:e}, dword ptr [{ptr}]",
        ptr = in(reg) &amp;mut x,
        val = lateout(reg) z,
        options(nomem)
    )
}

// 当指定 `nomem` 时，从汇编写入外部内存也是未定义行为
unsafe {
    core::arch::asm!("mov  dword ptr [{ptr}], {val:e}",
        ptr = in(reg) &amp;mut x,
        val = in(reg) z,
        options(nomem)
    )
}
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i32 = 0;
let z: i32;
// 然而，如果我们分配自己的内存，例如通过 `push`。
// 我们仍然可以使用它
unsafe {
    core::arch::asm!("push {x}", "add qword ptr [rsp], 1", "pop {x}",
        x = inout(reg) x =&gt; z,
        options(nomem)
    );
}
assert_eq!(z, 1);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.options.supported-options.readonly"><a class="rule-link" href="#r-asm.options.supported-options.readonly" title="asm.options.supported-options.readonly"><span>[asm<wbr>.options<wbr>.supported-options<wbr>.readonly]</span></a>
</div>

<ul>
<li><code>readonly</code>：汇编代码不会写入汇编代码之外可访问的任何内存。这允许编译器在执行汇编代码期间将未修改的全局变量的值缓存在寄存器中，因为它知道汇编代码不会写入它们。编译器还假设此汇编代码不会与其他线程执行任何形式的同步，例如通过内存屏障。</li>
</ul>
<!-- no_run: This test has undefined behaviour at runtime -->
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let mut x = 0;
// 当指定 `readonly` 时，我们不能修改外部内存
unsafe {
    core::arch::asm!("mov dword ptr[{}], 1", in(reg) &amp;mut x, options(readonly))
}
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i64 = 0;
let z: i64;
// 不过我们仍然可以从中读取
unsafe {
    core::arch::asm!("mov {x}, qword ptr [{x}]",
        x = inout(reg) &amp;x =&gt; z,
        options(readonly)
    );
}
assert_eq!(z, 0);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i64 = 0;
let z: i64;
// 与 `nomem` 相同的例外也适用。
unsafe {
    core::arch::asm!("push {x}", "add qword ptr [rsp], 1", "pop {x}",
        x = inout(reg) x =&gt; z,
        options(readonly)
    );
}
assert_eq!(z, 1);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.options.supported-options.preserves_flags"><a class="rule-link" href="#r-asm.options.supported-options.preserves_flags" title="asm.options.supported-options.preserves_flags"><span>[asm<wbr>.options<wbr>.supported-options<wbr>.preserves_flags]</span></a>
</div>

<ul>
<li><code>preserves_flags</code>：汇编代码不修改标志寄存器（在下面的规则中定义）。这允许编译器避免在执行汇编代码后重新计算条件标志。</li>
</ul>
<div class="rule" id="r-asm.options.supported-options.noreturn"><a class="rule-link" href="#r-asm.options.supported-options.noreturn" title="asm.options.supported-options.noreturn"><span>[asm<wbr>.options<wbr>.supported-options<wbr>.noreturn]</span></a>
</div>

<ul>
<li><code>noreturn</code>：汇编代码不会顺序执行（fall through）；如果它这样做，则行为是未定义的。它仍然可以跳转到 <code>label</code> 块。如果任何 <code>label</code> 块返回单元类型，则 <code>asm!</code> 块将返回单元类型。否则它将返回 <code>!</code>（从不）。与调用不返回的函数一样，作用域内的局部变量在执行汇编代码之前不会被丢弃。</li>
</ul>
<!-- no_run: This test aborts at runtime -->
<pre class="playground"><code class="language-rust no_run edition2024">fn main() -&gt; ! {
<span class="boring">#[cfg(target_arch = "x86_64")] {
</span>    // 我们可以在 `noreturn` 块内使用一条指令来捕获执行
    unsafe { core::arch::asm!("ud2", options(noreturn)); }
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] panic!("no return");
</span>}</code></pre>
<!-- no_run: Test has undefined behavior at runtime -->
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// 您负责确保执行不会越过 `noreturn` 汇编块的末尾
unsafe { core::arch::asm!("", options(noreturn)); }
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")]
</span>let _: () = unsafe {
    // 您仍然可以跳转到 `label` 块
    core::arch::asm!("jmp {}", label {
        println!();
    }, options(noreturn));
};
<span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.options.supported-options.nostack"><a class="rule-link" href="#r-asm.options.supported-options.nostack" title="asm.options.supported-options.nostack"><span>[asm<wbr>.options<wbr>.supported-options<wbr>.nostack]</span></a>
</div>

<ul>
<li><code>nostack</code>：汇编代码不会将数据压入栈，也不会写入栈红区（red-zone）（如果 target 支持）。如果 <em>不</em> 使用此选项，则编译器保证在汇编代码开始时，栈指针已（根据 target ABI）适当对齐，以便进行函数调用。</li>
</ul>
<!-- no_run: Test has undefined behavior at runtime -->
<pre class="playground"><code class="language-rust no_run edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// `push` 和 `pop` 在与 `nostack` 一起使用时是未定义行为
unsafe { core::arch::asm!("push rax", "pop rax", options(nostack)); }
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.options.supported-options.att_syntax"><a class="rule-link" href="#r-asm.options.supported-options.att_syntax" title="asm.options.supported-options.att_syntax"><span>[asm<wbr>.options<wbr>.supported-options<wbr>.att_syntax]</span></a>
</div>

<ul>
<li><code>att_syntax</code>：此选项仅在 x86 上有效，并导致汇编器使用 GNU 汇编器的 <code>.att_syntax prefix</code> 模式。替换进来的寄存器操作数带有一个前导 <code>%</code>。</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let x: i32;
let y = 1i32;
// 我们在这里需要使用 AT&amp;T 语法。操作数的顺序是源、目的
unsafe {
    core::arch::asm!("mov {y:e}, {x:e}",
        x = lateout(reg) x,
        y = in(reg) y,
        options(att_syntax)
    );
}
assert_eq!(x, y);
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.options.supported-options.raw"><a class="rule-link" href="#r-asm.options.supported-options.raw" title="asm.options.supported-options.raw"><span>[asm<wbr>.options<wbr>.supported-options<wbr>.raw]</span></a>
</div>

<ul>
<li><code>raw</code>：这导致模板字符串被解析为原始汇编字符串，不对 <code>{</code> 和 <code>}</code> 进行特殊处理。这在通过 <code>include_str!</code> 从外部文件包含原始汇编代码时特别有用。</li>
</ul>
<div class="rule" id="r-asm.options.checks"><a class="rule-link" href="#r-asm.options.checks" title="asm.options.checks"><span>[asm<wbr>.options<wbr>.checks]</span></a>
</div>

<p>编译器对选项执行一些额外的检查：</p>
<div class="rule" id="r-asm.options.checks.mutually-exclusive"><a class="rule-link" href="#r-asm.options.checks.mutually-exclusive" title="asm.options.checks.mutually-exclusive"><span>[asm<wbr>.options<wbr>.checks<wbr>.mutually-exclusive]</span></a>
</div>

<ul>
<li><code>nomem</code> 和 <code>readonly</code> 选项是互斥的：同时指定两者是一个编译时错误。</li>
</ul>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// `nomem` 严格强于 `readonly` ，它们不能同时指定
unsafe { core::arch::asm!("", options(nomem, readonly)); }
// ERROR: the `nomem` and `readonly` options are mutually exclusive
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.options.checks.pure"><a class="rule-link" href="#r-asm.options.checks.pure" title="asm.options.checks.pure"><span>[asm<wbr>.options<wbr>.checks<wbr>.pure]</span></a>
</div>

<ul>
<li>在没有输出或只有被丢弃的输出（<code>_</code>）的汇编块上指定 <code>pure</code> 是一个编译时错误。</li>
</ul>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>// `pure` 块需要至少一个输出
unsafe { core::arch::asm!("", options(pure)); }
// ERROR: asm with the `pure` option must have at least one output
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.options.checks.noreturn"><a class="rule-link" href="#r-asm.options.checks.noreturn" title="asm.options.checks.noreturn"><span>[asm<wbr>.options<wbr>.checks<wbr>.noreturn]</span></a>
</div>

<ul>
<li>在具有输出且没有 label 的汇编块上指定 <code>noreturn</code> 是一个编译时错误。</li>
</ul>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let z: i32;
// `noreturn` 不能有输出
unsafe { core::arch::asm!("mov {:e}, 1", out(reg) z, options(noreturn)); }
// ERROR: asm outputs are not allowed with the `noreturn` option
<span class="boring">}
</span><span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.options.checks.label-with-outputs"><a class="rule-link" href="#r-asm.options.checks.label-with-outputs" title="asm.options.checks.label-with-outputs"><span>[asm<wbr>.options<wbr>.checks<wbr>.label-with-outputs]</span></a>
</div>

<ul>
<li>在具有输出的汇编块中拥有任何 <code>label</code> 块是一个编译时错误。</li>
</ul>
<div class="rule" id="r-asm.options.naked_asm-restriction"><a class="rule-link" href="#r-asm.options.naked_asm-restriction" title="asm.options.naked_asm-restriction"><span>[asm<wbr>.options<wbr>.naked_asm-restriction]</span></a>
</div>

<p><code>naked_asm!</code> 仅支持 <code>att_syntax</code> 和 <code>raw</code> 选项。其余选项没有意义，因为内联汇编定义了整个函数体。</p>
<div class="rule" id="r-asm.options.global_asm-restriction"><a class="rule-link" href="#r-asm.options.global_asm-restriction" title="asm.options.global_asm-restriction"><span>[asm<wbr>.options<wbr>.global_asm-restriction]</span></a>
</div>

<p><code>global_asm!</code> 仅支持 <code>att_syntax</code> 和 <code>raw</code> 选项。其余选项对于全局作用域内联汇编没有意义。</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">fn main() {}
</span><span class="boring">#[cfg(target_arch = "x86_64")]
</span>// `nomem` 在 `global_asm!` 上没有用
core::arch::global_asm!("", options(nomem));
<span class="boring">#[cfg(not(target_arch = "x86_64"))] core::compile_error!("Test not supported on this arch");</span></code></pre>
<div class="rule" id="r-asm.rules"><a class="rule-link" href="#r-asm.rules" title="asm.rules"><span>[asm<wbr>.rules]</span></a>
</div>

<h2 id="内联汇编规则"><a class="header" href="#内联汇编规则">内联汇编规则</a></h2>
<div class="rule" id="r-asm.rules.intro"><a class="rule-link" href="#r-asm.rules.intro" title="asm.rules.intro"><span>[asm<wbr>.rules<wbr>.intro]</span></a>
</div>

<p>为避免未定义行为，在使用函数作用域内联汇编（<code>asm!</code>）时必须遵守以下规则：</p>
<div class="rule" id="r-asm.rules.reg-not-input"><a class="rule-link" href="#r-asm.rules.reg-not-input" title="asm.rules.reg-not-input"><span>[asm<wbr>.rules<wbr>.reg-not-input]</span></a>
</div>

<ul>
<li>任何未指定为输入的寄存器在进入汇编代码时都将包含一个未定义的值。
<ul>
<li>在内联汇编的语境下， “未定义的值” 意味着寄存器可以（非确定性地）具有架构所允许的任何一个可能的值。值得注意的是，它与 LLVM 的 <code>undef</code> 不同，后者每次读取时都可以具有不同的值（因为汇编代码中不存在这样的概念）。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.reg-not-output"><a class="rule-link" href="#r-asm.rules.reg-not-output" title="asm.rules.reg-not-output"><span>[asm<wbr>.rules<wbr>.reg-not-output]</span></a>
</div>

<ul>
<li>任何未指定为输出的寄存器在退出汇编代码时必须具有与进入时相同的值，否则行为是未定义的。
<ul>
<li>这仅适用于可以指定为输入或输出的寄存器。其他寄存器遵循特定于 target 的规则。</li>
<li>请注意，<code>lateout</code> 可能会被分配到与 <code>in</code> 相同的寄存器，在这种情况下，此规则不适用。然而，代码不应依赖于此，因为它取决于寄存器分配的结果。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.unwind"><a class="rule-link" href="#r-asm.rules.unwind" title="asm.rules.unwind"><span>[asm<wbr>.rules<wbr>.unwind]</span></a>
</div>

<ul>
<li>如果执行从汇编代码中展开（unwind），则行为是未定义的。
<ul>
<li>这也适用于汇编代码调用了一个随后发生展开的函数的情况。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.mem-same-as-ffi"><a class="rule-link" href="#r-asm.rules.mem-same-as-ffi" title="asm.rules.mem-same-as-ffi"><span>[asm<wbr>.rules<wbr>.mem-same-as-ffi]</span></a>
</div>

<ul>
<li>汇编代码允许读取和写入的内存位置集与 FFI 函数所允许的相同。
<ul>
<li>如果设置了 <code>readonly</code> 选项，则仅允许读取内存。</li>
<li>如果设置了 <code>nomem</code> 选项，则不允许读取或写入内存。</li>
<li>这些规则不适用于汇编代码私有的内存，例如在其内部分配的栈空间。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.black-box"><a class="rule-link" href="#r-asm.rules.black-box" title="asm.rules.black-box"><span>[asm<wbr>.rules<wbr>.black-box]</span></a>
</div>

<ul>
<li>编译器不能假设汇编代码中的指令就是最终会执行的指令。
<ul>
<li>这实际上意味着编译器必须将汇编代码视为黑盒，仅考虑接口规范，而不是指令本身。</li>
<li>允许通过特定于 target 的机制进行运行时代码补丁。</li>
<li>然而，不保证源代码中的每个汇编代码块都直接对应于目标文件中的单个指令实例；编译器可以自由地复制或去重 <code>asm!</code> 块中的汇编代码。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.stack-below-sp"><a class="rule-link" href="#r-asm.rules.stack-below-sp" title="asm.rules.stack-below-sp"><span>[asm<wbr>.rules<wbr>.stack-below-sp]</span></a>
</div>

<ul>
<li>除非设置了 <code>nostack</code> 选项，否则允许汇编代码使用栈指针下方的栈空间。
<ul>
<li>在进入汇编代码时，栈指针保证已（根据 target ABI）适当对齐，以便进行函数调用。</li>
<li>您负责确保不会发生栈溢出（例如使用栈探测以确保触及保护页）。</li>
<li>您应当根据 target ABI 的要求，在分配栈内存时调整栈指针。</li>
<li>栈指针必须在离开汇编代码之前恢复为其原始值。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.noreturn"><a class="rule-link" href="#r-asm.rules.noreturn" title="asm.rules.noreturn"><span>[asm<wbr>.rules<wbr>.noreturn]</span></a>
</div>

<ul>
<li>如果设置了 <code>noreturn</code> 选项，则如果执行顺序执行到汇编代码末尾，则行为是未定义的。</li>
</ul>
<div class="rule" id="r-asm.rules.pure"><a class="rule-link" href="#r-asm.rules.pure" title="asm.rules.pure"><span>[asm<wbr>.rules<wbr>.pure]</span></a>
</div>

<ul>
<li>如果设置了 <code>pure</code> 选项，则如果 <code>asm!</code> 除了其直接输出之外还有副作用，则行为是未定义的。如果具有相同输入的 <code>asm!</code> 代码的两次执行导致不同的输出，则行为也是未定义的。
<ul>
<li>当与 <code>nomem</code> 选项一起使用时， “输入” 只是 <code>asm!</code> 的直接输入。</li>
<li>当与 <code>readonly</code> 选项一起使用时， “输入” 包括汇编代码的直接输入和它允许读取的任何内存。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.preserved-registers"><a class="rule-link" href="#r-asm.rules.preserved-registers" title="asm.rules.preserved-registers"><span>[asm<wbr>.rules<wbr>.preserved-registers]</span></a>
</div>

<ul>
<li>如果设置了 <code>preserves_flags</code> 选项，则退出汇编代码时必须恢复这些标志寄存器：
<ul>
<li>x86
<ul>
<li><code>EFLAGS</code> 中的状态标志位（CF, PF, AF, ZF, SF, OF）。</li>
<li>浮点状态字（全部）。</li>
<li><code>MXCSR</code> 中的浮点异常标志（PE, UE, OE, ZF, DE, IE）。</li>
</ul>
</li>
<li>ARM
<ul>
<li><code>CPSR</code> 中的条件标志（N, Z, C, V）</li>
<li><code>CPSR</code> 中的饱和标志（Q）</li>
<li><code>CPSR</code> 中的大于或等于标志（GE）。</li>
<li><code>FPSCR</code> 中的条件标志（N, Z, C, V）</li>
<li><code>FPSCR</code> 中的饱和标志（QC）</li>
<li><code>FPSCR</code> 中的浮点异常标志（IDC, IXC, UFC, OFC, DZC, IOC）。</li>
</ul>
</li>
<li>AArch64 和 Arm64EC
<ul>
<li>条件标志（<code>NZCV</code> 寄存器）。</li>
<li>浮点状态（<code>FPSR</code> 寄存器）。</li>
</ul>
</li>
<li>RISC-V
<ul>
<li><code>fcsr</code> 中的浮点异常标志（<code>fflags</code>）。</li>
<li>向量扩展状态（<code>vtype</code>、<code>vl</code>、<code>vxsat</code> 和 <code>vxrm</code>）。</li>
</ul>
</li>
<li>LoongArch
<ul>
<li><code>$fcc[0-7]</code> 中的浮点条件标志。</li>
</ul>
</li>
<li>s390x
<ul>
<li>条件代码寄存器 <code>cc</code>。</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.x86-df"><a class="rule-link" href="#r-asm.rules.x86-df" title="asm.rules.x86-df"><span>[asm<wbr>.rules<wbr>.x86-df]</span></a>
</div>

<ul>
<li>在 x86 上，方向标志位（<code>EFLAGS</code> 中的 DF）在进入汇编代码时为清除状态，且退出时必须为清除状态。
<ul>
<li>如果退出汇编代码时设置了方向标志位，则行为是未定义的。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.x86-x87"><a class="rule-link" href="#r-asm.rules.x86-x87" title="asm.rules.x86-x87"><span>[asm<wbr>.rules<wbr>.x86-x87]</span></a>
</div>

<ul>
<li>在 x86 上，x87 浮点寄存器栈必须保持不变，除非所有 <code>st([0-7])</code> 寄存器都已标记为使用 <code>out("st(0)") _, out("st(1)") _, ...</code> 进行了破坏。
<ul>
<li>如果所有 x87 寄存器都被破坏，则保证在进入汇编代码时 x87 寄存器栈为空。汇编代码必须确保在退出汇编代码时 x87 寄存器栈也为空。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#[cfg(target_arch = "x86_64")]
</span>pub fn fadd(x: f64, y: f64) -&gt; f64 {
  let mut out = 0f64;
  let mut top = 0u16;
  // 如果我们破坏了整个 x87 栈，我们可以用 x87 做复杂的事情
  unsafe { core::arch::asm!(
    "fld qword ptr [{x}]",
    "fld qword ptr [{y}])",
    "faddp",
    "fstp qword ptr [{out}]",
    "xor eax, eax",
    "fstsw ax",
    "shl eax, 11",
    x = in(reg) &amp;x,
    y = in(reg) &amp;y,
    out = in(reg) &amp;mut out,
    out("st(0)") _, out("st(1)") _, out("st(2)") _, out("st(3)") _,
    out("st(4)") _, out("st(5)") _, out("st(6)") _, out("st(7)") _,
    out("eax") top
  );}

  assert_eq!(top &amp; 0x7, 0);
  out
}

pub fn main() {
<span class="boring">#[cfg(target_arch = "x86_64")]{
</span>  assert_eq!(fadd(1.0, 1.0), 2.0);
<span class="boring">}
</span>}</code></pre>
<div class="rule" id="r-asm.rules.arm64ec"><a class="rule-link" href="#r-asm.rules.arm64ec" title="asm.rules.arm64ec"><span>[asm<wbr>.rules<wbr>.arm64ec]</span></a>
</div>

<ul>
<li>在 arm64ec 上，调用函数时必须使用 <a href="https://learn.microsoft.com/en-us/windows/arm/arm64ec-abi#authoring-arm64ec-in-assembly">带有适当转换器（thunks）的调用检查器</a>。</li>
</ul>
<div class="rule" id="r-asm.rules.only-on-exit"><a class="rule-link" href="#r-asm.rules.only-on-exit" title="asm.rules.only-on-exit"><span>[asm<wbr>.rules<wbr>.only-on-exit]</span></a>
</div>

<ul>
<li>恢复栈指针和非输出寄存器为其原始值的要求仅适用于退出汇编代码时。
<ul>
<li>这意味着不顺序执行且不跳转到任何 <code>label</code> 块的汇编代码，即使没有标记为 <code>noreturn</code>，也不需要保留这些寄存器。</li>
<li>当返回到与进入时不同的 <code>asm!</code> 块的汇编代码时（例如用于上下文切换），这些寄存器必须包含在进入您正在 <em>退出</em> 的 <code>asm!</code> 块时所具有的值。
<ul>
<li>您不能退出未进入的 <code>asm!</code> 块的汇编代码。也不能退出其汇编代码已退出的 <code>asm!</code> 块的汇编代码（除非再次进入它）。</li>
<li>您负责切换任何特定于 target 的状态（例如线程局部存储、栈边界）。</li>
<li>您不能从一个 <code>asm!</code> 块中的地址跳转到另一个块中的地址，即使在同一个函数或块内，而不将它们的上下文视为可能不同的并需要进行上下文切换。您不能假设这些上下文中的任何特定值（例如当前栈指针或栈指针下方的临时值）在两个 <code>asm!</code> 块之间将保持不变。</li>
<li>您可以访问的内存位置集是您进入和退出的 <code>asm!</code> 块所允许的位置集的交集。</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.not-successive"><a class="rule-link" href="#r-asm.rules.not-successive" title="asm.rules.not-successive"><span>[asm<wbr>.rules<wbr>.not-successive]</span></a>
</div>

<ul>
<li>您不能假设源代码中相邻的两个 <code>asm!</code> 块，即使它们之间没有任何其他代码，最终也会位于二进制文件中连续的地址且它们之间没有任何其他指令。</li>
</ul>
<div class="rule" id="r-asm.rules.not-exactly-once"><a class="rule-link" href="#r-asm.rules.not-exactly-once" title="asm.rules.not-exactly-once"><span>[asm<wbr>.rules<wbr>.not-exactly-once]</span></a>
</div>

<ul>
<li>您不能假设 <code>asm!</code> 块在输出二进制文件中恰好出现一次。编译器允许实例化 <code>asm!</code> 块的多个副本，例如当包含它的函数在多个地方内联时。</li>
</ul>
<div class="rule" id="r-asm.rules.x86-prefix-restriction"><a class="rule-link" href="#r-asm.rules.x86-prefix-restriction" title="asm.rules.x86-prefix-restriction"><span>[asm<wbr>.rules<wbr>.x86-prefix-restriction]</span></a>
</div>

<ul>
<li>在 x86 上，内联汇编不得以会应用于编译器生成的指令的指令前缀（例如 <code>LOCK</code>）结尾。
<ul>
<li>由于内联汇编的编译方式，编译器目前无法检测到这一点，但将来可能会捕获并拒绝这种情况。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.rules.preserves_flags"><a class="rule-link" href="#r-asm.rules.preserves_flags" title="asm.rules.preserves_flags"><span>[asm<wbr>.rules<wbr>.preserves_flags]</span></a>
</div>

<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>作为一般规则，<code>preserves_flags</code> 涵盖的标志是那些在执行函数调用时 <em>不</em> 被保留的标志。</p>
</blockquote>
</div>

<div class="rule" id="r-asm.naked-rules"><a class="rule-link" href="#r-asm.naked-rules" title="asm.naked-rules"><span>[asm<wbr>.naked-rules]</span></a>
</div>

<h2 id="裸内联汇编规则"><a class="header" href="#裸内联汇编规则">裸内联汇编规则</a></h2>
<div class="rule" id="r-asm.naked-rules.intro"><a class="rule-link" href="#r-asm.naked-rules.intro" title="asm.naked-rules.intro"><span>[asm<wbr>.naked-rules<wbr>.intro]</span></a>
</div>

<p>为避免未定义行为，在裸函数（<code>naked_asm!</code>）中使用函数作用域内联汇编时必须遵守以下规则：</p>
<div class="rule" id="r-asm.naked-rules.reg-not-input"><a class="rule-link" href="#r-asm.naked-rules.reg-not-input" title="asm.naked-rules.reg-not-input"><span>[asm<wbr>.naked-rules<wbr>.reg-not-input]</span></a>
</div>

<ul>
<li>根据调用约定和函数签名，任何未用于函数输入的寄存器在进入 <code>naked_asm!</code> 块时都将包含一个未定义的值。
<ul>
<li>在内联汇编的语境下， “未定义的值” 意味着寄存器可以（非确定性地）具有架构所允许的任何一个可能的值。值得注意的是，它与 LLVM 的 <code>undef</code> 不同，后者每次读取时都可以具有不同的值（因为汇编代码中不存在这样的概念）。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.naked-rules.callee-saved-registers"><a class="rule-link" href="#r-asm.naked-rules.callee-saved-registers" title="asm.naked-rules.callee-saved-registers"><span>[asm<wbr>.naked-rules<wbr>.callee-saved-registers]</span></a>
</div>

<ul>
<li>所有被调用者保存（callee-saved）的寄存器在返回时必须具有与进入时相同的值。</li>
</ul>
<div class="rule" id="r-asm.naked-rules.caller-saved-registers"><a class="rule-link" href="#r-asm.naked-rules.caller-saved-registers" title="asm.naked-rules.caller-saved-registers"><span>[asm<wbr>.naked-rules<wbr>.caller-saved-registers]</span></a>
</div>

<ul>
<li>可以自由使用调用者保存（caller-saved）的寄存器。</li>
</ul>
<div class="rule" id="r-asm.naked-rules.noreturn"><a class="rule-link" href="#r-asm.naked-rules.noreturn" title="asm.naked-rules.noreturn"><span>[asm<wbr>.naked-rules<wbr>.noreturn]</span></a>
</div>

<ul>
<li>如果执行顺序执行过汇编代码末尾，则行为是未定义的。
<ul>
<li>汇编代码中的每条路径都应以返回指令结束或发散。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.naked-rules.mem-same-as-ffi"><a class="rule-link" href="#r-asm.naked-rules.mem-same-as-ffi" title="asm.naked-rules.mem-same-as-ffi"><span>[asm<wbr>.naked-rules<wbr>.mem-same-as-ffi]</span></a>
</div>

<ul>
<li>汇编代码允许读取和写入的内存位置集与 FFI 函数所允许的相同。</li>
</ul>
<div class="rule" id="r-asm.naked-rules.black-box"><a class="rule-link" href="#r-asm.naked-rules.black-box" title="asm.naked-rules.black-box"><span>[asm<wbr>.naked-rules<wbr>.black-box]</span></a>
</div>

<ul>
<li>编译器不能假设 <code>naked_asm!</code> 块中的指令就是最终会执行的指令。
<ul>
<li>这实际上意味着编译器必须将 <code>naked_asm!</code> 视为黑盒，仅考虑接口规范，而不是指令本身。</li>
<li>允许通过特定于 target 的机制进行运行时代码补丁。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-asm.naked-rules.unwind"><a class="rule-link" href="#r-asm.naked-rules.unwind" title="asm.naked-rules.unwind"><span>[asm<wbr>.naked-rules<wbr>.unwind]</span></a>
</div>

<ul>
<li>允许从 <code>naked_asm!</code> 块中展开。
<ul>
<li>为了保证行为正确，必须使用发出展开元数据的适当汇编指令。</li>
</ul>
</li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>#[unsafe(naked)]
extern "sysv64-unwind" fn unwinding_naked() {
    core::arch::naked_asm!(
        // 这里的 "CFI" 代表 "调用栈帧信息" (call frame information)。
        ".cfi_startproc",
        // CFA (规范栈帧地址) 是 `call` 之前 `rsp` 的值，
        // 即在返回地址 `rip` 被压入 `rsp` 之前的值，
        // 所以在进入函数时（在 `rip` 被压入后），
        // 它在内存中比 `rsp` 高 8 个字节。
        //
        // 这是默认设置，所以我们不必写它。
        //".cfi_def_cfa rsp, 8",
        //
        // 传统做法是保留基指针，所以我们就这么做。
        "push rbp",
        // 既然我们现在已在内存中将栈向下扩展了 8 个字节，
        // 我们需要将从 `rsp` 到 CFA 的偏移量再调整 8 个字节。
        ".cfi_adjust_cfa_offset 8",
        // 然后我们还注释了我们将调用者的 `rbp` 值相对于 CFA 存储在哪里，
        // 以便在展开到调用者时可以找到它，以防我们需要它
        // 来计算调用者相对于它的 CFA。
        //
        // 在这里，我们从 CFA 下方 16 字节开始存储调用者的 `rbp`。
        // 即从 CFA 开始，首先是 `rip`（从 CFA 下方 8 字节开始并持续到它），
        // 然后是我们刚刚压入的调用者的 `rbp`。
        ".cfi_offset rbp, -16",
        // 按照传统，我们将基指针设置为栈指针的值。
        // 这样，基指针在整个函数体中保持不变。
        "mov rbp, rsp",
        // 我们现在可以跟踪从基指针到 CFA 的偏移量。
        // 这意味着直到最后我们都不需要再做任何调整，
        // 因为我们不改变 `rbp`。
        ".cfi_def_cfa_register rbp",
        // 我们现在可以调用一个可能产生恐慌的函数。
        "call {f}",
        // 返回后，我们恢复 `rbp` 以准备返回我们自己。
        "pop rbp",
        // 现在我们已经恢复了 `rbp`，我们必须再次根据 `rsp`
        // 指定到 CFA 的偏移量。
        ".cfi_def_cfa rsp, 8",
        // 现在我们可以返回了。
        "ret",
        ".cfi_endproc",
        f = sym may_panic,
    )
}

extern "sysv64-unwind" fn may_panic() {
    panic!("unwind");
}
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>有关上述 <code>cfi</code> 汇编指令的更多信息，请参阅以下资源：</p>
<ul>
<li><a href="https://sourceware.org/binutils/docs/as/CFI-directives.html">Using <code>as</code> - CFI directives</a></li>
<li><a href="https://dwarfstd.org/doc/DWARF5.pdf">DWARF Debugging Information Format Version 5</a></li>
<li><a href="https://www.imperialviolet.org/2017/01/18/cfi.html">ImperialViolet - CFI directives in assembly files</a></li>
</ul>
</blockquote>
</div>

<div class="rule" id="r-asm.validity"><a class="rule-link" href="#r-asm.validity" title="asm.validity"><span>[asm<wbr>.validity]</span></a>
</div>

<h3 id="正确性和有效性"><a class="header" href="#正确性和有效性">正确性和有效性</a></h3>
<div class="rule" id="r-asm.validity.necessary-but-not-sufficient"><a class="rule-link" href="#r-asm.validity.necessary-but-not-sufficient" title="asm.validity.necessary-but-not-sufficient"><span>[asm<wbr>.validity<wbr>.necessary-but-not-sufficient]</span></a>
</div>

<p>除了所有先前的规则外，<code>asm!</code> 的字符串参数最终必须变为——在评估了所有其他参数、执行了格式化并转换了操作数之后——在语法上正确且在语义上对于 target 架构有效。格式化规则允许编译器生成具有正确语法的汇编代码。关于操作数的规则允许将 Rust 操作数有效转换进出汇编代码。遵守这些规则是必要的，但对于最终展开的汇编代码既正确又有效是不充分的。例如：</p>
<ul>
<li>格式化后，参数可能被放置在语法上不正确的位置</li>
<li>指令可能书写正确，但给出了架构上无效的操作数</li>
<li>架构上未指定的指令可能会被汇编成未指定的代码</li>
<li>一组指令，即使每个指令都正确且有效，如果紧接着放置也可能导致未定义行为</li>
</ul>
<div class="rule" id="r-asm.validity.non-exhaustive"><a class="rule-link" href="#r-asm.validity.non-exhaustive" title="asm.validity.non-exhaustive"><span>[asm<wbr>.validity<wbr>.non-exhaustive]</span></a>
</div>

<p>因此，这些规则是 <em>非详尽的</em> 。编译器不被要求检查初始字符串或最终生成的汇编代码的正确性和有效性。汇编器可以检查正确性和有效性，但不是必须这样做。使用 <code>asm!</code> 时，一个排版错误可能就足以使程序不健全，而汇编规则可能包括数千页的架构参考手册。程序员应当行使适当的谨慎，因为调用这种 <code>unsafe</code> 能力意味着承担不违反编译器和架构规则的责任。</p>
<div class="rule" id="r-asm.directives"><a class="rule-link" href="#r-asm.directives" title="asm.directives"><span>[asm<wbr>.directives]</span></a>
</div>

<h3 id="指令支持"><a class="header" href="#指令支持">指令支持</a></h3>
<div class="rule" id="r-asm.directives.subset-supported"><a class="rule-link" href="#r-asm.directives.subset-supported" title="asm.directives.subset-supported"><span>[asm<wbr>.directives<wbr>.subset-supported]</span></a>
</div>

<p>内联汇编支持 GNU AS 和 LLVM 内部汇编器所支持的指令子集，如下所示。使用其他指令的结果是特定于汇编器的（可能会导致错误，也可能会被原样接受）。</p>
<div class="rule" id="r-asm.directives.stateful"><a class="rule-link" href="#r-asm.directives.stateful" title="asm.directives.stateful"><span>[asm<wbr>.directives<wbr>.stateful]</span></a>
</div>

<p>如果内联汇编包括任何修改后续汇编处理方式的 “stateful” 指令，则汇编代码必须在内联汇编结束前撤消任何此类指令的影响。</p>
<div class="rule" id="r-asm.directives.supported-directives"><a class="rule-link" href="#r-asm.directives.supported-directives" title="asm.directives.supported-directives"><span>[asm<wbr>.directives<wbr>.supported-directives]</span></a>
</div>

<p>汇编器保证支持以下指令：</p>
<ul>
<li><code>.2byte</code></li>
<li><code>.4byte</code></li>
<li><code>.8byte</code></li>
<li><code>.align</code></li>
<li><code>.alt_entry</code></li>
<li><code>.ascii</code></li>
<li><code>.asciz</code></li>
<li><code>.balign</code></li>
<li><code>.balignl</code></li>
<li><code>.balignw</code></li>
<li><code>.bss</code></li>
<li><code>.byte</code></li>
<li><code>.comm</code></li>
<li><code>.data</code></li>
<li><code>.def</code></li>
<li><code>.double</code></li>
<li><code>.endef</code></li>
<li><code>.equ</code></li>
<li><code>.equiv</code></li>
<li><code>.eqv</code></li>
<li><code>.fill</code></li>
<li><code>.float</code></li>
<li><code>.global</code></li>
<li><code>.globl</code></li>
<li><code>.inst</code></li>
<li><code>.insn</code></li>
<li><code>.lcomm</code></li>
<li><code>.long</code></li>
<li><code>.octa</code></li>
<li><code>.option</code></li>
<li><code>.p2align</code></li>
<li><code>.popsection</code></li>
<li><code>.private_extern</code></li>
<li><code>.pushsection</code></li>
<li><code>.quad</code></li>
<li><code>.scl</code></li>
<li><code>.section</code></li>
<li><code>.set</code></li>
<li><code>.short</code></li>
<li><code>.size</code></li>
<li><code>.skip</code></li>
<li><code>.sleb128</code></li>
<li><code>.space</code></li>
<li><code>.string</code></li>
<li><code>.text</code></li>
<li><code>.type</code></li>
<li><code>.uleb128</code></li>
<li><code>.word</code></li>
</ul>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">#[cfg(target_arch = "x86_64")] {
</span>let bytes: *const u8;
let len: usize;
unsafe {
    core::arch::asm!(
        "jmp 3f", "2: .ascii \"Hello World!\"",
        "3: lea {bytes}, [2b+rip]",
        "mov {len}, 12",
        bytes = out(reg) bytes,
        len = out(reg) len
    );
}

let s = unsafe { core::str::from_utf8_unchecked(core::slice::from_raw_parts(bytes, len)) };

assert_eq!(s, "Hello World!");
<span class="boring">}
</span><span class="boring">}</span></code></pre>
<div class="rule" id="r-asm.target-specific-directives"><a class="rule-link" href="#r-asm.target-specific-directives" title="asm.target-specific-directives"><span>[asm<wbr>.target-specific-directives]</span></a>
</div>

<h4 id="特定于target的指令支持"><a class="header" href="#特定于target的指令支持">特定于target的指令支持</a></h4>
<div class="rule" id="r-asm.target-specific-directives.dwarf-unwinding"><a class="rule-link" href="#r-asm.target-specific-directives.dwarf-unwinding" title="asm.target-specific-directives.dwarf-unwinding"><span>[asm<wbr>.target-specific-directives<wbr>.dwarf-unwinding]</span></a>
</div>

<h5 id="dwarf展开"><a class="header" href="#dwarf展开">Dwarf展开</a></h5>
<p>在支持 DWARF 展开信息的 ELF target 上支持以下指令：</p>
<ul>
<li><code>.cfi_adjust_cfa_offset</code></li>
<li><code>.cfi_def_cfa</code></li>
<li><code>.cfi_def_cfa_offset</code></li>
<li><code>.cfi_def_cfa_register</code></li>
<li><code>.cfi_endproc</code></li>
<li><code>.cfi_escape</code></li>
<li><code>.cfi_lsda</code></li>
<li><code>.cfi_offset</code></li>
<li><code>.cfi_personality</code></li>
<li><code>.cfi_register</code></li>
<li><code>.cfi_rel_offset</code></li>
<li><code>.cfi_remember_state</code></li>
<li><code>.cfi_restore</code></li>
<li><code>.cfi_restore_state</code></li>
<li><code>.cfi_return_column</code></li>
<li><code>.cfi_same_value</code></li>
<li><code>.cfi_sections</code></li>
<li><code>.cfi_signal_frame</code></li>
<li><code>.cfi_startproc</code></li>
<li><code>.cfi_undefined</code></li>
<li><code>.cfi_window_save</code></li>
</ul>
<div class="rule" id="r-asm.target-specific-directives.structured-exception-handling"><a class="rule-link" href="#r-asm.target-specific-directives.structured-exception-handling" title="asm.target-specific-directives.structured-exception-handling"><span>[asm<wbr>.target-specific-directives<wbr>.structured-exception-handling]</span></a>
</div>

<h5 id="结构化异常处理"><a class="header" href="#结构化异常处理">结构化异常处理</a></h5>
<p>在具有结构化异常处理的 target 上，保证支持以下附加指令：</p>
<ul>
<li><code>.seh_endproc</code></li>
<li><code>.seh_endprologue</code></li>
<li><code>.seh_proc</code></li>
<li><code>.seh_pushreg</code></li>
<li><code>.seh_savereg</code></li>
<li><code>.seh_setframe</code></li>
<li><code>.seh_stackalloc</code></li>
</ul>
<div class="rule" id="r-asm.target-specific-directives.x86"><a class="rule-link" href="#r-asm.target-specific-directives.x86" title="asm.target-specific-directives.x86"><span>[asm<wbr>.target-specific-directives<wbr>.x86]</span></a>
</div>

<h5 id="x8632-位和-64-位"><a class="header" href="#x8632-位和-64-位">x86（32 位和 64 位）</a></h5>
<p>在 x86 target（32 位和 64 位）上，保证支持以下附加指令：</p>
<ul>
<li><code>.nops</code></li>
<li><code>.code16</code></li>
<li><code>.code32</code></li>
<li><code>.code64</code></li>
</ul>
<p>仅当在退出汇编代码之前将状态重置为默认值时，才支持使用 <code>.code16</code>、<code>.code32</code> 和 <code>.code64</code> 指令。32 位 x86 默认使用 <code>.code32</code>，x86_64 默认使用 <code>.code64</code>。</p>
<div class="rule" id="r-asm.target-specific-directives.arm-32-bit"><a class="rule-link" href="#r-asm.target-specific-directives.arm-32-bit" title="asm.target-specific-directives.arm-32-bit"><span>[asm<wbr>.target-specific-directives<wbr>.arm-32-bit]</span></a>
</div>

<h5 id="arm32-位"><a class="header" href="#arm32-位">ARM（32 位）</a></h5>
<p>在 ARM 上，保证支持以下附加指令：</p>
<ul>
<li><code>.even</code></li>
<li><code>.fnstart</code></li>
<li><code>.fnend</code></li>
<li><code>.save</code></li>
<li><code>.movsp</code></li>
<li><code>.code</code></li>
<li><code>.thumb</code></li>
<li><code>.thumb_func</code></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="linkage.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="unsafety.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="linkage.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="unsafety.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/reference-da60281b.js"></script>



    </div>
    </body>
</html>
