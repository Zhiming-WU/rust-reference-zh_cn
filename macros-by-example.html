<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>声明宏 - Rust语言参考手册</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/reference-ce12791d.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-e9a62445.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-be189161.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust语言参考手册</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/rust-lang/reference/" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>
                        <a href="https://github.com/rust-lang/reference/edit/master/src/macros-by-example.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <span class=fa-svg id="git-edit-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M421.7 220.3l-11.3 11.3-22.6 22.6-205 205c-6.6 6.6-14.8 11.5-23.8 14.1L30.8 511c-8.4 2.5-17.5 .2-23.7-6.1S-1.5 489.7 1 481.2L38.7 353.1c2.6-9 7.5-17.2 14.1-23.8l205-205 22.6-22.6 11.3-11.3 33.9 33.9 62.1 62.1 33.9 33.9zM96 353.9l-9.3 9.3c-.9 .9-1.6 2.1-2 3.4l-25.3 86 86-25.3c1.3-.4 2.5-1.1 3.4-2l9.3-9.3H112c-8.8 0-16-7.2-16-16V353.9zM453.3 19.3l39.4 39.4c25 25 25 65.5 0 90.5l-14.5 14.5-22.6 22.6-11.3 11.3-33.9-33.9-62.1-62.1L314.3 67.7l11.3-11.3 22.6-22.6 14.5-14.5c25-25 65.5-25 90.5 0z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <div class="rule" id="r-macro.decl"><a class="rule-link" href="#r-macro.decl" title="macro.decl"><span>[macro<wbr>.decl]</span></a>
</div>

<h1 id="声明宏"><a class="header" href="#声明宏">声明宏</a></h1>
<div class="rule" id="r-macro.decl.syntax"><a class="rule-link" href="#r-macro.decl.syntax" title="macro.decl.syntax"><span>[macro<wbr>.decl<wbr>.syntax]</span></a>
</div>

<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-MacroRulesDefinition" onclick="show_railroad()"><a href="macros-by-example.html#railroad-MacroRulesDefinition">MacroRulesDefinition</a></span> → <br>    <span class="grammar-literal">macro_rules</span> <span class="grammar-literal">!</span> <span class="grammar-text"><a href="identifiers.html#grammar-IDENTIFIER">IDENTIFIER</a></span> <span class="grammar-text"><a href="macros-by-example.html#grammar-MacroRulesDef">MacroRulesDef</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroRulesDef" onclick="show_railroad()"><a href="macros-by-example.html#railroad-MacroRulesDef">MacroRulesDef</a></span> → <br>      <span class="grammar-literal">(</span> <span class="grammar-text"><a href="macros-by-example.html#grammar-MacroRules">MacroRules</a></span> <span class="grammar-literal">)</span> <span class="grammar-literal">;</span> <br>    | <span class="grammar-literal">[</span> <span class="grammar-text"><a href="macros-by-example.html#grammar-MacroRules">MacroRules</a></span> <span class="grammar-literal">]</span> <span class="grammar-literal">;</span> <br>    | <span class="grammar-literal">{</span> <span class="grammar-text"><a href="macros-by-example.html#grammar-MacroRules">MacroRules</a></span> <span class="grammar-literal">}</span></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroRules" onclick="show_railroad()"><a href="macros-by-example.html#railroad-MacroRules">MacroRules</a></span> → <br>    <span class="grammar-text"><a href="macros-by-example.html#grammar-MacroRule">MacroRule</a></span> ( <span class="grammar-literal">;</span> <span class="grammar-text"><a href="macros-by-example.html#grammar-MacroRule">MacroRule</a></span> )<sup>*</sup> <span class="grammar-literal">;</span><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroRule" onclick="show_railroad()"><a href="macros-by-example.html#railroad-MacroRule">MacroRule</a></span> → <br>    <span class="grammar-text"><a href="macros-by-example.html#grammar-MacroMatcher">MacroMatcher</a></span> <span class="grammar-literal">=&gt;</span> <span class="grammar-text"><a href="macros-by-example.html#grammar-MacroTranscriber">MacroTranscriber</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroMatcher" onclick="show_railroad()"><a href="macros-by-example.html#railroad-MacroMatcher">MacroMatcher</a></span> → <br>      <span class="grammar-literal">(</span> <span class="grammar-text"><a href="macros-by-example.html#grammar-MacroMatch">MacroMatch</a></span><sup>*</sup> <span class="grammar-literal">)</span> <br>    | <span class="grammar-literal">[</span> <span class="grammar-text"><a href="macros-by-example.html#grammar-MacroMatch">MacroMatch</a></span><sup>*</sup> <span class="grammar-literal">]</span> <br>    | <span class="grammar-literal">{</span> <span class="grammar-text"><a href="macros-by-example.html#grammar-MacroMatch">MacroMatch</a></span><sup>*</sup> <span class="grammar-literal">}</span></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroMatch" onclick="show_railroad()"><a href="macros-by-example.html#railroad-MacroMatch">MacroMatch</a></span> → <br>      <span class="grammar-text"><a href="tokens.html#grammar-Token">Token</a></span><sub class="grammar-text">except <code>$</code> and <a href="tokens.html#r-lex.token.delim">delimiters</a></sub> <br>    | <span class="grammar-text"><a href="macros-by-example.html#grammar-MacroMatcher">MacroMatcher</a></span> <br>    | <span class="grammar-literal">$</span> ( <span class="grammar-text"><a href="identifiers.html#grammar-IDENTIFIER_OR_KEYWORD">IDENTIFIER_OR_KEYWORD</a></span><sub class="grammar-text">except <code>crate</code></sub> | <span class="grammar-text"><a href="identifiers.html#grammar-RAW_IDENTIFIER">RAW_IDENTIFIER</a></span> ) <span class="grammar-literal">:</span> <span class="grammar-text"><a href="macros-by-example.html#grammar-MacroFragSpec">MacroFragSpec</a></span> <br>    | <span class="grammar-literal">$</span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="macros-by-example.html#grammar-MacroMatch">MacroMatch</a></span><sup>+</sup> <span class="grammar-literal">)</span> <span class="grammar-text"><a href="macros-by-example.html#grammar-MacroRepSep">MacroRepSep</a></span><sup>?</sup> <span class="grammar-text"><a href="macros-by-example.html#grammar-MacroRepOp">MacroRepOp</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroFragSpec" onclick="show_railroad()"><a href="macros-by-example.html#railroad-MacroFragSpec">MacroFragSpec</a></span> → <br>      <span class="grammar-literal">block</span> | <span class="grammar-literal">expr</span> | <span class="grammar-literal">expr_2021</span> | <span class="grammar-literal">ident</span> | <span class="grammar-literal">item</span> | <span class="grammar-literal">lifetime</span> | <span class="grammar-literal">literal</span> <br>    | <span class="grammar-literal">meta</span> | <span class="grammar-literal">pat</span> | <span class="grammar-literal">pat_param</span> | <span class="grammar-literal">path</span> | <span class="grammar-literal">stmt</span> | <span class="grammar-literal">tt</span> | <span class="grammar-literal">ty</span> | <span class="grammar-literal">vis</span></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroRepSep" onclick="show_railroad()"><a href="macros-by-example.html#railroad-MacroRepSep">MacroRepSep</a></span> → <span class="grammar-text"><a href="tokens.html#grammar-Token">Token</a></span><sub class="grammar-text">except <a href="tokens.html#r-lex.token.delim">delimiters</a> and <a href="macros-by-example.html#grammar-MacroRepOp">MacroRepOp</a></sub></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroRepOp" onclick="show_railroad()"><a href="macros-by-example.html#railroad-MacroRepOp">MacroRepOp</a></span> → <span class="grammar-literal">*</span> | <span class="grammar-literal">+</span> | <span class="grammar-literal">?</span></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroTranscriber" onclick="show_railroad()"><a href="macros-by-example.html#railroad-MacroTranscriber">MacroTranscriber</a></span> → <span class="grammar-text"><a href="macros.html#grammar-DelimTokenTree">DelimTokenTree</a></span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 460px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroRulesDefinition"><svg class="railroad" viewbox="0 0 460 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="macros-by-example.html#grammar-MacroRulesDefinition">
<text class="comment" x="88" y="25">
MacroRulesDefinition</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="108" x="35" y="42" />
<text x="89" y="58">
macro_rules</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="153" y="42" />
<text x="167" y="58">
!</text>
</g>
<a class="link" xlink:href="identifiers.html#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="191" y="42" />
<text x="241" y="58">
IDENTIFIER</text>
</g>
</a>
<a class="link" xlink:href="macros-by-example.html#railroad-MacroRulesDef">
<g class="nonterminal">
<rect height="22" width="124" x="301" y="42" />
<text x="363" y="58">
MacroRulesDef</text>
</g>
</a>
<path d=" M 143 53 h 10" />
<path d=" M 181 53 h 10" />
<path d=" M 291 53 h 10" />
</g>
<path d=" M 435 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 425 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 332px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroRulesDef"><svg class="railroad" viewbox="0 0 332 140" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="macros-by-example.html#grammar-MacroRulesDef">
<text class="comment" x="60" y="25">
MacroRulesDef</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 214 0 h 24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="42" />
<text x="73" y="58">
(</text>
</g>
<a class="link" xlink:href="macros-by-example.html#railroad-MacroRules">
<g class="nonterminal">
<rect height="22" width="100" x="97" y="42" />
<text x="147" y="58">
MacroRules</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="207" y="42" />
<text x="221" y="58">
)</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="245" y="42" />
<text x="259" y="58">
;</text>
</g>
<path d=" M 87 53 h 10" />
<path d=" M 197 53 h 10" />
<path d=" M 235 53 h 10" />
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 238 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 238 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 214 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="75" />
<text x="73" y="91">
[</text>
</g>
<a class="link" xlink:href="macros-by-example.html#railroad-MacroRules">
<g class="nonterminal">
<rect height="22" width="100" x="97" y="75" />
<text x="147" y="91">
MacroRules</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="207" y="75" />
<text x="221" y="91">
]</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="245" y="75" />
<text x="259" y="91">
;</text>
</g>
<path d=" M 87 86 h 10" />
<path d=" M 197 86 h 10" />
<path d=" M 235 86 h 10" />
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 176 0 h 38 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="108" />
<text x="73" y="124">
{</text>
</g>
<a class="link" xlink:href="macros-by-example.html#railroad-MacroRules">
<g class="nonterminal">
<rect height="22" width="100" x="97" y="108" />
<text x="147" y="124">
MacroRules</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="207" y="108" />
<text x="221" y="124">
}</text>
</g>
<path d=" M 87 119 h 10" />
<path d=" M 197 119 h 10" />
</g>
</g>
<path d=" M 307 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 297 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 460px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroRules"><svg class="railroad" viewbox="0 0 460 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="macros-by-example.html#grammar-MacroRules">
<text class="comment" x="50" y="25">
MacroRules</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="macros-by-example.html#railroad-MacroRule">
<g class="nonterminal">
<rect height="22" width="92" x="35" y="55" />
<text x="81" y="71">
MacroRule</text>
</g>
</a>
<g class="optional">
<path d=" M 137 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 154 m -74 0 l -5 -5 m 0 10 l 5 -5 m 74 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 161 66 h 12 m 130 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -130 m 68 0 l 5 -5 m 0 10 l -5 -5 m -68 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="173" y="55" />
<text x="187" y="71">
;</text>
</g>
<a class="link" xlink:href="macros-by-example.html#railroad-MacroRule">
<g class="nonterminal">
<rect height="22" width="92" x="211" y="55" />
<text x="257" y="71">
MacroRule</text>
</g>
</a>
<path d=" M 201 66 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 349 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="373" y="55" />
<text x="387" y="71">
;</text>
</g>
</g>
<path d=" M 127 66 h 10" />
<path d=" M 339 66 h 10" />
</g>
<path d=" M 435 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 425 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 390px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroRule"><svg class="railroad" viewbox="0 0 390 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="macros-by-example.html#grammar-MacroRule">
<text class="comment" x="46" y="25">
MacroRule</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<a class="link" xlink:href="macros-by-example.html#railroad-MacroMatcher">
<g class="nonterminal">
<rect height="22" width="116" x="35" y="42" />
<text x="93" y="58">
MacroMatcher</text>
</g>
</a>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="161" y="42" />
<text x="179" y="58">
=&gt;</text>
</g>
<a class="link" xlink:href="macros-by-example.html#railroad-MacroTranscriber">
<g class="nonterminal">
<rect height="22" width="148" x="207" y="42" />
<text x="281" y="58">
MacroTranscriber</text>
</g>
</a>
<path d=" M 151 53 h 10" />
<path d=" M 197 53 h 10" />
</g>
<path d=" M 365 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 355 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 366px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroMatcher"><svg class="railroad" viewbox="0 0 366 216" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="macros-by-example.html#grammar-MacroMatcher">
<text class="comment" x="57" y="25">
MacroMatcher</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 66 h 24 m 248 0 h 24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="55" />
<text x="73" y="71">
(</text>
</g>
<g class="optional">
<path d=" M 97 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 124 m -59 0 l -5 -5 m 0 10 l 5 -5 m 59 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 121 66 h 12 m 100 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -100 m 53 0 l 5 -5 m 0 10 l -5 -5 m -53 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="macros-by-example.html#railroad-MacroMatch">
<g class="nonterminal">
<rect height="22" width="100" x="133" y="55" />
<text x="183" y="71">
MacroMatch</text>
</g>
</a>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="279" y="55" />
<text x="293" y="71">
)</text>
</g>
<path d=" M 87 66 h 10" />
<path d=" M 269 66 h 10" />
</g>
<path d=" M 35 66 a 12 12 0 0 1 12 12 v 22 m 272 0 v -22 a 12 12 0 0 1 12 -12" />
<path d=" M 47 112 v 46 m 272 0 v -46" />
<path d=" M 47 100 v 12 a 12 12 0 0 0 12 12 m 248 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="113" />
<text x="73" y="129">
[</text>
</g>
<g class="optional">
<path d=" M 97 124 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 124 m -59 0 l -5 -5 m 0 10 l 5 -5 m 59 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 121 124 h 12 m 100 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -100 m 53 0 l 5 -5 m 0 10 l -5 -5 m -53 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="macros-by-example.html#railroad-MacroMatch">
<g class="nonterminal">
<rect height="22" width="100" x="133" y="113" />
<text x="183" y="129">
MacroMatch</text>
</g>
</a>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="279" y="113" />
<text x="293" y="129">
]</text>
</g>
<path d=" M 87 124 h 10" />
<path d=" M 269 124 h 10" />
</g>
<path d=" M 47 158 v 12 a 12 12 0 0 0 12 12 m 248 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="171" />
<text x="73" y="187">
{</text>
</g>
<g class="optional">
<path d=" M 97 182 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 124 m -59 0 l -5 -5 m 0 10 l 5 -5 m 59 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 121 182 h 12 m 100 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -100 m 53 0 l 5 -5 m 0 10 l -5 -5 m -53 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="macros-by-example.html#railroad-MacroMatch">
<g class="nonterminal">
<rect height="22" width="100" x="133" y="171" />
<text x="183" y="187">
MacroMatch</text>
</g>
</a>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="279" y="171" />
<text x="293" y="187">
}</text>
</g>
<path d=" M 87 182 h 10" />
<path d=" M 269 182 h 10" />
</g>
</g>
<path d=" M 341 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 331 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 632px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroMatch"><svg class="railroad" viewbox="0 0 632 318" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="macros-by-example.html#grammar-MacroMatch">
<text class="comment" x="50" y="25">
MacroMatch</text>
</a>
<g class="sequence">
<path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 89 h 24 m 208 0 h 330 m -162 0 l -5 -5 m 0 10 l 5 -5 m 162 0" />
<g class="sequence">
<g class="labeledbox">
<rect height="66" width="208" x="59" y="42" />
<path d=" M 59 89 h 8 m 60 0 h 140 m -67 0 l -5 -5 m 0 10 l 5 -5 m 67 0" />
<text class="comment" x="163" y="65">
except `$` and delimiters</text>
<a class="link" xlink:href="tokens.html#railroad-Token">
<g class="nonterminal">
<rect height="22" width="60" x="67" y="78" />
<text x="97" y="94">
Token</text>
</g>
</a>
</g>
</g>
<path d=" M 35 89 a 12 12 0 0 1 12 12 v 17 m 538 0 v -17 a 12 12 0 0 1 12 -12" />
<path d=" M 47 118 v 33 m 538 0 v -33" />
<path d=" M 47 186 v 74 m 0 -34 l -5 -5 m 10 0 l -5 5 m 0 34 m 538 0 v -74 m 0 40 l -5 5 m 10 0 l -5 -5 m 0 -40" />
<path d=" M 47 118 v 0 a 12 12 0 0 0 12 12 m 116 0 h 398 m -196 0 l -5 -5 m 0 10 l 5 -5 m 196 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<a class="link" xlink:href="macros-by-example.html#railroad-MacroMatcher">
<g class="nonterminal">
<rect height="22" width="116" x="59" y="119" />
<text x="117" y="135">
MacroMatcher</text>
</g>
</a>
</g>
<path d=" M 47 151 v 35 a 12 12 0 0 0 12 12 m 470 0 h 44 a 12 12 0 0 0 12 -12 v -35" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="187" />
<text x="73" y="203">
$</text>
</g>
<g class="choice">
<path d=" M 97 198 h 24 m 212 0 h 24" />
<g class="labeledbox">
<rect height="66" width="212" x="121" y="151" />
<path d=" M 121 198 h 8 m 196 0 h 8" />
<text class="comment" x="183" y="174">
except `crate`</text>
<a class="link" xlink:href="identifiers.html#railroad-IDENTIFIER_OR_KEYWORD">
<g class="nonterminal">
<rect height="22" width="196" x="129" y="187" />
<text x="227" y="203">
IDENTIFIER_OR_KEYWORD</text>
</g>
</a>
</g>
<path d=" M 97 198 a 12 12 0 0 1 12 12 v 17 m 236 0 v -17 a 12 12 0 0 1 12 -12" />
<path d=" M 109 227 v 0 a 12 12 0 0 0 12 12 m 132 0 h 80 m -37 0 l -5 -5 m 0 10 l 5 -5 m 37 0 a 12 12 0 0 0 12 -12 v 0" />
<a class="link" xlink:href="identifiers.html#railroad-RAW_IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="132" x="121" y="228" />
<text x="187" y="244">
RAW_IDENTIFIER</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="367" y="187" />
<text x="381" y="203">
:</text>
</g>
<a class="link" xlink:href="macros-by-example.html#railroad-MacroFragSpec">
<g class="nonterminal">
<rect height="22" width="124" x="405" y="187" />
<text x="467" y="203">
MacroFragSpec</text>
</g>
</a>
<path d=" M 87 198 h 10" />
<path d=" M 357 198 h 10" />
<path d=" M 395 198 h 10" />
</g>
<path d=" M 47 260 v 12 a 12 12 0 0 0 12 12 m 514 0 h 0 a 12 12 0 0 0 12 -12 v -12" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="273" />
<text x="73" y="289">
$</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="97" y="273" />
<text x="111" y="289">
(</text>
</g>
<g class="repeat">
<path d=" M 135 284 h 12 m 100 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -100 m 53 0 l 5 -5 m 0 10 l -5 -5 m -53 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<a class="link" xlink:href="macros-by-example.html#railroad-MacroMatch">
<g class="nonterminal">
<rect height="22" width="100" x="147" y="273" />
<text x="197" y="289">
MacroMatch</text>
</g>
</a>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="269" y="273" />
<text x="283" y="289">
)</text>
</g>
<g class="optional">
<path d=" M 307 284 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 108 m -51 0 l -5 -5 m 0 10 l 5 -5 m 51 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<a class="link" xlink:href="macros-by-example.html#railroad-MacroRepSep">
<g class="nonterminal">
<rect height="22" width="108" x="331" y="273" />
<text x="385" y="289">
MacroRepSep</text>
</g>
</a>
</g>
<a class="link" xlink:href="macros-by-example.html#railroad-MacroRepOp">
<g class="nonterminal">
<rect height="22" width="100" x="473" y="273" />
<text x="523" y="289">
MacroRepOp</text>
</g>
</a>
<path d=" M 87 284 h 10" />
<path d=" M 125 284 h 10" />
<path d=" M 259 284 h 10" />
<path d=" M 297 284 h 10" />
<path d=" M 463 284 h 10" />
</g>
</g>
<path d=" M 607 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 89 h 10" />
<path d=" M 597 89 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 210px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroFragSpec"><svg class="railroad" viewbox="0 0 210 536" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="macros-by-example.html#grammar-MacroFragSpec">
<text class="comment" x="60" y="25">
MacroFragSpec</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 60 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="59" y="42" />
<text x="89" y="58">
block</text>
</g>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 116 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 116 0 v -33" />
<path d=" M 47 107 v 33 m 116 0 v -33" />
<path d=" M 47 140 v 33 m 116 0 v -33" />
<path d=" M 47 173 v 33 m 116 0 v -33" />
<path d=" M 47 206 v 33 m 116 0 v -33" />
<path d=" M 47 239 v 33 m 116 0 v -33" />
<path d=" M 47 272 v 33 m 116 0 v -33" />
<path d=" M 47 305 v 33 m 116 0 v -33" />
<path d=" M 47 338 v 33 m 116 0 v -33" />
<path d=" M 47 371 v 33 m 116 0 v -33" />
<path d=" M 47 404 v 33 m 116 0 v -33" />
<path d=" M 47 437 v 33 m 116 0 v -33" />
<path d=" M 47 470 v 33 m 116 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 52 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="75" />
<text x="85" y="91">
expr</text>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 92 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="92" x="59" y="108" />
<text x="105" y="124">
expr_2021</text>
</g>
<path d=" M 47 140 v 0 a 12 12 0 0 0 12 12 m 60 0 h 32 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="60" x="59" y="141" />
<text x="89" y="157">
ident</text>
</g>
<path d=" M 47 173 v 0 a 12 12 0 0 0 12 12 m 52 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="174" />
<text x="85" y="190">
item</text>
</g>
<path d=" M 47 206 v 0 a 12 12 0 0 0 12 12 m 84 0 h 8 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="84" x="59" y="207" />
<text x="101" y="223">
lifetime</text>
</g>
<path d=" M 47 239 v 0 a 12 12 0 0 0 12 12 m 76 0 h 16 a 12 12 0 0 0 12 -12 v 0" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="76" x="59" y="240" />
<text x="97" y="256">
literal</text>
</g>
</g>
<path d=" M 47 272 v 0 a 12 12 0 0 0 12 12 m 52 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="273" />
<text x="85" y="289">
meta</text>
</g>
<path d=" M 47 305 v 0 a 12 12 0 0 0 12 12 m 44 0 h 48 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="306" />
<text x="81" y="322">
pat</text>
</g>
<path d=" M 47 338 v 0 a 12 12 0 0 0 12 12 m 92 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="92" x="59" y="339" />
<text x="105" y="355">
pat_param</text>
</g>
<path d=" M 47 371 v 0 a 12 12 0 0 0 12 12 m 52 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="372" />
<text x="85" y="388">
path</text>
</g>
<path d=" M 47 404 v 0 a 12 12 0 0 0 12 12 m 52 0 h 40 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="52" x="59" y="405" />
<text x="85" y="421">
stmt</text>
</g>
<path d=" M 47 437 v 0 a 12 12 0 0 0 12 12 m 36 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="438" />
<text x="77" y="454">
tt</text>
</g>
<path d=" M 47 470 v 0 a 12 12 0 0 0 12 12 m 36 0 h 56 m -25 0 l -5 -5 m 0 10 l 5 -5 m 25 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="36" x="59" y="471" />
<text x="77" y="487">
ty</text>
</g>
<path d=" M 47 503 v 0 a 12 12 0 0 0 12 12 m 44 0 h 48 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="44" x="59" y="504" />
<text x="81" y="520">
vis</text>
</g>
</g>
<path d=" M 185 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 175 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 327px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroRepSep"><svg class="railroad" viewbox="0 0 327 118" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="macros-by-example.html#grammar-MacroRepSep">
<text class="comment" x="53" y="25">
MacroRepSep</text>
</a>
<g class="sequence">
<path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="labeledbox">
<rect height="66" width="257" x="35" y="42" />
<path d=" M 35 89 h 8 m 60 0 h 189 m -91 0 l -5 -5 m 0 10 l 5 -5 m 91 0" />
<text class="comment" x="163" y="65">
except delimiters and MacroRepOp</text>
<a class="link" xlink:href="tokens.html#railroad-Token">
<g class="nonterminal">
<rect height="22" width="60" x="43" y="78" />
<text x="73" y="94">
Token</text>
</g>
</a>
</g>
<path d=" M 302 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 89 h 10" />
<path d=" M 292 89 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 146px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroRepOp"><svg class="railroad" viewbox="0 0 146 140" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="macros-by-example.html#grammar-MacroRepOp">
<text class="comment" x="50" y="25">
MacroRepOp</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="choice">
<path d=" M 35 53 h 24 m 28 0 h 24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="42" />
<text x="73" y="58">
*</text>
</g>
<path d=" M 35 53 a 12 12 0 0 1 12 12 v 9 m 52 0 v -9 a 12 12 0 0 1 12 -12" />
<path d=" M 47 74 v 33 m 52 0 v -33" />
<path d=" M 47 74 v 0 a 12 12 0 0 0 12 12 m 28 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="75" />
<text x="73" y="91">
+</text>
</g>
<path d=" M 47 107 v 0 a 12 12 0 0 0 12 12 m 28 0 h 0 a 12 12 0 0 0 12 -12 v 0" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="59" y="108" />
<text x="73" y="124">
?</text>
</g>
</g>
<path d=" M 121 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 111 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 202px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroTranscriber"><svg class="railroad" viewbox="0 0 202 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="macros-by-example.html#grammar-MacroTranscriber">
<text class="comment" x="71" y="25">
MacroTranscriber</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<a class="link" xlink:href="macros.html#railroad-DelimTokenTree">
<g class="nonterminal">
<rect height="22" width="132" x="35" y="42" />
<text x="101" y="58">
DelimTokenTree</text>
</g>
</a>
<path d=" M 177 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 167 53 h 10" />
</g>
</g>
</svg>
</div>

</div>

<div class="rule" id="r-macro.decl.intro"><a class="rule-link" href="#r-macro.decl.intro" title="macro.decl.intro"><span>[macro<wbr>.decl<wbr>.intro]</span></a>
</div>

<p><code>macro_rules</code> 允许用户以声明式的方式定义语法扩展。我们称这种扩展为“声明宏”或简称“宏”。</p>
<p>每个声明宏都有一个名称和一条或多条 <em>规则</em> 。每条规则包含两部分：一个 <em>匹配器</em> ，描述它匹配的语法；一个 <em>转录器</em> ，描述成功匹配的调用将替换成的语法。匹配器和转录器都必须由分隔符包围。宏可以展开为表达式、语句、项（包括特型、impl 和外部项）、类型或模式。</p>
<div class="rule" id="r-macro.decl.transcription"><a class="rule-link" href="#r-macro.decl.transcription" title="macro.decl.transcription"><span>[macro<wbr>.decl<wbr>.transcription]</span></a>
</div>

<h2 id="转录"><a class="header" href="#转录">转录</a></h2>
<div class="rule" id="r-macro.decl.transcription.intro"><a class="rule-link" href="#r-macro.decl.transcription.intro" title="macro.decl.transcription.intro"><span>[macro<wbr>.decl<wbr>.transcription<wbr>.intro]</span></a>
</div>

<p>当宏被调用时，宏扩展器会按名称查找宏调用，并依次尝试每条宏规则。它转录第一个成功匹配的规则；如果此操作导致错误，则不会尝试后续匹配。</p>
<div class="rule" id="r-macro.decl.transcription.lookahead"><a class="rule-link" href="#r-macro.decl.transcription.lookahead" title="macro.decl.transcription.lookahead"><span>[macro<wbr>.decl<wbr>.transcription<wbr>.lookahead]</span></a>
</div>

<p>匹配时，不执行前瞻(lookahead)；如果编译器无法逐个词法单元明确地确定如何解析宏调用，则会报错。在下面的示例中，编译器不会在前瞻到标识符之后，去检查后面的词法单元是否是 <code>)</code>，即使那样可以使其明确地解析调用：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! ambiguity {
    ($($i:ident)* $j:ident) =&gt; { };
}

ambiguity!(error); // 错误：局部歧义
<span class="boring">}</span></code></pre>
<div class="rule" id="r-macro.decl.transcription.syntax"><a class="rule-link" href="#r-macro.decl.transcription.syntax" title="macro.decl.transcription.syntax"><span>[macro<wbr>.decl<wbr>.transcription<wbr>.syntax]</span></a>
</div>

<p>在匹配器和转录器中，<code>$</code> 词法单元用于调用宏引擎的特殊行为（在下面的<a href="#元变量">元变量</a>和<a href="#重复">重复</a>中描述）。不属于此类调用的词法单元会被字面匹配和转录，但有一个例外。这个例外是，匹配器的外部分隔符将匹配任意一对分隔符。因此，例如，匹配器 <code>(())</code> 将匹配 <code>{()}</code> 但不匹配 <code>{{}}</code>。字符 <code>$</code> 不能被字面匹配或转录。</p>
<div class="rule" id="r-macro.decl.transcription.fragment"><a class="rule-link" href="#r-macro.decl.transcription.fragment" title="macro.decl.transcription.fragment"><span>[macro<wbr>.decl<wbr>.transcription<wbr>.fragment]</span></a>
</div>

<h3 id="转发匹配到的片段"><a class="header" href="#转发匹配到的片段">转发匹配到的片段</a></h3>
<p>当将一个匹配到的片段转发给另一个声明宏时，第二个宏中的匹配器将看到该片段类型的不透明 AST。第二个宏不能使用字面词法单元来匹配匹配器中的片段，只能使用相同类型的片段说明符。<code>ident</code>、<code>lifetime</code> 和 <code>tt</code> 片段类型是一个例外，它们<em>可以</em>通过字面词法单元进行匹配。下面示例说明了此限制：</p>
<pre class="playground"><code class="language-rust compile_fail edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! foo {
    ($l:expr) =&gt; { bar!($l); }
// 错误：               ^^ 宏调用中不期望此词法单元
}

macro_rules! bar {
    (3) =&gt; {}
}

foo!(3);
<span class="boring">}</span></code></pre>
<p>下面示例说明了在匹配 <code>tt</code> 片段后如何直接匹配词法单元：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 编译通过
macro_rules! foo {
    ($l:tt) =&gt; { bar!($l); }
}

macro_rules! bar {
    (3) =&gt; {}
}

foo!(3);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-macro.decl.meta"><a class="rule-link" href="#r-macro.decl.meta" title="macro.decl.meta"><span>[macro<wbr>.decl<wbr>.meta]</span></a>
</div>

<h2 id="元变量"><a class="header" href="#元变量">元变量</a></h2>
<div class="rule" id="r-macro.decl.meta.intro"><a class="rule-link" href="#r-macro.decl.meta.intro" title="macro.decl.meta.intro"><span>[macro<wbr>.decl<wbr>.meta<wbr>.intro]</span></a>
</div>

<p>在匹配器中，<code>$</code> <em>名称</em> <code>:</code> <em>片段说明符</em> 匹配指定种类的Rust语法片段，并将其绑定到元变量 <code>$</code><em>名称</em>。</p>
<div class="rule" id="r-macro.decl.meta.specifier"><a class="rule-link" href="#r-macro.decl.meta.specifier" title="macro.decl.meta.specifier"><span>[macro<wbr>.decl<wbr>.meta<wbr>.specifier]</span></a>
</div>

<p>有效的片段说明符有：</p>
<ul>
<li><code>block</code>：一个<a href="expressions/block-expr.html#grammar-BlockExpression">块表达式</a></li>
<li><code>expr</code>：一个<a href="expressions.html#grammar-Expression">表达式</a></li>
<li><code>expr_2021</code>：一个<a href="expressions.html#grammar-Expression">表达式</a>，除了<a href="expressions/underscore-expr.html#grammar-UnderscoreExpression">下划线表达式</a>和<a href="expressions/block-expr.html#grammar-ConstBlockExpression">常量块表达式</a>（参见<a href="macros-by-example.html#r-macro.decl.meta.edition2024">macro.decl.meta.edition2024</a>）</li>
<li><code>ident</code>：一个<a href="identifiers.html#grammar-IDENTIFIER_OR_KEYWORD">IDENTIFIER_OR_KEYWORD</a>，除了 <code>_</code>、<a href="identifiers.html#grammar-RAW_IDENTIFIER">RAW_IDENTIFIER</a>或<a href="macros-by-example.html#r-macro.decl.hygiene.crate"><code>$crate</code></a></li>
<li><code>item</code>：一个<a href="items.html#grammar-Item">项</a></li>
<li><code>lifetime</code>：一个<a href="tokens.html#grammar-LIFETIME_TOKEN">LIFETIME_TOKEN</a></li>
<li><code>literal</code>：匹配 <code>-</code><sup>?</sup><a href="expressions/literal-expr.html#grammar-LiteralExpression">字面量表达式</a></li>
<li><code>meta</code>：一个<a href="attributes.html#grammar-Attr">Attr</a>，一个属性的内容</li>
<li><code>pat</code>：一个<a href="patterns.html#grammar-Pattern">模式</a>（参见<a href="macros-by-example.html#r-macro.decl.meta.edition2021">macro.decl.meta.edition2021</a>）</li>
<li><code>pat_param</code>：一个<a href="patterns.html#grammar-PatternNoTopAlt">PatternNoTopAlt</a></li>
<li><code>path</code>：一个<a href="paths.html#grammar-TypePath">TypePath</a>样式的路径</li>
<li><code>stmt</code>：一个<a href="statements.html#grammar-Statement">语句</a>，不带末尾分号（需要分号的项语句除外）</li>
<li><code>tt</code>：一个<a href="macros.html#grammar-TokenTree">TokenTree</a> （一个单独的<a href="tokens.html">词法单元</a>或匹配分隔符 <code>()</code>、<code>[]</code> 或 <code>{}</code> 中的词法单元）</li>
<li><code>ty</code>：一个<a href="types.html#grammar-Type">类型</a></li>
<li><code>vis</code>：一个可能为空的<a href="visibility-and-privacy.html#grammar-Visibility">可见性</a>限定符</li>
</ul>
<div class="rule" id="r-macro.decl.meta.transcription"><a class="rule-link" href="#r-macro.decl.meta.transcription" title="macro.decl.meta.transcription"><span>[macro<wbr>.decl<wbr>.meta<wbr>.transcription]</span></a>
</div>

<p>在转录器中，元变量仅通过 <code>$</code><em>名称</em> 引用，因为片段种类已在匹配器中指定。元变量会被替换为匹配它们的语法元素。元变量可以被转录多次或根本不转录。</p>
<div class="rule" id="r-macro.decl.meta.dollar-crate"><a class="rule-link" href="#r-macro.decl.meta.dollar-crate" title="macro.decl.meta.dollar-crate"><span>[macro<wbr>.decl<wbr>.meta<wbr>.dollar-crate]</span></a>
</div>

<p>关键字元变量 <a href="macros-by-example.html#r-macro.decl.hygiene.crate"><code>$crate</code></a> 可用于指代当前 crate。</p>
<div class="rule" id="r-macro.decl.meta.edition2021"><a class="rule-link" href="#r-macro.decl.meta.edition2021" title="macro.decl.meta.edition2021"><span>[macro<wbr>.decl<wbr>.meta<wbr>.edition2021]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2021</span> 版次差异</p>

<p>从2021版次开始，<code>pat</code> 片段说明符匹配顶层或模式（即，它们接受<a href="patterns.html#grammar-Pattern">模式</a>）。</p>
<p>在2021版次之前，它们匹配的片段与 <code>pat_param</code> 完全相同（即，它们接受<a href="patterns.html#grammar-PatternNoTopAlt">PatternNoTopAlt</a>）。</p>
<p>相关的版次是 <code>macro_rules!</code> 定义生效的版次。</p>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.meta.edition2024"><a class="rule-link" href="#r-macro.decl.meta.edition2024" title="macro.decl.meta.edition2024"><span>[macro<wbr>.decl<wbr>.meta<wbr>.edition2024]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2024</span> 版次差异</p>

<p>在2024版次之前，<code>expr</code>片段说明符不匹配顶层的<a href="expressions/underscore-expr.html#grammar-UnderscoreExpression">下划线表达式</a>或<a href="expressions/block-expr.html#grammar-ConstBlockExpression">常量块表达式</a>。它们在子表达式中是允许的。</p>
<p>存在<code>expr_2021</code>片段说明符是为了保持与2024之前的版次的向后兼容性。</p>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.repetition"><a class="rule-link" href="#r-macro.decl.repetition" title="macro.decl.repetition"><span>[macro<wbr>.decl<wbr>.repetition]</span></a>
</div>

<h2 id="重复"><a class="header" href="#重复">重复</a></h2>
<div class="rule" id="r-macro.decl.repetition.intro"><a class="rule-link" href="#r-macro.decl.repetition.intro" title="macro.decl.repetition.intro"><span>[macro<wbr>.decl<wbr>.repetition<wbr>.intro]</span></a>
</div>

<p>在匹配器和转录器中，重复是通过将要重复的词法单元放在 <code>$(</code>…<code>)</code> 内部，然后跟随一个重复操作符来表示的，可选地在两者之间放置一个分隔词法单元。</p>
<div class="rule" id="r-macro.decl.repetition.separator"><a class="rule-link" href="#r-macro.decl.repetition.separator" title="macro.decl.repetition.separator"><span>[macro<wbr>.decl<wbr>.repetition<wbr>.separator]</span></a>
</div>

<p>分隔词法单元可以是除分隔符或重复操作符之外的任何词法单元，但 <code>;</code> 和 <code>,</code> 最为常见。例如，<code>$( $i:ident ),*</code> 表示任意数量的用逗号分隔的标识符。允许嵌套重复。</p>
<div class="rule" id="r-macro.decl.repetition.operators"><a class="rule-link" href="#r-macro.decl.repetition.operators" title="macro.decl.repetition.operators"><span>[macro<wbr>.decl<wbr>.repetition<wbr>.operators]</span></a>
</div>

<p>重复操作符有：</p>
<ul>
<li><code>*</code> — 表示任意数量的重复。</li>
<li><code>+</code> — 表示任意数量，但至少一个。</li>
<li><code>?</code> — 表示一个可选片段，出现零次或一次。</li>
</ul>
<div class="rule" id="r-macro.decl.repetition.optional-restriction"><a class="rule-link" href="#r-macro.decl.repetition.optional-restriction" title="macro.decl.repetition.optional-restriction"><span>[macro<wbr>.decl<wbr>.repetition<wbr>.optional-restriction]</span></a>
</div>

<p>由于 <code>?</code> 最多表示一次出现，它不能与分隔符一起使用。</p>
<div class="rule" id="r-macro.decl.repetition.fragment"><a class="rule-link" href="#r-macro.decl.repetition.fragment" title="macro.decl.repetition.fragment"><span>[macro<wbr>.decl<wbr>.repetition<wbr>.fragment]</span></a>
</div>

<p>重复片段既匹配又转录为指定数量的片段，并由分隔词法单元分隔。元变量匹配其相应片段的每次重复。例如，上面 <code>$( $i:ident ),*</code> 示例将 <code>$i</code> 匹配到列表中的所有标识符。</p>
<p>在转录期间，对重复施加了额外的限制，以便编译器知道如何正确地展开它们：</p>
<ol>
<li>元变量在转录器中出现的重复次数、种类和嵌套顺序必须与在匹配器中完全相同。因此，对于匹配器 <code>$( $i:ident ),*</code>，转录器 <code>=&gt; { $i }</code>、<code>=&gt; { $( $( $i )* )* }</code> 和 <code>=&gt; { $( $i )+ }</code> 都是非法的，但 <code>=&gt; { $( $i );* }</code> 是正确的，它将逗号分隔的标识符列表替换为分号分隔的列表。</li>
<li>转录器中的每个重复必须至少包含一个元变量，以决定要展开多少次。如果在同一个重复中出现多个元变量，它们必须绑定到相同数量的片段。例如，<code>( $( $i:ident ),* ; $( $j:ident ),* ) =&gt; (( $( ($i,$j) ),* ))</code> 必须绑定与 <code>$j</code> 片段相同数量的 <code>$i</code> 片段。这意味着用 <code>(a, b, c; d, e, f)</code> 调用宏是合法的，并展开为 <code>((a,d), (b,e), (c,f))</code>，但 <code>(a, b, c; d, e)</code> 是非法的，因为它没有相同数量的片段。此要求适用于每个嵌套重复层。</li>
</ol>
<div class="rule" id="r-macro.decl.scope"><a class="rule-link" href="#r-macro.decl.scope" title="macro.decl.scope"><span>[macro<wbr>.decl<wbr>.scope]</span></a>
</div>

<h2 id="作用域导出和导入"><a class="header" href="#作用域导出和导入">作用域、导出和导入</a></h2>
<div class="rule" id="r-macro.decl.scope.intro"><a class="rule-link" href="#r-macro.decl.scope.intro" title="macro.decl.scope.intro"><span>[macro<wbr>.decl<wbr>.scope<wbr>.intro]</span></a>
</div>

<p>由于历史原因，声明宏的作用域不完全像项那样工作。宏有两种形式的作用域：文本作用域和基于路径的作用域。文本作用域基于事物在源文件中出现的顺序，甚至可以跨多个文件，它是默认的作用域。这将在下面进一步解释。基于路径的作用域与项作用域的工作方式完全相同。宏的作用域、导出和导入主要由属性控制。</p>
<div class="rule" id="r-macro.decl.scope.unqualified"><a class="rule-link" href="#r-macro.decl.scope.unqualified" title="macro.decl.scope.unqualified"><span>[macro<wbr>.decl<wbr>.scope<wbr>.unqualified]</span></a>
</div>

<p>当宏通过非限定标识符（不属于多部分路径）调用时，它首先在文本作用域中查找。如果没有结果，则在基于路径的作用域中查找。如果宏的名称使用路径进行限定，则它只在基于路径的作用域中查找。</p>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">use lazy_static::lazy_static; // 基于路径的导入。

macro_rules! lazy_static { // 文本定义。
    (lazy) =&gt; {};
}

lazy_static!{lazy} // 文本查找首先找到我们的宏。
self::lazy_static!{} // 基于路径的查找忽略我们的宏，找到导入的宏。</code></pre>
<div class="rule" id="r-macro.decl.scope.textual"><a class="rule-link" href="#r-macro.decl.scope.textual" title="macro.decl.scope.textual"><span>[macro<wbr>.decl<wbr>.scope<wbr>.textual]</span></a>
</div>

<h3 id="文本作用域"><a class="header" href="#文本作用域">文本作用域</a></h3>
<div class="rule" id="r-macro.decl.scope.textual.intro"><a class="rule-link" href="#r-macro.decl.scope.textual.intro" title="macro.decl.scope.textual.intro"><span>[macro<wbr>.decl<wbr>.scope<wbr>.textual<wbr>.intro]</span></a>
</div>

<p>文本作用域主要基于事物在源文件中出现的顺序，其工作方式类似于用 <code>let</code> 声明的局部变量的作用域，只不过它也适用于模块级别。当使用 <code>macro_rules!</code> 定义宏时，宏在定义之后（请注意，它仍然可以递归使用，因为名称是从调用站点查找的）进入作用域，直到其周围的作用域（通常是模块）关闭。这可以进入子模块，甚至跨越多个文件：</p>
<!-- ignore: requires external modules -->
<pre><code class="language-rust ignore">//// src/lib.rs
mod has_macro {
    // m!{} // 错误：m 不在作用域中。

    macro_rules! m {
        () =&gt; {};
    }
    m!{} // 正常：出现在 m 的声明之后。

    mod uses_macro;
}

// m!{} // 错误：m 不在作用域中。

//// src/has_macro/uses_macro.rs

m!{} // 正常：出现在 src/lib.rs 中 m 的声明之后。</code></pre>
<div class="rule" id="r-macro.decl.scope.textual.shadow"><a class="rule-link" href="#r-macro.decl.scope.textual.shadow" title="macro.decl.scope.textual.shadow"><span>[macro<wbr>.decl<wbr>.scope<wbr>.textual<wbr>.shadow]</span></a>
</div>

<p>多次定义宏不是错误；除非前一个声明已超出作用域，否则最近的声明将遮蔽前一个。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! m {
    (1) =&gt; {};
}

m!(1);

mod inner {
    m!(1);

    macro_rules! m {
        (2) =&gt; {};
    }
    // m!(1); // 错误：没有规则匹配 '1'
    m!(2);

    macro_rules! m {
        (3) =&gt; {};
    }
    m!(3);
}

m!(1);
<span class="boring">}</span></code></pre>
<p>宏也可以在函数内部局部声明和使用，工作方式类似：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo() {
    // m!(); // 错误：m 不在作用域中。
    macro_rules! m {
        () =&gt; {};
    }
    m!();
}

// m!(); // 错误：m 不在作用域中。
<span class="boring">}</span></code></pre>
<div class="rule" id="r-macro.decl.scope.textual.shadow.path-based"><a class="rule-link" href="#r-macro.decl.scope.textual.shadow.path-based" title="macro.decl.scope.textual.shadow.path-based"><span>[macro<wbr>.decl<wbr>.scope<wbr>.textual<wbr>.shadow<wbr>.path-based]</span></a>
</div>

<p>宏的文本作用域名称绑定会遮蔽宏的基于路径的作用域绑定。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! m2 {
    () =&gt; {
        println!("m2");
    };
}

// 解析为下方 use 声明中的基于路径的候选。
m!(); // 打印 "m2\n"

// 引入第二个具有文本作用域的 `m` 候选。
//
// 这将遮蔽本示例其余部分中来自下方的基于路径的候选。
macro_rules! m {
    () =&gt; {
        println!("m");
    };
}

// 引入 `m2` 宏作为基于路径的候选。
//
// 此项在此整个示例中均在作用域内，而不仅仅在 use 声明下方。
use m2 as m;

// 解析为 use 声明上方具有文本作用域的宏候选。
m!(); // 打印 "m\n"
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>有关不允许遮蔽的区域，请参见<a href="names/name-resolution.html#r-names.resolution.expansion.imports.ambiguity">名称解析歧义</a>。</p>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.path-based"><a class="rule-link" href="#r-macro.decl.scope.path-based" title="macro.decl.scope.path-based"><span>[macro<wbr>.decl<wbr>.scope<wbr>.path-based]</span></a>
</div>

<h3 id="基于路径的作用域"><a class="header" href="#基于路径的作用域">基于路径的作用域</a></h3>
<div class="rule" id="r-macro.decl.scope.path-based.intro"><a class="rule-link" href="#r-macro.decl.scope.path-based.intro" title="macro.decl.scope.path-based.intro"><span>[macro<wbr>.decl<wbr>.scope<wbr>.path-based<wbr>.intro]</span></a>
</div>

<p>默认情况下，宏没有基于路径的作用域。宏可以通过两种方式获得基于路径的作用域：</p>
<ul>
<li><a href="items/use-declarations.html#use可见性">use声明重导出</a></li>
<li><a href="macros-by-example.html#r-macro.decl.scope.macro_export"><code>macro_export</code></a></li>
</ul>
<div class="rule" id="r-macro.decl.scope.path.reexport"><a class="rule-link" href="#r-macro.decl.scope.path.reexport" title="macro.decl.scope.path.reexport"><span>[macro<wbr>.decl<wbr>.scope<wbr>.path<wbr>.reexport]</span></a>
</div>

<p>宏可以被重导出，以使其获得来自除 crate 根模块之外的模块的基于路径的作用域。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>mac::m!(); // 正常：基于路径的查找在 mac 模块中找到 `m`。

mod mac {
    // 引入具有文本作用域的宏 `m`。
    macro_rules! m {
        () =&gt; {};
    }

    // 从 `m` 的文本作用域内重导出具有基于路径的作用域。
    pub(crate) use m;
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-macro.decl.scope.path-based.visibility"><a class="rule-link" href="#r-macro.decl.scope.path-based.visibility" title="macro.decl.scope.path-based.visibility"><span>[macro<wbr>.decl<wbr>.scope<wbr>.path-based<wbr>.visibility]</span></a>
</div>

<p>宏具有隐式的 <code>pub(crate)</code> 可见性。<code>#[macro_export]</code> 将隐式可见性更改为 <code>pub</code>。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// 隐式可见性为 `pub(crate)`。
macro_rules! private_m {
    () =&gt; {};
}

// 隐式可见性为 `pub`。
#[macro_export]
macro_rules! pub_m {
    () =&gt; {};
}

pub(crate) use private_m as private_macro; // 正常。
pub use pub_m as pub_macro; // 正常。
<span class="boring">}</span></code></pre>
<pre class="playground"><code class="language-rust compile_fail E0364 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">// 隐式可见性为 `pub(crate)`。
</span><span class="boring">macro_rules! private_m {
</span><span class="boring">    () =&gt; {};
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">// 隐式可见性为 `pub`。
</span><span class="boring">#[macro_export]
</span><span class="boring">macro_rules! pub_m {
</span><span class="boring">    () =&gt; {};
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub(crate) use private_m as private_macro; // 正常。
</span><span class="boring">pub use pub_m as pub_macro; // 正常。
</span><span class="boring">
</span>pub use private_m; // 错误：`private_m` 仅在该 crate 内可见
                   // 且不能在外部重导出。
<span class="boring">}</span></code></pre>
<!-- template:attributes -->
<div class="rule" id="r-macro.decl.scope.macro_use"><a class="rule-link" href="#r-macro.decl.scope.macro_use" title="macro.decl.scope.macro_use"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_use]</span></a>
</div>

<h3 id="macro_use属性"><a class="header" href="#macro_use属性"><code>macro_use</code>属性</a></h3>
<div class="rule" id="r-macro.decl.scope.macro_use.intro"><a class="rule-link" href="#r-macro.decl.scope.macro_use.intro" title="macro.decl.scope.macro_use.intro"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_use<wbr>.intro]</span></a>
</div>

<p><em><code>macro_use</code> <a href="attributes.html#r-attributes">属性</a></em> 有两个目的：它可以用于模块，以扩展其中定义的宏的作用域；它也可以用于 <a href="items/extern-crates.html#r-items.extern-crate"><code>extern crate</code></a>，将其他 crate 中的宏导入到<a href="names/preludes.html#macro_use-prelude"><code>macro_use</code>预导入</a>中。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[macro_use]
mod inner {
    macro_rules! m {
        () =&gt; {};
    }
}
m!(); // 正常
<span class="boring">}</span></code></pre>
<pre><code class="language-rust ignore">#[macro_use]
extern crate log;</code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_use.syntax"><a class="rule-link" href="#r-macro.decl.scope.macro_use.syntax" title="macro.decl.scope.macro_use.syntax"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_use<wbr>.syntax]</span></a>
</div>

<p>当用于模块时，<code>macro_use</code> 属性使用 <a href="attributes.html#grammar-MetaWord">MetaWord</a> 语法。</p>
<p>当用于 <code>extern crate</code> 时，它使用 <a href="attributes.html#grammar-MetaWord">MetaWord</a> 和 <a href="attributes.html#grammar-MetaListIdents">MetaListIdents</a> 语法。有关这些语法如何使用的更多信息，请参见<a href="macros-by-example.html#r-macro.decl.scope.macro_use.prelude">macro.decl.scope.macro_use.prelude</a>。</p>
<div class="rule" id="r-macro.decl.scope.macro_use.allowed-positions"><a class="rule-link" href="#r-macro.decl.scope.macro_use.allowed-positions" title="macro.decl.scope.macro_use.allowed-positions"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_use<wbr>.allowed-positions]</span></a>
</div>

<p><code>macro_use</code> 属性可以应用于模块或 <code>extern crate</code>。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 会忽略在其他位置的使用，但会对其进行 lint。这在将来可能会成为错误。</p>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_use.extern-crate-self"><a class="rule-link" href="#r-macro.decl.scope.macro_use.extern-crate-self" title="macro.decl.scope.macro_use.extern-crate-self"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_use<wbr>.extern-crate-self]</span></a>
</div>

<p><code>macro_use</code> 属性不能用于<a href="items/extern-crates.html#r-items.extern-crate.self"><code>extern crate self</code></a>。</p>
<div class="rule" id="r-macro.decl.scope.macro_use.duplicates"><a class="rule-link" href="#r-macro.decl.scope.macro_use.duplicates" title="macro.decl.scope.macro_use.duplicates"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_use<wbr>.duplicates]</span></a>
</div>

<p><code>macro_use</code> 属性可以在一个形式上使用任意次数。</p>
<p>可以指定 <a href="attributes.html#grammar-MetaListIdents">MetaListIdents</a> 语法中的 <code>macro_use</code> 多个实例。所有指定的宏的并集将被导入。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>在模块上，<code>rustc</code> 会对第一个 <a href="attributes.html#grammar-MetaWord">MetaWord</a> <code>macro_use</code> 属性之后的任何 <code>macro_use</code> 属性进行 lint。</p>
<p>在 <code>extern crate</code> 上，<code>rustc</code> 会对任何由于未导入已被另一个 <code>macro_use</code> 属性导入的宏而没有效果的 <code>macro_use</code> 属性进行 lint。如果两个或更多 <a href="attributes.html#grammar-MetaListIdents">MetaListIdents</a> <code>macro_use</code> 属性导入相同的宏，则会对第一个进行 lint。如果存在任何 <a href="attributes.html#grammar-MetaWord">MetaWord</a> <code>macro_use</code> 属性，则会对所有 <a href="attributes.html#grammar-MetaListIdents">MetaListIdents</a> <code>macro_use</code> 属性进行 lint。如果存在两个或更多 <a href="attributes.html#grammar-MetaWord">MetaWord</a> <code>macro_use</code> 属性，则会对第一个之后的属性进行 lint。</p>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_use.mod-decl"><a class="rule-link" href="#r-macro.decl.scope.macro_use.mod-decl" title="macro.decl.scope.macro_use.mod-decl"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_use<wbr>.mod-decl]</span></a>
</div>

<p>当 <code>macro_use</code> 用于模块时，模块的宏作用域会超出模块的词法作用域。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[macro_use]
mod inner {
    macro_rules! m {
        () =&gt; {};
    }
}
m!(); // 正常
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_use.prelude"><a class="rule-link" href="#r-macro.decl.scope.macro_use.prelude" title="macro.decl.scope.macro_use.prelude"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_use<wbr>.prelude]</span></a>
</div>

<p>在 crate 根目录中的 <code>extern crate</code> 声明上指定 <code>macro_use</code> 会从该 crate 导入导出的宏。</p>
<p>以这种方式导入的宏被导入到<a href="names/preludes.html#macro_use-prelude"><code>macro_use</code>预导入</a>中，而不是文本式地，这意味着它们可以被任何其他名称遮蔽。<code>macro_use</code> 导入的宏可以在 import 语句之前使用。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 目前在冲突时会优先选择最后导入的宏。请不要依赖此行为。这种行为很不寻常，因为 Rust 中的导入通常与顺序无关。<code>macro_use</code> 的这种行为在将来可能会改变。</p>
<p>有关详细信息，请参见 <a href="https://github.com/rust-lang/rust/issues/148025">Rust问题单#148025</a>。</p>
</blockquote>
</div>

<p>当使用 <a href="attributes.html#grammar-MetaWord">MetaWord</a> 语法时，所有导出的宏都会被导入。当使用 <a href="attributes.html#grammar-MetaListIdents">MetaListIdents</a> 语法时，只有指定的宏会被导入。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">#[macro_use(lazy_static)] // 或者 `#[macro_use]` 导入所有宏。
extern crate lazy_static;

lazy_static!{}
// self::lazy_static!{} // 错误：`lazy_static` 未在 `self` 中定义。</code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_use.export"><a class="rule-link" href="#r-macro.decl.scope.macro_use.export" title="macro.decl.scope.macro_use.export"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_use<wbr>.export]</span></a>
</div>

<p>要使用 <code>macro_use</code> 导入的宏必须使用 <a href="macros-by-example.html#r-macro.decl.scope.macro_export"><code>macro_export</code></a> 导出。</p>
<!-- template:attributes -->
<div class="rule" id="r-macro.decl.scope.macro_export"><a class="rule-link" href="#r-macro.decl.scope.macro_export" title="macro.decl.scope.macro_export"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_export]</span></a>
</div>

<h3 id="macro_export属性"><a class="header" href="#macro_export属性"><code>macro_export</code>属性</a></h3>
<div class="rule" id="r-macro.decl.scope.macro_export.intro"><a class="rule-link" href="#r-macro.decl.scope.macro_export.intro" title="macro.decl.scope.macro_export.intro"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_export<wbr>.intro]</span></a>
</div>

<p><em><code>macro_export</code> <a href="attributes.html#r-attributes">属性</a></em> 将宏从 crate 导出，并使其在 crate 根目录中可用，以进行基于路径的解析。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>self::m!();
//  ^^^^ 正常：基于路径的查找在当前模块中找到 `m`。
m!(); // 同上。

mod inner {
    super::m!();
    crate::m!();
}

mod mac {
    #[macro_export]
    macro_rules! m {
        () =&gt; {};
    }
}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_export.syntax"><a class="rule-link" href="#r-macro.decl.scope.macro_export.syntax" title="macro.decl.scope.macro_export.syntax"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_export<wbr>.syntax]</span></a>
</div>

<p><code>macro_export</code> 属性使用 <a href="attributes.html#grammar-MetaWord">MetaWord</a> 和 <a href="attributes.html#grammar-MetaListIdents">MetaListIdents</a> 语法。使用 <a href="attributes.html#grammar-MetaListIdents">MetaListIdents</a> 语法时，它接受单个 <a href="macros-by-example.html#r-macro.decl.scope.macro_export.local_inner_macros"><code>local_inner_macros</code></a> 值。</p>
<div class="rule" id="r-macro.decl.scope.macro_export.allowed-positions"><a class="rule-link" href="#r-macro.decl.scope.macro_export.allowed-positions" title="macro.decl.scope.macro_export.allowed-positions"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_export<wbr>.allowed-positions]</span></a>
</div>

<p><code>macro_export</code> 属性可以应用于 <code>macro_rules</code> 定义。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 会忽略在其他位置的使用，但会对其进行 lint。这在将来可能会成为错误。</p>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_export.duplicates"><a class="rule-link" href="#r-macro.decl.scope.macro_export.duplicates" title="macro.decl.scope.macro_export.duplicates"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_export<wbr>.duplicates]</span></a>
</div>

<p>宏上只有第一次使用 <code>macro_export</code> 有效。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p><code>rustc</code> 会对第一次使用之后的任何使用进行 lint。</p>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_export.path-based"><a class="rule-link" href="#r-macro.decl.scope.macro_export.path-based" title="macro.decl.scope.macro_export.path-based"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_export<wbr>.path-based]</span></a>
</div>

<p>默认情况下，宏只有<a href="macros-by-example.html#r-macro.decl.scope.textual">文本作用域</a>，不能通过路径解析。当使用 <code>macro_export</code> 属性时，该宏会在 crate 根目录中可用，并可以通过其路径引用。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>没有 <code>macro_export</code> 时，宏只有文本作用域，因此宏的基于路径的解析会失败。</p>
<pre class="playground"><code class="language-rust compile_fail E0433 edition2024">macro_rules! m {
    () =&gt; {};
}
self::m!(); // 错误
crate::m!(); // 错误
<span class="boring">fn main() {}</span></code></pre>
<p>有了 <code>macro_export</code>，基于路径的解析就有效了。</p>
<pre class="playground"><code class="language-rust edition2024">#[macro_export]
macro_rules! m {
    () =&gt; {};
}
self::m!(); // 正常
crate::m!(); // 正常
<span class="boring">fn main() {}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_export.export"><a class="rule-link" href="#r-macro.decl.scope.macro_export.export" title="macro.decl.scope.macro_export.export"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_export<wbr>.export]</span></a>
</div>

<p><code>macro_export</code> 属性导致宏从 crate 根目录导出，以便其他 crate 可以通过路径引用它。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>给定 <code>log</code> crate 中的以下内容：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[macro_export]
macro_rules! warn {
    ($message:expr) =&gt; { eprintln!("WARN: {}", $message) };
}
<span class="boring">}</span></code></pre>
<p>从另一个crate中，你可以通过路径引用宏：</p>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">fn main() {
    log::warn!("example warning");
}</code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_export.macro_use"><a class="rule-link" href="#r-macro.decl.scope.macro_export.macro_use" title="macro.decl.scope.macro_export.macro_use"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_export<wbr>.macro_use]</span></a>
</div>

<p><code>macro_export</code> 允许在 <code>extern crate</code> 上使用 <a href="macros-by-example.html#r-macro.decl.scope.macro_use"><code>macro_use</code></a>，将宏导入到 <a href="names/preludes.html#macro_use-prelude"><code>macro_use</code>预导入</a>中。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>给定 <code>log</code> crate 中的以下内容：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[macro_export]
macro_rules! warn {
    ($message:expr) =&gt; { eprintln!("WARN: {}", $message) };
}
<span class="boring">}</span></code></pre>
<p>在依赖 crate 中使用 <code>macro_use</code> 允许你从预导入中使用宏：</p>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">#[macro_use]
extern crate log;

pub mod util {
    pub fn do_thing() {
        // 通过宏预导入解析。
        warn!("example warning");
    }
}</code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.scope.macro_export.local_inner_macros"><a class="rule-link" href="#r-macro.decl.scope.macro_export.local_inner_macros" title="macro.decl.scope.macro_export.local_inner_macros"><span>[macro<wbr>.decl<wbr>.scope<wbr>.macro_export<wbr>.local_inner_macros]</span></a>
</div>

<p>将 <code>local_inner_macros</code> 添加到 <code>macro_export</code> 属性会使宏定义中的所有单段宏调用具有隐式的 <code>$crate::</code> 前缀。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>这主要旨在作为一种工具，用于迁移在语言中添加 <a href="macros-by-example.html#r-macro.decl.hygiene.crate"><code>$crate</code></a> 之前编写的代码，以使其与 Rust 2018 基于路径的宏导入协同工作。不建议在新代码中使用它。</p>
</blockquote>
</div>

<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[macro_export(local_inner_macros)]
macro_rules! helped {
    () =&gt; { helper!() } // 自动转换为 $crate::helper!()。
}

#[macro_export]
macro_rules! helper {
    () =&gt; { () }
}
<span class="boring">}</span></code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.hygiene"><a class="rule-link" href="#r-macro.decl.hygiene" title="macro.decl.hygiene"><span>[macro<wbr>.decl<wbr>.hygiene]</span></a>
</div>

<h2 id="卫生"><a class="header" href="#卫生">卫生</a></h2>
<div class="rule" id="r-macro.decl.hygiene.intro"><a class="rule-link" href="#r-macro.decl.hygiene.intro" title="macro.decl.hygiene.intro"><span>[macro<wbr>.decl<wbr>.hygiene<wbr>.intro]</span></a>
</div>

<p>声明宏具有 <em>混合站点卫生</em> 。这意味着<a href="expressions/loop-expr.html#loop-labels">循环标签</a>、<a href="expressions/loop-expr.html#r-expr.loop.block-labels">块标签</a>和局部变量在宏定义站点查找，而其他符号在宏调用站点查找。例如：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let x = 1;
fn func() {
    unreachable!("this is never called")
}

macro_rules! check {
    () =&gt; {
        assert_eq!(x, 1); // 使用定义站点的 `x`。
        func();           // 使用调用站点的 `func`。
    };
}

{
    let x = 2;
    fn func() { /* 不会恐慌 */ }
    check!();
}
<span class="boring">}</span></code></pre>
<p>在宏展开中定义的标签和局部变量不共享于不同的调用之间，因此此代码无法编译：</p>
<pre class="playground"><code class="language-rust compile_fail E0425 edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>macro_rules! m {
    (define) =&gt; {
        let x = 1;
    };
    (refer) =&gt; {
        dbg!(x);
    };
}

m!(define);
m!(refer);
<span class="boring">}</span></code></pre>
<div class="rule" id="r-macro.decl.hygiene.crate"><a class="rule-link" href="#r-macro.decl.hygiene.crate" title="macro.decl.hygiene.crate"><span>[macro<wbr>.decl<wbr>.hygiene<wbr>.crate]</span></a>
</div>

<p>一个特殊情况是 <code>$crate</code> 元变量。它指代定义宏的 crate，可以用于路径的开头，以查找在调用站点不在作用域内的项或宏。</p>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">//// `helper_macro` crate 中的定义。
#[macro_export]
macro_rules! helped {
    // () =&gt; { helper!() } // 这可能会因 'helper' 不在作用域中而导致错误。
    () =&gt; { $crate::helper!() }
}

#[macro_export]
macro_rules! helper {
    () =&gt; { () }
}

//// 在另一个 crate 中的使用。
// 请注意，`helper_macro::helper` 并未导入！
use helper_macro::helped;

fn unit() {
    helped!();
}</code></pre>
<p>请注意，由于 <code>$crate</code> 指代当前 crate，因此在引用非宏项时必须与完全限定的模块路径一起使用：</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub mod inner {
    #[macro_export]
    macro_rules! call_foo {
        () =&gt; { $crate::inner::foo() };
    }

    pub fn foo() {}
}
<span class="boring">}</span></code></pre>
<div class="rule" id="r-macro.decl.hygiene.vis"><a class="rule-link" href="#r-macro.decl.hygiene.vis" title="macro.decl.hygiene.vis"><span>[macro<wbr>.decl<wbr>.hygiene<wbr>.vis]</span></a>
</div>

<p>此外，即使 <code>$crate</code> 允许宏在展开时引用其自身 crate 内的项，其使用对可见性也没有影响。被引用的项或宏仍必须从调用站点可见。在下面的示例中，任何尝试从其 crate 外部调用 <code>call_foo!()</code> 的操作都会失败，因为 <code>foo()</code> 不是公共的。</p>
<pre class="playground"><code class="language-rust edition2024"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[macro_export]
macro_rules! call_foo {
    () =&gt; { $crate::foo() };
}

fn foo() {}
<span class="boring">}</span></code></pre>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>在 Rust 1.30 之前，不支持 <code>$crate</code> 和 <a href="macros-by-example.html#r-macro.decl.scope.macro_export.local_inner_macros"><code>local_inner_macros</code></a>。它们是与<a href="macros-by-example.html#r-macro.decl.scope.macro_export">基于路径的宏导入</a>一起添加的，以确保辅助宏不需要由导出宏的 crate 用户手动导入。为早期 Rust 版本编写的、使用辅助宏的 crate 需要修改以使用 <code>$crate</code> 或 <code>local_inner_macros</code>，才能与基于路径的导入良好协作。</p>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.follow-set"><a class="rule-link" href="#r-macro.decl.follow-set" title="macro.decl.follow-set"><span>[macro<wbr>.decl<wbr>.follow-set]</span></a>
</div>

<h2 id="后续集歧义限制"><a class="header" href="#后续集歧义限制">后续集歧义限制</a></h2>
<div class="rule" id="r-macro.decl.follow-set.intro"><a class="rule-link" href="#r-macro.decl.follow-set.intro" title="macro.decl.follow-set.intro"><span>[macro<wbr>.decl<wbr>.follow-set<wbr>.intro]</span></a>
</div>

<p>宏系统使用的解析器功能相当强大，但它受到限制，以防止在语言的当前或未来版本中出现歧义。</p>
<p>具体来说，除了关于歧义展开的规则之外，元变量匹配的非终结符之后必须跟随一个已被确定可以安全地用于该类匹配的词法单元。</p>
<p>例如，像 <code>$i:expr [ , ]</code> 这样的宏匹配器理论上今天可以在 Rust 中接受，因为 <code>[,]</code> 不能是合法表达式的一部分，因此解析将始终是明确的。然而，由于 <code>[</code> 可以开始尾随表达式，<code>[</code> 不是一个可以安全地排除在表达式之后出现的字符。如果在后续的 Rust 版本中接受 <code>[,]</code>，这个匹配器将变得模糊或解析错误，从而破坏现有代码。然而，像 <code>$i:expr,</code> 或 <code>$i:expr;</code> 这样的匹配器是合法的，因为 <code>,</code> 和 <code>;</code> 是合法的表达式分隔符。具体规则是：</p>
<div class="rule" id="r-macro.decl.follow-set.token-expr-stmt"><a class="rule-link" href="#r-macro.decl.follow-set.token-expr-stmt" title="macro.decl.follow-set.token-expr-stmt"><span>[macro<wbr>.decl<wbr>.follow-set<wbr>.token-expr-stmt]</span></a>
</div>

<ul>
<li><code>expr</code> 和 <code>stmt</code> 只能跟随以下之一：<code>=&gt;</code>、<code>,</code> 或 <code>;</code>。</li>
</ul>
<div class="rule" id="r-macro.decl.follow-set.token-pat_param"><a class="rule-link" href="#r-macro.decl.follow-set.token-pat_param" title="macro.decl.follow-set.token-pat_param"><span>[macro<wbr>.decl<wbr>.follow-set<wbr>.token-pat_param]</span></a>
</div>

<ul>
<li><code>pat_param</code> 只能跟随以下之一：<code>=&gt;</code>、<code>,</code>、<code>=</code>、<code>|</code>、<code>if</code> 或 <code>in</code>。</li>
</ul>
<div class="rule" id="r-macro.decl.follow-set.token-pat"><a class="rule-link" href="#r-macro.decl.follow-set.token-pat" title="macro.decl.follow-set.token-pat"><span>[macro<wbr>.decl<wbr>.follow-set<wbr>.token-pat]</span></a>
</div>

<ul>
<li><code>pat</code> 只能跟随以下之一：<code>=&gt;</code>、<code>,</code>、<code>=</code>、<code>if</code> 或 <code>in</code>。</li>
</ul>
<div class="rule" id="r-macro.decl.follow-set.token-path-ty"><a class="rule-link" href="#r-macro.decl.follow-set.token-path-ty" title="macro.decl.follow-set.token-path-ty"><span>[macro<wbr>.decl<wbr>.follow-set<wbr>.token-path-ty]</span></a>
</div>

<ul>
<li><code>path</code> 和 <code>ty</code> 只能跟随以下之一：<code>=&gt;</code>、<code>,</code>、<code>=</code>、<code>|</code>、<code>;</code>、<code>:</code>、<code>&gt;</code>、<code>&gt;&gt;</code>、<code>[</code>、<code>{</code>、<code>as</code>、<code>where</code> 或 <code>block</code> 片段说明符的宏变量。</li>
</ul>
<div class="rule" id="r-macro.decl.follow-set.token-vis"><a class="rule-link" href="#r-macro.decl.follow-set.token-vis" title="macro.decl.follow-set.token-vis"><span>[macro<wbr>.decl<wbr>.follow-set<wbr>.token-vis]</span></a>
</div>

<ul>
<li><code>vis</code> 只能跟随以下之一：<code>,</code>，非原始 <code>priv</code> 之外的标识符，任何可以开始类型的词法单元，或具有 <code>ident</code>、<code>ty</code> 或 <code>path</code> 片段说明符的元变量。</li>
</ul>
<div class="rule" id="r-macro.decl.follow-set.token-other"><a class="rule-link" href="#r-macro.decl.follow-set.token-other" title="macro.decl.follow-set.token-other"><span>[macro<wbr>.decl<wbr>.follow-set<wbr>.token-other]</span></a>
</div>

<ul>
<li>所有其他片段说明符都没有限制。</li>
</ul>
<div class="rule" id="r-macro.decl.follow-set.edition2021"><a class="rule-link" href="#r-macro.decl.follow-set.edition2021" title="macro.decl.follow-set.edition2021"><span>[macro<wbr>.decl<wbr>.follow-set<wbr>.edition2021]</span></a>
</div>

<div class="alert alert-edition">
<blockquote>
<p class="alert-title"><span class="alert-title-edition">2021</span> 版次差异</p>

<p>在 2021 版次之前，<code>pat</code> 后面也可以跟随 <code>|</code>。</p>
</blockquote>
</div>

<div class="rule" id="r-macro.decl.follow-set.repetition"><a class="rule-link" href="#r-macro.decl.follow-set.repetition" title="macro.decl.follow-set.repetition"><span>[macro<wbr>.decl<wbr>.follow-set<wbr>.repetition]</span></a>
</div>

<p>当涉及重复时，规则适用于所有可能的展开次数，并考虑分隔符。这意味着：</p>
<ul>
<li>如果重复包含分隔符，则该分隔符必须能够跟随重复的内容。</li>
<li>如果重复可以多次重复（<code>*</code> 或 <code>+</code>），则内容必须能够跟随自身。</li>
<li>重复的内容必须能够跟随其之前的内容，并且其之后的内容必须能够跟随重复的内容。</li>
<li>如果重复可以匹配零次（<code>*</code> 或 <code>?</code>），则其之后的内容必须能够跟随其之前的内容。</li>
</ul>
<p>有关更多详细信息，请参见<a href="macro-ambiguity.html">形式化规范</a>。</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="macros.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="procedural-macros.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="macros.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="procedural-macros.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/reference-da60281b.js"></script>


        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const fragmentMap =
                    {"#path-based-scope":"macros-by-example.html#the-macro_export-attribute"}
                ;
                const target = fragmentMap[window.location.hash];
                if (target) {
                    let url = new URL(target, window.location.href);
                    window.location.replace(url.href);
                }
            });
        </script>

    </div>
    </body>
</html>
