<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>过程宏 - Rust语言参考手册</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/reference-ce12791d.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-4a8128a0.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-be189161.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust语言参考手册</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/zhiming-wu/rust-reference-zh_cn/" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <!-- https://github.com/rust-lang/reference/blob/master/src/procedural-macros.md -->
<!-- commit 68bdfd15fa9feebfbf94a06cf574de598e239198 -->
<div class="rule" id="r-macro.proc"><a class="rule-link" href="#r-macro.proc" title="macro.proc"><span>[macro<wbr>.proc]</span></a>
</div>

<h1 id="过程宏"><a class="header" href="#过程宏">过程宏</a></h1>
<div class="rule" id="r-macro.proc.intro"><a class="rule-link" href="#r-macro.proc.intro" title="macro.proc.intro"><span>[macro<wbr>.proc<wbr>.intro]</span></a>
</div>

<p><em>过程宏</em>允许通过执行函数来创建语法扩展。
过程宏分为三种类型：</p>
<ul>
<li><a href="#proc_macro属性">函数式宏</a> - <code>custom!(...)</code></li>
<li><a href="procedural-macros.html#r-macro.proc.derive">派生宏</a> - <code>#[derive(CustomDerive)]</code></li>
<li><a href="#proc_macro_attribute属性">属性宏</a> - <code>#[CustomAttribute]</code></li>
</ul>
<p>过程宏允许你在编译时运行操作Rust语法的代码，既可以消费Rust语法，也可以生成Rust语法。你可以将过程宏视为从一个AST到另一个AST的函数。</p>
<div class="rule" id="r-macro.proc.def"><a class="rule-link" href="#r-macro.proc.def" title="macro.proc.def"><span>[macro<wbr>.proc<wbr>.def]</span></a>
</div>

<p>过程宏必须定义在<a href="linkage.html">crate类型</a>为<code>proc-macro</code>的crate根目录中。
宏不能在其定义的crate中使用，只能在另一个crate中导入后才能使用。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>当使用Cargo时，过程宏crate通过清单中的<code>proc-macro</code>键定义：</p>
<pre><code class="language-toml">[lib]
proc-macro = true
</code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.proc.result"><a class="rule-link" href="#r-macro.proc.result" title="macro.proc.result"><span>[macro<wbr>.proc<wbr>.result]</span></a>
</div>

<p>作为函数，它们必须返回语法、<a href="panic.html#r-panic">恐慌</a>，或无限循环。返回的语法会根据过程宏的种类替换或添加语法。编译器会捕获<a href="panic.html#r-panic">恐慌</a>，并将其转换为编译器错误。无限循环不会被编译器捕获，这会导致编译器挂起。</p>
<p>过程宏在编译期间运行，因此拥有与编译器相同的资源。例如，标准输入、错误和输出与编译器可访问的相同。同样，文件访问也相同。因此，过程宏具有与<a href="../cargo/reference/build-scripts.html">Cargo的构建脚本</a>相同的安全问题。</p>
<div class="rule" id="r-macro.proc.error"><a class="rule-link" href="#r-macro.proc.error" title="macro.proc.error"><span>[macro<wbr>.proc<wbr>.error]</span></a>
</div>

<p>过程宏有两种报告错误的方式。第一种是<a href="panic.html#r-panic">恐慌</a>。第二种是发出一个<a href="../core/macro.compile_error.html"><code>compile_error</code></a>宏调用。</p>
<div class="rule" id="r-macro.proc.proc_macro-crate"><a class="rule-link" href="#r-macro.proc.proc_macro-crate" title="macro.proc.proc_macro-crate"><span>[macro<wbr>.proc<wbr>.proc_macro-crate]</span></a>
</div>

<h2 id="proc_macro-crate"><a class="header" href="#proc_macro-crate"><code>proc_macro</code> crate</a></h2>
<div class="rule" id="r-macro.proc.proc_macro-crate.intro"><a class="rule-link" href="#r-macro.proc.proc_macro-crate.intro" title="macro.proc.proc_macro-crate.intro"><span>[macro<wbr>.proc<wbr>.proc_macro-crate<wbr>.intro]</span></a>
</div>

<p>过程宏crate几乎总是会链接到编译器提供的<a href="../proc_macro/index.html"><code>proc_macro</code> crate</a>。<a href="../proc_macro/index.html"><code>proc_macro</code> crate</a>提供了编写过程宏所需的类型和使其更方便的工具。</p>
<div class="rule" id="r-macro.proc.proc_macro-crate.token-stream"><a class="rule-link" href="#r-macro.proc.proc_macro-crate.token-stream" title="macro.proc.proc_macro-crate.token-stream"><span>[macro<wbr>.proc<wbr>.proc_macro-crate<wbr>.token-stream]</span></a>
</div>

<p>这个crate主要包含<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>类型。过程宏操作<em>词法单元流</em>而不是AST节点，这对于编译器和过程宏来说都是一个更稳定的长期接口。<em>词法单元流</em>大致等同于<code>Vec&lt;TokenTree&gt;</code>，其中<code>TokenTree</code>大致可以被认为是词法单元。例如，<code>foo</code>是一个<code>Ident</code>词法单元，<code>.</code>是一个<code>Punct</code>词法单元，<code>1.2</code>是一个<code>Literal</code>词法单元。<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>类型与<code>Vec&lt;TokenTree&gt;</code>不同，克隆开销很小。</p>
<div class="rule" id="r-macro.proc.proc_macro-crate.span"><a class="rule-link" href="#r-macro.proc.proc_macro-crate.span" title="macro.proc.proc_macro-crate.span"><span>[macro<wbr>.proc<wbr>.proc_macro-crate<wbr>.span]</span></a>
</div>

<p>所有词法单元都带有一个关联的<code>Span</code>。<code>Span</code>是一个不透明的值，不能被修改但可以被创建。<code>Span</code>代表程序中源代码的范围，主要用于错误报告。虽然你不能修改<code>Span</code>本身，但你总是可以更改与任何词法单元<em>关联的</em><code>Span</code>，例如通过从另一个词法单元获取<code>Span</code>。</p>
<div class="rule" id="r-macro.proc.hygiene"><a class="rule-link" href="#r-macro.proc.hygiene" title="macro.proc.hygiene"><span>[macro<wbr>.proc<wbr>.hygiene]</span></a>
</div>

<h2 id="过程宏卫生"><a class="header" href="#过程宏卫生">过程宏卫生</a></h2>
<p>过程宏是<em>不卫生</em>的。这意味着它们的行为就如同输出词法单元流被直接内联写入其旁边的代码一样。这意味着它受外部项影响，也影响外部导入。</p>
<p>宏作者需要小心，以确保他们的宏在给定此限制的情况下，尽可能在更多上下文中工作。这通常包括使用库中项的绝对路径（例如，<code>::std::option::Option</code>而不是<code>Option</code>），或者通过确保生成的函数具有不太可能与其他函数冲突的名称（如<code>__internal_foo</code>而不是<code>foo</code>）。</p>
<!-- TODO: rule name needs improvement -->
<!-- template:attributes -->
<div class="rule" id="r-macro.proc.proc_macro"><a class="rule-link" href="#r-macro.proc.proc_macro" title="macro.proc.proc_macro"><span>[macro<wbr>.proc<wbr>.proc_macro]</span></a>
</div>

<h2 id="proc_macro属性"><a class="header" href="#proc_macro属性"><code>proc_macro</code>属性</a></h2>
<div class="rule" id="r-macro.proc.proc_macro.intro"><a class="rule-link" href="#r-macro.proc.proc_macro.intro" title="macro.proc.proc_macro.intro"><span>[macro<wbr>.proc<wbr>.proc_macro<wbr>.intro]</span></a>
</div>

<p><em><code>proc_macro</code><a href="attributes.html">属性</a></em> 定义一个<a href="macros.html#r-macro.invocation">函数式</a>过程宏。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>此宏定义忽略其输入，并在其作用域中发出一个<code>answer</code><a href="items/functions.html">函数</a>。</p>
<!-- ignore: test doesn't support proc-macro -->
<pre><code class="language-rust ignore"><span class="boring">#![crate_type = "proc-macro"]
</span>extern crate proc_macro;
use proc_macro::TokenStream;

#[proc_macro]
pub fn make_answer(_item: TokenStream) -&gt; TokenStream {
    "fn answer() -&gt; u32 { 42 }".parse().unwrap()
}</code></pre>
<p>我们可以在一个二进制crate中使用它来打印“42”到标准输出。</p>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">extern crate proc_macro_examples;
use proc_macro_examples::make_answer;

make_answer!();

fn main() {
    println!("{}", answer());
}</code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.proc.proc_macro.syntax"><a class="rule-link" href="#r-macro.proc.proc_macro.syntax" title="macro.proc.proc_macro.syntax"><span>[macro<wbr>.proc<wbr>.proc_macro<wbr>.syntax]</span></a>
</div>

<p><code>proc_macro</code>属性使用<a href="attributes.html#grammar-MetaWord">MetaWord</a>语法。</p>
<div class="rule" id="r-macro.proc.proc_macro.allowed-positions"><a class="rule-link" href="#r-macro.proc.proc_macro.allowed-positions" title="macro.proc.proc_macro.allowed-positions"><span>[macro<wbr>.proc<wbr>.proc_macro<wbr>.allowed-positions]</span></a>
</div>

<p><code>proc_macro</code>属性只能应用于<code>fn(TokenStream) -&gt; TokenStream</code>类型的<code>pub</code><a href="items/functions.html">函数</a>，其中<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>来自<a href="../proc_macro/index.html"><code>proc_macro</code> crate</a>。它必须具有 <a href="items/functions.html#r-items.fn.extern">“Rust” ABI</a>。不允许使用其他函数限定符。它必须位于crate的根目录中。</p>
<div class="rule" id="r-macro.proc.proc_macro.duplicates"><a class="rule-link" href="#r-macro.proc.proc_macro.duplicates" title="macro.proc.proc_macro.duplicates"><span>[macro<wbr>.proc<wbr>.proc_macro<wbr>.duplicates]</span></a>
</div>

<p><code>proc_macro</code>属性在一个函数上只能指定一次。</p>
<div class="rule" id="r-macro.proc.proc_macro.namespace"><a class="rule-link" href="#r-macro.proc.proc_macro.namespace" title="macro.proc.proc_macro.namespace"><span>[macro<wbr>.proc<wbr>.proc_macro<wbr>.namespace]</span></a>
</div>

<p><code>proc_macro</code>属性在crate根目录中的<a href="names/namespaces.html">宏命名空间</a>中公开定义宏，其名称与函数同名。</p>
<div class="rule" id="r-macro.proc.proc_macro.behavior"><a class="rule-link" href="#r-macro.proc.proc_macro.behavior" title="macro.proc.proc_macro.behavior"><span>[macro<wbr>.proc<wbr>.proc_macro<wbr>.behavior]</span></a>
</div>

<p>一个函数式过程宏的函数式宏调用会将宏调用分隔符内的内容作为输入<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>参数传递，并用函数的输出<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>替换整个宏调用。</p>
<div class="rule" id="r-macro.proc.proc_macro.invocation"><a class="rule-link" href="#r-macro.proc.proc_macro.invocation" title="macro.proc.proc_macro.invocation"><span>[macro<wbr>.proc<wbr>.proc_macro<wbr>.invocation]</span></a>
</div>

<p>函数式过程宏可以在任何宏调用位置被调用，包括：</p>
<ul>
<li><a href="statements.html">语句</a></li>
<li><a href="expressions.html">表达式</a></li>
<li><a href="patterns.html">模式</a></li>
<li><a href="types.html#type-expressions">类型表达式</a></li>
<li><a href="items.html">项</a>位置，包括<a href="items/external-blocks.html"><code>extern</code>块</a>中的项</li>
<li>固有和特型<a href="items/implementations.html">实现</a></li>
<li><a href="items/traits.html">特型定义</a></li>
</ul>
<!-- template:attributes -->
<div class="rule" id="r-macro.proc.derive"><a class="rule-link" href="#r-macro.proc.derive" title="macro.proc.derive"><span>[macro<wbr>.proc<wbr>.derive]</span></a>
</div>

<h2 id="proc_macro_derive属性"><a class="header" href="#proc_macro_derive属性"><code>proc_macro_derive</code>属性</a></h2>
<div class="rule" id="r-macro.proc.derive.intro"><a class="rule-link" href="#r-macro.proc.derive.intro" title="macro.proc.derive.intro"><span>[macro<wbr>.proc<wbr>.derive<wbr>.intro]</span></a>
</div>

<p>将 <em><code>proc_macro_derive</code><a href="attributes.html">属性</a></em> 应用于<a href="items/functions.html">函数</a>定义一个 <em>派生宏</em> ，它可以通过 <a href="attributes/derive.html"><code>derive</code>属性</a> 调用。这些宏会获得一个<a href="items/structs.html">结构体</a>、<a href="items/enumerations.html">枚举</a>或<a href="items/unions.html">联合体</a>定义的词法单元流，并可以在其后发出新的<a href="items.html">项</a>。它们还可以声明和使用<a href="#派生宏辅助属性">派生宏辅助属性</a>。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>这个派生宏忽略其输入，并添加定义一个函数的词法单元。</p>
<!-- ignore: test doesn't support proc-macro -->
<pre><code class="language-rust ignore"><span class="boring">#![crate_type = "proc-macro"]
</span>extern crate proc_macro;
use proc_macro::TokenStream;

#[proc_macro_derive(AnswerFn)]
pub fn derive_answer_fn(_item: TokenStream) -&gt; TokenStream {
    "fn answer() -&gt; u32 { 42 }".parse().unwrap()
}</code></pre>
<p>要使用它，我们可以这样写：</p>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">extern crate proc_macro_examples;
use proc_macro_examples::AnswerFn;

#[derive(AnswerFn)]
struct Struct;

fn main() {
    assert_eq!(42, answer());
}</code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.proc.derive.syntax"><a class="rule-link" href="#r-macro.proc.derive.syntax" title="macro.proc.derive.syntax"><span>[macro<wbr>.proc<wbr>.derive<wbr>.syntax]</span></a>
</div>

<p><code>proc_macro_derive</code>属性的语法格式是：</p>
<div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ProcMacroDeriveAttribute" onclick="show_railroad()"><a href="procedural-macros.html#railroad-ProcMacroDeriveAttribute">ProcMacroDeriveAttribute</a></span> → <br>    <span class="grammar-literal">proc_macro_derive</span> <span class="grammar-literal">(</span> <span class="grammar-text"><a href="procedural-macros.html#grammar-DeriveMacroName">DeriveMacroName</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="procedural-macros.html#grammar-DeriveMacroAttributes">DeriveMacroAttributes</a></span> )<sup>?</sup> <span class="grammar-literal">,</span><sup>?</sup> <span class="grammar-literal">)</span></p>
<p><span class="grammar-text grammar-production" id="grammar-DeriveMacroName" onclick="show_railroad()"><a href="procedural-macros.html#railroad-DeriveMacroName">DeriveMacroName</a></span> → <span class="grammar-text"><a href="identifiers.html#grammar-IDENTIFIER">IDENTIFIER</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-DeriveMacroAttributes" onclick="show_railroad()"><a href="procedural-macros.html#railroad-DeriveMacroAttributes">DeriveMacroAttributes</a></span> → <br>    <span class="grammar-literal">attributes</span> <span class="grammar-literal">(</span> ( <span class="grammar-text"><a href="identifiers.html#grammar-IDENTIFIER">IDENTIFIER</a></span> ( <span class="grammar-literal">,</span> <span class="grammar-text"><a href="identifiers.html#grammar-IDENTIFIER">IDENTIFIER</a></span> )<sup>*</sup> <span class="grammar-literal">,</span><sup>?</sup> )<sup>?</sup> <span class="grammar-literal">)</span></p>
<p><button class="grammar-toggle-railroad" type="button" title="Toggle railroad display" onclick="toggle_railroad()">Show Railroad</button></p>
</div>

<div class="grammar-railroad grammar-hidden">
<div style="width: 830px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ProcMacroDeriveAttribute"><svg class="railroad" viewbox="0 0 830 87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="procedural-macros.html#grammar-ProcMacroDeriveAttribute">
<text class="comment" x="102" y="25">
ProcMacroDeriveAttribute</text>
</a>
<g class="sequence">
<path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="156" x="35" y="55" />
<text x="113" y="71">
proc_macro_derive</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="201" y="55" />
<text x="215" y="71">
(</text>
</g>
<a class="link" xlink:href="procedural-macros.html#railroad-DeriveMacroName">
<g class="nonterminal">
<rect height="22" width="140" x="239" y="55" />
<text x="309" y="71">
DeriveMacroName</text>
</g>
</a>
<g class="optional">
<path d=" M 389 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 234 m -114 0 l -5 -5 m 0 10 l 5 -5 m 114 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="413" y="55" />
<text x="427" y="71">
,</text>
</g>
<a class="link" xlink:href="procedural-macros.html#railroad-DeriveMacroAttributes">
<g class="nonterminal">
<rect height="22" width="196" x="451" y="55" />
<text x="549" y="71">
DeriveMacroAttributes</text>
</g>
</a>
<path d=" M 441 66 h 10" />
</g>
</g>
<g class="optional">
<path d=" M 681 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="705" y="55" />
<text x="719" y="71">
,</text>
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="767" y="55" />
<text x="781" y="71">
)</text>
</g>
<path d=" M 191 66 h 10" />
<path d=" M 229 66 h 10" />
<path d=" M 379 66 h 10" />
<path d=" M 671 66 h 10" />
<path d=" M 757 66 h 10" />
</g>
<path d=" M 805 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 66 h 10" />
<path d=" M 795 66 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 170px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-DeriveMacroName"><svg class="railroad" viewbox="0 0 170 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="procedural-macros.html#grammar-DeriveMacroName">
<text class="comment" x="67" y="25">
DeriveMacroName</text>
</a>
<g class="sequence">
<path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<a class="link" xlink:href="identifiers.html#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="35" y="42" />
<text x="85" y="58">
IDENTIFIER</text>
</g>
</a>
<path d=" M 145 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 53 h 10" />
<path d=" M 135 53 h 10" />
</g>
</g>
</svg>
</div>

<div style="width: 710px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-DeriveMacroAttributes"><svg class="railroad" viewbox="0 0 710 112" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect class="railroad_canvas" height="100%" width="100%" />
<g class="verticalgrid">
<a class="link" xlink:href="procedural-macros.html#grammar-DeriveMacroAttributes">
<text class="comment" x="92" y="25">
DeriveMacroAttributes</text>
</a>
<g class="sequence">
<path d=" M 10 78 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5" />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="100" x="35" y="67" />
<text x="85" y="83">
attributes</text>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="145" y="67" />
<text x="159" y="83">
(</text>
</g>
<g class="optional">
<path d=" M 183 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v -12 a 12 12 0 0 1 12 -12 h 406 m -200 0 l -5 -5 m 0 10 l 5 -5 m 200 0 a 12 12 0 0 1 12 12 v 12 a 12 12 0 0 0 12 12 h -24" />
<g class="sequence">
<a class="link" xlink:href="identifiers.html#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="207" y="67" />
<text x="257" y="83">
IDENTIFIER</text>
</g>
</a>
<g class="optional">
<path d=" M 317 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 162 m -78 0 l -5 -5 m 0 10 l 5 -5 m 78 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="repeat">
<path d=" M 341 78 h 12 m 138 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -138 m 72 0 l 5 -5 m 0 10 l -5 -5 m -72 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12" />
<g />
<g class="sequence">
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="353" y="67" />
<text x="367" y="83">
,</text>
</g>
<a class="link" xlink:href="identifiers.html#railroad-IDENTIFIER">
<g class="nonterminal">
<rect height="22" width="100" x="391" y="67" />
<text x="441" y="83">
IDENTIFIER</text>
</g>
</a>
<path d=" M 381 78 h 10" />
</g>
</g>
</g>
<g class="optional">
<path d=" M 537 78 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24" />
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="561" y="67" />
<text x="575" y="83">
,</text>
</g>
</g>
<path d=" M 307 78 h 10" />
<path d=" M 527 78 h 10" />
</g>
</g>
<g class="terminal">
<rect height="22" rx="10" ry="10" width="28" x="647" y="67" />
<text x="661" y="83">
)</text>
</g>
<path d=" M 135 78 h 10" />
<path d=" M 173 78 h 10" />
<path d=" M 637 78 h 10" />
</g>
<path d=" M 685 78 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5" />
<path d=" M 25 78 h 10" />
<path d=" M 675 78 h 10" />
</g>
</g>
</svg>
</div>

</div>

<p>派生宏的名称由<a href="procedural-macros.html#grammar-DeriveMacroName">DeriveMacroName</a>给出。可选的<code>attributes</code>参数在<a href="procedural-macros.html#r-macro.proc.derive.attributes">macro.proc.derive.attributes</a>中描述。</p>
<div class="rule" id="r-macro.proc.derive.allowed-positions"><a class="rule-link" href="#r-macro.proc.derive.allowed-positions" title="macro.proc.derive.allowed-positions"><span>[macro<wbr>.proc<wbr>.derive<wbr>.allowed-positions]</span></a>
</div>

<p><code>proc_macro_derive</code>属性只能应用于定义在crate根目录中，并带有<a href="items/functions.html#r-items.fn.extern">Rust ABI</a>的<code>pub</code><a href="items/functions.html">函数</a>，其<a href="types.html">类型</a>为<code>fn(TokenStream) -&gt; TokenStream</code>，其中<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>来自<a href="../proc_macro/index.html"><code>proc_macro</code> crate</a>。该函数可以是<code>const</code>，并且可以使用<code>extern</code>显式指定 Rust ABI，但不能使用任何其他<a href="items/functions.html#grammar-FunctionQualifiers">限定符</a>（例如，它不能是<code>async</code>或<code>unsafe</code>）。</p>
<div class="rule" id="r-macro.proc.derive.duplicates"><a class="rule-link" href="#r-macro.proc.derive.duplicates" title="macro.proc.derive.duplicates"><span>[macro<wbr>.proc<wbr>.derive<wbr>.duplicates]</span></a>
</div>

<p><code>proc_macro_derive</code>属性在一个函数上只能使用一次。</p>
<div class="rule" id="r-macro.proc.derive.namespace"><a class="rule-link" href="#r-macro.proc.derive.namespace" title="macro.proc.derive.namespace"><span>[macro<wbr>.proc<wbr>.derive<wbr>.namespace]</span></a>
</div>

<p><code>proc_macro_derive</code>属性在crate的根目录中的<a href="names/namespaces.html">宏命名空间</a>中公开定义派生宏。</p>
<div class="rule" id="r-macro.proc.derive.output"><a class="rule-link" href="#r-macro.proc.derive.output" title="macro.proc.derive.output"><span>[macro<wbr>.proc<wbr>.derive<wbr>.output]</span></a>
</div>

<p>输入<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>是应用<code>derive</code>属性的<a href="items.html">项</a>的词法单元流。输出<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>必须是（可能为空的）一组<a href="items.html">项</a>。这些<a href="items.html">项</a>会在输入<a href="items.html">项</a>之后，在同一<a href="items/modules.html">模块</a>或<a href="expressions/block-expr.html">块</a>内被追加。</p>
<div class="rule" id="r-macro.proc.derive.attributes"><a class="rule-link" href="#r-macro.proc.derive.attributes" title="macro.proc.derive.attributes"><span>[macro<wbr>.proc<wbr>.derive<wbr>.attributes]</span></a>
</div>

<h3 id="派生宏辅助属性"><a class="header" href="#派生宏辅助属性">派生宏辅助属性</a></h3>
<div class="rule" id="r-macro.proc.derive.attributes.intro"><a class="rule-link" href="#r-macro.proc.derive.attributes.intro" title="macro.proc.derive.attributes.intro"><span>[macro<wbr>.proc<wbr>.derive<wbr>.attributes<wbr>.intro]</span></a>
</div>

<p>派生宏可以声明 <em>派生宏辅助属性</em> ，用于派生宏所应用的<a href="items.html">项</a>的作用域内。这些<a href="attributes.html">属性</a>是<a href="attributes.html#active-and-inert-attributes">惰性的</a>。虽然它们的目的被声明它们的宏使用，但它们可以被任何宏看到。</p>
<div class="rule" id="r-macro.proc.derive.attributes.decl"><a class="rule-link" href="#r-macro.proc.derive.attributes.decl" title="macro.proc.derive.attributes.decl"><span>[macro<wbr>.proc<wbr>.derive<wbr>.attributes<wbr>.decl]</span></a>
</div>

<p>派生宏的辅助属性通过将其标识符添加到<code>proc_macro_derive</code>属性的<code>attributes</code>列表中来声明。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>这声明了一个辅助属性然后忽略了它。</p>
<!-- ignore: test doesn't support proc-macro -->
<pre><code class="language-rust ignore"><span class="boring">#![crate_type="proc-macro"]
</span><span class="boring">extern crate proc_macro;
</span><span class="boring">use proc_macro::TokenStream;
</span><span class="boring">
</span>#[proc_macro_derive(WithHelperAttr, attributes(helper))]
pub fn derive_with_helper_attr(_item: TokenStream) -&gt; TokenStream {
    TokenStream::new()
}</code></pre>
<p>要使用它，我们可以这样写：</p>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">extern crate proc_macro_examples;
use proc_macro_examples::WithHelperAttr;

#[derive(WithHelperAttr)]
struct Struct {
    #[helper] field: (),
}</code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.proc.derive.attributes.scope"><a class="rule-link" href="#r-macro.proc.derive.attributes.scope" title="macro.proc.derive.attributes.scope"><span>[macro<wbr>.proc<wbr>.derive<wbr>.attributes<wbr>.scope]</span></a>
</div>

<p>当一个派生宏调用应用于一个<a href="items.html">项</a>时，该派生宏引入的辅助属性会在以下情况下生效：1) 用于应用于该<a href="items.html">项</a>并在派生宏调用后词法应用的<a href="attributes.html">属性</a>，以及 2) 用于应用于<a href="items.html">项</a>内部的字段和变体的<a href="attributes.html">属性</a>。</p>
<div class="alert alert-note">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>注意</p>

<p>rustc目前允许在引入它们的宏之前使用派生辅助。这种乱序使用的派生辅助可能不会遮蔽其他属性宏。此行为已被弃用，并计划移除。</p>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">#[helper] // 已弃用，未来将成为硬错误。
#[derive(WithHelperAttr)]
struct Struct {
    field: (),
}</code></pre>
<p>更多详情，请参见<a href="https://github.com/rust-lang/rust/issues/79202">Rust问题单#79202</a>。</p>
</blockquote>
</div>

<!-- template:attributes -->
<div class="rule" id="r-macro.proc.attribute"><a class="rule-link" href="#r-macro.proc.attribute" title="macro.proc.attribute"><span>[macro<wbr>.proc<wbr>.attribute]</span></a>
</div>

<h2 id="proc_macro_attribute属性"><a class="header" href="#proc_macro_attribute属性"><code>proc_macro_attribute</code>属性</a></h2>
<div class="rule" id="r-macro.proc.attribute.intro"><a class="rule-link" href="#r-macro.proc.attribute.intro" title="macro.proc.attribute.intro"><span>[macro<wbr>.proc<wbr>.attribute<wbr>.intro]</span></a>
</div>

<p><em><code>proc_macro_attribute</code><a href="attributes.html">属性</a></em> 定义一个 <em>属性宏</em> ，它可以作为<a href="attributes.html">外部属性</a>使用。</p>
<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>此属性宏接受输入流并原样发出，实际上是一个空操作属性。</p>
<!-- ignore: test doesn't support proc-macro -->
<pre><code class="language-rust ignore"><span class="boring">#![crate_type = "proc-macro"]
</span><span class="boring">extern crate proc_macro;
</span><span class="boring">use proc_macro::TokenStream;
</span>
#[proc_macro_attribute]
pub fn return_as_is(_attr: TokenStream, item: TokenStream) -&gt; TokenStream {
    item
}</code></pre>
</blockquote>
</div>

<div class="alert alert-example">
<blockquote>
<p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>例子</p>

<p>这显示了在编译器输出中，属性宏所看到的字符串化<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>。</p>
<!-- ignore: test doesn't support proc-macro -->
<pre><code class="language-rust ignore">// my-macro/src/lib.rs
<span class="boring">extern crate proc_macro;
</span><span class="boring">use proc_macro::TokenStream;
</span>#[proc_macro_attribute]
pub fn show_streams(attr: TokenStream, item: TokenStream) -&gt; TokenStream {
    println!("attr: \"{attr}\"");
    println!("item: \"{item}\"");
    item
}</code></pre>
<!-- ignore: requires external crates -->
<pre><code class="language-rust ignore">// src/lib.rs
extern crate my_macro;

use my_macro::show_streams;

// 示例：基本函数。
#[show_streams]
fn invoke1() {}
// 输出：attr: ""
// 输出：item: "fn invoke1() {}"

// 示例：带输入的属性。
#[show_streams(bar)]
fn invoke2() {}
// 输出：attr: "bar"
// 输出：item: "fn invoke2() {}"

// 示例：输入中有多个词法单元。
#[show_streams(multiple =&gt; tokens)]
fn invoke3() {}
// 输出：attr: "multiple =&gt; tokens"
// 输出：item: "fn invoke3() {}"

// 示例：输入中有分隔符。
#[show_streams { delimiters }]
fn invoke4() {}
// 输出：attr: "delimiters"
// 输出：item: "fn invoke4() {}"</code></pre>
</blockquote>
</div>

<div class="rule" id="r-macro.proc.attribute.syntax"><a class="rule-link" href="#r-macro.proc.attribute.syntax" title="macro.proc.attribute.syntax"><span>[macro<wbr>.proc<wbr>.attribute<wbr>.syntax]</span></a>
</div>

<p><code>proc_macro_attribute</code>属性使用<a href="attributes.html#grammar-MetaWord">MetaWord</a>语法。</p>
<div class="rule" id="r-macro.proc.attribute.allowed-positions"><a class="rule-link" href="#r-macro.proc.attribute.allowed-positions" title="macro.proc.attribute.allowed-positions"><span>[macro<wbr>.proc<wbr>.attribute<wbr>.allowed-positions]</span></a>
</div>

<p><code>proc_macro_attribute</code>属性只能应用于<code>fn(TokenStream, TokenStream) -&gt; TokenStream</code>类型的<code>pub</code><a href="items/functions.html">函数</a>，其中<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>来自 <a href="../proc_macro/index.html"><code>proc_macro</code> crate</a>。它必须具有 <a href="items/functions.html#r-items.fn.extern">“Rust” ABI</a>。不允许使用其他函数限定符。它必须位于crate的根目录中。</p>
<div class="rule" id="r-macro.proc.attribute.duplicates"><a class="rule-link" href="#r-macro.proc.attribute.duplicates" title="macro.proc.attribute.duplicates"><span>[macro<wbr>.proc<wbr>.attribute<wbr>.duplicates]</span></a>
</div>

<p><code>proc_macro_attribute</code>属性在一个函数上只能指定一次。</p>
<div class="rule" id="r-macro.proc.attribute.namespace"><a class="rule-link" href="#r-macro.proc.attribute.namespace" title="macro.proc.attribute.namespace"><span>[macro<wbr>.proc<wbr>.attribute<wbr>.namespace]</span></a>
</div>

<p><code>proc_macro_attribute</code>属性在crate的根目录中的<a href="names/namespaces.html">宏命名空间</a>中定义属性，其名称与函数同名。</p>
<div class="rule" id="r-macro.proc.attribute.use-positions"><a class="rule-link" href="#r-macro.proc.attribute.use-positions" title="macro.proc.attribute.use-positions"><span>[macro<wbr>.proc<wbr>.attribute<wbr>.use-positions]</span></a>
</div>

<p>属性宏只能用于：</p>
<ul>
<li><a href="items.html">项</a></li>
<li><a href="items/external-blocks.html"><code>extern</code>块</a> 中的项</li>
<li>固有和特型 <a href="items/implementations.html">实现</a></li>
<li><a href="items/traits.html">特型定义</a></li>
</ul>
<div class="rule" id="r-macro.proc.attribute.behavior"><a class="rule-link" href="#r-macro.proc.attribute.behavior" title="macro.proc.attribute.behavior"><span>[macro<wbr>.proc<wbr>.attribute<wbr>.behavior]</span></a>
</div>

<p>第一个<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>参数是属性名称后的带分隔符词法单元树，但不包括外部分隔符。如果应用的属性只包含属性名称，或属性名称后跟空分隔符，则<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>为空。</p>
<p>第二个<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>是<a href="items.html">项</a>的其余部分，包括<a href="items.html">项</a>上的其他<a href="attributes.html">属性</a>。</p>
<p>应用属性的<a href="items.html">项</a>会被返回的<a href="https://doc.rust-lang.org/proc_macro/struct.TokenStream.html"><code>词法单元流</code></a>中的零个或多个<a href="items.html">项</a>替换。</p>
<div class="rule" id="r-macro.proc.token"><a class="rule-link" href="#r-macro.proc.token" title="macro.proc.token"><span>[macro<wbr>.proc<wbr>.token]</span></a>
</div>

<h2 id="声明宏词法单元和过程宏词法单元"><a class="header" href="#声明宏词法单元和过程宏词法单元">声明宏词法单元和过程宏词法单元</a></h2>
<div class="rule" id="r-macro.proc.token.intro"><a class="rule-link" href="#r-macro.proc.token.intro" title="macro.proc.token.intro"><span>[macro<wbr>.proc<wbr>.token<wbr>.intro]</span></a>
</div>

<p>声明式<a href="macros-by-example.html"><code>macro_rules</code></a>宏和过程宏对词法单元（或更确切地说，<a href="../proc_macro/enum.TokenTree.html"><code>TokenTree</code>s</a>）使用相似但不同的定义。</p>
<div class="rule" id="r-macro.proc.token.macro_rules"><a class="rule-link" href="#r-macro.proc.token.macro_rules" title="macro.proc.token.macro_rules"><span>[macro<wbr>.proc<wbr>.token<wbr>.macro_rules]</span></a>
</div>

<p><a href="macros-by-example.html"><code>macro_rules</code></a>中的词法单元树（对应<code>tt</code>匹配器）定义如下：</p>
<ul>
<li>带分隔符的组（<code>(...)</code>、<code>{...}</code>等）</li>
<li>语言支持的所有运算符，包括单字符和多字符的（<code>+</code>、<code>+=</code>）。
<ul>
<li>请注意，此集合不包括单引号<code>'</code>。</li>
</ul>
</li>
<li>字面量（<code>"string"</code>、<code>1</code>等）
<ul>
<li>请注意，负号（例如<code>-1</code>）永远不会是此类字面量词法单元的一部分，而是一个单独的运算符词法单元。</li>
</ul>
</li>
<li>标识符，包括关键字（<code>ident</code>、<code>r#ident</code>、<code>fn</code>）</li>
<li>生命周期（<code>'ident</code>）</li>
<li><a href="macros-by-example.html"><code>macro_rules</code></a>中的元变量替换（例如<code>macro_rules! mac { ($my_expr: expr) =&gt; { $my_expr } }</code>在<code>mac</code>展开后的<code>$my_expr</code>，无论传递的表达式如何，都将被视为单个词法单元树）</li>
</ul>
<div class="rule" id="r-macro.proc.token.tree"><a class="rule-link" href="#r-macro.proc.token.tree" title="macro.proc.token.tree"><span>[macro<wbr>.proc<wbr>.token<wbr>.tree]</span></a>
</div>

<p>过程宏中的词法单元树定义如下：</p>
<ul>
<li>带分隔符的组（<code>(...)</code>、<code>{...}</code>等）</li>
<li>语言支持的运算符中使用的所有标点符号（<code>+</code>，但不包括<code>+=</code>），以及单引号<code>'</code>字符（通常用于生命周期，有关生命周期拆分和合并行为，请参见下文）</li>
<li>字面量（<code>"string"</code>、<code>1</code>等）
<ul>
<li>负号（例如<code>-1</code>）作为整数和浮点字面量的一部分受支持。</li>
</ul>
</li>
<li>标识符，包括关键字（<code>ident</code>、<code>r#ident</code>、<code>fn</code>）</li>
</ul>
<div class="rule" id="r-macro.proc.token.conversion.intro"><a class="rule-link" href="#r-macro.proc.token.conversion.intro" title="macro.proc.token.conversion.intro"><span>[macro<wbr>.proc<wbr>.token<wbr>.conversion<wbr>.intro]</span></a>
</div>

<p>当词法单元流在过程宏之间传递时，会考虑这两种定义之间的不匹配。
请注意，下面的转换可能以惰性方式发生，因此如果词法单元未被实际检查，则可能不会发生转换。</p>
<div class="rule" id="r-macro.proc.token.conversion.to-proc_macro"><a class="rule-link" href="#r-macro.proc.token.conversion.to-proc_macro" title="macro.proc.token.conversion.to-proc_macro"><span>[macro<wbr>.proc<wbr>.token<wbr>.conversion<wbr>.to-proc_macro]</span></a>
</div>

<p>当传递给过程宏时</p>
<ul>
<li>所有多字符运算符都会被拆分为单字符。</li>
<li>生命周期会被拆分为一个<code>'</code>字符和一个标识符。</li>
<li>关键字元变量 <a href="macros-by-example.html#r-macro.decl.hygiene.crate"><code>$crate</code></a> 作为单个标识符传递。</li>
<li>所有其他元变量替换都表示为其底层词法单元流。
<ul>
<li>此类词法单元流可能被包装到带分隔符的组（<a href="../proc_macro/struct.Group.html"><code>Group</code></a>）中，使用隐式分隔符（<a href="../proc_macro/enum.Delimiter.html#variant.None"><code>Delimiter::None</code></a>），当需要保留解析优先级时。</li>
<li><code>tt</code>和<code>ident</code>替换永远不会被包装到此类组中，并且始终表示为其底层词法单元树。</li>
</ul>
</li>
</ul>
<div class="rule" id="r-macro.proc.token.conversion.from-proc_macro"><a class="rule-link" href="#r-macro.proc.token.conversion.from-proc_macro" title="macro.proc.token.conversion.from-proc_macro"><span>[macro<wbr>.proc<wbr>.token<wbr>.conversion<wbr>.from-proc_macro]</span></a>
</div>

<p>当从过程宏发出时</p>
<ul>
<li>标点符号在适用时会被组合成多字符运算符。</li>
<li>与标识符连接的单引号<code>'</code>会被组合成生命周期。</li>
<li>负字面量会被转换为两个词法单元（<code>-</code>和字面量），可能被包装到带分隔符的组（<a href="../proc_macro/struct.Group.html"><code>Group</code></a>）中，使用隐式分隔符（<a href="../proc_macro/enum.Delimiter.html#variant.None"><code>Delimiter::None</code></a>），当需要保留解析优先级时。</li>
</ul>
<div class="rule" id="r-macro.proc.token.doc-comment"><a class="rule-link" href="#r-macro.proc.token.doc-comment" title="macro.proc.token.doc-comment"><span>[macro<wbr>.proc<wbr>.token<wbr>.doc-comment]</span></a>
</div>

<p>请注意，声明宏和过程宏都不支持文档注释词法单元（例如<code>/// Doc</code>），因此当它们被传递给宏时，总是会被转换为表示其等效<code>#[doc = r"str"]</code>属性的词法单元流。</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="macros-by-example.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="crates-and-source-files.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="macros-by-example.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="crates-and-source-files.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/reference-da60281b.js"></script>


        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const fragmentMap =
                    {"#attribute-macros":"procedural-macros.html#the-proc_macro_attribute-attribute","#derive-macros":"procedural-macros.html#the-proc_macro_derive-attribute","#function-like-procedural-macros":"procedural-macros.html#the-proc_macro-attribute"}
                ;
                const target = fragmentMap[window.location.hash];
                if (target) {
                    let url = new URL(target, window.location.href);
                    window.location.replace(url.href);
                }
            });
        </script>

    </div>
    </body>
</html>
